./ ADD NAME=$DOC1    0100-1993082-1993082-1926-00234-00234-00000-RESTDOC
04/09/90 - PAT MURPHY 214-216-3139 TEXAS UTILITIES SERVICES

KLEENUP  -  REXX EXEC TO GENERATE HMIGRATE COMMANDS FOR ALL BUT
THE CURRENT GENERATIONS OF THE REQUESTED DISK DATASET.

 REXX EXEC - NEEDS TO GO IN THE SYSPROC OR SYSEXEC DD.
 KLEENUP COMMAND FORMAT:
 KLEENUP GDGDSN MMM NNN
 IT WILL GENERATE HSM COMMANDS TO MIGRATE DISK GDG'S,  SPECIFY
 MIGRATIONLEVEL 1 OR 2 BY PUTTING ML1 OR ML2 AFTER THE DSN AT  MMM
 CAN SPECIFY NUMBER TO KEEP ON DASD BY A NUMBER FOLLOWING THIS NNN
 EXAMPLE:
           KLEENUP SYS2.LISTCAT.USERCAT ML2 1
 THIS WILL ISSUE COMMANDS TO MIGRATE ALL BUT THE CURRENT GEN. TO
 MIGRATIONLEVEL 2.
           KLEENUP SYS2.LISTCAT.USERCAT
 THIS WILL ISSUE COMMANDS TO MIGRATE ALL BUT THE CURRENT GEN. TO
 MIGRATIONLEVEL 1 BY DEFAULT.

INSTALL INSTRUCTIONS:
1. COPY KLEENUP INTO THE SYSPROC OR SYSEXEC CONCATENATION.
2. KLEENUPJ IS A SAMPLE OF HOW WE USE IT.

________________________________________________________________________
04/10/90 - MARK TERRY 214-216-3122 TEXAS UTILITIES SERVICES


 GETOPR - WRITTEN BY MARK TERRY, SENIOR MVS SYSTEMS PROGRAMMER          DOC FILE
          AT TEXAS UTILITIES SERVICES.                                  DOC FILE
                                                                        DOC FILE
 MARK WROTE GETOPR FOR THE OPERATORS TO USE TO FINDOUT THE              DOC FILE
 RACF INFO ASSOCIATED WITH A GIVEN USERID AND DISPLAY IT ON THE         DOC FILE
 CONSOLE. THE OPERATOR STARTS A PROC CALLED GETOPER, WITH FORMAT:       DOC FILE
                                                                        DOC FILE
     S GETOPER,LID=XXXX                                                 DOC FILE
                                                                        DOC FILE
 WHERE XXXX = USERID THAT THE INFO IS TO BE OBTAINED AND                DOC FILE
 DISPLAYED ON THE OPERATOR TERMINAL.                                    DOC FILE

INSTALL INSTRUCTIONS:
1. COPY GETOPER PROC INTO A PROCLIB ACCESSIBLE FOR STARTED STASKS.
2. ASSEMBLE THE GETOPR PROGRAM, JCL IS WRAPPED AROUND IT.

________________________________________________________________________
04/10/90 - TOM BURNS  214-331-3151 TEXAS UTILITIES SERVICES

SASSRCHD -SAS PROGRAM WRITTEN BY TOM BURNS, SENIOR SYSTEMS PROGRAMMER
          AT TEXAS UTILITIES SERVICES, THAT READS SMF DATA AT MVS 3.1.3
          LEVEL AND GIVES A REPORT ON WHO OPENED NONVSAM DATASETS, THEIR
          BLOCKSIZE THAT THEY WERE OPENED WITH, AND WHO DELETED THEM.

SASSRCHV - SAS PROGRAM WRITTEN BY TOM BURNS, SENIOR SYSTEMS PROGRAMMER
           AT TEXAS UTILITIES SERVICES, THAT READS SMF DATA AT MVS 3.1.3
           LEVEL AND GIVES A REPORT ON WHO OPENED VSAM DATASETS AND
           WHO DELETED THEM.

________________________________________________________________________
04/10/90 - PAT MURPHY 214-216-3139

CONESA   -  CONSOLE PROGRAM MODIFIED FOR ESA. DISPLAYS CONSOLES AS A
TSO COMMAND UNDER ISPF OR TSO.  FEATURES:

        HIGHLIGHTED MESSAGES ON CONSOLE ARE HIGHLIGHTED
        AUTOMATIC UPDATE FEATURE
        ENTER OPERATOR COMMANDS
        DISPLAY LAST IPL AND IF CLPA WAS DONE

PRESENTLY WORKS UNDER MVS/ESA 3.1.3 AND  DFP RELEASE 3.1.1.
SOME OF THE CONTROL BLOCKS THAT IT USED WERE MOVED INTO THE CONSOLE
ADDRESS SPACE AFTER DFP 2.2.

INSTALL INSTRUCTIONS:
1. UPDATE SYSDSVC TO REFLECT PROPER PROCEDURE FOR AN AUTHORIZED SVC AT
YOUR INSTALLATION.
2. UPDATE THE ASSEMBLY JCL CALLED CONSOLEJ TO REFLECT LIBRARIES AT
YOUR INSTALLATION.
3. ENTER 'TSO CONSOLE' FROM ISPF OR CONSOLE FROM THE READY STATE IN TSO.
4. PF-1 WILL DISPLAY PFKEY DEFINITIONS.
5. THE AUTOMATIC UPDATE AT LESS THAN 2 SECONDS IS HARD TO STOP ON
3290'S. USE AUTOMATIC UPDATES OF 4 SECONDS OR MORE FOR THESE.
6. DOES A TGET ON MOD2/5'S TO ALLOW FOR MOD 5'S THAT DID NOT DISPLAY
CORRECTLY UNDER THE OLD ONE.
7. ADDED AXFRE TO FREE THE AX TABLE ENTRY.

________________________________________________________________________
NOT UPDATED SINCE 1987 - PMM

CONSOLE  -  PROGRAM TO DISPLAY CONSOLE ACTIVITY AS A TSO COMMAND
UNDER ISPF OR TSO.  FEATURES:

        HIGHLIGHTED MESSAGES ON CONSOLE ARE HIGHLIGHTED
        AUTOMATIC UPDATE FEATURE
        ENTER OPERATOR COMMANDS
        DISPLAY LAST IPL AND IF CLPA WAS DONE

PRESENTLY WORKS UNDER MVS/XA UNDER DFP RELEASE 1 AND 2.1. IT HAS BEEN
3 YEARS SINCE WE WERE SP, BUT IT USED TO WORK THERE AS WELL.


INSTALL INSTRUCTIONS:
1. UPDATE SYSDSVC TO REFLECT PROPER PROCEDURE FOR AN AUTHORIZED SVC AT
YOUR INSTALLATION.
2. UPDATE THE ASSEMBLY JCL CALLED CONSOLEJ TO REFLECT LIBRARIES AT
YOUR INSTALLATION.
3. ENTER 'TSO CONSOLE' FROM ISPF OR CONSOLE FROM THE READY STATE IN TSO.
4. PF-1 WILL DISPLAY PFKEY DEFINITIONS.
5. THE AUTOMATIC UPDATE AT LESS THAN 2 SECONDS IS HARD TO STOP ON
3290'S. USE AUTOMATIC UPDATES OF 4 SECONDS OR MORE FOR THESE.

________________________________________________________________________
04/06/90 - PAT MURPHY 214-216-3139

MTTESA   -  USES CROSS MEMORY SERVICES TO READ AND DISPLAY THE MASTER
TRACE TABLE AS A TSO COMMAND PROCESSOR.  THIS IS THE XA VERSION
OF THE PROGRAM THAT ORIGINATED AS MTT UNDER SP1.3.  FEATURES:
        READ/DISPLAY MASTER TRACE TABLE
        ENTER OPERATOR COMMANDS
        CAN USE FIND TO SEARCH THE MASTER TRACE TABLE
              F 'SEARCH ARGUMENT IN QUOTES'

INSTALL INSTRUCTIONS:
1. UPDATE SYSDSVC TO REFLECT PROPER PROCEDURE FOR AN AUTHORIZED SVC AT
YOUR INSTALLATION, OR INSERT IN IKJTSOXX THE MTT COMMAND,
AND ISSUE THE TSO COMMAND FOR TSO/E 2.1.1 AND ABOVE,
     PARMLIB UPDATE(XX)
THIS WILL INVOKE THE MTT COMMAND AUTHORIZED AND THE SVC CAN BE NOOP'D.
2. UPDATE THE ASSEMBLY JCL CALLED MTTESA TO REFLECT LIBRARIES AT
YOUR INSTALLATION.
3. ENTER 'TSO MTT' FROM ISPF OR MTT FROM THE READY STATE IN TSO.
4. PF-1 WILL DISPLAY PFKEY DEFINITIONS.
5. IKJTSO00 SAMPLE MEMBER PROVIDED.
________________________________________________________________________
NOT UPDATED SINCE 1987 - PMM

MTTXA    -  USES CROSS MEMORY SERVICES TO READ AND DISPLAY THE MASTER
TRACE TABLE AS A TSO COMMAND PROCESSOR.  THIS IS THE XA VERSION
OF THE PROGRAM THAT ORIGINATED AS MTT UNDER SP1.3.  FEATURES:
        READ/DISPLAY MASTER TRACE TABLE
        ENTER OPERATOR COMMANDS
        CAN USE FIND TO SEARCH THE MASTER TRACE TABLE
              F 'SEARCH ARGUMENT IN QUOTES'

INSTALL INSTRUCTIONS:
1. UPDATE SYSDSVC TO REFLECT PROPER PROCEDURE FOR AN AUTHORIZED SVC AT
YOUR INSTALLATION.
2. UPDATE THE ASSEMBLY JCL CALLED MTTXAJ TO REFLECT LIBRARIES AT
YOUR INSTALLATION.
3. ENTER 'TSO MTTXA' FROM ISPF OR MTTXA FROM THE READY STATE IN TSO.
4. PF-1 WILL DISPLAY PFKEY DEFINITIONS.
________________________________________________________________________
MTT      -  SAME AS ABOVE FOR SP1.X SYSTEMS. WE HAVE NOT USED FOR 3
YEARS SINCE GOING TO XA.

INSTALL INSTRUCTIONS:
1. UPDATE SYSDSVC TO REFLECT PROPER PROCEDURE FOR AN AUTHORIZED SVC AT
YOUR INSTALLATION.
2. UPDATE THE ASSEMBLY JCL CALLED MTTJ TO REFLECT LIBRARIES AT
YOUR INSTALLATION.
3. ENTER 'TSO MTT' FROM ISPF OR MTT FROM THE READY STATE IN TSO.
4. PF-1 WILL DISPLAY PFKEY DEFINITIONS.
________________________________________________________________________
04/10/90 - UPDATED FOR ASVTMAXU, WAS HARDCODED AT 210.  SECURITY CHECK
           FOR ACCOUNT AUTHORITY. PAT MURPHY 214-216-3139

SWAPIN   -  WILL SYSEVENT A JOB TO NEW PERFORMANCE GROUP.

INSTALL INSTRUCTIONS:
1. UPDATE SYSDSVC TO REFLECT PROPER PROCEDURE FOR AN AUTHORIZED SVC AT
YOUR INSTALLATION.
2. UPDATE THE ASSEMBLY JCL CALLED SWAPINJ TO REFLECT LIBRARIES AT
YOUR INSTALLATION.
3. ENTER 'TSO SWAPIN' FROM ISPF OR SWAPIN FROM THE READY STATE IN TSO.
________________________________________________________________________
NOT UPDATED SINCE 1987.
AUTOWTOR -  MPF EXIT TO REPLY M. CAN USE FOR IEC701D WITH CARTRIDGES
TO BE INITIALIZED (THAT IS THE WAY WE USE IT). THE OPERATOR SETS THE
MPF TO THE PARMLIB MEMBER THAT HAS THE IEC701D AND AUTOWTOR (SEE
MPFLST03 FOR AN EXAMPLE OF A PARMLIB MEMBER). THE AUTOWTOR WILL GIVE
M TO THE IEC701D AND THE OPERATOR LOOKS AT THE VISUAL DISPLAY ON THE
3480 TO SEE WHAT CARTTRIDGE NUMBER TO INSERT.

INSTALL INSTRUCTIONS:
1. UPDATE THE ASSEMBLY JCL CALLED AUTOWTOJ TO REFLECT LIBRARIES AT
YOUR INSTALLATION.
2. MODIFY A MEMBER IN SYS1.PARMLIB TO CONTAIN THE FOLLOWING LINE:
IEC701D,SUP(NO),USEREXIT(AUTOWTOR)
THEN ISSUE THE OPERATOR COMMAND, SET MPF=XX WHERE XX IS THE MEMBER
JUST UPDATED IN PARMLIB.
________________________________________________________________________
04/10/90 ADDED UPDATED VERSION WITH CHANGES BELOW.
IGGPRE00 -  DADSM ALLOCATION EXIT TO KEEP CERTAIN PROBLEM DATASETS FROM
BEING ALLOCATED ON PACKS BEGINNING WITH STG (STORAGE PACKS).
YOU WOULD BE ABLE TO GET SOME IDEAS OFF OF THIS, BUT YOU WILL PROBABLY
NEED TO CHANGE IT TO MATCH YOUR INSTALLATION NEEDS.

         LOADS IGGPRETB THAT CONTAINS SOME PREFIXES OF DATASETS THAT
 HAVE BEEN FILLING STORAGE PACKS.  IT ALSO KEEPS PROGRAMMERS (RACF
 DEFAULT GROUP PGRB OR PGR) OFF OF PRODUCTION PACKS THAT START WITH
 VSM OR STG.  DEV OR DEVC IS WHERE THEY SHOULD BE.

 MODIFICATIONS:

    3/01/87   DONT ALLOW ALLOCATION WITH EXPDT.          MKT
    3/11/87   DONT ALLOW NONVSAM ALLOC ON A VSAM PACK.   MKT
    9/10/87   DONT ALLOW DEVELOPMENT ALLOC ON PROD PACKS.MKT
    5/22/88   PROBLEM WITH NEW ISPF - PMM
    6/24/88   CHECK DEVV VSAM ONLY  - PMM
    9/20/89   ISPF FIX AND CHANGE USER IDS AND ADD LIBXXX PACKS MKT

IGGPRETB -  TABLE LOADED BY IGGPRE00 THAT CONTAINS THE FIRST 1 TO 12
CHARACTERS OF DATASET NAMES NOT TO BE ALLOCATED ON THE PACKS BEGINNING
WITH STG.

INSTALL INSTRUCTIONS:
1. UPDATE THE ASSEMBLY JCL CALLED IGGPREJ TO REFLECT LIBRARIES AT
YOUR INSTALLATION.
2. IPL WITH CLPA OR MODREP THE IGGPRE00 AND IGGPRETB MODULES IN LPALIB.
________________________________________________________________________
NOT UPDATED SINCE 1987.
ZTPP0210 -  PROGRAM TO WRITE HEX 'FF' TO FIRST PDS DIRECTORY ENTRY
THEREBY DELETING ALL MEMBERS OF THE PDS AND LEAVING THE LIBRARY.

ZTPP210J -  SAMPLE EXECUTION JCL TO RUN ZTPP0210.

ZTPPASM  -  JCL TO ASSEMBLE ZTPP0210.

INSTALL INSTRUCTIONS:
1. UPDATE THE ASSEMBLY JCL CALLED ZTPPASM TO REFLECT LIBRARIES AT
YOUR INSTALLATION.
2. SAMPLE EXECUTION JCL IS IN ZTPP210J.
________________________________________________________________________
SASTSOMN -  SAS PROGRAM TO PRINT TSOMON'S RECORDING OF COMMANDS ON
TSO.

./ ADD NAME=AUTOWTOJ
//MURFAUTO JOB (6496,B014),MURF,CLASS=T,MSGCLASS=T,NOTIFY=MURF
//*  JCL TO INSTALL AN MPF EXIT
//*
//*  CHANGE SYSLIB ACCORDING TO YOUR IPORES
//*  CHANGE SYSLIB AND SYLMOD IN LKED STEP TO LINK LIST LIBRARY
//*
//COM     EXEC PGM=IEV90,REGION=512K,
//    PARM='LOAD,XREF(SHORT),LINECNT=55,NODECK,RENT'
//*
//SYSLIB   DD  DISP=SHR,DSN=SYS1.MACLIB,DCB=BLKSIZE=23440
//         DD  DISP=SHR,DSN=SYS1.AMODGEN
//SYSLIN   DD  UNIT=VIO,DSN=&LOADSET,DISP=(MOD,PASS),
//             SPACE=(CYL,(2,2)),DCB=BLKSIZE=1680
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(10,2))
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,(12,2))
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,(20,2))
//SYSPUNCH DD  DUMMY =*,DCB=FUNC=I
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSIN    DD  DSN=MURF.SHARE.LIBRARY(AUTOWTOR),DISP=SHR
//*
//LKED         EXEC PGM=IEWL,REGION=1024K,COND=(4,LT),
//             PARM='XREF,LET,LIST,RENT,REUS,AC=1'
//SYSPRINT     DD   SYSOUT=*
//SYSUT1       DD   DSN=&SYSUT1,UNIT=SYSDA,SPACE=(CYL,(1,1))
//SYSLMOD      DD   DISP=SHR,DSN=SYS1.LINKLIB(AUTOWTOR)
//SYSLIN       DD   UNIT=SYSDA,DSN=&LOADSET,DISP=(OLD,DELETE)
//             DD   DDNAME=SYSIN
//SYSIN        DD   *
 NAME AUTOWTOR(R)
./ ADD NAME=AUTOWTOR
AUTOWTOR TITLE '***** AUTOMATIC REPLY TO WTORS *****'
***********************************************************************
*   TITLE: AUTOWTOR                                                   *
*                                                                     *
*   AUTHOR: MURPHY                                                    *
*                                                                     *
*   DATE-WRITTEN: 12/17/85                                            *
*                                                                     *
*   REMARKS:                                                          *
*                                                                     *
*        AUTOMATICALLY GIVE REPLY OF M TO MESSAGE IEC701D. IT WORKS   *
*   WELL FOR CARTRIDGES - THE EXIT GIVES THE SYSTEM A U AND THE       *
*   3480 WILL HAVE THE CARTRIDGE NUMBER FOR THE OPERATOR TO INSERT.   *
*   IEC701D,SUP(NO),USEREXIT(AUTOWTOR) NEED TO GO IN MPF MEMBER IN    *
*   SYS1.PARMLIB, THEN USE SET MPF=XX WHATEVER MEMBER YOU SET IT TO.  *
*   SEE MPFLST03 FOR EXAMPLE.                                         *
*                                                                     *
***********************************************************************
AUTOWTOR CSECT
AUTOWTOR AMODE 31
AUTOWTOR RMODE ANY
CTXTPTR  EQU   5
         BEGIN PROGRAM=AUTOWTOR
*        SAVES REGISTERS AND INSERTS PROGRAM, DATE, AND TIME
         LR    R12,R15            LOAD ADDRESS OF ENTRY POINT
         USING AUTOWTOR,R12
         LR    R9,R1
         L     R5,0(,R1)
         USING CTXT,R5            ADDRESSING CTXT
         CLC   0(2,R5),=C'CT'
         BNE   RETURN
         GETMAIN RU,LV=WORKL,LOC=BELOW,SP=229
         LR    R3,R1              ADDRESS OF WORK AREA/SAVEAREA
         USING SAVDSECT,R3        ADDRESSABILITY
         ST    R13,SAVEAREA+4     STORE CALLER SAVEAREA ADDRESS (HSA)
         ST    R3,8(,R13)         ADD OF PROGRAM SAVE IN CALLER(LSA)
         LR    R13,R3             ADDRESS OF SAVEAREA IN R13
         L     R2,CTXTTXPJ
         USING CTXTATTR,R2        MSG ATTRIBUTES
         LA    R4,CTXTTMSG        ADDRESS OF TEXT AREA
         USING MSGTEXT,R4
         MVC   WTOEXEC,WTOLIST
         MVC   WTOEXEC+24(8),MSGID   JOB NAME
         XC    MGCRPL(MGCRLTH),MGCRPL  CLEAR PARAMETER LIST
         MVC   MGCRTEXT(L'TXTINSRT),TXTINSRT MOVE IN REPLY BUFFER
         MVC   REPLY,CTXTRPID     INSERT REPLY ID
         LA    R1,(MGCRTEXT-MGCRPL)+L'TXTINSRT  GET MGCRPL LENGTH
         STC   R1,MGCRLGTH        SAVE LENGTH IN MGCRPL
         SR    R0,R0
         MGCR  MGCRPL
         DROP  R2,R4
         WTO   MF=(E,WTOEXEC)
FREERET  L     R13,4(,R13)        ADDRESS OF CALLING PROGRAM SAVEAREA
         FREEMAIN RU,LV=WORKL,A=(3),SP=229
RETURN   SR    R15,R15
         RETURN (14,12),,RC=(15)
TXTINSRT DC    CL11'REPLY XX,M '  REPLY
WTOLIST  WTO   'AUTOWTOR REPLIED TO JOBNAME   - AS SELECTED BY MPF',   X
               ROUTCDE=11,MF=L
CNCLMSG  EQU   *-WTOLIST
SAVDSECT DSECT
SAVEAREA DS    18F
         DS    0F
WTOEXEC  DS    CL(CNCLMSG)
MGCR     IEZMGCR DSECT=NO
         ORG   MGCRTEXT
COMMAND  DS    CL6
REPLY    DS    CL2
REPLYMSG DS    CL3
         ORG
WORKL    EQU   *-SAVEAREA
MSGTEXT  DSECT
MSGID    DS    CL8
JOBDATA  DS    CL8
         ORG   MSGTEXT
         DS    CL4
WTORID   DS    CL8
CTXTATTR DSECT
         DS    CL6
CTXTTMSG DS    CL126
CTXT     DSECT
         DS    CL8
CTXTTXPJ DS    CL4          POINTER TO MAJOR LINE TEXT
CTXTTXPN DS    CL4          POINTER TO MINOR LINE TEXT
         DS    CL8
CTXTRPID DS    CL2          REPLY ID
         END
./ ADD NAME=CONSOLE
         TITLE 'CONSOLE DISPLAY'
*******************************************************************     DOC FILE
*                                                                 *     DOC FILE
*            D I S C L A I M E R    S E C T I O N                 *     DOC FILE
*                                                                 *     DOC FILE
*******************************************************************     DOC FILE
*                                                                 *     DOC FILE
* THIS MATERIAL HAS BEEN USED SUCCESSFULLY & TO THE BEST OF OUR   *     DOC FILE
* KNOWLEDGE  THEY  ARE  OPERATIONAL, HOWEVER  NO  WARRANTY        *     DOC FILE
* IS MADE TO THE ACCURACY OF THE PROGRAMS OR RELATED MATERIAL AND *     DOC FILE
* NO RESPONSIBILITY IS ASSUMED  FOR ANY MODIFICATION  DIRECTLY OR *     DOC FILE
* INDIRECTLY  CAUSED BY  THEIR USE.  IT IS THE USERS              *     DOC FILE
* RESPONSIBILITY  TO  EVALUATE THE  USEFULLNESS  OF THE  MATERIAL *     DOC FILE
* SUPPLIED .                                                      *     DOC FILE
*                                                                 *     DOC FILE
* WE DO NOT GUARANTEE TO  KEEP ANY  MATERIAL PROVIDED  UP TO DATE *     DOC FILE
* NOR DO WE GUARANTEE TO  PROVIDE ANY  CORRECTIONS OR  EXTENSIONS *     DOC FILE
* DESCRIBED BY THE USER OR  CORRECTIONS OR EXTENSIONS MADE IN THE *     DOC FILE
* FUTURE .                                                        *     DOC FILE
*                                                                 *     DOC FILE
*******************************************************************     DOC FILE
***********************************************************************
*                                                                     *
*                                                                     *
*                                                                     *
*        DISPLAY MVS CONSOLE DISPLAY WITH AUTOMATIC REFRESH OF SCREEN *
*        TO PRESENT A CONSOLE APPEARANCE.                             *
*                                                                     *
*        USED THE BASIC CROSS MEMORY CONSOLE BUFFER READ FROM THE     *
*        CDF PROGRAM ON THE SHARE TAPE, AND MODIFIED TO A COMMAND     *
*        PROCESSOR WITH AUTO UPDATE/HIGHLIGHTED MESSAGES.             *
*               PAT MURPHY - TEXAS UTILITIES SERVICES 214-289-5591    *
*                                                                     *
***********************************************************************
CONSOLE CSECT
         BEGIN PROGRAM=CONSOLE
         LR    R12,R15
         USING CONSOLE,R12
         LR    R2,R1
         GETMAIN R,LV=WORKLENG
         LR    R3,R1
         ST    R13,4(R3)      SAVE THE CALLER'S R13
         ST    R3,8(,R13)
         LR    R13,R3
         USING WORKAREA,R13
         ST    R2,SAVECPPL
         USING CPPL,R2
         L     R6,CPPLPSCB
         DROP  R2
         USING PSCB,R6
         MVC   USERID,PSCBUSER
         DROP  R6
         MVI   BLANKS,X'40'
         MVC   BLANKS+1(79),BLANKS
         MVI   USERFLAG,X'00'
         MVI   CNSLFLAG,X'00'
         MVI   THRUFLAG,X'00'
         MVC   CMDLINE,BLANKS
         LA    R7,TABLEND
         LA    R6,4
         LA    R5,TABLE
TBLOOP   CLC   0(4,R5),USERID
         BE    USEROK
         BXLE  R5,R6,TBLOOP
*        B     NOAUTH
*SEROK   MVI   USERFLAG,X'FF'
USEROK   EQU   *
VEROK    DELETE EP=IKJEFFUT
         MVI   AUTOFLAG,X'00' AUTO MODE FLAG
         MVI   RESHOWFL,X'00' RESHOW INDICATOR
         MVI   MOD5FLAG,X'00' FLAG FOR MOD 5
         MVI   SCREEN,X'03' WCC
         MVC   CLEAR(17),CLR CLEAR SCREEN CONTROL CHARS
         GTSIZE ,                 TERMINAL CHARACTERISTICS
         LTR   R0,R0              DISPLAY DEVICE?
         BZ    FREESKIP           YES, GO FREE AND RETURN
         CH    R1,EIGHTY          80 CHAR LINES
         BNE   CHEKM5             NO, SET MODE 2
         CH    R0,FORTY3          MOD 4?
         BE    SETM4              YES, BRANCH
         CH    R0,THIRTY2         MOD 3?
         BE    SETM3              YES, BRANCH
SETM2    STSIZE SIZE=80,LINE=24   SET MODEL 2
         LTR   R15,R15            ZERO RET CODE
         BNZ   FREESKIP           NO, RETURN
         LA    R3,24              22 LINES PER SCREEN
         MVC   CURSOR,=X'5CF0'    ROW 24 COL 2
         MVC   ENDOFSCR,=X'5D7F'    ROW 24 COL 80
         MVC   TPUTLEN,=AL4(24*84+1) LENGTH OF TPUT
         B     PROCESS
CHEKM5   CH    R0,=H'27'          27 LINES?
         BNE   SETM2
         CH    R1,=H'132'         132 WIDTH?
         BNE   SETM2
SETM5    LA    R3,27              27 LINES PER SCREEN
         MVI   CLEAR,X'7E'
         MVI   MOD5FLAG,X'FF'
         MVC   TPUTLEN,=AL4(27*84+1) LENGTH OF TPUT
         MVC   ENDOFSCR,=X'F76B'  ROW 27 COL 132
         MVC   CURSOR,=X'F5E8'    ROW 27 COL 2 IC
         B     PROCESS
SETM3    LA    R3,32              22 LINES PER SCREEN
         MVC   TPUTLEN,=AL4(32*84+1) LENGTH OF TPUT
         MVC   ENDOFSCR,=X'E77E'  ROW 32 COL 80
         MVC   CURSOR,=X'E6F0'    ROW 32 COL 2 IC
         B     PROCESS
SETM4    LA    R3,43              22 LINES PER SCREEN
         MVC   TPUTLEN,=AL4(43*84+1) LENGTH OF TPUT
PROCESS  ST    R3,NUMLINES
         MVI   HELPFLAG,X'00'
         MVI   CMDFLAG,X'00'
         LA    R1,16
         L     R1,0(R1)
         USING CVT,R1
         L     R1,CVTASVT
         DROP  R1
         USING ASVT,R1
         L     R5,ASVTMAXU
         LA    R15,ASVTENTY-4
ASVTLOOP BCTR  R5,0
         LTR   R5,R5
         BZ    CONABEND
         LA    R15,4(,R15)
         ICM   R6,15,0(R15)
         BM    ASVTLOOP
         USING ASCB,R6
         ICM   R7,15,ASCBJBNS
         BZ    ASVTLOOP
         CLC   =C'CONSOLE',0(R7)
         BNE   ASVTLOOP
         SR    R1,R1
         LH    R1,ASCBASID
         DROP  R1,R6
*        TM    CVTDCB,CVTMVSE
*        BZ    LOAD5
*        DROP  R1
*        LA    R1,7
STORECON ST    R1,CONSASID
         BAL   R3,AUTHRIZ
         AXRES AXLIST=AXLIST      RESERVE AN AX
         L     R1,CONSASID        'CONSOLE' ASID
         AXEXT ASID=(1)           EXTRACT AX OF 'CONSOLE'IN R0
         AXSET AX=(0)             SET OUR AX TO THAT OF CONSOLE
         BAL   R3,UNAUTH
         B     SHOWCONS
SHOWRTRN DS    0H
FREESKIP LR    R3,R13
         L     R13,SAVEAREA+4 RESTORE THE CALLER'S R13
         FREEMAIN RC,A=(3),LV=WORKLENG
         SR    R15,R15
         RETURN (14,12),RC=(15)
LOAD5    LA    R1,5
         B     STORECON
SHOWCONS DS    0H
         STFSMODE ON,INITIAL=YES  FULL SCREEN MODE ON
         TPUT  CLEAR,17,FULLSCR
*---------------------------------------------------------------------*
*          BUILD A TABLE OF UCM ADDRESSES (ONE PER CONSOLE)           *
*---------------------------------------------------------------------*
BLDUCMS  L     R4,16              R4 = ADDR OF CVT
         USING CVT,R4
         L     R4,CVTCUCB         R4 = ADDR OF 'CUCB' (UCM BASE)
         DROP  R4
         USING UCM,R4
         L     R5,UCMVEA          R5 = ADDR OF FIRST UCM ENTRY
         L     R6,UCMVEZ          R6 = LENGTH OF EACH UCM ENTRY
         L     R7,UCMVEL          R7 = ADDR OF LAST UCM ENTRY
         LA    R8,UCMTAB+4        R8 = ADDR OF UCMTAB
         LA    R9,UCMTABE         R9 = ADDR OF END OF UCMTAB
         XR    R2,R2              R2 = 0 (NUMBER OF VALID UCMS)
UCMLOOP  ST    R5,0(0,R8)         SAVE UCM ADDRESS IN UCMTAB
         LA    R2,1(0,R2)         R2  = R2  + 1  (ONE MORE UCM)
         LA    R8,4(0,R8)         R8 = ADDR OF NEXT UCMTAB ENTRY
         CR    R8,R9              DOES R8 POINT PAST END OF UCMTAB?
         BNL   UCMDONE            YES; LEAVE LOOP
         AR    R5,R6              R5 = ADDR OF NEXT UCM ENTRY
         CR    R5,R7              DOES R5 POINT PAST UCM ENTRIES?
         BL    UCMLOOP            NOPE; KEEP GOING
UCMDONE  STH   R2,NUMUCMS         SAVE NUMBER OF UCMS FOUND
         CLI   CNSLFLAG,X'FF'
         BNE   SETMAST
         MVC   OLDCONS,CONSOL
         L     R4,CONSOL
         LA    R4,1(,R4)
         B     MASTSCAN
         DROP  R4
*---------------------------------------------------------------------*
*        SCAN THE UCM FOR THE MASTER CONSOLE AS THE DEFAULT           *
*        CONSOLE WHEN ENTERING THE "JESOPER" COMMAND.                 *
*---------------------------------------------------------------------*
SETMAST  SR    R4,R4
         ST    R4,CONSOL
MASTSCAN LA    R5,UCMTAB          SET POINTER TO UCM ADDRESS TABLE
CKNUMUCM CH    R4,NUMUCMS         IS NUMBER TOO HIGH?
         BNH   MASTCONT           NO, CONTINUE
         CLI   CNSLFLAG,X'FF'
         BNE   CONABEND
         CLI   THRUFLAG,X'FF'
         BE    CONABEND
         MVI   THRUFLAG,X'FF'
         SR    R4,R4              START W/ FIRST ENTRY
         B     MASTCONT
CONABEND ABEND 1
MASTCONT SLL   R4,2               MAKE CONSOLE NUMBER TABLE INDEX
         LA    R5,0(R5,R4)        SET POINTER TO UCM ADDRESS SLOT
         L     R5,0(0,R5)         SET POINTER TO UCM
         LTR   R5,R5
         BZ    NEXT
         USING UCMLIST,R5         TELL ASSEMBLER ABOUT UCM
         CLI   CNSLFLAG,X'FF'
         BE    SKIPMSTR
         TM    UCMDISP1,UCMDISPA  IS THIS A MASTER CONSOLE?
         BNZ   ACTIVCHK           YES ? FOUND THE MASTER CONSOLE ..
         B     NEXT
SKIPMSTR TM    UCMDISP1,UCMDISPC  GRAPHICS
         BZ    NEXT
ACTIVCHK TM    UCMATR,UCMUF       ACTIVE?
         BNZ   MASTFND
NEXT     SRL   R4,2               RESET CONSOLE NUMBER TO RELATIVE
         LA    R4,1(0,R4)         SET POINTER TO NEXT CONSOLE
         B     MASTSCAN           CONTINUE MASTER CONSOLE SCAN LOOP
MASTFND  SRL   R4,2               RESET CONSOLE NUMBER TO RELATIVE
         ST    R4,CONSOL          SET VALID CONSOLE NUMBER (MASTER)
         DROP  R5                 DONT NEED UCM ADDRESSABILITY NOW
NEXTPAGE LA    R5,UCMTAB          R5 = ADDR OF UCMTAB
         ICM   R4,15,CONSOL       R4 = CONSOLE TO BE DISPLAYED
         BZ    WRTERR4            WE HAVE NO CONSOLE ZERO (MASTER)
         CH    R4,NUMUCMS         IS NUMBER TOO HIGH?
         BNH   GETUCM             NO, CONTINUE
RESETCN  L     R4,OLDCONS         RESET TO OLD CONSOLE
         ST    R4,CONSOL          AND SAVE IT
GETUCM   SLL   R4,2               MULTIPLY BY 4
         LA    R5,0(R5,R4)        R5 = ADDR OF ADDR OF UCM
         L     R5,0(0,R5)         R5 = ADDR OF UCM
         USING UCMLIST,R5
         L     R6,UCMXB           R6 = ADDR OF RDCM
         ST    R6,UCMTABX
         USING IEERDCM,R6
         LTR   R6,R6              IS THIS A GRAPHICS CONSOLE?
         BP    GRAPHICS           YES
         LA    R5,UCMTAB          R5 = ADDR OF UCMTAB
WRTERR4  DS    0H
         B     RESETCN            RESET THE CONSOLE NUMBER
GRAPHICS EQU   *
AUTHDONE EQU   *
         MVC   OLDCONS,CONSOL
         MVC   HEADING,HEADING1
         MVI   CNSLFLAG,X'00'
         L     R6,UCMTABX
         L     R7,DCMADTRN        GET ADDRESS OF TDCM
         USING STRTDCM,R7
         BAL   R3,AUTHRIZ
         L     R1,CONSASID        'CONSOLE' ASID IS 5 370/ 6 XA
         SSAR  R1                 SET 'CONSOLE' AS SECONDARY
         PRINT ON,GEN
         SLR   R0,R0              SECONDARY KEY
         LA    R1,L'LASTLINE      TRUE LENGTH
         MVCP  LASTLINE(R1),DCMINPUT-STRTDCM(R7),R0
         LA    R1,L'SIBPTR
         SLR   R0,R0              SET STORAGE KEY
         MVCP  SIBPTR(R1),DCMASCRN-STRTDCM(R7),R0 PT TO SCRN ADRJPB
         LA    R1,2
         MVCP  HEADING+8(R1),DCMDEL-STRTDCM(R7),R0   ROLL DELETE VAL
         MVCP  RTME(R1),DCMRTME-STRTDCM(R7),R0       RTME
         MVCP  RNUM(R1),DCMDL-STRTDCM(R7),R0       RTME
         LA    R1,4
         MVCP  CONL(R1),DCMLSCRN-STRTDCM(R7),R0
         L     R8,SIBPTR          R8 = ADDR OF SCREEN IMAGE
         L     R5,CONL
         SR    R4,R4
         SR    R5,R8
         LA    R5,84(,R5)
         ST    R5,CONL            SAVE IT
         LA    R4,SCREEN          MY BUF
         LA    R4,3737(,R4)
         LR    R9,R5              BUFFER LEN
MOVEBUFF DS    0H
         SH    R8,=H'6'
         SLR   R0,R0             RESET THE KEY
MVCPLOOP DS    0H
         MVCP  0(R5,R4),0(R8),R0 LOOP THRU THE CONSOLE BUFFER
         BZ    GOTITALL
         AL    R8,=F'256'        MAX LEN ALLOWED
         AL    R4,=F'256'        MAX LEN ALLOWED
         SL    R5,=F'256'        MAX LEN ALLOWED
         B     MVCPLOOP
*---------------------------------------------------------------------*
*        IN ORDER TO ISSUE SVCS THE PRIMARY AND                       *
*        SECONDARY ADDRSPC MUST BE THE SAME                           *
*---------------------------------------------------------------------*
GOTITALL DS    0H
         EPAR  R1                EXTRACT PRIMARY ASN
         SSAR  R1
         BAL   R3,UNAUTH
         DROP  R5,R6,R7
         LA    R3,SCREEN         SET POINTER TO FIRST LINE OF BUF
         LA    R3,3737(,R3)
         LA    R9,HEADING+10
         CLI   HEADING+9,C' '
         BNE   RDMODE
         LA    R9,HEADING+9
RDMODE   MVC   0(6,R9),RTMEC
         SR    R5,R5
         LH    R5,RTME
         CVD   R5,DOUBLWD
         MVC   WORKLINE(5),PATTERN1
         ED    WORKLINE(5),DOUBLWD+5
         MVC   6(3,R9),WORKLINE+2
         MVC   09(6,R9),RNUMC
         SR    R5,R5
         IC    R5,RNUM+1
         CVD   R5,DOUBLWD
         MVC   WORKLINE(5),PATTERN1
         ED    WORKLINE(5),DOUBLWD+5
         MVC   15(3,R9),WORKLINE+2
         TIME  DEC
         ST    R0,WORK
         MVI   WORK+3,X'0C'
         UNPK  DOUBLWD(7),WORK(4)
         LA    R9,HEADING+36
         MVC   0(2,R9),DOUBLWD
         MVC   3(2,R9),DOUBLWD+2
         MVC   6(2,R9),DOUBLWD+4
FIRSTL   L     R9,NUMLINES       NUMBER OF LINES ON PROG TERMINAL
         L     R5,CONL
         SR    R4,R4
         LA    R1,80
         DR    R4,R1
         ST    R5,CONL
         CR    R9,R5
         BNL   FIRSTL1
         SR    R5,R9
         L     R1,CONL
         SR    R4,R4
         LA    R5,2(,R5)
         SR    R1,R5
         ST    R1,CONL
         LA    R1,84
         MR    R4,R1
         LA    R3,0(R5,R3)
FIRSTL1  LA    R5,SCREEN+1            ADDRESS OF FIRST LINE
         LA    R6,PAGEDEF             LINES TO BE DISPLAYED
         CLI   MOD5FLAG,X'FF'         MOD 5?
         BNE   NOTMOD5
         LA    R6,PAGEDEF5
NOTMOD5  L     R1,CONL
         SR    R9,R1
         SR    R10,R10
         BCTR  R9,0                   MINUS ONE
         MVC   0(5,R5),0(R6)          CONTROL CHAR
         MVC   5(79,R5),HEADING       HEADING
         SR    R15,R15
         IC    R15,CONSOL+3
         SRL   R15,4                  ONLY WANT LEFT BYTE
         C     R15,TEN
         BL    NUMERIC1
         O     R15,CHAROR
         B     SECONDCK
NUMERIC1 O     R15,NUMBEROR
SECONDCK STC   R15,78(R5)
         IC    R15,CONSOL+3
         SLL   R15,28                 ONLY WANT LEFT BYTE
         SRL   R15,28
         C     R15,TEN
         BL    NUMERIC2
         O     R15,CHAROR
         B     STORECHR
NUMERIC2 O     R15,NUMBEROR
STORECHR STC   R15,79(R5)
         LA    R5,84(,R5)             INCREMENT
         LA    R10,85(,R10)
         LA    R6,5(,R6)              INCREMENT
         BCTR  R1,0
         CLI   HELPFLAG,X'FF'         HELP?
         BNE   MOVESTUP
         L     R9,NUMLINES
         S     R9,=F'07'
         MVC   0(5,R5),0(R6)
         MVC   5(79,R5),BLANKS
         LA    R5,84(,R5)             INCREMENT
         LA    R6,05(,R6)             INCREMENT
         MVC   0(5,R5),0(R6)
         LA    R1,HEADING1
         MVC   5(79,R5),80(R1)
         LA    R5,84(,R5)             INCREMENT
         LA    R6,5(,R6)              INCREMENT
         MVC   0(5,R5),0(R6)
         LA    R1,80(,R1)
         MVC   5(79,R5),80(R1)
         LA    R5,84(,R5)             INCREMENT
         LA    R6,5(,R6)              INCREMENT
         MVC   0(5,R5),0(R6)
         MVC   5(79,R5),160(R1)
         LA    R5,84(,R5)             INCREMENT
         LA    R6,5(,R6)              INCREMENT
         MVC   0(5,R5),0(R6)
         MVC   5(79,R5),240(R1)
         LA    R5,84(,R5)             INCREMENT
         LA    R6,5(,R6)              INCREMENT
         LA    R10,420(,R10)
         B     SPACLOOP
MOVESTUP LR    R15,R5
MOVELOOP CLI   CLRFLAG,X'FF'
         BE    MVIT
         CLC   5(74,R15),9(R3)        HAS THIS LINE CHANGED?
         BNE   MVIT
         CLC   4(1,R15),4(R3)         ATTRIBUTE BYTE CHANGED?
         BE    SKPMV                  NO NEED SENDING DOWN THE LINE
MVIT     MVC   0(4,R5),0(R6)          LINE ADDRESS
         MVC   4(1,R5),4(R3)          ATTRIBUTE BYTE
         MVC   5(79,R5),9(R3)         MOVE LINE OF PRINT
         MVC   80(4,R5),BLANKS
         LA    R5,84(,R5)
         LA    R10,84(,R10)
SKPMV    LA    R6,05(,R6)             INCREMENT
         LA    R3,84(,R3)             INCREMENT
         LA    R15,84(,R15)
         MVI   CLRFLAG,X'FF'          SCREEN HAS CHANGED FROM HERE DOWN
         BCT   R1,MOVELOOP            LOOP
         MVI   CLRFLAG,X'00'
SPACLOOP LA    R6,05(,R6)             INCREMENT
         BCTR  R9,0
         C     R9,=F'0'
         BH    SPACLOOP
         MVC   0(5,R5),0(R6)          LINE ADDRESS
         MVI   4(R5),X'C9'            ATTRIBUTE
         MVI   5(R5),X'13'            INSERT CURSOR
         CLI   HELPFLAG,X'FF'
         BE    GOAHEAD2
         CLI   IPLFLAG,X'FF'
         BE    GOAHEAD2
         CLI   AUTOFLAG,X'FF'
         BE    AUTOROLL
GOAHEAD  CLI   RESHOWFL,X'FF'
         BNE   GOAHEAD2
         MVI   RESHOWFL,X'00'
         MVC   6(72,R5),CMDLINE+4
         B     GOAHEAD3
GOAHEAD2 MVC   6(79,R5),BLANKS        LAST LINE IS INPUT LINE
GOAHEAD3 MVI   CMDFLAG,X'00'
         LA    R10,84(,R10)
         LR    R0,R10
         LA    R1,SCREEN              ADDRESS OF SCREEN
         TPUT  (1),(0),FULLSCR        TPUT
         MVC   REPLY,BLANKS           CLEAR
TGET1    TGET  REPLY,84,ASIS,WAIT     INPUT
         MVI   HELPFLAG,X'00'
         B     CHEKOUT
AUTOROLL EQU   *
*        L     R0,TPUTLEN             LENGTH OF TPUT
         LA    R1,SCREEN              ADDRESS OF SCREEN
         CLI   RESHOWFL,X'FF'
         BNE   GOAHEAD5
         MVI   RESHOWFL,X'00'
         MVC   6(72,R5),CMDLINE+4
         MVC   REPLY,BLANKS
         LA    R10,72(,R10)
         B     GOAHEAD5
*OAHEAD4 S     R0,=F'79'
GOAHEAD5 CLI   CMDFLAG,X'FF'
         BNE   AUTOTPUT
         MVC   0(5,R5),0(R6)          LINE ADDRESS
         MVI   4(R5),X'C9'            ATTRIBUTE
         MVI   5(R5),X'13'            INSERT CURSOR
         MVI   CMDFLAG,X'00'
AUTOTPUT LA    R0,5(,R10)
*        LR    R0,R10
         TPUT  (1),(0),FULLSCR
         STIMER WAIT,BINTVL=TIMER
         TGET  REPLY,70,ASIS,NOWAIT
CHEKOUT  CLI   REPLY,X'7D'
         BE    GOTSTUFF
         NI    REPLY,X'0F'
         CLI   REPLY,X'01'
         BE    HELP
         CLI   REPLY,X'02'
         BE    AUTOSTOP
         CLI   REPLY,X'03'
         BE    SHOWRTRN
         CLI   REPLY,X'04'
         BE    AUTOON
         CLI   REPLY,X'05'
         BE    CNSLSW
         CLI   REPLY,X'06'
         BE    RESHOW
         CLI   REPLY,X'07'
         BE    MTT
         CLI   REPLY,X'08'
         BE    AUTO10
         CLI   REPLY,X'09'
         BE    AUTO2
         CLI   REPLY,X'0A'
         BE    OMON
         CLI   REPLY,X'0B'
         BE    AUTO4
         CLI   REPLY,X'0C'
         BE    IPLINFO
NOTIFY   MVI   CLRFLAG,X'FF'
         MVI   CMDFLAG,X'FF'
         B     AUTHDONE
CNSLSW   MVI   CNSLFLAG,X'FF'
         MVI   REPLY,X'00'
         MVI   THRUFLAG,X'00'
         MVI   CLRFLAG,X'FF'
         B     SHOWCONS
RESHOW   MVI   RESHOWFL,X'FF'
         B     AUTHDONE
IPLINFO  MVC   WORKLINE,BLANKS
         MVC   WORKLINE+10(50),MESSAGE
         LA    R1,16              HEX 10
         L     R2,0(R1)           ADDRESS OV CVT
         USING CVT,R2
         L     R3,CVTSMCA         ADDRESS OF SMF CONTROL AREA
         L     R1,CVTSYSAD
         MVC   WORKLINE+72(3),13(1)
         MVC   WORKLINE+65(7),=C'SYSRES='
         USING SMCABASE,R3
         MVC   IPLDATE,SMCAIDTE   IPL DATE
         MVC   IPLTIME,SMCAITME   IPL TIME
         DROP  R3
         L     R3,CVTASMVT
         TM    1(R3),X'08'     CLPA?
         BNZ   NOCLPA             1 MEANS A QUICK START - NO CLPA WAS
         MVC   WORKLINE+57(3),=C'YES'
         B     DATEEDIT
NOCLPA   MVC   WORKLINE+57(3),=C'NO '
DATEEDIT MVC   WORKLINE+31(5),PATTERN1
         ED    WORKLINE+31(5),IPLDATE+1 MAKE PRINTABLE
         DROP  R2
         L     R6,IPLTIME
         SRDA  R6,32(0)
         L     R3,THREE60
         DR    R6,R3
         CVD   R7,DOUBLWD
         MVC   WORK(4),=X'40212020'
         ED    WORK(4),DOUBLWD+6
         MVC   WORKLINE+43(2),WORK+2
         SRDA  R6,32              SHIFT REMAINDER
         L     R3,SIXTY
         DR    R6,R3
         CVD   R7,DOUBLWD
         MVC   WORK(4),=X'F0212020'
         ED    WORK(4),DOUBLWD+6
         MVC   WORKLINE+46(2),WORK+2
         LA    R5,SCREEN+1            ADDRESS OF FIRST LINE
         LA    R6,PAGEDEF             LINES TO BE DISPLAYED
         LA    R10,85
         CLI   MOD5FLAG,X'FF'
         BNE   NONMOD5
         LA    R6,PAGEDEF5
NONMOD5  L     R9,NUMLINES
         BCTR  R9,0
         MVC   0(5,R5),0(R6)
         MVC   5(79,R5),WORKLINE
         LA    R5,84(,R5)             INCREMENT
         LA    R6,05(,R6)             INCREMENT
         BCTR  R9,0
         TPUT  CLEAR,17,FULLSCR
         MVI   IPLFLAG,X'FF'
         TCLEARQ INPUT
         B     SPACLOOP
MTT      L     R1,SAVECPPL
         LINK  EP=ZTPR0205
         TPUT  CLEAR,17,FULLSCR
         MVI   AUTOFLAG,X'00'
         MVI   CLRFLAG,X'FF'
         B     AUTHDONE
OMON     L     R1,SAVECPPL
         LINK  EP=RMFMON
         TPUT  CLEAR,17,FULLSCR
         MVI   AUTOFLAG,X'00'
         MVI   CLRFLAG,X'FF'
         B     AUTHDONE
HELP     MVI   HELPFLAG,X'FF'
         MVI   AUTOFLAG,X'00'
         TPUT  CLEAR,17,FULLSCR
         MVI   CLRFLAG,X'FF'
         TCLEARQ INPUT
         B     FIRSTL
AUTOON   MVC   TIMER,ONE
         B     AUTOSET
AUTO2    MVC   TIMER,THREE
         B     AUTOSET
AUTO4    MVC   TIMER,FIVE
AUTOSET  MVI   AUTOFLAG,X'FF'
         MVC   5(72,R5),BLANKS
         MVI   REPLY,X'00'
         B     AUTHDONE
AUTO10   MVC   TIMER,=F'990'            APP 10 SECS
         B     AUTOSET
AUTOSTOP MVI   AUTOFLAG,X'00'
         B     AUTHDONE
GOTSTUFF DS    0H
         CLI   REPLY+6,C'>'        IS IT NOTIFY MESSAGE?
         BE    NOTIFY              THEN EXIT
         OC    REPLY+6(74),BLANKS  ALL INPUT UPPER CASE
         CLC   REPLY+6(70),BLANKS  COMMAND AREA IS SPACES?
         BE    AUTHDONE            THEN A COMMAND WAS NOT ENTERED
         MVC   CMDLINE+4(72),REPLY+6
         MVC   CMDLINE(4),CMDFMT
         MVC   REPLY,BLANKS
         CLI   CMDLINE+4,C'Z'      IS IT END,
         BE    SHOWRTRN            THEN EXIT
         CLI   CMDLINE+4,C'X'      IS IT END,
         BE    SHOWRTRN            THEN EXIT
         CLC   CMDLINE+4(3),=C'END' IS IT END,
         BE    SHOWRTRN             THEN EXIT
GOTCMD   TPUT  CLEAR,17,FULLSCR
         MVI   CLRFLAG,X'FF'
         CLI   USERFLAG,X'FF'
         BNE   NOWTO
         MVC   WTOCMD(100),WTOLIST
         MVC   WTOCMD+8(72),CMDLINE+4
         MVC   WTOCMD+78(4),USERID
         LA    R7,WTOCMD
         WTL   MF=(E,(R7))
NOWTO    BAL   R3,AUTHRIZ
         SLR   R0,0                 CLEAR REG 0
         L     R0,CONSOL
ISSUE    LA    R1,CMDLINE          GET ADDRESS OF COMMAND I SMF
         SVC   34                  ISSUE COMMAND VIA SVC 34
         STIMER WAIT,BINTVL=ONE
         BAL   R3,UNAUTH
         MVI   CMDFLAG,X'FF'
         B     AUTHDONE
NOAUTH   DELETE EP=IKJEFFUT
         TPUT  MSGNO1,13
         B     SHOWRTRN
AUTHRIZ  STAX  DEFER=YES
         L     R1,AUTH
         LA    R0,1
         SYSDSVC SVC=244
         MODESET MF=(E,SUPRMOD)  GET INTO SUPV STATE AND KEY ZERO
         BR    R3                ****************************
UNAUTH   L     R1,16             *  A                       *
         USING CVT,R1            *   D                      *
         L     R1,CVTTCBP        *    D      J              *
         DROP  R1                *     R      S             *
         L     R1,4(R1)          *      E      C            *
         USING TCB,R1            *       S      B           *
         L     R1,TCBJSCB        *        S                 *
         DROP  R1                ****************************
         NI    236(R1),X'FE'     SET AUTHORIZATION OFF
         MODESET MF=(E,PROBMOD)
         STAX  DEFER=NO
         BR    R3
         EJECT
         LTORG
*---------------------------------------------------------------------*
*                         C O N S T A N T S                           *
*---------------------------------------------------------------------*
CMDFMT   DC    Y(76),Y(00)            LENGTH OF COMMAND
MESSAGE  DC    CL50'LAST SYSTEM IPL DATE XXXXX  TIME HH:MM  CLPA = YN '
PATTERN1 DC    XL5'2120202020'
THREE60  DC    F'360000'
SIXTY    DC    F'6000'
AXLIST   DC    H'1',H'0'           AXRES PARMLIST
         CNOP  0,8
*---------------------------------------------------------------------*
*               327X SCREEN CLEAR CONTROL CHARACTERS                  *
*---------------------------------------------------------------------*
CLR      DC    X'03'              WCC - CLEAR SCREEN
         DC    X'11F56F'          SBA TO ROW 43, COL 80
         DC    X'114040'          SBA TO ROW 1, COL 1
         DC    X'3C404000'        FILL SCREEN WITH NULLS
         DC    X'11F460'          ROW 43 COL 2
         DC    X'1DE913'          SBA TO ROW 1, COL 1 1DC813
ONE      DC    A(140)             1.4 SECOND
FIVE     DC    A(420)             5 SECONDS
THREE    DC    A(220)             3 SECONDS
TEN      DC    F'10'
NUMBEROR DC    XL4'000000F0'
CHAROR   DC    XL4'000000C0'
HEXFS    DC    XL4'FFFFFFFF'
HEXZIP   DC    2F'0000000000000000'
MSGNO1   DC    CL13'SYSTEM ACTIVE'
         DS    0F
WTOLIST  WTL   '                                                       X
                                       CONSOLE',MF=L
         DS    0F
AUTH     DC    CL4'AUTH'
         SPACE 5
SUPRMOD  MODESET KEY=ZERO,MODE=SUP,MF=L
PROBMOD  MODESET KEY=NZERO,MODE=PROB,MF=L
TABLE    DC    CL4'XXXX'          USERIDS
TABLEND  DC    CL4'XXXX'
RTMEC    DC    CL6',RTME='
RNUMC    DC    CL6',RNUM='
FORTY3   DC    H'43'
THIRTY2  DC    H'32'
EIGHTY   DC    H'80'
GETMSG   DC    CL50'CONSOLE-GETMAIN ERROR, PLEASE NOTIFY TECH SUPPORT'
FREEMSG  DC    CL50'CONSOLE-FREEMAIN ERROR,PLEASE NOTIFY TECH SUPPORT'
PAGEDEF  DC    X'1140401DE8'          ROW  1   COL  1
         DC    X'11C1501DC4'          ROW  2   COL  1
         DC    X'11C2601DC4'          ROW  3   COL  1
         DC    X'11C3F01DC4'          ROW  4   COL  1
         DC    X'11C5401DC4'          ROW  5   COL  1
         DC    X'11C6501DC4'          ROW  6   COL  1
         DC    X'11C7601DC4'          ROW  7   COL  1
         DC    X'11C8F01DC4'          ROW  8   COL  1
         DC    X'114A401DC4'          ROW  9   COL  1
         DC    X'114B501DC4'          ROW 10   COL  1
         DC    X'114C601DC4'          ROW 11   COL  1
         DC    X'114DF01DC4'          ROW 12   COL  1
         DC    X'114F401DC4'          ROW 13   COL  1
         DC    X'1150501DC4'          ROW 14   COL  1
         DC    X'11D1601DC4'          ROW 15   COL  1
         DC    X'11D2F01DC4'          ROW 16   COL  1
         DC    X'11D4401DC4'          ROW 17   COL  1
         DC    X'11D5501DC4'          ROW 18   COL  1
         DC    X'11D6601DC4'          ROW 19   COL  1
         DC    X'11D7F01DC4'          ROW 20   COL  1
         DC    X'11D9401DC4'          ROW 21   COL  1
         DC    X'115A501DC4'          ROW 22   COL  1
         DC    X'115B601DC4'          ROW 23   COL  1
         DC    X'115CF01DC4'          ROW 24   COL  1
         DC    X'115E401DC4'          ROW 25   COL  1
         DC    X'115F501DC4'          ROW 26   COL  1
         DC    X'1160601DC4'          ROW 27   COL  1
         DC    X'1161F01DC4'          ROW 28   COL  1
         DC    X'11E3401DC4'          ROW 29   COL  1
         DC    X'11E4501DC4'          ROW 30   COL  1
         DC    X'11E5601DC4'          ROW 31   COL  1
         DC    X'11E6F01DC4'          ROW 32   COL  1
         DC    X'11E8401DC4'          ROW 33   COL  1
         DC    X'11E9501DC4'          ROW 34   COL  1
         DC    X'116A601DC4'          ROW 35   COL  1
         DC    X'116BF01DC4'          ROW 36   COL  1
         DC    X'116D401DC4'          ROW 37   COL  1
         DC    X'116E501DC4'          ROW 38   COL  1
         DC    X'116F601DC4'          ROW 39   COL  1
         DC    X'11F0F01DC4'          ROW 40   COL  1
         DC    X'11F2401DC4'          ROW 41   COL  1
         DC    X'11F3501DC4'          ROW 42   COL  1
         DC    X'11F4601DC8'          ROW 43   COL  1
PAGEDEF5 DC    X'1140401DE8'          ROW  1   COL  1 MODEL 5
         DC    X'11C2C41DE4'          ROW  2   COL  1
         DC    X'11C4C81DE4'          ROW  3   COL  1
         DC    X'11C64C1DE4'          ROW  4   COL  1
         DC    X'11C8501DE4'          ROW  5   COL  1
         DC    X'114AD41DE4'          ROW  6   COL  1
         DC    X'114CD81DE4'          ROW  7   COL  1
         DC    X'114E5C1DE4'          ROW  8   COL  1
         DC    X'1150601DE4'          ROW  9   COL  1
         DC    X'11D2E41DE4'          ROW 10   COL  1
         DC    X'11D4E81DE4'          ROW 11   COL  1
         DC    X'11D66C1DE4'          ROW 12   COL  1
         DC    X'11D8F01DE4'          ROW 13   COL  1
         DC    X'115AF41DE4'          ROW 14   COL  1
         DC    X'115CF81DE4'          ROW 15   COL  1
         DC    X'115E7C1DE4'          ROW 16   COL  1
         DC    X'1161401DE4'          ROW 17   COL  1
         DC    X'11E3C41DE4'          ROW 18   COL  1
         DC    X'11E5C81DE4'          ROW 19   COL  1
         DC    X'11E74C1DE4'          ROW 20   COL  1
         DC    X'11E9501DE4'          ROW 21   COL  1
         DC    X'116BD41DE4'          ROW 22   COL  1
         DC    X'116DD81DE4'          ROW 23   COL  1
         DC    X'116F5C1DE4'          ROW 24   COL  1
         DC    X'11F1601DE4'          ROW 25   COL  1
         DC    X'11F3E41DE4'          ROW 26   COL  1
         DC    X'11F5E81DE4'          ROW 27   COL  1
HEADING1 DC    CL80'K S,DEL=                            99:99:99       X
                             CONSOLE XX    '
HELPMSG1 DC    CL80'PF-1   THIS DISPLAY         PF-2  STOP AUTO UPDATE X
                 PF-3   END                '
HELPMSG2 DC    CL80'PF-4   AUTO UPDATE 1 SEC    PF-5  ALTERNATE CONSOLEX
                 PF-6   RESHOW LAST COMMAND'
HELPMSG3 DC    CL80'PF-7   PAGE THRU MTT        PF-8  AUTO UPDATE 10 SEX
               C PF-9   AUTO UPDATE 4 SEC  '
HELPMSG4 DC    CL80'PF-10  RMFMON               PF-11 AUTO UPDATE 2 SECX
                 PF-12  IPL INFO           '
WORKAREA DSECT
SAVEAREA DS    18F
UCMTABX  DS    F
WORKLINE DS    CL80
REPLY    DS    CL80
BLANKS   DS    CL80
CMDLINE  DS    CL80
HEADING  DS    CL80
SIBPTR   DS    F                   PRT TO SCREEN IMAGE BUFFER
UCMTAB   DS    F
         DS    35F                PROVIDE SPACE FOR 20 UCM ADDRESSES
UCMTABE  EQU   *
NUMUCMS  DS    H
OLDCONS  DS    F                   PREVIOUS CONSOLE NUMBER
         SPACE 5
CLEAR    DS    XL2                WCC - CLEAR SCREEN
ENDOFSCR DS    XL2                SBA TO ROW XX, COL 80
         DS    XL3                SBA TO ROW 1, COL 1
         DS    XL5                FILL SCREEN WITH NULLS
CURSOR   DS    XL2                SBA TO ROW 1, COL 1
         DS    XL3                INSERT CURSOR
LASTLINE DS    CL255' '           OPERATORS COMMAND INPUT LINE
CONNUM   DS    CL2' 1'            CONSOLE NUMBER
CTYPE    DS    CL4' '
MASTER   DS    CL8' '             MASTER CONSOLE
SYS      DS    CL4' '             SYS  AUTHORIZATION
IO       DS    CL4' '             I/O  AUTHORIZATION
CONS     DS    CL5' '             CONS AUTHORIZATION
         DS    CL3' '
*NIT     DS    CL4' '             UNIT ADDR OF CONSOLE
TIME     DS    CL3' '             SECONDS REMAINING ON TIMER
SLASH    DS    CL1'/'
PAUSE    DS    CL3'1.0'           DELAY IN SECONDS
         DS    CL2' '
AREAA    DS    XL1
CNSLFLAG DS    XL1
THRUFLAG DS    XL1
AUTOFLAG DS    XL1
RESHOWFL DS    XL1
HELPFLAG DS    XL1
USERFLAG DS    XL1
CLRFLAG  DS    XL1
IPLFLAG  DS    XL1
MOD5FLAG DS    XL1
CMDFLAG  DS    XL1
CONSOL   DS    F                   CONSOLE TO BE LOOKED AT
CONSASID DS    F                   'CONSOLE' ASID FOR CMS
NUMLINES DS    F
CONL     DS    F
SAVECPPL DS    F
TPUTLEN  DS    F
TIMER    DS    F
RTME     DS    H
RNUM     DS    H
USERID   DS    CL7
TABAREA  DS    CL77
SELCODE  DS    CL3            LINE SELECTION CODE
SELSAVE  DS    CL3            LINE SELECTION CODE SAVE AREA
WORK     DS    D
IPLDATE  DS    F
IPLTIME  DS    F
DOUBLWD  DS    D
WTOCMD   DS    CL104
DCMENTR2 DS    CL74
         DS    0D
SCREEN   DS    XL1       SPACE FOR WCC
         DS    43CL84
         DS    CL124     EXTRA FOR MOD5
BUF      DS    45CL80             OPERATORS SCREEN BUFFER
WORKLENG EQU   *-WORKAREA
         PRINT NOGEN
         TITLE '*** PROTECTED STEP CONTROL BLOCK DSECT ***'
         IKJPSCB                   COPY THE PSCB FORMAT DSECT
         TITLE '*** COMMAND PROCESSOR PARAMETER LIST DSECT ***'
         IKJCPPL                   COMMAND PROCESSOR PARM LIST
         TITLE '*** TSO USER PROFILE TABLE DSECT ***'
         IKJUPT                    TSO USER PROFILE TABLE
         TITLE '*** COMMUNICATION VECTOR TABLE ***'
         CVT   DSECT=YES
         TITLE '*** J S C B ***'
         IEZJSCB
         TITLE '*** T  C  B ***'
         IKJTCB DSECT=YES
         TITLE '*** RDCM DSECT ***'
IEERDCM  DSECT ,
         IEECRDCM
         TITLE '*** TDCM DSECT ***'
IEETDCM  DSECT ,
         IEECDCM
         TITLE '*** MULTIPLE CONSOLE SUPPORT (MCS) UCM PREFIX ***'
         IEECUCM FORMAT=NEW
         IHAASVT
         TITLE '*** ADDRESS SPACE CONTROL BLOCK ***'
         IHAASCB
         TITLE '*** TSB DSECT ***'
         IKJTSB LIST=YES
         TITLE '*** CHAIN     ***'
         IEECHAIN
         IEESMCA
         END
./ ADD NAME=CONSOLEJ
//MURFJ    JOB (6496,B014),MURF,CLASS=O,MSGCLASS=R,NOTIFY=MURF
//*  JCL TO INSTALL CONSOLE
//*
//*  CHANGE SYSLIB ACCORDING TO YOUR IPORES
//*  CHANGE SYSLIB AND SYLMOD IN LKED STEP TO LINK LIST LIBRARY
//*
//COM     EXEC PGM=IEV90,REGION=512K,
//    PARM='LOAD,XREF(SHORT),LINECNT=55,NODECK,RENT'
//SYSLIB   DD  DISP=SHR,DSN=SYS1.MACLIB
//         DD  DISP=SHR,DSN=SYS1.AMODGEN
//         DD  DISP=SHR,DSN=MURF.SHARE.LIBRARY
//SYSLIN   DD  UNIT=VIO,DSN=&LOADSET,DISP=(MOD,PASS),
//             SPACE=(CYL,(2,2)),DCB=BLKSIZE=1680
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(10,2))
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,(12,2))
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,(20,2))
//SYSPUNCH DD  DUMMY =*,DCB=FUNC=I
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSIN    DD  DSN=MURF.SHARE.LIBRARY(CONSOLE),DISP=SHR
//*
//LKED     EXEC PGM=IEWL,REGION=1024K,COND=(4,LT),
//             PARM='XREF,LET,LIST,RENT,REUS'
//SYSPRINT DD   SYSOUT=*
//SYSUT1   DD   DSN=&SYSUT1,UNIT=SYSDA,SPACE=(CYL,(1,1))
//SYSLMOD  DD   DISP=SHR,DSN=SYSX.LOADLIB(CONSOLE) LINKLIST OR STEPLIB
//SYSLIN   DD   UNIT=SYSDA,DSN=&LOADSET,DISP=(OLD,DELETE)
//         DD   DDNAME=SYSIN
./ ADD NAME=GETOPER
//GETOPER PROC LID=DUMMY
//GETOPER EXEC PGM=GETOPR,PARM='&LID'
//STEPLIB DD DSN=SYSX.LOADLIB,DISP=SHR
./ ADD NAME=GETOPR
//@MKTASM1 JOB (6496,B015),MARK,CLASS=T,MSGCLASS=T
//COM     EXEC PGM=IEV90,REGION=512K,
//    PARM='LOAD,XREF(SHORT),LINECNT=55,NODECK'
//SYSLIB   DD  DISP=SHR,DSN=SYS1.MACLIB
//         DD  DISP=SHR,DSN=SYS1.AMODGEN
//         DD  DISP=SHR,DSN=SYSX.SP217.MODSRC
//SYSLIN   DD  UNIT=VIO,DSN=&LOADSET,DISP=(MOD,PASS),
//             SPACE=(CYL,(2,2)),DCB=BLKSIZE=1680
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(10,2))
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,(12,2))
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,(20,2))
//SYSPUNCH DD  DUMMY =*,DCB=FUNC=I
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSIN    DD  *
GETOPR   TITLE 'MARKS ROUTINE TO DISPLAY UID NAMES'                     000100
GETOPR CSECT                                                            000500
*******************************************************************     DOC FILE
*                                                                 *     DOC FILE
*                        D I S C L A I M E R                      *     DOC FILE
*                                                                 *     DOC FILE
*******************************************************************     DOC FILE
*                                                                 *     DOC FILE
* THIS MATERIAL HAS BEEN USED SUCCESSFULLY & TO THE BEST OF OUR   *     DOC FILE
* KNOWLEDGE  THEY  ARE  OPERATIONAL, HOWEVER  NO  WARRANTY        *     DOC FILE
* IS MADE TO THE ACCURACY OF THE PROGRAMS OR RELATED MATERIAL AND *     DOC FILE
* NO RESPONSIBILITY IS ASSUMED  FOR ANY MODIFICATION  DIRECTLY OR *     DOC FILE
* INDIRECTLY  CAUSED BY  THEIR USE.  IT IS THE USERS              *     DOC FILE
* RESPONSIBILITY  TO  EVALUATE THE  USEFULLNESS  OF THE  MATERIAL *     DOC FILE
* SUPPLIED .                                                      *     DOC FILE
*                                                                 *     DOC FILE
* WE DO NOT GUARANTEE TO  KEEP ANY  MATERIAL PROVIDED  UP TO DATE *     DOC FILE
* NOR DO WE GUARANTEE TO  PROVIDE ANY  CORRECTIONS OR  EXTENSIONS *     DOC FILE
* DESCRIBED BY THE USER OR  CORRECTIONS OR EXTENSIONS MADE IN THE *     DOC FILE
* FUTURE .                                                        *     DOC FILE
*                                                                 *     DOC FILE
*******************************************************************     DOC FILE
*******************************************************************     DOC FILE
*                                                                 *     DOC FILE
* GETOPR - WRITTEN BY MARK TERRY, SENIOR MVS SYSTEMS PROGRAMMER   *     DOC FILE
*          AT TEXAS UTILITIES SERVICES.                           *     DOC FILE
*                                                                 *     DOC FILE
* MARK WROTE GETOPR FOR THE OPERATORS TO USE TO FINDOUT THE       *     DOC FILE
* RACF INFO ASSOCIATED WITH A GIVEN USERID AND DISPLAY IT ON THE  *     DOC FILE
* CONSOLE. THE OPERATOR STARTS A PROC CALLED GETOPER, WITH FORMAT:*     DOC FILE
*                                                                 *     DOC FILE
*     S GETOPER,LID=XXXX                                          *     DOC FILE
*                                                                 *     DOC FILE
* WHERE XXXX = USERID THAT THE INFO IS TO BE OBTAINED AND         *     DOC FILE
* DISPLAYED ON THE OPERATOR TERMINAL.                             *     DOC FILE
*******************************************************************     DOC FILE
         BEGIN PROGRAM=GETOPR                                           000600
         LR    R12,R15
         USING GETOPR,R12
         L     R2,0(R1)
         LH    R6,0(R2)
         LTR   R6,R6
         BZ    RETURN
         STC   R6,USERID
         BCTR  R6,R0
         EX    R6,MVCLID
*MVCLID  MVC   USERID+1(R0),2(R2) MOVE LID TO RACF FIELD
         LA    R6,WRKLEN
         ST    R6,WRKAREA
         ICHEINTY LOCATE,TYPE='USR',ENTRY=USERID,WKAREA=WRKAREA,       X
               ACTIONS=(ACTNAME,ACTGROUP)
         LTR   R15,R15
         BNZ   RETURN
         MVC   WTO+16(8),USERID+1
         MVC   WTO+31(20),NAME
WTO      WTO   'GETOPR  XXXXXXXX ====> NAME                    ',      X
               ROUTCDE=2,DESC=(2,7)
         STIMER WAIT,DINTVL=TENSECS
RETURN   RETURN (14,12),RC=0
*
MVCLID   MVC   USERID+1(R0),2(R2) MOVE LID TO RACF FIELD
*
WRKAREA  DS    0F
         DS    F
         DS    CL24
NAMELN   DS    CL2
NAME     DS    CL20
GROUPLN  DS    CL2
GROUPS   DC    CL160' '
WRKLEN   EQU   *-WRKAREA
USERID   DS    CL9
         DS    0D
TENSECS  DC    C'00001000' TEN SECONDS
         LTORG
*
*   CONSTANTS AND SKELETONS
*
*
ACTNAME  ICHEACTN FIELD=PGMRNAME,MF=L
ACTGROUP ICHEACTN FIELD=CONGRPNM,MF=L
         IKJCPPL
         IKJPGPB
         END   GETOPR                                                   005900
//LNK  EXEC PGM=IEWL,
//          PARM='LET,NCAL,XREF,LIST,AC=1',COND=(0,NE)
//SYSPRINT DD SYSOUT=*
//SYSLMOD DD DSN=SYSX.LOADLIB,DISP=SHR
//SYSUT1 DD DSN=&&SYSUT1,SPACE=(TRK,(10,10)),UNIT=VIO
//SYSLIN DD DSN=&LOADSET,DISP=(OLD,DELETE)
//       DD DDNAME=SYSIN
//SYSIN DD *
  ENTRY GETOPR
  NAME GETOPR(R)
./ ADD NAME=IGGPREJ
//@MKTPRE  JOB (6496,B014),MURF,CLASS=O,MSGCLASS=T
//COM     EXEC PGM=IEV90,REGION=512K,
//    PARM='LOAD,XREF(SHORT),LINECNT=55,NODECK,RENT'
//SYSLIB   DD  DISP=SHR,DSN=SYS1.MACLIB,DCB=BLKSIZE=23440
//         DD  DISP=SHR,DSN=SYS1.MODGEN
//SYSLIN   DD  UNIT=VIO,DSN=&LOADSET,DISP=(MOD,PASS),
//             SPACE=(CYL,(2,2)),DCB=BLKSIZE=1680
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(10,2))
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,(12,2))
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,(20,2))
//SYSPUNCH DD  DUMMY =*,DCB=FUNC=I
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSIN    DD  DSN=LBKQ.FILE025.PDS(IGGPRE00),DISP=SHR
//LKED    EXEC PGM=IEWL,REGION=1024K,COND=(4,LT),
//        PARM='XREF,LET,LIST,RENT,REUS,AC=1'
//SYSPRINT     DD   SYSOUT=*
//SYSUT1       DD   DSN=&SYSUT1,UNIT=SYSDA,SPACE=(CYL,(1,1))
//SYSLMOD   DD DISP=SHR,DSN=SYS1.LPALIB,UNIT=3380,VOL=SER=MVSXA1
//SYSLIN       DD   UNIT=SYSDA,DSN=&LOADSET,DISP=(OLD,DELETE)
//  DD  DDNAME=SYSIN
//SYSIN  DD *
 NAME IGGPRE00(R)
//MURFTAB JOB (6496,B014),MURF,CLASS=O,MSGCLASS=T,NOTIFY=MURF
//COM     EXEC PGM=IEV90,REGION=512K,
//    PARM='LOAD,XREF(SHORT),LINECNT=55,NODECK,RENT,REUS'
//*
//SYSLIB   DD  DISP=SHR,DSN=SYS1.MACLIB,DCB=BLKSIZE=23440
//         DD  DISP=SHR,DSN=SYS1.MODGEN
//SYSLIN   DD  UNIT=VIO,DSN=&LOADSET,DISP=(MOD,PASS),
//             SPACE=(CYL,(2,2)),DCB=BLKSIZE=1680
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(10,2))
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,(12,2))
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,(20,2))
//SYSPUNCH DD  DUMMY =*,DCB=FUNC=I
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSIN    DD  DSN=LBKQ.FILE025.PDS(IGGPRETB),DISP=SHR
//*
//LKED         EXEC PGM=IEWL,REGION=1024K,COND=(4,LT),
//             PARM='XREF,LET,LIST,RENT,REUS'
//SYSPRINT     DD   SYSOUT=*
//SYSUT1       DD   DSN=&SYSUT1,UNIT=SYSDA,SPACE=(CYL,(1,1))
//SYSLMOD DD DSN=SYS1.LPALIB(IGGPRETB),
// DISP=SHR
//SYSLIN       DD   UNIT=SYSDA,DSN=&LOADSET,DISP=(OLD,DELETE)
//             DD   DDNAME=SYSIN
./ ADD NAME=IGGPRETB
IGGPRETB CSECT
         DC    F'2',CL12'JX'              LENGTH GOES IN FIRST POSITION
         DC    F'2',CL12'T.'              LENGTH GOES IN FIRST POSITION
         DC    F'2',CL12'S.'         MKT  LENGTH GOES IN FIRST POSITION
         DC    F'5',CL12'TEST.'           MAX LENGTH IS 12
         DC    F'5',CL12'DEVC.'           MAX LENGTH IS 12
         DC    F'5',CL12'FAP.T'           MAX LENGTH IS 12
         DC    F'5',CL12'FRS.T'           MAX LENGTH IS 12
         DC    F'5',CL12'EDD.T'           MAX LENGTH IS 12
         DC    F'5',CL12'FRA.T'           MAX LENGTH IS 12
         DC    F'5',CL12'CIS.T'           MAX LENGTH IS 12
         DC    F'09',CL12'TPL.U0603'
         DC    F'09',CL12'DPL.U0502'
         DC    F'09',CL12'CF58.TEST'
         DC    F'10',CL12'PREIS.TEST'
         DC    F'6',CL12'IMSVS.'
         DC    F'6',CL12'TPL.JX'
         DC    F'3',CL12'CIX'
         DC    F'4',CL12'PAC.'
         DC    F'10',CL12'TUGCO.U411'
         DC    F'09',CL12'TPL.U1503'
         DC    F'09',CL12'TPL.T1913'
TBLEND   DC    XL4'FFFFFFFF',XL12'FFFFFFFFFFFFFFFFFFFFFFFF'
         END
./ ADD NAME=IGGPRE00
IGGPRE00 TITLE 'DADSM ALLOCATION EXIT TO KEEP JUNK OFF STORAGE PACKS'
*******************************************************************
*                                                                 *
*                        D I S C L A I M E R                      *
*                                                                 *
*******************************************************************
*                                                                 *
* THIS MATERIAL HAS BEEN USED SUCCESSFULLY & TO THE BEST OF OUR   *
* KNOWLEDGE  IT IS  OPERATIONAL, HOWEVER  NO  WARRANTY            *
* IS MADE TO THE ACCURACY OF THE PROGRAMS OR RELATED MATERIAL AND *
* NO RESPONSIBILITY IS ASSUMED  FOR ANY MODIFICATION  DIRECTLY OR *
* INDIRECTLY  CAUSED BY  THEIR USE.  IT IS THE USERS              *
* RESPONSIBILITY  TO  EVALUATE THE  USEFULLNESS  OF THE  MATERIAL *
* SUPPLIED .                                                      *
*                                                                 *
* WE DO NOT GUARANTEE TO  KEEP ANY  MATERIAL PROVIDED  UP TO DATE *
* NOR DO WE GUARANTEE TO  PROVIDE ANY  CORRECTIONS OR  EXTENSIONS *
* DESCRIBED BY THE USER OR  CORRECTIONS OR EXTENSIONS MADE IN THE *
* FUTURE .                                                        *
*                                                                 *
*******************************************************************
***********************************************************************
*                                                                     *
* PROGRAM: IGGPRE00                                                   *
* REFERENCE: MVS/XA SYSTEM DATA ADMINISTRATION  GC26-4010             *
*                                                                     *
* AUTHOR: P. MURPHY                                                   *
*         WITH CHANGES FROM TYRONE TERRY - MKT SENIOR MVS SYSTEMS PROG*
* PURPOSE: DADSM EXIT TO KEEP UNAUTHORIZED DATASETS OFF OF STORAGE    *
* PACKS.                                                              *
*                                                                     *
*         LOADS IGGPRETB THAT CONTAINS SOME PREFIXES OF DATASETS THAT *
* HAVE BEEN FILLING STORAGE PACKS.  IT ALSO KEEPS PROGRAMMERS (RACF   *
* DEFAULT GROUP PGRB OR PGR) OFF OF PRODUCTION PACKS THAT START WITH  *
* VSM OR STG.  DEV OR DEVC IS WHERE THEY SHOULD BE.                   *
*                                                                     *
* MODIFICATIONS:                                                      *
*                                                                     *
*    3/01/87   DONT ALLOW ALLOCATION WITH EXPDT.          MKT         *
*    3/11/87   DONT ALLOW NONVSAM ALLOC ON A VSAM PACK.   MKT         *
*    9/10/87   DONT ALLOW DEVELOPMENT ALLOC ON PROD PACKS.MKT         *
*    5/22/88   PROBLEM WITH NEW ISPF - PMM                            *
*    6/24/88   CHECK DEVV VSAM ONLY  - PMM                            *
*    9/20/89   ISPF FIX AND CHANGE USER IDS AND ADD LIBXXX PACKS MKT  *
*                                                                     *
***********************************************************************
IGGPRE00 CSECT
IGGPRE00 AMODE 31
R0       EQU   0
R1       EQU   1                  R
R2       EQU   2                    E
R3       EQU   3                      G
R4       EQU   4                        I
R5       EQU   5                          S
R6       EQU   6                            T
R7       EQU   7                              E
R8       EQU   8                                R
R9       EQU   9                        E
R10      EQU   10                         Q
R11      EQU   11                           U
R12      EQU   12                             A
R13      EQU   13                               T
R14      EQU   14                                 E
R15      EQU   15                                   S
         SAVE  (14,12),,*
         LR    R12,R15            ADDRESSABILITY OF IEFUJI BY R12
         USING IGGPRE00,R12       R12 BASE REG
         USING PREPL,R2
         USING PSA,0
         LR    R2,R1              LOAD REGS 2-5 W/ 4 PARM ADDRESSES
         SR    R15,R15            ZERO R15
         CLI   5(R2),X'01'        ALLOCATE?
         BNE   EXIT               NO, GO HOME
         GETMAIN R,LV=AREALENG,SP=241 GETMAIN FOR SAVE AREA/WTO
         LTR   R15,R15            CHECK FOR ZERO RETURN CODE
         BNZ   GETMERR
         LR    R11,R1             ADDRESS AREA DSECT
         USING AREA,R11
         LA    R7,SAVEAREA        ADDRESS OF PROGRAM SAVEAREA
         ST    R13,SAVEAREA+4     HSA LINK
         ST    R7,8(R13)          LSA LINK
         LR    R13,R7
         MVI   VSAMFLAG,X'00'
*
*  EXPIRATION DATE CHECK
*
         L     R9,IEXPTR1
         USING INFMJFCB,R9
         TM    JFCDSRG2,JFCORGAM      IS THIS A VSAM DATASET?
         BZ    CHKISAM                NO, CHECK ISAM
         MVI   VSAMFLAG,X'FF'
         B     FINDACEE
CHKISAM  TM    JFCDSRG1,JFCORGIS      IS THIS A ISAM DATASET?
         BZ    CHKEXPDT               NO, CHECK FOR EXPDT
         L     R6,IEXUCB              YES,
         USING UCBCMSEG,R6              SEE IF ON
         CLC   =C'UNMOV',UCBVOLI        UNMOVEX PACK
         BE    RETURN0                  YES, GO ALLOG
SETISAM  MVI   VSAMFLAG,X'0F'            PMM 8/88
         B     FINDACEE                  PMM 8/88 GET USER INFO
CHKEXPDT TM    JFCBFLG3,X'40'         EXPIRATION DATE?
         BZ    FINDACEE               NO, CONT OTHER CHECKS
         TM    JFCBIND2,JFCTEMP       TEMPORARY DATASET
         BO    FINDACEE               YES, CONT OTHER CHECKS
         CLC   =X'000000',JFCBXPDT
         BE    FINDACEE
         WTO   MF=(E,WTOMSG4)         NO, ISSUE MSG
         MVI   VSAMFLAG,X'F0'         GO
FINDACEE L     R4,PSAANEW                GET ASCB
         USING ASCB,R4                   ADDRESS IT
         L     R4,ASCBASXB               GET ASXB
         USING ASXB,R4                   ADDRESS IT
         L     R4,ASXBSENV               GET ACEE
         LTR   R4,R4                     IS THERE ONE?
         BZ    RETURN0                     NO - RETURN
         USING ACEE,R4                     YES, ADDRESS IT
         CLI   VSAMFLAG,X'0F'            IS THIS A ISAM DATASET?
         BE    CANISAM                   YES, GO CAN IT.
         L     R6,IEXUCB
         USING UCBCMSEG,R6
         CLI   VSAMFLAG,X'F0'
         BNE   NOEXP
         CLC   =C'GMC',ACEEUSRI
         BNE   CHKTECH
         DC    X'0000'
CHKTECH  CLC   =C'JTECH',ACEEGRPN
         BE    RETURN0
         WTO   'IGGPRE00 NOT IN AUTHORIZED GROUP TO DO EXPDT'
         B     CANCEL
NOEXP    CLC   =C'LIB',UCBVOLI           IS THIS A LIB PACK?
         BE    PRODPACK                  YES, GO THRU PROD CHECKS
         CLC   =C'STG',UCBVOLI           IS THIS A STG PACK?
         BNE   CHKVSAM                   NO, GO CHECK FOR VSM PACK
PRODPACK CLI   VSAMFLAG,X'FF'            IS THIS A VSAM DATASET?
         BE    VSAMSTG                   YES, GO SLAP THEIR HANDS
         L     R6,IEXDSN                 IS THIS A SYSTEM DS?
         CLC   =C'SYS',0(R6)
         BE    RETURN0                   YES, GO HOME
         LOAD  EP=IGGPRETB,ERRET=RETURN0 LOAD INVALID DSN TABLE
         LR    R8,R0                     AND SEARCH,
CLCLP    L     R5,0(,R8)                   IF BAD
         C     R5,=X'FFFFFFFF'               DATASET
         BE    DELRET                          IS
         BCTR  R5,0                              FOUND,
         EX    R5,CLCEX                            GO
*CLCEX   CLC   4(0,R8),0(R6) CANCEL
         BE    CANCEL                                IT
         LA    R8,16(,R8)                INCREMENT
         B     CLCLP                      AND LOOP
VSAMSTG  WTO   MF=(E,WTOMSG8)            ISSUE MESSAGE FIRST
         CLC   =C'JISO',ACEEGRPN         IS THIS DATA SECURITY?
         BE    RETURN0                   YES, LET IT GO
         CLC   =C'JTECH',ACEEGRPN        IS THIS TECHNICAL SUPPORT?
         BE    RETURN0                   YES LET IT GO
         WTO   MF=(E,WTOMSG8A)           ISSUE CANCEL MESSAGE
         B     CANCEL                      THEN CAN IT
CANISAM  WTO   MF=(E,WTOMSG7)            ISSUE MESSAGE
         CLC   =C'JISO',ACEEGRPN         IS THIS DATA SECURITY?
         BE    RETURN0                   YES, LET IT GO
         CLC   =C'JTECH',ACEEGRPN        IS THIS TECHNICAL SUPPORT?
         BE    RETURN0                   YES, LET IT GO
         WTO   MF=(E,WTOMSG7A)           ISSUE CANCEL MESSAGE
         B     CANCEL                      THEN CAN IT
DELRET   DELETE EP=IGGPRETB              NO HIT FOUND, CHECK PGR/DBA
         CLC   =C'PGRO',ACEEGRPN         IS THIS A OP SUPPORT?
         BE    RETURN0                     YES, GO HOME
         CLC   =C'PGR',ACEEGRPN          IS THIS A PROGRAMMER?
         BE    CHCKIT                      YES, CHECKIT
         CLC   =C'DBA',ACEEGRPN          IS THIS DBA?
         BNE   RETURN0                     NO, RETURN
CHCKIT   CLC   =C'JXA8',ACEEUSRI         IS THIS KUNKEL?
         BE    RETURN0                     YES - RETURN
         CLC   =C'JXM8',ACEEUSRI         IS THIS KUNKEL?
         BE    RETURN0                     YES - RETURN
         CLC   =C'JXV5',ACEEUSRI         IS SUE YEH?
         BE    RETURN0                     YES - RETURN
         WTO   MF=(E,WTOMSG5)              NO -
         B     CANCEL                      THUS CANCEL
*
*  CHECK VSMXXX ALLOCATIONS
*
CHKVSAM  CLC   =C'DEVV',UCBVOLI      IS THIS A DEVVXX VOLUME
         BE    CHKVSAM2              YES, CHECK FURTHER
         CLC   =C'DEV0',UCBVOLI      IS THIS A DEV0XX-NO VSAM PMM 8/88
         BE    CHKVSAMD              YES, CHECK FOR VSAM      PMM 8/88
         CLC   =C'VSM',UCBVOLI       IS THIS A VSMXXX VOLUME
         BNE   RETURN0               NO, ALLOW ALLOCATION
         CLC   =C'PGR',ACEEGRPN      IS THIS A PROGRAMMER?
         BE    CHCKIT2                 YES, CHECKIT
         CLC   =C'DBA',ACEEGRPN      IS THIS DBA?
         BNE   CHKVSAM2                NO, RETURN
CHCKIT2  CLC   =C'JXA8',ACEEUSRI     IS THIS KUNKEL?
         BE    CHKVSAM2                YES - CONTINUE CHECK
         CLC   =C'JXM8',ACEEUSRI     IS THIS KUNKEL?
         BE    CHKVSAM2                YES - CONTINUE CHECK
         CLC   =C'JXV5',ACEEUSRI     IS THIS SUE YEH?
         BE    CHKVSAM2                YES - CONTINUE CHECK
         WTO   MF=(E,WTOMSG5)          NO - CANCEL
         B     CANCEL
CHKVSAMD CLI   VSAMFLAG,X'FF'        IS THIS A VSAM DATASET? PMM 8/88
         BNE   RETURN0               NO,  ALLOW ALLOCATION   PMM 8/88
         WTO   MF=(E,WTOMSG6)        NO VSAM ALLOCATIONS DEV0XX
         WTO   MF=(E,WTOMSG6A)       ISSUE CANCEL MESSAGE
         B     CANCEL                  AND CAN IT
CHKVSAM2 CLI   VSAMFLAG,X'FF'        IS THIS A VSAM DATASET?
         BE    RETURN0               YES, ALLOW ALLOCATION
         L     R6,IEXDSN             GET ADD OF DSN
         CLC   =C'SYS1.',0(R6)       DOES DSN START WITH SYS1
         BE    RETURN0               YES, ALLOW
         WTO   MF=(E,WTOMSG3)        NON VSAM DSET ON VSMXXX PACK
         B     CANCEL                 THUS CANCEL
CANCEL   DELETE EP=IGGPRETB
         LA    R15,8
         B     RETURN
GETMERR  EQU   *
         WTO   MF=(E,WTOMSG2)
         SR    R15,R15
         B     RETURN
FREERROR EQU   *
         WTO   MF=(E,WTOMSG1)
         SR    R15,R15
         B     RETURN
RETURN0  SR    R15,R15            ZERO RETURN CODE
RETURN   LR    R10,R15            R15 WILL BE WIPED OUT BY FREEMAIN
         L     R13,4(R13)         RELOAD R13 HSA
         FREEMAIN R,LV=AREALENG,A=(R11),SP=241
         LTR   R15,R15
         BNZ   FREERROR
         LR    R15,R10            RELOAD R15
EXIT     RETURN (14,12),,RC=(15)
CLCEX    CLC   4(0,R8),0(R6)             |
WTOMSG1  WTO   'IGGPRE00 FREEMAIN ERROR - NOTIFY TECHNICAL SUPPORT  ', X
               ROUTCDE=1,MF=L,DESC=2
WTOMSG2  WTO   'IGGPRE00 GETMAIN ERROR -  NOTIFY TECHNICAL SUPPORT  ', X
               ROUTCDE=1,MF=L,DESC=2
WTOMSG3  WTO   'IGGPRE00 ATTEMPT TO ALLOCATE NON-VSAM DATASET ON VSAM PX
               ACK - ALLOCATION DENIED.',                              X
               ROUTCDE=11,MF=L,DESC=3
WTOMSG4  WTO   'IGGPRE00 ATTEMPT TO ALLOCATE DATASET WITH AN EXPIRATIONX
                DATE - ALLOCATION DENIED.',                            X
               ROUTCDE=11,MF=L,DESC=3
WTOMSG5  WTO   'IGGPRE00 ATTEMPT TO ALLOCATE DATASET ON AN UNAUTHORIZEDX
                 VOLUME - ALLOCATION DENIED.',                         X
               ROUTCDE=11,MF=L,DESC=3
WTOMSG6  WTO   'IGGPRE06 INVALID ATTEMPT TO ALLOCATE VSAM ON A NONVSAM X
               VOLUME.',                                               X
               ROUTCDE=11,MF=L,DESC=3
WTOMSG6A WTO   'ALLOCATION HAS BEEN DENIED, USE DEVV01-04 VOLUMES FOR VX
               SAM ALLOCATIONS ON DEV PACKS.',                         X
               ROUTCDE=11,MF=L,DESC=3
WTOMSG7  WTO   'IGGPRE07 INVALID ATTEMPT TO ALLOCATE ISAM ON A NON-ISAMX
                VOLUME.',                                              X
               ROUTCDE=11,MF=L,DESC=3
WTOMSG7A WTO   'ALLOCATION HAS BEEN DENIED, USE UNMOV1 VOLUME FOR ISAM X
                DATASETS.',                                            X
               ROUTCDE=11,MF=L,DESC=3
WTOMSG8  WTO   'IGGPRE08 INVALID ATTEMPT TO ALLOCATE VSAM ON A NON-VSAMX
                VOLUME.',                                              X
               ROUTCDE=11,MF=L,DESC=3
WTOMSG8A WTO   'ALLOCATION HAS BEEN DENIED, USE VSMXXX VOLUMES FOR PRODX
               UCTION VSAM DATASETS.',                                 X
               ROUTCDE=11,MF=L,DESC=3
         LTORG
AREA     DSECT
SAVEAREA DS    18F        SAVE AREA
VSAMFLAG DS    XL1
AREALENG EQU   *-AREA
         IECIEXPL
         PRINT OFF
         IEFUCBOB
         IHAASCB
         IHAACEE
         IHAPSA
         IHAASXB
         IEFJFCBN
         END
./ ADD NAME=MPFLST03
$HASP100                     JOB ON READER
CSV003I                      IPCS MODULE NOT FOUND
DSI090                       NCCF LOAD FAILED
IEA995I                      SYMPTOM DUMP
IEF677I                      WARNING MESSAGE(S) FOR JOB
CA044I
CA045I
CA046I
CA050I
CA051I
CA052I
CA053I
CA054I
CA060I
CA061I
CA062I
CA069I
CA070I
CA071I
CA078I
CA122I
IEC130I
IEC701D,SUP(NO),USEREXIT(AUTOWTOR)
MPFHCF=+                     SUPRESSED MESSAGE INDICATOR IN HARDCOPY
./ ADD NAME=MTT
***********************************************************************
*   TITLE: MTT                                                        *
*   AUTHOR: P.M.MURPHY                                                *
*   DATE-WRITTEN: 10/16/84                                            *
*   REFERENCE: OS/VS2 MVS SYSTEM PROGRAMMING LIBRARY:SUPERVISOR       *
*              GC28-1046-1                                            *
*   REMARKS:                                                          *
*                                                                     *
*        USE CROSS MEMORY SERVICES TO PAGE THROUGH CONSOLE MESSAGES   *
*   IN THE MASTER TRACE TABLE IN THE MASTER ADDRESS SPACE. THIS IS    *
*   A MVS/SP VERSION WHICH WE HAVE NOT USED SINCE XA IN 84.           *
***********************************************************************
*******************************************************************
*                                                                 *
*                       D I S C L A I M E R                       *
*                                                                 *
*******************************************************************
*                                                                 *
* THIS MATERIAL HAS BEEN USED SUCCESSFULLY & TO THE BEST OF OUR   *
* KNOWLEDGE  THEY  ARE  OPERATIONAL, HOWEVER  NO  WARRANTY        *
* IS MADE TO THE ACCURACY OF THE PROGRAMS OR RELATED MATERIAL AND *
* NO RESPONSIBILITY IS ASSUMED  FOR ANY MODIFICATION  DIRECTLY OR *
* INDIRECTLY  CAUSED BY  THEIR USE.  IT IS THE USERS              *
* RESPONSIBILITY  TO  EVALUATE THE  USEFULLNESS  OF THE  MATERIAL *
* SUPPLIED .                                                      *
*                                                                 *
* WE DO NOT GUARANTEE TO  KEEP ANY  MATERIAL PROVIDED  UP TO DATE *
* NOR DO WE GUARANTEE TO  PROVIDE ANY  CORRECTIONS OR  EXTENSIONS *
* DESCRIBED BY THE USER OR  CORRECTIONS OR EXTENSIONS MADE IN THE *
* FUTURE .                                                        *
*                                                                 *
*******************************************************************
MTT      CSECT
         BEGIN PROGRAM=MTT
*        SAVES REGISTERS AND INSERTS PROGRAM, DATE, AND TIME
         LR    R12,R15            LOAD ADDRESS OF ENTRY POINT
         LR    R2,R1              SAVE CPPL
         USING MTT,R12            R12 BASE REGISTER
         GETMAIN RC,LV=WORKL      GETMAIN  FOR SAVEAREA/WORK
         LTR   R15,R15            CHECK RETURN CODE
         BNZ   GETMERR
         LR    R3,R1              ADDRESS OF WORK AREA/SAVEAREA
         USING SAVDSECT,R3        ADDRESSABILITY
         ST    R13,SAVEAREA+4     STORE CALLER SAVEAREA ADDRESS (HSA)
         ST    R3,8(,R13)         ADD OF PROGRAM SAVE IN CALLER(LSA)
         LR    R13,R3             ADDRESS OF SAVEAREA IN R13
         DROP  R3
         USING SAVDSECT,R13
         USING CPPL,R2
         L     R6,CPPLPSCB
         DROP  R2
         USING PSCB,R6
         MVC   USERID,PSCBUSER
         MVC   USERIDL,PSCBUSRL
         MVC   USERATTR,PSCBATR2  USER ATTRIBUTE BYTE, IN CASE I USE IT
         DROP  R6
         ST    R2,CPPLSAVE
         MVC   SCRTPUTL,=AL4(DSCREENL+41*80) LENGTH FOR TPUT 43 LINE
         MVC   SCRLENG,=AL4(41*80) LENGTH FOR MOVE LONG 43 LINE DEFAULT
         MVC   SCREEN(108),DSCREEN SCREEN IMAGE
         GTSIZE
         LTR   R0,R0
         BZ    FREERET2            NON-DISPLAY TERMINAL
         CH    R1,=H'80'           80 WIDE?
         BNE   SETM2               NO - SET IT TO THIS
         CH    R0,=H'43'           MOD 4?
         BE    VERIFY
         CH    R0,=H'32'           MOD 3?
         BNE   SETM2
MODEL3   MVC   SCRLENG,=AL4(28*80) 30 LINE DISPLAY
         MVC   SCRTPUTL,=AL4(28*80+DSCREENL)
         MVC   DSCRO3,=X'E6F0'     (32,1)
         MVC   DSCRO4,=X'E7F7'     (32,72)
         B     VERIFY
SETM2    STSIZE SIZE=80,LINE=24
         MVC   SCRLENG,=AL4(22*80) LENGTH FOR MOVE LONG
         MVC   SCRTPUTL,=AL4(22*80+DSCREENL) LENGTH OF TPUT
         MVC   DSCRO3,=X'5CF0'     24,1
         MVC   DSCRO4,=X'5DF7'     24,72
VERIFY   EQU   *
         STFSMODE ON,INITIAL=YES
         STAX  DEFER=YES         WE DO NOT WANT AN INTERRUPT
         SYSDSVC
         MODESET MF=(E,SUPRMOD)
         AXRES AXLIST=AXLIST     RESERVE AN AUTHORIZATION INDEX IN A.T.
         LA    R1,1              MASTER IS ASID 1
         AXEXT ASID=(1)          DETERMINE AUTH TABLE VALUE OF ASID 1
         AXSET AX=(0)            SET TO ASID 1'S AUTHORIZATION INDEX
         L     R1,16
         USING CVT,R1
         L     R1,CVTTCBP
         DROP  R1
         L     R1,4(R1)
         USING TCB,R1
         L     R1,TCBJSCB
         DROP  R1
         USING IEZJSCB,R1
         NI    JSCBOPTS,X'FF'-JSCBAUTH
         DROP  R1
         MODESET MF=(E,PROBMOD)
         STAX  DEFER=NO
         MVC   COMMAND,COMMANDL
         MVI   HEX40S,X'40'         SPACE
         MVC   HEX40S+1(79),HEX40S  PROPAGATE SPACES TO INITIALIZE
         L     R2,SCRLENG           SCREEN LENGTH
         S     R2,=F'0160'          MINUS 2 LINES
         LA    R5,DETAIL            ADDRESS OF SCREEN
         ST    R5,FRSTLINE
         LA    R2,0(R5,R2)          ADDRESS IN GETMAIN AREA
         ST    R2,LASTLINE          SAVE THE ADDRESS
         LA    R1,16
         L     R1,0(R1)
         USING CVT,R1
         L     R1,CVTMSER
         DROP  R1
         USING BASE,R1
         L     R3,BAMTTBL        ADDRESS OF MASTER TRACE TABLE
         ICM   R4,B'0111',BAMTLEN LENGTH OF MTT W/O FIRST BYTE OF WORD
         BZ    NOTACTIV
         ST    R4,MTTSIZE
         ST    R3,MTTADDR
         DROP  R1
         GETMAIN RC,LV=(4)       LENGTH WAS IN R4
         LTR   R15,R15
         BNZ   GETMERR
         LR    R11,R1            ADDRESS OF OUR FUTURE COPY OF MTT
*        B     NOTACTIV
AUTHRIZE STAX  DEFER=YES         WE DO NOT WANT AN INTERRUPT WHILE
         L     R9,MTTSIZE
         L     R3,MTTADDR
         SRA   R9,8             DIVIDE BY 256
         BNP   NOTACTIV
         SYSDSVC
         MODESET MF=(E,SUPRMOD)
*        AXRES AXLIST=AXLIST     RESERVE AN AUTHORIZATION INDEX IN A.T.
*        LA    R1,1              MASTER IS ASID 1
*        AXEXT ASID=(1)          DETERMINE AUTH TABLE VALUE OF ASID 1
*        AXSET AX=(0)            SET TO ASID 1'S AUTHORIZATION INDEX
         LA    R1,1
         SSAR  R1                SECONDARY ADDRESS SPACE OF ASID 1!!!
         SR    R5,R5
         LA    R6,0(R4,R11)      END OF GETMAIN AREA
         LA    R7,256
         LR    R10,R11
MOVELOOP MVCP  0(R7,R10),0(R3),R5 MOVES MAX OF 256 BYTES
         LA    R10,256(,R10)
         LA    R3,256(,R3)
         BCT   R9,MOVELOOP
         B     ALLMOVED
FREERET  L     R4,MTTSIZE
         FREEMAIN RC,LV=(4),A=(11) FREE SECOND GETMAIN AREA
         LTR   R15,R15            CHECK RETURN CODE
         BNZ   FREEMERR
FREERET2 LR    R3,R13
         L     R13,4(,R13)        ADDRESS OF CALLING PROGRAM SAVEAREA
         FREEMAIN RC,LV=WORKL,A=(3) FREE STORAGE
         LTR   R15,R15            CHECK RETURN CODE
         BNZ   FREEERR2
RETURN   RETURN (14,12),,RC=(15)
GETMERR  WTO   ' MTT - GETMAIN ERROR, PLEASE NOTIFY TECH SUPPORT',     X
               ROUTCDE=2
         L     R13,4(,R13)        RELOAD R13
         B     RETURN
NOAUTH   EQU   *
         TPUT  MSGNO1,13
         B     FREERET2
BADLOAD  EQU   *
         TPUT  MSG3,33
         B     FREERET2
FREEMERR TPUT  MSG2,33
         B     FREERET2
FREEERR2 TPUT  MSG1,33
         B     RETURN
ALLMOVED EPAR  R1             EXTRACT PRIMARY ASID INTO R1
         SSAR  R1             SET SECONDARY TO OUR ASID
         L     R1,16
         USING CVT,R1
         L     R1,CVTTCBP
         DROP  R1
         L     R1,4(R1)
         USING TCB,R1
         L     R1,TCBJSCB
         DROP  R1
         USING IEZJSCB,R1
         NI    JSCBOPTS,X'FF'-JSCBAUTH
         DROP  R1
         MODESET MF=(E,PROBMOD)
         STAX  DEFER=NO
ADJUST   CLC   MTT,0(R11)     MTT HEADER
         BNE   NOTACTIV
         L     R9,4(,R11)     THIS IS THE CURRENT ENTRY IN MASTER
         L     R8,MTTADDR     ADDRESS OF MTT IN MASTER ADDRESS SPACE
         SR    R9,R8          DISPLACEMENT INTO OUR AREA OF FIRST ENT
         LA    R9,0(R9,R11)   CURRENT ENTRY
         ST    R9,MTTCLINE    MTT CURRENT LINE IN OUR AREA
         L     R9,32(,R11)    FIRST ENTRY IN MTT
         SR    R9,R8          DISPLACEMENT TO FIRST ENTRY
         LA    R9,0(R9,R11)   ADDRESS IN OUR ADDRESS SPACE
         ST    R9,MTTFLINE    SAVE IN MTT FIRST LINE
         L     R9,12(,R11)    LAST BYTE
         SR    R9,R8          GET DISPLACEMENT
         LA    R9,0(R9,R11)   ADDRESS IN OUR AREAOF LAST BYTE
         ST    R9,MTTLLINE    MTT LAST LINE -ACTUALLY ITS THE LAST BYTE
         MVC   CURRLINE,MTTCLINE CURRENT LINE
DISPLAY  L     R5,LASTLINE    ADDRESS OF WHERE TO MOVE CURRENT ENTRY
         L     R6,CURRLINE    CURRENT LINE
         MVI   UPFLAG,X'00'
         MVI   WRAPFLAG,X'00'
         MVI   FOUNDFLG,X'00'
         MVC   BOTTOM,CURRLINE
DISPLOOP SR    R7,R7
         ICM   R7,B'0011',8(R6)  LOAD LENGTH
         BNP   FINDNEXT
         LA    R8,10(R7,R6)
         CLI   SEARCHON,X'FF'
         BE    DISPCHEK
         CLI   UPFLAG,X'FF'
         BNE   DISPSUB
DISPCHEK CLC   CURRLINE,MTTCLINE
         BNL   CHEKLINE
         C     R8,MTTCLINE
         BNL   ENDOFLST
CHEKLINE C     R6,MTTCLINE
         BNL   CHEKWRAP
         C     R8,MTTCLINE
         BNL   ENDOFLST
         B     DISPSUB
CHEKWRAP CLI   WRAPFLAG,X'FF'
         BE    WRITEIT
DISPSUB  S     R7,=F'06'      MINUS SIX
         BNP   FINDNEXT
         CLI   SEARCHON,X'FF'
         BE    SEARCHLN
DISPL    C     R7,SEVENTY9    > 80
         BNH   MOVEDATA       NO - MOVE TO DISPLAY AREA
         S     R7,EIGHTY
         EX    R7,DISPMOV2
         S     R5,EIGHTY
         C     R5,FRSTLINE
         BNH   WRITEIT
         L     R7,SEVENTY9    MAX LENGTH IS 80
MOVEDATA EX    R7,DISPMOVE    MOVE IT TO TERMINAL AREA
*        BAL   R2,SEARCHLN
         S     R5,EIGHTY
         C     R5,FRSTLINE
         BNH   WRITEIT
*        CLI   UPFLAG,X'FF'
*        BE    UP
FINDNEXT ST    R6,CURRLINE
         BAL   R2,PREVLINE    GET NEXT     LINE
         B     DISPLOOP
DOWN     CLC   BOTTOM,MTTCLINE IS THIS NEWEST PAGE?
         BE    AUTHRIZE
         MVI   FOUNDFLG,X'00'
         BAL   R2,CLEARSCR    GET NEXT     LINE
         LA    R5,DETAIL      ADDRESS OF WHERE TO MOVE CURRENT ENTRY
         L     R6,BOTTOM      BECOMES TOP ON PAGE DOWN
         ST    R6,CURRLINE    CURRENT LINE
         ST    R6,TOP         CURRENT LINE
         MVI   DOWNFLAG,X'FF'
*GIVEN A STARTING POINT, WE WILL BE PAGING UP HERE *
DOWNLOOP SR    R7,R7
         ICM   R7,B'0011',8(R6)  LOAD LENGTH
         BNP   FINDNXTD
         LA    R8,10(R7,R6)   NEXT LINE
         C     R8,MTTCLINE
         BNH   DOWNSUB
         C     R6,MTTCLINE
         BNL   DOWNSUB
         MVC   0(80,R5),CENDOFIT
         B     WRITEITD
DOWNSUB  S     R7,=F'06'      MINUS SIX
         BNP   FINDNXTD
         C     R7,SEVENTY9    > 80
         BNH   MOVEDOWN       NO - MOVE TO DISPLAY AREA
         S     R7,EIGHTY
         EX    R7,DISPMOV2
         L     R7,SEVENTY9    MAX LENGTH IS 80
         A     R5,EIGHTY
         C     R5,LASTLINE
         BNL   WRITEITD
MOVEDOWN EX    R7,DISPMOVE    MOVE IT TO TERMINAL AREA
*        BAL   R2,SEARCHLN
         A     R5,EIGHTY
         C     R5,LASTLINE
         BNL   WRITEITD
FINDNXTD ST    R6,CURRLINE
         BAL   R2,UPLINE      GET NEXT     LINE
         B     DOWNLOOP
UP       BAL   R2,UPLINE      PREVIOUS LINE
         B     DISPLOOP
SEARCHLN L     R10,ARGLENG
         LA    R15,15(,R6)    START OF LINE
         LR    R3,R7
         BCTR  R10,0          MINUS ONE
         SR    R3,R10
         BNP   FINDNEXT
COMPLOOP EX    R10,COMPARE    COMPARE THIS TO ARGUMENT
         BE    FOUNDIT
         LA    R15,1(,R15)    NEXT BYTE
         BCT   R3,COMPLOOP
         B     FINDNEXT
FOUNDIT  MVI   SEARCHON,X'00' RESET
         MVI   FOUNDFLG,X'FF'
         ST    R6,SEARCHTP
         B     DISPL
UPLINE   LA    R8,1           INCREMENT 0F 1
         L     R6,CURRLINE
         CLC   R6,MTTFLINE    ARE WE AT TOP
         BH    UPCONTIN       NO - SKIP
         L     R6,MTTLLINE
         S     R6,=F'05'
UPCONTIN LNR   R8,R8          DECREMENT OF -1
         L     R9,MTTFLINE    ADDRESS OF LOWEST ADDRESS IN MTT
         MVI   STARTFLG,X'00' FLAG TO INDICATE FIRST TIME THRU
*        L     R6,CURRLINE    ADDRESS OF CURRENT LINE
         BCTR  R6,0           SUBTRACT  1
UPLOOP   CLC   CBEGINLN,0(R6) BEGINNING OF LINE CHARACTER?
         BE    PREVFND        YES, BRANCH
         BCTR  R6,0           MINUS 1
         CR    R6,R9
         BNL   UPLOOP
*   MEANS WE ARE AT THE LOWEST ADDRESS IN TABLE, NOW START AT THE    *
*   VERY BOTTOM AND WORK BACKWARDS -                                 *
         CLI   STARTFLG,X'00' WE BEEN THRU HERE BEFORE?
         BNE   WRITEITD       YES - BRANCH
         MVI   STARTFLG,X'FF' FLAG IT
         L     R6,MTTLLINE    ADDRESS OF LAST LINE
         S     R6,=F'05'      MINUS SIX
         L     R9,MTTCLINE
         B     UPLOOP         NOW FIND PREVIOUS
PREVLINE LA    R8,1           INCREMENT 0F 1
         L     R6,CURRLINE    ADDRESS OF CURRENT LINE
         LA    R6,1(,R6)      INCREMENT
         C     R6,MTTLLINE    LAST LINE?
         BL    PREVCONT       NO, BRANCH
         L     R6,MTTFLINE    START AT FIRST
         MVI   WRAPFLAG,X'FF' SET TO DISPLAY IT HAS WRAPPED
PREVCONT L     R9,MTTLLINE    ADDRESS OF LOWEST ADDRESS IN MTT
         S     R9,=F'06'      CBEGINLN LENGTH
         BNP   NOTACTIV       NOT POSITIVE, NOT A VALID ENTRY FOR US
         MVI   STARTFLG,X'00' FLAG TO INDICATE FIRST TIME THRU
PREVLOOP CLC   CBEGINLN,0(R6) BEGINNING OF LINE CHARACTER?
         BE    PREVFND        YES, BRANCH
         BXLE  R6,R8,PREVLOOP LOOP
*   MEANS WE ARE AT THE LOWEST ADDRESS IN TABLE, NOW START AT THE    *
*   VERY BOTTOM AND WORK BACKWARDS -                                 *
         CLI   STARTFLG,X'00' WE BEEN THRU HERE BEFORE?
         BNE   WRITEIT        YES - BRANCH
         MVI   STARTFLG,X'FF' FLAG IT
         L     R6,MTTFLINE    ADDRESS OF FRST LINE
         B     PREVLOOP       NOW FIND PREVIOUS
PREVFND  BR    R2             RETURN
WRITEITD BAL   R2,TPUT        WRITE SCREEN
         ST    R6,BOTTOM      SAVE WHERE WE WERE
         B     TGET           GET NEXT INPUT FROM TERMINAL
WRITEIT  EQU   *
         BAL   R2,TPUT        WRITE SCREEN
         ST    R6,TOP         SAVE ADDRESS OF WHERE WE WERE
TGET     MVC   WORKLINE,HEX40S
         MVI   SEARCHON,X'00' RESET SEARCH FLAG
         BAL   R2,CLEARSCR
         L     R5,LASTLINE    ADDRESS OF WHERE TO MOVE CURRENT ENTRY
         L     R6,CURRLINE    CURRENT LINE
         MVI   UPFLAG,X'00'   RESET UP FLAG
         TGET  WORKLINE,70,ASIS
         CLI   WORKLINE,X'F1' PF-1?
         BE    HELPOUT        YES, DISPLAY HELP INFO
         CLI   WORKLINE,X'F3' PF-3?
         BE    FREERET        YES, END
         CLI   WORKLINE,X'F5' SEARCH REPEAT
         BE    SEARCHRP
         CLI   WORKLINE,X'F7' UP?
         BE    UPSET
         CLI   WORKLINE,X'F8'
         BE    DOWN
         CLI   WORKLINE,X'F9'
         BE    SETTOP
         CLI   WORKLINE,X'7A'
         BE    SETBOT
         CLI   WORKLINE,X'7D' PFK USED?
         BE    CHECKOUT       NO, CHECK COMMAND, IF ANY
         CLI   WORKLINE,C'>'  MESSAGE INPUT
         BE    TGET
         B     HELPOUT
CHECKOUT OC    WORKLINE+6(74),HEX40S
         CLC   WORKLINE+6(4),HEX40S
         BE    AUTHRIZE
         MVC   CMDLINE,WORKLINE+6
         CLC   =C'T  ',CMDLINE  TOP
         BE    SETTOP
         CLC   =C'H  ',CMDLINE  TOP
         BE    HELPOUT
         CLC   CMDLINE(4),=C'HELP'
         BE    HELPOUT
         CLC   CMDLINE(3),=C'TOP'
         BE    SETTOP
         CLC   =C'B  ',CMDLINE  TOP
         BE    SETBOT
         CLC   XFINDQ,CMDLINE  F '
         BE    FIND
         CLC   CFIND,CMDLINE  FIND
         BE    FIND
         CLC   CMDLINE(3),=C'BOT'
         BE    SETBOT
         CLC   CMDLINE(3),=C'END'
         BE    FREERET
         CLC   =C'Z ',CMDLINE  TOP
         BE    FREERET
         CLC   =C'X ',CMDLINE  TOP
         BE    FREERET
         STAX  DEFER=YES
         SYSDSVC SVC=244
         MODESET MF=(E,SUPRMOD)
         SLR   R0,0                    CLEAR REG 0
ISSUE    LA    R1,COMMAND              GET ADDRESS OF SVC 34 COMMAND
         SVC   34                      ISSUE COMMAND
         STIMER WAIT,BINTVL=ONE        WAIT ONE SO THAT IT SHOWS
         SR    R1,R1                   ****************************
         L     R1,16                   *  A                       *
         USING CVT,R1                  *   D                      *
         L     R1,CVTTCBP              *    D      J              *
         DROP  R1                      *     R      S             *
         L     R1,4(R1)                *      E      C            *
         USING TCB,R1                  *       S      B           *
         L     R1,TCBJSCB              *        S                 *
         DROP  R1                      ****************************
         NI    236(R1),X'FE'           SET AUTHORIZATION OFF
         MODESET MF=(E,PROBMOD)        PROBLEM STATE
         STAX  DEFER=NO                NOW THEY CAN INTERRUPT
         MVC   CMDLINE,HEX40S
         B     AUTHRIZE
*    FIND OPERATION REQUESTED                                         *
FIND     EQU   *
         OC    WORKLINE+6(74),HEX40S      UPPER CASE
         MVC   WORKLINE(74),WORKLINE+6    MOVE OVER
         MVC   ARGUMENT(74),HEX40S        CLEAR OUT
         LA    R8,1
         LA    R6,WORKLINE
         LA    R9,74(,R6)
         LA    R7,ARGUMENT
FINDQUOT CLI   0(R6),X'7D'
         BE    FOUNQUOT
         LA    R6,1(,R6)
         CR    R6,R9
         BL    FINDQUOT
         B     REENTER
FOUNQUOT LA    R6,1(,R6)
ARGLOOP  CLI   0(R6),X'7D'
         BE    ARGDONE
         MVC   0(1,R7),0(R6)
         LA    R7,1(,R7)
         BXLE  R6,R8,ARGLOOP
*  IF IT GETS HERE - ARGUMENT WAS INVALID                             *
REENTER  BAL   R2,CLEARSCR
         MVC   DETAIL+258(30),=C'PLEASE REENTER SEARCH ARGUMENT'
         MVC   DETAIL+418(25),=C'ENCLOSED IN SINGLE QUOTES'
         BAL   R2,TPUT
         B     TGET
SEARCH   B     FREERET
ENDOFLST MVC   0(80,R5),CENDOFIT
         CLI   SEARCHON,X'FF'
         BNE   WRITEIT
         MVC   24(25,R5),=C'SEARCH ARGUMENT NOT FOUND'
         MVI   FOUNDFLG,X'00'
         B     WRITEIT
SEARCHRP CLI   SRCHFLAG,X'FF'
         BNE   REENTER
         CLI   FOUNDFLG,X'FF'
         BNE   LOADCURR
         MVC   CURRLINE,SEARCHTP WHERE TO PICK UP
LOADCURR L     R6,CURRLINE
         MVI   FOUNDFLG,X'00'
         BAL   R2,PREVLINE
         ST    R6,CURRLINE
         MVI   SEARCHON,X'FF'
         B     UPSET
ARGDONE  LA    R8,ARGUMENT
         SR    R7,R8
         BNP   REENTER
         ST    R7,ARGLENG
         MVI   FOUNDFLG,X'00' NOT FOUND YET
         MVI   SRCHFLAG,X'FF' SEARCH ARGUMENT IS PRESENT
         MVI   SEARCHON,X'FF' PLEASE SEARCH
         L     R6,BOTTOM
         B     SETBOT2
SETBOT   L     R6,MTTCLINE
SETBOT2  ST    R6,CURRLINE
         L     R5,LASTLINE
         B     DISPLOOP
SETTOP   L     R6,MTTCLINE
         ST    R6,CURRLINE
         BAL   R2,UPLINE
         ST    R6,CURRLINE
         BAL   R2,UPLINE
         ST    R6,BOTTOM
         B     DOWN
UPSET    MVI   UPFLAG,X'FF'
         CLI   DOWNFLAG,X'FF'
         BNE   UPSET2
         MVC   CURRLINE,TOP
         MVI   DOWNFLAG,X'00'
UPSET2   L     R5,LASTLINE    ADDRESS OF WHERE TO MOVE CURRENT ENTRY
         L     R6,CURRLINE    WHERE WE LEFT OFF
         ST    R6,BOTTOM
         MVI   FOUNDFLG,X'00'
         B     DISPLOOP
COMPARE  CLC   0(0,R15),ARGUMENT  LOOK FOR SEARCH ARGUMENT
DISPMOVE MVC   0(0,R5),15(R6) SKIP CONTROL STUFF
DISPMOV2 MVC   0(0,R5),95(R6) SKIP CONTROL STUFF
TPUT     LA    R1,SCREEN
         L     R0,SCRTPUTL
         TPUT  (1),(0),FULLSCR
         BR    R2
HELPOUT  BAL   R2,CLEARSCR    GO CLEAR OUR SCREEN
         MVC   DETAIL+80(80),CHELPLN0
         MVC   DETAIL+160(80),CHELPLN1
         MVC   DETAIL+400(80),CHELPLN2
         MVC   DETAIL+480(80),CHELPLN3
         MVC   DETAIL+640(39),CHELPLN4
         MVC   DETAIL+720(43),CHELPLN5
         MVC   DETAIL+880(43),CHELPLN6
         BAL   R2,TPUT
         B     TGET
NOTACTIV BAL   R2,CLEARSCR    GO CLEAR OUR SCREEN
         MVC   DETAIL(26),=C'MASTER TRACE IS NOT ACTIVE'
         BAL   R2,TPUT
         STIMER WAIT,BINTVL=ONE
         L     R2,CPPLSAVE
         LINK  EP=ZTPR0200
         B     FREERET
**   CLEAR THE SCREEN AREA AND RETURN TO ADDRESS IN REG 2            **
CLEARSCR LA    R6,DETAIL
         L     R7,SCRLENG
         SR    R9,R9
         ICM   R9,B'1001',HEX40S
         LA    R8,HEX40S
         MVCL  R6,R8
         BR    R2
DSCREEN  DS    0C             DISPLAY SCREEN
         DC    X'28'          CONTROL
         DC    X'00'          ERASE/WRITE ALTERNATE (132 COL)
         DC    X'00115D7F1140403C404000' CLEAR SCREEN
         DC    CL80'                  MASTER  TRACE  TABLE  DISPLAY    *
                             PF-1 FOR HELP '
         DC    X'11'          SET BUFFER ADDRESS
         DC    X'F460'        (43,1)
*        DC    C'_'
         DC    X'1DC8'        MARK NEXT FIELD AS INPUT FIELD
         DC    X'13'          SET CURSOR ADDRESS
         DC    X'11'          SET BUFFER ADDRESS
         DC    X'F5E7'        (43,72)
         DC    X'1DF0'        TERMINATE INPUT FIELD
         DC    C' '           INDICATES MORE TO BE DISPLAYED
         DC    X'11'          SET BUFFER ADDRESS
         DC    X'C150'        (2,1)
*DLINE1  DC    40CL80' '      MESSAGE TEXT AREA (FOR 40X80 MAX)
DSCREENL EQU   *-DSCREEN      LENGTH OF THIS PART
FOUR     DC    F'4'
CENDOFIT DC    CL80'* * * * * * * * * * * * E N D * * O F * * D A T A **
               * * * * * * * * * * * * * * '
CHELPLN0 DC    CL80'  THIS PROGRAM USES CROSS MEMORY SERVICES TO READ T*
               HE MASTER TRACE TABLE IN    '
CHELPLN1 DC    CL80'  THE MASTER ADDRESS SPACE. THE MASTER TRACE MUST B*
               E ACTIVE TO PAGE UP/DOWN.   '
CHELPLN2 DC    CL80'  PF-1  HELP            PF-3  END                PF*
               -5  REPEAT FIND   PF-7  UP  '
CHELPLN3 DC    CL80'  PF-8  PAGE DOWN       PF-9  TOP (OLDEST)       PF*
               -10 BOTTOM (NEWEST)         '
CHELPLN4 DC    CL39'  T OR TOP MAY BE USED INSTEAD OF PF-9 '
CHELPLN5 DC    CL43'  B OR BOTTOM MAY BE USED INSTEAD OF PF-10 '
CHELPLN6 DC    CL43'  F OR FIND WITH ARGUMENT IN SINGLE QUOTES '
         DS    0F
AUTH     DC    CL4'AUTH'
MTT      DC    CL3'MTT'       MASTER TRACE TABLE HEADER
TBL      DS    0CL45
         DC    XL3'080115'        HAN K
         DC    XL3'260802'        WHB
         DC    XL3'141301'        MLA
         DC    XL3'041917'        DRP
         DC    XL3'141223'        MKT
         DC    XL3'030722'        CGS
         DC    XL3'050614'        EFM
         DC    XL3'051719'        EPR
         DC    XL3'040226'        DBW
         DC    XL3'122200'        KS
         DC    XL3'122217'        KSP
         DC    XL3'220422'        SDS
* MISCELLANEOUS DP&L LOGONS                                           *
         DC    XL3'071403'        GMC
*        DC    XL3'022205'        BSE
         DC    XL3'141308'        MLH
         DC    XL3'010611'        AFJ
         DC    XL3'130412'        LDK
         DC    XL3'142419'        MUR F
         DC    XL3'171414'        PMM  MURF AGAIN
         DC    XL3'171303'        PLC
         DC    XL3'190622'        RFS
         DC    XL3'070323'        GCT
         DC    XL3'140617'        MFP
         DC    XL3'030123'        CAT
         DC    XL3'061615'        FON
HEXFS    DC    XL4'FFFFFFFF'
HEXZIP   DC    XL4'00000000'
CMAINT   DC    XL5'1401091523'
COMMANDL DC    Y(76),Y(00)
ONE      DC    A(100)             1 SECOND
CBEGINLN DC    XL4'00000001'
EIGHTY   DC    F'080'             CONSTANT 80
SEVENTY9 DC    F'079'             CONSTANT 79
ANDCHARS DC    XL8'3F3F3F3F3F3F3F3F'
MSGNO1   DC    CL13'SYSTEM ACTIVE'
MSG1     DC    CL33'***FREEMAIN ERROR ON SAVEAREA ***'
MSG2     DC    CL33'***FREEMAIN ERROR ON MTT AREA ***'
MSG3     DC    CL33'***COULD NOT LOAD IKJEFFUT***'
XFINDQ   DC    XL3'C6407D'        HEX FOR F '
CFIND    DC    CL4'FIND'          CHARACTER FIND
CEND     DC    CL3'END'           CHARACTER END
CZ       DC    CL1'Z'             CHARACTER Z
PATTERN  DC    XL4'40202120'
AXLIST   DC    H'1'
         DC    H'0'
SUPRMOD  MODESET MF=L,MODE=SUP,KEY=ZERO
PROBMOD  MODESET MF=L,MODE=PROB,KEY=NZERO
SAVDSECT DSECT
SAVEAREA DS    18F
DOUBLWD  DS    D
PARMWKAD DS    F
CPPLSAVE DS    F
         DS    0D
WORKLINE DS    CL80
HEX40S   DS    CL80
PARMWORK DS    CL44
USERID   DS    CL7
USERIDL  DS    XL1
USERATTR DS    XL1
STARTFLG DS    XL1
SRCHFLAG DS    XL1
FOUNDFLG DS    XL1
SEARCHON DS    XL1
UPFLAG   DS    XL1
WRAPFLAG DS    XL1
DOWNFLAG DS    XL1
MTTSIZE  DS    F              SIZE OF MTT
MTTADDR  DS    F              MTT ADDRESS IN MASTER ASID
BOTTOM   DS    F              BOTTOM    OF SCREEN
TOP      DS    F              TOP OF SCREEN
SEARCHTP DS    F              CURRENT LINE FOR REPEAT SEARCH
CURRLINE DS    F              CURRENT LINE FOR US
FRSTLINE DS    F              FIRST LINE ON OUR DISPLAY
LASTLINE DS    F              LAST  LINE ON OUR DISPLAY
MTTFLINE DS    F              FIRST LINE IN OUR AREA
MTTLLINE DS    F              LAST  LINE IN OUR AREA
MTTCLINE DS    F              CURRENT LINE IN OUR AREA
SCRLENG  DS    F
SCRTPUTL DS    F
ARGLENG  DS    F
ARGUMENT DS    CL74
COMMAND  DS    F
CMDLINE  DS    CL72
SCREEN   DS    0CL108
         DS    XL1            CONTROL
DSCRO1   DS    XL1            ERASE/WRITE ALTERNATE (132 COL)
         DS    XL11
         DS    CL80
         DS    XL1            SET BUFFER ADDRESS
DSCRO3   DS    XL2            (43,1)
*        DS    XL1
         DS    XL2            MARK NEXT FIELD AS INPUT FIELD
         DS    XL1            SET CURSOR ADDRESS
         DS    XL1            SET BUFFER ADDRESS
DSCRO4   DS    XL2
         DS    XL2            TERMINATE INPUT FIELD
         DS    XL2            SET BUFFER ADDRESS
DSCRO5   DS    XL2
DETAIL   DS    43CL80
WORKL    EQU   *-SAVEAREA
         CVT   DSECT=YES
         IEZJSCB
         IKJTCB DSECT=YES
         IEEBASEA
         IEECHAIN
         IKJPSCB
         IKJCPPL
         IKJUPT
         END
./ ADD NAME=MTTJ
//MURFJ  JOB (6496,B),MURPHY,CLASS=T,MSGCLASS=T,NOTIFY=MURF
//*
//*  CHANGE SYSLIB ACCORDING TO YOUR IPORES
//*  CHANGE SYSLIB AND SYLMOD IN LKED STEP TO LINK LIST LIBRARY
//*
//COM     EXEC PGM=IFOX00,REGION=512K,
//    PARM='LOAD,XREF(SHORT),LINECNT=55,NODECK'
//*
//SYSLIB   DD  DISP=SHR,DSN=SYS1.SMPMTS,DCB=BLKSIZE=23440
//         DD  DISP=SHR,DSN=SYS1.MACLIB
//         DD  DISP=SHR,DSN=SYS1.AMODGEN
//         DD  DISP=SHR,DSN=MURF.SHARE.LIBRARY
//SYSGO    DD  UNIT=VIO,DSN=&LOADSET,DISP=(MOD,PASS),
//             SPACE=(CYL,(2,2)),DCB=BLKSIZE=1680
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(10,2))
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,(12,2))
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,(20,2))
//SYSPUNCH DD  DUMMY =*,DCB=FUNC=I
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSIN    DD  DSN=MURF.SHARE.LIBRARY(MTT),DISP=SHR
//*
//LKED         EXEC PGM=IEWL,REGION=1024K,COND=(4,LT),
//             PARM='XREF,LET,LIST,NCAL'
//SYSPRINT     DD   SYSOUT=*
//SYSUT1       DD   DSN=&SYSUT1,UNIT=SYSDA,SPACE=(CYL,(1,1))
//SYSLMOD      DD   DISP=SHR,DSN=SYS1.LINKLIB(MTT)
//SYSLIN       DD   UNIT=SYSDA,DSN=&LOADSET,DISP=(OLD,DELETE)
//             DD   DDNAME=SYSIN
./ ADD NAME=MTTXA
***********************************************************************
*   TITLE: MTTXA                                                      *
*   AUTHOR: P.M.MURPHY                                                *
*   DATE-WRITTEN: 10/16/84                                            *
*   REFERENCE: OS/VS2 MVS SYSTEM PROGRAMMING LIBRARY:SUPERVISOR       *
*              GC28-1046-1                                            *
*   REMARKS:                                                          *
*                                                                     *
*        USE CROSS MEMORY SERVICES TO PAGE THROUGH CONSOLE MESSAGES   *
*   IN THE MASTER TRACE TABLE IN THE MASTER ADDRESS SPACE.            *
*                                                                     *
***********************************************************************
*******************************************************************     DOC FILE
*                                                                 *     DOC FILE
*                     D I S C L A I M E R                         *     DOC FILE
*                                                                 *     DOC FILE
*******************************************************************     DOC FILE
*                                                                 *     DOC FILE
* THIS MATERIAL HAS BEEN USED SUCCESSFULLY & TO THE BEST OF OUR   *     DOC FILE
* KNOWLEDGE  THEY  ARE  OPERATIONAL, HOWEVER  NO  WARRANTY        *     DOC FILE
* IS MADE TO THE ACCURACY OF THE PROGRAMS OR RELATED MATERIAL AND *     DOC FILE
* NO RESPONSIBILITY IS ASSUMED  FOR ANY MODIFICATION  DIRECTLY OR *     DOC FILE
* INDIRECTLY  CAUSED BY  THEIR USE.  IT IS THE USERS              *     DOC FILE
* RESPONSIBILITY  TO  EVALUATE THE  USEFULLNESS  OF THE  MATERIAL *     DOC FILE
* SUPPLIED .                                                      *     DOC FILE
*                                                                 *     DOC FILE
* WE DO NOT GUARANTEE TO  KEEP ANY  MATERIAL PROVIDED  UP TO DATE *     DOC FILE
* NOR DO WE GUARANTEE TO  PROVIDE ANY  CORRECTIONS OR  EXTENSIONS *     DOC FILE
* DESCRIBED BY THE USER OR  CORRECTIONS OR EXTENSIONS MADE IN THE *     DOC FILE
* FUTURE .                                                        *     DOC FILE
*                                                                 *     DOC FILE
*******************************************************************     DOC FILE
MTTXA CSECT
         BEGIN PROGRAM=MTTXA
*        SAVES REGISTERS AND INSERTS PROGRAM, DATE, AND TIME
         LR    R12,R15            LOAD ADDRESS OF ENTRY POINT
         LR    R2,R1              SAVE CPPL
         USING MTTXA,R12          R12 BASE REGISTER
         GETMAIN RC,LV=WORKL      GETMAIN  FOR SAVEAREA/WORK
         LTR   R15,R15            CHECK RETURN CODE
         BNZ   GETMERR
         LR    R3,R1              ADDRESS OF WORK AREA/SAVEAREA
         USING SAVDSECT,R3        ADDRESSABILITY
         ST    R13,SAVEAREA+4     STORE CALLER SAVEAREA ADDRESS (HSA)
         ST    R3,8(,R13)         ADD OF PROGRAM SAVE IN CALLER(LSA)
         LR    R13,R3             ADDRESS OF SAVEAREA IN R13
         DROP  R3
         USING SAVDSECT,R13
         USING CPPL,R2
         L     R6,CPPLPSCB
         DROP  R2
         USING PSCB,R6
         MVC   USERID,PSCBUSER
         MVC   USERIDL,PSCBUSRL
*        MVC   USERATTR,PSCBATR2  USER ATTRIBUTE BYTE, IN CASE I USE IT
         MVI   USERFLAG,X'00'
         DROP  R6
         ST    R2,CPPLSAVE
         MVC   SCRTPUTL,=AL4(DSCREENL+41*80) LENGTH FOR TPUT 43 LINE
         MVC   SCRLENG,=AL4(41*80) LENGTH FOR MOVE LONG 43 LINE DEFAULT
         MVC   SCREEN(108),DSCREEN SCREEN IMAGE
         GTSIZE
         LTR   R0,R0
         BZ    FREERET2            NON-DISPLAY TERMINAL
         CH    R1,=H'80'           80 WIDE?
         BNE   SETM2               NO - SET IT TO THIS
         CH    R0,=H'43'           MOD 4?
         BE    VERIFY
         CH    R0,=H'32'           MOD 3?
         BNE   SETM2
MODEL3   MVC   SCRLENG,=AL4(28*80) 30 LINE DISPLAY
         MVC   SCRTPUTL,=AL4(28*80+DSCREENL)
         MVC   DSCRO3,=X'E6F0'     (32,1)
         MVC   DSCRO4,=X'E7F7'     (32,72)
         B     VERIFY
SETM2    STSIZE SIZE=80,LINE=24
         MVC   SCRLENG,=AL4(22*80) LENGTH FOR MOVE LONG
         MVC   SCRTPUTL,=AL4(22*80+DSCREENL) LENGTH OF TPUT
         MVC   DSCRO3,=X'5CF0'     24,1
         MVC   DSCRO4,=X'5DF7'     24,72
VERIFY   EQU   *
         STFSMODE ON,INITIAL=YES
         LA    R7,TABLEND
         LA    R6,4
         LA    R1,TABLE
TBLOOP   CLC   0(4,R1),USERID
         BE    USEROK
         BXLE  R1,R6,TBLOOP
         BE    NOAUTH
*SEROK   MVI   USERFLAG,X'FF'
USEROK   EQU   *
VEROK    STAX  DEFER=YES         WE DO NOT WANT AN INTERRUPT WHILE
         SYSDSVC
         MODESET MF=(E,SUPRMOD)
         AXRES AXLIST=AXLIST     RESERVE AN AUTHORIZATION INDEX IN A.T.
         LA    R1,1              MASTER IS ASID 1
         AXEXT ASID=(1)          DETERMINE AUTH TABLE VALUE OF ASID 1
         AXSET AX=(0)            SET TO ASID 1'S AUTHORIZATION INDEX
         L     R1,16
         USING CVT,R1
         L     R1,CVTTCBP
         DROP  R1
         L     R1,4(R1)
         USING TCB,R1
         L     R1,TCBJSCB
         DROP  R1
         USING IEZJSCB,R1
         NI    JSCBOPTS,X'FF'-JSCBAUTH
         DROP  R1
         MODESET MF=(E,PROBMOD)
         STAX  DEFER=NO
         MVC   COMMAND,COMMANDL
         MVI   HEX40S,X'40'         SPACE
         MVC   HEX40S+1(79),HEX40S  PROPAGATE SPACES TO INITIALIZE
         L     R2,SCRLENG           SCREEN LENGTH
         S     R2,=F'0160'          MINUS 2 LINES
         LA    R5,DETAIL            ADDRESS OF SCREEN
         ST    R5,FRSTLINE
         LA    R2,0(R5,R2)          ADDRESS IN GETMAIN AREA
         ST    R2,LASTLINE          SAVE THE ADDRESS
         LA    R1,16
         L     R1,0(R1)
         USING CVT,R1
         L     R1,CVTMSER
         DROP  R1
         USING BASE,R1
         L     R3,BAMTTBL        ADDRESS OF MASTER TRACE TABLE
         ICM   R4,B'0111',BAMTLEN LENGTH OF MTT W/O FIRST BYTE OF WORD
         BZ    NOTACTIV
         ST    R4,MTTSIZE
         ST    R3,MTTADDR
         DROP  R1
         GETMAIN RC,LV=(4)       LENGTH WAS IN R4
         LTR   R15,R15
         BNZ   GETMERR
         LR    R11,R1            ADDRESS OF OUR FUTURE COPY OF MTT
*        B     NOTACTIV
AUTHRIZE STAX  DEFER=YES         WE DO NOT WANT AN INTERRUPT WHILE
         L     R9,MTTSIZE
         L     R3,MTTADDR
         SRA   R9,8             DIVIDE BY 256
         BNP   NOTACTIV
         SYSDSVC
         MODESET MF=(E,SUPRMOD)
*        AXRES AXLIST=AXLIST     RESERVE AN AUTHORIZATION INDEX IN A.T.
*        LA    R1,1              MASTER IS ASID 1
*        AXEXT ASID=(1)          DETERMINE AUTH TABLE VALUE OF ASID 1
*        AXSET AX=(0)            SET TO ASID 1'S AUTHORIZATION INDEX
         LA    R1,1
         SSAR  R1                SECONDARY ADDRESS SPACE OF ASID 1!!!
         SR    R5,R5
         LA    R6,0(R4,R11)      END OF GETMAIN AREA
         LA    R7,256
         LR    R10,R11
MOVELOOP MVCP  0(R7,R10),0(R3),R5 MOVES MAX OF 256 BYTES
         LA    R10,256(,R10)
         LA    R3,256(,R3)
         BCT   R9,MOVELOOP
         B     ALLMOVED
FREERET  L     R4,MTTSIZE
         FREEMAIN RC,LV=(4),A=(11) FREE SECOND GETMAIN AREA
         LTR   R15,R15            CHECK RETURN CODE
         BNZ   FREEMERR
FREERET2 LR    R3,R13
         L     R13,4(,R13)        ADDRESS OF CALLING PROGRAM SAVEAREA
         FREEMAIN RC,LV=WORKL,A=(3) FREE STORAGE
         LTR   R15,R15            CHECK RETURN CODE
         BNZ   FREEERR2
RETURN   RETURN (14,12),,RC=(15)
GETMERR  WTO   ' MTTXA - GETMAIN ERROR, PLEASE NOTIFY TECH SUPPORT',   X
               ROUTCDE=2
         L     R13,4(,R13)        RELOAD R13
         B     RETURN
BADLOAD  TPUT  BADLDMSG,25
NOAUTH   TPUT  MSGNO1,13
         B     FREERET2
FREEMERR TPUT  MSG2,33
         B     FREERET2
FREEERR2 TPUT  MSG1,33
         B     RETURN
ALLMOVED EPAR  R1             EXTRACT PRIMARY ASID INTO R1
         SSAR  R1             SET SECONDARY TO OUR ASID
         L     R1,16
         USING CVT,R1
         L     R1,CVTTCBP
         DROP  R1
         L     R1,4(R1)
         USING TCB,R1
         L     R1,TCBJSCB
         DROP  R1
         USING IEZJSCB,R1
         NI    JSCBOPTS,X'FF'-JSCBAUTH
         DROP  R1
         MODESET MF=(E,PROBMOD)
         STAX  DEFER=NO
ADJUST   CLC   MTT,0(R11)     MTT HEADER
         BNE   NOTACTIV
         L     R9,4(,R11)     THIS IS THE CURRENT ENTRY IN MASTER
         L     R8,MTTADDR     ADDRESS OF MTT IN MASTER ADDRESS SPACE
         SR    R9,R8          DISPLACEMENT INTO OUR AREA OF FIRST ENT
         LA    R9,0(R9,R11)   CURRENT ENTRY
         ST    R9,MTTCLINE    MTT CURRENT LINE IN OUR AREA
         L     R9,32(,R11)    FIRST ENTRY IN MTT
         SR    R9,R8          DISPLACEMENT TO FIRST ENTRY
         LA    R9,0(R9,R11)   ADDRESS IN OUR ADDRESS SPACE
         ST    R9,MTTFLINE    SAVE IN MTT FIRST LINE
         L     R9,12(,R11)    LAST BYTE
         SR    R9,R8          GET DISPLACEMENT
         LA    R9,0(R9,R11)   ADDRESS IN OUR AREAOF LAST BYTE
         ST    R9,MTTLLINE    MTT LAST LINE -ACTUALLY ITS THE LAST BYTE
         MVC   CURRLINE,MTTCLINE CURRENT LINE
DISPLAY  L     R5,LASTLINE    ADDRESS OF WHERE TO MOVE CURRENT ENTRY
         L     R6,CURRLINE    CURRENT LINE
         MVI   UPFLAG,X'00'
         MVI   WRAPFLAG,X'00'
         MVI   FOUNDFLG,X'00'
         MVC   BOTTOM,CURRLINE
DISPLOOP SR    R7,R7
         ICM   R7,B'0011',8(R6)  LOAD LENGTH
         BNP   FINDNEXT
         LA    R8,10(R7,R6)
         CLI   SEARCHON,X'FF'
         BE    DISPCHEK
         CLI   UPFLAG,X'FF'
         BNE   DISPSUB
DISPCHEK CLC   CURRLINE,MTTCLINE
         BNL   CHEKLINE
         C     R8,MTTCLINE
         BNL   ENDOFLST
CHEKLINE C     R6,MTTCLINE
         BNL   CHEKWRAP
         C     R8,MTTCLINE
         BNL   ENDOFLST
         B     DISPSUB
CHEKWRAP CLI   WRAPFLAG,X'FF'
         BE    WRITEIT
DISPSUB  CLI   SEARCHON,X'FF'
         BE    SEARCHLN
         S     R7,=F'51'      MINUS CONTROL STUFF
         BNP   FINDNEXT
DISPL    C     R7,SEVENTY9    > 80
         BNH   MOVEDATA       NO - MOVE TO DISPLAY AREA
         S     R7,EIGHTY
         LA    R1,112(R6,R7)  LAST BYTE ADDRESS
         S     R1,MTTLLINE    ADD OF 0C4 BYTE
         BC    12,EX01
         SR    R7,R1
         BCTR  R7,0
         BC    2,EX01
         B     FINDNEXT
EX01     EX    R7,DISPMOV2
         S     R5,EIGHTY
         C     R5,FRSTLINE
         BNH   WRITEIT
         LA    R7,62          MAX LENGTH IS 80
MOVEDATA LA    R1,63(R6,R7)   LAST BYTE ADDRESS
         S     R1,MTTLLINE    ADD OF 0C4 BYTE
         BC    12,EX02
         SR    R7,R1
         BCTR  R7,0
         BC    2,EX02
         B     FINDNEXT
EX02     EX    R7,DISPMOVE    MOVE IT TO TERMINAL AREA
         MVC   09(9,R5),44(R6) SKIP CONTROL STUFF
         CLC   =CL2'40',33(R6)
         BE    SKIPTIM
         MVC   00(8,R5),32(R6) SKIP CONTROL STUFF
*        BAL   R2,SEARCHLN
SKIPTIM  S     R5,EIGHTY
         C     R5,FRSTLINE
         BNH   WRITEIT
*        CLI   UPFLAG,X'FF'
*        BE    UP
FINDNEXT ST    R6,CURRLINE
         BAL   R2,PREVLINE    GET NEXT     LINE
         B     DISPLOOP
DOWN     CLC   BOTTOM,MTTCLINE IS THIS NEWEST PAGE?
         BE    AUTHRIZE
         MVI   FOUNDFLG,X'00'
         BAL   R2,CLEARSCR    GET NEXT     LINE
         LA    R5,DETAIL      ADDRESS OF WHERE TO MOVE CURRENT ENTRY
         L     R6,BOTTOM      BECOMES TOP ON PAGE DOWN
         ST    R6,CURRLINE    CURRENT LINE
         ST    R6,TOP         CURRENT LINE
         MVI   DOWNFLAG,X'FF'
*GIVEN A STARTING POINT, WE WILL BE PAGING UP HERE *
DOWNLOOP SR    R7,R7
         ICM   R7,B'0011',8(R6)  LOAD LENGTH
         BNP   FINDNXTD
         LA    R8,10(R7,R6)   NEXT LINE
         C     R8,MTTCLINE
         BNH   DOWNSUB
         C     R6,MTTCLINE
         BNL   DOWNSUB
         MVC   0(80,R5),CENDOFIT
         B     WRITEITD
DOWNSUB  S     R7,=F'51'      MINUS SIX
         BNP   FINDNXTD
         C     R7,SEVENTY9    > 80
         BNH   MOVEDOWN       NO - MOVE TO DISPLAY AREA
         S     R7,EIGHTY
         LA    R1,112(R6,R7)  LAST BYTE ADDRESS
         S     R1,MTTLLINE    ADD OF 0C4 BYTE
         BC    12,EX03
         SR    R7,R1
         BCTR  R7,0
         BC    2,EX03
         B     FINDNXTD
EX03     EX    R7,DISPMOV2
         LA    R7,62          MAX LENGTH IS 80
         A     R5,EIGHTY
         C     R5,LASTLINE
         BNL   WRITEITD
MOVEDOWN LA    R1,63(R6,R7)   LAST BYTE ADDRESS
         S     R1,MTTLLINE    ADD OF 0C4 BYTE
         BC    12,EX04
         SR    R7,R1
         BCTR  R7,0
         BC    2,EX04
         B     FINDNXTD
EX04     EX    R7,DISPMOVE    MOVE IT TO TERMINAL AREA
         MVC   09(9,R5),44(R6) SKIP CONTROL STUFF
         CLC   =CL2'40',33(R6)
         BE    SKIPTIM2
         MVC   00(8,R5),32(R6) SKIP CONTROL STUFF
*        BAL   R2,SEARCHLN
SKIPTIM2 A     R5,EIGHTY
         C     R5,LASTLINE
         BNL   WRITEITD
FINDNXTD ST    R6,CURRLINE
         BAL   R2,UPLINE      GET NEXT     LINE
         B     DOWNLOOP
UP       BAL   R2,UPLINE      PREVIOUS LINE
         B     DISPLOOP
SEARCHLN L     R10,ARGLENG
         LA    R15,15(,R6)    START OF LINE
         LR    R3,R7
         SR    R3,R10
         BNP   FINDNEXT
COMPLOOP EX    R10,COMPARE    COMPARE THIS TO ARGUMENT
         BE    FOUNDIT
         LA    R15,1(,R15)    NEXT BYTE
         LA    R1,0(R15,R10)
         C     R1,MTTLLINE
         BNL   FINDNEXT
         BCT   R3,COMPLOOP
         B     FINDNEXT
FOUNDIT  MVI   SEARCHON,X'00' RESET
         MVI   FOUNDFLG,X'FF'
         S     R7,=F'51'
         ST    R6,SEARCHTP
         ST    R6,CURRLINE
         ST    R6,BOTTOM
         B     DISPL
UPLINE   LA    R8,1           INCREMENT 0F 1
         L     R6,CURRLINE
         CLC   R6,MTTFLINE    ARE WE AT TOP
         BH    UPCONTIN       NO - SKIP
         L     R6,MTTLLINE
         S     R6,=F'05'
UPCONTIN LNR   R8,R8          DECREMENT OF -1
         L     R9,MTTFLINE    ADDRESS OF LOWEST ADDRESS IN MTT
         MVI   STARTFLG,X'00' FLAG TO INDICATE FIRST TIME THRU
*        L     R6,CURRLINE    ADDRESS OF CURRENT LINE
         BCTR  R6,0           SUBTRACT  1
UPLOOP   CLC   CBEGINLN,0(R6) BEGINNING OF LINE CHARACTER?
         BE    PREVFND        YES, BRANCH
         BCTR  R6,0           MINUS 1
         CR    R6,R9
         BNL   UPLOOP
*   MEANS WE ARE AT THE LOWEST ADDRESS IN TABLE, NOW START AT THE    *
*   VERY BOTTOM AND WORK BACKWARDS -                                 *
         CLI   STARTFLG,X'00' WE BEEN THRU HERE BEFORE?
         BNE   WRITEITD       YES - BRANCH
         MVI   STARTFLG,X'FF' FLAG IT
         L     R6,MTTLLINE    ADDRESS OF LAST LINE
         S     R6,=F'05'      MINUS SIX
         L     R9,MTTCLINE
         B     UPLOOP         NOW FIND PREVIOUS
PREVLINE LA    R8,1           INCREMENT 0F 1
         L     R6,CURRLINE    ADDRESS OF CURRENT LINE
         LA    R6,1(,R6)      INCREMENT
         C     R6,MTTLLINE    LAST LINE?
         BL    PREVCONT       NO, BRANCH
         L     R6,MTTFLINE    START AT FIRST
         MVI   WRAPFLAG,X'FF' SET TO DISPLAY IT HAS WRAPPED
PREVCONT L     R9,MTTLLINE    ADDRESS OF LOWEST ADDRESS IN MTT
         S     R9,=F'06'      CBEGINLN LENGTH
         BNP   NOTACTIV       NOT POSITIVE, NOT A VALID ENTRY FOR US
         MVI   STARTFLG,X'00' FLAG TO INDICATE FIRST TIME THRU
PREVLOOP CLC   CBEGINLN,0(R6) BEGINNING OF LINE CHARACTER?
         BE    PREVFND        YES, BRANCH
         BXLE  R6,R8,PREVLOOP LOOP
*   MEANS WE ARE AT THE LOWEST ADDRESS IN TABLE, NOW START AT THE    *
*   VERY BOTTOM AND WORK BACKWARDS -                                 *
         CLI   STARTFLG,X'00' WE BEEN THRU HERE BEFORE?
         BNE   WRITEIT        YES - BRANCH
         MVI   STARTFLG,X'FF' FLAG IT
         L     R6,MTTFLINE    ADDRESS OF FRST LINE
         B     PREVLOOP       NOW FIND PREVIOUS
PREVFND  BR    R2             RETURN
WRITEITD BAL   R2,TPUT        WRITE SCREEN
         ST    R6,BOTTOM      SAVE WHERE WE WERE
         B     TGET           GET NEXT INPUT FROM TERMINAL
WRITEIT  EQU   *
         BAL   R2,TPUT        WRITE SCREEN
         ST    R6,TOP         SAVE ADDRESS OF WHERE WE WERE
TGET     MVC   WORKLINE,HEX40S
         MVI   SEARCHON,X'00' RESET SEARCH FLAG
         BAL   R2,CLEARSCR
         L     R5,LASTLINE    ADDRESS OF WHERE TO MOVE CURRENT ENTRY
         L     R6,CURRLINE    CURRENT LINE
         MVI   UPFLAG,X'00'   RESET UP FLAG
         TGET  WORKLINE,70,ASIS
         CLI   WORKLINE,X'7D' PFK USED?
         BE    CHECKOUT       NO, CHECK COMMAND, IF ANY
         NI    WORKLINE,X'0F'
         CLI   WORKLINE,X'01' PF-1?
         BE    HELPOUT        YES, DISPLAY HELP INFO
         CLI   WORKLINE,X'03' PF-3?
         BE    FREERET        YES, END
         CLI   WORKLINE,X'05' SEARCH REPEAT
         BE    SEARCHRP
*        CLI   WORKLINE,X'06' SEARCH REPEAT
*        BE    ABEND
         CLI   WORKLINE,X'07' UP?
         BE    UPSET
         CLI   WORKLINE,X'08'
         BE    DOWN
         CLI   WORKLINE,X'09'
         BE    SETTOP
         CLI   WORKLINE,X'0A'
         BE    SETBOT
         CLI   WORKLINE,C'>'  MESSAGE INPUT
         BE    TGET
         B     AUTHRIZE
ABEND    AP    WORKLINE(3),WORKLINE(2)
CHECKOUT OC    WORKLINE+6(74),HEX40S
         CLC   WORKLINE+6(4),HEX40S
         BE    AUTHRIZE
         MVC   CMDLINE,WORKLINE+6
         CLC   =C'T  ',CMDLINE  TOP
         BE    SETTOP
         CLC   =C'H  ',CMDLINE  TOP
         BE    HELPOUT
         CLC   CMDLINE(4),=C'HELP'
         BE    HELPOUT
         CLC   CMDLINE(3),=C'TOP'
         BE    SETTOP
         CLC   =C'B  ',CMDLINE  TOP
         BE    SETBOT
         CLC   XFINDQ,CMDLINE  F '
         BE    FIND
         CLC   CFIND,CMDLINE  FIND
         BE    FIND
         CLC   CMDLINE(3),=C'BOT'
         BE    SETBOT
         CLC   CMDLINE(3),=C'END'
         BE    FREERET
         CLC   =C'Z ',CMDLINE  TOP
         BE    FREERET
         CLC   =C'X ',CMDLINE  TOP
         BE    FREERET
         CLI   USERFLAG,X'FF'
         BNE   NOWTO
         MVC   WTOCMD(100),WTOLIST
         MVC   WTOCMD+8(72),CMDLINE
         MVC   WTOCMD+78(4),USERID
         LA    R7,WTOCMD
         WTL   MF=(E,(R7))
NOWTO    STAX  DEFER=YES
         SYSDSVC SVC=244
         MODESET MF=(E,SUPRMOD)
         SLR   R0,0                    CLEAR REG 0
ISSUE    LA    R1,COMMAND              GET ADDRESS OF SVC 34 COMMAND
         SVC   34                      ISSUE COMMAND
         STIMER WAIT,BINTVL=ONE        WAIT ONE SO THAT IT SHOWS
         SR    R1,R1                   ****************************
         L     R1,16                   *  A                       *
         USING CVT,R1                  *   D                      *
         L     R1,CVTTCBP              *    D      J              *
         DROP  R1                      *     R      S             *
         L     R1,4(R1)                *      E      C            *
         USING TCB,R1                  *       S      B           *
         L     R1,TCBJSCB              *        S                 *
         DROP  R1                      ****************************
         USING IEZJSCB,R1
         NI    JSCBOPTS,X'FF'-JSCBAUTH
         DROP  R1
*        NI    236(R1),X'FE'           SET AUTHORIZATION OFF
         MODESET MF=(E,PROBMOD)        PROBLEM STATE
         STAX  DEFER=NO                NOW THEY CAN INTERRUPT
         MVC   CMDLINE,HEX40S
         B     AUTHRIZE
*    FIND OPERATION REQUESTED                                         *
FIND     EQU   *
         OC    WORKLINE+6(74),HEX40S      UPPER CASE
         MVC   WORKLINE(74),WORKLINE+6    MOVE OVER
         MVC   ARGUMENT(74),HEX40S        CLEAR OUT
         LA    R8,1
         LA    R6,WORKLINE
         LA    R9,74(,R6)
         LA    R7,ARGUMENT
FINDQUOT CLI   0(R6),X'7D'
         BE    FOUNQUOT
         LA    R6,1(,R6)
         CR    R6,R9
         BL    FINDQUOT
         B     REENTER
FOUNQUOT LA    R6,1(,R6)
ARGLOOP  CLI   0(R6),X'7D'
         BE    ARGDONE
         MVC   0(1,R7),0(R6)
         LA    R7,1(,R7)
         BXLE  R6,R8,ARGLOOP
*  IF IT GETS HERE - ARGUMENT WAS INVALID                             *
REENTER  BAL   R2,CLEARSCR
         MVC   DETAIL+258(30),=C'PLEASE REENTER SEARCH ARGUMENT'
         MVC   DETAIL+418(25),=C'ENCLOSED IN SINGLE QUOTES'
         BAL   R2,TPUT
         B     TGET
SEARCH   B     FREERET
ENDOFLST MVC   0(80,R5),CENDOFIT
         CLI   SEARCHON,X'FF'
         BNE   WRITEIT
         MVC   24(25,R5),=C'SEARCH ARGUMENT NOT FOUND'
         MVI   FOUNDFLG,X'00'
         B     WRITEIT
SEARCHRP CLI   SRCHFLAG,X'FF'
         BNE   REENTER
         CLI   FOUNDFLG,X'FF'
         BNE   LOADCURR
         MVC   CURRLINE,SEARCHTP WHERE TO PICK UP
LOADCURR L     R6,CURRLINE
         MVI   FOUNDFLG,X'00'
         BAL   R2,PREVLINE
         ST    R6,CURRLINE
         MVI   SEARCHON,X'FF'
         B     UPSET
ARGDONE  LA    R8,ARGUMENT
         BCTR  R7,0
         SR    R7,R8
         BNP   REENTER
         ST    R7,ARGLENG
         MVI   FOUNDFLG,X'00' NOT FOUND YET
         MVI   SRCHFLAG,X'FF' SEARCH ARGUMENT IS PRESENT
         MVI   SEARCHON,X'FF' PLEASE SEARCH
         L     R6,BOTTOM
         B     SETBOT2
SETBOT   L     R6,MTTCLINE
SETBOT2  ST    R6,CURRLINE
         L     R5,LASTLINE
         B     DISPLOOP
SETTOP   L     R6,MTTCLINE
         ST    R6,CURRLINE
         BAL   R2,UPLINE
         ST    R6,CURRLINE
         BAL   R2,UPLINE
         ST    R6,BOTTOM
         B     DOWN
UPSET    MVI   UPFLAG,X'FF'
         CLI   DOWNFLAG,X'FF'
         BNE   UPSET2
         MVC   CURRLINE,TOP
         MVI   DOWNFLAG,X'00'
UPSET2   L     R5,LASTLINE    ADDRESS OF WHERE TO MOVE CURRENT ENTRY
         L     R6,CURRLINE    WHERE WE LEFT OFF
         ST    R6,BOTTOM
         MVI   FOUNDFLG,X'00'
         B     DISPLOOP
COMPARE  CLC   0(0,R15),ARGUMENT  LOOK FOR SEARCH ARGUMENT
DISPMOVE MVC   18(0,R5),63(R6) SKIP CONTROL STUFF
DISPMOV2 MVC   0(0,R5),112(R6) SKIP CONTROL STUFF
TPUT     LA    R1,SCREEN
         L     R0,SCRTPUTL
         TPUT  (1),(0),FULLSCR
         BR    R2
HELPOUT  BAL   R2,CLEARSCR    GO CLEAR OUR SCREEN
         MVC   DETAIL+80(80),CHELPLN0
         MVC   DETAIL+160(80),CHELPLN1
         MVC   DETAIL+400(80),CHELPLN2
         MVC   DETAIL+480(80),CHELPLN3
         MVC   DETAIL+640(39),CHELPLN4
         MVC   DETAIL+720(43),CHELPLN5
         MVC   DETAIL+880(43),CHELPLN6
         BAL   R2,TPUT
         B     TGET
NOTACTIV BAL   R2,CLEARSCR    GO CLEAR OUR SCREEN
         MVC   DETAIL(26),=C'MASTER TRACE IS NOT ACTIVE'
         BAL   R2,TPUT
         STIMER WAIT,BINTVL=ONE
         L     R2,CPPLSAVE
         LINK  EP=ZTPR0200
         B     FREERET
**   CLEAR THE SCREEN AREA AND RETURN TO ADDRESS IN REG 2            **
CLEARSCR LA    R6,DETAIL
         L     R7,SCRLENG
         SR    R9,R9
         ICM   R9,B'1001',HEX40S
         LA    R8,HEX40S
         MVCL  R6,R8
         BR    R2
TABLE    DC    CL4'XXXX'  USERID OF PEOPLE TO USE IT GOES HERE
TABLEND  DC    CL4'XXXX'
DSCREEN  DS    0C             DISPLAY SCREEN
         DC    X'03'          CONTROL
         DC    X'00'          ERASE/WRITE ALTERNATE (132 COL)
         DC    X'00115D7F1140403C404000' CLEAR SCREEN
         DC    CL80'                  MASTER  TRACE  TABLE  DISPLAY    *
                             PF-1 FOR HELP '
         DC    X'11'          SET BUFFER ADDRESS
         DC    X'F460'        (43,1)
*        DC    C'_'
         DC    X'1DC8'        MARK NEXT FIELD AS INPUT FIELD
         DC    X'13'          SET CURSOR ADDRESS
         DC    X'11'          SET BUFFER ADDRESS
         DC    X'F5E7'        (43,72)
         DC    X'1DF0'        TERMINATE INPUT FIELD
         DC    C' '           INDICATES MORE TO BE DISPLAYED
         DC    X'11'          SET BUFFER ADDRESS
         DC    X'C150'        (2,1)
*DLINE1  DC    40CL80' '      MESSAGE TEXT AREA (FOR 40X80 MAX)
DSCREENL EQU   *-DSCREEN      LENGTH OF THIS PART
FOUR     DC    F'4'
CHELPLN0 DC    CL80'  THIS PROGRAM USES CROSS MEMORY SERVICES TO READ T*
               HE MASTER TRACE TABLE IN    '
CHELPLN1 DC    CL80'  THE MASTER ADDRESS SPACE. THE MASTER TRACE MUST B*
               E ACTIVE TO PAGE UP/DOWN.   '
CHELPLN2 DC    CL80'  PF-1  HELP            PF-3  END                PF*
               -5  REPEAT FIND   PF-7  UP  '
CHELPLN3 DC    CL80'  PF-8  PAGE DOWN       PF-9  TOP (OLDEST)       PF*
               -10 BOTTOM (NEWEST)         '
CHELPLN4 DC    CL39'  T OR TOP MAY BE USED INSTEAD OF PF-9 '
CHELPLN5 DC    CL43'  B OR BOTTOM MAY BE USED INSTEAD OF PF-10 '
CHELPLN6 DC    CL43'  F OR FIND WITH ARGUMENT IN SINGLE QUOTES '
BADLDMSG DC    CL25'ERROR LOADING IKJEFFUT  '
         DS    0F
AUTH     DC    CL4'AUTH'
MTT      DC    CL3'MTT'       MASTER TRACE TABLE HEADER
HEXFS    DC    XL4'FFFFFFFF'
HEXZIP   DC    XL4'00000000'
CMAINT   DC    XL5'1401091523'
COMMANDL DC    Y(76),Y(00)
ONE      DC    A(100)             1 SECOND
CBEGINLN DC    XL4'00000001'
EIGHTY   DC    F'080'             CONSTANT 80
SEVENTY9 DC    F'079'             CONSTANT 79
ANDCHARS DC    XL8'3F3F3F3F3F3F3F3F'
MSGNO1   DC    CL13'SYSTEM ACTIVE'
MSG1     DC    CL33'***FREEMAIN ERROR ON SAVEAREA ***'
MSG2     DC    CL33'***FREEMAIN ERROR ON MTT AREA ***'
XFINDQ   DC    XL3'C6407D'        HEX FOR F '
CFIND    DC    CL4'FIND'          CHARACTER FIND
CEND     DC    CL3'END'           CHARACTER END
CZ       DC    CL1'Z'             CHARACTER Z
PATTERN  DC    XL4'40202120'
AXLIST   DC    H'1'
         DC    H'0'
WTOLIST  WTL   '                                                       X
                                       ZTPR0200',MF=L
SUPRMOD  MODESET MF=L,MODE=SUP,KEY=ZERO
PROBMOD  MODESET MF=L,MODE=PROB,KEY=NZERO
         LTORG
CENDOFIT DC    CL80'* * * * * * * * * * * * E N D * * O F * * D A T A **
               * * * * * * * * * * * * * * '
SAVDSECT DSECT
SAVEAREA DS    18F
DOUBLWD  DS    D
PARMWKAD DS    F
CPPLSAVE DS    F
         DS    0D
WORKLINE DS    CL80
HEX40S   DS    CL80
WTOCMD   DS    CL100
PARMWORK DS    CL44
USERID   DS    CL7
USERIDL  DS    XL1
USERATTR DS    XL1
STARTFLG DS    XL1
SRCHFLAG DS    XL1
USERFLAG DS    XL1
FOUNDFLG DS    XL1
SEARCHON DS    XL1
UPFLAG   DS    XL1
WRAPFLAG DS    XL1
DOWNFLAG DS    XL1
MTTSIZE  DS    F              SIZE OF MTT
MTTADDR  DS    F              MTT ADDRESS IN MASTER ASID
BOTTOM   DS    F              BOTTOM    OF SCREEN
TOP      DS    F              TOP OF SCREEN
SEARCHTP DS    F              CURRENT LINE FOR REPEAT SEARCH
CURRLINE DS    F              CURRENT LINE FOR US
FRSTLINE DS    F              FIRST LINE ON OUR DISPLAY
LASTLINE DS    F              LAST  LINE ON OUR DISPLAY
MTTFLINE DS    F              FIRST LINE IN OUR AREA
MTTLLINE DS    F              LAST  LINE IN OUR AREA
MTTCLINE DS    F              CURRENT LINE IN OUR AREA
SCRLENG  DS    F
SCRTPUTL DS    F
ARGLENG  DS    F
ARGUMENT DS    CL74
COMMAND  DS    F
CMDLINE  DS    CL72
SCREEN   DS    0CL108
         DS    XL1            CONTROL
DSCRO1   DS    XL1            ERASE/WRITE ALTERNATE (132 COL)
         DS    XL11
         DS    CL80
         DS    XL1            SET BUFFER ADDRESS
DSCRO3   DS    XL2            (43,1)
*        DS    XL1
         DS    XL2            MARK NEXT FIELD AS INPUT FIELD
         DS    XL1            SET CURSOR ADDRESS
         DS    XL1            SET BUFFER ADDRESS
DSCRO4   DS    XL2
         DS    XL2            TERMINATE INPUT FIELD
         DS    XL2            SET BUFFER ADDRESS
DSCRO5   DS    XL2
DETAIL   DS    43CL80
WORKL    EQU   *-SAVEAREA
         CVT   DSECT=YES
         IEZJSCB
         IKJTCB DSECT=YES
         IEEBASEA
         IEECHAIN
         IKJPSCB
         IKJCPPL
         IKJUPT
         END
./ ADD NAME=MTTXAJ
//MURF2 JOB (6496,B014),MURF,CLASS=O,MSGCLASS=T,NOTIFY=MURF
//*  JCL TO INSTALL MTTXA
//*
//*  CHANGE SYSLIB ACCORDING TO YOUR IPORES
//*  CHANGE SYSLIB AND SYLMOD IN LKED STEP TO LINK LIST LIBRARY
//*
//COM     EXEC PGM=IEV90,REGION=512K,
//    PARM='LOAD,XREF(SHORT),LINECNT=55,NODECK'
//SYSLIB   DD  DISP=SHR,DSN=SYS1.MACLIB
//         DD  DISP=SHR,DSN=SYS1.AMODGEN
//         DD  DISP=SHR,DSN=MURF.SHARE.LIBRARY
//SYSLIN   DD  UNIT=VIO,DSN=&LOADSET,DISP=(MOD,PASS),
//             SPACE=(CYL,(2,2)),DCB=BLKSIZE=1680
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(10,2))
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,(12,2))
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,(20,2))
//SYSPUNCH DD  DUMMY =*,DCB=FUNC=I
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSIN    DD  DSN=MURF.SHARE.LIBRARY(MTTXA),DISP=SHR
//*
//LKED         EXEC PGM=IEWL,REGION=1024K,COND=(4,LT),
//             PARM='XREF,LET,LIST,RENT'
//SYSPRINT     DD   SYSOUT=*
//SYSUT1       DD   DSN=&SYSUT1,UNIT=SYSDA,SPACE=(CYL,(1,1))
//SYSLMOD      DD   DISP=SHR,DSN=SYSX.LOADLIB(MTTXA)
//SYSLIN       DD   UNIT=SYSDA,DSN=&LOADSET,DISP=(OLD,DELETE)
//             DD   DDNAME=SYSIN
./ ADD NAME=SASTSOMN
//MURFG   JOB (6496,F),MURF,CLASS=O,MSGCLASS=T,REGION=2500K,NOTIFY=MURF
//S3    EXEC SAS,TIME=1400,
// OPTIONS='GEN=0,NOSORTLIST,ERRORABEND,NOSTIMER'
//FT12F001 DD SYSOUT=*
//FT14F001 DD SYSOUT=*
//SMFDD   DD DSN=SYS1.MAN1,DISP=SHR
//SYSMSG DD SYSOUT=*
OPTIONS DEVICE=IBM3287F,DEVADDR=(SAS,.,L000P009);
GOPTIONS ROTATE VSIZE=10.5;



MACRO    TOD  HH = FLOOR (TIM /360000);
              MM = FLOOR ((TIM -360000*HH)/6000);
              SS = FLOOR ((TIM -360000*HH-6000*MM)/100);

              TIM= (HH * 10000) + (MM * 100) + SS; %

 DATA TSOMON
  (KEEP = WEEKDAYS SMFDATE USER TIM TXN CMD);
   INFILE SMFDD MISSOVER JFCB=JFCBMANX CLOSE=FREE;
   IF _N_ = 1 THEN DO;
            IF SUBSTR(JFCBMANX,100,1) = '....1...'B
               THEN SMFCOL1 = 6 ;
            ELSE SMFCOL1 = 2;
            RETAIN SMFCOL1;
            DROP SMFCOL1;
            END;
          INPUT @SMFCOL1 RECNO PIB1.
                 EOFMARK $8. @;
          IF EOFMARK = 'FEOFMARK' THEN STOP;
   INPUT
         @SMFCOL1+5    SMFDATE PD4.@ ;
   IF RECNO = 200 OR RECNO = 199;
   DAY = DATEJUL(SMFDATE);
   FORMAT DAY MMDDYY6.;
   WEEKDAYS = PUT(DAY,WEEKDATE3.) ;
   IF RECNO = 199 THEN GOTO REC199;
   INPUT @SMFCOL1+09 CPU    $4.
         @SMFCOL1+13 OFFSET  PIB2.
         @SMFCOL1+19 INTLEN   PIB4. @;
   IF INTLEN = 0 THEN GOTO MULTSEG;
   INPUT @SMFCOL1+39 TIM PIB4.
         @SMFCOL1+87 MAX_USER  PIB2. @;
   TOD
   INTLEN  = INTLEN  / 38400;
 MULTSEG:
*  REPEAT FOLLOWING CODE FOR INDIVIDUAL USER SEGMENTS;
   IF OFFSET = 0 THEN RETURN;
   N = SMFCOL1 + OFFSET - 1;
   INPUT @N  USER $7.
         @N+24 TRIVTM IB4.
         @N+28 TOTSHORT PIB2.
         @N+40 NTRIVTM PIB4.
         @N+44 TOTMED  PIB2.
         @N+46 UCBE    PIB2.
         @N+56 LONGTM  PIB4.
         @N+44 TOTLONG PIB2.
         @N+70 OFFSET  PIB2.
         @N+138 NRCMDS PIB1. @;
   TRANS = 0;
   IF TXNS     = . THEN TXNS  = 0;
   TRIVTM = TRIVTM / 38400;
   NTRIVTM = NTRIVTM / 38400;
   LONGTM = LONGTM / 38400;
   RESPONSE = TRIVTM + NTRIVTM + LONGTM;
   TRANS = TOTSHORT + TOTMED + TOTLONG;
   IF RESPONSE <= 0  OR TRANS <= 0 THEN RETURN;
   RESPONSE = RESPONSE/ TRANS;
LOOPCMD:
    TXN = '        ';
    IF NRCMDS <= 0 THEN GOTO RESTMON;
       INPUT    CMD  $2.
                NRTR PIB1. @;
   IF CMD = 'A1' THEN TXN = 'ACCOUNT ';
   IF CMD = 'A2' THEN TXN = 'ALLOCATE';
   IF CMD = 'A4' THEN TXN = 'ASM     ';
   IF CMD = 'A5' THEN TXN = 'ATTRIB  ';
   IF CMD = 'CA' THEN TXN = 'CALL    ';
   IF CMD = 'C3' THEN TXN = 'CALC    ';
   IF CMD = 'C1' THEN TXN = 'CONVERT ';
   IF CMD = 'C2' THEN TXN = 'COPY    ';
   IF CMD = 'C4' THEN TXN = 'COBOL   ';
   IF CMD = 'D1' THEN TXN = 'DELETE  ';
   IF CMD = 'E2' THEN TXN = 'EDIT    ';
   IF CMD = 'E$' THEN TXN = 'END     ';
   IF CMD = 'E5' THEN TXN = 'EXEC    ';
   IF CMD = 'F1' THEN TXN = 'FORMAT  ';
   IF CMD = 'F2' THEN TXN = 'FREE    ';
   IF CMD = 'F3' THEN TXN = 'FREEALL ';
   IF CMD = 'F4' THEN TXN = 'FORT    ';
   IF CMD = 'G1' THEN TXN = 'GOFORT  ';
   IF CMD = 'H1' THEN TXN = 'HELP    ';
   IF CMD = 'L1' THEN TXN = 'LINK    ';
   IF CMD = 'L2' THEN TXN = 'LIST    ';
   IF CMD = 'L3' THEN TXN = 'LISTALC ';
   IF CMD = 'L5' THEN TXN = 'LISTBC  ';
   IF CMD = 'L8' THEN TXN = 'LISTDS  ';
   IF CMD = 'Y1' THEN TXN = 'LOGOFF  ';
   IF CMD = 'LN' THEN TXN = 'LOGON   ';
   IF CMD = 'Y2' THEN TXN = 'LOADGO  ';
   IF CMD = 'M1' THEN TXN = 'MERGE   ';
   IF CMD = 'O1' THEN TXN = 'OPERATOR';
   IF CMD = 'P2' THEN TXN = 'PLI     ';
   IF CMD = 'P3' THEN TXN = 'PLIC    ';
   IF CMD = 'P4' THEN TXN = 'PROFILE ';
   IF CMD = 'P5' THEN TXN = 'PROTECT ';
   IF CMD = 'R3' THEN TXN = 'RENAME  ';
   IF CMD = 'R4' THEN TXN = 'RUN     ';
   IF CMD = 'S2' THEN TXN = 'SEND    ';
   IF CMD = '$$' THEN TXN = 'ISPF    ';
   IF CMD = 'T1' THEN TXN = 'TERMINAL';
   IF CMD = 'T2' THEN TXN = 'TEST    ';
   IF CMD = 'T3' THEN TXN = 'TESTCOB ';
   IF CMD = 'T4' THEN TXN = 'TESTFORT';
   IF CMD = 'T5' THEN TXN = 'TIME    ';
   IF CMD = 'W5' THEN TXN = 'ALTER   ';
   IF CMD = 'B2' THEN TXN = 'BLDINDEX';
   IF CMD = '87' THEN TXN = 'CHKLIST ';
   IF CMD = 'C5' THEN TXN = 'CNVTCAT ';
   IF CMD = 'D2' THEN TXN = 'DEFINE  ';
   IF CMD = 'E7' THEN TXN = 'EXPORT  ';
   IF CMD = 'E8' THEN TXN = 'EXPORTRA';
   IF CMD = 'I2' THEN TXN = 'IMPORT  ';
   IF CMD = '88' THEN TXN = 'IMPORTRA';
   IF CMD = 'Y4' THEN TXN = 'LISTCAT ';
   IF CMD = 'Y5' THEN TXN = 'LISTCRA ';
   IF CMD = 'P8' THEN TXN = 'PRINT   ';
   IF CMD = 'R5' THEN TXN = 'REPRO   ';
   IF CMD = 'R6' THEN TXN = 'RESETCAT';
   IF CMD = 'V1' THEN TXN = 'VERIFY  ';
   IF CMD = 'C6' THEN TXN = 'CANCEL  ';
   IF CMD = 'S6' THEN TXN = 'SUBMIT  ';
   IF CMD = 'W1' THEN TXN = 'WHEN    ';
   IF CMD = '70' THEN TXN = 'RMFMON  ';
   IF CMD = '71' THEN TXN = 'HALTERDS';
   IF CMD = '72' THEN TXN = 'HBACKDS ';
   IF CMD = '73' THEN TXN = 'HBDELETE';
   IF CMD = '74' THEN TXN = 'HDELETE ';
   IF CMD = '75' THEN TXN = 'HLIST   ';
   IF CMD = '76' THEN TXN = 'HMIGRATE';
   IF CMD = '77' THEN TXN = 'HQUERY  ';
   IF CMD = '78' THEN TXN = 'HRECALL ';
   IF CMD = '79' THEN TXN = 'HRECOVER';
   IF CMD = '7A' THEN TXN = 'HSENDCMD';
   IF CMD = '7B' THEN TXN = 'IPCS    ';
   IF CMD = '7C' THEN TXN = 'IPCSDDIR';
   IF CMD = '7D' THEN TXN = 'SYSDSCAN';
   IF CMD = '7E' THEN TXN = 'ADDGROUP';
   IF CMD = '7F' THEN TXN = 'ADDSD   ';
   IF CMD = '7G' THEN TXN = 'ADDUSER ';
   IF CMD = '7H' THEN TXN = 'ALTDSD  ';
   IF CMD = '7I' THEN TXN = 'ALTGROUP';
   IF CMD = '7J' THEN TXN = 'ALTUSER ';
   IF CMD = '7K' THEN TXN = 'CONNECT ';
   IF CMD = '7L' THEN TXN = 'DELDSD  ';
   IF CMD = '7M' THEN TXN = 'DELGROUP';
   IF CMD = '7N' THEN TXN = 'DELUSER ';
   IF CMD = '7O' THEN TXN = 'LISTDSD ';
   IF CMD = '7P' THEN TXN = 'LISTGRP ';
   IF CMD = '7Q' THEN TXN = 'LISTUSER';
   IF CMD = '7R' THEN TXN = 'PASSWORD';
   IF CMD = '7S' THEN TXN = 'PERMIT  ';
   IF CMD = '7T' THEN TXN = 'RALTER  ';
   IF CMD = '7U' THEN TXN = 'RDEFINE ';
   IF CMD = '7V' THEN TXN = 'RDELETE ';
   IF CMD = '7W' THEN TXN = 'REMOVE  ';
   IF CMD = '7X' THEN TXN = 'RLIST   ';
   IF CMD = '7Y' THEN TXN = 'RVARY   ';
   IF CMD = '7Z' THEN TXN = 'SEARCH  ';
   IF CMD = '80' THEN TXN = 'SETROPTS';
   IF CMD = '81' THEN TXN = 'SMCOPY  ';
   IF CMD = '82' THEN TXN = 'SMFIND  ';
   IF CMD = '83' THEN TXN = 'SMPUT   ';
   IF CMD = 'P1' THEN TXN = 'ZTPR0194';
   IF CMD = 'S1' THEN TXN = 'ZTPR0183';
   IF CMD = 'A1' THEN TXN = 'ZTPR0186';
   IF CMD = '$3' THEN TXN = 'BOTTOM  ';
   IF CMD = '$4' THEN TXN = 'CHANGE  ';
   IF CMD = '$6' THEN TXN = 'COPY    ';
   IF CMD = '$7' THEN TXN = 'DELETE  ';
   IF CMD = '$8' THEN TXN = 'DOWN    ';
   IF CMD = '$2' THEN TXN = 'EDITDATA';
   IF CMD = '$9' THEN TXN = 'END     ';
   IF CMD = '$B' THEN TXN = 'FIND    ';
   IF CMD = '$P' THEN TXN = 'FORMAT  ';
   IF CMD = '84' THEN TXN = 'FSE-EDIT';
   IF CMD = '85' THEN TXN = 'FULSEDIT';
   IF CMD = '2A' THEN TXN = 'PF(EDIT)';
   IF CMD = '2B' THEN TXN = 'PB      ';
   IF CMD = '2C' THEN TXN = 'HF      ';
   IF CMD = '2D' THEN TXN = 'HB      ';
   IF CMD = '2E' THEN TXN = 'LS      ';
   IF CMD = '2F' THEN TXN = 'SS      ';
   IF CMD = '$H' THEN TXN = 'HELP    ';
   IF CMD = '$E' THEN TXN = 'INPUT   ';
   IF CMD = '$F' THEN TXN = 'INSERT  ';
   IF CMD = '$2' THEN TXN = '*       ';
   IF CMD = '$A' THEN TXN = 'LIST    ';
   IF CMD = '$1' THEN TXN = 'MERGE   ';
   IF CMD = '$M' THEN TXN = 'MOVE    ';
   IF CMD = '$O' THEN TXN = 'RENUM   ';
   IF CMD = '$Q' THEN TXN = 'RUN     ';
   IF CMD = '$R' THEN TXN = 'SAVE    ';
   IF CMD = '$S' THEN TXN = 'SCAN    ';
   IF CMD = '$V' THEN TXN = 'TABSET  ';
   IF CMD = '$X' THEN TXN = 'TOP     ';
   IF CMD = '$Y' THEN TXN = 'UNNUM   ';
   IF CMD = '$Z' THEN TXN = 'UP      ';
   IF CMD = '$#' THEN TXN = 'VERIFY  ';
   IF CMD = 'A2' THEN TXN = 'ALLOCATE';
   IF CMD = 'A5' THEN TXN = 'ATTRIB  ';
   IF CMD = '86' THEN TXN = 'CKPOINT ';
   IF CMD = 'E5' THEN TXN = 'EXEC    ';
   IF CMD = 'F2' THEN TXN = 'FREE    ';
   IF CMD = 'P4' THEN TXN = 'PROFILE ';
   IF CMD = 'S2' THEN TXN = 'SEND    ';
   IF CMD = 'S6' THEN TXN = 'SUBMIT  ';
   IF CMD = '#1' THEN TXN = 'ASSIGN  ';
   IF CMD = '#2' THEN TXN = 'AT      ';
   IF CMD = '#3' THEN TXN = 'CALL    ';
   IF CMD = '#4' THEN TXN = 'COPY    ';
   IF CMD = '#5' THEN TXN = 'DELETE  ';
   IF CMD = '#6' THEN TXN = 'DROP    ';
   IF CMD = '#7' THEN TXN = 'END     ';
   IF CMD = '#8' THEN TXN = 'EQUATE  ';
   IF CMD = '#9' THEN TXN = 'FREEMAIN';
   IF CMD = '#A' THEN TXN = 'GETMAIN ';
   IF CMD = '#B' THEN TXN = 'GO      ';
   IF CMD = '#C' THEN TXN = 'HELP    ';
   IF CMD = '#D' THEN TXN = 'LIST    ';
   IF CMD = '#E' THEN TXN = 'LISTDCB ';
   IF CMD = '#F' THEN TXN = 'LISTDEB ';
   IF CMD = '#G' THEN TXN = 'LISTMAP ';
   IF CMD = '#H' THEN TXN = 'LISTPSW ';
   IF CMD = '#I' THEN TXN = 'LISTTCB ';
   IF CMD = '#J' THEN TXN = 'LOAD    ';
   IF CMD = '#K' THEN TXN = 'OFF     ';
   IF CMD = '#M' THEN TXN = 'RUN     ';
   IF CMD = '#L' THEN TXN = 'QUALIFY ';
   IF CMD = '#N' THEN TXN = 'WHERE   ';
   IF CMD = '@0' THEN TXN = 'SPFTERM ';
   IF CMD = '@1' THEN TXN = 'SPFLOGL ';
   IF CMD = '@2' THEN TXN = 'SPFEDIT ';
   IF CMD = '@3' THEN TXN = 'BROWSE  ';
   IF CMD = '@4' THEN TXN = 'LIBUTIL ';
   IF CMD = '@5' THEN TXN = 'LIBUTILC';
   IF CMD = '@6' THEN TXN = 'LIBUTILX';
   IF CMD = '@7' THEN TXN = 'LIBUTILL';
   IF CMD = '@8' THEN TXN = 'LIBUTILP';
   IF CMD = '@9' THEN TXN = 'LIBUTILR';
   IF CMD = '@A' THEN TXN = 'LIBUTILD';
   IF CMD = '@B' THEN TXN = 'DSALLOC ';
   IF CMD = '@C' THEN TXN = 'DSRENAME';
   IF CMD = '@D' THEN TXN = 'DSDELETE';
   IF CMD = '@E' THEN TXN = 'DSINFO  ';
   IF CMD = '@F' THEN TXN = 'UTILMC  ';
   IF CMD = '@G' THEN TXN = 'UTILCAT ';
   IF CMD = '38' THEN TXN = 'UTILRESR';
   IF CMD = '40' THEN TXN = 'UTILRESN';
   IF CMD = '41' THEN TXN = 'UTILRESD';
   IF CMD = '36' THEN TXN = 'UTLHCPYJ';
   IF CMD = '37' THEN TXN = 'UTLHCPYL';
   IF CMD = '@J' THEN TXN = 'FORASM  ';
   IF CMD = '@K' THEN TXN = 'FORCOB  ';
   IF CMD = '@L' THEN TXN = 'FORFORG1';
   IF CMD = '@M' THEN TXN = 'FORPLIC ';
   IF CMD = '@N' THEN TXN = 'FORPLIOP';
   IF CMD = '@O' THEN TXN = 'FORLINK ';
   IF CMD = '@P' THEN TXN = 'FORCOBID';
   IF CMD = '@Q' THEN TXN = 'FORFORID';
   IF CMD = '44' THEN TXN = 'FORPASCL';
   IF CMD = '@R' THEN TXN = 'BCKASM  ';
   IF CMD = '@S' THEN TXN = 'BCKCOB  ';
   IF CMD = '@T' THEN TXN = 'BCKFORG1';
   IF CMD = '@U' THEN TXN = 'BCKPLIC ';
   IF CMD = '@V' THEN TXN = 'BCKPLIOP';
   IF CMD = '@W' THEN TXN = 'BCKLINK ';
   IF CMD = '45' THEN TXN = 'BCKPASCL';
   IF CMD = '@X' THEN TXN = 'SPFVTOC ';
   IF CMD = '@Y' THEN TXN = 'TUTORIAL';
   IF CMD = '@Z' THEN TXN = 'SPFERR01';
   IF CMD = '@@' THEN TXN = 'SPFERR02';
   IF CMD = '@#' THEN TXN = 'SPFERR03';
   IF CMD = '34' THEN TXN = 'SPFERR04';
   IF CMD = '35' THEN TXN = 'SPFERR05';
   IF CMD = '42' THEN TXN = 'SPFERR06';
   IF CMD = '43' THEN TXN = 'SPFERR07';
   IF CMD = '48' THEN TXN = 'SPFERR08';
   IF CMD = '@?' THEN TXN = 'DATUTILC';
   IF CMD = '@-' THEN TXN = 'DATUTILU';
   IF CMD = '46' THEN TXN = 'CONVMNU ';
   IF CMD = '47' THEN TXN = 'CONVMSG ';
   IF CMD = '@+' THEN TXN = 'TESTMENU';
   IF CMD = '@=' THEN TXN = 'SPFPK1  ';
   IF CMD = '@!' THEN TXN = 'SPFPK2  ';
   IF CMD = '@' THEN TXN = 'SPFPK3  ';
   IF CMD = '@:' THEN TXN = 'UTILBRWS';
   IF CMD = '30' THEN TXN = 'UTILOUT ';
   IF CMD = '31' THEN TXN = 'UTILOUTD';
   IF CMD = '32' THEN TXN = 'UTILOUTP';
   IF CMD = '33' THEN TXN = 'UTILOUTR';
   IF CMD = '@;' THEN TXN = 'UTILOUTL';
   IF CMD = '20' THEN TXN = 'SCRIPTD ';
   IF CMD = '21' THEN TXN = 'SCRIPTF ';
   IF CMD = '49' THEN TXN = 'PANBRWSE';
   IF CMD = '4A' THEN TXN = 'PANEDIT ';
   IF CMD = '4B' THEN TXN = 'PANCHNG ';
   IF CMD = '4C' THEN TXN = 'AFTER   ';
   IF CMD = '01' THEN TXN = 'BEFORE  ';
   IF CMD = '02' THEN TXN = 'BOUNDS  ';
   IF CMD = '03' THEN TXN = 'COLS    ';
   IF CMD = '04' THEN TXN = 'COPY    ';
   IF CMD = '05' THEN TXN = 'DELETE  ';
   IF CMD = '06' THEN TXN = 'INSERT  ';
   IF CMD = '07' THEN TXN = 'MASK    ';
   IF CMD = '08' THEN TXN = 'MOVE    ';
   IF CMD = '09' THEN TXN = 'OVERLAY ';
   IF CMD = '0A' THEN TXN = 'REPEAT  ';
   IF CMD = '0B' THEN TXN = 'DATASHFT';
   IF CMD = '0C' THEN TXN = 'DATASHFT';
   IF CMD = '0D' THEN TXN = 'TABS    ';
   IF CMD = '0E' THEN TXN = 'SHOW    ';
   IF CMD = '0F' THEN TXN = 'EXCLUDE ';
   IF CMD = '0G' THEN TXN = 'FIRST   ';
   IF CMD = '0H' THEN TXN = 'LAST    ';
   IF CMD = '0I' THEN TXN = 'COLSHIFT';
   IF CMD = '0J' THEN TXN = 'COLSHIFT';
   IF CMD = '0K' THEN TXN = 'TXTENTRY';
   IF CMD = '0L' THEN TXN = 'TXTFLOW ';
   IF CMD = '0M' THEN TXN = 'TXTSPLIT';
   IF CMD = '0N' THEN TXN = 'MOVE$   ';
   IF CMD = '0O' THEN TXN = 'CANCEL  ';
   IF CMD = '0P' THEN TXN = 'CHANGE  ';
   IF CMD = '0Q' THEN TXN = 'FIND    ';
   IF CMD = '0R' THEN TXN = 'LOCATE  ';
   IF CMD = '0S' THEN TXN = 'PROFILE ';
   IF CMD = '0T' THEN TXN = 'RESET   ';
   IF CMD = '0U' THEN TXN = 'SAVE    ';
   IF CMD = '0V' THEN TXN = 'SUBMIT  ';
   IF CMD = '0W' THEN TXN = 'ASIS    ';
   IF CMD = '0X' THEN TXN = 'AUTONUM ';
   IF CMD = '0Y' THEN TXN = 'CAPS    ';
   IF CMD = '0Z' THEN TXN = 'COPY$   ';
   IF CMD = '10' THEN TXN = 'CREATE  ';
   IF CMD = '12' THEN TXN = 'HEX     ';
   IF CMD = '13' THEN TXN = 'NONULLS ';
   IF CMD = '14' THEN TXN = 'NONUMBER';
   IF CMD = '15' THEN TXN = 'NOTABS  ';
   IF CMD = '16' THEN TXN = 'NULLS   ';
   IF CMD = '17' THEN TXN = 'NUMBER  ';
   IF CMD = '18' THEN TXN = 'PRINT   ';
   IF CMD = '19' THEN TXN = 'RECOVERY';
   IF CMD = '1A' THEN TXN = 'RENUMBER';
   IF CMD = '1B' THEN TXN = 'REPLACE ';
   IF CMD = '1C' THEN TXN = 'STATS   ';
   IF CMD = '1D' THEN TXN = 'TABS    ';
   IF CMD = '1E' THEN TXN = 'UNNUMBER';
       OUTPUT TSOMON;
       CMD = '  ';
       NRCMDS = NRCMDS - 1;
       GOTO LOOPCMD;
RESTMON:
   INPUT @N+UCBE TSMFEXIT PIB2.
         @N+UCBE+14 NOCMDS PIB1.@;
CYCLE:
   INPUT @N+TSMFEXIT TXN $8.@;
   NOCMDS = NOCMDS - 1;
   OUTPUT TSOMON;
   IF NOCMDS LE 0 THEN GOTO MULTSEG;
   TSMFEXIT = TSMFEXIT + 10;
   GOTO CYCLE;
REC199:
   INPUT
         @SMFCOL1+15  USER   $8.
         @SMFCOL1+31 TIM PIB4.
         @SMFCOL1+43 TXN $8.
         @SMFCOL1+51 TGETS PIB2.
         @SMFCOL1+53 TPUTS PIB2.
         @SMFCOL1+63 INCPUT PIB4.
         @SMFCOL1+67 SRB PIB4.
         @SMFCOL1+71 EXCP PIB4.
         @SMFCOL1+121 SWAPOUT PIB2.
         @SMFCOL1+147 SERVUNIT PIB4.
         ;
   TOD
   TSOCPU = (INCPUT / 384)/100;
   TSOSRB = (SRB  / 384)/100;
   RESPONSE = TSOCPU+TSOSRB;
   TRANS = 1;
   OUTPUT TSOMON;
   RETURN;
   PROC PRINT DATA = TSOMON;
./ ADD NAME=SWAPIN
SWAPIN   CSECT
*******************************************************************     DOC FILE
*                                                                 *     DOC FILE
*                        D I S C L A I M E R                      *     DOC FILE
*                                                                 *     DOC FILE
*******************************************************************     DOC FILE
*                                                                 *     DOC FILE
* THIS MATERIAL HAS BEEN USED SUCCESSFULLY & TO THE BEST OF OUR   *     DOC FILE
* KNOWLEDGE  THEY  ARE  OPERATIONAL, HOWEVER  NO  WARRANTY        *     DOC FILE
* IS MADE TO THE ACCURACY OF THE PROGRAMS OR RELATED MATERIAL AND *     DOC FILE
* NO RESPONSIBILITY IS ASSUMED  FOR ANY MODIFICATION  DIRECTLY OR *     DOC FILE
* INDIRECTLY  CAUSED BY  THEIR USE.  IT IS THE USERS              *     DOC FILE
* RESPONSIBILITY  TO  EVALUATE THE  USEFULLNESS  OF THE  MATERIAL *     DOC FILE
* SUPPLIED .                                                      *     DOC FILE
*                                                                 *     DOC FILE
* WE DO NOT GUARANTEE TO  KEEP ANY  MATERIAL PROVIDED  UP TO DATE *     DOC FILE
* NOR DO WE GUARANTEE TO  PROVIDE ANY  CORRECTIONS OR  EXTENSIONS *     DOC FILE
* DESCRIBED BY THE USER OR  CORRECTIONS OR EXTENSIONS MADE IN THE *     DOC FILE
* FUTURE .                                                        *     DOC FILE
*                                                                 *     DOC FILE
*******************************************************************     DOC FILE
**********************************************************************  DOC FILE
*  04/10/90 - CHANGED TO CHECK FOR THE MAX NUMBER OF ADDRESS SPACES  *
*  INSTEAD OF USING A HARD CODED VALUE THAT COULD CHANGE ON IPL.     *
*  IS CODED TO WHERE ACCT AUTHORITY IS REQUIRED. THERE ARE ONLY A    *
*  FEW PEOPLE THAT SHOULD HAVE ACCESS TO THIS.  PMM                  *
**********************************************************************  DOC FILE
         BEGIN PROGRAM=SWAPIN
         LR    R12,R15            ESTABLISH ...
         USING SWAPIN,R12         ... BASE REGISTER
         LA    R3,SAVEAREA        COPY HIGH SAVE ADDR
         ST    R3,8(,R13)         LOAD MY SAVE AREA ADDRESS
         ST    R13,SAVEAREA+4     STORE MY SAVE ADDR IN HIGH SAVE
         LR    R11,R13
         LR    R13,R3
         USING CPPL,R1
         L     R6,CPPLPSCB
         DROP  R1
         USING PSCB,R6
         MVC   USERID,PSCBUSER
         TM    PSCBATR1,PSCBACCT  ACCOUNT AUTHORITY
         BZ    RETURN0            NO, GET OUTTA HERE
         DROP  R6
         LA    R2,JOBNAME         GET REPLY AREA ADDRESS
         TPUT  MESSAGE1,40
         TGET  JOBNAME,8
         OC    JOBNAME(8),SPACES
         TPUT  MESSAGE2,40
         TGET  REPLY,2
         OC    REPLY(2),SPACES
         CLI   REPLY+1,C' '
         BNE   PACKIT
         MVC   REPLY+1(1),REPLY
         MVI   REPLY,X'F0'
PACKIT   PACK  DOUBLWD(8),REPLY(2)
         CVB   R1,DOUBLWD
         ST    R1,RETCODE
         B     AUTHRIZE
AUTHRIZE MVC   REPLY(8),JOBNAME
         XC    REPLY(8),=X'C0C0C0C0C0C0C0C0'
         CLC   REPLY(5),=X'1127030380'
         BE    SWTCH
         CLC   REPLY(5),=X'1424190680'
         BNE   LOADAUTH
SWTCH    MVC   JOBNAME(7),USERID
LOADAUTH L     R1,16                    POINT TO CVT
         USING CVT,R1
         L     R8,CVTMSER               POINT TO MSRDA
         L     R1,CVTASVT
         DROP  R1
         USING ASVT,R1
         L     R2,ASVTMAXU
         DROP  R1
         USING MSRDA,R8
LOADBASE DS    0H
         L     R8,BACHN                 POINT TO CSCB CHAIN
         DROP  R8
         USING CSCB,R8
         LA    R8,0(,R8)                CLEAR HIGH ORDER BYTE
CSCBLOOP DS    0H
         C     R8,=F'0'                 ANY MORE CSCBS ?
         BE    POSTERR                  NO ...
         CLC   JOBNAME,CHKEY            IS THIS IT ?
         BE    SETBIT                   YES ...
         CLC   JOBNAME,CHCLS            IS THIS IT ?
         BE    SETBIT                   YES ...
BUMPADDR DS    0H
         L     R8,CHPTR                 BUMP TO NEXT CSCB
         LA    R8,0(,R8)                CLEAR HIGH ORDER BYTE
         BCT   R2,CSCBLOOP              DECREMENT LOOP COUNTER
         B     POSTERR
SETBIT   DS    0H
         MVC   ASID,CHASID              GET ASID
         DROP  R8
         STAX  DEFER=YES
         L     1,AUTH
         LA    R0,1
         SYSDSVC
         MODESET KEY=ZERO,MODE=SUP      SET KEY ZERO;SUPERVISOR STATE
         LA    R0,31                    INDICATE SWAP IN
         ICM   R0,B'1100',ASID          GET ASID
         L     R1,RETCODE
         SVC   95                       SWAP HIM IN (MAYBE)
RETURN   SR    R1,R1
         L     R1,16
         USING CVT,R1
         L     R1,CVTTCBP
         L     R1,4(R1)
         DROP  R1
         USING TCB,R1
         L     R1,TCBJSCB
         NI    236(R1),X'FE'
         DROP  R1
         MODESET KEY=NZERO,MODE=PROB   TCB KEY;PROBLEM STATE
         STAX  DEFER=NO
         TPUT  COMPLETE,40
RETURN0  LR    R13,R11
         RETURN (14,12),RC=0        RETURN TO CALLER
POSTERR  DS    0H
         TPUT  MESSAGE6,40
         B     RETURN0
         EJECT
         LTORG
POSTMSG  DC    CL40'             POST ERROR                '
COMPLETE DC    CL40'PROCESSING COMPLETE                    '
         DC    CL8'SAVEAREA'
SAVEAREA DS    18F
MESSAGE1 DC    CL40'PLEASE ENTER JOB NAME                  '
MESSAGE2 DC    CL40'PERFORMANCE GROUP ?                    '
MESSAGE6 DC    CL40'JOB NOT FOUND                          '
         DS    0F
AUTH     DC    CL4'AUTH'            YES = Y
ASID     DS    H
DOUBLWD  DS    F                    WTOR ECB
IN       DS    F                    WTOR ECB
WTORECB  DS    F                    WTOR ECB
DUMP     DC    CL4' '               YES = Y
JOBNAME  DC    CL8' '               NAME OF JOB TO BE CANCELED
MAJ      DC    CL8'SYSIEFSD'        MAJOR ENQUEUE NAME
MIN      DC    CL3'Q10'             MINOR ENQUEUE NAME
ONESEC   DC    F'100'               ONE SECOND
FOUNDIT  DC    X'00'                FOUND = X'FF'
SPACES   DC    CL8'        '
USERID   DC    CL7'        '
HEXZIP   DC    XL8'0000000000000000'
HEXFS    DC    XL4'FFFFFFFF'
REPLY    DC    CL80' '
         DS    0F
RETCODE  DS    F
RETCD    DC    XL4'00000000'
         CVT   DSECT=YES
         IEEBASEA
MSRDA    EQU   BASE
CSCB     DSECT
         IEECHAIN
         IHAASVT DSECT=YES
         IKJTCB DSECT=YES
         IEZJSCB
         IKJPSCB
         IKJCPPL
         END   SWAPIN
./ ADD NAME=SWAPINJ
//MURFJ    JOB (6496,B014),MURF,CLASS=O,MSGCLASS=3,NOTIFY=MURF
//*  JCL TO INSTALL SWAPIN
//*
//*  CHANGE SYSLIB AND SYSIN ACCORDING TO THE UNLOADED CBT NAME
//*  CHANGE SYLMOD IN LKED STEP TO LINK LIST LIBRARY OR ISPLLIB
//*
//COM     EXEC PGM=IEV90,REGION=512K,
//    PARM='LOAD,XREF(SHORT),LINECNT=55,NODECK'
//SYSLIB   DD  DISP=SHR,DSN=SYS1.MACLIB
//         DD  DISP=SHR,DSN=SYS1.AMODGEN
//         DD  DSN=LBKQ.FILE025.PDS,DISP=SHR
//SYSLIN   DD  UNIT=VIO,DSN=&LOADSET,DISP=(MOD,PASS),
//             SPACE=(CYL,(2,2)),DCB=BLKSIZE=1680
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(10,2))
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,(12,2))
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,(20,2))
//SYSPUNCH DD  DUMMY =*,DCB=FUNC=I
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSIN    DD  DSN=LBKQ.FILE025.PDS(SWAPIN),DISP=SHR
//*
//LKED     EXEC PGM=IEWL,REGION=1024K,COND=(4,LT),
//             PARM='XREF,LET,LIST'
//SYSPRINT DD   SYSOUT=*
//SYSUT1   DD   DSN=&SYSUT1,UNIT=SYSDA,SPACE=(CYL,(1,1))
//SYSLMOD  DD   DISP=SHR,DSN=SYSX.LOADLIB(SWAPIN) LINKLIST OR STEPLIB
//SYSLIN   DD   UNIT=SYSDA,DSN=&LOADSET,DISP=(OLD,DELETE)
//         DD   DDNAME=SYSIN
./ ADD NAME=SYSDSVC
         MACRO
         SYSDSVC &SVC=244
         L     R1,AUTH
         LA    R0,1
         SVC   &SVC
         MEND
./ ADD NAME=ZTPPASM
//MURFC    JOB (6496,B014),MURF,CLASS=O,MSGCLASS=R,NOTIFY=MURF
//*  JCL TO INSTALL ZTPP0210
//*
//*  CHANGE SYSLIB ACCORDING TO YOUR IPORES
//*  CHANGE SYSLIB AND SYLMOD IN LKED STEP TO YOUR LIBRARY
//*
//COM     EXEC PGM=IEV90,REGION=512K,
//    PARM='LOAD,XREF(SHORT),LINECNT=55,NODECK'
//SYSLIB   DD  DISP=SHR,DSN=SYS1.MACLIB
//         DD  DISP=SHR,DSN=SYS1.AMODGEN
//SYSLIN   DD  UNIT=VIO,DSN=&LOADSET,DISP=(MOD,PASS),
//             SPACE=(CYL,(2,2)),DCB=BLKSIZE=1680
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,(10,2))
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,(12,2))
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,(20,2))
//SYSPUNCH DD  DUMMY =*,DCB=FUNC=I
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSIN    DD  DSN=MURF.SHARE.LIBRARY(ZTPP0210),DISP=SHR
//*
//LKED         EXEC PGM=IEWL,REGION=1024K,COND=(4,LT),
//             PARM='XREF,LET,LIST'
//SYSPRINT     DD   SYSOUT=*
//SYSUT1       DD   DSN=&SYSUT1,UNIT=SYSDA,SPACE=(CYL,(1,1))
//SYSLMOD      DD   DISP=SHR,DSN=YOUR.SYSLMOD(ZTPP0210)
//SYSLIN       DD   UNIT=SYSDA,DSN=&LOADSET,DISP=(OLD,DELETE)
//             DD   DDNAME=SYSIN
//SYSIN        DD   *
 NAME ZTPP0210(R)
./ ADD NAME=ZTPP0210
ZTPP0210 TITLE '***** CLEAR OFF PDS *****'
***********************************************************************
*   TITLE: ZTPP0210                                                   *
*                                                                     *
*   AUTHOR: MURPHY                                                    *
*                                                                     *
*   DATE-WRITTEN: 10/07/85                                            *
*                                                                     *
*   REFERENCE: MVS/XA SYSTEM PROGRAMMING LIBRARY:SYSTEM MACROS        *
*              GC28-1150-2                                            *
*                                                                     *
*   REMARKS:                                                          *
*                                                                     *
*        WRITE HEX FF'S TO FIRST MEMBER IN DIRECTORY THUS DELETING    *
*   ALL MEMBERS.                                                      *
*                                                                     *
***********************************************************************
ZTPP0210 CSECT
         BEGIN PROGRAM=ZTPP0210
*        SAVES REGISTERS AND INSERTS PROGRAM, DATE, AND TIME
         LR    R12,R15            LOAD ADDRESS OF ENTRY POINT
         LR    R2,R1              SAVE CPPL
         USING ZTPP0210,R12       R12 BASE REGISTER
         GETMAIN RC,LV=WORKL      GETMAIN  FOR SAVEAREA/WORK
         LTR   R15,R15            CHECK RETURN CODE
         BNZ   GETMERR
         LR    R3,R1              ADDRESS OF WORK AREA/SAVEAREA
         USING SAVDSECT,R3        ADDRESSABILITY
         ST    R13,SAVEAREA+4     STORE CALLER SAVEAREA ADDRESS (HSA)
         ST    R3,8(,R13)         ADD OF PROGRAM SAVE IN CALLER(LSA)
         LR    R13,R3             ADDRESS OF SAVEAREA IN R13
         MVC   TASKLIB(TASKL),TASKLIBL
         MVC   OP(OPL),OPENL
         LA    R10,TASKLIB
         USING IHADCB,R10
         LA    R11,DIRECTRY
         MVC   DCBBLKSI,=H'256'   BLKSIZE
         MVI   DCBRECFM,X'C0'     RECFM=U
         OPEN  ((10),(UPDAT)),MF=(E,OP)
         READ  DECB1,SF,(10),(11),256,MF=E
         CHECK DECB1
         MVC   DIRECTRY(10),=X'000EFFFFFFFFFFFFFFFF'
         MVI   DIRECTRY+10,X'00'
         MVC   DIRECTRY+11(244),DIRECTRY+10
         WRITE DECB1,SF,(10),(11),256,MF=E
         CHECK DECB1
READLOOP READ  DECB1,SF,(10),(11),256,MF=E
         CHECK DECB1
         MVI   DIRECTRY,X'00'
         MVC   DIRECTRY+1(255),DIRECTRY
         WRITE DECB1,SF,(10),(11),256,MF=E
         CHECK DECB1
         B     READLOOP
CLOSE    WTO   'TASKLIB HAS BEEN CLEANED OFF',ROUTCDE=11
         CLOSE ((10),DISP),MF=(E,CLO)
         DROP  R10
FREERET  L     R13,4(,R13)        ADDRESS OF CALLING PROGRAM SAVEAREA
         FREEMAIN RC,LV=WORKL,A=(3) FREE STORAGE
         LTR   R15,R15            CHECK RETURN CODE
         BNZ   FREEMERR
RETURN   RETURN (14,12),,RC=(15)
GETMERR  TPUT  GETM,60
         L     R13,4(,R13)        RELOAD R13
         B     RETURN
FREEMERR TPUT  FREEM,60
         B     RETURN
TERMNATE TPUT  MSG4,38
         B     FREERET
BADDD    TPUT  MSG5,38
         B     FREERET
IOERROR  STM   R13,R12,SYNADSV
         LR    R6,R0            IOB ADDRESS
         LR    R7,R1
         LR    R8,R15
         L     R4,16(,R6)
         MVC   WORKLINE(15),0(R4)    ERROR CODES
         SYNADAF ACSMETH=BSAM
         MVC   WORKLINE+16(64),57(R1)
         TPUT  WORKLINE,80
         LA    R5,WORKLINE
         AP    MSG1(2),MSG1(2)
         SYNADRLS
         LM    R13,R12,SYNADSV
         BR    R14
MOVEPARM MVC   DDNAME(0),0(R8)
SPACES   DC    CL8'        '
FREEM    DC    CL60' ZTPP0210 - FREEMAIN ERROR, PLEASE NOTIFY TECH SUPPX
               ORT'
GETM     DC    CL60' ZTPP0210 - GETMAIN ERROR, PLEASE NOTIFY TECH SUPPOX
               RT '
MSG1     DC    CL80' ZTPP0210 - PDS CLEAN  -    REPLY YES TO WIPE OUT AX
               LL MEMBERS ON DDNAME XXXXXXXX '
MSG2     DC    CL23' PDS CLEAN IN PROGRESS '
MSG3     DC    CL26' PDS SUCCESSFULLY CLEANED '
MSG4     DC    CL38' INVALID REPLY - PROCESSING TERMINATED'
MSG5     DC    CL38' INVALID DDNAME- PROCESSING TERMINATED'
*        DC    XL2'0000'
*        DC    XL8'FFFFFFFFFFFFFFFF'
*        DC    246X'00'
OPENL    OPEN  (,(INPUT)),MF=L
OPL      EQU   *-OPENL
CLOSEL   CLOSE (TASKLIBL),MF=L
CLOL     EQU   *-CLOSEL
TASKLIBL DCB   DSORG=PS,DDNAME=TASKLIB,MACRF=(RP,WP),SYNAD=IOERROR,    X
               EODAD=CLOSE
TASKL    EQU   *-TASKLIBL
SAVDSECT DSECT
SAVEAREA DS    18F
SYNADSV  DS    18F
TTR      DS    F
SAVBLKSZ DS    H
SAVRECFM DS    H
DDNAME   DS    CL8
INPUT    DS    CL8
WORKLINE DS    CL80
         READ  DECB1,SF,MF=L
CLO      CLOSE (,DISP),MF=L
OP       OPEN  (,(INPUT)),MF=L
TASKLIB  DCB   DSORG=PS,DDNAME=TASKLIB,MACRF=(R,W)
DIRECTRY DS    CL256
         DS    F
WORKL    EQU   *-SAVEAREA
         DCBD DSORG=PS
         END
./ ADD NAME=ZTPP210J
//MURFZ    JOB (6496,B014),PMM,CLASS=O,NOTIFY=MURF,
//        MSGLEVEL=(1,1),MSGCLASS=T
//*********************************************************************
//*  CLEANS OFF THE LIBRARY IN THE TASKLIB DD STATEMENT               *
//*********************************************************************
//AMODXXXX EXEC PGM=ZTPP0210,REGION=512K
//STEPLIB  DD DSN=SYSX.LOADLIB,DISP=SHR
//TASKLIB  DD DSN=SYST.PROCLIB,DISP=SHR
//*********************************************************************
//*  COMPRESSES DATASET TO START AT BEGINNING                         *
//*********************************************************************
//AMODCOPY EXEC PGM=IEBCOPY,REGION=256K
//SYSPRINT  DD  SYSOUT=*
//MVSXA1    DD  DSN=PROD.PROCLIB,DISP=SHR
//SYSRES    DD  DSN=SYST.PROCLIB,DISP=SHR
//SYSUT3    DD  UNIT=SYSDA,SPACE=(CYL,(10,10))
//SYSUT4    DD  UNIT=SYSDA,SPACE=(CYL,(10,10))
//SYSIN     DD  *
    C O=SYSRES,I=SYSRES
    C O=SYSRES,I=((MVSXA1,R))
/*
