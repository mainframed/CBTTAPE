./ * SC88006 - Trim lines from TAKE files, count all bytes sent (even retry)
./ * SC88018 - Support longer minimum abbreviation for TYPE (e.g., TSO)
./ * SC88028 - Restore SHOW ALL
./ * SC88035 - Implement END cmd for TSO, add prompting for SEND/GET
./ * SC88042 - Use STCC to change CHARDEL+LINEDEL (TSO)
./ * SC88043 - Default TAKE type, fix DIR + REMOTE utils, fix OPENF T for (TSO)
./ * SC88048 - Set FDBACTV via TAKTAB instead of IKJDAIR (TSO)
./ * SC88049 - More re-entrancy, etc. (TSO)
./ * SC88050 - Trim blanks on SEND only for RECFM=F
./ * SC88053 - Better error handling for name collisions and BINARY
./ * SC88054 - Change def. UNIT, fix CWD, catch HOST cmds > 8 chars (TS
./ * SC88063 - Full-screen greetings for protocol mode (TSO)
./ * SC88070 - Treat PDS member names better (TSO)
./ * SC88071 - Allow disabling A-packets
./ * SC88074 - Fixes for talking to other Kermit server, honor STOP
./ * SC88076 - Clean up file collision, OPEN, RECFM=V truncation (TSO)
./ * SC88083 - Preserve existing PDS attributes; clear screen (TSO)
./ * SC88087 - Mark datasets "not in use" after host command (TSO)
./ * SC88089 - Suppress filename collision check when WARN is OFF
./ * SC88090 - Avoid BLKSIZE > disk track size (TSO)
./ * SC88091 - Tune up VTAM fix (TSO)
./ * SC88092 - Treat NAK(n+1) as ACK(n); tabulate file-by-file status
./ * SC88095 - Allow line delimiter on input, avoid STACK EOD ABEND (TSO)
./ * SC88096 - Generalize wildcards to include members (TSO)
./ * SC88100 - Skip wildcard setup if in-core file; clear NAK0 earlier
./ * SC88101 - Ignore sequence numbers in TAKE files (TSO)
./ * SC88104 - Avoid problem with 0 < BLKSIZE < LRECL (TSO)
./ * SC88106 - Avoid msg when deleting KER.BUF + strip leading car.ctl (TSO)
./ * SC88113 - Clean up implied file name extension for TAKE (TSO)
./ *                  .....Updates.....
./ * SC88006 - Trim lines from TAKE files, count all bytes sent (even retry)
./ I 02300000          $ 2300100 100                  01/07/88 14:52:50
         LR    3,1                                             @SC88006
         AR    3,0           Get end of buffer                 @SC88006
         BCTR  3,0                                             @SC88006
         CLI   0(3),C' '     Find last non-blank               @SC88006
         BE    *-6                                             @SC88006
         LA    0,1(3)        One past end of buffer            @SC88006
         SR    0,1           Get trimmed length                @SC88006
         BNP   LOOP          Nothing there, ignore it          @SC88006
./ D 08184000 08188000                                01/07/88 14:52:50
./ I 08526000          $ 8526100 100                  01/07/88 14:52:50
         LM    14,15,TOUTOT  Update send count                 @SC88006
         ALR   15,8                                            @SC88006
         BNO   *+8                                             @SC88006
         AL    14,F1                                           @SC88006
         STM   14,15,TOUTOT  Save new count                    @SC88006
./ * SC88018 - Support longer minimum abbreviation for TYPE (e.g., TSO)
./ R 03080000          $ 3080000 500                  01/20/88 15:17:14
         KW    'TYPE',LUPHSTI,MIN=TYPMIN                       @SC88018
./ R 05843000          $ 5843000 500                  01/19/88 19:33:45
         L     3,4(8)        Ptr to AID                        @SC88019
./ * SC88028 - Restore SHOW ALL
./ I 03519000          $ 3519500 500                  01/28/88 18:44:09
         KW    'ALL',SHOALL,MIN=3                              @SC88028
./ I 03548000          $ 3548300 300                  01/28/88 18:44:09
         CLI   SETXI,X'91'   SHOW?                             @SC88028
         BNE   SHOBAD        No, kill it                       @SC88028
./ * SC88035 - Implement END cmd for TSO, add prompting for SEND/GET
./ R 01411000          $ 1411000 500                  02/04/88 18:44:38
&KDATE   SETC  '88/1/31'                                       @SC88035
./ I 03053000          $ 3053200 200                  02/04/88 18:44:38
         AIF   ('&KSYS' NE 'TSO').TS0Z                         @SC88035
         KW    'END',KRMXIT,MIN=3  Synonym for QUIT            @SC88035
.TS0Z    ANOP
./ R 03099000          $ 3099000 300                  02/04/88 18:44:38
KRMGET   PTEXT 'Foreign filespec - ',AREG=1,LREG=0             @SC88035
         BAL   2,USNASKA     Prompt if user omitted args       @SC88035
         LA    0,FFGET+FFRCF                                   @SC88035
./ I 03101000          $ 3101300 300                  02/04/88 18:44:38
         PTEXT '&KSYS filespec - ',AREG=1,LREG=0               @SC88035
         BAL   2,USNASKT     Prompt if necessary               @SC88035
./ R 03135000          $ 3135000 300                  02/04/88 18:44:38
KRMSND   PTEXT '&KSYS filespec - ',AREG=1,LREG=0               @SC88035
         BAL   2,USNASKA     Prompt if necessary               @SC88035
         LA    0,FFSND                                         @SC88035
./ I 03137000          $ 3137300 300                  02/04/88 18:44:38
         PTEXT 'Foreign filespec - ',AREG=1,LREG=0             @SC88035
         BAL   2,USNASKT     Prompt if user omitted args       @SC88035
./ I 03151000          $ 3151070 70                   02/04/88 18:44:38
*
USNASKA  NI    KFLG,255-PRMP Assume no prompting               @SC88035
         FTOKN N=USNASK      Check for some text waiting       @SC88035
         BR    2             Ok, use it                        @SC88035
USNASKT  TM    KFLG,PRMP     Is prompting required?            @SC88035
         BZR   2             No, ok                            @SC88035
USNASK   OI    KFLG,PRMP     Must prompt for both filespecs    @SC88035
         LA    3,CMD         Use input buffer                  @SC88035
         ST    3,ADR                                           @SC88035
         RTEXT (3),PROMPT=((1),(0)) Ask for filespec           @SC88035
         ST    0,LEN         Save string length                @SC88035
         BR    2                                               @SC88035
./ I 03198000          $ 3198500 500                  02/04/88 18:44:38
PRMP     EQU   X'10'         Prompting for filespecs           @SC88035
./ I 08655000          $ 8655500 500                  02/04/88 20:31:09
         NI    FL2,255-PROTO End protocol mode                 @SC88035
./ * SC88042 - Use STCC to change CHARDEL+LINEDEL (TSO)
./ R 05905000          $ 5905000 1
STMOK    DS    0H                                              @SC88042
./ R 05942000          $ 5942000 1
         ICM   1,15,STMUOFF  Turn off, just in case            @SC88042
./ R 05946000 05953000 $ 5946000 1000
         ICM   1,3,STMUCH    Restore user's settings           @SC88042
         ICM   1,12,STMUOFF  Set flags to modify CDEL+LDEL     @SC88042
STMD     LA    0,7                                             @SC88042
         SLL   0,24          Set entry code for STCC           @SC88042
         SVC   94                                              @SC88042
         STC   0,STMUCH      Save previous LDEL                @SC88042
         STC   1,STMUCH+1    and CDEL                          @SC88042
         DROP  1,2                                             @SC88042
./ R 05965000          $ 5965000 1
STMUOFF  DC    X'3000FFFF'   No char & line delete             @SC88042
./ * SC88043 - Default TAKE type, fix DIR + REMOTE utils, fix OPENF T for PDS
./ I 01085000          $ 1085500 500
DESTL    DS    H'0'          Length                            @SC86299
./ D 01088000
./ R 05084000 05085000 $ 5084000 300
         LA    1,LFID                                          @SC88043
         LA    14,DEST       Default to prefix                 @SC88043
         LH    15,DESTL                                        @SC88043
         ICM   15,8,LOCASE+C' '                                @SC88043
         MVCL  0,14          Copy with blank fill              @SC88043
         LR    0,8           Restore ptr to name field         @SC88043
./ R 05122000          $ 5122000 500
FSPCP2   MVC   FSPCH1,0(6)   Save 1st char                     @SC88043
         MVI   TRTBL+C'.',1  Set to intercept these            @SC88043
./ I 05215000          $ 5215050 50
         TM    FSPFLG,FFHDR  Parse for TAKE?                   @SC88043
         BNZ   RTRN0         No, fine                          @SC88043
         CLI   FSPCH1,C''''  Fully qualified?                  @SC88043
         BE    RTRN0         Yes, honor it                     @SC88043
         LA    1,44(8)       No, find end of name              @SC88043
         LR    14,1                                            @SC88043
         TRT   0(44,8),TRTBL Get ptr to end+1 in R1            @SC88043
         SR    14,1          Length of name                    @SC88043
         CH    14,=H'5'                                        @SC88043
         BL    RTRN0         Too short anyway                  @SC88043
         S     1,F8                                            @SC88043
         CLC   0(8,1),SYSTAKE+5 Is it .KERMINI?                @SC88043
         BE    RTRN0         Yes, that's ok                    @SC88043
         CLC   =C'.TAKE',3(1) Or is is .TAKE?                  @SC88043
         BE    RTRN0         That's ok too                     @SC88043
         MVC   8(5,1),=C'.TAKE' No, use default type           @SC88043
./ D 05269000
./ I 05428000          $ 5428500 500
FSPCH1   DS    C             Saved 1st char of spec.           @SC88043
./ I 05431000          $ 5431500 500
* On entry, R6->help command string
./ R 05433000          $ 5433000 1
         LR    8,6           Save ptr to command               @SC88043
./ R 05441000 05447000 $ 5441000 1000
KHLI     LM    6,7,SCANPTR   Rest of string                    @SC88043
         AR    6,7           Ptr to end                        @SC88043
         LR    0,8           Start of command                  @SC88043
         SR    6,0           Total length                      @SC88043
         NI    FL4,255-UCMD                                    @SC88043
./ R 05519200 05519400 $ 5519200 50
         CLI   ECTSCMD,C'H'  Is it HELP?                       @SC88043
         BNE   *+12          It's not subcommand help          @SC88043
         TM    FL4,UCMD      It might be (if generated)        @SC88043
         BZ    *+10          ... yes, HELP as subcommand       @SC88043
./ D 05907000 05910000
./ I 05972000          $ 5972200 200
*       (will say "found" if member given, but it's not a PDS) @SC88043
*       (will say "not found" if given member of PDS is missing)
./ I 06035000          $ 6035500 500
         LR    5,2           Copy DSN ptr again                @SC88043
./ R 06039000          $ 6039000 50
         CLI   FABDSN+44,C' ' Did we want a member?            @SC88043
         BE    DSKTE1        No, fine                          @SC88043
         TM    DS1DSO,2      Was it a PDS?                     @SC88043
         BZ    DSKTE1        No, ignore the conflict for now   @SC88043
         MVI   FABDSN+44,0   Signal DSORG=PO                   @SC88043
         OPENF I,FABDSN,FILFDB,DSKTKT,E=RTRN1                  @SC88043
         L     1,DSKTKT                                        @SC88043
         FIND  (1),44(5),D   See if member is there            @SC88043
         LR    5,15          Save return code                  @SC88043
         CLOSF DSKTKT        Close it up again                 @SC88043
         LTR   5,5                                             @SC88043
         BNZ   RTRN1         Wasn't there                      @SC88043
DSKTE1   BAL   14,DSKVALS    Fill out FDB                      @SC88043
./ I 06047000          $ 6047400 400
         TM    FABBUFCB+3,1  Any buffers?                      @SC88043
         BO    DSKFRPZ       No, fine                          @SC88043
./ I 06048000          $ 6048500 500
DSKFRPZ  DS    0H            Now free whole FAB                @SC88043
./ I 06115000          $ 6115100 100
         MVC   DSKPSAV(8),DESTL+1 Save Kermit prefix           @SC88043
         L     14,ORGR1      Find User prefix                  @SC88043
         USING CPPL,14                                         @SC88043
         L     14,CPPLUPT                                      @SC88043
         USING UPT,14                                          @SC88043
         MVC   DESTL+1(1),UPTPREFL Use that for now            @SC88043
         MVC   DEST(7),UPTPREFX                                @SC88043
         DROP  14                                              @SC88043
./ I 06122000          $ 6122050 50
         LTR   0,0           Was it DIR?                       @SC88043
         BNZ   DSKUTP        No, use filespec(s) as is         @SC88043
         MVC   0(4,7),=C'LVL(' Yes, maybe need an option       @SC88043
         MVC   4(44,7),0(1)  If so, need whole filespec        @SC88043
         LA    0,4(7)                                          @SC88043
         LA    1,44                                            @SC88043
         LA    14,DEST       Comparand is user prefix          @SC88043
         LH    15,DESTL                                        @SC88043
         ICM   15,8,BLANK    Extended with blanks              @SC88043
         CLCL  0,14                                            @SC88043
         BE    DSKUTX        Just that - no options            @SC88043
         LA    1,4+44(7)                                       @SC88043
         TRT   4(44,7),TRTBL Find end of filespec              @SC88043
         MVI   0(1),C')'     And complete the syntax           @SC88043
         LA    7,1(1)        End of command string             @SC88043
         B     DSKUTX        Do it                             @SC88043
DSKUTP   DS    0H            Other utilities...                @SC88043
./ I 06127000          $ 6127500 500
DSKUTX   MVC   DESTL+1(8),DSKPSAV Restore Kermit prefix        @SC88043
./ R 06131000          $ 6131000 1
         NI    FL4,255-UCMD  Not user command: adr=(0),len=(6) @SC86295
./ I 06180000          $ 6180500 500
         MVI   FABMACR,X'48' MACRF=GL                          @SC88043
./ R 06182000          $ 6182000 1
         BNE   *+16          No                                @SC88043
./ I 06183000          $ 6183500 500
         MVI   FABMACR,X'24' ... and MACRF=R                   @SC88043
./ I 06184000          $ 6184500 500
         MVC   FABMACR+1(1),FABMACR                            @SC88043
./ R 06193000          $ 6193000 1
         MVI   FABOFLGS,2    Not open yet                      @SC88043
./ I 06242000          $ 6242200 200
         MVI   CIROPT,2      Get full names                    @SC87015
         L     3,CIRWA       Initialize length ptrs            @SC87015
         MVC   0(4,3),CIRWAL                                   @SC87015
./ D 06270000
./ I 06507000          $ 6507500 500
DSKTKT   DS    A             Ptr for testing member            @SC88043
./ I 06509000          $ 6509500 500
DSKPSAV  EQU   DSKMNTH,8     Buffer for saved prefix           @SC88043
./ * SC88048 - Set FDBACTV via TAKTAB instead of IKJDAIR (TSO)
./ D 01031000
./ D 01072000 01074000
./ D 01181000
./ D 05891000 05898000
./ R 06412000 06427000 $ 6412000 1000
         L     7,4(13)       Get previous stack frame          @SC88048
         USING SERVERSV,7    Assume SERVER or USNTRF           @SC88048
         ICM   0,15,TAKLEV   Any TAKE files open?              @SC88048
         BNPR  14            No, that's fine                   @SC88048
         CH    0,=Y(TAKMAX)  Be sure this is valid             @SC88048
         BNLR  14            Oops, give up                     @SC88048
DSKVACT  LR    6,0                                             @SC88048
         SLA   6,2                                             @SC88048
         L     6,TAKTAB-4(6) Fetch a file ticket               @SC88048
         CLC   FABDSN,FABDSN-FABD(6) Does the name match?      @SC88048
         BE    DSKVACS       Yes, this file is in use          @SC88048
         BCT   0,DSKVACT     No, keep looking                  @SC88048
         BR    14            No match, that's ok               @SC88048
DSKVACS  OI    FDBFLGS,FDBACTV Yes, turn on flag               @SC88048
         DROP  7                                               @SC88048
./ * SC88049 - More re-entrancy, etc. (TSO)
./ R 03099600          $ 3099600 100                  03/02/88 17:46:55
         LA    0,FFGET                                         @SC88049
./ R 03102000          $ 3102000 500                  03/02/88 17:46:55
         LA    0,FFGET+FFRCF                                   @SC88049
./ R 05058000 05059000 $ 5058000 1000                 03/02/88 17:50:49
* Parse GET 1st                        X
* Parse GET 2nd            X           X         set ROVR properly
./ I 05070000          $ 5070200 200
         LR    5,0                                             @SC88049
         SRL   5,4           Convert flags to index            @SC88049
./ R 05078000 05082000 $ 5078000 500
         IC    5,FSP0(5)     Get dispatch adr                  @SC88049
         B     FSP0(5)       Go to proper handler              @SC88049
*               TAKE        GET 1st    SEND 1st    Generic     @SC88049
FSP0    DC AL1(FSPCPY-FSP0,FSPSN2-FSP0,FSPASC-FSP0,FSPUTL-FSP0) SC88049
*               RECEIVE     GET 2nd    SEND 2nd    F-packet    @SC88049
        DC AL1(FSPRC-FSP0,FSPRC-FSP0,FSPSN2-FSP0,FSPHD-FSP0)   @SC88049
FSPUTL   TM    FSPFLG,FFWLD  Utility: default to all files?    @SC88049
./ D 05095000 05098000
./ D 05105000 05109000
./ R 05263000          $ 5263000 500                  02/24/88 18:55:31
         OPENF I,FSPDSN,FILFDB,PDSPTR,E=FSPDERM                @SC88049
./ R 05298000 05299000 $ 5298000 1000
         TM    FSPFLG,FFGET  User typed it?                    @SC87015
         BO    FSPRMP2       Yes                               @TS86001
./ I 05305000          $ 5305080 80                   02/24/88 18:55:31
FSPDERM  PTEXT '  File name collision'                         @SC88049
         L     1,EMSGP       Explanatory message               @SC88049
         MVC   0(21,1),0(3)                                    @SC88049
         ST    4,EMSGL                                         @SC88049
         B     FSP0H         Return ptrs and rc=1              @SC88049
./ R 05322000          $ 5322000 500                  02/24/88 18:55:31
         BNE   FSPDERM       No, abort operation               @SC88049
./ I 05853000          $ 5853500  00000500
         S     15,F3         Deduct AID length                 @SC88049
./ R 06008000 06010000 $ 6008000 1000
         MVI   DSKOPLS,X'80' Code for OPEN INPUT               @SC88049
         B     DSKOPT        Open and test                     @SC88049
./ R 06024000 06026000 $ 6024000 1
DSKOPN   MVI   DSKOPLS,X'8F' Code for OPEN OUTPUT              @SC88049
./ R 06028000          $ 6028000 1
         OPEN  MF=(E,DSKOPLS)                                  @SC88049
./ R 06046000 06047000 $ 6046000 400
         MVI   0(1),X'80'    Flag for normal close             @SC88049
         LR    2,1           Save ptr                          @SC88049
         CLOSE MF=(E,(1))    Close it                          @SC88049
         XC    0(4,2),0(2)   Ok, now clear ticket              @SC88049
./ I 06166000          $ 6166500 500
         ST    3,DSKOPLS     Save for OPEN plist               @SC88049
./ R 06461000          $ 6461000 1
         LR    6,5                                             @SC86299
./ R 06464000          $ 6464000 1
         LH    6,FABLRECL                                      @SC86299
./ R 06467000 06470000 $ 6467000 500
         LTR   6,6                                             @SC86299
         BP    DSKOPQ                                          @SC86299
         LA    6,80                                            @SC86299
         BAL   2,DSKTV                                         @SC88049
          LA   6,4(6)        Allow LRECL=84 for VB             @SC88049
DSKOPQ   TM    FABRECFM,FABRECF                                @SC86299
./ R 06473000 06474000 $ 6473000 1000
         DR    4,6                                             @SC86299
         MR    4,6                                             @SC86299
./ R 06476000          $ 6476000 1
DSKOPV   LA    4,4(6)                                          @SC86299
./ R 06480000          $ 6480000 1
DSKOPS   STH   6,FABLRECL                                      @SC86299
./ I 06493000          $ 6493500 500
         ORG   CAMVOLS+100   Do a little overlaying            @SC88049
./ I 06507500          $ 6507600 100
DSKOPLS  DS    F             Ptr to new FAB                    @SC88049
./ * SC88050 - Trim blanks on SEND only for RECFM=F
./ I 08760000          $ 8760300 300                  02/23/88 19:58:17
         CLI   FRECF,C'F'                                      @SC88050
         BNE   IBFTRUZ       Don't truncate if varying length  @SC88050
./ R 08766000          $ 8766000 500                  02/23/88 19:58:17
IBFTRUZ  BCTR  9,0           Point to last char of record      @SC88050
./ * SC88053 - Better error handling for name collisions and BINARY
./ I 02648000          $ 2648500 500                  02/23/88 20:16:43
EMSGL    DS    F             Length of msg                     @BS86090
./ D 02664000                                         02/23/88 20:16:43
./ R 07556000          $ 7556000 500                  02/23/88 20:16:43
         KCALL FSPEC,FILNAM,E=RECNER Check collisions          @SC88053
./ I 07662000          $ 7662300 300                  02/23/88 20:16:43
RECNER   LA    1,DSKSTT      Name error, point to dummy block  @SC88053
         MVC   FABCOMM-FABD(8,1),=CL8'Collisn'  Indicate type  @SC88053
./ D 08801000 08802000                                02/23/88 20:16:43
./ R 08805000 08806000 $ 8805000 500                  02/23/88 20:16:43
         BE    OBFLEN        Ok, do it                         @SC88053
         L     1,FILPTR      Ptr to disk FAB                   @SC88053
         MVC   FABCOMM-FABD(8,1),=CL8'Binary'                  @SC88053
         B     OBFERR        No, give up                       @SC88053
./ * SC88054 - Change def. UNIT, fix CWD, catch HOST cmds > 8 chars (TS
./ R 01055000          $ 1055000 1
&N&U     DC    CL8' '        Default unit                      @SC88054
./ R 01175000 01178000 $ 1175000  00000050
 MNOTE '---        FREEPOOL, GETLINE, GETMAIN, GTSIZE, IDENTIFY,'
 MNOTE '---        IKJCPPL, IKJECT, IKJGTPB, IKJIOPL, IKJUPT,'
 MNOTE '---        LINK, LOAD, LOCATE, OBTAIN, OPEN, POST,'
 MNOTE '---        PUTLINE, SAVE, STAX, STIMER, STSIZE,'
 MNOTE '---        SYNADAF, SYNADRLS, TGET, TPUT, TTIMER, WAIT'
./ D 01180000
./ D 01185000
./ I 05519000          $ 5519060 60
         CLM   7,7,F0                                          @SC88054
         BNE   ICPCMIL       Command name longer than 8        @SC88054
./ R 06282000          $ 6282000 500
         MVC   NXFN,0(1)     Copy name                         @SC88054
         LA    15,NXFN       Temp name ptr                     @SC88054
./ R 06285000 06287000 $ 6285000 1000
         BNZ   RTRN0         No conflict, assume valid         @SC88054
         TM    DS1DSO,2      Was a full DSN, check DSORG       @SC88054
         BO    DSKCWD1       It's a PDS -- see if it matches   @SC88054
./ R 06290000 06291000 $ 6290000 1
         B     RTRN0                                           @SC88054
./ * SC88063 - Full-screen greetings for protocol mode (TSO)
./ I 05821000          $ 5821200 200
         STFSMODE ON,INITIAL=YES,NOEDIT=YES Full-screen mode   @TS86001
./ I 05824000          $ 5824200 200
         STFSMODE OFF                                          @TS86001
./ R 05848400          $ 5848400 10
SCRWM    MVI   4(8),X'03'    Flags: FULLSCR code               @SC88063
./ * SC88070 - Treat PDS member names better (TSO)
./ R 05084900 05085200 $ 5084900 300                  03/10/88 13:02:57
         BAL   2,FSPBPAD     Copy with blank fill              @SC88070
./ R 05145000          $ 5145000 100                  03/10/88 13:02:57
         BNE   FSPDOT        No, join with a dot               @SC88070
         BAL   2,FSPBFIL     Yes, prefix is entire DSN         @SC88070
         TM    FSPFLG,FFHDR  Reading from header packet?       @SC88070
         BNO   FSPCPP        No, user must have entered it     @SC88070
         BAL   9,FSPFDOT     Ok, find file type, if any        @SC88070
         LR    7,1           And skip it                       @SC88070
         B     FSPCPG                                          @SC88070
./ R 05150000 05154000 $ 5150000 1000                 03/10/88 13:02:57
FSPCPA   BAL   9,FSPFDOT     Find a break (dot or end)         @SC88070
./ R 05181000 05187000 $ 5181000 1000                 03/10/88 13:02:57
FSPCPF   BAL   2,FSPBFIL     Fill the rest with blanks         @SC88070
./ I 05196000          $ 5196500 500                  03/10/88 13:02:57
         LA    15,8          Length of member name, if any     @SC88070
./ D 05198000                                         03/10/88 13:02:57
./ R 05200000 05201000 $ 5200000 1000                 03/10/88 13:02:57
FSPCPM   LR    14,0                                            @SC86299
         ICM   7,8,BLANK                                       @SC86299
./ I 05230000          $ 5230070 70                   03/10/88 13:02:57
*
FSPBFIL  LR    1,15          Length remaining                  @SC88070
         SR    15,15         Set up just to pad                @SC88070
FSPBPAD  ICM   15,8,BLANK                                      @SC88070
         MVCL  0,14          Copy with blank fill              @SC88070
         BR    2                                               @SC88070
*
FSPFDOT  LA    1,1(7)        End of string                     @SC88070
         LA    2,2           In case no breaks                 @SC86299
         SR    7,6                                             @SC86299
         EX    7,FSPTRT      Find break                        @SC86299
         AR    7,6           Restore ptr to last char          @SC86299
         BR    9                                               @SC88070
./ R 05333000 05337000 $ 5333000 200                  03/10/88 13:02:57
         MVC   0(8,7),44(4)  Yes, use member name              @SC88070
         LA    1,8(7)        Possible end                      @SC88070
         TRT   0(8,7),TRTBL  Find end of name                  @SC88070
         LR    5,1           Save                              @SC88070
         BAL   9,FSPESCNS    Find last DSN qualifier           @SC88070
         MVI   0(5),C'.'     Join to member name               @SC88070
         MVC   1(8,5),0(3)   Copy the qualifier                @SC88070
         SR    5,7           Length of member name             @SC88070
         LA    1,1(5,1)      Adjust effective end of DSN       @SC88070
         B     FSPENTR       Done, convert to ASCII            @SC88070
FSPENT   BAL   9,FSPESCNS    Find last qualifier               @SC88070
         BCTR  3,0           Move back to separating dot       @SC88070
         BAL   9,FSPESCN     Back to previous qualifier        @SC88070
         MVC   0(17,7),0(3)  At most 2 tokens + dot            @SC86299
         B     FSPENTR       Done, convert to ASCII            @SC88070
*
FSPESCNS LA    1,44(4)                                         @SC86299
./ D 05339000                                         03/10/88 13:02:57
./ D 05346000                                         03/10/88 13:02:57
./ R 05348000          $ 5348000 500                  03/10/88 13:02:57
         BR    9                                               @SC88070
FSPENTR  DS    0H            Translate and adjust ptr          @SC88070
./ * SC88071 - Allow disabling A-packets
./ I 03531000          $ 3531500 500                  03/14/88 22:41:57
         KW    'ATTRIBUTES',SHOATT,MIN=3                       @SC88071
./ I 03598000          $ 3598300 300                  03/14/88 22:41:57
SHOATT   BAL   14,SHOOO      On or off                         @SC88071
          OI   SCAPA,8                                         @SC88071
./ I 07605000          $ 7605500 500                  03/14/88 22:41:57
         DC    C'+',AL3(RECRJC) File disposition               @SC88071
./ * SC88074 - Fixes for talking to other Kermit server, honor STOP
./ R 01411000          $ 1411000 500                  03/14/88 18:44:38
&KDATE   SETC  '88/3/14'                                       @SC88074
./ R 01847000          $ 1847000 500                  03/16/88 22:22:51
INPUTINR DS    0H                                              @SC88074
./ I 01848000          $ 1848200 200                  03/16/88 22:22:51
         TM    FL3,ZPRO                                        @SC88074
         BO    INPUTQRT      Must stop pronto                  @SC88074
         MVI   ERRNUM,ERRIPT Assume bad packet type            @SC88074
./ R 01948000          $ 1948000 500                  03/16/88 22:22:51
         B     12(8)         Skip over 3-entry table           @SC88074
./ I 02600000          $ 2600500 500                  03/16/88 22:22:51
ZPRO     EQU   X'80'         Stop protocol mode pronto         @SC88074
./ I 03110000          $ 3110500 500                  03/16/88 22:22:51
         DC    XL1'FF',AL3(KRMGETAB) Stop                      @SC88074
./ I 03128000          $ 3128500 500                  03/14/88 22:27:06
         MVI   RTYPE,0       No packet read yet                @SC88074
./ R 04191000          $ 4191000 500                  03/16/88 22:22:51
         DC    XL1'FF',AL3(GENRET)   Stop       these 3        @SC88074
         DC    AL1(00),AL3(GENAB3)   Error      items.         @SC88074
./ R 04196000          $ 4196000 300                  03/14/88 22:27:06
         DC    AL1(AX),AL3(GENRPX)   Long reply already INIT   @SC88074
         DC    AL1(AF),AL3(GENRPX)   Long reply already INIT   @SC88074
         DC    XL1'FF',AL3(GENRET)   Stop                      @SC88074
         DC    AL1(00),AL3(GENAB3)   Error                     @SC88074
./ R 04221000          $ 4221000 300                  03/14/88 22:27:06
GENRPX   CLI   BCTR,1        This works only with 1-byte check @SC88074
         BNE   GENAB3                                          @SC88074
GENRPL   DS    0H            Long reply                        @SC88074
./ D 04224000                                         03/14/88 22:27:06
./ I 04236000          $ 4236300 300                  03/14/88 22:27:06
         B     GENABR                                          @SC88074
GENAB3   IC    9,FL3         Save flags                        @SC88074
./ I 07016000          $ 7016500 500                  03/16/88 22:22:51
         DC    XL1'FF',AL3(SRVSTP)  Stop                       @SC88074
./ I 07018000          $ 7018300 300                  03/16/88 22:22:51
         TM    FL3,ZPRO      Must stop?                        @SC88074
         BO    SRVXIT        Yes, return immediately           @SC88074
./ I 07221000          $ 7221200 200                  03/16/88 22:22:51
*
SRVSTP   MVC   TIMOUT,SRVTIM Restore timeout                   @SC88074
         B     SRVXIT                                          @SC88074
./ I 07267000          $ 7267500 500                  03/16/88 22:22:51
         DC    XL1'FF',AL3(SNDABR)   Stop                      @SC88074
./ R 07514000          $ 7514000 200                  03/14/88 22:27:06
         CLI   RTYPE,AF      Starting with file header packet? @SC88074
         BE    RECFHD        Yes, skip INIT stuff              @SC88074
         CLI   RTYPE,AX                                        @SC88074
         BE    RECFHD        Yes, skip INIT stuff              @SC88074
./ R 07518000 07519000 $ 7518000 500                  03/14/88 22:27:06
         CLI   RTYPE,0                                         @SC88074
         BNE   RECSRV        Skip read if already got packet   @SC88074
         MVI   SEQ,0         Reset packet number               @SC88074
./ R 07529000 07530000 $ 7529000 500                  03/14/88 22:27:06
RECFIL   KCALL RPACK         Get header packet                 @SC88074
RECFHD   LA    8,RECFNST     Next state table for RECEIVE F    @SC88074
         SR    3,3           Clear retry counter for INPUTLUP  @SC88074
         BAL   9,INPUTINR    Interpret header packet           @SC88074
./ I 07673000          $ 7673500 500                  03/16/88 22:22:51
         DC    XL1'FF',AL3(RECABR)   Stop                      @SC88074
./ I 07677000          $ 7677500 500                  03/16/88 22:22:51
         DC    XL1'FF',AL3(RECABR)   Stop                      @SC88074
./ I 07681000          $ 7681500 500                  03/16/88 22:22:51
         DC    XL1'FF',AL3(RECABR)   Stop                      @SC88074
./ I 08288000          $ 8288500 500                  03/16/88 22:22:51
         NI    RTYPE,X'7F'   Assure conventional ASCII char    @SC88074
./ I 08372000          $ 8372040 40                   03/16/88 22:22:51
         L     8,APKT        Ptr to packet                     @SC88074
         MVC   STOPBUF,0(8)  Copy to work area                 @SC88074
         LA    8,STOPBUF                                       @SC88074
         L     7,RCVPKL                                        @SC88074
         AR    7,8           Ptr to packet end in work area    @SC88074
         CLC   RMARK,0(8)                                      @SC88074
         BE    RPKNAK        Assume bad packet if SOH present  @SC88074
         BCTR  7,0                                             @SC88074
         CLC   REOL,0(7)                                       @SC88074
         BNE   *+6                                             @SC88074
          BCTR 7,0           Don't count closing EOL           @SC88074
         TR    STOPBUF,ATOE                                    @SC88074
         TR    STOPBUF,UPCASE                                  @SC88074
         CLI   0(8),C'S'                                       @SC88074
         BE    *+8                                             @SC88074
          LA   8,1(8)        Allow one extra character in front@SC88074
         S     7,F3          Back len(STOP) - 1                @SC88074
         CR    7,8                                             @SC88074
         BNE   RPKNAK        Doesn't match exactly             @SC88074
         CLC   =C'STOP',0(8)                                   @SC88074
         BE    RPKSTP        Exact match                       @SC88074
./ I 08374000          $ 8374100 100                  03/16/88 22:22:51
*                                                              @SC88074
RPKSTP   OI    FL3,ZPRO      Indicate stopping protocol mode   @SC88074
         MVI   ERRNUM,ERRTRC Transfer cancelled, if any        @SC88074
         MVI   RTYPE,X'FF'   Special packet type for quitting  @SC88074
         RET                                                   @SC88074
./ I 08375000          $ 8375100 100                  03/16/88 22:22:51
STOPBUF  DS    CL8           Work area                         @SC88074
./ I 08485000          $ 8485500 500                  03/14/88 22:27:06
         MVI   RTYPE,0       Clear previous received packet    @SC88074
./ R 08644000          $ 8644000 500                  03/16/88 22:22:51
INTINICL NI    FL3,255-ZPRO  Now stopping protocol mode        @SC88074
         TM    FL2,PROTO     Was line open?                    @SC88074
./ * SC88076 - Clean up file collision, OPEN, RECFM=V truncation (TSO)
./ R 05268000 05270000 $ 5268000 2000                 03/16/88 16:34:49
         LA    9,FSPRMPT     Go if member is found             @SC88076
         BALR  3,0           Set up any rechecking             @SC88076
./ R 05280000          $ 5280000 1000                 03/16/88 16:34:49
         BO    FSPDERM       Too bad                           @SC88076
./ D 05305000                                         03/16/88 16:34:49
./ R 05319000          $ 5319000 1000                 03/16/88 16:34:49
         BNP   FSPDERR       If zero give up                   @SC88076
./ R 05321000 05322000 $ 5321000 1000                 03/16/88 16:34:49
         CLC   =C'OK',0(7)   Was reply "ok"?                   @SC88076
         BNE   FSPDERR       No, abort operation               @SC88076
./ I 05480850          $ 5480870 20                   03/16/88 16:34:49
         MVI   CPECB,0       Clear ECB (for neatness)          @SC88076
./ I 05486240          $ 5486260 20                   03/16/88 16:34:49
         MVI   CPECB,0       Clear ECB (for neatness)          @SC88076
./ R 06083000 06086000 $ 6083000 500                  03/16/88 16:34:49
         CH    5,FDBLRC                                        @SC88076
         BNH   DSKWR1        Length is ok                      @SC88076
         LA    5,1                                             @SC88076
         A     5,RECTRC      Remember truncations...           @SC88076
         ST    5,RECTRC                                        @SC88076
         LH    5,FDBLRC      Don't allow more than LRECL if V  @SC88076
DSKWR1   LR    6,5           Copy for LRECL                    @SC88076
./ I 06412000          $ 6412100 100                  03/16/88 16:34:49
         L     1,4(7)        and the one before                @SC88076
         CLC   ASERVER,16(1) Was the caller SERVER?            @SC88076
         BE    *+12          Yes, ok                           @SC88076
          CLC  AUSNTRF,16(1) No, was it USNTRF?                @SC88076
          BNER 14            No, don't bother checking TAKE's  @SC88076
./ * SC88083 - Preserve existing PDS attributes; clear screen (TSO)
./ I 05821200          $ 5821600 400                  03/24/88 12:09:59
         TPUT  CLRSPEC,CLRSPECL,FULLSCR  Clear the screen      @TS86001
./ I 05854000          $ 5855000 1000                 03/24/88 12:09:59
*
CLRSPEC  DC    X'C2',AL1(SBA),X'4040',X'3C404000' Clear screen @TS86001
CLRSPECL EQU   *-CLRSPEC     Length of clear screen            @TS86001
./ I 06018000          $ 6018300 300                  03/24/88 12:09:59
         TM    DS1DSO,2      PDS?                              @SC88083
         BO    DSKOPVA       Yes, keep the other members!      @SC88083
./ I 06020000          $ 6020300 300                  03/28/88 18:05:59
         MVI   DYNDSP,X'28'  MOD,KEEP                          @SC88083
DSKOPVA  DS    0H                                              @SC88083
./ D 06023000                                         03/28/88 18:05:59
./ * SC88087 - Mark datasets "not in use" after host command (TSO)
./ I 05538000          $ 5538070 70                   03/29/88 16:40:06
         LA    1,ATCTXP      Set up req blk ptr to text list   @SC88087
         LA    4,ATCTXT      Text list follows RB              @SC88087
         MVC   0(6,4),=H'1,1,4' Text unit type 1: TCB adr      @SC88087
         LA    5,ATCDRB      RB ptr follows text list          @SC88087
         ST    1,ATCDRB+8    Fill in RB                        @SC88087
         STM   4,5,ATCTXP    Fill in text list + RB ptr        @SC88087
         MVI   ATCTXP,X'80'  Only item in text list            @SC88087
         MVC   0(2,5),=AL1(20,5) Finish up RB: length, type    @SC88087
         MVI   ATCRBP,X'80'                                    @SC88087
         LA    1,ATCRBP                                        @SC88087
         SVC   99            DYNALLOC to free allocations      @SC88087
./ I 05658000          $ 5658500 500                  03/29/88 16:40:06
ATCTXT   EQU   ATCHTCB-6,6   Prefix to TCB ptr (watch overlap!)@SC88087
./ I 05659600          $ 5659660 60                   03/29/88 16:40:06
         ORG   STKDYN        Overlay interception stuff        @SC88087
ATCDRB   DS    5F            DYNALLOC RB (init to zeroes)      @SC88087
ATCTXP   DS    A             Text unit list (ATCTXT)           @SC88087
ATCRBP   DS    A             Ptr to RB                         @SC88087
         ORG   ,                                               @SC88087
./ * SC88089 - Suppress filename collision check when WARN is OFF
./ I 03105000          $ 3105300 300                  03/29/88 14:54:42
         TM    FL1,REN+ROVR  Warning ON and name given?        @SC88089
         BNO   USNGCK        No, don't check for collision yet @SC88089
./ I 03107000          $ 3107500 500                  03/29/88 14:54:42
USNGCK   DS    0H                                              @SC88089
./ I 03125000          $ 3125300 300                  03/29/88 14:54:42
         TM    FL1,REN+ROVR  Warning ON and name given?        @SC88089
         BNO   USNRCK        No, don't check for collision yet @SC88089
./ I 03127000          $ 3127500 500                  03/29/88 14:54:42
USNRCK   DS    0H                                              @SC88089
./ * SC88090 - Avoid BLKSIZE > disk track size (TSO)
./ I 06027000          $ 6027100 100                  03/30/88 16:06:47
         CLI   DYNDSP,X'42'  NEW dataset?                      @SC88090
         BNE   DSKOPBZ       No, assume BLKSIZE is ok          @SC88090
         DEVTYPE FABDDNAM,DYNPL  Yes, get max block            @SC88090
         ICM   0,15,DYNPL+4                                    @SC88090
         BNH   DSKOPBZ       Max not defined??                 @SC88090
         CH    0,FABBLKSI                                      @SC88090
         BNL   DSKOPBZ       Current BLKSIZE is ok             @SC88090
         STH   0,FABBLKSI    Mustn't exceed physical limits!   @SC88090
DSKOPBZ  DS    0H                                              @SC88090
./ * SC88091 - Tune up VTAM fix (TSO)
./ I 01096000          $ 1096500 500                  04/05/88 13:34:19
SCRLST   DS    X             Flag for previous I/O op          @SC88091
./ I 05821000          $ 5821100 100                  04/05/88 13:34:19
         MVI   SCRLST,0      Clear op code                     @SC88091
./ I 05831800          $ 5831900 100                  04/05/88 13:34:19
         SR    2,2                                             @SC88091
         IC    2,SCRLST      1=>Write, 2=>Read, 3=>Wr. msg.    @SC88091
         STC   0,SCRLST      Save new code                     @SC88091
./ I 05835000          $ 5835080 80                   04/05/88 13:34:19
         C     2,F3          Was last operation a Write msg?   @SC88091
         BNE   SCRRD1        No, fine                          @SC88091
         TPG   =X'F6',1      Yes, must trigger a READ MOD      @SC88091
SCRRD1   DS    0H                                              @SC88091
./ * SC88092 - Treat NAK(n+1) as ACK(n); tabulate file-by-file status
./ R 01565000          $ 1565490 490                  04/01/88 22:35:38
         AH    1,=Y(MAXNSENT*(LFID+5)) Length of table         @SC88092
./ R 01869000          $ 1869000 1000                 04/01/88 21:03:42
INPUTACK MVI   RTYPE,AY      Fake an ACK                       @SC88092
./ I 01875000          $ 1875100 100                  04/01/88 21:03:42
         IC    2,SEQ         Expected packet number            @SC88092
         LA    2,1(2)                                          @SC88092
         N     2,MOD64       Get next number                   @SC88092
         CLM   2,1,RSN       Is that what we got?              @SC88092
         BE    INPUTACK      Yes, treat as an ACK              @SC88092
./ R 02236000          $ 02236000 500
         BC    12,*+8                                          @SC88092
./ I 02453000          $ 2453500 500                  04/01/88 22:35:38
FLFID1   DC    A(LFID+5)     Length of items in filespec table @SC88092
./ R 04060000 04062000 $ 4060000 100                  04/01/88 22:35:38
         LA    0,FFDSP                                         @SC88092
         KCALL FSPEC,(5)     Copy name for display             @SC88092
         MVC   0(2,15),=C' ('                                  @SC88092
         LA    15,2(15)                                        @SC88092
         ICM   4,15,LFID(5)  Get file size                     @SC88092
         BAL   2,EDDEC       Format into message               @SC88092
         MVC   0(2,15),=C'k)'                                  @SC88092
         LA    15,2(15)                                        @SC88092
         SR    2,2                                             @SC88092
         ICM   2,1,LFID+4(5) Get corresponding error code      @SC88092
         BZ    DMPNN         No error, that's fine             @SC88092
         SLL   2,2                                             @SC88092
         A     2,AERRTAB     Get ptr into error table          @SC88092
         SR    3,3                                             @SC88092
         IC    3,0(2)        Length of message                 @SC88092
         L     2,0(2)        And message ptr                   @SC88092
         MVC   0(4,15),=C' -- '                                @SC88092
         MVC   4(50,15),0(2) Copy message                      @SC88092
         LA    15,4(3,15)                                      @SC88092
DMPNN    BAL   2,STAPM15     Display name (+ error)            @SC88092
         A     5,FLFID1      Next filespec                     @SC88092
./ R 06392000          $ 06392000 500
         BC    12,*+8        No overflow                       @SC88092
./ R 07283000          $ 7283000 500                  04/01/88 22:35:38
         A     5,FLFID1      Next filespec                     @SC88092
./ R 07341000          $ 7341000 500                  04/01/88 22:35:38
         MH    3,FLFID1+2    Times length of items             @SC88092
./ I 07343000          $ 7343500 500                  04/01/88 22:35:38
         XC    LFID(5,3),LFID(3) Clear error code              @SC88092
./ I 07445000          $ 7445500 500                  04/01/88 22:35:38
         BAL   14,SERRCD     Save code in table                @SC88092
./ I 07470000          $ 7470500 500                  04/01/88 22:35:38
         MVI   ERRNUM,ERRNOE No error yet                      @SC88092
./ I 07490000          $ 7490500 500                  04/01/88 22:35:38
         BAL   14,SERRCD     Save code in table                @SC88092
./ I 07495000          $ 7495060 60                   04/01/88 22:35:38
*
SERRCD   LM    2,3,DSKTOT    Current byte count                @SC88092
         SL    3,SSVDSK+4    Get difference from this file     @SC88092
         BC    3,*+6                                           @SC88092
          BCTR 2,0                                             @SC88092
         SL    2,SSVDSK                                        @SC88092
         SRDL  2,10          Convert to Kbytes                 @SC88092
         MVC   SSVDSK(8),DSKTOT                                @SC88092
         ICM   2,15,NSENT    Calculate offset into table       @SC88092
         BZR   14            Must not be counting              @SC88092
         MH    2,FLFID1+2                                      @SC88092
         A     2,TSENT       Ptr to next name slot             @SC88092
         S     2,F5                                            @SC88092
         STCM  3,15,0(2)     Save file size in Kbytes          @SC88092
         MVC   4(1,2),ERRNUM Save error code for file          @SC88092
         BR    14                                              @SC88092
./ I 07501000          $ 7501100 100                  04/01/88 22:35:38
SSVDSK   DS    D             Saved disk byte count             @SC88092
./ I 07511000          $ 7511500 500                  04/01/88 22:35:38
         XC    NSENT,NSENT   Clear count of files              @SC88092
./ I 07565000          $ 7565090 90                   04/01/88 22:35:38
         L     3,NSENT       Number of files sent so far       @SC88092
         C     3,=A(MAXNSENT) Did we rcv more than countable?  @SC88092
         BNL   RECCNT        Yes, cannot keep track of 'em     @SC88092
         LA    4,1(3)        Ok, new number of rcvd files      @SC88092
         ST    4,NSENT                                         @SC88092
         MH    3,FLFID1+2    Times length of items             @SC88092
         A     3,TSENT       Location in table                 @SC88092
         MVC   0(LFID,3),FILNAM Save filespec                  @SC88092
         XC    LFID(5,3),LFID(3) Clear error code              @SC88092
RECCNT   DS    0H                                              @SC88092
./ I 07644000          $ 7644300 300                  04/01/88 22:35:38
         MVI   ERRNUM,ERRNOE No error yet                      @SC88092
         BAL   14,RERRCD     Save code in table                @SC88092
./ I 07664000          $ 7664500 500                  04/01/88 22:35:38
         BAL   14,RERRCD     Save code in table                @SC88092
./ I 07671000          $ 7671060 60                   04/01/88 22:35:38
*
RERRCD   LM    2,3,DSKTOT    Current byte count                @SC88092
         SL    3,RSVDSK+4    Get difference from this file     @SC88092
         BC    3,*+6                                           @SC88092
          BCTR 2,0                                             @SC88092
         SL    2,RSVDSK                                        @SC88092
         SRDL  2,10          Convert to Kbytes                 @SC88092
         MVC   RSVDSK(8),DSKTOT                                @SC88092
         ICM   2,15,NSENT    Calculate offset into table       @SC88092
         BZR   14            Must not be counting              @SC88092
         MH    2,FLFID1+2                                      @SC88092
         A     2,TSENT       Ptr to next name slot             @SC88092
         S     2,F5                                            @SC88092
         STCM  3,15,0(2)     Save file size in Kbytes          @SC88092
         MVC   4(1,2),ERRNUM Save error code for file          @SC88092
         BR    14                                              @SC88092
./ I 07683000          $ 7683100 100                  04/01/88 22:35:38
RSVDSK   DS    D             Saved disk byte count             @SC88092
./ R 08259000          $ 08259000 500
         BC    12,*+8                                          @SC88092
./ R 08526300          $ 08526300 300
         BC    12,*+8                                          @SC88092
./ R 08722000          $ 08722000 500
         BC    12,*+8                                          @SC88092
./ R 08841000          $ 08841000 500
         BC    12,*+8                                          @SC88092
./ * SC88095 - Allow line delimiter on input, avoid STACK EOD ABEND (TSO)
./ I 00807000          $ 807200 200
         AIF   ('&KSYS' EQ '').NOCK                            @SC88095
         KCALL SUPFNC,7,E=RTE&SYSNDX Skip prompt if stacked    @SC88095
.NOCK    ANOP
./ R 00809100          $ 809100 100
RTE&SYSNDX KCALL GETLIN,&BUF,E=&E                              @SC88095
./ I 00872000          $ 872500 500
         KW    'DELIM',SHODLM,MIN=4                            @SC88095
./ I 00883000          $ 883100 100
SETDLM   NTOKN N=SETDLM1,H=SETDLMH                             @SC88095
         LTR   7,7           Exactly one character?            @SC88095
         BNZ   SETDLMH       No, explain it                    @SC88095
         MVC   LNDLM,0(6)    Yes, use that character           @SC88095
         B     RTRN0                                           @SC88095
SETDLM1  MVI   LNDLM,C' '    Turn delimiter off                @SC88095
         B     RTRN0                                           @SC88095
SETDLMH  PTEXT 'Line delimiter: one char or none'              @SC88095
         B     SUBERR                                          @SC88095
./ I 00891000          $ 891200 200
SHODLM   LA    8,LNDLM       Show delimiter                    @SC88095
         BAL   14,SHOCHR                                       @SC88095
          B    SETDLM                                          @SC88095
./ I 01130000          $ 1130200 200
&P.LNDLM DC    C' '          Initially no delimiter            @SC88095
./ R 05597000 05598000 $ 5597000 500                  04/06/88 00:10:49
         BNH   RTRN1         Got one now                       @SC88095
         MVC   GTPBIBUF,F0   Clear it, just in case            @SC88095
         B     RTRN0         Nothing stacked                   @SC88095
./ R 05780000 05783000 $ 05780000 800
         LR    8,1           Save buffer ptr                   @SC88095
         LA    9,256         For copying                       @SC88095
         LA    3,APGPB       Ptr to GETLINE block              @SC88095
         USING GTPB,3                                          @SC88095
         ICM   5,15,GTPBIBUF Already got something?            @SC88095
./ R 05786000          $ 05786000 1000                04/08/88 16:40:27
         GETLINE PARM=(3),TERMGET=(EDIT,WAIT),ENTRY=(15),      @SC88095+
./ R 05788000          $ 05788000 1000
         SR    2,2                                             @SC88095
./ R 05791000 05799000 $ 05791000 100
         L     5,GTPBIBUF    Ptr to input buffer               @SC88095
GTL1     LH    1,0(5)        Length of stuff (inc. header)     @SC88095
         AR    1,5           End of buffer                     @SC88095
         LR    0,1           Save end                          @SC88095
         LH    6,2(5)        Get starting offset (init. 0)     @SC88095
         LA    6,4(6,5)      Ptr into buffer                   @SC88095
         LR    2,1                                             @SC88095
         SR    2,6           Length of text remaining          @SC88095
         BNP   GTLFRE        None, return length 0             @SC88095
         SR    4,4                                             @SC88095
         IC    4,LNDLM       Get delimiter                     @SC88095
         LA    4,TRTBL(4)    Ptr to delimiter char             @SC88095
         MVI   0(4),1        Set up to snag delims             @SC88095
         MVI   TRTBL+C' ',0  And ignore blanks                 @SC88095
         CR    2,9           Get shorter of 256 and string     @SC88095
         BNH   *+6                                             @SC88095
          LR   2,9                                             @SC88095
         BCTR  2,0           Set up for EX                     @SC88095
         EX    2,GTLTRT                                        @SC88095
         MVI   0(4),0        Now clear out table               @SC88095
         MVI   TRTBL+C' ',1  And restore                       @SC88095
         SR    1,6           Length of line                    @SC88095
         LR    7,1           Set up MVCL                       @SC88095
         CR    9,7           Get shorter of 256 and string     @SC88095
         BNH   *+6                                             @SC88095
          LR   9,7                                             @SC88095
         LR    2,9           Length actually copied            @SC88095
         MVCL  8,6                                             @SC88095
         AR    6,7           In case we couldn't use it all    @SC88095
         CR    6,0           Finished input?                   @SC88095
         BNL   GTLFRE        Yes, release it                   @SC88095
         S     6,F3          + 1 - 4: skip over linend char    @SC88095
         SR    6,5           New offset ptr                    @SC88095
         STH   6,2(5)                                          @SC88095
         B     GTLZ          Return                            @SC88095
GTLFRE   LR    1,5           This buffer is used up            @SC88095
         LH    0,0(1)        Get total length                  @SC88095
./ R 05802000 05804000 $ 5802000 1000
GTLZ     L     1,4(13)                                         @SC88095
         ST    2,20(1)       Return as R0                      @SC88095
./ R 05806000 05807000 $ 5806000 1000
         DROP  3                                               @SC88095
GTLTRT   TRT   0(,6),TRTBL   Find a delimiter                  @SC88095
./ * SC88096 - Generalize wildcards to include members (TSO)
./ I 05209000          $ 5209100 100                  04/14/88 14:53:13
         CLI   FSPFLG,FFUTL  DELETE?                           @SC88096
         BE    FSPTCNV       Yes, allow '*'                    @SC88096
         CLI   FSPFLG,FFSND  Send request?                     @SC88096
         BE    FSPTCNV       Yes, allow '*'                    @SC88096
         TR    0(52,8),FSPSTAB  Convert asterisk to pound sign @SC88096
FSPTCNV  DS    0H                                              @SC88096
./ R 05419000 05420000 $ 5420000 500                  04/13/88 16:11:13
         DC    20AL1(*-FSPMTAB),C'#' hyphen                    @SC88096
./ I 05422000          $ 5422200 200                  04/14/88 14:53:13
* Replace asterisks if not a send request                      @SC88096
FSPSTAB  DC    92AL1(*-FSPSTAB),C'#' asterisk                  @SC88096
         DC    163AL1(*-FSPSTAB)                               @SC88096
./ D 06007000 06008000                                04/05/88 15:41:07
./ I 06166500          $ 6166600 100                  04/05/88 15:41:07
         MVI   DYNDSP,X'88'  SHR,KEEP                          @SC86299
         MVI   DSKOPLS,X'80' Code for OPEN INPUT               @SC88049
./ I 06244000          $ 6244200 200                  04/05/88 15:41:07
         LA    1,NXFN+52     End of member slot                @SC88096
         TRT   NXFN+44(8),TRTBL Find end of member name        @SC88096
         LR    5,1           Save ptr                          @SC88096
./ I 06248000          $ 6248200 200                  04/05/88 15:41:07
         LA    0,NXFN                                          @SC88096
         LA    9,DSKNDIR     Where to go if no "*" in DSN      @SC88096
         LA    14,DSKNCIR    Where to go if "*" found          @SC88096
./ R 06250000 06251000 $ 6250000 1000                 04/05/88 15:41:07
DSKNSW   BZR   9             Len=max, just use the one file    @SC88096
./ R 06253000          $ 6253000 500                  04/05/88 15:41:07
         BNER  9             No, just the end of the name      @SC88096
         MVI   TRTBL+C'*',0                                    @SC88096
./ D 06259000                                         04/05/88 15:41:07
./ I 06261000          $ 6261090 90                   04/05/88 15:41:07
         BR    14            Now get name list                 @SC88096
DSKNCIR  CLI   NXFN+44,C' '  Insist no members if wild DSN     @SC88096
         BNE   RTRN1                                           @SC88096
         AR    1,0           End of prefix string              @SC88096
DSKNPLP  BCTR  1,0           Scan back for a dot               @SC88096
         CR    1,0           Must be one, else we scan universe@SC88096
         BNH   RTRN1         None there, give up               @SC88096
         CLI   0(1),C'.'                                       @SC88096
         BNE   DSKNPLP       Keep looking                      @SC88096
         SR    1,0           Count of bytes in whole qualifiers@SC88096
./ R 06269000 06271000 $ 6269000 700                  04/05/88 15:41:07
         LA    1,45-4        Skip count bytes, then back one   @SC88096
DSKNRET  L     2,CIRWA       ADR OF RETURNED CATALOG BUFFER    @SC88096
         SR    2,1           Back up one item                  @SC88096
./ I 06273000          $ 6273010 10                   04/05/88 15:41:07
*
DSKNDIR  LR    3,5           Use end of member name            @SC88096
         LA    0,NXFN+44     Start of member                   @SC88096
         LA    9,RTRN0       Where to go if not wild           @SC88096
         TRT   NXFN+44(8),TRTBL Find any '*'                   @SC88096
         MVI   TRTBL+C'*',0  Now restore table                 @SC88096
         BAL   14,DSKNSW     Return here if '*' found          @SC88096
         LA    15,NXFN       Ptr to DSN for lookup of PDS      @SC88096
         BAL   2,DSKLKP      Get DSCB                          @SC88096
         BNZ   RTRN1         Not found                         @SC88096
         TM    DS1DSO,2      Is it really a PDS?               @SC88096
         BZ    RTRN1         No, give up                       @SC88096
         SR    4,4           Clear FAB ptr                     @SC88096
         LA    1,DSKDPAT     Sample DCB info                   @SC88096
         LA    2,CAMVOLS     Reuse this area for the DSN       @SC88096
         MVC   0(44,2),NXFN  Copy DSN                          @SC88096
         MVI   44(2),C' '    And blank out member              @SC88096
         BAL   9,DSKALC      Get a DCB (FAB)                   @SC88096
         KCALL DYNALC,DYNPL,EXT Allocate file                  @SC88096
         OPEN  MF=(E,DSKOPLS)   And open it to the directory   @SC88096
         TM    FABOFLGS,X'10'   Ok?                            @SC88096
         BZ    DSKER1        Too bad                           @SC88096
         ST    4,DSKTKT      Save ptr to FAB                   @SC88096
         L     2,CIRWA       Start of name buffer              @SC88096
         LH    9,CIRWAL      Length                            @SC88096
         AR    9,2           End of buffer                     @SC88096
         S     9,FDBBSIZ     Back up one block                 @SC88096
DSKDL1   READF DSKTKT,BUFFER=(2),E=DSKDLZ Read a block         @SC88096
         SR    7,7                                             @SC88096
         ICM   7,3,0(2)      Get length of block info          @SC88096
         AR    7,2           End of block                      @SC88096
         BCTR  7,0           Set up BXLE                       @SC88096
         LA    8,2(2)        Point to member info              @SC88096
DSKDL2   CLC   0(8,8),=8X'FF' End of directory?                @SC88096
         BE    DSKDLZ        Yes, all done                     @SC88096
         TM    11(8),X'80'   Alias member?                     @SC88096
         BO    DSKDL3        Yes, ignore it                    @SC88096
         MVI   0(2),C'A'     Create table entry                @SC88096
         MVC   1(8,2),0(8)   with member name                  @SC88096
         LA    2,9(2)                                          @SC88096
DSKDL3   IC    6,11(8)       Get entry length                  @SC88096
         N     6,=F'31'                                        @SC88096
         LA    6,12(6,6)     In bytes                          @SC88096
         BXLE  8,6,DSKDL2    On to next member                 @SC88096
         CR    2,9           Room for another block in table?  @SC88096
         BNH   DSKDL1        Ok                                @SC88096
DSKDLZ   MVI   0(2),0        End of table                      @SC88096
         CLOSF DSKTKT        Release the file                  @SC88096
         C     2,CIRWA       Did we find anything?             @SC88096
         BE    RTRN1         No??                              @SC88096
         LA    1,9           Length of entries                 @SC88096
         B     DSKNRET       Go init. ptr into table           @SC88096
DSKDPAT  DC    A(0,256),C'F',X'0',H'256,0,0,256'               @SC88096
./ I 06310000          $ 6310500 500                  04/05/88 15:41:07
         MVC   FILNAM,NXFN                                     @SC87015
./ D 06314000                                         04/05/88 15:41:07
./ R 06319000          $ 6319000 100                  04/05/88 15:41:07
         LA    7,NXFN+44     Start of member                   @SC88096
         LA    8,8-1         Length of member name             @SC88096
         C     7,NXSFPTR     Is suffix part of member name?    @SC88096
         BL    *+12          Yes, we're set                    @SC88096
          LA   7,NXFN        No, use start of DSN              @SC88096
          LA   8,44-1        and length                        @SC88096
NXFDS    LA    6,2(8,6)      Next                              @SC88096
./ R 06325000          $ 6325000 500                  04/05/88 15:41:07
         LR    14,7          Compare saved prefix              @SC88096
./ R 06333000 06334000 $ 6333000 1000                 04/05/88 15:41:07
         LA    1,1(8,3)      Limit of name field               @SC88096
         EX    8,NXFTRT      Find end of name                  @SC88096
./ R 06339000          $ 6339000 500                  04/05/88 15:41:07
         BL    NXFDS         Shorter than prefix+suffix        @SC88096
./ R 06344000 06346000 $ 6344000 1000                 04/05/88 15:41:07
XL0002   SH    7,=Y(NXFN-FILNAM)  Transpose into FILNAM        @SC88096
         EX    8,NXFCOP      Copy DSN (or member)              @SC88096
./ I 06351000          $ 6351300 300                  04/05/88 15:41:07
NXFTRT   TRT   0(,3),TRTBL   Find end of name                  @SC88096
NXFCOP   MVC   0(,7),CATDNAME Copy name                        @SC88096
./ * SC88100 - Skip wildcard setup if in-core file; clear NAK0 earlier
./ R 00388000          $ 388000 500                   04/11/88 14:36:46
.* Call a routine, fill R1 with a parm if any, and allow error branch
./ I 07263000          $ 7263300 300                  04/11/88 14:36:46
         TM    FL4,SFM                                         @SC88100
         BO    SNDS8         Just sending from memory          @SC88100
./ R 07265000          $ 7265000 500                  04/11/88 14:36:46
SNDS8    BAL   8,SNDNXT      Set state table                   @SC86135
./ I 08527000          $ 8527500 500                  04/11/88 14:36:46
         NI    FL1,255-NAK0  Something sent now                @SC88100
./ R 08553000          $ 8553000 500                  04/11/88 14:36:46
SIOGOOD  DS    0H                                              @SC88100
./ * SC88101 - Ignore sequence numbers in TAKE files (TSO)
./ R 00848000 00849000 $ 848000 500                   04/15/88 21:50:29
&LABEL   READF &TICK,&NONUM,&BUFFER=,&BSIZE=,&E=,&CODE=9
.* Read from disk file (or write) (see WRITF, but also...)
.*  &2: NONUM means chop off numbers
./ I 00850000          $ 850100 100                   04/15/88 21:50:29
         LCLA  &C                                              @SC88101
&C       SETA  &CODE                                           @SC88101
         AIF   (T'&NONUM EQ 'O').RDC                           @SC88101
         AIF   ('&NONUM' NE 'NONUM').ER1                       @SC88101
&C       SETA  0             Code 0 means exclude sequence nos.@SC88101
.RDC     ANOP                                                  @SC88101
./ R 00866000          $ 866000 500                   04/15/88 21:50:29
.SZ      LA    0,&C                                            @SC88101
./ I 00867000          $ 867300 300                   04/15/88 21:50:29
         MEXIT
.ER1     MNOTE 2,'INVALID PARAMETER ''&NONUM'''                @SC88101
./ R 01411000          $ 1411000 500                  04/10/88 18:44:38
&KDATE   SETC  '10 Apr 88'                                     @SC88101
./ R 02299000          $ 2299000 500                  04/15/88 21:50:29
         READF 0(2),NONUM,E=LUPRER                             @SC88101
./ I 05969000          $ 5969300 300                  04/15/88 21:50:29
* 0=> same as 9 (q.v.), but if ok, return R1->buffer,R0=# and remove
*   the sequence number (if any) from the buffer (used for TAKE files)
./ I 05989000          $ 5989500 500                  04/15/88 21:50:29
         STC   0,DSKCOD      Save function code (for now)      @SC88101
         LTR   0,0                                             @SC88101
         BZ    DSKRED+4      0 => read NONUM                   @SC88101
./ I 06061000          $ 6061500 500                  04/15/88 21:50:29
         LR    0,7           Save length for number check      @SC88101
./ I 06064000          $ 6064050 50                   04/15/88 21:50:29
         CLI   DSKCOD,0      NONUM?                            @SC88101
         BNE   DSKREDC       No, use everything                @SC88101
         CLI   FDBRCF,C'F'   Fixed-length records?             @SC88101
         BNE   DSKREDV       No, line numbers at start (if any)@SC88101
         CH    0,=H'80'      See if F/80                       @SC88101
         BNE   DSKREDC       No                                @SC88101
         MVZ   CAMLOC(5),75(1)  See if 76-80 are all numeric   @SC88101
         CLC   CAMLOC(5),=8C'0'                                @SC88101
         BNE   DSKREDC       No                                @SC88101
         S     7,F8          Yes, move the end back            @SC88101
         B     DSKREDC                                         @SC88101
DSKREDV  LA    0,8(1)        Is length at least 8?             @SC88101
         CR    0,7                                             @SC88101
         BNL   DSKREDC       No, can't be numbered             @SC88101
         MVZ   CAMLOC(8),0(1)   See if 1-8 all numeric         @SC88101
         CLC   CAMLOC(8),=8C'0'                                @SC88101
         BNE   DSKREDC       No, not numbered                  @SC88101
         LA    1,8(1)        Yes, skip over number             @SC88101
DSKREDC  DS    0H                                              @SC88101
./ I 06071000          $ 6071200 200                  04/15/88 21:50:29
         CLI   DSKCOD,0      NONUM?                            @SC88101
         BNE   *+8                                             @SC88101
          ST   4,24(1)       Yes, return R1 ptr                @SC88101
./ I 06492000          $ 6492500 500                  04/15/88 21:50:29
DSKCOD   EQU   CAMOBT        Temp for function code            @SC88101
./ * SC88104 - Avoid problem with 0 < BLKSIZE < LRECL (TSO)
./ I 06473000          $ 6473200 200                  04/13/88 16:11:13
         LTR   5,5                                             @SC88104
         BP    *+8                                             @SC88104
         LA    5,1           BLKSIZE was less than LRECL!      @SC88104
./ * SC88106 - Avoid msg when deleting KER.BUF + strip leading car.ctl (TSO)
./ I 00988000          $ 988500 500                   04/18/88 16:01:05
FABRECCC EQU   X'06'         Control chars present             @SC88106
./ I 01018000          $ 1018500 500                  04/18/88 17:48:35
CCF      EQU   X'40'         Carriage control specified        @SC88106
./ I 01024000          $ 1024500 500                  04/15/88 21:26:56
FDBDEVT  DS    XL4           Device type (must precede VOL)    @SC88106
./ R 05480400          $ 5480400 4                    04/15/88 21:26:56
         USING FDBD,1        Yes, clear it                     @SC88106
         SR    3,3                                             @SC88106
         LA    4,FDBDEVT-2   Create volume list (n,type,vol)   @SC88106
         MVC   0(2,4),F1+2   Just one volume                   @SC88106
         STM   2,4,SFCDEL+4  Simulate CAMLST                   @SC88106
         MVI   SFCDEL,X'0C'  Code for UNCAT                    @SC88106
         CATALOG SFCDEL                                        @SC88106
         MVI   SFCDEL,X'41'  Codes for SCRATCH                 @SC88106
         MVI   SFCDEL+2,X'40'                                  @SC88106
         SCRATCH SFCDEL                                        @SC88106
         DROP  1                                               @SC88106
./ R 05480650          $ 5480650 10                   04/15/88 21:26:56
         LA    5,=X'42'      NEW,CATLG                         @SC88026
./ I 05486360          $ 5486370 10                   04/18/88 16:01:05
         L     3,STKTKT      Ptr to FAB                        @SC88106
         USING FABD,3                                          @SC88106
./ I 05486440          $ 5486450 10                   04/18/88 16:01:05
         TM    FDBFLGS,CCF   Carriage control?                 @SC88106
         BZ    *+8           No, that's fine                   @SC88106
         MVI   0(5),C' '     Yes, blank it out                 @SC88106
./ I 05487000          $ 5487500 500                  04/18/88 16:01:05
         DROP  3                                               @SC88106
./ I 05659000          $ 5659100 100                  04/15/88 21:26:56
SFCDEL   DS    0F            CAMLST overlays...                @SC88106
./ I 05659200          $ 5659300 100                  04/15/88 21:26:56
*               - Also used for CAMLST UNCAT/SCRATCH & DYNALLOC@SC88106
./ R 06359000          $ 6359000 500                  04/18/88 17:48:35
         NI    FDBFLGS,255-PDSF-CCF                            @SC88106
./ I 06399000          $ 6399500 500                  04/15/88 21:26:56
         MVC   FDBDEVT,CAMDEVT Copy device type                @SC88106
./ I 06400000          $ 6400200 200                  04/18/88 17:48:35
         TM    DS1RCF,FABRECCC Any carriage control?           @SC88106
         BZ    *+8           No, ok                            @SC88106
         OI    FDBFLGS,CCF   Yes, remember it outside FABRECFM @SC88106
./ I 06493000          $ 6493200 200                  04/15/88 21:26:56
CAMDEVT  EQU   CAMVOLS+2,4   1st device type                   @SC88106
./ * SC88113 - Clean up implied file name extension for TAKE (TSO)
./ R 01120000          $ 1120000 500                  04/22/88 15:11:30
SYSTAKE  DC    C'''SYS1'                                       @SC88113
DKERMINI DC    C'.KERMINI'''                                   @SC88113
./ R 05215600          $ 5215600 10                   04/22/88 15:11:30
         CLC   0(8,1),DKERMINI Is it .KERMINI?                 @SC88113
./ * SC88106X - Avoid multiple send caused by SC88106 (TSO)
./ R 01018500          $ 1018500 200                  05/02/88 11:48:14
* NXDON  EQU   X'40'         Catalog search done (see DSKFL)   @SC88106
./ I 01019000          $ 1019500 500                  05/02/88 11:48:14
CCF      EQU   X'04'         Carriage control specified        @SC88106
./ * ---------------- more ---------------------
./ * SC88105 - Avoid stray "0" in SERIES1 protocol mode; clear screen (TSO)
./ * SC88118 - Make host commands always interruptible (TSO)
./ * SC88119 - Capture DAIRFAIL msg; check PDS notation; setup new GUPI (TSO)
./ * SC88120 - Allow choice of FOLD/TRUNC/HALT, make LRECL system-specific
./ * SC88125 - Revise DSN properly from micro if WARN on (TSO)
./ * SC88139 - Screenful packet in VTAM, document ERRNUM changes
./ * SC88168 - New DEBUG options, restore ERRBPC (TSO)
./ * SC88202 - Update list of TSO macros used (TSO)
./ * SC88203 - Test for SERIES1 device if not TTY (TSO)
./ * SC88235 - Allow attribute packets with time as well as date (TSO)
./ * SC88246 - Preserve carriage control flags when appending (TSO)
./ *                  .....Updates.....
./ * SC88105 - Avoid stray "0" in SERIES1 protocol mode; clear screen (TSO)
./ I 05824000          $ 5824100 100                  04/18/88 21:09:59
         TPUT  CLRSPEC,CLRSPECL,FULLSCR  Clear the screen      @TS86001
./ I 05832200          $ 5832400 200                  04/14/88 15:22:04
SCRWM    DS    0H            Come back here for message        @SC88105
./ D 05848200 05848800                                04/14/88 15:22:04
./ * SC88118 - Make host commands always interruptible (TSO)
./ D 01063000                                         04/27/88 22:43:02
./ I 05530000          $ 5531000 1000                 03/28/88 18:56:12
         STAX  SFCATTN,DEFER=NO,REPLACE=NO,MF=(E,SFCSTBL),     @SC88118+
               USADDR=ATCHECB  In case subtask has no STAX     @SC88118
./ R 05536000 05536200 $ 5536000 200                  03/28/88 18:56:12
         BZ    *+12          Ok                                @SC88118
          BAL  14,SFCATCLN   Restore everything                @SC88118
./ R 05539500          $ 5539500 200                  03/28/88 18:56:12
         BAL   14,SFCATCLN   Restore everything                @SC88118
./ D 05543000                                         03/28/88 18:56:12
./ I 05563000          $ 5563040 40                   03/28/88 18:56:12
*
SFCATCLN STAX  ,             Restore after ATTACH (saves R14)  @SC88118
         MVC   ECTPCMD,SAVPCMD Restore ECT                     @SC88118
         BR    14                                              @SC88118
*
SFCATTN  STM   14,12,12(13)  Save regs                         @SC88118
         LR    3,15                                            @SC88118
         USING SFCATTN,3                                       @SC88118
         L     4,8(1)        Ptr to ECB                        @SC88118
         LA    2,4(4)        Ptr to TCB                        @SC88118
         TM    0(4),X'40'    Already finished?                 @SC88118
         BO    SFCATTNR      Yes, we just missed it            @SC88118
         STATUS STOP,TCB=(2) Suppress execution                @SC88118
         POST  (4)           No, so we just drop it            @SC88118
SFCATTNR LM    14,12,12(13)  Restore regs                      @SC88118
         BR    14                                              @SC88118
         DROP  3                                               @SC88118
./ I 05653000          $ 5653500 500                  04/14/88 15:06:32
SFCSTBL  STAX  MF=L          ATTN during subtask execution     @SC88118
./ R 05674000          $ 5674490 490                  04/27/88 22:43:02
         STAX  BR14,REPLACE=NO  Ingore attention interrupts    @SC88118
./ D 05754000 05759000                                04/27/88 22:43:02
./ R 05911000 05916000 $ 5911000 1000                 04/27/88 22:43:02
         LA    5,READATTN    ATTN routine adr (just post ECB)  @SC88118
         LA    6,CPECB       Ptr to ECB to post on ATTN        @SC88118
         STAX  (5),MF=(E,STAXPLR),USADDR=(6)                   @SC88118
./ I 05929000          $ 5929100 100                  04/27/88 22:43:02
*
READATTN STM   14,12,12(13)  Save registers                    @SC88118
         L     1,8(1)        Get ptr to term ECB               @SC88118
         POST  (1)           Post it                           @SC88118
         LM    14,12,12(13)  Restore registers                 @SC88118
         BR    14                                              @SC88118
./ * SC88119 - Capture DAIRFAIL msg; check PDS notation; setup new GUPI (TSO)
./ D 00805500                                         04/28/88 11:24:55
./ D 00807200                                         04/28/88 11:24:55
./ D 00807600                                         04/28/88 11:24:55
./ R 00809000          $ 809000 40                    04/28/88 11:24:55
.NOPR    ANOP
./ D 00809200 00809400                                04/28/88 11:24:55
./ D 00967500                                         04/28/88 11:24:55
./ D 00968500                                         04/28/88 11:24:55
./ D 00969300 00969600                                04/28/88 11:24:55
./ I 01032000          $ 1032050 50                   05/16/88 19:25:13
FABDSMB  EQU   FABDSN+44,8   Member name                       @SC88119
./ I 01071000          $ 1073000 2000                 04/28/88 11:24:55
DFMSGP   DS    A             Ptr to DAIR message buffer        @SC88119
./ I 01087000          $ 1087100 100                  04/28/88 11:24:55
CAMLOC   DS    4F            Ptrs for locating dataset         @SC86299
CAMOBT   DS    4F            Ptrs for getting DSCB             @SC86299
DSKCOD   EQU   CAMOBT        Temp for function code            @SC88101
CAMVOLS  DS    0D,XL265      Storage for volume list           @SC86299
CAMDEVT  EQU   CAMVOLS+2,4   1st device type                   @SC88106
         ORG   CAMVOLS+100   Do a little overlaying            @SC88049
CAMDSCB  DS    0F,XL101      Storage for DSCB                  @SC88014
         ORG   CAMDSCB+1                                       @SC88014
DS1VOL   DS    CL6,XL2       Volume serial                     @SC86299
DS1CRDT  DS    2XL3,3X,XL13  Creation date                     @SC86299
DS1RFDT  DS    XL3,XL4       Reference date                    @SC86299
DS1DSO   DS    XL2           Dataset org                       @SC86299
DS1RCF   DS    X             Record format                     @SC86299
DS1OPT   DS    X             Error option                      @SC86299
DS1BLK   DS    H             Block size                        @SC86299
DS1LRC   DS    H             Logical record length             @SC86299
         ORG   ,                                               @SC86299
./ I 01110000          $ 1110100 100                  04/28/88 16:58:17
         MVI   CPECB,0       Clear ECB                         @SC88119
./ I 01146000          $ 1146300 300                  04/28/88 11:24:55
         ST    1,DFMSGP      DAIR message buffer               @SC88119
         LA    1,512(1)                                        @SC88119
./ I 01548000          $ 1548200 200                  05/02/88 16:50:14
         TM    FL1,DEBUG                                       @SC88119
         BZ    KRMXITG                                         @SC88119
         CLOSF LOGPTR        Close                             @SC88119
KRMXITG  DS    0H                                              @SC88119
./ D 01551000 01553000                                05/02/88 16:50:14
./ R 05262000          $ 5262000 500                  05/16/88 19:25:13
         XC    FSPDSMB,FSPDSMB Signal DSORG=PO for allocation  @SC88119
./ I 05480800          $ 5480820 20                   04/28/88 11:24:55
         MVI   STKDYN+24,X'80'  No buffer ptr                  @SC88119
./ I 05592000          $ 5592500 500                  04/28/88 16:58:17
         MVI   CPECB,0       Clear ECB                         @SC88119
./ I 05784000          $ 5784500 500                  04/28/88 16:58:17
         MVI   CPECB,0       Clear ECB                         @SC88119
./ R 05994000          $ 5994000 300                  04/28/88 11:24:55
         L     8,DFMSGP      Ptr to message buffer             @SC88119
         XC    0(4,8),0(8)   Clear out old message             @SC88119
         STM   5,8,DYNPL+16  Set up calling sequence           @SC86345
./ I 06000000          $ 6000500 500                  04/28/88 11:24:55
         BAL   14,DSKTCON    Check PDS notation                @SC88119
./ I 06017000          $ 6017500 500                  04/28/88 11:24:55
         BAL   14,DSKTCON    Check PDS notation                @SC88119
./ I 06027000          $ 6027030 30                   04/28/88 11:24:55
         CLI   DYNRC+3,0                                       @SC88119
         BNE   DSKERAL       Error on allocation               @SC88119
./ R 06039000          $ 6039000 10                   05/16/88 19:25:13
         CLI   FABDSMB,C' '  Did we want a member?             @SC88119
./ R 06039200          $ 6039200 10                   05/16/88 19:25:13
         XC    FABDSMB,FABDSMB Signal DSORG=PO                 @SC88119
./ I 06152000          $ 6152090 90                   04/28/88 11:24:55
* Check PDS notation -- must match DSORG.  Return via R14
DSKTCON  TM    DS1DSO,2      Partitioned?                      @SC88119
         BO    DSKTCOP       Yes, insist on member name        @SC88119
         CLI   FABDSMB,C' '  Member name?                      @SC88119
         BER   14            No, ok                            @SC88119
         B     DSKER1                                          @SC88119
DSKTCOP  CLI   FABDSMB,C' '  Member name?                      @SC88119
         BNER  14            Yes, ok                           @SC88119
         CLI   FABDSMB+1,0   No, but maybe just want directory?@SC88119
         BER   14            Yes, ok                           @SC88119
./ I 06158000          $ 6158040 40                   04/28/88 11:24:55
*
DSKERAL  L     1,DFMSGP      Ptr to DAIRFAIL buffer            @SC88119
         SR    9,9                                             @SC88119
         ICM   9,3,0(1)      Length of message                 @SC88119
         BZ    DSKER1        None (why not?)                   @SC88119
         LA    8,4(1)        Start of text                     @SC88119
         CLC   =C'IKJ',0(8)  Has msg id?                       @SC88119
         BNE   *+8                                             @SC88119
          LA   8,10(8)       Yes, skip it                      @SC88119
         S     8,F2                                            @SC88119
         MVC   0(2,8),=C'  ' Make it begin with two blanks     @SC88119
         AR    9,1           End of message                    @SC88119
         SR    9,8           Length to use                     @SC88119
         L     6,EMSGP       Explanation buffer                @SC88119
         LA    7,LEMSG       Length of same                    @SC88119
         CR    7,9                                             @SC88119
         BNH   *+6                                             @SC88119
          LR   7,9           Too long, use what we can         @SC88119
         ST    7,EMSGL       Usable length                     @SC88119
         MVCL  6,8           Copy to buffer                    @SC88119
         B     DSKER1                                          @SC88119
./ R 06181000          $ 6181000 500                  05/16/88 19:25:13
         CLI   FABDSMB,0     Special case of PDS?              @SC88119
./ R 06184000          $ 6184000 200                  05/16/88 19:25:13
         MVI   FABDSMB,C' '  and blot out member               @SC88119
./ D 06491000 06504000                                04/28/88 11:24:55
./ I 06505000          $ 6506000 1000                 04/28/88 11:24:55
         DS    A(0)          Ptr to message buffer             @SC88119
./ * SC88120 - Allow choice of FOLD/TRUNC/HALT, make LRECL system-specific
./ R 00916000          $ 916000 500                   05/03/88 21:59:35
SETRECVF MVC   FILRCF,0(6)   Copy RECFM                        @SC88120
./ R 00944000          $ 944000 500                   05/03/88 21:59:35
SHORFM   LA    8,FILRCF                                        @SC88120
./ I 01032100          $ 1032300 200                  04/29/88 16:58:04
FABLRTR  DS    F             Record length for truncation      @SC88120
./ R 01040500          $ 1040500 500                  05/03/88 21:31:08
.*  &2: RECFM (1-char), &3: LRECL (skip rest of FDB if omitted)@SC88120
./ R 02468000 02470000 $ 2468000 1000                 05/03/88 21:59:35
         FDBPAT ,V,LPKT      Default disk RECFM, etc.          @SC88120
./ R 02474000 02476000 $ 2474000 1000                 05/03/88 21:59:35
         FDBPAT ,V,80        Default disk RECFM, etc.          @SC88120
./ R 02480000          $ 2480000 500                  05/03/88 21:59:35
         FDBPAT ,V           Default disk RECFM (no LRECL)     @SC88120
./ I 02490000          $ 2490500 500                  04/29/88 16:58:04
ITRNCFL  DC    C'T'          Truncate by default (vs. F or H)  @SC88120
./ I 02648000          $ 2648200 200                  04/29/88 16:58:04
RECFLD   DS    F             Count of record foldings          @SC88120
./ R 02688000 02691000 $ 2689000 1000                 05/03/88 21:59:35
         FDBPAT LOG,V,LPKT   Default disk RECFM, etc.          @SC88120
./ R 02695000 02698000 $ 2696000 1000                 05/03/88 21:59:35
         FDBPAT FIL,V,80     Default disk RECFM, etc.          @SC88120
./ R 02703000 02704000 $ 2703000 1000                 05/03/88 21:59:35
         FDBPAT TAK,V        Default disk RECFM (no LRECL)     @SC88120
./ I 02713000          $ 2713500 500                  04/29/88 16:58:04
TRNCFL   DC    C'T'          Truncate or Fold or Halt          @SC88120
./ I 03301000          $ 3301500 500                  04/29/88 16:58:04
         KW    'LONGLINE',SHOLNG,MIN=2     **COMPAT**          @SC88120
./ R 03312000 03315000 $ 3313000 1000                 05/03/88 21:59:35
SETFLR   MVC   TYPFIL,0(6)   Save type                         @SC88120
./ I 03319000          $ 3319100 100                  04/29/88 16:58:04
*
SETLNGKW KW    'FOLD',SETLNG                                   @SC88120
         KW    'HALT',SETLNG                                   @SC88120
         KW    'TRUNCATE',SETLNG                               @SC88120
         KW    ,                                               @SC88120
SETLNG   MVC   TRNCFL,0(6)   Save flag                         @SC88120
         B     RTRN0                                           @SC88120
./ I 03644000          $ 3644500 500                  04/29/88 16:58:04
         KW    'LONGLINE',SHOLNG,MIN=2                         @SC88120
./ I 03701000          $ 3701200 200                  04/29/88 16:58:04
SHOLNG   LA    4,SETLNGKW    List of possibles                 @SC88120
         LA    6,TRNCFL                                        @SC88120
         BAL   14,SHOBRV     Get full name from abbrev.        @SC88120
          NOP  0                                               @SC88120
./ R 03704000          $ 3704000 500                  05/03/88 21:59:35
         ICM   4,3,FILLRC                                      @SC88120
./ R 03965000 03966000 $ 3965000 1000                 04/29/88 16:58:04
         MVC   CMD(21),=C'Optimum packet size: '               @SC88120
         LA    15,CMD+21                                       @SC88120
./ I 03976000          $ 3976100 100                  04/29/88 16:58:04
         ICM   4,15,RECFLD   Any folded records?               @SC88120
         BZ    STATFDZ       No, ok                            @SC88120
         LA    15,CMD        Yes, issue message                @SC88120
         BAL   2,EDDEC                                         @SC88120
         MVC   0(15,15),=C' records folded'                    @SC88120
         LA    15,15(15)                                       @SC88120
         BAL   2,STAPM15                                       @SC88120
STATFDZ  DS    0H                                              @SC88120
./ R 04208000 04209000 $ 4208000 1000                 04/29/88 16:58:04
         L     0,FABLRTR     Get effective record length       @SC88120
         ST    0,MAXOUT      Save for folding (if need be)     @SC88120
./ R 04214000          $ 4214000 1000                 04/29/88 16:58:04
         ICM   1,15,WBUFL    Check length in buffer            @SC88120
./ R 05971000          $ 5971000 500                  05/06/88 17:14:16
* 2=> open (out): (same)
./ I 06024000          $ 6024200 200                  04/29/88 16:58:04
         LH    0,FDBLRC                                        @SC88120
         BAL   2,DSKTV                                         @SC88120
          S    0,F4          Deduct 4 for RDW if RECFM=V       @SC88120
         ST    0,FABLRTR     Set effective record length       @SC88120
./ D 06083000 06085500                                04/29/88 16:58:04
./ R 06167000          $ 6167000 500                  05/06/88 17:14:16
         LA    4,FDBD        FDB pointer                       @SC88120
./ R 06169000          $ 6169000 500                  05/06/88 17:14:16
         STM   3,4,20(1)     Return R0,R1                      @SC88120
         LR    4,3           Indicate we have it               @SC88120
./ R 06200000          $ 6200000 500                  05/03/88 21:31:08
DSKFABS  LH    1,FDBBLKSI    Copy Info to DCB                  @SC88120
         STH   1,FABBLKSI                                      @SC88120
./ D 06202000                                         05/03/88 21:31:08
./ I 06205000          $ 6205500 500                  05/03/88 21:31:08
         MVC   FABLRECL,FDBLRC Use true LRECL after all        @SC88120
./ D 06210000 06211000                                05/03/88 21:31:08
./ D 06410000                                         05/03/88 21:31:08
./ R 07568000 07570000 $ 7568000 1000                 04/29/88 16:58:04
         L     2,FABLRTR     Get effective record length       @SC88120
         ST    2,FSIZE       Copy LRECL                        @SC86295
./ I 07572000          $ 7572100 100                  04/29/88 16:58:04
         TM    FL1,BINF                                        @SC88120
         BO    RECMAXO       Binary, just fold at LRECL        @SC88120
         CLI   TRNCFL,C'H'   Test: F, H, or T                  @SC88120
         BL    RECMAXO       F => fold at LRECL                @SC88120
         LA    2,1(2)        Assume H => abort at LRECL+1      @SC88120
         BE    RECMAXO                                         @SC88120
         ICM   2,8,LOBIT+3   T => fold at "infinity", but trunc@SC88120
RECMAXO  ST    2,MAXOUT                                        @SC88120
./ R 07641000          $ 7641000 1000                 04/29/88 16:58:04
RECWR    ICM   1,15,WBUFL    Check length in buffer            @SC88120
./ R 08070000          $ 8070000 80                   04/29/88 16:58:04
         BL    DECMORE       No, keep appending                @SC88120
         KCALL OUTBUF,(9),E=RTRN1 Yes, write buffer            @SC88120
         SR    9,9           Reset count and output pointer    @SC88120
         L     1,WBUF                                          @SC88120
         TM    FL1,BINF                                        @SC88120
         BO    DECPUT        Binary always folds, no problem   @SC88120
         CLI   CUR,CR        Exactly full just in time?        @SC88120
         BE    DECIGN        Yes, don't create empty line      @SC88120
         LA    0,1           Other, this is called folding     @SC88120
         A     0,RECFLD                                        @SC88120
         ST    0,RECFLD                                        @SC88120
         B     DECPUT        Ok, now copy the new character    @SC88120
./ R 08079000 08080000 $ 8080000 1000                 04/29/88 16:58:04
DECWRT   KCALL OUTBUF,(9),E=RTRN1 Write buffer                 @SC88120
./ D 08083000 08084000                                04/29/88 16:58:04
./ I 08783000          $ 8783300 300                  04/29/88 16:58:04
* Entry: R1=length of buffer (which starts where WBUF points)
* Exit: R15=0 if ok, other if error (ERRNUM set)
./ R 08785000 08787000 $ 8785000 1000                 04/29/88 16:58:04
         LR    9,1           Save buffer length                @SC88120
         L     6,FSIZE       Use to hold lrecl                 @SC88120
./ R 08818000 08823000 $ 8820000 1000                 04/29/88 16:58:04
OBFLEN   CR    9,6           Compare data len. to trunc len.   @SC88120
./ I 08825000          $ 8825300 300                  04/29/88 16:58:04
         CLI   FRECF,C'F'                                      @SC88120
         BNE   OBFWRT        Go if variable format             @SC88120
./ I 08837000          $ 8837200 200                  04/29/88 16:58:04
         CLI   TRNCFL,C'H'   Do we halt here?                  @SC88120
         BNE   OBFLRECL      Truncation allowed, ok            @SC88120
         MVI   ERRNUM,ERRRTR Mark error and stop               @SC88120
         B     RTRN1                                           @SC88120
./ * SC88125 - Revise DSN properly from micro if WARN on (TSO)
./ R 05253000          $ 5253000 500                  05/03/88 20:42:41
         LA    5,10          Allowed retries (0-9)             @SC88125
./ R 05268000 05270000 $ 5268000 1000                 05/03/88 20:42:41
         BAL   3,FSPRMPT     Set up rechecking via R3          @SC88125
./ R 05289200 05289400 $ 5289200 200                  05/03/88 20:42:41
         CLI   FSPDSN+43,C' ' Exactly 44 bytes already?        @SC88125
         BE    *+10          No, there's some room             @SC88125
./ R 05300000 05301000 $ 5300000 1000                 05/03/88 20:42:41
FSPSTA   STC   7,0(6)        Modify DSN                        @SC88125
         BALR  9,3           See if still a conflict           @SC88125
./ * SC88139 - Screenful packet in VTAM, document ERRNUM changes
./ R 01411000          $ 1411000 500                  05/18/88 17:33:16
&KDATE   SETC  '88/5/18'                                       @SC88139
./ I 01455000          $ 1456000 1000                 05/18/88 17:33:16
RTA      EQU   X'3C'         Repeat To Address (3270)          @SC88139
./ R 04091000          $ 4091000 500                  05/18/88 17:33:16
* Exit: R15=0 if ok, R15=1 if error or help needed.  ERRNUM set
*       appropriately as long as command syntax is ok, else unchanged.
./ R 05456000          $ 5456000 500                  05/18/88 17:35:47
*       ERRNUM set appropriately (R1=1,3,4) or unchanged (2,5-11)
./ I 05968000          $ 5968500 500                  05/18/88 17:35:47
* ERRNUM unchanged unless there is a disk error
./ I 06089000          $ 6089500 500                  05/18/88 17:35:47
         IC    7,ERRNUM      Save previous error code, if any  @SC88139
./ I 06095000          $ 6095500 500                  05/18/88 17:35:47
         STC   7,ERRNUM      Restore previous error code       @SC88139
./ I 07001000          $ 7001500 500                  05/18/88 17:33:16
* Exit: ERRNUM set appropriately.
./ I 08014000          $ 8014500 500                  05/18/88 17:33:16
* Exit: ERRNUM left unchanged unless there is an error.
./ R 08574000          $ 8574000 500                  05/18/88 17:33:16
         DC    AL1(RTA),X'4040',C' '  Blanks to end of screen  @SC88139
./ * SC88168 - New DEBUG options, restore ERRBPC (TSO)
./ R 00312000          $ 312000 500                   07/12/88 00:41:47
&LABEL   DC    AL1(254),AL3(&ADDR)                             @SC88168
./ R 00316000          $ 316000 500                   07/12/88 00:41:47
&LABEL   DC    AL1(&LEN.),AL3(&ADDR.),AL1(&MIN.-1),C&KW        @SC88168
./ I 00868000          $ 868100 100                   07/30/88 00:07:36
*COPY                                                 SAVEF
         MACRO
&LABEL   SAVEF &TICK,&E=                                       @SC88168
.* Update disk directory for given file (ticket ptr in R1)
.*  &1: adr of file access ticket (A), &E= branch on error
&LABEL   L     1,&TICK                                         @SC88168
         READF &TICK,E=&E,CODE=21                              @SC88168
         MEND
./ R 01867000          $ 1867000 500                  07/07/88 22:59:05
INPUTQAB MVI   ERRNUM,ERRBPC Bad packet                        @SC88168
         CLI   STYPE,AB                                        @SC88168
./ R 02033000 02038000 $ 2033000 1000                 07/12/88 00:41:47
SCANLUP  CLI   0(1),254                                        @SC88168
         BH    4(14)         Return to caller if end           @SC88168
         BL    *+12          Not a branch to new list          @SC88168
          ICM  1,7,1(1)      Yes, get ptr to new list          @SC88168
          B    SCANLUP       And resume search                 @SC87117
./ R 02041000          $ 2041000 500                  07/12/88 00:41:47
         CLM   7,1,0(1)      Compare token and kw lengths      @SC88168
./ R 02045000          $ 2045000 500                  07/12/88 00:41:47
SCANNO   IC    15,0(1)       KW length - 1                     @SC88168
./ R 02052000          $ 2052000 500                  07/12/88 00:41:47
         ICM   14,7,1(1)     No, get handler address           @SC88168
./ R 02147000 02153000 $ 2147000 1000                 07/12/88 00:41:47
HELPNT   CLI   0(4),254                                        @SC88168
         BH    HELPEND       Return if end of tokens           @SC88168
         BL    *+12          Not branch to other list          @SC88168
          ICM  4,7,1(4)      Yes, get ptr to new list          @SC88168
          B    HELPNT        And resume scan                   @SC87117
         IC    7,0(4)        Length-1 of current token         @SC88168
./ I 02621000          $ 2621100 100                  07/12/88 22:08:23
DBGFLG   DS    X             Type of debug log                 @SC88168
DBGON    EQU   X'80'         Logging on                        @SC88168
DBGIO    EQU   X'40'         Logging of I/O info (SERIES1)     @SC88168
DBGRW    EQU   X'20'         Logging raw packets, not EBCDIC   @SC88168
DBGSV    EQU   X'10'         Log file closed after each entry  @SC88168
./ D 02640000                                         07/12/88 22:08:23
./ D 03219000 03220000                                07/12/88 00:41:47
./ R 03323000 03326000 $ 3323000 500                  07/12/88 22:08:23
SETDEB   BAL   4,SETSCN      Select among possibilities        @SC88168
         KW    'ON',SETDON                                     @SC88168
         KW    'OFF',SETDEND,MIN=2                             @SC88168
SETRAW   KW    'RAW',SETDRAW                                   @SC88168
         KW    'I/O',SETDIO                                    @SC88168
         KW    'SAVE',SETDSV                                   @SC88168
         KW    ,                                               @SC88168
./ D 03328000                                         07/12/88 22:08:23
./ R 03332000 03335000 $ 3332000 200                  07/12/88 22:08:23
SETDRAW  OI    SHODBG,DBGON+DBGRW   RAW -> ON                  @SC88168
         B     SETDB1                                          @SC88168
SETDIO   OI    SHODBG,DBGON+DBGIO   I/O -> ON                  @SC88168
         B     SETDB1                                          @SC88168
SETDSV   OI    SHODBG,DBGON+DBGSV   SAVE-> ON                  @SC88168
         B     SETDB1                                          @SC88168
SETDON   OI    SHODBG,DBGON                                    @SC88168
SETDB1   ICM   2,15,LEN      Any more options?                 @SC88168
         BP    SETDEB        Yes, interpret them               @SC88168
SETDEND  XC    SHODBG,DBGFLG Get changed flags in SHODBG       @SC88168
         XC    DBGFLG,SHODBG Install new flags                 @SC88168
         TM    SHODBG,DBGON  ON/OFF changed?                   @SC88168
         BZ    RTRN0         No, done                          @SC88168
         TM    DBGFLG,DBGON  Turned ON?                        @SC88168
         BZ    SETDEBOF      No, turn it off                   @SC88168
./ I 03344000          $ 3344500 500                  07/12/88 00:41:47
         MVI   ERRNUM,ERRNOE Insist no errors                  @SC88168
./ R 03564000 03569000 $ 3564000 1000                 07/12/88 22:08:23
         BAL   14,SHOOO      1st get ON vs. OFF                @SC88168
          OI   FL1,DEBUG                                       @SC88168
SHODEBZ  MVC   SHODBG,DBGFLG Copy flags for decoding           @SC88168
         LA    6,SETRAW      List of options                   @SC88168
         BAL   4,SHOMULT     See if any extra flags on         @SC88168
          NOP  0                                               @SC88168
./ R 03692000          $ 3692000 1000                 07/12/88 22:08:23
         ICM   14,7,1(1)     Ptr to 1st routine                @SC88168
./ I 03782000          $ 3782050 50                   07/12/88 22:08:23
SHOMULT  LR    5,1           Save ptr to current option        @SC88168
         LR    1,6           Use ptr to list of suboptions     @SC88168
SHOMULQ  ICM   14,7,1(1)     Get ptr to handler (assume OI x,y)@SC88168
         BAL   2,SHOKW       Get ptrs to KW string, fix SETXI  @SC88168
         EX    0,SETXI       TM x,y                            @SC88168
         BNO   SHOMULP       Not this one                      @SC88168
         MVI   0(15),C','    Yes, punctuate display            @SC88168
         LA    15,1(15)                                        @SC88168
         LR    8,6                                             @SC88168
         LR    9,7                                             @SC88168
         BAL   2,EDCHAR      Copy this KW to display           @SC88168
SHOMULP  LA    1,0(7,6)      On to next in list                @SC88168
         CLI   0(1),254      End of list?                      @SC88168
         BL    SHOMULQ       No, keep checking                 @SC88168
         LR    14,4          Proper place for return adr       @SC88168
         LR    1,5           Restore ptr to current option     @SC88168
         B     SHOZZZ        End of item                       @SC88168
*
./ R 03809000          $ 3809000 500                  07/12/88 00:41:47
         IC    7,0(1)        Length (assumes high bytes clear) @SC88168
./ R 03824000          $ 3824000 500                  07/12/88 00:41:47
         PTEXT SETOOKW+5,3,AREG=8,LREG=9                       @SC88168
./ R 03862000          $ 3862000 500                  07/12/88 00:41:47
         IC    9,0(4)        Length of name                    @SC88168
./ R 03865000 03866000 $ 3865000 1000                 07/12/88 00:41:47
          LA   8,6(9,8)      Flag is on, advance               @SC86133
          IC   9,6(9,4)                                        @SC88168
./ R 03873000 03874000 $ 3873000 1000                 07/12/88 00:41:47
SHOZZ    LA    1,0(7,6)      Advance to next option            @SC88168
SHOZZZ   ST    15,SHOPTR     Save end of display buffer        @SC88168
./ I 03877000          $ 3877300 300                  07/12/88 22:08:23
         CLM   14,7,=AL3(SHODEBZ)                              @SC88168
         BER   14            Special treatment for DEBUG, too  @SC88168
./ I 03915000          $ 3915500 500                  07/12/88 22:08:23
SHODBG   DS    X             Temp for DEBUG flags              @SC88168
./ I 05840000          $ 5840300 300                  07/30/88 00:07:36
         TM    DBGFLG,DBGIO  I/O log wanted?                   @SC88168
         BZ    RTRN          No, skip it                       @SC88168
./ I 05846000          $ 5846200 200                  07/30/88 00:07:36
         TM    DBGFLG,DBGSV  Save log?                         @SC88168
         BZ    SCRIOLZ       No, skip it                       @SC88168
         SAVEF LOGPTR        Yes, close it                     @SC88168
SCRIOLZ  DS    0H                                              @SC88168
./ I 05986000          $ 5986500 500                  07/30/88 00:07:36
* 21=> save file status in directory: R1->FAB.                 @SC88168
./ I 06052000          $ 6052100 100                  07/30/88 00:07:36
*
* TClose file whose ticket is in (R1)                          @SC88168
DSKTCLOS ST    1,DSKTKT                                        @SC88168
         MVI   DSKTKT,X'80'  Flag for normal close             @SC88168
         CLOSE MF=(E,DSKTKT),TYPE=T                            @SC88168
         B     RTRN0                                           @SC88168
./ I 06115000          $ 6115030 30                   07/30/88 00:07:36
         CH    0,=Y(21-12)                                     @SC88168
         BNL   DSKTCLOS      21 => TCLOSE it                   @SC88168
./ R 08461000          $ 8461000 100                  07/12/88 22:08:23
RIOLG1   SR    8,8           Assume raw not wanted             @SC88168
         TM    DBGFLG,DBGRW                                    @SC88168
         BO    *+8                                             @SC88168
         LA    8,ATOE        Raw wanted                        @SC88168
         CR    3,8           Correct type (raw/EBCDIC)?        @SC88168
./ I 08478000          $ 8478300 300                  07/12/88 22:08:23
         TM    DBGFLG,DBGSV  SAVE requested?                   @SC88168
         BZR   9             No, skip closing log file         @SC88168
         SAVEF LOGPTR        Update disk directory             @SC88168
./ I 08526500          $ 8526700 200                  07/07/88 22:59:05
         LR    6,8           Set up for log routine            @SC88168
./ * SC88202 - Update list of TSO macros used (TSO)
./ R 01174000          $ 1174000 500                  07/20/88 22:34:44
 MNOTE '---MACROs: ATTACH, CATALOG, CLOSE, DETACH, DEVTYPE,'
 MNOTE '---        ESTAI, FIND, FREEMAIN,'
./ R 01175150 01175200 $ 1175150 50                   07/20/88 22:34:44
 MNOTE '---        PUTLINE, SAVE, SCRATCH, STATUS, STAX,'
 MNOTE '---        STFSMODE, STIMER, STSIZE, SYNADAF,'
 MNOTE '---        SYNADRLS, TGET, TPG, TPUT, TTIMER, WAIT'
./ * SC88203 - Test for SERIES1 device if not TTY (TSO)
./ I 05890000          $ 5890500 500                  07/21/88 00:04:05
         MVI   TRMTP,C'T'    1st assume TTY                    @SC88203
./ I 05902000          $ 5902050 50                   07/21/88 00:04:05
         L     8,S1RDPL                                        @SC88203
         XC    0(9,8),0(8)   Zero out buffer                   @SC88203
         LA    0,1                                             @SC88203
         KCALL SCRNIO        Clear screen and set up           @SC88203
         LA    0,6                                             @SC88203
         KCALL SCRNIO,STMS1ST Issue status request             @SC88203
         LA    0,5                                             @SC88203
         KCALL SCRNIO,S1RDPL Read back status                  @SC88203
         LA    0,2                                             @SC88203
         KCALL SCRNIO        Release screen                    @SC88203
         CLI   0(8),X'E4'    Check for Yale status response    @SC88203
         BNE   STMGRP        No, must be something else        @SC88203
         CLI   3(8),X'11'                                      @SC88203
         BNE   STMGRP        No, must be something else        @SC88203
         CLC   =X'2B5B5B',6(8)                                 @SC88203
         BE    STMOK         Yes, all set                      @SC88203
STMGRP   MVI   TRMTP,C'G'    Assume graphics device            @SC88203
./ I 05965000          $ 5965200 200                  07/21/88 00:04:05
*
STMS1ST  DC    A(STMS1ORD,L'STMS1ORD)                          @SC88203
STMS1ORD DC    X'F1C32B5BBC' WCC + Yale ASCII status request   @SC88203
./ * SC88235 - Allow attribute packets with time as well as date (TSO)
./ R 01029000          $ 1029000 1000                 08/22/88 20:00:49
FDBDATE  DS    XL7,X         Time stamp: packed yyyymmddhhmmss @SC88235
./ D 02580000                                         08/22/88 19:47:53
./ I 02581000          $ 2581500 500                  08/22/88 19:47:53
FDATE    DS    XL7           Date/time of current file         @SC88235
./ I 07392000          $ 7392090 90                   08/22/88 19:47:53
         CLC   FDATE+4(3),F0 Time defined too?                 @SC88235
         BE    SNDAT4        No, just use date                 @SC88235
         MVI   1(5),C'1'     Yes, add string length - hh:mm:ss @SC88235
         MVC   10(9,5),TIMPLT and edit time                    @SC88235
         ED    10(9,5),FDATE+4                                 @SC88235
         CLI   11(5),C' '                                      @SC88235
         BNE   *+8                                             @SC88235
         MVI   11(5),C'0'    Insist on leading zeroes          @SC88235
         LA    5,9(5)                                          @SC88235
SNDAT4   DS    0H                                              @SC88235
./ I 07500000          $ 7500300 300                  08/22/88 19:47:53
*
TIMPLT   DC    C' ',X'2120',C':',2X'20',C':',2X'20'  Time edit @SC88235
./ * SC88246 - Preserve carriage control flags when appending (TSO)
./ R 01019500 01020000 $ 1019500 500                  09/02/88 23:47:27
WFN      EQU   X'08'         Filename contains wild chars      @SC88246
*ABRECCC EQU   X'06'         Control chars present             @SC88246
./ R 05486450          $ 5486450 5                    09/02/88 23:47:27
         TM    FDBFLGS,FABRECCC Carriage control?              @SC88246
./ R 06205000          $ 6205000 200                  09/02/88 23:47:27
         BE    DSKFABCC                                        @SC88246
./ R 06208000          $ 6208000 500                  09/02/88 23:47:27
         BE    DSKFABCC                                        @SC88246
./ I 06209000          $ 6209400 400                  09/02/88 23:47:27
DSKFABCC XC    FABRECFM,FDBFLGS Copy carriage control flags    @SC88246
         NI    FABRECFM,255-FABRECCC  And only those flags     @SC88246
         XC    FABRECFM,FDBFLGS                                @SC88246
./ R 06359000          $ 6359000 500                  09/02/88 23:47:27
         NI    FDBFLGS,255-PDSF                                @SC87015
./ R 06400200 06400600 $ 6400200 200                  09/02/88 23:47:27
         XC    FDBFLGS,DS1RCF Copy carriage control flags      @SC88246
         NI    FDBFLGS,255-FABRECCC  And only those flags      @SC88246
         XC    FDBFLGS,DS1RCF                                  @SC88246
