//OPSX07  PROC MASTIN=,                LIBSPOOL ONLINE LIBRARIAN MASTER
//   OUTW=,            NEW WEEKLY TAPE MASTER FILE (DO NOT INCLUDE GDG)
//   IND=,           CURRENT DAILY TAPE MASTER FILE (INCLUDE GDG LEVEL)
//   OUTD=,              EMPTY OUTPUT DAILY MASTER (DO NOT INCLUDE GDG)
//   ARCHDSN=,                         ARCHIVE DIRECTORY DSN
//   RSARDSN=,                       RESTORE FROM ARCHIVE LIBRARIAN DSN
//   RUNTYPE='W',                      D - DAILY, W - WEEKLY
//   GEN='+1',                         NEW GENERATION # FOR IN1
//   RET='EXPDT=99000',                RETENTION FOR NEW TAPE MASTER
//   PARMSEL='HOURS=120,MODULES=000',  MODULE SELECTION CRITERIA
//   PARMLIB='NRJS,NJTA'               LIBRARIAN PARM INFO
//*
//**********************************************************************
//* CREATE DLM AND COPY CONTROL CARDS FOR MODULES GREATER THAN X HOURS
//**********************************************************************
//SELECT   EXEC  PGM=OPS4320G,PARM='&PARMSEL'
//STEPLIB  DD  DSN=SYSXKMB.LIB.LOAD,DISP=SHR
//SYSOUT   DD  SYSOUT=*
//MCDCODE  DD  DUMMY
//*MCDCODE  DD  DSN=SYSXKMB.LIB.ASM(OPSX0701),DISP=SHR
//DLMCARD  DD  DSN=&&DLMCARD,DISP=(,PASS),UNIT=VIO,
//             DCB=BLKSIZE=4080,SPACE=(TRK,(5,5),RLSE)
//COPYCARD DD  DSN=&&COPYCARD,DISP=(,PASS),UNIT=VIO,
//             DCB=BLKSIZE=4080,SPACE=(TRK,(5,5),RLSE)
//MASTER   DD  DSN=&MASTIN,DISP=OLD
//**********************************************************************
//*   COPY SELECTED MODULES FROM ONLINE LIBRARIAN JCL DATA SET
//**********************************************************************
//COPYSTEP EXEC  PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT DD  DUMMY
//INDEX    DD  SYSOUT=A
//LIST     DD  SYSOUT=A
//OSJOB    DD  DSN=&&TEMP,DISP=(,PASS),UNIT=(SYSDA,2),
//             DCB=BLKSIZE=19040,SPACE=(CYL,(20,10),RLSE)
//MASTER   DD  DSN=&MASTIN,DISP=OLD
//SYSIN    DD  DSN=&&COPYCARD,DISP=(OLD,DELETE)
//**********************************************************************
//*   MERGE COPIED MODULES ONTO NEW TAPE MASTER
//**********************************************************************
//COPYTAPE EXEC  PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT DD  DUMMY
//INDEX    DD  DSN=&&INDEX,DISP=(,PASS),
//         DCB=(RECFM=FB,LRECL=133,BLKSIZE=6118),UNIT=SYSDA,
//         SPACE=(6118,(20,20),RLSE)
//LIST     DD  SYSOUT=A
//OSJOB    DD  DUMMY
//SYSAF01  DD  UNIT=(SYSDA,2),SPACE=(CYL,(10,10)),DCB=BLKSIZE=4628
//SYSAF02  DD  UNIT=(SYSDA,2),SPACE=(CYL,(10,10)),DCB=BLKSIZE=4628
//SYSAF03  DD  UNIT=(SYSDA,2),SPACE=(CYL,(30,15)),DCB=BLKSIZE=19069
//MASTIN   DD  DSN=&IND,DISP=OLD
//MASTOUT  DD  DSN=&OUTW(&GEN.),UNIT=TAPE,
//            LABEL=&RET,VOL=(,RETAIN),
//            DCB=(SYS2.MODEL,BLKSIZE=32760),
//            DISP=(,CATLG,DELETE)
//SYSIN    DD  DSN=SYSXKMB.LIB.ASM(OPSX0702),DISP=SHR
//         DD  DSN=&&TEMP,DISP=(OLD,DELETE)
//* SYSXKMB.LIB.ASM(OPSX0702) = -OPT NOCYCLE,INDEX
//**********************************************************************
//*   UPDATE ONLINE ARCHIVE DIRECTORY DATA SET
//**********************************************************************
//LIBUP   EXEC PGM=OPS4321G,PARM='&RUNTYPE',COND=(0,NE)
//STEPLIB  DD DSN=SYSXKMB.LIB.LOAD,DISP=SHR
//SYSABEND DD SYSOUT=A
//SORTLIB  DD DSN=SYS1.SORTLIB,DISP=SHR
//SORTOUT  DD DSN=&ARCHDSN(#DAILY),DISP=SHR
//SORTWK01 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK02 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK03 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK04 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SYSOUT   DD SYSOUT=*
//MESSAGES DD SYSOUT=*
//MASTDD   DD DSN=&&INDEX,DISP=(OLD,PASS)
//TAPEDD   DD DSN=*.COPYTAPE.MASTOUT,DISP=(OLD,PASS)
//DIRDD    DD DSN=&ARCHDSN(#DAILY),DISP=OLD
//DIRDDA   DD DSN=&ARCHDSN,DISP=OLD
//**********************************************************************
//*   REPORT CONTENTS OF ARCHIVE TAPE CREATED IN COPYTAPE STEP ABOVE
//**********************************************************************
//LIBPRT  EXEC PGM=OPS4322G,PARM='&RUNTYPE',COND=(0,NE)
//STEPLIB  DD DSN=SYSXKMB.LIB.LOAD,DISP=SHR
//SYSABEND DD SYSOUT=A
//SORTLIB  DD DSN=SYS1.SORTLIB,DISP=SHR
//SORTWK01 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK02 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK03 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SORTWK04 DD UNIT=SYSDA,SPACE=(CYL,(5,5),,CONTIG)
//SYSOUT   DD SYSOUT=*
//MESSAGES DD SYSOUT=*
//REPORTDD DD SYSOUT=A,DCB=(RECFM=FBA,LRECL=133,BLKSIZE=133)
//MASTDD   DD DSN=&&INDEX,DISP=(OLD,PASS)
//TAPEDD   DD DSN=*.COPYTAPE.MASTOUT,DISP=(OLD,PASS)
//**********************************************************************
//*   BACKUP DISK MASTER ONTO TAPE MASTER BEFORE DELETES
//**********************************************************************
//BACKUPM  EXEC  PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT DD  DUMMY
//INDEX    DD  DUMMY
//LIST     DD  SYSOUT=A
//OSJOB    DD  DUMMY
//MASTER   DD  DSN=&MASTIN,DISP=OLD
//BACKUP   DD  DSN=&MASTIN..BACKUP,DISP=(NEW,KEEP,DELETE),
//             LABEL=(2,&RET),VOL=REF=*.COPYTAPE.MASTOUT,
//             DCB=BLKSIZE=32760
//SYSIN    DD  DSN=SYSXKMB.LIB.ASM(OPSX0703),DISP=SHR
//* SYSXKMB.LIB.ASM(OPSX0703) = -OPT BKUPTAPE
//*                          -END
//**********************************************************************
//*   DELETE MOVED MODULES FROM DISK MASTER
//**********************************************************************
//DELETEM  EXEC  PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT DD  DUMMY
//SYSIN    DD  DSN=&&DLMCARD,DISP=(OLD,DELETE)
//MASTER   DD  DSN=&MASTIN,DISP=OLD
//INDEX    DD  SYSOUT=A
//OSJOB    DD  DUMMY
//**********************************************************************
//*   ALLOCATE EMPTY DAILY ARCHIVE MASTER TO START NEW WEEK
//**********************************************************************
//ALLOCDLY EXEC  PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT DD  DUMMY
//INDEX    DD  SYSOUT=A
//LIST     DD  SYSOUT=A
//OSJOB    DD  DUMMY
//SYSAF01  DD  UNIT=(SYSDA,1),SPACE=(CYL,(1,1)),DCB=BLKSIZE=4628
//SYSAF02  DD  UNIT=(SYSDA,1),SPACE=(CYL,(1,1)),DCB=BLKSIZE=4628
//SYSAF03  DD  UNIT=(SYSDA,1),SPACE=(CYL,(3,1)),DCB=BLKSIZE=19069
//MASTOUT  DD  DSN=&OUTD(&GEN.),UNIT=SYSPD,
//            SPACE=(19000,(1,1),RLSE),
//            DCB=(SYS2.MODEL,BLKSIZE=19000),
//            DISP=(,CATLG,DELETE)
//SYSIN    DD  DSN=SYSXKMB.LIB.ASM(OPSX0704),DISP=SHR
//* SYSXKMB.LIB.ASM(OPSX0704) = -OPT NOCYCLE,INDEX,NOINPUT
//*                          -END
//**********************************************************************
//*   COMPRESS THE ONLINE ARCHIVE DIRECTORY DATA SET
//**********************************************************************
//COMPRESS EXEC  PGM=IEBCOPY,COND=(0,NE)
//SYSPRINT DD  SYSOUT=*
//DIR      DD  DSN=&ARCHDSN,DISP=OLD
//SYSIN    DD  DSN=SYSXKMB.LIB.ASM(OPSX0705),DISP=SHR
//* SYSXKMB.LIB.ASM(OPSX0705) = COPY INDD=DIR,OUTDD=DIR
//**********************************************************************
//*   REINITIALIZE THE RESTORE FROM ARCHIVE DATA SET
//**********************************************************************
//INIT     EXEC PGM=LIBRARY,PARM='&PARMLIB',COND=(0,NE)
//SYSPRINT  DD SYSOUT=*
//MASTER    DD DSN=&RSARDSN,
//            DISP=(OLD,KEEP)
//SYSIN    DD  DSN=SYSXKMB.LIB.ASM(OPSX0706),DISP=SHR
//* SYSXKMB.LIB.ASM(OPSX0706) = -OPT INIT,DISK,SEQ=/81,8,10,10/
//*                          -END
//**********************************************************************
//*   NOTIFY THE OPERTOR THAT THE ARCHIVE JOB IS NOW COMPLETE AND
//*   LIBSPOOL WILL NOW BE STARTED
//**********************************************************************
//OPERMSG  EXEC PGM=OPS4341G
//STEPLIB  DD DSN=SYSXKMB.LIB.LOAD,DISP=SHR
//**********************************************************************
//*   SUBMIT A START COMMAND TO START LIBSPOOL
//**********************************************************************
//STARTLS  EXEC PGM=IEBGENER,COND=EVEN
//SYSPRINT DD DUMMY
//SYSUT1   DD  DSN=SYSXKMB.LIB.ASM(OPSX0707),DISP=SHR
//SYSUT2   DD SYSOUT=(A,INTRDR)
//SYSIN    DD DUMMY
//* SYSXKMB.LIB.ASM(OPSX0707) = /*$VS,'S LIBSPOOL'
