/* REXX EXEC : ( REXXSMF )
   FUNCTION  : INTEROGATE SYS1.MAN DATASETS AND SWITCH IF NECESSARY.
               JCL WILL HAVE TO PASS A PARM OF MAN1, MAN2, MANA, OR
               MANB.    */
TRACE R
ADDRESS TSO
ARG DSNPARM
PARMS = 'DSNPARM'
ERC = 0
MSGCNT = 0
DO 5
"CONSOLE ACTIVATE"
"CONSPROF SOLDISPLAY(NO)"
ADDRESS CONSOLE
  "D SMF"
  X = GETMSG('MSGTXT.','SOL',,,30)
  SRC = RC
  IF SRC = 0 THEN LEAVE
END
IF SRC ¬= 0 THEN DO
   ERC = 12
   EXIT ERC
END
DO I = 1 TO MSGTXT.0
   SMFMSG = POS(DSNPARM,MSGTXT.I)
   IF SMFMSG ¬= 0 THEN DO
      REPLY_ID = WORD(MSGTXT.I,5)
      SAY '+++ REPLY-ID: ('REPLY_ID') +++'
      LEAVE
   END
END
IF REPLY_ID = "ACTIVE" THEN DO
   "I SMF"
END
CALL CHECK_SMF
ADDRESS TSO
"CONSOLE DEACTIVATE"
EXIT ERC
/* SUBROUTINE */
CHECK_SMF:
DO 10
ADDRESS TSO
"SLEEP 000030"
ADDRESS CONSOLE
"D SMF"
X = GETMSG('MSGTXT.','SOL',,,30)
SRC = RC
IF SRC ¬= 0 THEN DO
   ERC = 12
   EXIT ERC
END
DO I = 1 TO MSGTXT.0
   SMFMSG = POS(DSNPARM,MSGTXT.I)
   IF SMFMSG ¬= 0 THEN DO
      REPLY_ID = WORD(MSGTXT.I,5)
      SAY '+++ REPLY-ID: ('REPLY_ID') +++'
      LEAVE
   END
END
IF REPLY_ID \= "ACTIVE" THEN LEAVE
   SAY '+++ REPLY-ID: ('REPLY_ID') +++'
   MSGCNT = MSGCNT + 1
   IF MSGCNT = 10 THEN DO
      SAY "THE SMF MAN DATASETS HAVE NOT BEEN SWITCHED!!"
      SAY "THE SMF MAN DATASETS HAVE NOT BEEN SWITCHED!!"
      SAY "THE SMF MAN DATASETS HAVE NOT BEEN SWITCHED!!"
      ERC = 12
      EXIT ERC
   END
END
