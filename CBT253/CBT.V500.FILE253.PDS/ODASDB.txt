/* REXX DASD BUILD ANALYSIS */
TRUE = "1";
FALSE = "0";
SUMMCTR=1;
DASD.0885 = "3380DJ";
DASD.1770 = "3380E";
DASD.2655 = "3380K";
DASD.2226 = "33902";
DASD.3339 = "33903";
DASD.6678 = "33906";
CDRS.3380DJ = "100 11F 200 21F";
CDRS.3380E  = "480 49F";
CDRS.3380K  = "C40 C5F F00 F00";
CDRS.33902  = "3C0 3FF FC0 FFF";
CDRS.33903  = "EC0 EFF 1C0 1FF";
CDRS.33906  = "F00 F00"; /* F00 IS END INDICATOR */
CLASSLIST="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
ABRPOOLS="ACIC APPL ART CICS DB2 EMC MNT MVS PLAN " || ,
  "POS QA RAMI SEQ SMSC SMS SYSDA SYSTA SYS TSO UART USER VSAM";
ABRPOOLSR="SYS CICS EMC DB2 SMS VSAM ART ACIC UART APPL MVS PLAN " || ,
  "POS QA RAMI SEQ SMSC TSO USER MNT SYSDA SYSTA";
TEMP = "";
DO I = 1 TO WORDS(CDRS.3380DJ) BY 2;
  LLIM = X2D(WORD(CDRS.3380DJ,I));
  HLIM = X2D(WORD(CDRS.3380DJ,I+1));
     DO J = LLIM TO HLIM;
        TEMP = TEMP D2X(J);
     END;
END;
CDRS.3380DJ = TEMP;
TEMP = "";
DO I = 1 TO WORDS(CDRS.3380E) BY 2;
  LLIM = X2D(WORD(CDRS.3380E,I));
  HLIM = X2D(WORD(CDRS.3380E,I+1));
     DO J = LLIM TO HLIM;
        TEMP = TEMP D2X(J);
     END;
END;
CDRS.3380E = TEMP;
TEMP = "";
DO I = 1 TO WORDS(CDRS.3380K) BY 2;
  LLIM = X2D(WORD(CDRS.3380K,I));
  HLIM = X2D(WORD(CDRS.3380K,I+1));
     DO J = LLIM TO HLIM;
        TEMP = TEMP D2X(J);
     END;
END;
CDRS.3380K = TEMP;
TEMP = "";
DO I = 1 TO WORDS(CDRS.33902) BY 2;
  LLIM = X2D(WORD(CDRS.33902,I));
  HLIM = X2D(WORD(CDRS.33902,I+1));
     DO J = LLIM TO HLIM;
        TEMP = TEMP D2X(J);
     END;
END;
CDRS.33902 = TEMP;
TEMP = "";
DO I = 1 TO WORDS(CDRS.33903) BY 2;
  LLIM = X2D(WORD(CDRS.33903,I));
  HLIM = X2D(WORD(CDRS.33903,I+1));
     DO J = LLIM TO HLIM;
        TEMP = TEMP D2X(J);
     END;
END;
CDRS.33903 = TEMP;
TEMP = "";
DO I = 1 TO WORDS(CDRS.33906) BY 2;
  LLIM = X2D(WORD(CDRS.33906,I));
  HLIM = X2D(WORD(CDRS.33906,I+1));
     DO J = LLIM TO HLIM;
        TEMP = TEMP D2X(J);
     END;
END;
CDRS.33906 = TEMP;
INIT_REST_UNIT = WORD(CDRS.33902,1);
CDRS.33902 = DELWORD(CDRS.33902,1,1);
"CALL 'SYS1.TECH.COMMON.LOADLIB(DASDSCAN)'";
/* "CALL 'TECH110.USER.LOADLIB(DASDSCAN)'"; */
SAVERC=RC;
IF SAVERC¬=0 THEN EXIT SAVERC;
"EXECIO * DISKR WORK (FINIS STEM DASDV.";
CHANGES = TRUE;
DO WHILE(CHANGES); /* BUBBLE SORT DESCENDING BY FRAG INDEX */
     CHANGES = FALSE;
     DO I = 1 TO DASDV.0-1;
          J = I+1;
          PARSE VAR DASDV.I . . . FRAGINDEX1 . ;
          PARSE VAR DASDV.J . . . FRAGINDEX2 . ;
          IF FRAGINDEX1 < FRAGINDEX2 THEN DO;
                 TEMP = DASDV.I;
                 DASDV.I = DASDV.J;
                 DASDV.J = TEMP;
                 CHANGES = TRUE;
                 END;
     END;
END;
DO I = 1 TO DASDV.0;
  PARSE VAR DASDV.I VOLSER CYLCOUNT FREECYL FRAGINDEX . ;
  ABR_BACKUP_DSN = "'FDRABR.V"VOLSER"'";
  DUMMY = LISTDSI(ABR_BACKUP_DSN); /* SEE IF DATASET EXISTS */
  IF DUMMY¬=0 THEN DO;
       DASDV.I = "DUMMY"; /* IGNORE THIS VOLUME */
       ITERATE I; /* LOOP */
       END;
  POOLCTR=WORDS(ABRPOOLS);
  DO J=1 TO POOLCTR;
     POOL=WORD(ABRPOOLS,J);
     IF ABBREV(VOLSER,POOL) THEN DO;
           IF SYMBOL('POOLLIST.POOL')="VAR" THEN ,
               POOLLIST.POOL=POOLLIST.POOL VOLSER;
            ELSE POOLLIST.POOL=VOLSER;
          LEAVE J;
         END;
  END;
END;
ABRPOOLS = ABRPOOLSR; /* REORG LIST FOR ORDER TO PROCESS IN */
DO J=1 TO POOLCTR;
     POOL=WORD(ABRPOOLS,J);
     VOLCNT=WORDS(POOLLIST.POOL);
     JOBC=SUBSTR(CLASSLIST,J,1);
SUMM.SUMMCTR="****** POOL" LEFT(POOL,7) "RESTORE JOBCLASS:" JOBC ,
        "VOLCNT:" VOLCNT;
     SUMMCTR=SUMMCTR+1;
END;
JCLZ1.0 = 6; /* COUNT OF DUMP JOB STATEMENTS */
JCLZ1.1 = "//LOAD1 EXEC PGM=IKJEFT01,DYNAMNBR=32,PARM='%DB2TIACK'";
JCLZ1.2 = "//SYSTSPRT DD SYSOUT=*";
JCLZ1.3 = "//SYSPRINT DD SYSOUT=*";
JCLZ1.4 = "//SYSTSIN DD DUMMY";
JCLZ1.5 = "//SYSPROC DD DSN=SYSS.TECH.COMMON.EXECLIB,DISP=SHR";
JCLZ1.6 = "//SYSIN DD *";
JCLZ1.7 =" INSERT INTO BUILD.TABRVOLS (VOLSER,DUMP_TYPE,DUMP_STATUS)";
JCLZ1.8= "    VALUES('XXXXXX','INCRVOL','ACTIVE');";
JCLZ1.9= " COMMIT;";
JCLZ1.10 = " DELETE FROM BUILD.TABRVOLS WHERE VOLSER='XXXXXX' AND ";
JCLZ1.11 = " DUMP_STATUS='PENDING' AND DUMP_TYPE='INCRVOL';";
JCLZ1.12= " COMMIT;";
JCLZ1.13= "/*";
JCLZ2.0 = 7; /* COUNT OF DUMP JOB STATEMENTS */
JCLZ2.1 = "// IF (RC<=4 & ¬ABEND) THEN";
JCLZ2.2 = "//LOAD2 EXEC PGM=IKJEFT01,DYNAMNBR=32,PARM='%DB2TIACK'";
JCLZ2.3 = "//SYSTSPRT DD SYSOUT=*";
JCLZ2.4 = "//SYSPRINT DD SYSOUT=*";
JCLZ2.5 = "//SYSTSIN DD DUMMY";
JCLZ2.6 = "//SYSPROC DD DSN=SYSS.TECH.COMMON.EXECLIB,DISP=SHR";
JCLZ2.7 = "//SYSIN DD *";
JCLZ2.8 = " UPDATE BUILD.TABRVOLS SET DUMP_STATUS='COMPLETE'";
JCLZ2.9 = "    WHERE VOLSER='XXXXXX' AND DUMP_TYPE='INCRVOL';";
JCLZ2.10= " COMMIT;";
JCLZ2.11= "/*";
JCLZ2.12= "// ENDIF";
JCLZ3.0 = 7; /* COUNT OF DUMP JOB STATEMENTS */
JCLZ3.1 = "// IF (RC>4 | ABEND) THEN";
JCLZ3.2 = "//LOAD3 EXEC PGM=IKJEFT01,DYNAMNBR=32,PARM='%DB2TIACK'";
JCLZ3.3 = "//SYSTSPRT DD SYSOUT=*";
JCLZ3.4 = "//SYSPRINT DD SYSOUT=*";
JCLZ3.5 = "//SYSTSIN DD DUMMY";
JCLZ3.6 = "//SYSPROC DD DSN=SYSS.TECH.COMMON.EXECLIB,DISP=SHR";
JCLZ3.7 = "//SYSIN DD *";
JCLZ3.8 = " UPDATE BUILD.TABRVOLS SET DUMP_STATUS='FAILURE'";
JCLZ3.9 = "    WHERE VOLSER='XXXXXX' AND DUMP_TYPE='INCRVOL' AND";
JCLZ3.10 = "     DUMP_STATUS='ACTIVE';";
JCLZ3.11= " COMMIT;";
JCLZ3.12= "/*";
JCLZ3.13= "// ENDIF";
JCLD.0 = 63; /* COUNT OF DUMP JOB STATEMENTS */
JCLD.1 = "//D$XXXXXX JOB 530401053000,'SYSTEM.BACKUP',";
JCLD.2 = "// NOTIFY=TECH251,CLASS=S,MSGCLASS=G";
JCLD.3 = "//LOAD1 EXEC PGM=IKJEFT01,DYNAMNBR=32,PARM='%DB2TIACK'";
JCLD.4 = "//SYSTSPRT DD SYSOUT=*";
JCLD.5 = "//SYSPRINT DD SYSOUT=*";
JCLD.6 = "//SYSTSIN DD DUMMY";
JCLD.7 = "//SYSPROC DD DSN=SYSS.TECH.COMMON.EXECLIB,DISP=SHR";
JCLD.8 = "//SYSIN DD *";
JCLD.9 = " DELETE FROM BUILD.TABRVOLS WHERE VOLSER='XXXXXX' AND ";
JCLD.10 = " DUMP_STATUS='PENDING' AND DUMP_TYPE='FULLVOL';";
JCLD.11 = " COMMIT;";
JCLD.12 = " INSERT INTO BUILD.TABRVOLS (VOLSER,DUMP_TYPE,DUMP_STATUS)";
JCLD.13 = "    VALUES('XXXXXX','FULLVOL','ACTIVE');";
JCLD.14 = "//DUMPIT EXEC PGM=FDRABR,REGION=9M";
JCLD.15 = "//SYSPRINT DD SYSOUT=*";
JCLD.16 = "//SYSPRIN1 DD SYSOUT=*";
JCLD.17 = "//DISK1 DD UNIT=XXXX,";
JCLD.18 = "// DISP=SHR,";
JCLD.19 = "// VOL=SER=XXXXXX";
JCLD.20="//TAPE1 DD DSN=FXXXXXX,DISP=(,KEEP),UNIT=TA80,VOL=(,,,255)";
JCLD.21 = "//SYSUDUMP DD SYSOUT=X";
JCLD.22 = "//SYSIN DD *";
JCLD.23 = " DUMP TYPE=FDR,";
JCLD.24 = "  AUTOUPD=YES,";
JCLD.25 = "  BUFNO=MAX,";
JCLD.26 = "  COMPRESS=ALL,";
JCLD.27 = "  DATA=ALL,";
JCLD.28 = "  DATEP=NONE,";
JCLD.29 = "  DSNENQ=TEST,";
JCLD.30 = "  ENQ=RESERVE,";
JCLD.31 = "  ENQERR=NO,";
JCLD.32 = "  ENQERR=PROCESS,";
JCLD.33 = "  FORMAT=NEW,";
JCLD.34 = "  LBPZERO=INVALID,";
JCLD.35 = "  MAXERR=1,";
JCLD.36 = "  PRINT=ABR,";
JCLD.37 = "  RETPD=9999,";
JCLD.38 = "  SMSCONSTRUCT=NO,";
JCLD.39 = "  SMSMANAGE=NO";
JCLD.40 = "/*";
JCLD.41 = "// IF (RC<=4 & ¬ABEND) THEN";
JCLD.42 = "//LOAD2 EXEC PGM=IKJEFT01,DYNAMNBR=32,PARM='%DB2TIACK'";
JCLD.43 = "//SYSTSPRT DD SYSOUT=*";
JCLD.44 = "//SYSPRINT DD SYSOUT=*";
JCLD.45 = "//SYSTSIN DD DUMMY";
JCLD.46 = "//SYSPROC DD DSN=SYSS.TECH.COMMON.EXECLIB,DISP=SHR";
JCLD.47 = "//SYSIN DD *";
JCLD.48 = " UPDATE BUILD.TABRVOLS SET DUMP_STATUS='COMPLETE'";
JCLD.49 = "    WHERE VOLSER='XXXXXX' AND DUMP_TYPE='FULLVOL';";
JCLD.50 = "/*";
JCLD.51 = "// ENDIF";
JCLD.52 = "// IF (RC>4 | ABEND) THEN";
JCLD.53 = "//LOAD3 EXEC PGM=IKJEFT01,DYNAMNBR=32,PARM='%DB2TIACK'";
JCLD.54 = "//SYSTSPRT DD SYSOUT=*";
JCLD.55 = "//SYSPRINT DD SYSOUT=*";
JCLD.56 = "//SYSTSIN DD DUMMY";
JCLD.57 = "//SYSPROC DD DSN=SYSS.TECH.COMMON.EXECLIB,DISP=SHR";
JCLD.58 = "//SYSIN DD *";
JCLD.59 = " UPDATE BUILD.TABRVOLS SET DUMP_STATUS='FAILURE'";
JCLD.60 = "    WHERE VOLSER='XXXXXX' AND DUMP_TYPE='FULLVOL';";
JCLD.61 = "/*";
JCLD.62 = "// ENDIF";
JCLD.63 = "//";
JCLX.0 = 30; /* COUNT OF INCR JOB STATEMENTS */
JCLX.1 = "//I$XXXX JOB 530401053000,'SYSTEM.BACKUP',";
JCLX.2 = "// NOTIFY=TECH251,";
JCLX.3 = "// CLASS=S,MSGCLASS=G";
JCLX.4 = "//DUMPIT EXEC PGM=FDRABR,REGION=9M";
JCLX.5 = "//SYSPRIN1 DD SYSOUT=*";
JCLX.6 = "//SYSPRIN2 DD SYSOUT=*";
JCLX.7 = "//SYSPRIN3 DD SYSOUT=*";
JCLX.8="//TAPE1 DD DSN=I1XXXX,DISP=(,KEEP),UNIT=TA80,VOL=(,,,255)";
JCLX.9="//TAPE2 DD DSN=I2XXXX,DISP=(,KEEP),UNIT=TA80,VOL=(,,,255)";
JCLX.10="//TAPE3 DD DSN=I3XXXX,DISP=(,KEEP),UNIT=TA80,VOL=(,,,255)";
JCLX.11= "//SYSPRINT DD SYSOUT=*";
JCLX.12 = "//SYSUDUMP DD SYSOUT=X";
JCLX.13 = "//SYSIN DD *";
JCLX.14 = " DUMP TYPE=ABR,";
JCLX.15 = "  AUTOUPD=YES,";
JCLX.16 = "  BUFNO=MAX,";
JCLX.17 = "  COMPRESS=ALL,";
JCLX.18 = "  DATA=USED,";
JCLX.19 = "  DATEP=NONE,";
JCLX.20 = "  DSNENQ=TEST,";
JCLX.21 = "  ENQ=RESERVE,";
JCLX.22 = "  ENQERR=NO,";
JCLX.23 = "  ENQERR=PROCESS,";
JCLX.24 = "  FORMAT=NEW,";
JCLX.25 = "  LBPZERO=INVALID,";
JCLX.26 = "  MAXERR=1,";
JCLX.27 = "  PRINT=ABR,";
JCLX.28 = "  RETPD=9999,";
JCLX.29 = "  SMSCONSTRUCT=NO,";
JCLX.30 = "  SMSMANAGE=NO";
JCLR.0 = 47; /* COUNT OF RESTORE JOB STATEMENTS */
JCLR.1 = "//R$XXXXXX JOB 530401053000,'TECH SUPPRT',";
JCLR.2 = "// CLASS=?,MSGCLASS=X,MSGLEVEL=(1,1),REGION=6M";
JCLR.3 = "//JOBLIB DD DSN=IMPORT.LINKLIB1,DISP=SHR";
JCLR.4 = "//ACTIVE EXEC PGM=IKJEFT01,REGION=6M,";
JCLR.5= "// PARM='ALTER ''FDRABR.COMDISCO.WEEKREST.VXXXXXX'' OWNER(I)'"
JCLR.6 = "//SYSTSPRT DD SYSOUT=*";
JCLR.7 = "//SYSTSIN DD DUMMY";
JCLR.8 = "//*";
JCLR.9 = "//*";
JCLR.10 = "//*";
JCLR.11 = "//*";
JCLR.12 = "//*";
JCLR.13 = "//RESTIT EXEC PGM=FDRABR,REGION=6M";
JCLR.14 = "//SYSPRINT DD SYSOUT=*";
JCLR.15 = "//ABRWORK  DD UNIT=SYSALLDA,SPACE=(CYL,(2,1))";
JCLR.16 = "//DISK1 DD UNIT=XXXX,VOL=SER=XXXXXX,DISP=OLD";
JCLR.17 = "//SYSIN DD *";
JCLR.18 = " RESTORE TYPE=FDR,";
JCLR.19 = "   CONFMESS=NO,";
JCLR.20 = "   COPY=1,";
JCLR.21 = "  CPYVOLID=YES,";
JCLR.22 = "  DYNTAPE,";
JCLR.23 = "  MAXERR=1,";
JCLR.24 = "  SMSPROT=NONE,";
JCLR.25 = "  VOLRESET=NO";
JCLR.26 = " SELECT  VOL=XXXXXX,GEN=CURRENT";
JCLR.27 = "/*";
JCLR.28 = "//IXITIT EXEC PGM=ICKDSF,REGION=6M";
JCLR.29 = "//SYSPRINT DD SYSOUT=*";
JCLR.30 = "//DISK1 DD UNIT=XXXX,VOL=SER=XXXXXX,DISP=OLD";
JCLR.31 = "//SYSIN DD *";
JCLR.32=" BUILDIX DDNAME(DISK1) IXVTOC";
JCLR.33 = "//COMPLETE EXEC PGM=IKJEFT01,COND=(0,NE,RESTIT),";
JCLR.34="// PARM='ALTER ''FDRABR.COMDISCO.WEEKREST.VXXXXXX'' OWNER(C)'"
JCLR.35 = "//SYSTSPRT DD SYSOUT=*";
JCLR.36 = "//SYSTSIN DD DUMMY";
JCLR.37 = "//*";
JCLR.38 = "//*";
JCLR.39 = "//*";
JCLR.40 = "//*";
JCLR.41 = "//*";
JCLR.42 = "//*";
JCLR.43 = "//FAILURE EXEC PGM=IKJEFT01,COND=((0,GE,RESTIT),EVEN),";
JCLR.44="// PARM='ALTER ''FDRABR.COMDISCO.WEEKREST.VXXXXXX'' OWNER(F)'"
JCLR.45 = "//SYSTSPRT DD SYSOUT=*";
JCLR.46 = "//SYSTSIN DD DUMMY";
JCLR.47 = "//";
JCLI.0 = 8; /* COUNT OF INIT JOB STATEMENTS */
JCLI.1 = "//I$XXXXXX JOB 530401053000,'TECH SUPPRT',NOTIFY=$CDRS1,";
JCLI.2 = "// CLASS=A,MSGCLASS=X,MSGLEVEL=(1,1)";
JCLI.3 = "//INITIT EXEC PGM=ICKDSF,REGION=6M";
JCLI.4 = "//SYSPRINT DD SYSOUT=*";
JCLI.5 = "//SYSIN DD *";
JCLI.6=" INIT UNIT(XXX) NVFY NCHK INDEX(1,0,15) VTOC(0,1,14) -";
JCLI.7 = "   NOMAP PRG NVAL VOLID(XXXXXX)";
JCLI.8 = "//";
JCLC.0 = 7; /* COMPAKTOR */
JCLC.1 = "//SYSMAP1 DD SYSOUT=*";
JCLC.2 = "//CPKWORK DD UNIT=VIO,SPACE=(CYL,(1,1))";
JCLC.3 = "//CPIN1 DD *";
JCLC.4 = " CPK TYPE=COMPAKT,ACTMESS=NO,CONFMESS=NO,";
JCLC.5 = "   HI=NO,MAPS=ALL,NOSECOND=NORLSE,";
JCLC.6 = "   O=MAXFREE,OVERRIDE=NO,POR=ALL,";
JCLC.7 = "   T=KEEP,V=NOCHANGE,%FREE=10";
HEADTAIL = TRUE;
CPKCTR = 20;
SAY "";
SAY "****** INITIAL RESTORE 3390 UNIT:" ,
     INIT_REST_UNIT;
SAY "";
SUMM.SUMMCTR = "****** INITIAL RESTORE 3390 UNIT:" ,
     INIT_REST_UNIT;
SUMMCTR=SUMMCTR+1;
/* LOOP */
POOLCTR=WORDS(ABRPOOLS);
DO ZZ=1 TO POOLCTR;
JOBC = SUBSTR(CLASSLIST,ZZ,1);
POOL=WORD(ABRPOOLS,ZZ);
POOLMEM=STRIP(SUBSTR("POOL"POOL,1,8));
DROP DUMP.;
DROP INCR.;
DROP REST.;
DROP INIT.;
DUMPCTR=1;
INCRCTR=1;
RESTCTR=1;
INITCTR=1;
"FREE F(INIT)";
"FREE F(DUMP)";
"FREE F(INCR)";
"FREE F(REST)";
"ALLOC F(INIT) DA('SYSS.COMDISCO.INITJOBS("POOLMEM")') SHR";
IF RC¬=0 THEN EXIT 99;
IF POOLMEM ¬="POOLSYSD" & POOLMEM ¬="POOLSYST" THEN DO;
"ALLOC F(DUMP) DA('SYSS.COMDISCO.DUMPJOBS("POOLMEM")') SHR";
IF RC¬=0 THEN EXIT 99;
END;
IF POOLMEM ¬="POOLSYSD" & POOLMEM ¬="POOLSYST" THEN DO;
"ALLOC F(INCR) DA('SYSS.COMDISCO.INCRJOBS("POOLMEM")') SHR";
IF RC¬=0 THEN EXIT 99;
END;
IF POOLMEM ¬="POOLSYSD" & POOLMEM ¬="POOLSYST" THEN DO;
"ALLOC F(REST) DA('SYSS.COMDISCO.RESTJOBS("POOLMEM")') SHR";
IF RC¬=0 THEN EXIT 99;
END;
T1=OVERLAY(POOL,JCLX.1,POS('XXXX',JCLX.1));
DO J = 1 TO 3;
      IF J=1 THEN INCR.INCRCTR=T1;
      ELSE INCR.INCRCTR=JCLX.J;
      INCRCTR=INCRCTR+1;
END;
DO J = 1 TO JCLZ1.0;
      INCR.INCRCTR=JCLZ1.J;
      INCRCTR=INCRCTR+1;
END;
XCTR=WORDS(POOLLIST.POOL);
TRUEVOLC=0;
DO I = 1 TO XCTR;
  XVOL=WORD(POOLLIST.POOL,I);
  TEMP_PACK1 = SUBSTR(XVOL,1,5);
  TEMP_PACK2 = SUBSTR(XVOL,1,3);
  IF TEMP_PACK1="SYSDA" | TEMP_PACK1="SYSTA" | TEMP_PACK2="DRV" ,
     | TEMP_PACK2="TEM" | TEMP_PACK2="LAN" THEN ITERATE;
  IF XVOL="SYS015" | XVOL="SYS007" | XVOL="SYS008" | XVOL="SYS011" | ,
     XVOL="SYS012" | XVOL="SYS013" | XVOL="SYS014" THEN ITERATE;
  INCR.INCRCTR=JCLZ1.7;
  INCRCTR=INCRCTR+1;
  INCR.INCRCTR=OVERLAY(XVOL,JCLZ1.8,POS('XXXXXX',JCLZ1.8));
  INCRCTR=INCRCTR+1;
  INCR.INCRCTR=JCLZ1.9;
  INCRCTR=INCRCTR+1;
  INCR.INCRCTR=OVERLAY(XVOL,JCLZ1.10,POS('XXXXXX',JCLZ1.10));
  INCRCTR=INCRCTR+1;
  INCR.INCRCTR=JCLZ1.11;
  INCRCTR=INCRCTR+1;
  INCR.INCRCTR=JCLZ1.12;
  INCRCTR=INCRCTR+1;
  TRUEVOLC=TRUEVOLC+1;
END;
INCR.INCRCTR=JCLZ1.13;
INCRCTR=INCRCTR+1;
T2=OVERLAY(POOL,JCLX.8,POS('XXXX',JCLX.8));
T3=OVERLAY(POOL,JCLX.9,POS('XXXX',JCLX.9));
T4=OVERLAY(POOL,JCLX.10,POS('XXXX',JCLX.10));
DO J = 4 TO JCLX.0;
      IF J=8 THEN INCR.INCRCTR=T2;
      ELSE IF J=9 THEN INCR.INCRCTR=T3;
      ELSE IF J=10 THEN INCR.INCRCTR=T4;
      ELSE INCR.INCRCTR=JCLX.J;
      /* TAPE CTR BY VOL CNT LOGIC */
/*    IF TRUEVOLC>=9 & J=17 THEN ITERATE J;   */
      IF TRUEVOLC>=9 THEN NOP;
      ELSE IF TRUEVOLC>=4 & ,
          (J=7 | J=10) THEN ITERATE J;
      ELSE IF TRUEVOLC<4 & ,
          (J=7 | J=10 | J=6 | J=9) THEN ITERATE J;
      INCRCTR=INCRCTR+1;
      IF TRUEVOLC>=9 & J=7 THEN DO;
         INCR.INCRCTR="//SYSPRIN4 DD SYSOUT=*";
         INCRCTR=INCRCTR+1;
/*       INCR.INCRCTR="//SYSPRIN5 DD SYSOUT=*";
         INCRCTR=INCRCTR+1;
         INCR.INCRCTR="//SYSPRIN6 DD SYSOUT=*";
         INCRCTR=INCRCTR+1;    */
      END;
      IF TRUEVOLC>=9 & J=10 THEN DO;
      POOLX = LEFT(POOL,4,"X"); /* FILL OUT */
INCR.INCRCTR= ,
 "//TAPE4 DD DSN=I4"POOLX",DISP=(,KEEP),UNIT=TA80,VOL=(,,,255)"
         INCRCTR=INCRCTR+1;
/* INCR.INCRCTR= ,
 "//TAPE5 DD DSN=I5"POOLX",DISP=(,KEEP),UNIT=TA80,VOL=(,,,255)"
         INCRCTR=INCRCTR+1;
INCR.INCRCTR= ,
 "//TAPE6 DD DSN=I6"POOLX",DISP=(,KEEP),UNIT=TA80,VOL=(,,,255)"
         INCRCTR=INCRCTR+1;     */
      END;
END;
XCTR=WORDS(POOLLIST.POOL);
DO I = 1 TO XCTR;
  XVOL=WORD(POOLLIST.POOL,I);
  TEMP_PACK1 = SUBSTR(XVOL,1,5);
  TEMP_PACK2 = SUBSTR(XVOL,1,3);
  IF TEMP_PACK1="SYSDA" | TEMP_PACK1="SYSTA" | TEMP_PACK2="DRV" ,
     | TEMP_PACK2="TEM" | TEMP_PACK2="LAN" THEN ITERATE;
  /* SKIP SOME INCR */
  IF XVOL="SYS015" | XVOL="SYS007" | XVOL="SYS008" | XVOL="SYS011" | ,
     XVOL="SYS012" | XVOL="SYS013" | XVOL="SYS014" THEN ITERATE;
  INCR.INCRCTR=" MOUNT VOL="XVOL;
  INCRCTR=INCRCTR+1;
END;
DO J = 1 TO JCLZ2.0;
      INCR.INCRCTR=JCLZ2.J;
      INCRCTR=INCRCTR+1;
END;
XCTR=WORDS(POOLLIST.POOL);
DO I = 1 TO XCTR;
  XVOL=WORD(POOLLIST.POOL,I);
  TEMP_PACK1 = SUBSTR(XVOL,1,5);
  TEMP_PACK2 = SUBSTR(XVOL,1,3);
  IF TEMP_PACK1="SYSDA" | TEMP_PACK1="SYSTA" | TEMP_PACK2="DRV" ,
     | TEMP_PACK2="TEM" | TEMP_PACK2="LAN" THEN ITERATE;
  IF XVOL="SYS015" | XVOL="SYS007" | XVOL="SYS008" | XVOL="SYS011" | ,
     XVOL="SYS012" | XVOL="SYS013" | XVOL="SYS014" THEN ITERATE;
  INCR.INCRCTR=JCLZ2.8;
  INCRCTR=INCRCTR+1;
  INCR.INCRCTR=OVERLAY(XVOL,JCLZ2.9,POS('XXXXXX',JCLZ2.9));
  INCRCTR=INCRCTR+1;
  INCR.INCRCTR=JCLZ2.10;
  INCRCTR=INCRCTR+1;
END;
INCR.INCRCTR=JCLZ2.11;
INCRCTR=INCRCTR+1;
INCR.INCRCTR=JCLZ2.12;
INCRCTR=INCRCTR+1;
DO J = 1 TO JCLZ3.0;
      INCR.INCRCTR=JCLZ3.J;
      INCRCTR=INCRCTR+1;
END;
XCTR=WORDS(POOLLIST.POOL);
DO I = 1 TO XCTR;
  XVOL=WORD(POOLLIST.POOL,I);
  TEMP_PACK1 = SUBSTR(XVOL,1,5);
  TEMP_PACK2 = SUBSTR(XVOL,1,3);
  IF TEMP_PACK1="SYSDA" | TEMP_PACK1="SYSTA" | TEMP_PACK2="DRV" ,
     | TEMP_PACK2="TEM" | TEMP_PACK2="LAN" THEN ITERATE;
  IF XVOL="SYS015" | XVOL="SYS007" | XVOL="SYS008" | XVOL="SYS011" | ,
     XVOL="SYS012" | XVOL="SYS013" | XVOL="SYS014" THEN ITERATE;
  INCR.INCRCTR=JCLZ3.8;
  INCRCTR=INCRCTR+1;
  INCR.INCRCTR=OVERLAY(XVOL,JCLZ3.9,POS('XXXXXX',JCLZ3.9));
  INCRCTR=INCRCTR+1;
  INCR.INCRCTR=JCLZ3.10;
  INCRCTR=INCRCTR+1;
  INCR.INCRCTR=JCLZ3.11;
  INCRCTR=INCRCTR+1;
END;
INCR.INCRCTR=JCLZ3.12;
INCRCTR=INCRCTR+1;
INCR.INCRCTR=JCLZ3.13;
INCRCTR=INCRCTR+1;
INCR.INCRCTR="//";
INCRCTR=INCRCTR+1;
 DO I = 1 TO DASDV.0;
  CPK=FALSE;
  PARSE VAR DASDV.I VOLSER CYLCOUNT FREECYL FRAGINDEX . ;
  IF VOLSER="DUMMY" THEN ITERATE;
  IF WORDPOS(VOLSER,POOLLIST.POOL)=0 THEN ITERATE;/*DIFFERENT POOL*/
  DEVTYPE = DASD.CYLCOUNT;
  TRUE_DEVTYPE = DASD.CYLCOUNT;
  IF HEADTAIL THEN DO;
         HEADTAIL = FALSE; /* ROTATE CUU SELECTION */
         UNIT = WORD(CDRS.DEVTYPE,1);
         CDRS.DEVTYPE = DELWORD(CDRS.DEVTYPE,1,1);
         END;
  ELSE DO;
         HEADTAIL = TRUE;  /* ROTATE CUU SELECTION */
         IF WORDS(CDRS.DEVTYPE)=0 THEN ,
              UNIT="";
         ELSE DO;
           UNIT = WORD(CDRS.DEVTYPE,WORDS(CDRS.DEVTYPE));
           IF UNIT¬="F00" THEN ,
           CDRS.DEVTYPE = DELWORD(CDRS.DEVTYPE,WORDS(CDRS.DEVTYPE),1);
           END;
         END;
  TARGET_TYPE=DEVTYPE;
  IF UNIT="" THEN DO; /* COMDISCO HAS NO MORE */
       SELECT;
         WHEN (DEVTYPE="3380DJ") THEN TARGET_TYPE="3380E";
         WHEN (DEVTYPE="3380E") THEN TARGET_TYPE="3380K";
         WHEN (DEVTYPE="3380K") THEN EXIT 16; /* EMERGENCY */
         WHEN (DEVTYPE="33902") THEN TARGET_TYPE="33903";
         WHEN (DEVTYPE="33903") THEN TARGET_TYPE="33906";
         WHEN (DEVTYPE="33906") THEN EXIT 20; /* EMERGENCY */
         OTHERWISE EXIT 24;
       END;
       IF TARGET_TYPE="3380E" & WORDS(CDRS.3380E)=0 THEN ,
            TARGET_TYPE="3380K";
       IF WORDS(CDRS.TARGET_TYPE)=0 THEN EXIT 28;
       UNIT = WORD(CDRS.TARGET_TYPE,1);
       IF UNIT¬="F00" THEN ,
       CDRS.TARGET_TYPE = DELWORD(CDRS.TARGET_TYPE,1,1);
       END;
  DEVTYPE = SUBSTR(DEVTYPE,1,4);
  TEMP_PACK1 = SUBSTR(VOLSER,1,5);
  TEMP_PACK2 = SUBSTR(VOLSER,1,3);
  IF TEMP_PACK1¬="SYSDA" & TEMP_PACK1¬="SYSTA" & TEMP_PACK2¬="DRV" ,
     & TEMP_PACK2¬="TEM" & TEMP_PACK2¬="LAN" ,
       THEN DO;
  T1=OVERLAY(DEVTYPE,JCLD.17,POS('XXXX',JCLD.17));
  T2=OVERLAY(VOLSER,JCLD.19,POS('XXXXXX',JCLD.19));
  T3=OVERLAY(VOLSER,JCLD.1,POS('XXXXXX',JCLD.1));
  T4=OVERLAY(VOLSER,JCLD.20,POS('XXXXXX',JCLD.20));
  T5=OVERLAY(VOLSER,JCLD.9,POS('XXXXXX',JCLD.9));
  T7=OVERLAY(VOLSER,JCLD.13,POS('XXXXXX',JCLD.13));
  T8=OVERLAY(VOLSER,JCLD.49,POS('XXXXXX',JCLD.49));
  T9=OVERLAY(VOLSER,JCLD.60,POS('XXXXXX',JCLD.60));
  CDSR= "'FDRABR.COMDISCO.WEEKREST.V"VOLSER"'";
  "ALTER" CDSR "OWNER(N)"; /* NOT ACTIVE */
  IF RC > 0 THEN ,
    "DEFINE NVSAM (NAME("CDSR") DEVT(0000) VOL('******') OWNER(N))";
  DO J = 1 TO JCLD.0;
      IF J=17 THEN DUMP.DUMPCTR=T1;
      ELSE IF J=19 THEN DUMP.DUMPCTR=T2;
      ELSE IF J=1 THEN DUMP.DUMPCTR=T3;
      ELSE IF J=20 THEN DUMP.DUMPCTR=T4;
      ELSE IF J=9 THEN DUMP.DUMPCTR=T5;
      ELSE IF J=13 THEN DUMP.DUMPCTR=T7;
      ELSE IF J=49 THEN DUMP.DUMPCTR=T8;
      ELSE IF J=60 THEN DUMP.DUMPCTR=T9;
      ELSE IF J=30 & VOLSER="SYS015" THEN ,
         DUMP.DUMPCTR="  ENQ=OFF,";
      ELSE DUMP.DUMPCTR=JCLD.J;
      IF J=23 & I<=CPKCTR & SUBSTR(VOLSER,1,3)¬="MNT" & ,
        SUBSTR(VOLSER,1,3)¬="SYS" THEN DO;  /* CANT COMPKT SYS */
          CPK=TRUE;
          DUMP.DUMPCTR=DUMP.DUMPCTR||"COMPAKT,";
          END;
       ELSE IF J=23 THEN CPK=FALSE;
       ELSE NOP;
      IF (J=29) & (CPK) THEN DO;
          DUMP.DUMPCTR="  DSNENQ=USE,";
          END;
      DUMPCTR=DUMPCTR+1;
      IF (J=39) & (CPK) THEN DO;
           DO Z=1 TO JCLC.0;
                DUMP.DUMPCTR=JCLC.Z;
                DUMPCTR=DUMPCTR+1;
           END;
         END;
  END;
  T1=OVERLAY(DEVTYPE,JCLR.16,POS('XXXX',JCLR.16));
  T1=OVERLAY(VOLSER,T1,POS('XXXXXX',T1));
  T2=OVERLAY(VOLSER,JCLR.26,POS('XXXXXX',JCLR.26));
  T3=OVERLAY(VOLSER,JCLR.1,POS('XXXXXX',JCLR.1));
  T4=OVERLAY(VOLSER,JCLR.5,POS('XXXXXX',JCLR.5));
  T5=OVERLAY(VOLSER,JCLR.34,POS('XXXXXX',JCLR.34));
  T6=OVERLAY(VOLSER,JCLR.44,POS('XXXXXX',JCLR.44));
  T7=OVERLAY(JOBC,JCLR.2,POS('?',JCLR.2));
  DO J = 1 TO JCLR.0;
      IF J=16 THEN REST.RESTCTR=T1;
      ELSE IF J=26 THEN REST.RESTCTR=T2;
      ELSE IF J=30 THEN REST.RESTCTR=T1;
      ELSE IF J=34 THEN REST.RESTCTR=T5;
      ELSE IF J=44 THEN REST.RESTCTR=T6;
      ELSE IF J=5 THEN REST.RESTCTR=T4;
      ELSE IF J=1 THEN REST.RESTCTR=T3;
      ELSE IF J=2 THEN REST.RESTCTR=T7;
      ELSE REST.RESTCTR=JCLR.J;
      RESTCTR=RESTCTR+1;
  END;
  END;
  T1=OVERLAY(UNIT,JCLI.6,POS('XXX',JCLI.6));
  T2=OVERLAY(VOLSER,JCLI.7,POS('XXXXXX',JCLI.7));
  T3=OVERLAY(VOLSER,JCLI.1,POS('XXXXXX',JCLI.1));
 IF UNIT¬="F00" THEN DO;
  DO J = 1 TO JCLI.0;
      IF J=6 THEN INIT.INITCTR=T1;
      ELSE IF J=7 THEN INIT.INITCTR=T2;
      ELSE IF J=1 THEN INIT.INITCTR=T3;
      ELSE INIT.INITCTR=JCLI.J;
      INITCTR=INITCTR+1;
  END;
 END;
 IF UNIT¬="F00" THEN ,
  SUMM.SUMMCTR = VOLSER "TYPE" LEFT(TRUE_DEVTYPE,6) "MAPPED TO",
     "CDRS UNIT" UNIT "TYPE" TARGET_TYPE;
 ELSE ,
SUMM.SUMMCTR="****** VOLUME" VOLSER "NOT INITIALIZED AND/OR RESTORED";
  IF VOLSER="SYS006" THEN ,
       SUMM.SUMMCTR=SUMM.SUMMCTR "IPL LOADUNIT" UNIT;
  IF VOLSER="SYS001" | VOLSER="SYS002" THEN ,
       SUMM.SUMMCTR=SUMM.SUMMCTR "LOADPARM" RIGHT(UNIT,4,"0")"CDM";
  SUMMCTR=SUMMCTR+1;
 END I;
IF POOLMEM ¬="POOLSYSD" & POOLMEM ¬="POOLSYST" THEN DO;
 "EXECIO * DISKW DUMP (FINIS STEM DUMP.";
 "EXECIO * DISKW INCR (FINIS STEM INCR.";
 "EXECIO * DISKW REST (FINIS STEM REST.";
END;
 "EXECIO * DISKW INIT (FINIS STEM INIT.";
END ZZ;
"EXECIO * DISKW SUMM (FINIS STEM SUMM.";
EXIT 0;
