/*  REXX EXEC : ( CCFREPRT )
    FUNCTION  : GENERATE CCF TURNOVER REPORT BY DATE AND MODULE TYPE.
    INPUT     : ( SYSS.CCF.TURNOVER.JOURNAL(&&MEMBER)).
    OUTPUT    : ( SYSS.CCF.TURNOVER.REPORT ).
                                                                      */
/*     */
HOUSE_KEEPING:
ADDRESS TSO
PARMS = 'WONUMBR'
SAY "WHAT DATE WOULD YOU LIKE TO GO BACK TO"
SAY "ENTER JULIAN DATE IN FORMAT YYDDD"
PARSE PULL 'J'FROMDATE
SAY "ENTER THE MEMBER NAME YOU WOULD LIKE TO SEARCH FOR"
PARSE PULL MODNAME
JOURNAL_PDS = 'TECH209.CCF.TEST.EXECL'
CALL GET_JOURNAL_MEMBER_LIST
CALL READ_JOURNAL_MEMBER
EXIT
/*   S U B R O U T I N E   S E C T I O N   */
/*     */
GET_JOURNAL_MEMBER_LIST:
X = OUTTRAP("MEMBER.","*","CONCAT")
"LISTDS ('"JOURNAL_PDS"') MEMBERS"
SRC = RC
IF SRC = 0 THEN RETURN
SAY
SAY '*** LISTDS ERROR: ERROR READING ('JOURNAL_PDS') MEMBER LIST. ***'
SAY '*** CCFREPRT EXEC SUBTASK CANCELLED RC = ('SRC'). ***'
EXIT SRC

/*     */
READ_JOURNAL_MEMBER:
DO M = 7 TO MEMBER.0      /* SKIP LISTDS HEADER INFO - START AT RCD 7 */
   MEMBER = STRIP(MEMBER.M)
   IF MEMBER < FROMDATE THEN ITERATE
/* SAY '+++ PROCESSING JOURNAL MEMBER: ('MEMBER') +++' */
   "ALLOC DA('"JOURNAL_PDS"("MEMBER")') F(JOURDD) SHR"
   "EXECIO * DISKR JOURDD (FINIS STEM DATA."
   "FREE FILE(JOURDD)"
   DO I = 3 TO DATA.0    /* SKIP JOURNAL MEMBER HEADER INFO - START AT RCD 3 */
      PARSE VAR DATA.I PDATE PTIME WORKORDR PROGRAMMER MASTER MODULE MODTYPE
         IF MODULE \= MODNAME THEN ITERATE
           WONUMBR = WORKORDR
           CALL READ_MEMBER_AGAIN
           LEAVE
   END
END
RETURN
/*     */
READ_MEMBER_AGAIN:
   DO I = 3 TO DATA.0    /* SKIP JOURNAL MEMBER HEADER INFO - START AT RCD 3 */
      PARSE VAR DATA.I PDATE PTIME WORKORDR PROGRAMMER MASTER MODULE MODTYPE
         IF WORKORDR \= WONUMBR THEN ITERATE
SAY ''WORKORDR' - 'MODULE' - 'PDATE' - 'PROGRAMMER''
END
RETURN
