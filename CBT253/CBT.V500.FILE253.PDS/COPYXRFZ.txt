/* REXX EXEC TO LIST COPYBOOK TO SOURCE MEMBER XREF VIA PANELS */
ADDRESS TSO
BLANK = " "
DO FOREVER
  ADDRESS ISPEXEC "DISPLAY PANEL(XREFPANL)"
  SRC = RC
  IF SRC = 0 THEN LEAVE
  IF SRC = 8 THEN LEAVE
  IF SRC > 8 THEN DO
    SAY '*** ERROR INVOKING ISPF DIALOG XREFPANL - RC  'SRC'.***'
    SAY '*** COPYXREF EXEC CANCELLED - RETURN CODE:  ('SRC'). ***'
    EXIT SRC
  END
END
"ALLOC DA('SYS1.TECH.LIBRSCAN.OUT.SORTED') F(INDD) SHR"
SCR = RC
IF SRC /= 0 THEN DO
   SAY '*** ERROR ALLOCATING INPUT DATASET - RC  'SRC'. ***'
   EXIT SRC
   END
"EXECIO * DISKR INDD (FINIS STEM DATA."
COUNT = 0
J = 1
DO I = 1 TO DATA.0
   FULLINE = DATA.I
   SOURCE_MEMBER = WORD(FULLINE,1)
   COPYBK = WORD(FULLINE,2)
   IF COPYBK > COPYBOOK THEN LEAVE
   IF COPYBK = COPYBOOK THEN DO
      COUNT = COUNT + 1
      MEMBER.J = SOURCE_MEMBER
      J = J + 1
      END
 END I
 J = J - 1
 IF COUNT = 0 THEN DO
    SAY 'NO HITS'
    "EXECIO 0 DISKR INDD (FINIS"
    "FREE F(INDD)"
    EXIT 99
 END

 /*    INITIALIZE SLOTS FOR DISPLAY  */
 DO L = 1 TO 112
 INTERPRET MEM||L '=' BLANK
 END L
 /*   COPY MEMBER.X VALUES TO MEMX VARIABLES  - NEEDED FOR PANELS */
 DO K = 1 TO J
 INTERPRET MEM||K '=' LEFT(MEMBER.K,8)
 END K

DO FOREVER
  ADDRESS ISPEXEC "DISPLAY PANEL(XREFPNL1)"
  SRC = RC
  IF SRC = 0 THEN LEAVE
  IF SRC = 8 THEN LEAVE
  IF SRC > 8 THEN DO
     SAY '*** ERROR INVOKING ISPF DIALOG XREFPNL1 - RC  'SRC'.***'
     SAY '*** COPYXREF EXEC CANCELLED - RETURN CODE:  ('SRC'). ***'
     EXIT SRC
   END
END
MULTIPLE_OF_ONE12 = 0
LOOPTOP:
MULTIPLE_OF_ONE12 = MULTIPLE_OF_ONE12 + 112
IF J < 113 THEN SIGNAL ENDPROC
J = J - 112
DO L = 1 TO 112
INTERPRET MEM||L '=' BLANK
END L
DO K = 1 TO J
M = K + MULTIPLE_OF_ONE12
INTERPRET MEM||K '=' LEFT(MEMBER.M,8)
END K
DO FOREVER
  ADDRESS ISPEXEC "DISPLAY PANEL(XREFPNL1)"
  SRC = RC
  IF SRC = 0 THEN LEAVE
  IF SRC = 8 THEN LEAVE
  IF SRC > 8 THEN DO
     SAY '*** ERROR INVOKING ISPF DIALOG XREFPNL1 - RC  'SRC'.***'
     SAY '*** COPYXREF EXEC CANCELLED - RETURN CODE:  ('SRC'). ***'
     EXIT SRC
   END
END
SIGNAL LOOPTOP

ENDPROC:
 "EXECIO 0 DISKR INDD (FINIS"
 "FREE F(INDD)"
 EXIT 0
