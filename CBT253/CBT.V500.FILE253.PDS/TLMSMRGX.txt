/* REXX TLMS REPORT MERGE */
TRUE = "1";
FALSE = "0";
"EXECIO * DISKR TLMSIN  (FINIS STEM TLMSIN.";
RINDEX=0;
DO INDEX=1 TO TLMSIN.0; /* FIND RETENTION RCD */
    PARSE VAR TLMSIN.INDEX DSN 45 RTYPE 46 REST;
    IF RTYPE="B" THEN ITERATE;
    RDSN=STRIP(DSN);
    RINDEX=INDEX; /* SAVE INDEX TO R */
    RREST=STRIP(REST); /* SAVE */
    LEAVE INDEX;
END;
DO INDEX = 1 TO TLMSIN.0;
    PARSE VAR TLMSIN.INDEX DSN 45 RTYPE 46 REST;
    IF RTYPE="B" THEN DO;
         KEEPDATE=SUBSTR(TLMSIN.INDEX,65,8);
         IF POS("/",KEEPDATE)=0 THEN KEEPDATE="N.A.";
         TLMSOUT.1=SUBSTR(TLMSIN.INDEX,1,64);
IF RINDEX<INDEX THEN DO;
RINDEX=0;
DO IX=INDEX TO TLMSIN.0; /* FIND RETENTION RCD */
    PARSE VAR TLMSIN.IX XDSN 45 XRTYPE 46 XREST;
    IF XRTYPE="B" THEN ITERATE IX;
    RDSN=STRIP(XDSN);
    RINDEX=IX; /* SAVE INDEX TO R */
    RREST=STRIP(XREST); /* SAVE */
    LEAVE IX;
END;
END;
       DSN=STRIP(DSN);
       IF ABBREV(DSN,RDSN)=1 THEN ,
            TLMSOUT.1=TLMSOUT.1||RREST;
         ELSE TLMSOUT.1=TLMSOUT.1||COPIES("-",21);
         TLMSOUT.1=TLMSOUT.1||LEFT(KEEPDATE,8);
       "EXECIO 1 DISKW TLMSOUT (STEM TLMSOUT.";
END;
END;
"EXECIO 0 DISKW TLMSOUT (FINIS";
EXIT 0;
