IKJEXIT TITLE 'TSO/E RELEASE 4 INSTALLATION EXIT EXAMPLE'
IKJEXIT CSECT ,
        PRINT NOGEN
IKJEXIT AMODE 31                     EXIT'S ADDRESSING MODE
IKJEXIT RMODE ANY                    EXIT'S RESIDENCY  MODE
 TITLE 'TSO/E RELEASE 4 INSTALLATION EXIT EXAMPLE PROLOGUE'
***********************************************************************
*                                                                     *
* MODULE NAME - IKJEXIT                                               *
*                                                                     *
* CSECT  NAME - IKJEXIT                                               *
*                                                                     *
* DESCRIPTIVE NAME - TSO/E INSTALLATION EXIT EXAMPLE                  *
*                                                                     *
* FUNCTION -                                                          *
*                                                                     *
*  THIS ROUTINE IS AN EXAMPLE OF HOW A TSO/E INSTALLATION EXIT        *
*  MIGHT BE CODED USING THE NEW TSO/E INSTALLATION EXIT               *
*  PARAMETER_ENTRY ARCHITECTURE.                                      *
*                                                                     *
*  THE PARTICULAR FUNCTION OF THIS ROUTINE IS TO TAKE THE STANDARD    *
*  TSO/E INSTALLATION EXIT PARAMETER LIST AND PERFORM THE FOLLOWING   *
*  FUNCTIONS:                                                         *
*                                                                     *
*   1). IDENTIFY EVERY PARAMETER_ENTRY BY ASSOCIATING A HEX NUMBER TO *
*       THE PARAMETER_ENTRY CURRENTLY BEING PROCESSED.                *
*       (I.E. THE OUTPUT FOR PARAMETER_ENTRY 1 WOULD BE               *
*             "PARAMETER_ENTRY_01" OR "PE01")                         *
*                                                                     *
*   2). DISPLAY THE DATA ASSOCIATED WITH EACH PARAMETER_ENTRY FIELD.  *
*       (I.E. THE ACTUAL VALUES THAT ARE CONTAINED WITHIN THE         *
*             PARAMETER_ENTRY_KEY AND THE PARAMETER_ENTRY_LENGTH      *
*             FIELDS. THE VALUE FOR THE PARAMETER_ENTRY_DATA FIELD    *
*             ALWAYS DESCRIBES THE BEGINNING ADDRESS OF WHERE THE     *
*             DATA ACTUALLY RESIDES.)                                 *
*                                                                     *
*   3). DETECTS ERRORS ASSOCIATED WITH THE PARAMETER_ENTRY_KEY AND    *
*       PARAMETER_ENTRY_LENGTH FIELDS OF THE PARAMETER_ENTRY.         *
*       IF ANY ERRORS ARE FOUND, INFORMATIONAL ERROR MESSAGES         *
*       ARE DISPLAYED.                                                *
*                                                                     *
*  *******************                                                *
*  ***             ***                                                *
*  ***    NOTE     ***                                                *
*  ***             ***                                                *
*  *******************                                                *
*                                                                     *
*      FOR A DESCRIPTION OF THE:                                      *
*                                                                     *
*      PARAMETER_ENTRY                                                *
*      PARAMETER_ENTRY_KEY                                            *
*      PARAMETER_ENTRY_LENGTH                                         *
*      PARAMETER_ENTRY_DATA                                           *
*                                                                     *
*      PLEASE REFER TO INPUT SECTION OF THIS PROLOGUE.                *
*                                                                     *
*  *******************                                                *
*  ***             ***                                                *
*  *** END OF NOTE ***                                                *
*  ***             ***                                                *
*  *******************                                                *
*                                                                     *
* OPERATION - IKJEXIT PERFORMS THE FOLLOWING FUNCTION:                *
*                                                                     *
*    1 - ESTABLISHES SAVE AREA TO CALLING PROGRAM                     *
*    2 - SAVES PARAMETER POINTER (R1)                                 *
*    3 - DOES A GETMAIN FOR PROGRAM'S SAVE AREA                       *
*    4 - CHAINS THE CALLER'S SAVE AREA AND THIS SAVE AREA             *
*    5 - DOES A GETMAIN FOR PROGRAM'S WORK AREA                       *
*    6 - DETERMINES WHETHER TO USE PUTLINE OR WTO                     *
*    7 - HEX FORMATS THE PARAMETER ENTRIES                            *
*    8 - IDENTIFIES THE HEX PARAMETER ENTRIES                         *
*    9 - PRINTS ALL OF THE PARAMETER ENTRIES VIA PUTLINE OR WTO       *
*   10 - DOES A FREEMAIN OF DYNAMIC STORAGE                           *
*   11 - DOES A FREEMAIN OF DYNAMIC SAVE AREA                         *
*   12 - LOADS REGISTER 14 WITH RETURN ADDRESS                        *
*   13 - SETS THE RETURN CODE IN REGISTER 15 (ALWAYS RC=0)            *
*   14 - LOADS REGISTERS R0 - R12 WITH CALLER'S ENTRY CONTENTS        *
*   15 - RETURNS TO CALLER                                            *
*                                                                     *
* RECOVERY OPERATION -                                                *
*                                                                     *
*          MUST BE ESTABLISHED BY INVOKER OF IKJEXIT                  *
*                                                                     *
* NOTES                                                               *
*                                                                     *
*                                                                     *
* DEPENDENCIES - MAY ONLY BE ASSEMBLED WITH ASSEMBLER H               *
*                                                                     *
* RESTRICTIONS - THIS EXAMPLE TSO/E INSTALLATION EXIT IS VALID        *
*                ONLY FOR THE NEW TSO/E INSTALLATION EXITS            *
*                THAT HAVE BEEN INTRODUCED IN THE TSO/E RELEASE       *
*                4 PRODUCT.                                           *
*                                                                     *
*                PLEASE REFER TO THE TSO/E CUSTOMIZATION MANUAL       *
*                FOR INFORMATION REGARDING THESE TSO/E INSTALLATION   *
*                EXITS.                                               *
*                                                                     *
* ERROR MESSAGES - NONE                                               *
*                                                                     *
* ABEND CODES - NONE                                                  *
*                                                                     *
* ERROR CONDITIONS - NONE                                             *
*                                                                     *
* LINKAGES: BRANCHED TO VIA BALR OR LINKED TO                         *
*                                                                     *
* MODULE(S) CALLED: NONE                                              *
*                                                                     *
* ENTRY POINT - IKJEXIT                                               *
*                                                                     *
* EXIT CONDITIONS                                                     *
*                                                                     *
*        EXIT IS ACCOMPLISHED VIA BSM                                 *
*                                                                     *
* REFERENCES                                                          *
*                                                                     *
*        ROUTINES   - NONE                                            *
*                                                                     *
*        DATA AREAS - NONE                                            *
*                                                                     *
*    CONTROL BLOCKS - CVT,                                            *
*                     IKJTSVT,                                        *
*                     IKJCPPL,                                        *
*                     IKJIOPL                                         *
*                                                                     *
*        TABLES     - NONE                                            *
*                                                                     *
* GLOBALS:                                                            *
*                                                                     *
*       NONE                                                          *
*                                                                     *
 TITLE 'MACROS IKJEXIT ISSUES'
* MACRO USAGE: SAVE,                                                  *
*              GETMAIN,                                               *
*              FREEMAIN,                                              *
*              PUTLINE,                                               *
*              WTO                                                    *
*                                                                     *
 TITLE 'IKJEXIT MODULE ATTRIBUTES'
* MODULE ATTRIBUTES - REENTRANT,                                      *
*                     REFRESHABLE,                                    *
*                     REUSEABLE,                                      *
*                     AMODE(ANY),                                     *
*                     RMODE(31),                                      *
*                     MAY BE LINKED AC=1                              *
*                                                                     *
 TITLE 'INPUT REQUIREMENTS TO IKJEXIT'
* INPUT - ON ENTRY TO IKJEXIT R1 MUST POINT TO A VARIABLE LENGTH      *
*         PARAMETER LIST THAT DESCRIBES A PARAMETER_ENTRY LIST.       *
*                                                                     *
*         THE HIGH ORDER BIT IN THE LAST PARAMETER                    *
*         OF THE PARAMETER LIST MUST BE ON                            *
*         X'80000000' TO INDICATE THE END OF THE LIST.                *
*                                                                     *
 TITLE 'TSO/E STANDARD INSTALLATION EXIT PARAMETER_ENTRY '
*                                                                     *
*             PARAMETER_ENTRY                                         *
*                                                                     *
*             FIELD  FIELD   FIELD                                    *
*                                                                     *
*     P       P      P       P                                        *
*     A       A      A       A                                        *
*     R       R E    R E L   R E                                      *
*     A       A N K  A N E   A N D                                    *
*     M       M T E  M T N   M T A                                    *
*     E L     E R Y  E R G   E R T                                    *
*     T I     T Y    T Y T   T Y A                                    *
*     E S     E      E   H   E              +0                        *
*  R1 R T     R      R       R              +------------+            *
*   |                            +--------->|  DATA      |            *
*   V         +0    +4       +8  |          +------------+            *
* +--------+  +-----+--------+---+---------+                          *
* | PARM1  |->| KEY | LENGTH | PTR TO DATA |                          *
* +--------+  +-----+--------+---------/ /--------------------------+ *
* | PARM2  |->| KEY | LENGTH | DATA   / / DATA                      | *
* +--------+  +-----+--------+-------/ /----------------------------+ *
* | PARM3  |->| KEY | LENGTH | DATA   / / DATA                      | *
* +--------+  +-----+--------+-------/ /----------------------------+ *
* | PARM4  |->| KEY | LENGTH | DATA   / / DATA                      | *
* +--------+  +-----+--------+-------/ /----------------------------+ *
* | PARM5  |->| KEY | LENGTH | DATA   / / DATA                      | *
* +--------+  +-----+--------+-------/ /----------------------------+ *
* | PARM6  |->| KEY | LENGTH | DATA   / / DATA                      | *
* +--------+  +-----+--------+-------/ /----------------------------+ *
* | PARM7  |->| KEY | LENGTH | DATA   / / DATA                      | *
* +--------+  +-----+--------+-------/ /----------------------------+ *
*     .                                                               *
*     .                                                               *
*     .                                                               *
*     .                                                               *
* +--------+  +-----+--------+-------/ /----------------------------+ *
* | PARMZZ |->| KEY | LENGTH | DATA   / / DATA                      | *
* +--------+  +-----+--------+-------/ /----------------------------+ *
* |8XXXXXXX|->| KEY | LENGTH | DATA   / / DATA                      | *
* +A-------+  +-----+--------+-------/ /----------------------------+ *
*  |                                                                  *
*  8 INDICATES END OF PARAMETER LIST                                  *
*                                                                     *
 TITLE 'OUTPUT GENERATED BY IKJEXIT'
* OUTPUT -                                                            *
*                                                                     *
*  THE OUTPUT OF THIS TSO/E INSTALLATION EXIT EXAMPLE IS:             *
*                                                                     *
*  IKJEXIT                                                            *
*                                                                     *
*  PARAMETER_ENTRY_ZZ IS AT -> X..X  (ADDRESS OF WHERE THE            *
*                                    PARAMETER_ENTRY STARTS)          *
*                                                                     *
*  PE_ZZ KEY -> X..X LENGTH OF DATA -> X..X ADDRESS OF DATA -> X..X   *
*  DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1           *
*         +00000010  40C6D6D9  40E3C8C9  E340C5E7  C1D4D7D3           *
*         +00000020  C5                                               *
*                                                                     *
*       .                                                             *
*       .                                                             *
*       .                                                             *
*       .                                                             *
*                                                                     *
*                                                                     *
*  PARAMETER_ENTRY_ZZ IS AT -> X..X  (ADDRESS OF WHERE THE            *
*                                    PARAMETER_ENTRY STARTS)          *
*                                                                     *
*  PE_ZZ KEY -> X..X LENGTH OF DATA -> X..X ADDRESS OF DATA -> X..X   *
*  DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1           *
*         +00000010  40C6D6D9  40E3C8C9  E340C5E7  C1D4D7D3           *
*         +00000020  C5                                               *
*                                                                     *
*                                                                     *
         EJECT
*  *******************                                                *
*  ***             ***                                                *
*  ***    NOTE     ***                                                *
*  ***             ***                                                *
*  *******************                                                *
*                                                                     *
*    THE ZZ FIELDS IN THE ABOVE EXAMPLE OUTPUT WOULD INDICATE         *
*    WHICH PARAMETER_ENTRY IS CURRENTLY BEING DISPLAYED.              *
*                                                                     *
*    THE ZZ FIELDS WILL START AT "01" AND CONTINUE THROUGH "FF".      *
*    IF THERE ARE MORE THAN 255 PARAMETER ENTRIES, THE ZZ FIELD       *
*    WILL START OVER AT 00.                                           *
*                                                                     *
*    THE X..X FIELDS WILL BE  FULL WORDS IN ALL CASES                 *
*                                                                     *
*    PARAMETER_ENTRY_KEY                                              *
*    VALUE      MEANING                                               *
*                                                                     *
*    00000000 - THE INSTALLATION EXIT DID NOT PASS ANY DATA FOR       *
*               THIS INSTALLATION EXIT PARAMETER_ENTRY.               *
*                                                                     *
*    00000001 - DATA BEGINS AT THIS PARAMETER_ENTRY_DATA FIELD        *
*               AND CONTINUES CONTIGUOUSLY FOR A LENGTH AS            *
*               DESCRIBED BY THE PARAMETER_ENTRY_LENGTH FIELD         *
*                                                                     *
*    00000002 - DATA IS POINTED TO FROM THE PARAMETER_ENTRY_DATA      *
*               FIELD AND CONTINUES CONTIGUOUSLY FOR A LENGTH AS      *
*               DESCRIBED BY THE PARAMETER_ENTRY_LENGTH FIELD         *
*                                                                     *
*    00000003 - SPECIAL KEY. ONLY VALID FOR SOME SELECTED TSO/E       *
*               INSTALLATION EXITS. SEE THE TSO/E CUSTOMIZATION       *
*               MANUAL FOR INFORMATION REGARDING THE USAGE OF         *
*               THIS KEY.                                             *
*                                                                     *
*    IN THE EXAMPLE OUTPUT IN THE PROLOGUE THE                        *
*                                                                     *
*    PARAMETER_ENTRY_KEY COULD BE EITHER A '00000001' OR A            *
*    '00000002'                                                       *
*                                                                     *
*    PARAMETER_ENTRY_LENGTH WOULD CONTAIN THE VALUE '00000021'        *
*                                                                     *
* AND THE ACTUAL DATA WOULD BE:                                       *
*                                                                     *
*                                                                     *
*          "THIS IS THE DATA FOR THIS EXAMPLE"                        *
*                                                                     *
* IF AN ERROR FOR THE PARAMETER_ENTRY_KEY OR THE                      *
* PARAMETER_ENTRY_LENGTH FIELD IS DETECTED, THE PARAMETER_ENTRY_KEY,  *
* PARAMETER_ENTRY_LENGTH AND THE PARAMETER_ENTRY_DATA VALUES WILL BE  *
* FORMATTED AS DESCRIBED ABOVE.                                       *
*                                                                     *
* IKJEXIT STOPS PROCESSING OF THE "DATA +00000000" MESSAGES AND       *
* DISPLAYS INFORMATIONAL MESSAGES.  IKJEXIT THEN PROCESSES THE NEXT   *
* PARAMETER_ENTRY, IF ONE IS AVAILABLE.                               *
*                                                                     *
*  *******************                                                *
*  ***             ***                                                *
*  *** END OF NOTE ***                                                *
*  ***             ***                                                *
*  *******************                                                *
*                                                                     *
  TITLE 'CHANGE ACTIVITY FOR IKJEXIT'
*                                                                     *
* CHANGE ACTIVITY:                                                    *
*                                                                     *
*      INTRODUCED IN TSO/E RELEASE 4 HTE1402                          *
*                                                                     *
* OY19583 - FIX &SYSDATE SO THE EXIT WILL ASSEMBLE USING THE          *
*           REQUIRED ASSEMBLERH. FIX A LOGIC ERROR IN THE EXIT        *
*           THAT CAUSES AN ABEND0C4.                          @YA19583*
*                                                                     *
* OY19658 - AT LABEL GOT_CPPLECT CHANGE CPPLUPT TO CPPLECT    @YA19658*
*                                                                     *
***********************************************************************
 TITLE 'REGISTER EQUATES'
***********************************************************************
* REGISTER EQUATES FOLLOW                                             *
***********************************************************************
*     REGISTER EQUATES AND USAGE                                      *
*                                                                     *
         SPACE 3
R0       EQU   0                     UNPREDICTABLE
R1       EQU   1                     ON ENTRY R1 POINTS TO THE
*                                    PARAMETER LIST. AT OTHER TIMES
*                                    THE VALUE OF R1 IS UNPREDICTABLE
R2       EQU   2                     UNPREDICTABLE
R3       EQU   3                     UNPREDICTABLE
R4       EQU   4                     UNPREDICTABLE
R5       EQU   5                     UNPREDICTABLE
R6       EQU   6                     UNPREDICTABLE
R7       EQU   7                     UNPREDICTABLE
R8       EQU   8                     UNPREDICTABLE
R9       EQU   9                     UNPREDICTABLE
R10      EQU   10                    OUTPUT BUFFER
R11      EQU   11                    DATA AREA BASE REGISTER
R12      EQU   12                    CODE AREA BASE REGISTER
R13      EQU   13                    SAVE AREA BASE REGISTER
R14      EQU   14                    RETURN ADDRESS
R15      EQU   15                    RETURN CODE
 TITLE 'COMMON EQUATES  '
***********************************************************************
* COMMON EQUATES USED THROUGHOUT THIS MODULE FOLLOW                   *
***********************************************************************
         SPACE 3
ISSUE_PUTLINE_INDICATOR    EQU   X'00'  INDICATES TO USE PUTLINE TO
*                                       DISPLAY MESSAGES
GOOD_KEY_INDICATOR         EQU   X'00'  INDICATES THAT A VALID
*                                       KEY HAS BEEN FOUND OR ASSUMED
*                                       FOR THIS PARAMETER_ENTRY
*                                       PARAMETER_ENTRY_KEY FIELD
BAD_KEY_INDICATOR          EQU   X'01'  INDICATES THAT AN INVALID
*                                       OR UNDEFINED KEY WAS FOUND IN
*                                       PARAMETER_ENTRY_KEY FIELD
ISSUE_WTO_INDICATOR        EQU   X'02'  INDICATES TO USE WTO TO DISPLAY
*                                       MESSAGES
BLANK                      EQU   X'40'
PLUS_SIGN                  EQU   X'4E'  +
HEX54                      EQU   X'54'
*                                       LENGTH OF MESSAGE TO BE PUT
*                                       INTO PTPB
HEX80                      EQU   X'80'
*                                       USED TO SEE IF THE BIT IS ON
*                                       FOR THE LENGTH AND THE
*                                       PARAMETER LIST
 TITLE 'ENTRY CODE      '
***********************************************************************
* IKJEXIT ENTRY CODE                                                  *
*                                                                     *
* DESCRIPTIVE NAME - STANDARD ENTRY LINKAGE CODE ROUTINE              *
*                                                                     *
* FUNCTION - ESTABLISHES STANDARD LINKAGE BETWEEN PROGRAMS            *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*    1).  PERFORMS STANDARD LINKAGE BETWEEN INVOKER OF EXIT AND       *
*         EXIT.                                                       *
*    2).  OBTAINS A DYNAMIC SAVE AREA FOR THE EXIT AND                *
*         ESTABLISHES THIS AS THE SAVE AREA FOR THE EXIT              *
*    3).  OBTAINS EXIT'S DYNAMIC WORK AREA STORAGE AND                *
*         ESTABLISHES THIS AS THE WORK AREA FOR THE EXIT              *
*                                                                     *
***********************************************************************
IKJEXIT CSECT
         ENTRY IKJEXIT
         SAVE  (14,12),,IKJEXIT____TSO/E_INSTALLATION_EXIT_EXAMPLE_____X
               _____________________________________________&SYSDATE.__X
               &SYSTIME              BUILD MODULE ID EYE CATCHER
*                                                              @YA19583
         LR    R12,R15
*                                    LOAD R12 TO CONTAIN THE
*                                    ENTRY POINT ADDRESS OF IKJEXIT
*
         USING IKJEXIT,R12
*                                    ESTABLISH R12 TO BE THE
*                                    PROGRAM'S BASE CODE REGISTER
*
         LR    R2,R1
*                                    SAVE THE ADDRESS OF THE PARAMETER
*                                    LIST
*
         GETMAIN RU,LV=L_SAVE_AREA,LOC=(BELOW,ANY)
*                                    OBTAIN A DYNAMIC SAVE AREA
*                                    FOR IKJEXIT AND MAKE SURE
*                                    THE SAVE AREA IS BELOW 16
*                                    MEGABYTES IN VIRTRUAL STORAGE
*
         ST    R13,4(,R1)
*                                    SAVE THE ADDRESS OF THE INVOKER'S
*                                    SAVE AREA INTO IKJEXIT'S DYNAMIC
*                                    SAVE AREA
*
         ST    R1,8(,R13)
*                                    SAVE THE ADDRESS OF IKJEXIT'S
*                                    SAVE AREA INTO THE INVOKER'S
*                                    SAVE AREA
*
         LR    R13,R1
*                                    LOAD THE ADDRESS OF IKJEXIT'S
*                                    DYNAMIC SAVE AREA INTO R13
*                                    FOR POSSIBLE NEXT CALLER'S USE
*
         USING SAVE_AREA,R13
*                                    ESTABLISH ADDRESSABILITY TO
*                                    IKJEXIT'S SAVE AREA SO THAT THE
*                                    LABELS WITHIN THE SAVE AREA
*                                    CAN BE USED IF NEEDED
*
         GETMAIN RU,LV=TLEN,LOC=(BELOW,ANY),SP=1
*                                    OBTAIN THE DYNAMIC WORK AREA
*                                    FOR IKJEXIT IN SUBPOOL 1 AND
*                                    MAKE SURE IT IS BELOW 16
*                                    MEGABYTES IN VIRTRUAL STORAGE
*
         LR    R11,R1
*                                    LOAD THE ADDRESS OF THE DYNAMIC
*                                    WORK AREA INTO R11 FOR IKJEXIT'S
*                                    USE
*
         USING WORKA,R11
*                                    AND ESTABLISH ADDRESSABILITY
*                                    TO THE DYNAMIC WORK AREA SO THAT
*                                    THE LABELS WITHIN THE WORK AREA
*                                    CAN BE ADDRESSED
*
         ST    R1,GM_PTR
*                                    SAVE THE ADDRESS OF IKJEXIT'S
*                                    DYNAMIC SAVE AREA FOR LATER USE
*
         ST    R2,R1_ENTRY_PARAMETER_LIST_PTR
*                                    SAVE THE ADDRESS OF THE PARAMETER
*                                    LIST THAT THE INVOKER OF IKJEXIT
*                                    PASSED IN FOR LATER USE
*
         MVC   WORK_AREA_ID,WORKAREA_ID_CONSTANT
*                                    PUT INTO THE FIRST 8 POSITIONS OF
*                                    THE IKJEXIT'S DYNAMIC WORK AREA
*                                    THE CHARACTERS "WORKAREA" SO THAT
*                                    IT CAN BE EASILY FOUND IN A DUMP
*
 TITLE 'INITIALIZATION CODE'
***********************************************************************
*                                                                     *
* INITIALIZATION ROUTINE                                              *
*                                                                     *
* DESCRIPTIVE NAME - INITIALIZATION  CODE                             *
*                                                                     *
* FUNCTION - INITIALIZES THE DYNAMIC STORAGE AREA                     *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*                                                                     *
*    1).  ENSURES THE RETURN CODE FROM THE EXIT WILL BE ZERO          *
*    2).  ALLOCATES THE DYNAMIC SAVE AREA INTO CONTROL BLOCK          *
*         AREAS AND EXIT WORK AREA                                    *
*    3).  CLEARS THE MESSAGE LINE                                     *
*    4).  BUILDS A COPY OF THE CPPL                                   *
*    5).  DETERMINES WHETHER TO ISSUE PUTLINE OR WTO TO DISPLAY       *
*         FORMATTED DATA TO USER                                      *
*    6).  FALLS INTO PROCESS_EXIT_PARAMETERS                          *
*                                                                     *
***********************************************************************
         SPACE 3
         XC    RETCODE,RETCODE
*                                    INITIALIZE THE RETURN CODE.
*                                    IKJEXIT WILL ALWAYS RETURN
*                                    A RETURN CODE OF ZERO TO THE
*                                    INVOKER.
*
         LR    R3,R11
*                                    LOAD REGISTER 3 TO CONTAIN THE
*                                    ADDRESS OF IKJEXIT'S DYNAMIC WORK
*                                    AREA THAT WAS OBTAINED BY GETMAIN.
*
         LA    R4,CPPL_START
*                                    OBTAIN THE OFFSET INTO IKJEXIT'S
*                                    DYNAMIC WORK AREA WHERE THE
*                                    CPPL IS TO BE DEFINED
*
         AR    R4,R3
*                                    ADD TO THE OFFSET THE BEGINNING
*                                    ADDRESS OF WHERE IKJEXIT'S
*                                    DYNAMIC WORK AREA IS AT
*
         ST    R4,CPPL_PTR
*                                    AND STORE THE ADDRESS INTO THE
*                                    CPPL_POINTER SO THAT WE CAN
*                                    EASILY LOCATE THE CPPL CONTROL
*                                    BLOCK NEXT TIME
*
         LA    R4,IOPL_START
*                                    OBTAIN THE OFFSET INTO IKJEXIT'S
*                                    DYNAMIC WORK AREA WHERE THE
*                                    IOPL IS TO BE DEFINED
*
         AR    R4,R3
*                                    ADD TO THE OFFSET THE BEGINNING
*                                    ADDRESS OF WHERE IKJEXIT'S
*                                    DYNAMIC WORK AREA IS AT
*
         ST    R4,IOPL_PTR
*                                    AND STORE THE ADDRESS INTO THE
*                                    IOPL_POINTER SO THAT WE CAN
*                                    EASILY LOCATE THE IOPL CONTROL
*                                    BLOCK NEXT TIME
*
         LA    R4,WTO_START
*                                    OBTAIN THE OFFSET INTO IKJEXIT'S
*                                    DYNAMIC WORK AREA WHERE THE
*                                    WTO CONTROL BLOCK IS TO BE
*                                    DEFINED  AND
*
         AR    R4,R3
*                                    ADD TO THE OFFSET THE BEGINNING
*                                    ADDRESS OF WHERE IKJEXIT'S
*                                    DYNAMIC WORK AREA IS AT
*
         ST    R4,WTO_LIST_PTR
*                                    AND STORE THE ADDRESS INTO THE
*                                    WTO_LIST_PTR SO THAT WE CAN
*                                    EASILY LOCATE THE WTO CONTROL
*                                    BLOCK NEXT TIME
*
         LA    R4,4(,R4)
*                                    IDENTIFY WHERE THE
*                                    TEXT AREA FOR THE DYNAMIC WTO
*                                    IS LOCATED WITHIN IKJEXIT'S
*                                    DYNAMIC WORK AREA SO THAT IF
*                                    IT IS
*
         ST    R4,WTO_TEXT_PTR
*                                    NECESSARY TO ISSUE A WTO THE
*                                    WTO MESSAGE AREA IS EASY TO
*                                    LOCATE
*
         L     R1,R1_ENTRY_PARAMETER_LIST_PTR
*                                    LOAD R1 TO CONTAIN THE ADDRESS
*                                    OF THE PARAMETER LIST THAT
*                                    THE INVOKER OF IKJEXIT PASSED
*                                    IN
*
         MVI   MSG_TEXT,BLANK
*                                    PLACE A SPACE INTO THE FIRST
*                                    POSITION OF THE MESSAGE OUTPUT
*                                    BUFFER
*
         MVC   MSG_TEXT+1(L'MSG_TEXT-1),MSG_TEXT
*                                    AND PROPAGATE THE BLANK ACROSS
*                                    THE REST OF THE MESSAGE OUTPUT
*                                    BUFFER IF THERE WAS ANY
*                                    RESIDUAL DATA IN THE OUTPUT
*                                    BUFFER
*
         L     R2,0(,R1)
*                                    LOAD R2 TO CONTAIN THE ADDRESS
*                                    OF THE FIRST PARAMETER_ENTRY
*
         USING PARAMETER_ENTRY,R2
*                                    AND ESTABLISH ADDRESSABILITY TO
*                                    THE PARAMETER_ENTRY DSECT SO THAT
*                                    THE LABELS WITHIN THE DSECT CAN
*                                    BE REFERENCED
*
         L     R3,CPPL_PTR
*                                    LOAD R3 TO CONTAIN THE ADDRESS OF
*                                    THE CPPL THAT WE DEFINED EARLIER
*
         USING CPPL,R3
*                                    ESTABLISH ADDRESSABILITY TO THE
*                                    CPPL CONTROL BLOCK SO THAT THE
*                                    LABELS WITHIN THE CPPL CAN BE
*                                    REFERENCED
*
         MVC   CPPLCBUF,PARAMETER_ENTRY_DATA
*                                    MOVE INTO THE CPPLCBUF FIELD OF
*                                    THE CPPL, THE CPPLCBUF ADDRESS
*                                    THE INVOKER PASSED IN THE
*                                    PARAMETER_ENTRY_DATA FIELD
*
         L     R2,8(,R1)
*                                    LOAD R2 TO CONTAIN THE ADDRESS OF
*                                    THE THIRD PARAMETER_ENTRY
*
         MVC   CPPLUPT,PARAMETER_ENTRY_DATA
*                                    MOVE INTO THE CPPLUPT FIELD OF
*                                    THE CPPL, THE CPPLUPT  ADDRESS
*                                    THE INVOKER PASSED IN THE
*                                    PARAMETER_ENTRY_DATA FIELD
*
         L     R2,12(,R1)
*                                    LOAD R2 TO CONTAIN THE ADDRESS OF
*                                    THE FOURTH PARAMETER_ENTRY
*
         MVC   CPPLECT,PARAMETER_ENTRY_DATA
*                                    MOVE INTO THE CPPLECT FIELD OF
*                                    THE CPPL, THE CPPLECT ADDRESS
*                                    THE INVOKER PASSED IN THE
*                                    PARAMETER_ENTRY_DATA FIELD
*
         L     R2,16(,R1)
*                                    LOAD R2 TO CONTAIN THE ADDRESS
*                                    OF THE FIFTH PARAMETER_ENTRY
*
         MVC   CPPLPSCB,PARAMETER_ENTRY_DATA
*                                    MOVE INTO THE CPPLPSCB FIELD OF
*                                    THE CPPL, THE CPPLPSCB ADDRESS
*                                    THE INVOKER PASSED IN THE
*                                    PARAMETER_ENTRY_DATA FIELD
*
         MVI   WTO_SWITCH,ISSUE_PUTLINE_INDICATOR
*                                    START BY ASSUMING THAT IKJEXIT
*                                    WAS INVOKED WITHIN AN ENVIRONMENT
*                                    WHERE THE PUTLINE MACRO IS VALID
*
         L     R4,CPPLPSCB
*                                    LOAD R4 TO CONTAIN THE CONTENTS
*                                    OF THE CPPLPSCB
*
         LTR   R4,R4
*                                    IF THE CPPLPSCB ADDRESS THAT THE
*                                    INVOKER PASSED IN IS NOT ZERO
*
         BNZ   GOT_CPPLECT
*                                    THEN ENSURE THAT A NON-ZERO
*                                    CPPLECT ADDRESS EXISTS
*
         MVI   WTO_SWITCH,ISSUE_WTO_INDICATOR
*                                    ELSE IKJEXIT WILL ASSUME THAT IT
*                                    HAS BEEN INVOKED IN AN ENVIRONMENT
*                                    WHERE PUTLINE MAY FAIL. IKJEXIT
*                                    WILL ISSUE WTOS TO THE MASTER
*                                    CONSOLE TO DISPLAY THE DATA
*
GOT_CPPLECT DS    0H
*
         L     R4,CPPLECT
*                                    LOAD R4 TO CONTAIN THE CONTENTS
*                                    OF THE CPPLPECT           @YA19658
*
         LTR   R4,R4
*                                    IF THE CPPLECT ADDRESS THE
*                                    INVOKER PASSED IN IS NOT ZERO
*
         BNZ   GOT_CPPLUPT
*                                    THEN INSURE THAT A NON ZERO
*                                    CPPLUPT ADDRESS EXISTS
*
         MVI   WTO_SWITCH,ISSUE_WTO_INDICATOR
*                                    ELSE IKJEXIT WILL ASSUME THAT
*                                    THAT IT HAS BEEN INVOKED IN AN
*                                    ENVIRONMENT WHERE PUTLINE MAY
*                                    FAIL. IKJEXIT WILL ISSUE WTOS
*                                    TO THE MASTER CONSOLE TO
*                                    DISPLAY THE DATA
*
GOT_CPPLUPT  DS    0H
*
         L     R4,CPPLUPT
*                                    LOAD R4 TO CONTAIN THE CONTENTS
*                                    OF THE CPPLUPT
*
* BFG    LTR   R4,R4
*                                    IF THE CPPLUPT ADDRESS THE
*                                    INVOKER PASSED IN IS NOT ZERO
*
* BFG    BNZ   PROCESS
*                                    THEN IKJEXIT IS IN AN ENVIRONMENT
*                                    WHERE PUTLINE WILL OPERATE
*                                    PROPERLY
*
         MVI   WTO_SWITCH,ISSUE_WTO_INDICATOR
*                                    ELSE IKJEXIT WILL ASSUME THAT
*                                    IT HAS BEEN INVOKED IN AN
*                                    ENVIRONMENT WHERE PUTLINE MAY
*                                    FAIL. IKJEXIT WILL ISSUE WTO'S
*                                    TO THE MASTER CONSOLE TO
*                                    DISPLAY THE DATA
*
         DROP R3
*                                    RELEASE ADDRESSABILITY TO THE
*                                    CPPL
 TITLE 'MAIN LINE CODE  '
***********************************************************************
*                                                                     *
* MAIN LINE CODE                                                      *
*                                                                     *
* DESCRIPTIVE NAME - CALL PROCESS_EXIT_PARAMETERS TO PROCESS ALL OF   *
*                    THE PARAMETERS PASSED TO THIS ROUTINE IN         *
*                    REGISTER 1.                                      *
*                                                                     *
*                                                                     *
* FUNCTION - STARTS THE PARAMETER_ENTRY PROCESSING PROCESS            *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*                                                                     *
*    1).  CALL PROCESS_EXIT_PARAMETERS                                *
*    2).  WHEN CONTROL IS RETURNED CONTROL FALLS INTO THE TERMINATION *
*         SUBROUTINE                                                  *
*                                                                     *
***********************************************************************
         SPACE 3
PROCESS  DS    0H
         BAL   R14,PROCESS_EXIT_PARAMETERS
 TITLE 'TERMINATION CODE'
***********************************************************************
*                                                                     *
* TERMINATION CODE....                                                *
*                                                                     *
* DESCRIPTIVE NAME - CLEANUP AND TERMINATION CODE                     *
*                                                                     *
* FUNCTION - RELEASES DYNAMIC STORAGE TO SYSTEM AND RETURNS TO        *
*            CALLER                                                   *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*                                                                     *
*    1).  LOADS UP REGISTER 5 WITH THE RETURN CODE                    *
*    2).  FREES THE DYNAMIC STORAGE WORK AREA                         *
*    3).  RELOADS THE ADDRESS OF THE CALLER'S SAVE AREA               *
*    4).  FREES THE DYNAMIC STORAGE SAVE AREA                         *
*    5).  RELOADS REGISTER 14 WITH THE RETURN ADDRESS                 *
*    6).  RELOADS REGISTER 15 WITH THE RETURN CODE                    *
*    7).  RELOADS REGISTERS 0 - 12 WITH ORIGINAL CONTENTS             *
*    8).  RETURNS TO CALLER VIA BSM                                   *
*                                                                     *
***********************************************************************
         SPACE 3
DONT_PROCESS DS 0H
*
         L     R5,RETCODE
*                                    LOAD R5 TO CONTAIN THE RETURN
*                                    CODE THAT IKJEXIT WILL RETURN
*                                    TO THE INVOKER.  THE RETURN
*                                    CODE WILL ALWAYS BE ZERO
*
         L     R1,GM_PTR
*                                    LOAD R1 TO CONTAIN THE ADDRESS
*                                    OF IKJEXIT'S DYNAMIC WORK AREA
*
         FREEMAIN RU,LV=TLEN,A=(1),SP=1
*                                    ISSUE FREEMAIN TO RELEASE
*                                    IKJEXIT'S DYNAMIC WORK AREA
*                                    STORAGE BACK TO THE SYSTEM
*
RETURN   DS    0H
*
         LR    R1,R13
*                                    LOAD R1 TO CONTAIN THE ADDRESS
*                                    OF IKJEXIT'S DYNAMIC SAVE AREA
*
         L     R13,4(,R13)
*                                    LOAD R13 TO CONTAIN THE ADDRESS
*                                    OF THE INVOKER'S SAVE AREA THAT
*                                    WAS PASSED TO IKJEXIT ON ENTRY
*
         FREEMAIN RU,LV=L_SAVE_AREA,A=(1)
*                                    ISSUE FREEMAIN TO RELEASE
*                                    IKJEXIT'S DYNAMIC SAVE AREA
*                                    STORAGE BACK TO THE SYSTEM
*
         L     R14,12(,R13)
*                                    LOAD R14 WITH THE ADDRESS OF THE
*                                    NEXT INSTRUCTION THAT THE INVOKER
*                                    WOULD HAVE EXECUTED IF IKJEXIT
*                                    HAD NOT BEEN INVOKED
*
         LR    R15,R5
*                                    LOAD R15 TO CONTAIN THE RETURN
*                                    CODE IKJEXIT WILL PRESENT BACK
*                                    TO THE INVOKER.  THE RETURN CODE
*                                    WILL ALWAYS BE ZERO
*
         LM    R0,R12,20(R13)
*                                    RESTORE THE INVOKER'S REGISTERS
*                                    BEFORE IKJEXIT RETURNS TO
*                                    THE INVOKER
*
         BSM   0,14
*                                    RETURN TO THE INVOKER OF IKJEXIT
*                                    AND RESET THE CALLER'S EXECUTION
*                                    AND ADDRESSING MODE AS INVOKER
*                                    CONTROL IS RESTORED
*
 TITLE 'PROCESS_EXIT_PARAMETERS SUBROUTINE    '
***********************************************************************
*                                                                     *
* PROCESS_EXIT_PARAMETERS                                             *
*                                                                     *
* DESCRIPTIVE NAME - PROCESS ALL INSTALLATION EXIT PARAMETERS         *
*                                                                     *
* FUNCTION -  CONTINUE PROCESSING ALL INSTALLATION EXIT               *
*             PARAMETERS UNTIL THE END OF THE LIST IS FOUND.          *
*             THE END OF THE LIST IS INDICATED BY HAVING THE          *
*             X'80000000' BIT ON IN THE LAST PARAMETER.               *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*    1).  SAVES ALL OF THE CALLER'S REGISTERS IN A LOCAL SAVE AREA    *
*         SO THAT ANY REGISTER CAN BE EASILY USED.                    *
*    2).  MOVES INTO THE OUTPUT BUFFER THE NAME OF THE EXIT "IKJEXIT" *
*    3).  CALLS THE PUTLINE SUBROUTINE TO OUTPUT THE BUFFER           *
*    4).  CALLS THE PUTLINE SUBROUTINE TO OUTPUT A BLANK LINE         *
*         FOR READABILITY PURPOSES.                                   *
*    5).  ESTABLISH ADDRESSABILITY TO THE                             *
*         "PARAMETER_ENTRY_NN IS AT ->" MESSAGE AND MOVES IT INTO     *
*         THE PUTLINE OUTPUT BUFFER                                   *
*    6).  GET THE ADDRESS OF THE FIRST PARAMETER_ENTRY                *
*    7).  CALLS THE HEXCONV SUBROUTINE TO MAKE THE ADDRESS PRINTABLE  *
*    8).  CALLS PUTLINE TO OUTPUT THE BUFFER                          *
*    9).  CALLS PUTLINE TO PUT OUT A BLANK LINE FOR READABILITY       *
*    10). CALLS PROCESS_PARAMETER_ENTRY                               *
*    11). CHECKS TO SEE IF WE ARE DONE PROCESSING ALL OF THE          *
*         PARAMETER_ENTRIES                                           *
*    12). IF NOT DONE GET THE ADDRESS OF THE NEXT PARAMETER           *
*         AND DO THE PROCESS FROM 5) AGAIN.                           *
*    13). RELOADS THE CALLER'S REGISTERS                              *
*    14). RETURNS TO CALLER                                           *
*                                                                     *
***********************************************************************
         SPACE 3
PROCESS_EXIT_PARAMETERS DS 0H
         STM   R0,R15,SAVE_AREA_1
*                                    SAVE ALL REGISTERS THE CALLER
*                                    OF THIS SUBROUTINE PRESENTED
*                                    SO THAT ANY REGISTER
*                                    CAN EASILY BE USED
*
         MVC   MSG_TEXT(L'EXIT_NAME),EXIT_NAME
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    NAME OF THIS TSO/E INSTALLATION
*                                    EXIT EXAMPLE "IKJEXIT"
*
         BAL   R14,PUTLINE
*                                    CALL THE SUBROUTINE PUTLINE TO
*                                    OUTPUT THE CONTENTS OF THE
*                                    OUTPUT BUFFER CONTAINING "IKJEXIT"
*
         SR    R2,R2
*                                    SET UP R2 AS AN INDEX INTO THE
*                                    PARAMETER LIST
*
         SR    R5,R5
*                                    USE R5 AS A WORK REGISTER
*
MORE_PARMS  DS 0H
*
* *#*#   BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT A BLANK LINE FOR
*                                    READABILITY PURPOSES
*
         LA    R10,MSG_TEXT
*                                    LOAD R10 TO HAVE THE ADDRESS OF
*                                    THE OUTPUT BUFFER
*
         USING PE_MSG0,R10
*                                    ESTABLISH ADDRESSABILITY
*                                    TO THE FIRST MESSAGE FOR
*                                    EVERY PARAMETER_ENTRY
*                               "PARAMETER_ENTRY_ZZ IS AT -> XXXXXXXX"
*
         MVC   PE_MSG0A,PE_AT_TEXT1
*                                    MOVE "PARAMETER_ENTRY_" INTO
*                                    THE OUTPUT BUFFER AREA
*
         MVC   PE_MSG0C,PE_AT_TEXT2
*                                    MOVE "IS AT ->" INTO THE OUTPUT
*                                    BUFFER AREA
*
         L     R1,R1_ENTRY_PARAMETER_LIST_PTR
*                                    GET THE ADDRESS OF THE PARAMETER
*                                    LIST THAT THE INVOKER PASSED INTO
*                                    IKJEXIT
*
         AR    R1,R2
*                                    ADD THE DISPLACEMENT OF THE
*                                    NEXT PARAMETER IN THE PARAMETER
*                                    LIST TO PROCESS TO THE
*                                    PARAMETER LIST ADDRESS
*
*
         ST    R1,HOLD
*                                    PUT THE "XXXXXXXX" ADDRESS OF THE
*                                    PARAMETER LIST CURRENTLY BEING
*                                    PROCESSED INTO THE HOLD VARIABLE
*                               "PARAMETER_ENTRY_ZZ IS AT -> XXXXXXXX"
*
         BAL   R14,HEXCONV
*                                    CALL HEXCONV TO CONVERT
*                                    THE HEX ADDRESS THAT WAS
*                                    PASSED IN THE HOLD VARIABLE INTO
*                                    DISPLAY  HEX EQUIVALENT
*
         MVC   PE_MSG0D,WORKAREA
*                                    MOVE THE ADDRESS OF WHERE THE
*                                    PARAMETER LIST IS AT INTO THE
*                                    OUTPUT BUFFER
*
         L     R1,0(,R1)
*                                    LOAD R1 TO POINT DIRECTLY TO
*                                    THE PARAMETER_ENTRY
*
         ST    R1,PARAMETER_ENTRY_PTR
*                                    SAVE THE ADDRESS OF WHERE THE
*                                    PARAMETER_ENTRY IS AT FOR
*                                    LATER USE
*
         LA    R5,1(,R5)
*                                    INCREMENT THE ZZ COUNT FOR
*                                    "PARAMETER_ENTRY_ZZ"
*
         ST    R5,HOLD
*                                    PUT THE CURRENT "ZZ" COUNT OF THE
*                                    PARAMETER LIST CURRENTLY BEING
*                                    PROCESSED INTO THE HOLD VARIABLE
*
         BAL   R14,HEXCONV
*                                    CALL HEXCONV TO CONVERT THE HEX
*                                    "ZZ" COUNT OF THE PARAMETER
*                                    LIST BEING PROCESSED INTO
*                                    CHARACTERS THAT CAN BE DISPLAYED
*
         MVC   PE_MSG0B,WORKAREA+6
*                                    PLACE INTO THE OUTPUT BUFFER
*                                    THE "ZZ" VALUE THAT HAS BEEN
*                                    CONVERTED "PARAMETER_ENTRY_ZZ"
*
         BAL   R14,PUTLINE
*                                    CALL THE SUBROUTINE PUTLINE TO
*                                    OUTPUT THE CONTENTS OF THE
*                                    OUTPUT BUFFER CONTAINING
*                                    THE FORMATTED
*                               "PARAMETER_ENTRY_ZZ IS AT -> XXXXXXXX"
*
* *#*#   BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT A BLANK LINE FOR
*                                    READABILITY PURPOSES
*
         ST    R5,COUNT
*                                    SAVE THE HEX "ZZ" COUNT FOR
*                                    WHEN WE TRY TO PROCESS THE
*                                    NEXT PARAMETER LIST AND
*                                    PARAMETER_ENTRY SO IKJEXIT KNOWS
*                                    WHAT THE LAST COUNT WAS
*
         BAL   R14,PROCESS_PARAMETER_ENTRY
*                                    CALL THE SUBROUTINE
*                                    PROCESS_PARAMETER_ENTRY TO
*                                    FORMAT THE FIELDS WITHIN THE
*                                    PARAMETER_ENTRY PROPER
*
         ST    R1,END_OF_PARAMETER_LIST
*                                    SAVE THE ADDRESS OF THE
*                                    PARAMETER_ENTRY IN THE
*                                    PARAMETER LIST WE ARE WORKING
*                                    ON TO SEE IF THERE ARE
*                                    MORE PARAMETERS IN THE
*                                    PARAMETER LIST TO PROCESS
*
         A     R2,FOUR
*                                    INCREMENT THE INDEX INTO THE
*                                    PARAMETER LIST FOR THE NEXT
*                                    PARAMETER LIST AND PARAMETER_ENTRY
*                                    TO PROCESS
*
         TM    END_OF_PARAMETER_LIST,HEX80
*                                    IF THE HIGH ORDER BIT OF THE
*                                    PARAMETER LIST IS NOT ON
*
         BNO   MORE_PARMS
*                                    THEN IKJEXIT HAS MORE PARAMETERS
*                                    WITHIN THE PARAMETER LIST TO
*                                    PROCESS
*
EXIT_PROCESS_EXIT_PARAMETERS DS 0H
*
*                                    ELSE ALL OF THE PARAMETERS WITHIN
*                                    THE PARAMETER LIST HAVE BEEN
*                                    PROCESSED
*
         LM    R0,R15,SAVE_AREA_1
*                                    RESTORE ALL OF THE CALLER'S
*                                    REGISTERS TO THEIR ORIGINAL
*                                    VALUE
*
         BR    R14
*                                    RETURN TO CALLER
*
         DROP  R10
*                                    NO LONGER USE R10 TO POINT TO
*                                    THE
*                               "PARAMETER_ENTRY_ZZ IS AT -> XXXXXXXX"
*                                    DSECT DESCRIPTION
 TITLE 'PROCESS_PARAMETER_ENTRY SUBROUTINE'
***********************************************************************
*                                                                     *
* PROCESS_PARAMETER_ENTRY                                             *
*                                                                     *
* DESCRIPTIVE NAME - PROCESS EACH INDIVIDUAL PARAMETER_ENTRY THAT IS  *
*                    POINTED TO FROM THE PARAMETER LIST.              *
*                                                                     *
* FUNCTION -  SUBROUTINE DRIVER                                       *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*    1). SAVES ALL OF THE CALLER'S REGISTERS IN A LOCAL SAVE AREA     *
*    2). CALLS BUILD_PE_MSG1 TO BUILD THE                             *
*        "PE_ZZ KEY -> X..X DATA LENGTH -> X..X DATA AT -> X..X "     *
*    3). CALLS PUTLINE                                                *
*    4). CALLS FMTDATA                                                *
*    5). CALLS PUTLINE                                                *
*    6). RELOADS THE CALLER'S REGISTERS                               *
*    7). RETURNS TO CALLER                                            *
*                                                                     *
***********************************************************************
         SPACE 3
PROCESS_PARAMETER_ENTRY DS 0H
         STM   R0,R15,SAVE_AREA_2
*                                    SAVE ALL REGISTERS THE CALLER
*                                    OF THIS SUBROUTINE PRESENTED
*                                    SO THAT ANY REGISTER
*                                    CAN EASILY BE USED
*
         LA    R10,MSG_TEXT
*                                    LOAD R2 TO CONTAIN THE ADDRESS OF
*                                    THE PARAMETER_ENTRY
*
         USING PBUF,R10
*                                    ESTABLISH ADDRESSABILITY TO
*                                    THE OUTPUT BUFFER DSECT
*
         L     R2,PARAMETER_ENTRY_PTR
*                                    LOAD R2 TO CONTAIN THE ADDRESS OF
*                                    THE PARAMETER_ENTRY
*
         USING PARAMETER_ENTRY,R2
*                                    ESTABLISH ADDRESSABILITY TO
*                                    THE PARAMETER_ENTRY DSECT SO
*                                    IKJEXIT CAN REFERENCE THE LABELS
*                                    WITHIN THE PARAMETER_ENTRY DSECT
*
         BAL   R14,BUILD_PE_MSG1
*                                    CALL SUBROUTINE BUILD_PE_MSG1
*                                    TO BUILD AND FORMAT THE
*                                    MESSAGE
*
*                                    "PEZZ KEY -> X..X
*                                    LENGTH OF DATA -> X..X
*                                    ADDRESS OF DATA -> X..X"
*
         BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT THE MESSAGE
*
         CLI   BAD_KEY_SWITCH,BAD_KEY_INDICATOR
*                                    IF IKJEXIT DID NOT DETECT AN
*                                    INVALID KEY WITHIN THE
*                                    PARAMETER_ENTRY_KEY FIELD OF THE
*                                    PARAMETER_ENTRY BEING PROCESSED
*
         BNE   GOT_GOOD_KEY
*                                    THEN CONTINUE PROCESSING AND
*                                    FORMAT THE PARAMETER_ENTRY_DATA
*                                    FIELD (EITHER DIRECT OR INDIRECT
*                                    BASED ON THE PARAMETER_ENTRY_KEY)
*                                    FOR THE LENGTH OF THE
*                                    PARAMETER_ENTRY_LENGTH FIELD
*
* *#*#   BAL   R14,PUTLINE
*                                    ELSE CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT A BLANK LINE FOR
*                                    READABILITY PURPOSES
*
         MVC   MSG_TEXT(L'BAD_KEY_MSG),BAD_KEY_MSG
*                                    MOVE THE FOLLOWING MESSAGE INTO
*                                    THE OUTPUT BUFFER
*
*                                    "THE PARAMETER_ENTRY_KEY
*                                    FOR THIS PARAMETER_ENTRY
*                                    CONTAINS AN UNDEFINED KEY"
*
         BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT THE
*  "THE PARAMETER_ENTRY_KEY FOR THIS PARAMETER_ENTRY CONTAINS AN
*                                    UNDEFINED KEY" MESSAGE
*
* *#*#   BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT A BLANK LINE FOR
*                                    READABILITY PURPOSES
*
GOT_GOOD_KEY DS    0H
*
         TM    ORIGINAL_DATA_LENGTH,HEX80
*                                    IF THE PARAMETER_ENTRY_LENGTH
*                                    FIELD OF THIS PARAMETER_ENTRY
*                                    DOES NOT CONTAIN A NEGATIVE
*                                    LENGTH
*
         BNO   LENGTH_IS_POSITIVE
*                                    THEN DO NOT SET THE
*                                    SWITCH NOT TO FORMAT THE "DATA"
*                                    LINE
*
* *#*#   BAL   R14,PUTLINE
*                                    ELSE CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT A BLANK LINE FOR
*                                    READABILITY PURPOSES
*
         MVC   MSG_TEXT(L'BAD_LENGTH_MSG6),BAD_LENGTH_MSG6
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    INFORMATIONAL ERROR MESSAGE
*
         BAL   R14,PUTLINE
*                                    OUTPUT THE OUTPUT BUFFER THAT
*                                    CONTAINS THE ERROR MESSAGE
*                                    INDICATING A NEGATIVE LENGTH
*                                    HAS BEEN FOUND IN THE
*                                    PARAMETER_ENTER_LENGTH FIELD
*                                    OF THIS PARAMETER_ENTEY
*
         B     EXIT_PROCESS_PARAMETER_ENTRY
*                                    ERRROR CONDITION SO JUST EXIT
*                                    THIS SUBROUTINE
*
LENGTH_IS_POSITIVE DS 0H
*
         BAL   R14,FMTDATA
*                                    CALL THE SUBROUTINE FMTDATA TO
*                                    FORMAT THE DATA EITHER POINTED
*                                    TO INDIRECTLY FROM THE
*                                    PARAMETER_ENTRY_DATA FIELD OF
*                                    THE PARAMETER_ENTRY OR THE
*                                    DATA WITHIN THE
*                                    PARAMETER_ENTRY_DATA FIELD
*
*
EXIT_PROCESS_PARAMETER_ENTRY DS 0H
*
* *#*#   BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT A BLANK LINE FOR
*                                    READABILITY PURPOSES
         LM    R0,R15,SAVE_AREA_2
*                                    RESTORE ALL OF THE CALLER'S
*                                    REGISTERS TO THEIR ORIGINAL
*                                    VALUE
*
         BR    R14
*                                    RETURN TO CALLER
*
         DROP  R10
*                                    NO LONGER USE R10 TO POINT TO THE
*
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    DSECT
         DROP  R2
*                                    NO LONGER USE PARAMETER_ENTRY
*                                    DSECT DESCRIPTION
 TITLE 'BUILD_PE1_MSG SUBROUTINE'
***********************************************************************
* BUILD_PE_MSG1                                                       *
*                                                                     *
* DESCRIPTIVE NAME - FORMAT THE DISPLAY TEXT DESCRIBING THE           *
*                    PARAMETER_ENTRY_KEY, PARAMETER_ENTRY_LENGTH AND  *
*                    THE PARAMETER_ENTRY_DATA FIELDS OF THE           *
*                    PARAMETER_ENTRY.                                 *
*                                                                     *
* FUNCTION -  BUILDS THE MESSAGE TEXT                                 *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*    1). SAVES ALL OF THE CALLER'S REGISTERS IN A LOCAL SAVE AREA     *
*    2). MOVES INTO THE MESSAGE LINE THE                              *
*        "PE_ZZ KEY -> X..X DATA LENGTH -> X..X DATA AT -> X..X" MSG  *
*    3). VALIDATES THE PARAMETER ENTRY KEY                            *
*        IF THE KEY IS VALID THEN                                     *
*          {1}. CALLS FMT_PARAMETER_ENTRY_KEY                         *
*          {2}. CALLS FMT_PARAMETER_ENTRY_DATA                        *
*          {3}. RELOADS THE CALLER'S REGISTERS                        *
*          {4}. CALLS HEXCONV                                         *
*        ELSE                                                         *
*          {1}. GENERATES A MESSAGE INDICATING THAT THE KEY IS        *
*               INVALID.                                              *
*    4). RELOADS THE CALLER'S REGISTERS                               *
*    5). RETURNS TO CALLER                                            *
*                                                                     *
***********************************************************************
         SPACE 3
BUILD_PE_MSG1  DS 0H
*
         STM   R0,R15,SAVE_AREA_3
*                                    SAVE ALL REGISTERS THE CALLER
*                                    OF THIS SUBROUTINE PRESENTED
*                                    SO THAT ANY REGISTER
*                                    CAN EASILY BE USED
*
         LA    R10,MSG_TEXT
*                                    LOAD R10 TO HAVE THE ADDRESS OF
*                                    THE OUTPUT BUFFER
*
         USING PE_MSG1,R10
*                                    ESTABLISH ADDRESSABILITY
*                                    TO THE SECOND MESSAGE FOR
*                                    EVERY PARAMETER_ENTRY
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    DSECT
*
         L     R2,PARAMETER_ENTRY_PTR
*                                    LOAD R2 TO HAVE THE ADDRESS OF
*                                    THE PARAMETER_ENTRY
*
         USING PARAMETER_ENTRY,R2
*                                    ESTABLISH ADDRESSABILITY TO
*                                    THE PARAMETER_ENTRY DSECT SO
*                                    IKJEXIT CAN REFERENCE THE LABELS
*                                    WITHIN THE PARAMETER_ENTRY DSECT
*
         MVC   HOLD,PARAMETER_ENTRY_LENGTH
*                                    MOVE INTO THE HOLD VARIABLE THE
*                                    LENGTH OF THE PARAMETER_ENTRY_DATA
*                                    FIELD DESCRIBED BY THE
*                                    PARAMETER_ENTRY_LENGTH FIELD
*
         MVC   ORIGINAL_DATA_LENGTH,HOLD
*                                    SAVE THE ORIGINAL VALUE OF THE
*                                    PARAMETER_ENTRY_LENGTH FIELD
*                                    SO THAT IF IKJEXIT
*                                    CALLS THE FMTDATA SUBROUTINE
*                                    IKJEXIT KNOWS HOW MUCH DATA
*                                    TO FORMAT
*
         BAL   R14,HEXCONV
*                                    CALL HEXCONV TO CONVERT
*                                    THE HEX LENGTH OF THE DATA
*                                    THAT WAS OBTAINED FROM THE
*                                    PARAMETER_ENTRY_LENGTH FIELD
*                                    OF THE PARAMETER_ENTRY
*                                    PASSED IN THE HOLD VARIABLE INTO
*                                    CHARACTERS THAT CAN BE DISPLAYED
*
         MVC   PE_MSG1E,WORKAREA
*                                    MOVE THE CONVERTED HEX VALUE OF
*                                    THE PARAMETER_ENTRY_LENGTH OPERAND
*                                    INTO THE OUTPUT BUFFER
*
         SR    R5,R5
*                                    ZERO R5 AND USE IT TO CHECK
*                                    IF THE VALUE OF THE
*                                    PARAMETER_ENTRY_KEY PARAMETER OF
*                                    THE PARAMETER_ENTRY IS VALID
*
         BCTR  R5,0
*                                    INITIALIZE THE R5 KEY CHECK TO
*                                    START AT X'FFFFFFFF'
*
         L     R7,MAXIMUM_KEY_VALUE
*                                    USE R7 AS THE MAXIMUM VALID
*                                    KEY VALUE + 1.
*
         MVI   BAD_KEY_SWITCH,GOOD_KEY_INDICATOR
*                                    ASSUME THAT THE
*                                    PARAMETER_ENTRY_KEY THAT IS IN
*                                    THE PARAMETER_ENTRY IS VALID
*
NEXT_KEY DS    0H
*                                    DO WHILE R7 HAS NOT REACHED ZERO
*                                    AND THE R5 KEY CHECK AND THE
*                                    PARAMETER_ENTRY_KEY ARE NOT
*                                    EQUAL
*
*
         LA    R5,1(,R5)
*                                    INCREMENT THE VALUE OF R5 (THE
*                                    KEY CHECK) BY 1
*
         C     R5,PARAMETER_ENTRY_KEY
*                                    IF THE PARAMETER_ENTRY_KEY IS
*                                    EQUAL TO THE KEY CHECK (R5)
*
         BE    CONTINUE
*                                    THEN DO NOT SET THE
*                                    BAD_KEY_INDICATOR
*
         BCT   R7,NEXT_KEY
*                                    CONTINUE CHECKING THE KEY CHECK
*                                    (R5) AGAINST THIS
*                                    PARAMETER_ENTRY_KEY
*
         MVI   BAD_KEY_SWITCH,BAD_KEY_INDICATOR
*                                    ELSE IKJEXIT HAS DETERMINED THAT
*                                    AN INVALID KEY HAS BEEN FOUND
*                                    WITHIN THE PARAMETER_ENTRY_KEY
*                                    FIELD OF THIS PARAMETER ENTRY
*                                    AND THE BAD_KEY_SWITCH HAS BEEN
*                                    SET TO INDICATE THAT THE
*                                    PARAMETER_ENTRY_KEY IS INVALID
*
CONTINUE DS    0H
*
         BAL   R14,FMT_PARAMETER_ENTRY_KEY
*                                    CALL SUBROUTINE
*                                    FMT_PARAMETER_ENTRY_KEY TO
*                                    CONVERT THE HEX VALUE OF THE
*                                    PARAMETER_ENTRY_KEY FIELD FROM THE
*                                    HEX VALUE TO THE EQUIVALENT
*                                    HEX CHARACTERS THAT CAN BE
*                                    DISPLAYED
*
         BAL   R14,FMT_PARAMETER_ENTRY_DATA
*                                    CALL SUBROUTINE
*                                    FMT_PARAMETER_ENTRY_DATA  TO
*                                    CONVERT THE HEX VALUE OF THE
*                                    PARAMETER_ENTRY_DATA FIELD FROM
*                                    THE HEX VALUE TO THE EQUIVALENT
*                                    HEX CHARACTERS THAT CAN BE
*                                    DISPLAYED
*
NO_GOOD  DS    0H
*
         MVC   HOLD,COUNT
*                                    RE-LOAD THE "ZZ" COUNT OF THE
*                                    PARAMETER_ENTRY CURRENTLY
*                                    BEING PROCESSED AND PASS INTO
*                                    THE HEXCONV SUBROUTINE
*
         BAL   R14,HEXCONV
*                                    CALL HEXCONV TO CONVERT THE
*                                    HEX "ZZ" COUNT OF THE
*                                    PARAMETER LIST BEING PROCESS INTO
*                                    EQUIVALENT
*                                    HEX CHARACTERS THAT CAN BE
*                                    DISPLAYED
*
         MVC   PE_MSG1H,WORKAREA+6
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    "ZZ" FIELD OF THE
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    MESSAGE
*
         MVC   PE_MSG1A,PE
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    "PE" FIELD OF THE
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    MESSAGE
*
         MVC   PE_MSG1B,KEY_EQU
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    "KEY -> ' FIELD OF THE
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    MESSAGE
*
         MVC   PE_MSG1D,LENGTH_OF_DATA
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    "LENGTH OF DATA -> ' FIELD OF THE
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    MESSAGE
*
         MVC   PE_MSG1F,ADDRESS_OF_DATA
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    "ADDRESS OF DATA -> ' FIELD OF THE
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    MESSAGE
*
EXIT_BUILD_PE_MSG1  DS 0H
*
         LM    R0,R15,SAVE_AREA_3
*                                    RESTORE ALL OF THE CALLER'S
*                                    REGISTERS TO THEIR ORIGINAL
*                                    VALUE
*
         BR    R14
*                                    RETURN TO CALLER
*
         DROP  R10
*                                    NO LONGER USE R10 TO POINT TO
*                                    THE
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    DSECT
*
         DROP  R2
*                                    NO LONGER USE PARAMETER_ENTRY
*                                    DSECT DESCRIPTION
 TITLE 'FMT_PARAMETER_ENTRY_KEY SUBROUTINE'
***********************************************************************
* FMT_PARAMETER_ENTRY_KEY                                             *
*                                                                     *
* DESCRIPTIVE NAME - COMMON ROUTINE TO CONVERT THE                    *
*                    PARAMETER_ENTRY_KEY FROM HEX CHARACTERS TO       *
*                    CHARACTERS THAT CAN BE DISPLAYED.                *
*                                                                     *
* FUNCTION -  BUILDS THE MESSAGE TEXT                                 *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*    1). SAVES ALL THE CALLER'S REGISTERS                             *
*    2). LOADS  THE PARAMETER_ENTRY_KEY                               *
*    3). CALLS HEXCONV                                                *
*    4). PUTS THE CONVERTED TEXT INTO THE MESSAGE LINE                *
*    5). RELOADS THE CALLER'S RETURN ADDRESS                          *
*    6). RETURNS TO CALLER                                            *
*                                                                     *
*                                                                     *
***********************************************************************
         SPACE 3
FMT_PARAMETER_ENTRY_KEY DS 0H
*
         STM   R0,R15,SAVE_AREA_4
*                                    SAVE ALL REGISTERS THE CALLER
*                                    OF THIS SUBROUTINE PRESENTED
*                                    SO THAT ANY REGISTER
*                                    CAN EASILY BE USED
*
         LA    R10,MSG_TEXT
*                                    LOAD R10 TO HAVE THE ADDRESS OF
*                                    THE OUTPUT BUFFER
*
         USING PE_MSG1,R10
*                                    ESTABLISH ADDRESSABILITY
*                                    TO THE SECOND MESSAGE FOR
*                                    EVERY PARAMETER_ENTRY
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    DSECT
*
         L     R2,PARAMETER_ENTRY_PTR
*                                    LOAD R2 TO HAVE THE ADDRESS OF
*                                    THE PARAMETER_ENTRY
*
         USING PARAMETER_ENTRY,R2
*                                    ESTABLISH ADDRESSABILITY TO
*                                    THE PARAMETER_ENTRY DSECT SO
*                                    IKJEXIT CAN REFERENCE THE LABELS
*                                    WITHIN THE PARAMETER_ENTRY DSECT
*
         MVC   HOLD,PARAMETER_ENTRY_KEY
*                                    GET THE VALUE OF THE
*                                    PARAMETER_ENTRY_KEY THAT IS
*                                    WITHIN THE PARAMETER_ENTRY
*                                    BEING PROCESSED AND PASS IT TO
*                                    THE HEXCONV SUBROUTINE
*
         BAL   R14,HEXCONV
*                                    CALL HEXCONV TO CONVERT THE
*                                    HEX PARAMETER_ENTRY_KEY FOR
*                                    PARAMETER_ENTRY BEING PROCESS INTO
*                                    EQUIVALENT
*                                    HEX CHARACTERS THAT CAN BE
*                                    DISPLAYED
*
         MVC   PE_MSG1C,WORKAREA
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    CONVERTED VALUE FOR THE
*                                    "X..X" FIELD OF THE "KEY AT -> "
*
*                                    INTO THE
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    MESSAGE
*
EXIT_FMT_PARAMETER_ENTRY_KEY DS 0H
*
         LM    R0,R15,SAVE_AREA_4
*                                    RESTORE ALL OF THE CALLER'S
*                                    REGISTERS TO THEIR ORIGINAL
*                                    VALUE
*
         BR    R14
*                                    RETURN TO CALLER
*
         DROP  R10
*                                    NO LONGER USE R10 TO POINT TO
*                                    THE
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    DSECT
*
         DROP  R2
*                                    NO LONGER USE PARAMETER_ENTRY
*                                    DSECT DESCRIPTION
 TITLE 'FMT_PARAMETER_ENTRY_DATA SUBROUTINE'
***********************************************************************
*                                                                     *
* FMT_PARAMETER_ENTRY_DATA                                            *
*                                                                     *
* DESCRIPTIVE NAME - COMMON ROUTINE TO CONVERT THE                    *
*                    PARAMETER_ENTRY_DATA FROM HEX CHARACTERS TO      *
*                    CHARACTERS TO THAT CAN BE DISPLAYED.             *
*                                                                     *
* FUNCTION -  DISPLAY THE ADDRESS OF WHERE THE DATA IS                *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*    1). SAVES ALL THE CALLER'S REGISTERS                             *
*    2). LOADS THE PARAMETER_ENTRY_DATA                               *
*    3). CALLS HEXCONV                                                *
*    4). PUTS THE CONVERTED TEXT INTO THE MESSAGE LINE                *
*    5). RELOADS THE CALLER'S RETURN ADDRESS                          *
*    6). RETURNS TO CALLER                                            *
*                                                                     *
*                                                                     *
***********************************************************************
         SPACE 3
FMT_PARAMETER_ENTRY_DATA DS 0H
*
         STM   R0,R15,SAVE_AREA_5
*                                    SAVE ALL REGISTERS THE CALLER
*                                    OF THIS SUBROUTINE PRESENTED
*                                    SO THAT ANY REGISTER
*                                    CAN EASILY BE USED
*
         LA    R10,MSG_TEXT
*                                    LOAD R10 TO HAVE THE ADDRESS OF
*                                    THE OUTPUT BUFFER
*
         USING PE_MSG1,R10
*                                    ESTABLISH ADDRESSABILITY
*                                    TO THE SECOND MESSAGE FOR
*                                    EVERY PARAMETER_ENTRY
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    DSECT
*
         L     R2,PARAMETER_ENTRY_PTR
*                                    LOAD R2 TO HAVE THE ADDRESS OF
*                                    THE PARAMETER_ENTRY
*
         USING PARAMETER_ENTRY,R2
*                                    ESTABLISH ADDRESSABILITY TO
*                                    THE PARAMETER_ENTRY DSECT SO
*                                    IKJEXIT CAN REFERENCE THE LABELS
*                                    WITHIN THE PARAMETER_ENTRY DSECT
*
         C     R5,KEY_OF_TWO
*                                    IF THE PARAMETER_ENTRY_KEY IN
*                                    THIS PARAMETER_ENTRY DOES NOT
*                                    HAVE A VALUE OF X'00000002'
*
         BNE   NOT_INDIRECT
*                                    THEN THE PARAMETER_ENTRY_KEY
*                                    IN THIS PARAMETER_ENTRY INDICATES
*                                    THAT THE DATA IS DIRECT
*
         L     R6,PARAMETER_ENTRY_DATA
*                                    ELSE THE DATA IN THE
*                                    PARAMETER_ENTRY_DATA FIELD IS A
*                                    POINTER TO THE DATA
*
         B     GO_ON
*                                    JUMP AROUND THE DATA DIRECT
*                                    INDICATOR AND KEEP GOING
*
NOT_INDIRECT DS 0H
*
         LA    R6,PARAMETER_ENTRY_DATA
*                                    GET THE ADDRESS OF THE
*                                    PARAMETER_ENTRY_DATA FIELD THAT
*                                    IS CONTAINED WITHIN THE
*                                    PARAMETER_ENTRY BEING PROCESSED
*
GO_ON    DS    0H
*
         ST    R6,HOLD
*                                    IN ANY CASE IKJEXIT WILL PUT THE
*                                    ADDRESS OF WHERE THE DATA IS AT
*                                    INTO THE HOLD VARIABLE FOR HEXCONV
*
         ST    R6,DATA_AT
*                                    AND IKJEXIT WILL SAVE THE ADDRESS
*                                    OF WHERE THE DATA IS AT FOR THE
*                                    FMTDATA SUBROUTINE
*
         BAL   R14,HEXCONV
*                                    CALL HEXCONV TO CONVERT THE
*                                    HEX PARAMETER_ENTRY_DATA FOR
*                                    PARAMETER_ENTRY BEING PROCESS INTO
*                                    EQUIVALENT
*                                    HEX CHARACTERS THAT CAN BE
*                                    DISPLAYED
*
         MVC   PE_MSG1G,WORKAREA
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    CONVERTED VALUE FOR THE
*                                    "X..X" FIELD OF THE
*                                    "ADDRESS OF DATA -> " FIELD
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    MESSAGE
*
EXIT_FMT_PARAMETER_ENTRY_DATA DS 0H
*
         LM    R0,R15,SAVE_AREA_5
*                                    RESTORE ALL OF THE CALLER'S
*                                    REGISTERS TO THEIR ORIGINAL
*                                    VALUE
*
         BR    R14
*                                    RETURN TO CALLER
*
         DROP  R10
*                                    NO LONGER USE R10 TO POINT TO
*                                    THE
*
*                                   "PEZZ KEY -> X..X LENGTH OF DATA ->
*                                    X..X ADDRESS OF DATA -> X..X"
*
*                                    DSECT
*
         DROP  R2
*                                    NO LONGER USE PARAMETER_ENTRY
*                                    DSECT DESCRIPTION
 TITLE 'FMTDATA SUBROUTINE'
***********************************************************************
*                                                                     *
* FMTDATA                                                             *
*                                                                     *
* DESCRIPTIVE NAME - DISPLAY DATA SUBROUTINE                          *
*                                                                     *
* FUNCTION -  HEXDUMPS THE PARAMETER_ENTRY_DATA THAT IS BEING         *
*             DESCRIBED BY THE PARAMETER_ENTRY_KEY AND THE            *
*             PARAMETER_ENTRY_LENGTH.                                 *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*    1).  SAVES ALL OF THE CALLER'S REGISTERS IN A LOCAL SAVE AREA    *
*    2).  CHECKS TO SEE IF THERE IS ANY DATA TO FORMAT                *
*         IF THERE IS NO DATA TO FORMAT THEN                          *
*          {1}. INSERTS A MESSAGE INDICATING NO DATA TO FORMAT        *
*        ELSE THERE IS DATA TO FORMAT                                 *
*          {1}. BUILDS EACH LINE OF OUTPUT ONE LINE AT A TIME         *
*               DISPLAYING THE OFFSET INTO THE DATA                   *
*          {2}. CALLS HEXCONV                                         *
*          {3}. CALLS PUTLINE                                         *
*          {4}. CONTINUES THIS PROCESS UNTIL THERE IS NO MORE         *
*               DATA TO FORMAT.                                       *
*    3). CALLS HEXCONV ON LAST TIME                                   *
*    4). CALLS PUTLINE ON LAST TIME                                   *
*    5). RELOADS THE CALLER'S REGISTERS                               *
*    6). RETURNS TO CALLER                                            *
*                                                                     *
***********************************************************************
         SPACE 3
FMTDATA        DS  0H
*
         STM   R0,R15,SAVE_AREA_6
*                                    SAVE ALL REGISTERS THE CALLER
*                                    OF THIS SUBROUTINE PRESENTED
*                                    SO THAT ANY REGISTER
*                                    CAN EASILY BE USED
*
         L     R1,ORIGINAL_DATA_LENGTH
*                                    LOAD R1 TO HAVE THE ORIGINAL
*                                    LENGTH OF THE DATA THAT WAS
*                                    SAVED EARLIER
*
         LTR   R1,R1
*                                    IF THE LENGTH OF THE DATA
*                                    WE OBTAINED FROM THE
*                                    PARAMETER_ENTRY_DATA FIELD WITHIN
*                                    THIS PARAMETER_ENTRY IS GREATER
*                                    THAN ZERO
*
         BNZ   GOT_DATA
*                                    THEN THERE IS DATA TO FORMAT AND
*                                    DISPLAY
*
         MVC   MSG_TEXT(L'BAD_LENGTH_MSG1),BAD_LENGTH_MSG1
*                                    ELSE
*                                    MOVE THE FOLLOWING MESSAGE
*                                    INTO THE OUTPUT BUFFER:
*
*                                    "THE PARAMETER_ENTRY_LENGTH FOR
*                                    THIS PARAMETER_ENTRY HAS A VALUE
*                                    OF ZERO"
*
         BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT THE MESSAGE
*
* *#*#   BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT A BLANK LINE FOR
*                                    READABILITY PURPOSES
*
         MVC   MSG_TEXT(L'BAD_LENGTH_MSG2),BAD_LENGTH_MSG2
*                                    MOVE THE FOLLOWING MESSAGE
*                                    INTO THE OUTPUT BUFFER:
*
*                                    "THE PARAMETER_ENTRY_LENGTH MUST
*                                    CONTAIN A VALUE NO LESS THAN
*                                    '00000004'"
*
         BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT THE MESSAGE
*
         MVC   MSG_TEXT(L'BAD_LENGTH_MSG3),BAD_LENGTH_MSG3
*                                    MOVE THE FOLLOWING MESSAGE
*                                    INTO THE OUTPUT BUFFER:
*
*                                    "IF THE PARAMETER_ENTRY_KEY
*                                    IS '00000000' OR '00000003'"
*
         BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT THE MESSAGE
*
* *#*#   BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT A BLANK LINE FOR
*                                    READABILITY PURPOSES
*
         MVC   MSG_TEXT(L'BAD_LENGTH_MSG4),BAD_LENGTH_MSG4
*                                    MOVE THE FOLLOWING MESSAGE
*                                    INTO THE OUTPUT BUFFER:
*
*                                    "IF THE PARAMETER_ENTRY_KEY
*                                    IS '00000001' OR '00000002'"
*
         BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT THE MESSAGE
*
         MVC   MSG_TEXT(L'BAD_LENGTH_MSG5),BAD_LENGTH_MSG5
*                                    MOVE THE FOLLOWING MESSAGE
*                                    INTO THE OUTPUT BUFFER:
*                                    "THE PARAMETER_ENTRY_LENGTH
*                                    MAY CONTAIN A VALUE OF '00000001'"
*
         BAL   R14,PUTLINE
*                                    CALL THE PUTLINE SUBROUTINE
*                                    TO OUTPUT THE MESSAGE
*
*
         B     LAST_PUT
*                                    QUIT PROCESSING FMTDATA BECAUSE
*                                    OF INVALID LENGTH FOUND WITHIN
*                                    THE PARAMETER_ENTRY_KEY FIELD
*                                    FOR THIS PARAMETER_ENTRY
*                                    ANY ATTEMPT TO FORMAT THIS DATA
*                                    COULD PRESENT UNPREDICTABLE
*                                    RESULTS
*
GOT_DATA DS    0H
*
         LA    R15,MSG_TEXT
*                                    LOAD R15 TO HAVE THE ADDRESS OF
*                                    THE OUTPUT BUFFER
*
         USING PE_MSG2,R15
*                                    ESTABLISH ADDRESSABILITY
*                                    TO THE THIRD MESSAGE FOR
*                                    EVERY PARAMETER_ENTRY
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*                                    DSECT
*
*
         MVC   PE_MSG2A,DATA
*                                    MOVE "DATA" INTO THE OUTPUT
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*                                    BUFFER
*
         SR    R3,R3
*                                    R3 IS THE INDEX INTO THE DATA
*                                    AREA COUNTER FOR THE
*                                    "+00000000" PART OF
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*                                    EVERY TIME A NEW DATA LINE IS
*                                    NEEDED THE R3 INDEX IS INCREMENTED
*                                    BY A VALUE OF X'10'
*
         L     R2,DATA_AT
*                                    LOAD R2 TO POINT TO THE BEGINNING
*                                    LOCATION OF THE DATA
*
LOOP0    DS    0H
*
         LA    R15,MSG_TEXT
*                                    SET R10 TO POINT TO THE BEGINNING
*                                    LOCATION OF THE OUTPUT BUFFER
*                                    FOR THE
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*
         MVI   PE_MSG2B,PLUS_SIGN
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    "+" SIGN FOR THE OFFSET INTO
*                                    THE DATA DISPLACEMENT COUNTER
*
         ST    R3,HOLD
*                                    STORE INTO THE VARIABLE HOLD THE
*                                    OFFSET INTO THE DATA THAT
*                                    IS CURRENTLY BEING PROCESSED
*
         BAL   R14,HEXCONV
*                                    CALL HEXCONV TO CONVERT THE
*                                    HEX DATA OFFSET COUNTER FOR
*                                    "+00000000" FIELD OF THE
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*                                    INTO THE HEX CHARACTER
*                                    EQUIVALENTS
*
         MVC   PE_MSG2C(L'WORKAREA/2),WORKAREA
*                                    MOVE INTO THE OUTPUT BUFFER THE
*                                    "+00000000" DATA OFFSET COUNTER
*                                    RETURNED FROM HEXCONV
*
         LA    R15,PE_MSG2C
*                                    REPOSITION THE OUTPUT
*                                    BUFFER POINTER FOR THE REST
*                                    OF THE OUTPUT FIELDS FOR THE
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*
         L     R4,FOUR
*                                    SET R4 TO THE MAXIMUM NUMBER
*                                    OF ACTUAL DATA DISPLAY FIELDS
*                                    THAT CAN BE PLACED IN THE OUTPUT
*                                    BUFFER
*
LOOP1    DS    0H
*
         LA    R15,L'PE_MSG2C(,R15)
*                                    BEFORE ANY DATA IS FORMATTED
*                                    AND MOVED INTO THE OUTPUT
*                                    BUFFER, POINT TO THE DATA
*                                    TARGET BUFFER AREA
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*                    TARGET 1  TARGET 2  TARGET 3  TARGET 4
*
         C     R1,FOUR
*                                    IF THERE ARE 4 OR LESS CHARACTERS
*                                    LEFT TO FORMAT IN THE DATA AREA
*                                    POINTED TO R2
*
         BNH   LESSTHAN
*                                    THEN GET OUT OF THIS LOOP
*
LOOP2    DS    0H
*                                    ELSE
*
         MVC   HOLD,0(R2)
*                                    MOVE 4 BYTES OF THE DATA INTO
*                                    THE VARIABLE HOLD SO THAT
*                                    THE HEXCONV ROUTINE CAN CONVERT
*                                    THE DATA FROM
*                                    HEX CHARACTERS TO HEX CHARACTERS
*                                    THAT CAN BE DISPLAYED
*
         BAL   R14,HEXCONV
*                                    CALL HEXCONV TO CONVERT THE
*                                    HEX DATA FOR THE OUTPUT BUFFER
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*
         MVC   0(L'WORKAREA/2,R15),WORKAREA
*                                    MOVE THE HEX CONVERTED DATA
*                                    INTO THE TARGET 1, TARGET 2,
*                                    TARGET 3, OR TARGET 4 FIELD OF
*                                    THE
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*
         S    R1,FOUR
*                                    DECREMENT THE AMOUNT OF DATA
*                                    LEFT IN THE DATA AREA REMAINING
*                                    TO BE CONVERTED INTO HEX
*                                    CHARACTERS THAT CAN BE DISPLAYED
*
         LA   R2,4(,R2)
*                                    INCREMENT R2 BY 4. R2 POINTS TO
*                                    THE NEXT 4 BYTES OF DATA THAT
*                                    NEED TO BE PASSED THROUGH THE
*                                    HEXCONV SUBROUTINE AND THEN
*                                    MOVED INTO THE OUTPUT BUFFER
*
         BCT  R4,LOOP1
*                                    IF THE TARGET 1 THROUGH TARGET 4
*                                    FIELDS OF THE OUTPUT BUFFER HAVE
*                                    BEEN ALREADY FILLED WITH HEX
*                                    CONVERTED DATA FROM THE DATA
*                                    AREA
*
         BAL  R14,PUTLINE
*                                    CALL PUTLINE TO OUTPUT THE
*                                    OUTPUT BUFFER THAT CONTAINS THE
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1"
*        OR
*        "+00000010  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*
         LA   R3,16(,R3)
*                                    INCREMENT THE DATA DISPLACEMENT
*                                    INDEX BY X'10' TO MAKE THE
*                                    DATA EASY TO LOCATE BY AN
*                                    OFFSET
*
         B    LOOP0
*                                    NEXT OUTPUT BUFFER HAS BEEN
*                                    CLEARED AND IS READY FOR DATA
*                                    INSERTION INTO THE TARGET FIELDS
*                                    AND THE DATA OFFSET AREA
*
LESSTHAN DS   0H
*
         LA   R7,HOLD
*                                    GET THE ADDRESS OF THE HOLD
*                                    VARIABLE THAT WILL BE PASSED INTO
*                                    HEXCONV
*
         ST   R1,TEMP
*                                    SAVE THE LENGTH OF THE DATA
*                                    IN THE DATA LINE LEFT TO
*                                    FORMAT
*
         LTR  R1,R1
*                                    IS THE LENGTH ZERO        @YA19583
         BZ   LAST_PUT
*                                    LENGTH IS ZERO SO BYPASS THE
*                                    EXECUTION OF THE MOVE INSTRUCTION
*                                                              @YA19583
         BCTR R1,0
*                                    DECREASE THE LENGTH FOR THE
*                                    EXECUTION OF THE MOVE INSTRUCTION
*                                                              @YA19583
         EX   R1,HOLDMVC
*                                    MOVE INTO THE HOLD
*                                    VARIABLE THE REMAINING AMOUNT OF
*                                    DATA THAT NEEDS TO GO THROUGH
*                                    HEXCONV
*
         BAL   R14,HEXCONV
*                                    CALL HEXCONV TO CONVERT THE
*                                    HEX DATA FOR THE OUTPUT BUFFER
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*
         L    R1,TEMP
*                                    LOAD R1 WITH THE ORIGINAL LENGTH
*                                    OF THE DATA THAT WAS
*                                    LEFT TO FORMAT WHEN THIS
*                                    SECTION OF CODE WAS ENTERED
         AR   R1,R1
*                                    DOUBLE ITS LENGTH
*
         BCTR R1,0
*                                    DECREMENT THE LENGTH FOR THE
*                                    MOVEMENT OF THE DATA FROM THE
*                                    HEXCONV WORK AREA TO THE
*                                    TARGET OUTPUT BUFFER
*
         EX   R1,LASTMVC
*                                    MOVE THE DATA INTO THE OUTPUT
*                                    BUFFER FROM WORKAREA FOR LENGTH
*                                    OF R1
*
LAST_PUT DS    0H
EXIT_FMTDATA DS 0H
*
         BAL  R14,PUTLINE
*                                    CALL PUTLINE TO OUTPUT THE
*                                    OUTPUT BUFFER THAT CONTAINS THE
*
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1"
*        OR
*        "+00000010  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1" MESSAGE
*
*
         LM    R0,R15,SAVE_AREA_6
*                                    RESTORE ALL OF THE CALLER'S
*                                    REGISTERS TO THEIR ORIGINAL
*                                    VALUE
*
         BR    R14
*                                    RETURN TO CALLER
*
         DROP  R15
*                                    NO LONGER USE R15 TO POINT TO
*                                    THE
* "DATA   +00000000  E3C8C9E2  40C9E240  E3C8C540  C4C1E3C1"
*                                    DSECT DESCRIPTION
 TITLE 'PUTLINE SUBROUTINE'
***********************************************************************
*                                                                     *
* PUTLINE                                                             *
*                                                                     *
* DESCRIPTIVE NAME - COMMON PUTLINE ROUTINE                           *
*                                                                     *
* FUNCTION -  DETERMINES WHETHER TO USE PUTLINE OR WTO BASED ON       *
*             A FLAG THAT WAS SET IN THE INITIALIZATION CODE.         *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*    1).  SAVES ALL OF THE CALLER'S REGISTERS IN A LOCAL SAVE AREA    *
*    2).  CHECKS TO SEE IF A WTO IS TO BE ISSUED                      *
*         IF A WTO IS TO BE ISSUED THEN                               *
*          {1}. CALL WTO                                              *
*        ELSE USE PUTLINE TO PUT OUT THE MESSAGE                      *
*          {1}. BUILDS THE IOPL                                       *
*          {2}. INVOKES THE TSO/E PUTLINE FACILITY                    *
*    3). CLEARS THE MESSAGE LINE FOR THE NEXT USER                    *
*    4). RELOADS THE CALLER'S REGISTERS                               *
*    5). RETURNS TO CALLER                                            *
*                                                                     *
***********************************************************************
         SPACE 3
PUTLINE  DS    0H
*
         STM   R0,R15,SAVE_AREA_7
*                                    SAVE ALL REGISTERS THE CALLER
*                                    OF THIS SUBROUTINE PRESENTED
*                                    SO THAT ANY REGISTER
*                                    CAN EASILY BE USED
*
         LA    R10,MSG_TEXT
*                                    LOAD R10 TO HAVE THE ADDRESS OF
*                                    THE OUTPUT BUFFER
*
         USING PBUF,R10
*                                    ESTABLISH ADDRESSABILITY TO THE
*                                    OUTPUT BUFFER
*                                    DSECT
*
         CLI   WTO_SWITCH,ISSUE_WTO_INDICATOR
*                                    IF THE ISSUE_WTO_INDICATOR IS
*                                    NOT ON
*
         BNE   NO_WTO
*                                    THEN USE THE PUTLINE ROUTINE TO
*                                    DISPLAY THE OUTPUT MESSAGE TO
*                                    THE USER OF IKJEXIT
*
         BAL   R14,WTO
*                                    ELSE IKJEXIT HAS DETERMINED THAT
*                                    PUTLINE MAY NOT WORK CORRECTLY
*                                    WITHIN THIS INVOCATION OF
*                                    IKJEXIT AND WTOS WILL BE ISSUED
*                                    TO THE MASTER CONSOLE
*
         B     EXIT_PUTLINE
*                                    WTOS WERE USED TO OUTPUT THE
*                                    DATA TO THE MASTER CONSOLE
*                                    AND CLEAR THE OUTPUT BUFFER
*                                    FOR THE NEXT USER WHO HAS DATA
*                                    TO DISPLAY
*
NO_WTO   DS    0H
*
         L     R1,IOPL_PTR
*                                    LOAD THE ADDRESS OF THE IOPL
*                                    THAT WAS DEFINED WITHIN THE
*                                    IKJEXIT DYNAMIC WORK AREA
*
         USING IOPL,R1
*                                    ESTABLISH ADDRESSABILITY TO
*                                    THE IOPL SO THE LABELS IN THE
*                                    IOPL CAN BE REFERENCED
*
         L     R2,CPPL_PTR
*                                    LOAD THE ADDRESS OF THE CPPL
*                                    THAT WAS DEFINED WITHIN THE
*                                    IKJEXIT DYNAMIC WORK AREA
*
         USING CPPL,R2
*                                    ESTABLISH ADDRESSABILITY TO
*                                    THE CPPL SO THE LABELS IN THE
*                                    CPPL CAN BE REFERENCED
*
         L     R5,CPPLUPT
*                                    LOAD R5 TO HAVE THE ADDRESS OF
*                                    THE USER PROFILE TABLE (UPT)
*                                    THAT WAS PASSED IN TO IKJEXIT
*                                    ON THE INVOCATION ON IKJEXIT
*
         L     R6,CPPLECT
*                                    LOAD R6 TO HAVE THE ADDRESS OF
*                                    THE USER EVENT CONTOL TABLE (ECT)
*                                    THAT WAS PASSED IN TO IKJEXIT
*                                    ON THE INVOCATION ON IKJEXIT
*
         XC    ECB,ECB
*                                    FORCE THE EVENT CONTROL BLOCK TO
*                                    HAVE A VALUE OF ZERO SO THAT
*                                    THE POSTING CAN BE CORRECTLY
*                                    DONE BY PUTLINE
*
         MVI   MSG_LENGTH+1,HEX54
*                                    MOVE INTO THE PUTLINE PARAMETER
*                                    BLOCK (PTPB, PUTBLOK)
*                                    THE LENGTH OF THE DATA THAT
*                                    IS TO BE DISPLAYED PLUS THE
*                                    LENGTH OF THE 4 BYTE HEADER
*                                    IKJEXIT WILL ALWAYS INDICATE A
*                                    LENGTH OF 80 CHARACTERS FOR
*                                    OUTPUT + THE 4 BYTE HEADER
*
         PUTLINE PARM=PUTBLOK,       LABEL FOR THE PUTLINE MF=L        X
               UPT=(5),              THE UPT                           X
               ECT=(6),              THE ECT                           X
               ECB=ECB,              THE ECB                           X
               OUTPUT=(MSG_LENGTH,TERM,SINGLE,DATA),                   X
               MF=(E,(1))            EXECUTE FORM OF PUTLINE MACRO
*                                    ISSUE THE EXECUTE FORMAT OF
*                                    THE PUTLINE MACRO
*
*        LTR   R15,R15
*                                    IF THE RETURN CODE FROM PUTLINE
*                                    IS ZERO
*
*        BZ    EXIT_PUTLINE
*                                    THEN BRANCH TO LABEL EXIT_PUTLINE
*                                    IN THIS SUBROUTINE
*
*        MVI   WTO_SWITCH,ISSUE_WTO_INDICATOR
*                                    ELSE AN ERROR HAS OCCURRED IN
*                                    PUTLINE PROCESSING SO A
*                                    WTO WILL BE USED INSTEAD
*
*        BAL   R14,WTO
*                                    CALL SUBROUTINE TO OUTPUT THE
*                                    MESSAGES FROM NOW ON SINCE
*                                    PUTLINE INDICATES AN ERROR
*                                    OCCURRED
         DROP  R2
*                                    DROP ADDRESSABILITY TO THE
*                                    CPPL
*
         DROP  R1
*                                    DROP ADDRESSABILITY TO THE
*                                    IOPL
*
EXIT_PUTLINE  DS    0H
*
         MVI   MSG_TEXT,BLANK
*                                    PLACE A SPACE INTO THE FIRST
*                                    POSITION OF THE MESSAGE OUTPUT
*                                    BUFFER
*
         MVC   MSG_TEXT+1(L'MSG_TEXT-1),MSG_TEXT
*                                    AND PROPAGATE THE BLANK ACROSS
*                                    THE REST OF THE MESSAGE OUTPUT
*                                    BUFFER IN CASE THERE WAS ANY
*                                    RESIDUAL DATA IN THE OUTPUT
*                                    BUFFER FOR THE NEXT USER
*
         LM    R0,R15,SAVE_AREA_7
*                                    RESTORE ALL OF THE CALLER'S
*                                    REGISTERS TO THEIR ORIGINAL
*                                    VALUE
*
         BR    R14                   RETURN TO CALLER
*
         DROP  R10
*                                    NO LONGER USE R10 TO POINT TO
*                                    THE OUTPUT BUFFER
*                                    DSECT DESCRIPTION
 TITLE 'WTO SUBROUTINE'
***********************************************************************
*                                                                     *
* WTO                                                                 *
*                                                                     *
* DESCRIPTIVE NAME - WTO SUBROUTINE                                   *
*                                                                     *
* FUNCTION -  OUTPUTS THE MESSAGES TO THE MVS MASTER CONSOLE          *
*             INSTEAD OF THE TSO/E USER'S SCREEN.                     *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*    1). SAVES ALL OF THE CALLER'S REGISTERS IN A LOCAL SAVE AREA     *
*    2). COPIES THE STATIC FORM OF THE WTO MF=L TO THE DYNAMIC        *
*        FORM OF THE PARAMETER LIST                                   *
*    3). INSERTS THE WTO MESSAGE TEXT                                 *
*    4). ISSUES THE EXECUTE FORM OF THE WTO POINTING TO THE           *
*        DYNAMIC FORM OF THE MACRO LIST                               *
*    5). RELOADS THE CALLER'S REGISTERS                               *
*    6). RETURNS TO CALLER                                            *
*                                                                     *
***********************************************************************
         SPACE 3
WTO      DS    0H
*
         STM   R0,R15,SAVE_AREA_8
*                                    SAVE ALL REGISTERS THE CALLER
*                                    OF THIS SUBROUTINE PRESENTED
*                                    SO THAT ANY REGISTER
*                                    CAN EASILY BE USED
*
         LA    R10,MSG_TEXT
*                                    LOAD R10 TO HAVE THE ADDRESS OF
*                                    THE OUTPUT BUFFER
*
         USING PBUF,R10
*                                    ESTABLISH ADDRESSABILITY
*                                    TO THE OUTPUT BUFFER
*                                    DSECT
*
         L     R1,WTO_LIST_PTR
*                                    POINT TO THE DYNAMIC WTO LIST
*                                    LOAD R1 TO HAVE THE ADDRESS
*                                    OF WHERE THE DYNAMIC WTO LIST
*                                    FORM OF THE MACRO IS TO BE COPIED
*
         MVC   0(LWTOLST,R1),WTOLIST
*                                    COPY INTO THE DYNAMIC WTO AREA
*                                    THE STATIC FORM OF THE WTO
*                                    LIST
*
         L     R2,WTO_TEXT_PTR
*                                    LOAD R2 TO HAVE THE ADDRESS OF
*                                    THE WTO MESSAGE TEXT AREA
*
         MVC   0(L'MSG_TEXT,R2),MSG_TEXT
*                                    MOVE INTO THE WTO OUTPUT BUFFER
*                                    THE ORIGINAL OUTPUT BUFFER
*                                    CONTENTS IF THE PUTLINE WAS USED
*
         WTO   MF=(E,(1))
*                                    ISSUE THE EXECUTE FORM OF THE
*                                    WTO MACRO
*
EXIT_WTO DS    0H
*
         LM    R0,R15,SAVE_AREA_8    RESTORE ALL OF THE CALLER'S
*                                    REGISTERS TO THEIR ORIGINAL
*                                    VALUE
*
         BR    R14                   RETURN TO CALLER
*
         DROP  R10
*                                    NO LONGER USE R10 TO POINT TO
*                                    THE OUTPUT BUFFER
*                                    DSECT DESCRIPTION
 TITLE 'HEXCONV SUBOUTINE'
***********************************************************************
* HEXCONV                                                             *
*                                                                     *
* DESCRIPTIVE NAME - CONVERTS HEX CHARACTERS TO CHARACTERS THAT       *
*                    CAN BE DISPLAYED                                 *
*                                                                     *
* FUNCTION -  CONVERTS HEX DATA THAT CAN NOT BE DISPLAYED INTO        *
*             HEX DATA THAT CAN BE DISPLAYED                          *
*                                                                     *
* OPERATION -                                                         *
*                                                                     *
*    1). SAVES ALL OF THE CALLER'S REGISTERS IN A LOCAL SAVE AREA     *
*    2). CONVERTS THE HEX DATA INTO CHARACTERS THAT CAN BE DISPLAYED  *
*    3). RELOADS THE CALLER'S REGISTERS                               *
*    4). RETURNS TO CALLER                                            *
*                                                                     *
***********************************************************************
         SPACE 3
HEXCONV  DS    0F
*
         STM   R0,R15,SAVE_AREA_9
*                                    SAVE ALL REGISTERS THE CALLER
*                                    OF THIS SUBROUTINE PRESENTED
*                                    SO THAT ANY REGISTER
*                                    CAN EASILY BE USED
*
         UNPK  WORKAREA(9),HOLD(L'HOLD+1)
*                                    TAKE EACH NIBBLE OF THE HOLD
*                                    VARIABLE AND PLACE IT IN THE
*                                    LOW ORDER NIBBLE OF THE WORKAREA
*                                    VARIABLE. THE HIGH ORDER NIBBLE
*                                    OF THE WORKAREA VARIABLE WILL
*                                    CONTAIN A X'F'
*
*
         TR    WORKAREA(8),TRTBL-240
*                                    ENSURE THE HIGH ORDER NIBBLE
*                                    OF EACH BYTE IN THE WORKAREA
*                                    VARIABLE CONTAINS THE CORRECT
*                                    VALUE FOR THE CHARACTER THAT
*                                    IS BEING TRANSLATED.
*                                    THE VALID CHARACTERS ARE
*                                    C - FOR CHARACTERS A-F
*                                    F - FOR CHARACTERS 0-9
*
EXIT_HEXCONV  DS    0F
*
         LM    R0,R15,SAVE_AREA_9
*                                    RESTORE ALL OF THE CALLER'S
*                                    REGISTERS TO THEIR ORIGINAL
*                                    VALUE
*
         BR    R14
*                                    RETURN TO CALLER
*
         DS    0F
 TITLE 'EXECUTED INSTRUCTIONS'
***********************************************************************
* EXECUTED INSTRUCTIONS.                                              *
*                                                                     *
***********************************************************************
         SPACE 3
HOLDMVC  MVC   0(0,R7),0(R2)
LASTMVC  MVC   0(0,R15),WORKAREA
 TITLE 'STATIC VARIABLES'
*
***********************************************************************
* DECLARES OF ALL CONSTANTS USED BY THIS MODULE FOLLOW                *
***********************************************************************
*
         SPACE 3
WORKAREA_ID_CONSTANT DC C'WORKAREA'
KEY_OF_TWO      DC    F'2'          INDICATES PARAMETER_ENTRY_DATA
*                                   IS INDIRECT
MAXIMUM_KEY_VALUE DC  F'4'          VALID PARAMETER_ENTRY_KEY VALUES
*                                   X'00000000' THROUGH X'00000003'
*
*        INFORMATIONAL ERROR MESSAGES
*
*
BAD_KEY_MSG     DC    C'THE PARAMETER_ENTRY_KEY FOR THIS PARAMETER_ENTRY
               Y CONTAINS AN UNDEFINED KEY'
BAD_LENGTH_MSG1 DC    C'THE PARAMETER_ENTRY_LENGTH FOR THIS PARAMETER_EX
               NTRY HAS A VALUE OF ZERO'
BAD_LENGTH_MSG2 DC    C'THE PARAMETER_ENTRY_LENGTH MUST CONTAIN A VALUEX
                NOT LESS THAN X''00000004'' '
BAD_LENGTH_MSG3 DC   C'IF THE PARAMETER_ENTRY_KEY IS X''00000000'', OR X
               X''00000003'' '
BAD_LENGTH_MSG4 DC   C'IF THE PARAMETER_ENTRY_KEY IS X''00000001'', OR X
               X''00000002'' '
BAD_LENGTH_MSG5 DC   C'THE PARAMETER_ENTRY_LENGTH MAY CONTAIN A VALUE OX
               F X''00000001'' '
BAD_LENGTH_MSG6 DC   C'THE PARAMETER_ENTRY_LENGTH MAY NOT CONTAIN A NEGX
               ATIVE LENGTH'
FOUR            DC    F'4'
SIXTEEN         DC    F'16'
*
*
*        CONSTANTS THAT ARE PLACED INTO VARIOUS MESSAGE LINES
*
*
EXIT_NAME       DC    CL8'IKJEXIT'
DATA            DC    CL4'DATA'
KEY_EQU         DC    CL7'KEY -> '
LENGTH_OF_DATA  DC    CL18'LENGTH OF DATA -> '
ADDRESS_OF_DATA DC    CL19'ADDRESS OF DATA -> '
PE              DC    CL2'PE'
TRTBL           DC    CL16'0123456789ABCDEF'
PE_AT_TEXT1     DC    CL16'PARAMETER_ENTRY_'
PE_AT_TEXT2     DC    CL9'IS AT -> '
*
*
*        LIST FORM OF THE WTO MACTO
*
*
WTOLIST  WTO ('                                                        X
                                       '),                             X
               ROUTCDE=(2),            MASTER CONSOLE AND WTP          X
               DESC=(5),                                               X
               MCSFLAG=(NOTIME),                                       X
               MF=L
LWTOLST        EQU *-WTOLIST
 TITLE 'DYNAMIC SAVE AREA'
***********************************************************************
* IKJEXIT'S DYNAMIC SAVE AREA                                         *
***********************************************************************
*
         SPACE 3
SAVE_AREA                DSECT
SAVE_AREA_0              DS 0CL72    STANDARD SAVE AREA
                         DS  F       UNUSED
B_PTR                    DS  F       BACKWARD SAVE AREA POINTER
F_PTR                    DS  F       FORWARD SAVE AREA POINTER
REG14                    DS  F       CONTENTS OF REGISTER 14
REG15                    DS  F       CONTENTS OF REGISTER 15
REG0                     DS  F       CONTENTS OF REGISTER 0
REG1                     DS  F       CONTENTS OF REGISTER 1
REG2                     DS  F       CONTENTS OF REGISTER 2
REG3                     DS  F       CONTENTS OF REGISTER 3
REG4                     DS  F       CONTENTS OF REGISTER 4
REG5                     DS  F       CONTENTS OF REGISTER 5
REG6                     DS  F       CONTENTS OF REGISTER 6
REG7                     DS  F       CONTENTS OF REGISTER 7
REG8                     DS  F       CONTENTS OF REGISTER 8
REG9                     DS  F       CONTENTS OF REGISTER 9
REG10                    DS  F       CONTENTS OF REGISTER 10
REG11                    DS  F       CONTENTS OF REGISTER 11
REG12                    DS  F       CONTENTS OF REGISTER 12
L_SAVE_AREA              EQU *-SAVE_AREA
 TITLE 'DYNAMIC WORK AREA'
***********************************************************************
* DECLARES OF ALL DYNAMIC VARIABLES USED BY THIS MODULE FOLLOW        *
***********************************************************************
*
         SPACE 3
WORKA    DSECT
WORK_AREA_ID             DS  CL8     WORKAREA ID
SAVE_AREA_1              DS  18F     SAVE AREA 1
SAVE_AREA_2              DS  18F     SAVE AREA 2
SAVE_AREA_3              DS  18F     SAVE AREA 3
SAVE_AREA_4              DS  18F     SAVE AREA 4
SAVE_AREA_5              DS  18F     SAVE AREA 5
SAVE_AREA_6              DS  18F     SAVE AREA 6
SAVE_AREA_7              DS  18F     SAVE AREA 7
SAVE_AREA_8              DS  18F     SAVE AREA 8
SAVE_AREA_9              DS  18F     SAVE AREA 9
         SPACE 1
GM_PTR                   DS  F       ADDRESS OF GETMAIN
CPPL_PTR                 DS  F       ADDRESS OF THE CPPL
IOPL_PTR                 DS  F       ADDRESS OF THE IOPL
WTO_LIST_PTR             DS  F       ADDRESS OF DYNAMIC WTO AREA
WTO_TEXT_PTR             DS  F       ADDRESS OF DYNAMIC WTO TEXT AREA
PBUF_LENGTH              DS  F       TRUE LENGTH OF PBUF
PBUF_PTR                 DS  F       ADDRESS OF THE PBUF
PARAMETER_ENTRY_PTR      DS  F       ADDRESS OF THE PARAMETER_ENTRY
R1_ENTRY_PARAMETER_LIST_PTR DS F     ADDRESS OF THE PARAMETER LIST
*                                    THAT WAS PASSED INTO IKJEXIT
         SPACE 1
TEMP                     DS  F       HOLDS THE LENGTH OF THE DATA
ECB                      DS  F       IKJEXIT'S ECB
RETCODE                  DS  F       THE RETURN CODE HOLDER
PUTBLOK  PUTLINE MF=L                LIST FORM OF PUTLINE MACRO
MSG_LENGTH               DS  H       LENGTH OF MSG + LENGTH OF....
                         DS  H       FIRST TWO HALF WORDS
MSG_TEXT                 DS  CL80    HERE'S WHERE MESSAGE TEXT GOES
                         DS  0F      ALIGN ON A FULL WORD
END_OF_PARAMETER_LIST    DS  F       HAS AN ADDRESS OUT OF THE
*                                    PARAMETER LIST PASSED IN TO
*                                    IKJEXIT FROM CALLING MODULE
DATA_AT                  DS  F
HOLD                     DS  2F      PARAMETER PASSED TO HEXCONV
WORKAREA                 DS  CL16    WORK AREA FOR HEXCONV
COUNT                    DS  F       HAS THE "ZZ" VALUE
ORIGINAL_DATA_LENGTH     DS  F       WORK AREA FOR LENGTH OF DATA
WTO_SWITCH               DS  CL1     PUTLINE OR WTO
BAD_KEY_SWITCH           DS  CL1     INVALID PARAMETER_ENTRY_KEY
*                                    FOUND INDICATOR
                         DS  0D      ALIGN ON A DOUBLE WORD
LWORKA   EQU   *-WORKA LENGTH OF THIS WORK AREA
*
 TITLE 'IKJCPPL MAPPING MACRO'
CPPL_START EQU LWORKA
         IKJCPPL                     HERE IS THE CPPL
LCPPL    EQU   *-CPPL                DESCRIBES LENGTH OF THE CPPL DSECT
 TITLE 'IKJIOPL MAPPING MACRO'
IOPL_START EQU LCPPL+CPPL_START
         IKJIOPL                     HERE IS THE IOPL
LIOPL    EQU   *-IOPL                DESCRIBES LENGTH OF THE IOPL DSECT
 TITLE 'DYNAMIC WTO  WORKA AREA'
WTO_START EQU LIOPL+IOPL_START
TLEN     EQU LCPPL+LIOPL+LWORKA+LWTOLST
*                                    TOTAL LENGTH OF IKJEXIT'S
*                                    DYNAMIC WORK AREA
 TITLE 'PBUF MAPPING DSECT'
PBUF     DSECT                       PRINT BUFFER DSECT
         DS    CL80                  MESSAGE TEXT IS 80 CHARS WIDE
LPBUF    EQU   *-PBUF                LENGTH OF PBUF DSECT
 TITLE 'PARAMETER_ENTRY DSECT MAPPING'
PARAMETER_ENTRY        DSECT         DESCRIBE THE PARAMETER_ENTRY
                        DS  0F       ALIGN ON A FULL WORD
PARAMETER_ENTRY_KEY     DS  F        HERE'S THE KEY FIELD
PARAMETER_ENTRY_LENGTH  DS  F        HERE'S THE LENGTH OF THE DATA
PARAMETER_ENTRY_DATA    DS  CL4088   HERE'S THE DATA/ PTR TO DATA
LPARAMETER_ENTRY        EQU *-PARAMETER_ENTRY
*                                    LENGTH OF PARAMETER_ENTRY DSECT
 TITLE 'PE_MSG1 MAPPING DSECT'
PE_MSG1  DSECT
PEMSG1   DS    0CL80                 MSG1
PE_MSG1A DS    CL2                   SAYS PE
PE_MSG1H DS    CL2                        ZZ
         DS    CL2
PE_MSG1B DS    CL7                   SAYS 'KEY -> '
PE_MSG1C DS    CL8                   HEX DATA X..X
         DS    CL2
PE_MSG1D DS    CL18                  'LENGTH OF DATA -> '
PE_MSG1E DS    CL8                   HEX DATA X..X
         DS    CL2
PE_MSG1F DS    CL19                  'ADDRESS OF DATA -> '
PE_MSG1G DS    CL8                   HEX DATA X..X
         DS    CL2
LPE_MSG1 EQU   *-PE_MSG1             AND HERE'S THE LENGTH OF N
 TITLE 'PE_MSG2 MAPPING DSECT'
PE_MSG2  DSECT
PEMSG2   DS    0CL80                 MSG1
PE_MSG2A DS    CL4                   'DATA'
         DS    CL3
PE_MSG2B DS    CL1                   '+'
PE_MSG2C DS    5CL12                 HEX DATA X..X
         DS    CL12
LPE_MSG2 EQU   *-PE_MSG2             AND HERE'S THE LENGTH OF N
         SPACE 3
PE_MSG0  DSECT
PEMSG0   DS    0CL80                 MSG1
PE_MSG0A DS    CL16                  PARAMETER_ENTRY_
PE_MSG0B DS    CL2                   NN
         DS    CL1                   '+'
PE_MSG0C DS    CL9                   IS AT ->
         DS    CL1
PE_MSG0D DS    CL8                    X..X
         DS    CL43
LPE_MSG0 EQU   *-PE_MSG0             AND HERE'S THE LENGTH OF N
 TITLE 'CVT MAPPING MACRO'
         CVT  DSECT=YES              HERE IS THE CVT FOR CALLTSSR
 TITLE 'IKJTSVT MAPPING MACRO'
         IKJTSVT                     HERE IS THE TSVT FOR TSSR
         END
