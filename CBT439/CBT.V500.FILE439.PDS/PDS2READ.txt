 READMEM: PROC(MASKE);
 DCL MASKE CHAR(8);

 DCL KEY CHAR(17) STATIC VAR INIT(''),
     TOKEY CHAR(17) STATIC INIT(' ');

 DCL I BIN FIXED,
     HIGHMASK CHAR(8) STATIC INIT(' '),
     LASTMEM CHAR(8) STATIC INIT(' '),
     LOW BUILTIN,
     HIGH BUILTIN,
     INDEX BUILTIN;

 /* MEMBER-TABELLE NEU ANLEGEN */
 CALL CREMEMT;

 /* SCHLUESSEL AUFBAUEN */
 I = INDEX(MASKE,'*');
 IF I = 0 THEN I = 8; ELSE I = I-1;
 KEY = 'M' || SUBSTR(MASKE,1,I);
 HIGHMASK = HIGH(8);
 SUBSTR(HIGHMASK,1,I) = SUBSTR(MASKE,1,I);
 LASTMEM = ' ';

 /* DATEI LESEN */
 ON ENDFILE(PDSFILE) GOTO ENDE_LESEN;
 ON KEY(PDSFILE) GOTO ENDE_LESEN;
 OPEN FILE(PDSFILE);

 READ FILE(PDSFILE) SET(REC_PTR) KEY(KEY);

 DO WHILE(M_REC.RECTYPE = 'M' &
          M_REC.MEM <= HIGHMASK);
    PDSDNUM = M_REC.DNUM;
    PDSMEML = M_REC.MEM;
    IF LASTMEM ¬= PDSMEML THEN
       DO;
          LASTMEM = PDSMEML;
          PDSMEMS = LASTMEM;
       END;
     ELSE PDSMEMS = ' ';
    CALL ISPLINK('TBADD ','PDSMEMT ');
    READ FILE(PDSFILE) SET(REC_PTR);
 END;

 ENDE_LESEN:

 CALL ISPLINK ('TBSORT ','PDSMEMT ',
               '(PDSMEML,C,A,PDSMEMS,C,D)');
 CALL ISPLINK ('TBTOP ','PDSMEMT ');

 ON ENDFILE(PDSFILE) GOTO NEXT_DSN;
 ON KEY(PDSFILE) GOTO NEXT_DSN;

 READ_DSNAME: CALL ISPLINK('TBSKIP ','PDSMEMT ');
 IF PLIRETV ¬= 0 THEN GOTO ENDE_DSN_LESEN;
 KEY = 'D' || PDSDNUM;
 READ FILE(PDSFILE) SET(REC_PTR) KEY(KEY);
 PDSDSNL = D_REC.DSN;
 PDSVOL  = D_REC.VOLSER;
 CALL ISPLINK('TBPUT ','PDSMEMT ');
 NEXT_DSN:
 GOTO READ_DSNAME;

 ENDE_DSN_LESEN:

 CALL ISPLINK ('TBTOP ','PDSMEMT ');
 CLOSE FILE(PDSFILE);

 END READMEM;
