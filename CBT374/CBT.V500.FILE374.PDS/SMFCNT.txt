//C4SYSDM@ JOB C4ADM000,'SMFCNT',MSGCLASS=X,CLASS=A,NOTIFY=C4ADMDM
//*
//SAS    EXEC   SAS609,OPTIONS='NODATE'
//*ATLIB  DD DSN=EDH1.PROD.C4#3.SMFDAILY.COPY1,DISP=OLD,
//*  UNIT=CART,VOL=SER=610381
//DATLIB  DD DSN=T1H1.PROD.SMFDUMPW.HOLD,DISP=OLD,
//   UNIT=CART,VOL=SER=906555,LABEL=EXPDT=98000
//*ATLIB  DD DSN=EDO4.TEST.BB.IMAGC4#3.CPMOUT2,DISP=OLD
//*UNIT=DISK,VOL=SER=C48021
//*ATLIB  DD DSN=C4H1.PROD.SMFDUMPW,DISP=OLD
//*ATLIB  DD DSN=EDH1.PROD.SMFDUMPW.TEST,DISP=OLD,
//*  UNIT=CART,VOL=SER=(611415,611552)
//*ATLIB  DD DSN=EDH1.PROD.C4#3.SMFDAILY.COPY1,DISP=OLD,
//*       DCB=(BUFNO=255)
//*ATLIB  DD DSN=SYS1.MAN4,DISP=SHR
//*ATLIB  DD DSN=EDH1.PROD.SMFHIST.JUL95.COPY1,DISP=OLD
//*ATLIB  DD DSN=EDH1.PROD.RMFMAY95,DISP=OLD
//*LAY     DD DISP=(NEW,DELETE),UNIT=VIO,SPACE=(CYL,(5,5))
//*        DCB=(LRECL=121,BLKSIZE=1210,RECFM=FBA)
//SYSIN   DD *
TITLE SMF REC COUNT;
  DATA CONTER (KEEP = X1-X255 TOT)
       DDAT (KEEP = LTME TME DTE RECS)
  ;
  ARRAY XC(I) X1-X255;
  RETAIN X1-X255;
  RETAIN DTE 0;
  RETAIN TME 0;
  RETAIN LTME 0;
  RETAIN DDTE 0;
  RETAIN TTTE 0;
  RETAIN NN 0;
  RETAIN RECS 0;
  RETAIN V;
  INFILE DATLIB      JFCB=JF EOF=OU;
  IF _N_ = 1 THEN DO;
                  INPUT @;
                  IF INDEX(JF,'SYS1.MAN') ¬=0 THEN V='Y'; ELSE V='N';
                  END;
  IF V='Y' THEN
      INPUT    SMFXXLEN PIB2. SMFXXSEG PIB2. @ ;
  INPUT    SMFXXFLG PIB1. SMFXXRTY PIB1.
                       @;
  IF SMFXXRTY = 212 THEN DO;
                        *PUT '212 DETECTED - SKIPPING';
                         DELETE;
                         END;
  INPUT    DATTIM SMFSTAMP8.
      SMFXXSID $CHAR4. @;
  I=SMFXXRTY;
  IF I=0 THEN I=129;
  XC +1;
  NN +1;
  LTME = TTTE;
  DDTE = DATEPART(DATTIM);
  TTTE = TIMEPART(DATTIM);
  IF NN  = 1 THEN DO; TME = TTTE; LTME = TTTE; DTE = DDTE; END;
  IF DTE ¬= DDTE   THEN DO;
                        OUTPUT DDAT;
                        RECS = 0;
                        * DTE AND TME ARE FIRST DATE AND TIME;
                        * LTME IS LAST TIME FOR PREV DATE;
                        DTE = DDTE ;
                        TME = TTTE ;
                        END;
  RECS +1;
  DELETE;
OU:
                        N_RECS + RECS;
                        OUTPUT DDAT;
                        RECS = 0;
                        DTE = DDTE ;
                        TME = TTTE ;
  TOT=0;
  DO OVER XC; TOT+XC; END;
  OUTPUT CONTER;
  STOP;
  PROC PRINT DATA=CONTER;
  PROC SORT DATA=DDAT; BY DTE TME;
  DATA;
  DROP RECS TME LTME;
  RETAIN N_RECS 0;
  RETAIN R_CNT  0;
  RETAIN FIRSTIME 0;
  RETAIN LASTTIME 0;
  SET; BY DTE TME;
  IF FIRST.DTE THEN DO;
                    R_CNT =0;
                    FIRSTIME = 86400;
                    LASTTIME = 0;
                    END;
  R_CNT+1;
  IF TME < FIRSTIME THEN FIRSTIME = TME;
  IF LTME > LASTTIME THEN LASTTIME = LTME;
  IF LAST.DTE THEN DO;
                   N_RECS + RECS;
                   OUTPUT;
                   N_RECS = 0;
                   END; ELSE
                   DO;
                   N_RECS + RECS;
                   END;
  DELETE;
  PROC PRINT;
  FORMAT DTE DATE.;
  FORMAT FIRSTIME TIME11.3;
  FORMAT LASTTIME TIME11.3;
