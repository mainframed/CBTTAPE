//E0115DMS JOB EDPCSBS1,'SASD',MSGCLASS=X,CLASS=1,NOTIFY=ED115DM
//*
//SAS     EXEC SAS,OPTIONS=NODATE
//DATLIB  DD DSN=SYS1.MAN1,DISP=SHR
//SYSIN   DD *
TITLE SMF 40;
  DATA;
  RETAIN V;
  INFILE DATLIB JFCB=JF MISSOVER;
  IF _N_ = 1 THEN DO;
                  INPUT @;
                  IF INDEX(JF,'SYS1.MAN') ¬=0 THEN V=4; ELSE V=0;
                  END;
  IF V=4 THEN
      INPUT    SMFXXLEN PIB2. SMFXXSEG PIB2. @ ;
  INPUT    SMFXXFLG PIB1. SMFXXRTY PIB1.
                       @;
  IF SMFXXRTY = 212 THEN DO;
                        *PUT '212 DETECTED - SKIPPING';
                         DELETE;
                         END;
  INPUT    TIMEOUT SMFSTAMP8.
      SMFXXSID $CHAR4. @;
  IF SMFXXRTY ¬= 40 THEN RETURN;
    PUT    SMFXXLEN +2    SMFXXSEG +2
           SMFXXFLG +2    SMFXXRTY @25  TIMEOUT DATETIME. +2
      SMFXXSID  ;
      INPUT TDDUIF $CHAR8. TDDONDT SMFSTAMP8.
      TDDUDATA $CHAR8.  TDDINVSQ PIB1.
      TDDFLG   PIB1.    TDDRIN PIB2.
      TDDRV1   PIB8.    TDDRV2 PIB8.    TDDRVA PIB2.
      TDDVAR   PIB2.
       @;
        PUT TDDUIF +2      TDDONDT DATETIME.
      TDDUDATA +2       TDDINVSQ +2
      TDDFLG   +2       TDDRIN   +2
      TDDVAR
        ;
        NDEV = (TDDVAR -2) / 8;
   IF NDEV > 0 THEN
   DO I = 0 TO (NDEV-1);
      INPUT  TDDDEVC PIB1.  TDDUTYP PIB1.
             TDDCUA1 PIB1.  TDDCUA2 PIB1.  TDDNEXCP PIB4. @ ;
        PUT  TDDDEVC +2     TDDUTYP +2
             TDDCUA1 HEX1.  TDDCUA2 HEX1.  TDDNEXCP   ;
   END;
