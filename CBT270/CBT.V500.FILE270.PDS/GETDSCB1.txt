000010 ID DIVISION.
000020 PROGRAM-ID.     GETDSCB1.
000030 AUTHOR.         JEFF SPREHN.
000040     EJECT
000050 ENVIRONMENT DIVISION.
000060 CONFIGURATION SECTION.
000070 SOURCE-COMPUTER. IBM-370.
000080 OBJECT-COMPUTER. IBM-370.
000090 INPUT-OUTPUT SECTION.
000100
000110 FILE-CONTROL.
000120
000130     SELECT  OUTPUT-FILE         ASSIGN UT-S-OUTPUT.
000140     EJECT
000150 DATA DIVISION.
000160
000170 FILE SECTION.
000180
000190 FD  OUTPUT-FILE
000200     LABEL RECORDS ARE   STANDARD
000210     RECORDING MODE IS   F
000220     RECORD CONTAINS     70 CHARACTERS
000230     BLOCK CONTAINS      0 RECORDS
000240     DATA RECORDS IS     OUTPUT-REC.
000250
000260 01  OUTPUT-REC                              PIC X(70).
000270     EJECT
000280 WORKING-STORAGE SECTION.
000281 77  HOLD-JOBNAME                            PIC X(8).
000290
000300 01  INDSN                                   PIC X(44).
000310 01  INVOL                                   PIC X(6).
000320 01  VALID-SWITCH                            PIC X(3).
000330 01  ERRMSG                                  PIC X(30).
000340 01  DSCB1.
000390     05  FILLER                              PIC X(17).
000400     05  LAST-ACCESSOR                       PIC X(08).
000402     05  FILLER                              PIC X(06).
000403     05  LAST-ACCESS-DATE.
000404         10  BYTE-1                          PIC X.
000405         10  BYTES-2-3                       PIC XX.
000410     05  FILLER                              PIC X(106).
000420
000430 01  PRINT-LINE-A.
000440     05  FILLER                              PIC X(32)  VALUE
000450         ' *   THE DATE OF LAST ACCESS IS '.
000460     05  LAST-ACCESS-DATE.
000470         10  MONTH                           PIC XX.
000480         10  FILLER  VALUE '-'               PIC X.
000490         10  DAYY                            PIC XX.
000500         10  FILLER  VALUE '-'               PIC X.
000510         10  YEAR                            PIC XX.
000520     05  FILLER      VALUE SPACES            PIC X(29).
000521     05  FILLER      VALUE '*'               PIC X.
000530
000540 01  PRINT-LINE-B.
000550     05  FILLER                              PIC X(49)  VALUE
000560         ' *   THE JOBNAME OF THE JOB THAT LAST ACCESSED TH'.
000561     05  FILLER                              PIC X(10)  VALUE
000562         'E FILE IS '.
000570     05  LAST-ACCESSOR                       PIC X(08).
000580     05  FILLER      VALUE SPACES            PIC XX.
000581     05  FILLER      VALUE '*'               PIC X.
000590
000600 01  PRINT-LINE-C.
000610     05  FILLER                              PIC X(15)  VALUE
000620         ' *   ERROR ==> '.
000630     05  ERROR-MESSAGE                       PIC X(30).
000640     05  FILLER      VALUE SPACES            PIC X(24).
000641     05  FILLER      VALUE '*'               PIC X.
000650
000651 01  ASTERISK-SEPARATOR-LINE.
000652     05  FILLER   VALUE ' *'                 PIC XX.
000655     05  FILLER      VALUE SPACES            PIC X(67).
000656     05  FILLER      VALUE '*'               PIC X.
000657
000658 01  ALL-ASTERISKS-LINE.
000659     05  FILLER   VALUE ' *'                 PIC XX.
000660     05  FILLER      VALUE ALL '*'           PIC X(67).
000661     05  FILLER      VALUE '*'               PIC X.
000662
000663 01  YEAR-OF-LAST-ACCESS.
000670     05  FILLER   VALUE LOW-VALUE            PIC X.
000680     05  LAST-ACCESS-YEAR                    PIC X.
000690
000700 01  REDEF-YR-OF-LAST-ACCESS
000710       REDEFINES YEAR-OF-LAST-ACCESS         PIC S9(2) COMP.
000720
000730 01  DAY-OF-LAST-ACCESS.
000740     05  LAST-ACCESS-DAY                     PIC XX.
000750
000760 01  REDEF-DAY-OF-LAST-ACCESS
000770       REDEFINES DAY-OF-LAST-ACCESS         PIC S9(3) COMP.
000780
000790 01  LAST-ACCESS-DATE-DISPLAY.
000800     05  LAST-ACCESS-YEAR                    PIC 9(2).
000810     05  LAST-ACCESS-DAY                     PIC 9(3).
000820
000830 01  JTOSCONV-I-O-AREA.
000840     05  FILLER                              PIC X(8).
000850     05  STANDARD-DATE.
000860         10  MONTH                           PIC XX.
000870         10  DAYY                            PIC XX.
000880         10  YEAR                            PIC XX.
000890     05  JULIAN-DATE                         PIC X(5).
000900     05  INVALID-INPUT-DATE                  PIC X(3).
000910
000920     EJECT
000930 LINKAGE SECTION.
000940
000950 01  PARM-AREA.
000960     05  PARM-CNT                            PIC S9(4) COMP.
000970     05  PARM-VOL                            PIC X(6).
000980     05  FILLER                              PIC X.
000990     05  PARM-DSN                            PIC X(44).
001000
001010     EJECT
001020 PROCEDURE DIVISION USING PARM-AREA.
001030
001040 0000-OPEN.
001050
001060     OPEN  OUTPUT  OUTPUT-FILE.
001070
001080     MOVE PARM-DSN  TO INDSN.
001090     MOVE PARM-VOL  TO INVOL.
001100
001110     CALL 'PASSDSCB' USING INDSN INVOL VALID-SWITCH ERRMSG DSCB1.
001120
001130     IF VALID-SWITCH = 'YES'
001131         NEXT SENTENCE
001270     ELSE
001290         MOVE SPACES TO OUTPUT-REC
001300         PERFORM 5000-WRITE THRU 5999-EXIT-WRITE
001302         MOVE ALL-ASTERISKS-LINE TO OUTPUT-REC
001303         PERFORM 5000-WRITE THRU 5999-EXIT-WRITE
001304         MOVE ASTERISK-SEPARATOR-LINE TO OUTPUT-REC
001305         PERFORM 5000-WRITE THRU 5999-EXIT-WRITE
001310         MOVE ERRMSG TO ERROR-MESSAGE OF PRINT-LINE-C
001320         MOVE PRINT-LINE-C TO OUTPUT-REC
001330         PERFORM 5000-WRITE THRU 5999-EXIT-WRITE
001331         MOVE ASTERISK-SEPARATOR-LINE TO OUTPUT-REC
001332         PERFORM 5000-WRITE THRU 5999-EXIT-WRITE
001334         MOVE ALL-ASTERISKS-LINE TO OUTPUT-REC
001335         PERFORM 5000-WRITE THRU 5999-EXIT-WRITE
001350         GO TO 9999-QUIT.
001351
001352     MOVE SPACES TO OUTPUT-REC.
001353     PERFORM 5000-WRITE THRU 5999-EXIT-WRITE.
001354     MOVE ALL-ASTERISKS-LINE TO OUTPUT-REC.
001355     PERFORM 5000-WRITE THRU 5999-EXIT-WRITE.
001356     MOVE ASTERISK-SEPARATOR-LINE TO OUTPUT-REC.
001357     PERFORM 5000-WRITE THRU 5999-EXIT-WRITE.
001358     PERFORM 6000-CONVERT-LAST-ACCESS-DATE
001359        THRU 6999-EXIT.
001360     MOVE PRINT-LINE-A TO OUTPUT-REC.
001361     PERFORM 5000-WRITE THRU 5999-EXIT-WRITE.
001362     MOVE ASTERISK-SEPARATOR-LINE TO OUTPUT-REC.
001363     PERFORM 5000-WRITE THRU 5999-EXIT-WRITE.
001364     MOVE LAST-ACCESSOR OF DSCB1
001366       TO HOLD-JOBNAME.
001367
001368     TRANSFORM HOLD-JOBNAME
001369        FROM
001370            '0123456789$#@ABCDEFGHIJKLMNOPQRSTUVWXYZ|'
001371          TO
001372            '||||||||||||||||||||||||||||||||||||||| '.
001373
001374     IF HOLD-JOBNAME = '||||||||'
001375         MOVE LAST-ACCESSOR OF DSCB1
001376           TO LAST-ACCESSOR OF PRINT-LINE-B
001377     ELSE
001378         MOVE 'UNKNOWN '
001379           TO LAST-ACCESSOR OF PRINT-LINE-B.
001380
001383     MOVE PRINT-LINE-B TO OUTPUT-REC.
001384     PERFORM 5000-WRITE THRU 5999-EXIT-WRITE.
001385     MOVE ASTERISK-SEPARATOR-LINE TO OUTPUT-REC.
001386     PERFORM 5000-WRITE THRU 5999-EXIT-WRITE.
001387     MOVE ALL-ASTERISKS-LINE TO OUTPUT-REC.
001388     PERFORM 5000-WRITE THRU 5999-EXIT-WRITE.
001389     GO TO 9999-QUIT.
001390
001391 5000-WRITE.
001392
001393     WRITE OUTPUT-REC.
001400
001410 5999-EXIT-WRITE.
001420     EXIT.
001430
001440 6000-CONVERT-LAST-ACCESS-DATE.
001450
001460     MOVE BYTE-1 OF LAST-ACCESS-DATE OF DSCB1
001470       TO LAST-ACCESS-YEAR OF YEAR-OF-LAST-ACCESS.
001480
001490     MOVE REDEF-YR-OF-LAST-ACCESS
001500       TO LAST-ACCESS-YEAR OF LAST-ACCESS-DATE-DISPLAY.
001510
001520     MOVE BYTES-2-3 OF LAST-ACCESS-DATE OF DSCB1
001530       TO LAST-ACCESS-DAY OF DAY-OF-LAST-ACCESS.
001540
001550     MOVE REDEF-DAY-OF-LAST-ACCESS
001560       TO LAST-ACCESS-DAY OF LAST-ACCESS-DATE-DISPLAY.
001570
001580     MOVE LAST-ACCESS-DATE-DISPLAY
001590       TO JULIAN-DATE OF JTOSCONV-I-O-AREA.
001600
001610     CALL 'JTOSCONV' USING JTOSCONV-I-O-AREA.
001620
001630     IF INVALID-INPUT-DATE OF JTOSCONV-I-O-AREA = 'YES'
001640         MOVE '??' TO MONTH OF LAST-ACCESS-DATE OF PRINT-LINE-A
001650         MOVE '??' TO DAYY  OF LAST-ACCESS-DATE OF PRINT-LINE-A
001660         MOVE '??' TO YEAR  OF LAST-ACCESS-DATE OF PRINT-LINE-A
001670         GO TO 6999-EXIT.
001680
001690     MOVE MONTH OF STANDARD-DATE OF JTOSCONV-I-O-AREA
001700       TO MONTH OF LAST-ACCESS-DATE OF PRINT-LINE-A.
001710     MOVE DAYY  OF STANDARD-DATE OF JTOSCONV-I-O-AREA
001720       TO DAYY  OF LAST-ACCESS-DATE OF PRINT-LINE-A.
001730     MOVE YEAR  OF STANDARD-DATE OF JTOSCONV-I-O-AREA
001740       TO YEAR  OF LAST-ACCESS-DATE OF PRINT-LINE-A.
001750
001760 6999-EXIT.
001770     EXIT.
001780
001790 9999-QUIT.
001800
001810     CLOSE    OUTPUT-FILE.
001820
001830     MOVE 0 TO RETURN-CODE.
001840
001850     STOP RUN.
