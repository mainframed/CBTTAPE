./ ADD NAME=$$NOTE   0100-00166-00166-1835-00012-00012-00000-WSBG
    In the BCMTRAP exec, you should change the ISRZ000W message
    to ISRZ000, if you don't want to make any ISPF modifications.
    Otherwise, I've included a modified ISRZ00 member here, to
    concatenate ahead of IBM's message member ISRZ00 (from John
    Kalinich).

    The effect of this change is to make a small window that shows
    what program the BCMTRAP exec is running.  Without this change,
    (changing ISRZ000W to ISRZ000 in the BCMTRAP exec), you get a
    message at the top right corner, instead.

./ ADD NAME=BCMDL    0100-00166-00166-1835-00007-00007-00000-WSBG
PROC 1 USR BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMLIST &USR
WRITE ARE YOU SURE YOU WANT TO DELETE THIS USER'S MESSAGES?
READ &ANSX
IF &SUBSTR(1:1,&ANSX) ¬= Y  THEN EXIT
BCMDEL  &USR
./ ADD NAME=BCMDLI   0100-00167-00167-2035-00007-00007-00000-WSBG
PROC 1 USR BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMTRAP BCMLIST &USR
WRITE ARE YOU SURE YOU WANT TO DELETE THIS USER'S MESSAGES?
READ &ANSX
IF &SUBSTR(1:1,&ANSX) ¬= Y  THEN EXIT
BCMTRAP BCMDEL  &USR
./ ADD NAME=BCMDL1   0100-00166-00166-1838-00007-00007-00000-WSBG
PROC 1 USR BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMLIST &USR
WRITE ARE YOU SURE YOU WANT TO DELETE THIS USER'S MESSAGES?
READ &ANSX
IF &SUBSTR(1:1,&ANSX) ¬= Y  THEN EXIT
BCMDEL1 &USR
./ ADD NAME=BCMDL1I  0100-00167-00167-2038-00007-00007-00000-WSBG
PROC 1 USR BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMTRAP BCMLIST &USR
WRITE ARE YOU SURE YOU WANT TO DELETE THIS USER'S MESSAGES?
READ &ANSX
IF &SUBSTR(1:1,&ANSX) ¬= Y  THEN EXIT
BCMTRAP BCMDEL1 &USR
./ ADD NAME=BCMDL2   0100-00166-00166-1833-00007-00007-00000-WSBG
PROC 1 USR BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMLIST &USR
WRITE ARE YOU SURE YOU WANT TO DELETE THIS USER'S MESSAGES?
READ &ANSX
IF &SUBSTR(1:1,&ANSX) ¬= Y  THEN EXIT
BCMDEL2 &USR
./ ADD NAME=BCMDL2I  0100-00167-00167-2036-00007-00007-00000-WSBG
PROC 1 USR BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMTRAP BCMLIST &USR
WRITE ARE YOU SURE YOU WANT TO DELETE THIS USER'S MESSAGES?
READ &ANSX
IF &SUBSTR(1:1,&ANSX) ¬= Y  THEN EXIT
BCMTRAP BCMDEL2 &USR
./ ADD NAME=BCMLST   0100-00166-00166-1805-00003-00003-00000-WSBG
PROC 1 USR BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMLIST &USR
./ ADD NAME=BCMLSTI  0100-00167-00167-2032-00003-00003-00000-WSBG
PROC 1 USR BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMTRAP BCMLIST &USR
./ ADD NAME=BCMTRAP  0101-00167-00168-1141-00042-00042-00000-WSBG
/* Rexx */
Arg bcm_command parm
Trace

Address TSO
"NEWSTACK"
x = outtrap("trap.","*")
bcm_command parm
x= outtrap("off")
"DELSTACK"

dd = "TP"random()
If trap.0 = 0 Then
  Exit

Address TSO
"ALLOC F("dd") UNIT(VIO) NEW REUSE SPACE(1,1) TRACKS",
      "LRECL(255) RECFM(F B) BLKSIZE(0)"
"EXECIO * DISKW" dd "(FINIS STEM trap."

Address ISPEXEC
"ISPEXEC LMINIT DATAID(ID) DDNAME("dd") ENQ(EXCLU)"
If rc ¬= 0 Then
  Say LMINIT failed
zedsmsg = "'"bcm_command parm"'"
zedlmsg = "Output trapped to VIO file "dd
"ISPEXEC SETMSG MSG(ISRZ000W)"

"ISPEXEC VGET (ZVIEW) PROFILE"
If zview = 'YES' Then
  viewm = 'VIEW'
Else
  viewm = 'BROWSE'
"ISPEXEC "viewm" DATAID("id")"
"ISPEXEC LMFREE DATAID("id")"

Address TSO
"FREE F("dd")"

Exit
/* J. Kalinich, x4521 */
/* Exec to trap and display BCM command output in ISPF View/Browse   */
./ ADD NAME=BCMU     0106-00166-00167-2028-00004-00002-00000-WSBG
PROC 0 BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMUSERS
ISPEXEC SELECT PANEL(PTOOLS02)
./ ADD NAME=BCMUA    0100-00166-00166-2015-00006-00006-00000-WSBG
PROC 1 USR BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
WRITE ARE YOU SURE YOU WANT TO ADD THIS NEW USER TO BRODCAST?
READ &ANSX
IF &SUBSTR(1:1,&ANSX) ¬= Y  THEN EXIT
BCMUSADD &USR
./ ADD NAME=BCMUD    0100-00166-00166-2016-00007-00007-00000-WSBG
PROC 1 USR BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMLIST &USR
WRITE ARE YOU SURE YOU WANT TO DELETE THIS USER'S BRODCAST ID?
READ &ANSX
IF &SUBSTR(1:1,&ANSX) ¬= Y  THEN EXIT
BCMUSDEL &USR
./ ADD NAME=BCMUI    0100-00167-00167-2028-00004-00004-00000-WSBG
PROC 0 BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMTRAP BCMUSERS
ISPEXEC SELECT PANEL(PTOOLS02)
./ ADD NAME=BCMUIA   0100-00168-00168-1033-00004-00004-00000-WSBG
PROC 0 BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMTRAP BCMUSERS A
ISPEXEC SELECT PANEL(PTOOLS02)
./ ADD NAME=BCMUT    0103-00166-00166-1730-00005-00002-00000-WSBG
PROC 0 BCAST('SYS1.BRODCAST')
ALLOC F(BRODCAST) DA('&BCAST') SH REUSE
BCMUSERS
READ
ISPEXEC SELECT PANEL(PTOOLS01)
