++USERMOD(ADVW001)  /* INSTALLS SPF COMMAND TO FRONT-END ISPF/PDF
                                                   */ .
++VER(Z038) FMID(HDV2302) .
++JCLIN .
//ADVW001  JOB WC07N0323,'THOMPSON - HSS'
//ADVW001  EXEC LINKS,PARM='MAP,LET,LIST,RENT,REUS,NCAL'
//SYSLMOD  DD DSN=SYS1.ISR.V2R3M0.ISRLOAD,DISP=SHR
//AISRMOD1 DD DISP=SHR,DSNAME=SYS1.AISRMOD1,DISP=SHR
//SYSLIN   DD *
  ORDER ISRPCP
  INCLUDE AISRMOD1(ISRPCP)
  INCLUDE AISRMOD1(SPF)
  MODE AMODE(31),RMODE(24)
  ALIAS ISPF
  ALIAS PDF
  ENTRY SPF
  NAME SPF(R)
++SRC(SPF) DISTLIB(ASRCLIB)  .
         TITLE 'SPF - FRONTEND FOR ISPF/PDF'
**       PRINT NOGEN
**********************************************************************
***               SPF (ALIAS PDF,ISPF) COMMAND                     ***
***   DESC:                                                        ***
***     THIS COMMAND IS A FRONTEND FOR ISPF/PDF.                   ***
***                                                                ***
***   FORMAT:                                                      ***
***        SPF  OPTION  TEST/TESTX/TRACE/TRACEX                    ***
***                                                                ***
***   FUNCTION:                                                    ***
***                                                                ***
***     SPF FIRST FREES DD(ISPPROF), THEN TRIES TO ALLOCATE        ***
***     DD(ISPPROF) TO DSN('&SYSPREF..ISPF.PROFILE') WITH          ***
***     DISP=(OLD,KEEP,KEEP).  IF IT CANNOT ALLOCATE BECAUSE OF    ***
***     LOCATE ERROR 1708 (NOT FOUND IN CATALOG), IT ALLOCATES THE ***
***     DATASET WITH DISP=(NEW,CATLG,CATLG), UNIT=SYSTSO,          ***
***     DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120,DSORG=PO),             ***
***     SPACE=(TRK,(1,2,10)).  FOR ANY OTHER ALLOCATION ERROR      ***
***     CODE, THE PROGRAM TERMINATES AND GIVES THE NORMAL IKJEFF18 ***
***     ERROR MESSAGES.                                            ***
***                                                                ***
***     SPF MAKES A NEW COPY OF THE COMMAND BUFFER (CBUF) AND THE  ***
***     COMMAND PROCESSOR PARAMETER LIST (CPPL), POINTING THE NEW  ***
***     CPPL TO THE NEW CBUF.  SPF THEN PLACES THE LITERAL         ***
***     'ISP' INTO THE NEW CBUF BEGINNING AT THE LOCATION OF THE   ***
***     FIRST NONBLANK CHARACTER OF THE COMMAND TEXT.              ***
***                                                                ***
***     SPF THEN POINTS R1 TO THE NEW CPPL, AND ATTACHES ISRPCP.   ***
***     IT THEN WAITS FOR ISRPCP TO COMPLETE, DETACHES ISRPCP,     ***
***     FREES STORAGE AND TERMINATES.                              ***
***                                                                ***
***   RETURN CODES:                                                ***
***     IF ISP EXECUTES, THE CODE RETURNED IS THE CODE FROM ISP.   ***
***     OTHERWISE THE RETURN CODE IS 12.                           ***
***                                                                ***
***   REGISTER USAGE:                                              ***
***     R0-R3    - USED BY MACROS                                  ***
***     R4-R5    - WORK REGISTERS                                  ***
***     R6-R9    - (UNUSED)                                        ***
***     R10      - LINKAGE REGISTER USED WITH BAL                  ***
***     R11      - BASE OF SP0A1 WORK AREA IN SP-000               ***
***     R12      - BASE REGISTER FOR PROGRAM SPF                   ***
***     R13      - BASE REGISTER FOR AREA OBTAINED IN LINKSAVE,    ***
***                AREA BEGINS WITH REGISTER SAVE AREA             ***
***     R14      - USED BY MACROS                                  ***
***     R15      - USED BY MACROS, RETURN CODE AT END              ***
***                                                                ***
**********************************************************************
         EJECT
**********************************************************************
***                                                                ***
***   MACROS:                                                      ***
***                                                                ***
***     IBM:                                                       ***
***       IKJUPT    - MAP OF THE USER PROFILE TABLE                ***
***       IKJCPPL   - MAP OF THE COMMAND PROCESSOR PARM LIST       ***
***       IEFZB4D0  - MAP OF SVC-99 CONTROL BLOCKS                 ***
***       IKJEFFDF  - MAP OF IKJEFF18 (DAIRFAIL) CONTROL BLOCKS    ***
***       ATTACH    - ATTACH A COMMAND                             ***
***       WAIT      - WAIT FOR AN ECB TO BE POSTED                 ***
***       DETACH    - DETACH A COMMAND                             ***
***       GETMAIN   - GET STORAGE IN SUBPOOL 0                     ***
***       FREEMAIN  - FREE STORAGE IN SUBPOOL 0                    ***
***       TPUT      - WRITE TO THE TERMINAL                        ***
***       TGET      - READ FROM THE TERMINAL                       ***
***                                                                ***
***     GTEL:                                                      ***
***       LINKSAVE  - LINKAGE CONVENTIONS UPON ENTRY, AND OBTAIN   ***
***                   A SMALL AMOUNT OF WORKING STORAGE.           ***
***       EQ$R      - REGISTER EQUATES                             ***
***       LINKBACK  - THE OPPOSITE OF LINKSAVE                     ***
***       GTEDADAT  - CREATE SVC-99 AND IKJEFF18 CONTROL BLOCKS    ***
***       GTEDASET  - INITIALIZE SVC-99 AND IKJEFF18 CONTROL BLKS  ***
***       GTEDAALC  - EXECUTE SVC-99 AND IKJEFF18                  ***
***                                                                ***
***   ASSEMBLER OPTIONS:      RENT                                 ***
***   LINKAGE EDITOR OPTIONS: RENT, REUS                           ***
***                                                                ***
***   CULPRIT:                                                     ***
***     CHUCK HOFFMAN, SYSTEMS PROGRAMMING,                        ***
***     GTE LABORATORIES TECHNICAL COMPUTING CENTER,               ***
***     WALTHAM, MASSACHUSETTS.  617/466-2131.  12/29/82           ***
***                                                                ***
***   MAINTENANCE HISTORY:                                         ***
***                                                                ***
***   GENERAL DYNAMICS:                                            ***
***     FLOYD THOMPSON, SYSTEMS PROGRAMMING,                       ***
***     CHANGED FROM ATTACH TO LINK FOR ISRPCP                     ***
**********************************************************************
         EJECT
**********************************************************************
***                                                                ***
***          MAINLINE                                              ***
***                                                                ***
**********************************************************************
*
SPF      LINKSAVE BASE=12,GETMAIN=YES   LINKAGES PLUS A LITTLE STORAGE
         EQ$R                           REGISTER EQUATES
         USING SP0A0,R13                R13 BASE OF GETMAIN AREA
         ST    R1,CPPLADR               SAVE ADDRESS OF CPPL
*
         BAL   R10,GETSTRGE             GET MORE STORAGE
         USING SP0A1,R11                R11 BASE OF NEW AREA
*
         BAL   R10,CHNGECMD             CREATE ISP COMMAND FROM INPUT
*
         BAL   R10,BILDSN               BILD DSN &SYSPREF..ISPF.PROFILE
*
         BAL   R10,OLDALLOC                     ALLOCATE DATASET OLD
         CLC   RETCDE,HWZERO                    IF OKAY
         BE    ISP                                GO TO PERFORM ISPF
         LA    R4,OLDRB                         ELSE
         CLC   (S99ERROR-S99RB)(2,R4),LOCERR08  IF NOT 'NOT IN CATLG'
         BNE   RETCDE12                           BRANCH TO END OF PGM
*
         BAL   R10,NEWALLOC                     ELSE ALLOCATE NEW
         CLC   RETCDE,HWZERO                    IF NOT OKAY
         BNE   RETCDE12                           BRANCH TO END OF PGM
*
ISP      BAL   R10,ATTCHISP             PERFORM ISPF PROCEDURE
         B     ENDING                   GO TO ENDING
*
RETCDE12 MVC   COMPCDE(4),FW12          IF BAD ALLOCATION, SET RC=12
*
ENDING   FREEMAIN R,LV=SP0A1LEN,A=(11)  FREE MAIN STORAGE
         L     R15,COMPCDE              LOAD COMPLETION CODE TO R15
         LINKBACK                       RETURN TO CALLER
         EJECT
**********************************************************************
***                                                                ***
***  GET MAIN STORAGE FOR WORK AREA.                               ***
***                                                                ***
**********************************************************************
GETSTRGE ST    R10,GER10SAV             SAVE RETURN ADDRESS
         XC    RETCDE,RETCDE            SET ERROR CODE TO ZERO
*
         GETMAIN R,LV=SP0A1LEN        , GET MAIN STORAGE
         LR    R11,R1                   R11 POINTS TO NEW AREA
*
GEEND    L     R10,GER10SAV             RESTORE RETURN ADDRESS
         BR    R10                      RETURN
         EJECT
**********************************************************************
***                                                                ***
***   CREATE NEW ISP COMMAND BUFFER FROM OLD SPF COMMAND           ***
***                                                                ***
**********************************************************************
CHNGECMD ST    R10,CHR10SAV             SAVE RETURN ADDRESS
         XC    RETCDE,RETCDE            SET ERROR CODE TO ZERO
*
         L     R4,CPPLADR               R4 POINTS TO CPPL
         MVC   NCPPL(16),0(R4)          COPY CPPL TO NEW CPPL
         LA    R4,NCPPL                 SAVE ADDR OF
         ST    R4,NCPPLADR                OF NEW CPPL
         LA    R4,NCBUF                 PLACE ADDR OF NEW CMMD
         ST    R4,NCPPL+(CPPLCBUF-CPPL)   INTO NEW CPPL
*
         L     R4,CPPLADR               R4 POINTS TO CPPL
         L     R4,(CPPLCBUF-CPPL)(0,R4) R4 POINTS TO OLD CBUF
         LH    R5,0(0,R4)               R5 IS LEN OF OLD CBUF
         BCTR  R5,0                       MINUS ONE FOR EXEC
         EX    R5,CHMVC1                MOVE OLD BUFFER TO NEW
*
         LA    R4,NCBUFTXT-1            R4 PNTS 1 CHAR BEFORE NCBUFTXT
CHLOOP1  LA    R4,1(0,R4)               R4 POINTS TO NEXT CHAR IN TEXT
         CLI   0(R4),X'40'              IF BLANK,
         BE    CHLOOP1                    STAY IN LOOP
         MVC   0(3,R4),CHISP            MOVE 'ISP' OVER 'PDF' OR 'SPF'
*
CHEND    L     R10,CHR10SAV             RESTORE RETURN ADDRESS
         BR    R10                      RETURN
*
CHMVC1   MVC   NCBUF(0),0(R4)           MOVE OLD BUFFER TO NEW
         EJECT
**********************************************************************
***                                                                ***
***   BUILD DATASET NAME '&SYSPREF..ISPF.PROFILE'                  ***
***                                                                ***
**********************************************************************
BILDSN   ST    R10,BIR10SAV             SAVE RETURN ADDRESS
         XC    RETCDE,RETCDE            SET ERROR CODE TO ZERO
*
         MVC   PROFDSN(44),BLANK44      CLEAR DSN FIELD
         XR    R4,R4                    CLEAR R4 FOR IC
         L     R5,CPPLADR               ADDR OF CPPL TO R5
         L     R5,(CPPLUPT-CPPL)(0,R5)  R5 POINTS TO UPT
         IC    R4,(UPTPREFL-UPT)(0,R5)  R4 IS LENGTH OF PREFIX
         BCTR  R4,0                       MINUS ONE FOR EXEC
         EX    R4,BIMVC1                MOVE &SYSPREF TO PROFILE DSN
*
         LA    R5,PROFDSN               R5 IS ADDR OF PROFILE DSN
         AR    R5,R4                    R5 IS ADDR OF LAST CHAR OF PREF
         MVI   1(R5),C'.'               PUT DOT INTO NAME
         MVC   2(12,R5),LOWDSN          MOVE LOW END OF DSN TO NAME
*
         LA    R4,14(0,R4)              R4 IS LENGTH OF PROFILE DSN
         STH   R4,PROFDSLN              SAVE THE LENGTH
*
BIEND    L     R10,BIR10SAV             RESTORE RETURN ADDRESS
         BR    R10                      RETURN
*
*
BIMVC1   MVC   PROFDSN(0),(UPTPREFX-UPT)(R5)  MOVE &SYSPREF TO PROF DSN
         EJECT
**********************************************************************
***                                                                ***
*** TRY TO ALLOCATE '&SYSPREF..ISPF.PROFILE'  DISP=(OLD,KEEP,KEEP) ***
***                                                                ***
**********************************************************************
OLDALLOC ST    R10,OLR10SAV             SAVE RETURN ADDRESS
         XC    RETCDE,RETCDE            SET ERROR CODE TO ZERO
*
         MVC   FRE(@FRLEN),@FR          COPY DATA TO WORK AREA
         GTEDASET FRE,CPPLPTR=NCPPLADR  INITIALIZE WORK DATA
         GTEDAALC FRE,VERB=UN           FREE DD(ISPPROF)
*
         MVC   OLD(@OLLEN),@OL          COPY DATA TO WORK AREA
         GTEDASET OLD,CPPLPTR=NCPPLADR  INITIALIZE WORK DATA
         MVC   OLDDSNAM(44),PROFDSN     MOVE DSN TO WORK DATA
         GTEDAALC OLD,VERB=AL,ERRMSG=NO TRY TO ALLOCATE OLD (NOMSG)
         MVC   RETCDE(2),OLDS99RC+2     MOVE SVC-99 RC TO PROC RETCDE
*
OLEND    L     R10,OLR10SAV             RESTORE RETURN ADDRESS
         BR    R10                      RETURN
         EJECT
**********************************************************************
***                                                                ***
*** TRY TO ALLOCATE '&SYSPREF..ISPF.PROFILE' DISP=(NEW,CATLG,CATLG)***
***                                                                ***
**********************************************************************
NEWALLOC ST    R10,NER10SAV             SAVE RETURN ADDRESS
         XC    RETCDE,RETCDE            SET ERROR CODE TO ZERO
*
         GTEDAALC FRE,VERB=UN           FREE DD(ISPPROF)
*
         MVC   NEW(256),@NE             COPY DATA TO WORK AREA
         MVC   NEW+256(@NELEN-256),@NE+256 COPY THE REST OF IT
         GTEDASET NEW,CPPLPTR=NCPPLADR  INITIALIZE WORK DATA
         MVC   NEWDSNAM(44),PROFDSN     MOVE DSN TO WORK DATA
         GTEDAALC NEW,VERB=AL           TRY TO ALLOCATE NEW
         MVC   RETCDE(2),NEWS99RC+2     MOVE SVC-99 RC TO PROC RETCDE
*
NEEND    L     R10,NER10SAV             RESTORE RETURN ADDRESS
         BR    R10                      RETURN
         EJECT
**********************************************************************
***                                                                ***
***     ATTACH ISRPCP COMMAND PROCESSOR                            ***
***                                                                ***
**********************************************************************
ATTCHISP ST    R10,ATR10SAV             SAVE RETURN ADDRESS
         XC    RETCDE,RETCDE            SET ERROR CODE TO ZERO
*
         L     R1,NCPPLADR              LOAD POINTER TO NEW CPPL
         L     R15,=V(ISRPCP)           GET ISRPCP ADDRESS
         BALR  R14,R15                  OFF TO ISPF
*        LINK   EP=ISRPCP               LINK TO SPF ISRPCP
*        ST    R15,COMPCDE              SAVE COMPLETION CODE
*        ATTACH EP=ISRPCP,              ATTACH ISRPCP                  X
               ECB=ISPECB,                                             X
               SHSPV=78,                                               X
               SF=(E,LISTATT)
*        ST    R1,ISPTCBAD              SAVE TCB ADDRESS
*        WAIT  ECB=ISPECB             , WAIT FOR ISPF TO COMPLETE
*        ST    R15,COMPCDE              SAVE COMPLETION CODE
*        DETACH ISPTCBAD              , DETACH ISPF
*
ATEND    L     R10,ATR10SAV             RESTORE RETURN ADDRESS
         BR    R10                      RETURN
         EJECT
**********************************************************************
***      DATA CONSTANTS                                            ***
**********************************************************************
CONSTNTS DS    0F
BLANK44  DC    CL44' '                  CLEAR DSN
LOWDSN   DC    CL12'ISPF.PROFILE'       LOWER END OF DSN
@FR      GTEDADAT DDNAM=ISPPROF,UNALC=YES
@OL      GTEDADAT DDNAM=ISPPROF,DSNAM=00,STATS=OLD,NDISP=KEEP,         X
               CDISP=KEEP,CNVRT=YES
@NE      GTEDADAT DDNAM=ISPPROF,DSNAM=00,STATS=NEW,NDISP=CATLG,        X
               CDISP=CATLG,CNVRT=YES,TRK=YES,PRIME=1,SECND=2,DIR=10,   X
               UNIT=SYSTSO,BLKSZ=3120,DSORG=PO,LRECL=80,               X
               RECFM=FB
CHISP    DC    CL3'ISP'                 NEW COMMAND NAME
HWZERO   DC    H'0'                     ZERO ERROR CODE
LOCERR08 DC    X'1708'                  LOCATE ERR CODE 08 (NOT CATLG)
FW12     DC    F'12'                    COMPLETION CODE 12
         EJECT
**********************************************************************
***     AREA OBTAINED WITH LINKSAVE GETMAIN=YES,  ADDRESSED BY R13 ***
**********************************************************************
SP0A0    DSECT
MYSAVE   DS    18F                      REGISTER SAVE AREA
CPPLADR DS     F                        ADDRESS OF CPPL
GER10SAV DS    F                        RETURN ADDR SAVE AREA
COMPCDE  DS    F                        FINAL COMPLETION CODE
RETCDE   DS    H                        RETURN CODE FROM PROC BLOCKS
         DS    CL50                     UNUSED
         EJECT
**********************************************************************
***      WORK STORAGE AREA, ADDRESSED BY R11                       ***
**********************************************************************
SP0A1    DSECT
         DS    0D
NCBUF    DS    0CL255                   NEW COMMAND BUFFER
NCBUFLN  DS    H                          LENGTH
NCBUFOFF DS    H                          OFFSET
NCBUFTXT DS    CL251                      TEXT
NCPPLADR DS    A
NCPPL    DS    4F                       NEW COMMAND CPPL
LISTATT  ATTACH EP=ISRPCP,ECB=ISPECB,SHSPV=78,SF=L  ATTACH LIST
ISPECB   DS    F                        ECB FOR ATTACHED ISPF
ISPTCBAD DS    F                        ISPF TCB ADDRESS
CHR10SAV DS    F                        RETURN ADDRESS SAVE AREA
BIR10SAV DS    F                        RETURN ADDRESS SAVE AREA
OLR10SAV DS    F                        RETURN ADDRESS SAVE AREA
NER10SAV DS    F                        RETURN ADDRESS SAVE AREA
ATR10SAV DS    F                        RETURN ADDRESS SAVE AREA
PROFDSLN DS    H                        LENGTH OF DSN OF PROFILE DS
PROFDSN  DS    CL44                     DSN OF PROFILE DATASET
FRE      GTEDADAT DDNAM=ISPPROF,UNALC=YES,MAP=ONLY
OLD      GTEDADAT DDNAM=ISPPROF,DSNAM=00,STATS=OLD,NDISP=KEEP,         X
               CDISP=KEEP,CNVRT=YES,MAP=ONLY
NEW      GTEDADAT DDNAM=ISPPROF,DSNAM=00,STATS=NEW,NDISP=CATLG,        X
               CDISP=CATLG,CNVRT=YES,TRK=YES,PRIME=1,SECND=2,DIR=10,   X
               UNIT=SYSTSO,BLKSZ=3120,DSORG=PO,LRECL=80,               X
               RECFM=FB,MAP=ONLY
SP0A1END DS    0D                       D/W BOUNDRY FOR GETMAIN
SP0A1LEN EQU   SP0A1END-SP0A1           EQUATE FOR LENGTH
         EJECT
**********************************************************************
***      MAPPING DSECTS                                            ***
**********************************************************************
         PRINT NOGEN
         SPACE 3
UPT      IKJUPT                         USER PROFILE TABLE
         SPACE 3
CPPL     IKJCPPL                        COMMAND PROCESSOR PARM LIST
         SPACE 3
         IEFZB4D0
         SPACE 3
         IKJEFFDF DFDSECT=YES,DFDSEC2=YES
         END
++MAC(EQ$R) DISTLIB(ISPAMAC) SYSLIB(ISPMACS) .
         MACRO
         EQ$R
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         MEND
++MAC(LINKSAVE) DISTLIB(ISPAMAC) SYSLIB(ISPMACS) .
         MACRO
&CSNAME  LINKSAVE &BASE=,&GETMAIN=NO
.*********************************************************************
.*  MACRO FOR STANDARD LINKAGE CONVENTIONS AT PROGRAM ENTRY.       ***
.*  USED IN CONJUNCTION WITH THE LINKBACK MACRO.                   ***
.*                                                                 ***
.*  BASE=NN     REGISTER NUMBER OF BASE REGISTER.                  ***
.*                                                                 ***
.*  GETMAIN=YES WILL DO A GETMAIN FOR STORAGE SPACE.  SPACE        ***
.*              OBTAINED WILL BE 72 BYTES FOR SAVE AREA, PLUS      ***
.*              64 BYTES FOR PROGRAMMER'S USE.  R13 WILL BE        ***
.*              THE BASE ADDRESS OF THE STORAGE AREA.              ***
.*                                                                 ***
.*  CHUCK HOFFMAN, SYSTEMS PROGRAMMING, GTEL COMPUTING CENTER      ***
.*********************************************************************
         GBLC  &GMN
         LCLA  &C,&D
&GMN     SETC  '&GETMAIN'
         AIF   ('&GMN' EQ 'YES').FORM2
&CSNAME  CSECT
&C       SETA  K'&CSNAME
&D       SETA  ((20+&C)/2)*2
         B     &D.(0,15)                BRANCH AROUND ID
         DC    AL1(&C)                    LENGTH
         DC    CL&C'&CSNAME'              ID
         DC    CL8'&SYSDATE'              SYSTEM DATE:  MM/DD/YY
         DC    CL6' &SYSTIME'             SYSTEM TIME:  HH.MM
         STM   14,12,12(13)             SAVE R0-R12, R14-R15
         LR    &BASE,15                 LOAD BASE ADDRESS
         USING &CSNAME,&BASE            ASSIGN BASE REGISTER
         ST    13,MYSV&SYSNDX+4         STORE ADDR OF PREV SAVE AREA
*                                         INTO MY SAVE AREA
         LA    14,MYSV&SYSNDX           LOAD ADDR OF MY SAVE AREA
         ST    14,8(0,13)                 STORE IT INTO PREV SAVE AREA
         LR    13,14                      ALSO LOAD IT INTO R13
         B     MYSV&SYSNDX+72           BRANCH AROUND MY SAVE AREA
MYSV&SYSNDX DC 18F'0'                   MY SAVE AREA
         MEXIT
.FORM2   ANOP
&CSNAME  CSECT
&C       SETA  K'&CSNAME
&D       SETA  ((20+&C)/2)*2
         B     &D.(0,15)                BRANCH AROUND ID
         DC    AL1(&C)                    LENGTH
         DC    CL&C'&CSNAME'              ID
         DC    CL8'&SYSDATE'              SYSTEM DATE:  MM/DD/YY
         DC    CL6' &SYSTIME'             SYSTEM TIME:  HH.MM
         STM   14,12,12(13)             SAVE R0-R12, R14-R15
         LR    &BASE,15                 LOAD BASE ADDRESS
         USING &CSNAME,&BASE            ASSIGN BASE REGISTER
*        GETMAIN R,LV=136               GET STORAGE FOR S.A. + 64 BYTES
         GETMAIN R,LV=136               GET STORAGE FOR S.A. + 64 BYTES
         ST    13,4(0,1)                STORE ADDR OF PREV SAVE AREA
*                                         INTO MY SAVE AREA
         ST    1,8(0,13)                ADDR OF MY SA TO PREV SAVE AREA
         LM    0,1,20(13)               RESTORE R0-R1 TO ORIGINAL VALUE
         L     13,8(0,13)               POINT R13 TO MY SAVE AREA
         MEND
++MAC(LINKBACK) DISTLIB(ISPAMAC) SYSLIB(ISPMACS) .
         MACRO
&ENDNAME LINKBACK &RCADDR=
.*********************************************************************
.*  MACRO FOR STANDARD LINKAGE CONVENTIONS AT PROGRAM EXIT.        ***
.*  USED IN CONJUNCTION WITH THE LINKSAVE MACRO.                   ***
.*                                                                 ***
.*  RCADDR=NAME   NAME OF FULLWORD RETURN CODE TO BE LOADED        ***
.*                INTO R15.  IF THIS OPERAND IS NOT USED, THE      ***
.*                RETURN CODE WILL BE THE VALUE CONTAINED IN R15   ***
.*                JUST PRIOR TO ENTERING THE CODE GENERATED BY     ***
.*                THIS MACRO.                                      ***
.*                                                                 ***
.* NOTE -                                                          ***
.*  IF GETMAIN=YES WAS USED WITH LINKSAVE, THIS MACRO WILL         ***
.*  FREEMAIN THE STORAGE AREA WHICH LINKSAVE GOTMAINED.            ***
.*                                                                 ***
.*  CHUCK HOFFMAN, SYSTEMS PROGRAMMING, GTEL COMPUTING CENTER      ***
.*********************************************************************
         GBLC  &GMN
         LCLA  &RCLEN
&RCLEN   SETA  K'&RCADDR               LENGTH OF NAME OF RETURN CODE
         AIF ('&GMN' EQ 'YES').FORM2   IF LINKSAVE USED A GETMAIN, GO
&ENDNAME L     13,4(0,13)              RESTORE R13 FROM MY SAVE AREA
         AIF (&RCLEN EQ 0).FORM1A
         L     15,&RCADDR              SET RETURN CODE
.FORM1A  ANOP
         LM    0,12,20(13)             RESTORE R0-12
         L     14,12(0,13)             RESTORE R14
         MVI   12(13),X'FF'            RETURN INDICATOR
         BR    14                      RETURN TO CALLING PROGRAM
         MEXIT
.FORM2   ANOP
&ENDNAME LR    1,13                    COPY MY SA ADDR FOR FREEMAIN
         AIF (K'&RCADDR EQ 0).FORM2C
         L     14,&RCADDR              SAVE RETURN CODE
         AGO .FORM2A
.FORM2C  LR    14,15                   SAVE RETURN CODE
.FORM2A  ANOP
         L     13,4(0,13)              RESTORE R13 FROM MY SAVE AREA
*        FREEMAIN R,LV=136,A=(1)       FREE STORAGE
         FREEMAIN R,LV=136,A=(1)       FREE STORAGE
         LR    15,14                   SET RETURN ADDRESS
.FORM2B  ANOP
         LM    0,12,20(13)             RESTORE R0-12
         L     14,12(0,13)             RESTORE R14
         MVI   12(13),X'FF'            RETURN INDICATOR
         BR    14                      RETURN TO CALLING PROGRAM
         MEND
++MAC(GTEDADAT) DISTLIB(ISPAMAC) SYSLIB(ISPMACS) .
         MACRO
&NM      GTEDADAT  &MAP=,&DDNAM=,&DSNAM=,&MEMBR=,&STATS=,              X
               &NDISP=,&CDISP=,                                        X
               &TRK=,&CYL=,&BLKLN=,&PRIME=,&SECND=,&DIR=,&RLSE=,       X
               &SPFRM=,&ROUND=,&VLSER=,&PRIVT=,&VLSEQ=,&VLCNT=,        X
               &VLRDS=,&UNIT=,&UNCNT=,&PARAL=,&SYSOU=,&SPGNM=,&SFMNO=, X
               &OUTLM=,&CLOSE=,&COPYS=,&LABEL=,&DSSEQ=,&PASPR=,        X
               &INOUT=,&EXPDT=,&RETPD=,&DUMMY=,&FCBIM=,&FCBAV=,        X
               &QNAME=,&TERM=,&UCS=,&UFOLD=,&UVRFY=,&DCBDS=,&DCBDD=,   X
               &SUSER=,&SHOLD=,&MSVGP=,&SSNM=,&PROT=,&BFALN=,&BFTEK=,  X
               &BLKSZ=,&BUFIN=,&BUFL=,&BUFMX=,&BUFNO=,&BUFOF=,&BUFOU=, X
               &BUFRQ=,&BUFSZ=,&CODE=,&CPRI=,&DEN=,&DSORG=,&EROPT=,    X
               &GNCP=,&INTVL=,&KYLEN=,&LIMCT=,&LRECL=,&MODE=,&NCP=,    X
               &OPTCD=,&PCIR=,&PCIS=,&PRTSP=,&RECFM=,&RSRVF=,&RSRVS=,  X
               &SOWA=,&STACK=,&THRSH=,&TRTCH=,&IPLTX=,&DIAGN=,&FUNC=,  X
               &FRID=,&PASSW=,&PERMA=,&CNVRT=,                         X
               &RTDDN=,&RTDSN=,&RTORG=,       <== FOR DSN ALLOCATION   X
               &INDDN=,&INDSN=,&INORG=,       <== FOR INFO RETRIEVAL   X
               &RTMEM=,&RTSTA=,&RTNDP=,&RTCDP=,&RTLIM=,&RTATT=,        X
               &RTLST=,&RTTYP=,&RELNO=,                                X
               &RTVOL=,&SSPRM=,&TCBAD=,&REMOV=,&UNALC=
.*
.*          +-----------------------------------------------+
.*          |  SEE MACRO GTEDADOC FOR DOCUMENTATION OF THE  |
.*          |  USE OF THIS AND OTHER GTEDAXXX MACROS.       |
.*          +-----------------------------------------------+
.*
           LCLA  &TUPLEN
&TUPLEN    SETA  0
*
&NM        DS  0D                       ALIGN FOR GETMAIN
*
**********************************************************************
***        TEXT UNITS FOR SVC99                                    ***
**********************************************************************
*
&NM.TU     DS  0F   TEXT UNITS FOR SVC99
.*
.*********************************************************************
.***       DSNAME ALLOCATION TEXT UNITS - VERB CODE 01             ***
.*********************************************************************
.*
.TUDDNAM   AIF ('&DDNAM' EQ '').TUDSNAM
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUDDNA#
           DS  XL6
&NM.DDNAM  DS  CL8                      DDNAME
           AGO .TUDSNAM
.TUDDNA#   ANOP
           DC  X'0001,0001,0008'
&NM.DDNAM  DC  CL8'&DDNAM'              DDNAME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUDSNAM   AIF ('&DSNAM' EQ '').TUMEMBR
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUDSNA#
           DS  XL6
&NM.DSNAM  DS  CL44                     DATASET NAME
           AGO .TUMEMBR
.TUDSNA#   ANOP
           DC  X'0002,0001,002C'        DATASET NAME (NEXT LINE)
&NM.DSNAM  DC  CL44'&DSNAM'
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUMEMBR   AIF ('&MEMBR' EQ '').TUSTATS
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUMEMB#
&NM.MEMKY  DS  XL6
&NM.MEMBR  DS  CL8                      MEMBER NAME
           AGO .TUSTATS
.TUMEMB#   ANOP
&NM.MEMKY  DC  X'0003,0001,0008'
&NM.MEMBR  DC  CL8'&MEMBR'              MEMBER NAME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUSTATS   AIF ('&STATS' EQ '').TUNDISP
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUSTAT#
&NM.STATS  DS  XL7                      STATUS
           AGO .TUNDISP
.TUSTAT#   AIF ('&STATS' NE 'OLD').TUSTAT2
&NM.STATS  DC  X'0004,0001,0001,01'     STATUS=OLD
           AGO .TUNDISP
.TUSTAT2   AIF ('&STATS' NE 'MOD').TUSTAT4
&NM.STATS  DC  X'0004,0001,0001,02'     STATUS=MOD
           AGO .TUNDISP
.TUSTAT4   AIF ('&STATS' NE 'NEW').TUSTAT8
&NM.STATS  DC  X'0004,0001,0001,04'     STATUS=NEW
           AGO .TUNDISP
.TUSTAT8   AIF ('&STATS' NE 'SHR').TUNDISP
&NM.STATS  DC  X'0004,0001,0001,08'     STATUS=SHR
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUNDISP   AIF ('&NDISP' EQ '').TUCDISP
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUNDIS#
&NM.NDISP  DS  XL7                      NORMAL DISP
           AGO .TUCDISP
.TUNDIS#   AIF ('&NDISP' NE 'UNCATLG').TUNDIS2
&NM.NDISP  DC  X'0005,0001,0001,01'     NORMAL DISP=UNCATLG
           AGO .TUCDISP
.TUNDIS2   AIF ('&NDISP' NE 'CATLG').TUNDIS4
&NM.NDISP  DC  X'0005,0001,0001,02'     NORMAL DISP=CATLG
           AGO .TUCDISP
.TUNDIS4   AIF ('&NDISP' NE 'DELETE').TUNDIS8
&NM.NDISP  DC  X'0005,0001,0001,04'     NORMAL DISP=DELETE
           AGO .TUCDISP
.TUNDIS8   AIF ('&NDISP' NE 'KEEP').TUCDISP
&NM.NDISP  DC  X'0005,0001,0001,08'     NORMAL DISP=KEEP
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUCDISP   AIF ('&CDISP' EQ '').TUTRK
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUCDIS#
&NM.CDISP  DS  XL7                      COND DISP
           AGO .TUTRK
.TUCDIS#   AIF ('&CDISP' NE 'UNCATLG').TUCDIS2
&NM.CDISP  DC  X'0006,0001,0001,01'     COND DISP=UNCATLG
           AGO .TUTRK
.TUCDIS2   AIF ('&CDISP' NE 'CATLG').TUCDIS4
&NM.CDISP  DC  X'0006,0001,0001,02'     COND DISP=CATLG
           AGO .TUTRK
.TUCDIS4   AIF ('&CDISP' NE 'DELETE').TUCDIS8
&NM.CDISP  DC  X'0006,0001,0001,04'     COND DISP=DELETE
           AGO .TUTRK
.TUCDIS8   AIF ('&CDISP' NE 'KEEP').TUTRK
&NM.CDISP  DC  X'0006,0001,0001,08'     COND DISP=KEEP
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUTRK     AIF ('&TRK' EQ '').TUCYL
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUTRKA
&NM.TRK    DS  XL4                      TRK
           AGO .TUCYL
.TUTRKA    ANOP
&NM.TRK    DC  X'0007,0000'             TRK
           AGO .TUPRIME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUCYL     AIF ('&CYL' EQ '').TUBLKLN
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUCYLA
&NM.CYL    DS  XL4                      CYL
           AGO .TUBLKLN
.TUCYLA    ANOP
&NM.CYL    DC  X'0008,0000'             CYL
           AGO .TUPRIME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBLKLN   AIF ('&BLKLN' EQ '').TUPRIME
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBLKL#
           DS  XL6
&NM.BLKLN  DS  AL3                      AVERAGE BLOCK LENGTH
           AGO .TUPRIME
.TUBLKL#   ANOP
           DC  X'0009,0001,0003'
&NM.BLKLN  DC  AL3(&BLKLN)              AVERAGE BLOCK LENGTH
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUPRIME   AIF ('&PRIME' EQ '').TUSECND
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUPRIM#
           DS  XL6
&NM.PRIME  DS  AL3                      PRIMARY SPACE QUANTITY
           AGO .TUSECND
.TUPRIM#   ANOP
           DC  X'000A,0001,0003'
&NM.PRIME  DC  AL3(&PRIME)              PRIMARY SPACE QUANTITY
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUSECND   AIF ('&SECND' EQ '').TUDIR
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUSECN#
           DS  XL6
&NM.SECND  DS  AL3                      SECONDARY SPACE QUANTITY
           AGO .TUDIR
.TUSECN#   ANOP
           DC  X'000B,0001,0003'
&NM.SECND  DC  AL3(&SECND)              SECONDARY SPACE QUANTITY
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUDIR     AIF ('&DIR' EQ '').TURLSE
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUDIRA
           DS  XL6
&NM.DIR    DS  AL3                      NUMBER OF DIRECTORY BLOCKS
           AGO .TURLSE
.TUDIRA    ANOP
           DC  X'000C,0001,0003'
&NM.DIR    DC  AL3(&DIR)                NUMBER OF DIRECTORY BLOCKS
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURLSE    AIF ('&RLSE' EQ '').TUSPFRM
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURLSEA
&NM.RLSE   DS  XL4                      RLSE
           AGO .TUSPFRM
.TURLSEA   ANOP
&NM.RLSE   DC  X'000D,0000'             RLSE
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUSPFRM   AIF ('&SPFRM' EQ '').TUROUND
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUSPFR#
&NM.SPFRM  DS  XL7                      SPACE FORMAT
           AGO .TUROUND
.TUSPFR#   AIF ('&SPFRM' NE 'ALX').TUSPFR4
&NM.SPFRM  DC  X'000E,0001,0001,02'     ALX
           AGO .TUROUND
.TUSPFR4   AIF ('&SPFRM' NE 'MXIG').TUSPFR8
&NM.SPFRM  DC  X'000E,0001,0001,04'     MXIG
           AGO .TUROUND
.TUSPFR8   AIF ('&SPFRM' NE 'CONTIG').TUROUND
&NM.SPFRM  DC  X'000E,0001,0001,08'     CONTIG
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUROUND   AIF ('&ROUND' EQ '').TUVLSER
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUROUN#
&NM.ROUND  DS  XL4                      ROUND
           AGO .TUVLSER
.TUROUN#   ANOP
&NM.ROUND  DC  X'000F,0000'             ROUND
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUVLSER   AIF ('&VLSER' EQ '').TUPRIVT
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUVLSE#
           DS  XL6
&NM.VLSER  DS  CL6                      VOLUME SERIAL NUMBER
           AGO .TUPRIVT
.TUVLSE#   ANOP
           DC  X'0010,0001,0006'
&NM.VLSER  DC  CL6'&VLSER'              VOLUME SERIAL NUMBER
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUPRIVT   AIF ('&PRIVT' EQ '').TUVLSEQ
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUPRIV#
&NM.PRIVT  DS  XL4                      PVT
           AGO .TUVLSEQ
.TUPRIV#   ANOP
&NM.PRIVT  DC  X'0011,0000'             PVT
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUVLSEQ   AIF ('&VLSEQ' EQ '').TUVLCNT
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUVLSQ#
           DS  XL6
&NM.VLSEQ  DS  AL2                      VOLUME SEQUENCE NUMBER
           AGO .TUVLCNT
.TUVLSQ#   ANOP
           DC  X'0012,0001,0002'
&NM.VLSEQ  DC  AL2(&VLSEQ)              VOLUME SEQUENCE NUMBER
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUVLCNT   AIF ('&VLCNT' EQ '').TUVLRDS
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUVLCN#
           DS  XL6
&NM.VLCNT  DC  AL1                      VOLUME COUNT
           AGO .TUVLRDS
.TUVLCN#   ANOP
           DC  X'0013,0001,0001'
&NM.VLCNT  DC  AL1(&VLCNT)              VOLUME COUNT
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUVLRDS   AIF ('&VLRDS' EQ '').TUUNIT
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUVLRD#
           DS  XL6
&NM.VLRDS  DS  CL44                     VOLUME REF TO THIS DSN
           AGO .TUUNIT
.TUVLRD#   ANOP
           DC  X'0014,0001,002C'        VOLUME REF TO DSN (BELOW)
&NM.VLRDS  DC  CL44'&VLRDS'
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUUNIT    AIF ('&UNIT' EQ '').TUUNCNT
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUUNITA
           DS  XL6
&NM.UNIT   DS  CL6                      UNIT
           AGO .TUUNCNT
.TUUNITA   ANOP
           DC  X'0015,0001,0006'
&NM.UNIT   DC  CL6'&UNIT'               UNIT
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUUNCNT   AIF ('&UNCNT' EQ '').TUPARAL
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUUNCN#
           DS  XL6
&NM.UNCNT  DS  AL1                      UNIT COUNT
           AGO .TUPARAL
.TUUNCN#   ANOP
           DC  X'0016,0001,0001'
&NM.UNCNT  DC  AL1(&UNCNT)              UNIT COUNT
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUPARAL   AIF ('&PARAL' EQ '').TUSYSOU
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUPARA#
&NM.PARAL  DS  XL4                      PARALLEL MOUNT
           AGO .TUSYSOU
.TUPARA#   ANOP
&NM.PARAL  DC  X'0017,0000'             PARALLEL MOUNT
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUSYSOU   AIF ('&SYSOU' EQ '').TUSPGNM
           AIF ('&SYSOU' NE '*').TUSYSO2
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUSYSO#
&NM.SYSOU  DS  XL4                      SYSOUT=*
           AGO .TUSPGNM
.TUSYSO#   ANOP
&NM.SYSOU  DC  X'0018,0000'             SYSOUT=*
           AGO .TUSPGNM
.TUSYSO2   ANOP
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUSYS##
           DS  XL6
&NM.SYSOU  DS  CL1                      SYSOUT CLASS
           AGO .TUSPGNM
.TUSYS##   ANOP
           DC  X'0018,0001,0001'
&NM.SYSOU  DC  CL1'&SYSOU'              SYSOUT CLASS
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUSPGNM   AIF ('&SPGNM' EQ '').TUSFMNO
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUSPGN#
           DS  XL6
&NM.SPGNM  DS  CL8                      SYSOUT PROGRAM NAME
           AGO .TUSFMNO
.TUSPGN#   ANOP
           DC  X'0019,0001,0008'
&NM.SPGNM  DC  CL8'&SPGNM'              SYSOUT PROGRAM NAME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUSFMNO   AIF ('&SFMNO' EQ '').TUOUTLM
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUSFMN#
           DS  XL6
&NM.SFMNO  DS  CL4                      SYSOUT FORM NAME/NUMBER
           AGO .TUOUTLM
.TUSFMN#   ANOP
           DC  X'001A,0001,0004'
&NM.SFMNO  DC  CL4'&SFMNO'              SYSOUT FORM NAME/NUMBER
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUOUTLM   AIF ('&OUTLM' EQ '').TUCLOSE
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUOUTL#
           DS  XL6
&NM.OUTLM  DS  AL3                      OUTLIM
           AGO .TUCLOSE
.TUOUTL#   ANOP
           DC  X'001B,0001,0003'
&NM.OUTLM  DC  AL3(&OUTLM)              OUTLIM
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUCLOSE   AIF ('&CLOSE' EQ '').TUCOPYS
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUCLOS#
&NM.CLOSE  DS  XL4                      FREE=CLOSE
           AGO .TUCOPYS
.TUCLOS#   ANOP
&NM.CLOSE  DC  X'001C,0000'             FREE=CLOSE
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUCOPYS   AIF ('&COPYS' EQ '').TULABEL
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUCOPY#
           DS  XL6
&NM.COPYS  DS  AL1                      COPIES
           AGO .TULABEL
.TUCOPY#   ANOP
           DC  X'001D,0001,0001'
&NM.COPYS  DC  AL1(&COPYS)              COPIES
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TULABEL   AIF ('&LABEL' EQ '').TUDSSEQ
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TULABE#
&NM.LABEL  DS  XL7                      LABEL
           AGO .TUDSSEQ
.TULABE#   AIF ('&LABEL' NE 'NL').TULABE2
&NM.LABEL  DC  X'001E,0001,0001,01'     LABEL=NL
           AGO .TUDSSEQ
.TULABE2   AIF ('&LABEL' NE 'SL').TULABE3
&NM.LABEL  DC  X'001E,0001,0001,02'     LABEL=SL
           AGO .TUDSSEQ
.TULABE3   AIF ('&LABEL' NE 'NSL').TULABE4
&NM.LABEL  DC  X'001E,0001,0001,04'     LABEL=NSL
           AGO .TUDSSEQ
.TULABE4   AIF ('&LABEL' NE 'SUL').TULABE5
&NM.LABEL  DC  X'001E,0001,0001,0A'     LABEL=SUL
           AGO .TUDSSEQ
.TULABE5   AIF ('&LABEL' NE 'BLP').TULABE6
&NM.LABEL  DC  X'001E,0001,0001,10'     LABEL=BLP
           AGO .TUDSSEQ
.TULABE6   AIF ('&LABEL' NE 'LTM').TULABE7
&NM.LABEL  DC  X'001E,0001,0001,21'     LABEL=LTM
           AGO .TUDSSEQ
.TULABE7   AIF ('&LABEL' NE 'AL').TULABE8
&NM.LABEL  DC  X'001E,0001,0001,40'     LABEL=AL
           AGO .TUDSSEQ
.TULABE8   AIF ('&LABEL' NE 'AUL').TUDSSEQ
&NM.LABEL  DC  X'001E,0001,0001,48'     LABEL=AUL
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUDSSEQ   AIF ('&DSSEQ' EQ '').TUPASPR
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUDSSE#
           DS  XL6
&NM.DSSEQ  DS  AL2                      LABEL= DATASET SEQUENCE NUMBER
           AGO .TUPASPR
.TUDSSE#   ANOP
           DC  X'001F,0001,0002'
&NM.DSSEQ  DC  AL2(&DSSEQ)              LABEL= DATASET SEQUENCE NUMBER
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUPASPR   AIF ('&PASPR' EQ '').TUINOUT
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUINOUT   AIF ('&INOUT' EQ '').TUEXPDT
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUINOU#
&NM.INOUT  DS  XL7                      LABEL=IN OR OUT
           AGO .TUEXPDT
.TUINOU#   AIF ('&INOUT' NE 'IN').TUINOU2
&NM.INOUT  DC  X'0021,0001,0001,40'     LABEL=IN
           AGO .TUEXPDT
.TUINOU2   AIF ('&INOUT' NE 'OUT').TUEXPDT
&NM.INOUT  DC  X'0021,0001,0001,80'     LABEL=OUT
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUEXPDT   AIF ('&EXPDT' EQ '').TURETPD
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUEXPD#
           DS  XL6
&NM.EXPDT  DS  CL5                      EXPDT
           AGO .TURETPD
.TUEXPD#   ANOP
           DC  X'0022,0001,0005'
&NM.EXPDT  DC  CL5'&EXPDT'              EXPDT
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURETPD   AIF ('&RETPD' EQ '').TUDUMMY
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURETP#
           DS  XL6
&NM.RETPD  DS  AL2                      RETPD
           AGO .TUDUMMY
.TURETP#   ANOP
           DC  X'0023,0001,0002'
&NM.RETPD  DC  AL2(&RETPD)              RETPD
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUDUMMY   AIF ('&DUMMY' EQ '').TUFCBIM
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUDUMM#
&NM.DUMMY  DS  XL4                      DD DUMMY / DSN=NULLFILE
           AGO .TUFCBIM
.TUDUMM#   ANOP
&NM.DUMMY  DC  X'0024,0000'             DD DUMMY / DSN=NULLFILE
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUFCBIM   AIF ('&FCBIM' EQ '').TUFCBAV
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUFCBI#
           DS  XL6
&NM.FCBIM  DS  CL4                      FCB
           AGO .TUFCBAV
.TUFCBI#   ANOP
           DC  X'0025,0001,0004'
&NM.FCBIM  DC  CL4'&FCBIM'              FCB
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUFCBAV   AIF ('&FCBAV' EQ '').TUQNAME
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUFCBA#
&NM.FCBAV  DS  XL7                      FCB VERIFY OR ALIGN
           AGO .TUQNAME
.TUFCBA#   AIF ('&FCBAV' NE 'VERIFY').TUFCBA2
&NM.FCBAV  DC  X'0026,0001,0001,04'     FCB VERIFY
           AGO .TUQNAME
.TUFCBA2   AIF ('&FCBAV' NE 'ALIGN').TUQNAME
&NM.FCBAV  DC  X'0026,0001,0001,08'     FCB ALIGN
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUQNAME   AIF ('&QNAME' EQ '').TUTERM
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUTERM    AIF ('&TERM' EQ '').TUUCS
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUTERMA
&NM.TERM   DS  XL4                      TERM=TS / DSN(*)
           AGO .TUUCS
.TUTERMA   ANOP
&NM.TERM   DC  X'0028,0000'             TERM=TS / DSN(*)
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUUCS     AIF ('&UCS' EQ '').TUUFOLD
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUUCSA
           DS  XL6
&NM.UCS    DS  CL4                      UCS CHARACTER SET
           AGO .TUUFOLD
.TUUCSA    ANOP
           DC  X'0029,0001,0004'
&NM.UCS    DC  CL4'&UCS'                UCS CHARACTER SET
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUUFOLD   AIF ('&UFOLD' EQ '').TUUVRFY
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUUFOL#
&NM.UFOLD  DS  XL4                      UCS FOLD
           AGO .TUUVRFY
.TUUFOL#   ANOP
&NM.UFOLD  DC  X'002A,0000'             UCS FOLD
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUUVRFY   AIF ('&UVRFY' EQ '').TUDCBDS
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUUVRF#
&NM.UVRFY  DS  XL4                      UCS VERIFY
           AGO .TUDCBDS
.TUUVRF#   ANOP
&NM.UVRFY  DC  X'002B,0000'             UCS VERIFY
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUDCBDS   AIF ('&DCBDS' EQ '').TUDCBDD
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUDCBS#
           DS  XL6
&NM.DCBDS  DS  CL44                     DCB REFERENCE TO DSN
           AGO .TUDCBDD
.TUDCBS#   ANOP
           DC  X'002C,0001,0003'        DCB REFERENCE TO DSN (BELOW)
&NM.DCBDS  DC  CL44'&DCBDS'
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUDCBDD   AIF ('&DCBDD' EQ '').TUSUSER
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUDCBD#
           DS  XL6
&NM.DCBDD  DS  CL8                      DCB REFERENCE TO DDNAME
           AGO .TUSUSER
.TUDCBD#   ANOP
           DC  X'002D,0001,0008'
&NM.DCBDD  DC  CL8'&DCBDD'              DCB REFERENCE TO DDNAME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUSUSER   AIF ('&SUSER' EQ '').TUSHOLD
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUSUSE#
           DS  XL6
&NM.SUSER  DS  CL8                      SYSOUT DESTINATION
           AGO .TUSHOLD
.TUSUSE#   ANOP
           DC  X'0058,0001,0008'
&NM.SUSER  DC  CL8'&SUSER'              SYSOUT DESTINATION
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUSHOLD   AIF ('&SHOLD' EQ '').TUMSVGP
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUSHOL#
&NM.SHOLD  DS  XL4                      SYSOUT HOLD=YES
           AGO .TUMSVGP
.TUSHOL#   ANOP
&NM.SHOLD  DC  X'0059,0000'             SYSOUT HOLD=YES
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUMSVGP   AIF ('&MSVGP' EQ '').TUSSNM
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUSSNM    AIF ('&SSNM' EQ '').TUSSPRM
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUSSPRM   AIF ('&SSPRM' EQ '').TUPROT
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUPROT    AIF ('&PROT' EQ '').TUBFALN
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.*
.*********************************************************************
.***          DCB ATTRIBUTE TEXT UNITS - VERB CODE 01              ***
.*********************************************************************
.*
.TUBFALN   AIF ('&BFALN' EQ '').TUBFTEK
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBFAL#
&NM.BFALN  DS  XL7                      BFALN
           AGO .TUBFTEK
.TUBFAL#   AIF ('&BFALN' NE 'F').TUBFAL2
&NM.BFALN  DC  X'002E,0001,0001,01'     BFALN=F
           AGO .TUBFTEK
.TUBFAL2   AIF ('&BFALN' NE 'D').TUBFTEK
&NM.BFALN  DC  X'002E,0001,0001,02'     BFALN=D
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBFTEK   AIF ('&BFTEK' EQ '').TUBLKSZ
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBFTE#
&NM.BFTEK  DS  XL7                      BFTEK
           AGO .TUBLKSZ
.TUBFTE#   AIF ('&BFTEK' NE 'D').TUBFTE2
&NM.BFTEK  DC  X'002F,0001,0001,08'     BFTEK=D
           AGO .TUBLKSZ
.TUBFTE2   AIF ('&BFTEK' NE 'E').TUBFTE3
&NM.BFTEK  DC  X'002F,0001,0001,10'     BFTEK=E
           AGO .TUBLKSZ
.TUBFTE3   AIF ('&BFTEK' NE 'R').TUBFTE4
&NM.BFTEK  DC  X'002F,0001,0001,20'     BFTEK=R
           AGO .TUBLKSZ
.TUBFTE4   AIF ('&BFTEK' NE 'S').TUBFTE5
&NM.BFTEK  DC  X'002F,0001,0001,40'     BFTEK=S
           AGO .TUBLKSZ
.TUBFTE5   AIF ('&BFTEK' NE 'A').TUBLKSZ
&NM.BFTEK  DC  X'002F,0001,0001,60'     BFTEK=A
           AGO .TUBLKSZ
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBLKSZ   AIF ('&BLKSZ' EQ '').TUBUFIN
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBLKS#
           DS  XL6
&NM.BLKSZ  DS  AL2                      BLKSIZE
           AGO .TUBUFIN
.TUBLKS#   ANOP
           DC  X'0030,0001,0002'
&NM.BLKSZ  DC  AL2(&BLKSZ)              BLKSIZE
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBUFIN   AIF ('&BUFIN' EQ '').TUBUFL
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBUFI#
           DS  XL6
&NM.BUFIN  DS  AL1                      BUFIN
           AGO .TUBUFL
.TUBUFI#   ANOP
           DC  X'0031,0001,0001'
&NM.BUFIN  DC  AL1(&BUFIN)              BUFIN
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBUFL    AIF ('&BUFL' EQ '').TUBUFMX
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBUFLA
           DS  XL6
&NM.BUFL   DC  AL2                      BUFL
           AGO .TUBUFMX
.TUBUFLA   ANOP
           DC  X'0032,0001,0002'
&NM.BUFL   DC  AL2(&BUFL)               BUFL
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBUFMX   AIF ('&BUFMX' EQ '').TUBUFNO
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBUFM#
           DS  XL6
&NM.BUFMX  DS  AL1                      BUFMAX
           AGO .TUBUFNO
.TUBUFM#   ANOP
           DC  X'0033,0001,0001'
&NM.BUFMX  DC  AL1(&BUFMX)              BUFMAX
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBUFNO   AIF ('&BUFNO' EQ '').TUBUFOF
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBUFN#
           DS  XL6
&NM.BUFNO  DC  AL1                      BUFNO
           AGO .TUBUFOF
.TUBUFN#   ANOP
           DC  X'0034,0001,0001'
&NM.BUFNO  DC  AL1(&BUFNO)              BUFNO
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBUFOF   AIF ('&BUFOF' EQ '').TUBUFOU
&TUPLEN    SETA &TUPLEN+1
           AIF ('&BUFOF' NE 'L').TUBUFO2
           AIF ('&MAP' NE 'ONLY').TUBUFF#
&NM.BUFOF  DS  XL7                      BUFOFF=L
           AGO .TUBUFOU
.TUBUFF#   ANOP
&NM.BUFOF  DC  X'0035,0001,0001,80'     BUFOFF=L
           AGO .TUBUFOU
.TUBUFO2   ANOP
           AIF ('&MAP' NE 'ONLY').TUBUF##
           DS  XL6
&NM.BUFOF  DS  AL1                      BUFOFF
           AGO .TUBUFOU
.TUBUF##   ANOP
           DC  X'0035,0001,0001'
&NM.BUFOF  DC  AL1(&BUFOF)              BUFOFF
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBUFOU   AIF ('&BUFOU' EQ '').TUBUFRQ
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBUFO#
           DS  XL6
&NM.BUFOU  DS  AL1                      BUFOUT
           AGO .TUBUFRQ
.TUBUFO#   ANOP
           DC  X'0036,0001,0001'
&NM.BUFOU  DC  AL1(&BUFOU)              BUFOUT
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBUFRQ   AIF ('&BUFRQ' EQ '').TUBUFSZ
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBUFR#
           DS  XL6
&NM.BUFRQ  DS  AL1                      BUFRQ
           AGO .TUBUFSZ
.TUBUFR#   ANOP
           DC  X'0037,0001,0001'
&NM.BUFRQ  DC  AL1(&BUFRQ)              BUFRQ
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUBUFSZ   AIF ('&BUFSZ' EQ '').TUCODE
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUBUFS#
           DS  XL6
&NM.BUFSZ  DS  AL2                      BUFSIZE
           AGO .TUCODE
.TUBUFS#   ANOP
           DC  X'0038,0001,0002'
&NM.BUFSZ  DC  AL2(&BUFSZ)              BUFSIZE
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUCODE    AIF ('&CODE' EQ '').TUCPRI
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUCPRI    AIF ('&CPRI' EQ '').TUDEN
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUDEN     AIF ('&DEN' EQ '').TUDSORG
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUDENA
&NM.DEN    DS  XL7                      DEN
           AGO .TUDSORG
.TUDENA    AIF ('&DEN' NE '0').TUDE2
&NM.DEN    DC  X'003B,0001,0001,03'     DEN=0  (200 BPI, 7-TRACK)
           AGO .TUDSORG
.TUDE2     AIF ('&DEN' NE '1').TUDE3
&NM.DEN    DC  X'003B,0001,0001,43'     DEN=1  (556 BPI, 7-TRACK)
           AGO .TUDSORG
.TUDE3     AIF ('&DEN' NE '2').TUDE4
&NM.DEN    DC  X'003B,0001,0001,83'     DEN=2  (800 BPI, 7/9-TRACK)
           AGO .TUDSORG
.TUDE4     AIF ('&DEN' NE '3').TUDE5
&NM.DEN    DC  X'003B,0001,0001,C3'     DEN=3  (1600 BPI, 9-TRACK)
           AGO .TUDSORG
.TUDE5     AIF ('&DEN' NE '4').TUDSORG
&NM.DEN    DC  X'003B,0001,0001,D3'     DEN=4  (6250 BPI, 9-TRACK)
           AGO .TUDSORG
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUDSORG   AIF ('&DSORG' EQ '').TUEROPT
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUDSOR#
&NM.DSORG  DS  XL8                      DSORG
           AGO .TUEROPT
.TUDSOR#   AIF ('&DSORG' NE 'VS').TUDSOR2
&NM.DSORG  DC  X'003C,0001,0002,0008'   DSORG=VS
           AGO .TUEROPT
.TUDSOR2   AIF ('&DSORG' NE 'TQ').TUDSOR3
&NM.DSORG  DC  X'003C,0001,0002,0020'   DSORG=TQ
           AGO .TUEROPT
.TUDSOR3   AIF ('&DSORG' NE 'TX').TUDSOR4
&NM.DSORG  DC  X'003C,0001,0002,0040'   DSORG=TX
           AGO .TUEROPT
.TUDSOR4   AIF ('&DSORG' NE 'GS').TUDSOR5
&NM.DSORG  DC  X'003C,0001,0002,0080'   DSORG=GS
           AGO .TUEROPT
.TUDSOR5   AIF ('&DSORG' NE 'PO').TUDSOR6
&NM.DSORG  DC  X'003C,0001,0002,0200'   DSORG=PO
           AGO .TUEROPT
.TUDSOR6   AIF ('&DSORG' NE 'POU').TUDSOR7
&NM.DSORG  DC  X'003C,0001,0002,0300'   DSORG=POU
           AGO .TUEROPT
.TUDSOR7   AIF ('&DSORG' NE 'MQ').TUDSOR8
&NM.DSORG  DC  X'003C,0001,0002,0400'   DSORG=MQ
           AGO .TUEROPT
.TUDSOR8   AIF ('&DSORG' NE 'CQ').TUDSOR9
&NM.DSORG  DC  X'003C,0001,0002,0800'   DSORG=CQ
           AGO .TUEROPT
.TUDSOR9   AIF ('&DSORG' NE 'CX').TUDSORA
&NM.DSORG  DC  X'003C,0001,0002,1000'   DSORG=CX
           AGO .TUEROPT
.TUDSORA   AIF ('&DSORG' NE 'DA').TUDSORB
&NM.DSORG  DC  X'003C,0001,0002,2000'   DSORG=DA
           AGO .TUEROPT
.TUDSORB   AIF ('&DSORG' NE 'DAU').TUDSORC
&NM.DSORG  DC  X'003C,0001,0002,2100'   DSORG=DAU
           AGO .TUEROPT
.TUDSORC   AIF ('&DSORG' NE 'PS').TUDSORD
&NM.DSORG  DC  X'003C,0001,0002,4000'   DSORG=PS
           AGO .TUEROPT
.TUDSORD   AIF ('&DSORG' NE 'PSU').TUEROPT
&NM.DSORG  DC  X'003C,0001,0002,4100'   DSORG=PSU
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUEROPT   AIF ('&EROPT' EQ '').TUGNCP
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUEROP#
&NM.EROPT  DS  XL7                      EROPT
           AGO .TUGNCP
.TUEROP#   AIF ('&EROPT' NE 'T').TUEROP2
&NM.EROPT  DC  X'003D,0001,0001,10'     EROPT=T
           AGO .TUGNCP
.TUEROP2   AIF ('&EROPT' NE 'ABE').TUEROP3
&NM.EROPT  DC  X'003D,0001,0001,20'     EROPT=ABE
           AGO .TUGNCP
.TUEROP3   AIF ('&EROPT' NE 'SKP').TUEROP4
&NM.EROPT  DC  X'003D,0001,0001,40'     EROPT=SKP
           AGO .TUGNCP
.TUEROP4   AIF ('&EROPT' NE 'ACC').TUGNCP
&NM.EROPT  DC  X'003D,0001,0001,80'     EROPT=ACC
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUGNCP    AIF ('&GNCP' EQ '').TUINTVL
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUGNCPA
           DS  XL6
&NM.GNCP   DC  AL1                      GNCP
           AGO .TUINTVL
.TUGNCPA   ANOP
           DC  X'003E,0001,0001'
&NM.GNCP   DC  AL1(&GNCP)               GNCP
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUINTVL   AIF ('&INTVL' EQ '').TUKYLEN
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUKYLEN   AIF ('&KYLEN' EQ '').TULIMCT
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUKYLE#
           DS  XL6
&NM.KYLEN  DS  AL1                      KEYLEN
           AGO .TULIMCT
.TUKYLE#   ANOP
           DC  X'0040,0001,0001'
&NM.KYLEN  DC  AL1(&KYLEN)              KEYLEN
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TULIMCT   AIF ('&LIMCT' EQ '').TULRECL
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TULRECL   AIF ('&LRECL' EQ '').TUMODE
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TULREC#
           DS  XL6
&NM.LRECL  DS  AL2                      LRECL
           AGO .TUMODE
.TULREC#   ANOP
           DC  X'0042,0001,0002'
&NM.LRECL  DC  AL2(&LRECL)              LRECL
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUMODE    AIF ('&MODE' EQ '').TUNCP
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUNCP     AIF ('&NCP' EQ '').TUOPTCD
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUNCPA
           DS  XL6
&NM.NCP    DS  AL1                      NCP
           AGO .TUOPTCD
.TUNCPA    ANOP
           DC  X'0044,0001,0001'
&NM.NCP    DC  AL1(&NCP)                NCP
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUOPTCD   AIF ('&OPTCD' EQ '').TUPCIR
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUOPTC#
&NM.OPTCD  DS  XL7                      OPTCD
           AGO .TUPCIR
.TUOPTC#   AIF ('&OPTCD' NE 'W').TUPCIR
&NM.OPTCD  DC  X'0045,0001,0001,80'     OPTCD=W
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUPCIR    AIF ('&PCIR' EQ '').TUPCIS
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUPCIS    AIF ('&PCIS' EQ '').TUPRTSP
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUPRTSP   AIF ('&PRTSP' EQ '').TURECFM
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUPRTS#
&NM.PRTSP  DS  XL7                      PRTSP
           AGO .TURECFM
.TUPRTS#   AIF ('&PRTSP' NE '0').TUPRTS2
&NM.PRTSP  DC  X'0048,0001,0001,01'     PRTSP=0
           AGO .TURECFM
.TUPRTS2   AIF ('&PRTSP' NE '1').TUPRTS3
&NM.PRTSP  DC  X'0048,0001,0001,09'     PRTSP=1
           AGO .TURECFM
.TUPRTS3   AIF ('&PRTSP' NE '2').TUPRTS4
&NM.PRTSP  DC  X'0048,0001,0001,11'     PRTSP=2
           AGO .TURECFM
.TUPRTS4   AIF ('&PRTSP' NE '3').TURECFM
&NM.PRTSP  DC  X'0048,0001,0001,19'     PRTSP=3
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURECFM   AIF ('&RECFM' EQ '').TURSRVF
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURECF#
&NM.RECFM  DS  XL7                      RECFM=F
           AGO .TURSRVF
.TURECF#   AIF ('&RECFM' NE 'F').TURECF2
&NM.RECFM  DC  X'0049,0001,0001,80'     RECFM=F
           AGO .TURSRVF
.TURECF2   AIF ('&RECFM' NE 'FA').TURECF3
&NM.RECFM  DC  X'0049,0001,0001,84'     RECFM=FA
           AGO .TURSRVF
.TURECF3   AIF ('&RECFM' NE 'FB').TURECF4
&NM.RECFM  DC  X'0049,0001,0001,90'     RECFM=FB
           AGO .TURSRVF
.TURECF4   AIF ('&RECFM' NE 'FBA').TURECF5
&NM.RECFM  DC  X'0049,0001,0001,94'     RECFM=FBA
           AGO .TURSRVF
.TURECF5   AIF ('&RECFM' NE 'V').TURECF6
&NM.RECFM  DC  X'0049,0001,0001,40'     RECFM=V
           AGO .TURSRVF
.TURECF6   AIF ('&RECFM' NE 'VB').TURECF7
&NM.RECFM  DC  X'0049,0001,0001,50'     RECFM=VB
           AGO .TURSRVF
.TURECF7   AIF ('&RECFM' NE 'U').TURSRVF
&NM.RECFM  DC  X'0049,0001,0001,C0'     RECFM=U
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURSRVF   AIF ('&RSRVF' EQ '').TURSRVS
.TURSRVS   AIF ('&RSRVS' EQ '').TUSOWA
.TUSOWA    AIF ('&SOWA' EQ '').TUSTACK
.TUSTACK   AIF ('&STACK' EQ '').TUTHRSH
.TUTHRSH   AIF ('&THRSH' EQ '').TUTRTCH
.TUTRTCH   AIF ('&TRTCH' EQ '').TUIPLTX
.TUIPLTX   AIF ('&IPLTX' EQ '').TUDIAGN
.TUDIAGN   AIF ('&DIAGN' EQ '').TUFUNC
.TUFUNC    AIF ('&FUNC' EQ '').TUFRID
.TUFRID    AIF ('&FRID' EQ '').TUPASSW
.*
.*********************************************************************
.***       NON-JCL DYNAMIC ALLOCATION FUNCTIONS - VERB CODE 01     ***
.*********************************************************************
.*
.TUPASSW   AIF ('&PASSW' EQ '').TUPERMA
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUPERMA   AIF ('&PERMA' EQ '').TUCNVRT
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUPERM#
&NM.PERMA  DS  XL4                      PERMANENT ALLOCATION
           AGO .TUCNVRT
.TUPERM#   ANOP
&NM.PERMA  DC  X'0052,0000'             PERMANENT ALLOCATION
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUCNVRT   AIF ('&CNVRT' EQ '').TURTDDN
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUCNVR#
&NM.CNVRT  DS  XL4                      CONVERTABLE ALLOCATION
           AGO .TURTDDN
.TUCNVR#   ANOP
&NM.CNVRT  DC  X'0053,0000'             CONVERTABLE ALLOCATION
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTDDN   AIF ('&RTDDN' EQ '').TURTDSN
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTDD#
           DS  XL4
           DS  XL2                      LEN OF RETURNED DDNAME
&NM.RTDDN  DS  CL8                      RETURNED DDNAME
           AGO .TURTDSN
.TURTDD#   ANOP
           DC  X'0055,0001'
           DC  XL2'0008'                LEN OF RETURNED DDNAME
&NM.RTDDN  DC  CL8' '                   RETURNED DDNAME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTDSN   AIF ('&RTDSN' EQ '').TURTORG
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTDS#
           DS  XL4
           DS  AL2                      LEN OF RETURNED DSNAME
&NM.RTDSN  DS  CL44                     RETURNED DSNAME
           AGO .TURTORG
.TURTDS#   ANOP
           DC  X'0056,0001'
           DC  AL2(44)                  LEN OF RETURNED DSNAME
&NM.RTDSN  DC  CL44' '                  RETURNED DSNAME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTORG   AIF ('&RTORG' EQ '').TURTVOL
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTOR#
           DS  XL6
&NM.RTORG  DS  XL2                      RETURNED DSORG
           AGO .TURTVOL
.TURTOR#   DC  X'0057,0001,0002'
&NM.RTORG  DC  XL2'0000'                RETURNED DSORG
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTVOL   AIF ('&RTVOL' EQ '').TUREMOV
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTVO#
           DS  XL4
           DS  XL2                      LEN OF RETURNED VOLSER
&NM.RTVOL  DS  CL6                      RETURNED VOLSER
           AGO .TUREMOV
.TURTVO#   ANOP
           DC  X'005D,0001'
           DC  XL2'0006'                LEN OF RETURNED VOLSER
&NM.RTVOL  DC  CL6' '                   RETURNED VOLSER
.*
.*********************************************************************
.***       UNALLOCATE - VERB CODE 02                               ***
.*********************************************************************
.*
.TUREMOV   AIF ('&REMOV' EQ '').TUUNALC
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUREMO#
&NM.REMOV  DS  XL4                      REMOVE INUSE EVEN IF PERMANENT
           AGO .TUUNALC
.TUREMO#   ANOP
&NM.REMOV  DC  X'0008,0000'             REMOVE INUSE EVEN IF PERMANENT
.*
.TUUNALC   AIF ('&UNALC' EQ '').TUTCBAD
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUUNAL#
&NM.UNALC  DS  XL4                      UNALLOCATE EVEN IF PERMANENT
           AGO .TUTCBAD
.TUUNAL#   ANOP
&NM.UNALC  DC  X'0007,0000'             UNALLOCATE EVEN IF PERMANENT
.*
.*********************************************************************
.***       REMOVE IN-USE ATTRIBUTE - VERB CODE 05                  ***
.*********************************************************************
.*
.TUTCBAD   AIF ('&TCBAD' EQ '').TUINDDN
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUTCBA#
           DS  XL6
&NM.TCBAD  DS  XL4                      TCB ADDRESS
           AGO .TUINDDN
.TUTCBA#   ANOP
           DC  X'0001,0001,0004'
&NM.TCBAD  DS  XL4                      TCB ADDRESS
.*
.*********************************************************************
.***       RETURN INFORMATION - VERB CODE 07                       ***
.*********************************************************************
.*
.TUINDDN   AIF ('&INDDN' EQ '').TUINDSN
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUINDD#
           DS  XL4
           DS  XL2                      LEN OF RETURNED DDNAME
&NM.INDDN  DS  CL8                      RETURNED DDNAME
           AGO .TUINDSN
.TUINDD#   ANOP
           DC  X'0004,0001'
           DC  XL2'0008'                LEN OF RETURNED DDNAME
&NM.INDDN  DC  CL8' '                   RETURNED DDNAME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUINDSN   AIF ('&INDSN' EQ '').TUINORG
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUINDS#
           DS  XL4
           DS  AL2                      LEN OF RETURNED DSNAME
&NM.INDSN  DS  CL44                     RETURNED DSNAME
           AGO .TUINORG
.TUINDS#   ANOP
           DC  X'0005,0001'
           DC  AL2(44)                  LEN OF RETURNED DSNAME
&NM.INDSN  DC  CL44' '                  RETURNED DSNAME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUINORG   AIF ('&INORG' EQ '').TURTMEM
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TUINOR#
           DS  XL6
&NM.INORG  DS  XL2                      RETURNED DSORG
           AGO .TURTMEM
.TUINOR#   DC  X'000A,0001,0002'
&NM.INORG  DC  XL2'0000'                RETURNED DSORG
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTMEM   AIF ('&RTMEM' EQ '').TURTSTA
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTME#
           DS  XL6
&NM.RTMEM  DS  CL8                      RETURNED MEMBER NAME
           AGO .TURTSTA
.TURTME#   ANOP
           DC  X'0006,0001,0008'
&NM.RTMEM  DC  CL8' '                   RETURNED MEMBER NAME
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTSTA   AIF ('&RTSTA' EQ '').TURTNDP
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTST#
           DS  XL6
&NM.RTSTA  DS  XL1                      RETURNED DATASET STATUS
           AGO .TURTNDP
.TURTST#   ANOP
           DC  X'0007,0001,0001'
&NM.RTSTA  DS  XL1'00'                  RETURNED DATASET STATUS
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTNDP   AIF ('&RTNDP' EQ '').TURTCDP
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTND#
           DS  XL6
&NM.RTNDP  DS  XL1                      RETURNED NORMAL DISP
           AGO .TURTCDP
.TURTND#   ANOP
           DC  X'0008,0001,0001'
&NM.RTNDP  DS  XL1'00'                  RETURNED NORMAL DISP
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTCDP   AIF ('&RTCDP' EQ '').TURTLIM
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTCD#
           DS  XL6
&NM.RTCDP  DS  XL1                      RETURNED CONDITIONAL DISP
           AGO .TURTLIM
.TURTCD#   ANOP
           DC  X'0009,0001,0001'
&NM.RTCDP  DS  XL1'00'                  RETURNED CONDITIONAL DISP
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTLIM   AIF ('&RTLIM' EQ '').TURTATT
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTLI#
           DS  XL6
&NM.RTLIM  DS  XL2                      RETURNED LIMIT SPECIFICATION
           AGO .TURTATT
.TURTLI#   ANOP
           DC  X'000B,0001,0002'
&NM.RTLIM  DS  XL2'0000'                RETURNED LIMIT SPECIFICATION
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTATT   AIF ('&RTATT' EQ '').TURTLST
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTAT#
           DS  XL6
&NM.RTATT  DS  XL1                      RETURNED D.A. ATTRIBUTE
           AGO .TURTLST
.TURTAT#   ANOP
           DC  X'000C,0001,0001'
&NM.RTATT  DS  XL1'00'                  RETURNED D.A. ATTRIBUTE
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTLST   AIF ('&RTLST' EQ '').TURTTYP
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTLS#
           DS  XL6
&NM.RTLST  DS  XL1                      RETURNED LAST ENTRY SPEC.
           AGO .TURTTYP
.TURTLS#   ANOP
           DC  X'000D,0001,0001'
&NM.RTLST  DS  XL1'00'                  RETURNED LAST ENTRY SPEC.
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURTTYP   AIF ('&RTTYP' EQ '').TURELNO
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURTTY#
           DS  XL6
&NM.RTTYP  DS  XL1                      RETURNED DATASET TYPE
           AGO .TURELNO
.TURTTY#   ANOP
           DC  X'000E,0001,0001'
&NM.RTTYP  DS  XL1'00'                  RETURNED DATASET TYPE
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TURELNO   AIF ('&RELNO' EQ '').TUENDM
&TUPLEN    SETA &TUPLEN+1
           AIF ('&MAP' NE 'ONLY').TURELN#
           DS  XL6
&NM.RELNO  DS  XL2                      RETURNED RELATIVE REQUEST NO.
           AGO .TUENDM
.TURELN#   ANOP
           DC  X'000F,0001,0002'
&NM.RELNO  DS  XL2'0000'                RETURNED RELATIVE REQUEST NO.
.*
.*********************************************************************
.***       MARK END OF LIST OF TEXT UNITS                          ***
.*********************************************************************
.*
.TUENDM    AIF ('&MAP' NE 'ONLY').TUENDU#
           DS  XL1                      END OF LIST MARKER
           AGO .TUEND
.TUENDU#   ANOP
           DC  X'FF'                    END OF LIST MARKER
.* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
.TUEND     ANOP
.*
**********************************************************************
***        REQUEST BLOCKS FOR SVC99                                ***
**********************************************************************
*
&NM.RBP    DS  A                        POINTER TO REQUEST BLOCK
&NM.RB     DS  5A                       REQUEST BLOCK
&NM.TUPL   DS  &TUPLEN.A                TEXT UNIT POINTER LIST
*
**********************************************************************
***        DAIRFAIL PARAMETER BLOCK & MISCELLANEOUS STORAGE        ***
**********************************************************************
*
&NM.DFPRM  DS  6F                       PARM BLOCK FOR IKJEFF18
*
&NM.S99RC  DS  F                        STORAGE AREA FOR SVC 99 R/C
           AIF ('&MAP' NE 'ONLY').DF2
&NM.F02EP  DS  F                        STORGE AREA FOR EP OF IKJEFF18
&NM.ID     DS  XL2                      DAIRFAIL SWITCHES & CALLER ID
           AGO .DF3
.DF2       ANOP
&NM.F02EP  DC  F'0'                     STORGE AREA FOR EP OF IKJEFF18
&NM.ID     DC  X'0032'                  DAIRFAIL SWITCHES & CALLER ID
.DF3       ANOP
*
**********************************************************************
***        EQUATE FOR TOTAL LENGTH                                 ***
**********************************************************************
*
           DS  0D                       ALIGN FOR GETMAIN
&NM.LEN    EQU *-&NM                    TOTAL LENGTH
           MEND
++MAC(GTEDAALC) DISTLIB(ISPAMAC) SYSLIB(ISPMACS) .
         MACRO
&LABEL   GTEDAALC  &NM,&VERB=AL,&ERRMSG=YES
.*
.*          +-----------------------------------------------+
.*          |  SEE MACRO GTEDADOC FOR DOCUMENTATION OF THE  |
.*          |  USE OF THIS AND OTHER GTEDAXXX MACROS.       |
.*          +-----------------------------------------------+
.*
*
**********************************************************************
***   PERFORM DYNAMIC ALLOCATION USING A DATA AREA CREATED         ***
***   BY MACRO GTEDADAT, AND POINTERS/DATA SET BY MACRO GTEDASET.  ***
**********************************************************************
*
**********************************************************************
***   SET VERB CODE INTO S99RB.                                    ***
***   MAPPING MACRO IEFZB4D0 MUST APPEAR IN THE SOURCE.            ***
**********************************************************************
*
&LABEL   LA    1,&NM.RB
.*
.VBAL    AIF   ('&VERB' NE 'AL').VBUN
         MVI   (S99VERB-S99RB)(1),S99VRBAL   SET VERB, DSN ALLOC
         AGO   .VBEND
.VBUN    AIF   ('&VERB' NE 'UN').VBCC
         MVI   (S99VERB-S99RB)(1),S99VRBUN   SET VERB, DSN UNALLOC
         AGO   .VBEND
.VBCC    AIF   ('&VERB' NE 'CC').VBDC
         MVI   (S99VERB-S99RB)(1),S99VRBCC   SET VERB, CONCATENATE
         AGO   .VBEND
.VBDC    AIF   ('&VERB' NE 'DC').VBRI
         MVI   (S99VERB-S99RB)(1),S99VRBDC   SET VERB, DECONCATENATE
         AGO   .VBEND
.VBRI    AIF   ('&VERB' NE 'RI').VBDN
         MVI   (S99VERB-S99RB)(1),S99VRBRI   SET VERB, REMOVE IN-USE
         AGO   .VBEND
.VBDN    AIF   ('&VERB' NE 'DN').VBIN
         MVI   (S99VERB-S99RB)(1),S99VRBDN   SET VERB, DDN ALLOC
         AGO   .VBEND
.VBIN    AIF   ('&VERB' NE 'IN').VBEND
         MVI   (S99VERB-S99RB)(1),S99VRBIN   SET VERB, REQUEST INFO
         AGO   .VBEND
.VBEND   ANOP
.*
*
**********************************************************************
***    DO DYNAMIC ALLOCATION                                       ***
**********************************************************************
*
         LA    1,&NM.RBP                ADDRESS OF PTR TO SVC-99 RB
         SVC   99                       DYNALLOC
         ST    15,&NM.S99RC             SAVE RETURN CODE FROM SVC-99
.*
.*********************************************************************
.**                                                                ***
.**   IF &ERRMSG=NO, DO NOT EVER GENERATE CODE FOR IKJEFF18        ***
.**                                                                ***
.*********************************************************************
.*
         AIF   ('&ERRMSG' EQ 'NO').NOPR
.*
*
**********************************************************************
***    IF R/C FROM DYNAMIC ALLOCATION NOT ZERO,                    ***
***    EXECUTE THE IKJEFF18 (DAIRFAIL) PROGRAM TO PRODUCE          ***
***    ERROR MESSAGES.                                             ***
**********************************************************************
*
         CNOP  2,4                      ALIGN FOR BRANCH INSTRUCTION
         LTR   15,15                    IF RETURN CODE IS GOOD
         BZ    EXZ&SYSNDX                 BRANCH TO END OF ROUTINE
         BAL   1,EXA&SYSNDX  BRANCH AROUND LIST
*
**********************************************************************
***    EXCEPTIONS, DON'T USE IKJEFF18 FOR THESE VERB/ERROR COMBOS  ***
***                                                                ***
         DC    H'1'          NUMBER OF MEMBERS IN THIS LIST
         DC    X'02,0438'    VERB 02 ERR 0438 DDNAME NOT FOUND
***                                                                ***
**********************************************************************
*
EXA&SYSNDX LA    2,2(0,1)                    R2 IS POINTER TO COMBOS
           LH    1,0(0,1)                    R1 IS COUNT OF COMBOS
           LA    15,&NM.RB                   R15 IS BASE OF RB
*
           CLC   (S99VERB-S99RB)(1,15),0(2)  IF NO MATCH ON VERB
           BNE   *+14                          BRANCH TO END OF LOOP
           CLC   (S99ERROR-S99RB)(2,15),1(2) ELSE IF ERRCDE MATCHES
           BE    EXZ&SYSNDX                    BRANCH TO ENDING
           LA    2,6(0,2)                    POINT TO NEXT ENTRY
           BCT   1,*-24                      LOOP BACK UP TIL EOL
*
         LA    1,&NM.DFPRM              POINT TO IKJEFF18 PARM BLOCK
         CNOP  0,4                      ALIGN FOR FOLLOWING BAL
         BAL   15,*+20                  LOAD CONST ADDR AND BRANCH
         DC    A(*+8)                   ADDR OF LINK PARM LIST
         DC    A(0)                     ADDR OF DCB (NONE)
         DC    CL8'IKJEFF18'            EP NAME
         SVC   6                        LINK
*
.NOPR    ANOP
EXZ&SYSNDX NOPR  0                        END POINT
         MEND
++MAC(GTEDASET) DISTLIB(ISPAMAC) SYSLIB(ISPMACS) .
         MACRO
&LABEL   GTEDASET &NM,&CPPLPTR=
.*
.*          +-----------------------------------------------+
.*          |  SEE MACRO GTEDADOC FOR DOCUMENTATION OF THE  |
.*          |  USE OF THIS AND OTHER GTEDAXXX MACROS.       |
.*          +-----------------------------------------------+
.*
*
**********************************************************************
***   SET POINTERS AND DATA FOR DYNAMIC ALLOCATION IN DATA AREAS   ***
***   CREATED BY MACRO GTEDADAT.                                   ***
**********************************************************************
*
**********************************************************************
***      PLACE ADDRESS OF S99RB INTO S99RBPTR.                     ***
**********************************************************************
*
&LABEL   LA    1,&NM.RB                       ==> R1 POINTS TO S99RB
         ST    1,&NM.RBP                          FILL IN S99RBPTR
         OI    &NM.RBP,X'80'                      TURN ON HI BIT
*
**********************************************************************
***      FILL IN S99RB REQUEST BLOCK.                              ***
***      MAPPING MACRO IEFZB4D0 MUST APPEAR IN SOURCE.             ***
**********************************************************************
*
         MVI   (S99RBLN-S99RB)(1),X'14'           FILL IN LENGTH
         MVI   (S99VERB-S99RB)(1),X'00'           ZERO VERB CODE
         XC    (S99FLAG1-S99RB)(4,1),(S99FLAG1-S99RB)(1)   ZERO FLAGS1
         OI    (S99FLAG1-S99RB)(1),S99ONCNV       SET FLAGS1 OK CONVRT
         OI    (S99FLAG1-S99RB)(1),S99NOMNT       SET FLAGS1 NO MOUNT
         LA    2,&NM.TUPL                     ==> R2 POINTS TO TUPL
         ST    2,(S99TXTPP-S99RB)(0,1)            TUPL ADDR INTO RB
         XC    (S99FLAG2-S99RB)(4,1),(S99FLAG2-S99RB)(1)   ZERO FLAGS2
*
**********************************************************************
***  BUILD TUPL.                                                   ***
***  KEY OF LAST TEXT UNIT MUST BE X'FF..'                         ***
**********************************************************************
*
         LA    1,&NM.TU                       ==> R1 POINTS TO TUNITS
         XR    0,0                                CLEAR R0 FOR COUNTER
         XR    15,15                              CLEAR R15 WORK REG
*
RBA&SYSNDX CLI (S99TUKEY-S99TUNIT)(1),X'FF'       IF KEY IS X'FF..'
         BE    RBD&SYSNDX                           BRANCH OUT OF LOOP
         ST    1,0(0,2)                           ADDR OF KEY TO TUPL
         LA    2,4(0,2)                           INCR POINTER TO TUPL
*
         ICM   0,3,(S99TUNUM-S99TUNIT)(1)         TU NUM TO R0
         LA    1,4(0,1)                           R1 POINTS BEYOND NUM
         LTR   0,0                                IF TU NUM IS 0
         BZ    RBA&SYSNDX                         PROCESS NEXT TU
*
         ICM   15,3,0(1)                          TU LEN TO R15
         LA    1,2(15,1)                          PNT BEYND LEN & PARM
         BCT   0,*-8                              DO FOR EACH LEN+PARM
*
         B     RBA&SYSNDX                         PROCESS NEXT TU
*
RBD&SYSNDX LA  15,4(0,0)                          POINT TO LAST
         SR    2,15                                 TUPL ENTRY
         OI    0(2),S99TUPLN                      MARK LAST TUPL ENTRY
*
**********************************************************************
***  FILL IN THE DAIRFAIL PARAMETER BLOCK.                         ***
***  IKJEFFDF DFDSECT=YES,DFDSEC2=YES MUST APPEAR IN SOURCE.       ***
**********************************************************************
*
         MVC   &NM.DFPRM+(DFS99RBP-DFDSECTD)(4),&NM.RBP *PTR TO RB
*
         LA    1,&NM.S99RC
         ST    1,&NM.DFPRM+(DFRCP-DFDSECTD)             *PTR TO S99RC
*
         LA    1,&NM.F02EP
         ST    1,&NM.DFPRM+(DFJEFF02-DFDSECTD)          *PTR TO EP
*
         LA    1,&NM.ID
         ST    1,&NM.DFPRM+(DFIDP-DFDSECTD)             *PTR TO SW+ID
*
         MVC   &NM.DFPRM+(DFCPPLP-DFDSECTD)(4),&CPPLPTR *PTR TO CPPL
*
         XC  &NM.DFPRM+(DFBUFP-DFDSECTD)(4),&NM.DFPRM+(DFBUFP-DFDSECTD)
*                                                       *ZERO BUFF ADDR
         MEND
