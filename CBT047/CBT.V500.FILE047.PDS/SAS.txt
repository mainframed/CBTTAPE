./       ADD   NAME=AFP1
DATA A;
 INFILE SERLOG ;
 INPUT @001   TYPE     IB1.
       @ ;
       IF TYPE='0001....'B THEN CLASS='MACHINE CHECK      ';
  ELSE IF TYPE='0010....'B THEN CLASS='CHANNEL CHECK      ';
  ELSE IF TYPE='0011....'B THEN CLASS='UNIT CHECK (OBR)   ';
  ELSE IF TYPE='0100....'B THEN CLASS='SOFTWARE ERROR     ';
  ELSE IF TYPE='0101....'B THEN CLASS='IPL RECORD         ';
  ELSE IF TYPE='0110....'B THEN CLASS='DDR RECORD         ';
  ELSE IF TYPE='0111....'B THEN CLASS='MISSING INTERRUPT  ';
  ELSE IF TYPE='1000....'B THEN CLASS='SYSTEM TERMINATION ';
  ELSE IF TYPE='1001....'B THEN CLASS='NON-STANDARD MDR   ';
  ELSE IF TYPE='1010....'B THEN CLASS='MACHINE CHECK FRAME';
  ELSE IF TYPE='1011....'B THEN CLASS='CHANNEL CHECK FRAME';

PROC FREQ DATA=WORK.A;
 TABLES CLASS;

DATA OBR (KEEP=DATE TIME JOBID CCW DEVTYPE PCUA SENSE LEVEL DATE1)
     SFT (KEEP=DATE TIME JOBID PROGRAM ABEND LMOD CSECT DATE1)
 ;
 INFILE SERLOG MISSOVER;
 INPUT @001   TYPE     IB1.
       @ ;

  IF TYPE='0011....'B THEN LINK TYPE03;
  IF TYPE='0100....'B THEN LINK TYPE04;
  RETURN;
  TYPE03:
  IF TYPE='0011.11.'B THEN DELETE;  /* VTAM OBR RECORD. */
  INPUT @003   SWITCHES IB2.
        @ ;
  IF SWITCHES='..........0.....'B ;
  IF SWITCHES='.............1..'B THEN DELETE; /* VOLUME DEMOUNT. */
  IF SWITCHES='.........1......'B THEN LEVEL='TEMP'; ELSE LEVEL='PERM';
  INPUT @009   DATE1    PD4.
        @013   TIME     TU4.
        @025   JOBID    $8.
        @033   CCW      $PHEX8.
        @049   DEVDEPC  IB1.
        @053   DEVT1    $PHEX5.
        @057   SDRCNT   IB1.
        @058   PCUA1    $PHEX4.
        @063   SENSCNT  IB2.
        @ ;
  SENSOFF=65+(DEVDEPC*8)+SDRCNT;
  INPUT @SENSOFF SENSE1  $PHEX5.
        @ ;
  YY = ROUND(DATE1,1000);
  DDD = DATE1-YY;
  YY = YY/1000;
  DATE = DATEJUL(1000*YY+DDD);
  PCUA=SUBSTR(PCUA1,4,3);
  DEVTYPE=SUBSTR(DEVT1,1,8);
  SENSE=SUBSTR(SENSE1,1,8);
  IF SUBSTR(SENSE,1,2)='40' & DEVTYPE='1000080E' THEN DELETE;
  IF DEVTYPE='80062023' THEN DEVTYPE='3380  ';
  IF DEVTYPE='10800811' THEN DEVTYPE='4245  ';
  IF DEVTYPE='0000080F' THEN DEVTYPE='3825  ';
  IF DEVTYPE='78048080' THEN DEVTYPE='3490  ';
  IF DEVTYPE='78008000' THEN DEVTYPE='3480  ';
  IF DEVTYPE='78008080' THEN DEVTYPE='3480  ';
  IF DEVTYPE='32108003' THEN DEVTYPE='3420  ';
  IF DEVTYPE='1000080E' THEN DEVTYPE='3800-3';
  IF DEVTYPE='10800809' THEN DEVTYPE='3800-3';
  IF DEVTYPE='1200100B' THEN DEVTYPE='3286  ';
  IF DEVTYPE='12801009' THEN DEVTYPE='3277  ';
  IF DEVTYPE='12201009' THEN DEVTYPE='3278  ';
  IF DEVTYPE='10014100' THEN DEVTYPE='CTCA  ';
  IF DEVTYPE='3010200E' THEN DEVTYPE='3380  ';
  OUTPUT OBR;
  RETURN;

  TYPE04:
  INPUT @004   HDRDS    IB1.
        @009   DATE1    PD4.
        @013   TIME     TU4.
        @025   JOBID    $8.
        @037   ABEND    $PHEX4.
        @121   PROGRAM  $8.
        @325   LMOD     $8.
        @333   CSECT    $8.
        @ ;
  IF HDRDS='1.......'B THEN DELETE;
  IF HDRDS='.1......'B THEN DELETE;
  YY = ROUND(DATE1,1000);
  DDD = DATE1-YY;
  YY = YY/1000;
  DATE = DATEJUL(1000*YY+DDD);
  OUTPUT SFT;
  RETURN;


PROC SUMMARY DATA=WORK.OBR NWAY;
 CLASS DEVTYPE DATE;
 ID DATE;
 VAR TIME;
 OUTPUT OUT=S N=COUNT;
PROC SORT; BY DEVTYPE DATE;
PROC PLOT;
 PLOT COUNT*DATE; BY DEVTYPE;
 FORMAT DATE DATE. ;

./       ADD   NAME=GTF
OPTIONS OBS=MAX;
DATA SVC;
     INFILE IN MISSOVER            LENGTH=LRECL ;
     INPUT    @1   RECTYPE  PIB2. @ ;
     IF RECTYPE = '1111111100000001'B THEN DO ;*(SVC COMPREHENSIVE) ;
        INPUT @3   CLOCK    TODSTAMP8.
              @11  EVENT    PIB2.
              @13  ASCB     PIB4.
              @17  CPUID    PIB2.
              @19  JOBNAME  $CHAR8.
              @27  SVCOPSW  PIB8.
              @29  SVC_NO   PIB2.
              @35  TCB_OLD  PIB4.
              @39  CDENAME  $CHAR8.
              @47  REG15    PIB4.
              @51  REG0     PIB4.
              @55  REG1     PIB4.
              @                    ;
              TIME=TIMEPART(CLOCK) ;

        FORMAT RECTYPE HEX4. ASCB HEX8. CPUID HEX4.

        TIME TIME12. EVENT TCB_OLD SVCOPSW REG1 REG0 REG15 HEX4. ;
        END;



        IF SVC_NO = 6 THEN DO ;
           TYPE='LINK  ' ;
           INPUT @59 EP_NAME $CHAR8.;
           OUTPUT ;
           RETURN ;
        END ;

        IF SVC_NO = 7 THEN DO ;
           TYPE='XCTL  ' ;
           INPUT @59 EP_NAME $CHAR8.;
           OUTPUT ;
           RETURN ;
        END ;


        IF SVC_NO = 8 THEN DO ;
           TYPE='LOAD  ' ;
           INPUT @59 EP_NAME $CHAR8. ;
           OUTPUT ;
           RETURN ;
        END ;

        IF SVC_NO = 9 THEN DO ;
           TYPE='DELETE' ;
           INPUT @59 EP_NAME $CHAR8. ;
           DELETE ;
           RETURN ;
        END ;

        IF SVC_NO =18 THEN DO ;
           TYPE='BLDL  ' ;
           INPUT @64 EP_NAME $CHAR8. ;
           DELETE ;
           RETURN ;
        END ;

        IF SVC_NO =42 THEN DO ;
           TYPE='ATTACH' ;
           INPUT +29 EP_NAME $CHAR8. ;
           OUTPUT ;
           RETURN ;
        END ;
        DELETE;



PROC SUMMARY NWAY;
 CLASS EP_NAME;
 OUTPUT OUT=S;

PROC PRINT; ID EP_NAME;
./       ADD   NAME=HLIST
PROC FORMAT;
 VALUE TYPEFMT
  0='DATA SET (CODE D)      '
  1='USER (CODE U)          '
  2='FREE SPACE ON ML1      '
  4='VOLUME (CODE V)        '
  7='JES3 VOLUME ALLOC COUNT'
 16='STATISTICS OR CONTROL  '
 17='MIGRATED COPY NAME     '
 18='VSAM DATASET ASSOC.    '
 ;
DATA A;
 INFILE MCDS VSAM BUFND=16 BUFNI=16 ;
 INPUT @045 MCHLEN  IB2.
       @047 MCKTYPE IB1.
         ;
PROC FREQ DATA=WORK.A;
 TABLES MCKTYPE;
 FORMAT MCKTYPE TYPEFMT. ;
 TITLE COUNTS OF LOGICAL RECORD TYPES ON THE MCDS;

PROC FREQ DATA=WORK.A;
 TABLES MCKTYPE;
 WEIGHT MCHLEN;
 FORMAT MCKTYPE TYPEFMT. ;
 TITLE PROPORTIONS OF THE TOTAL SPACE TAKEN BY MCDS RECORD TYPES;

PROC DELETE DATA=WORK.A;

DATA ML1 ML2
 MCV
 (KEEP=
 MCVVSN MCVMINAG MCVNMDS MCVNTRKM MCVFRAG
 VOLTYPE FULL AUTOMIGR AUTOBKUP EMPTY SINGLE
 )
 ;

 INFILE MCDS VSAM BUFND=16 BUFNI=16 ;

 INPUT
      @001 TYPE       PIB1.
      @  ;
 IF TYPE=04X THEN DO;
    INPUT
         @002 MCVVSN       $6.
         @073 MCVFLGS      PIB2.
         @123 MCVMINAG     PIB2.
         @125 MCVNMDS      PIB2.
         @127 MCVNTRKM     PIB2.
         @129 MCVFRAG      PIB2.
         @135 MCV3480F     PIB1.
         @  ;

    IF MCVFLGS='10..............'B
    THEN VOLTYPE='PRIMARY';
    IF MCVFLGS='00..............'B
    THEN VOLTYPE='MIGR L1';
    IF MCVFLGS='01..............'B
    THEN VOLTYPE='MIGR L2';
    IF MCVFLGS='.......1........'B
    THEN FULL='YES';
    ELSE FULL='NO ';
    IF MCVFLGS='...1............'B
    THEN AUTOMIGR='NO ';
    ELSE AUTOMIGR='YES';
    IF MCVFLGS='......1.........'B
    THEN AUTOBKUP='YES';
    ELSE AUTOBKUP='NO ';
    IF MCVFLGS='..........1.....'B
    THEN EMPTY='YES';
    ELSE EMPTY='NO ';
    IF MCV3480F='1.......'B
    THEN SINGLE='YES';
    ELSE SINGLE='NO ';
    LABEL
    MCVVSN  ='VOLUME*SERIAL*NUMBER                '
    MCVMINAG='MINIMUM AGE*SELECTED*FOR MIGRATION  '
    MCVNMDS ='DATASETS*PROCESSED*LAST MIGRATION   '
    MCVNTRKM='TRACKS*FREED*LAST MIGRATION         '
    MCVFRAG ='VOLUME*FRAGMENTATION*INDEX          '
    VOLTYPE ='VOLUME*TYPE                         '
    FULL    ='IS VOLUME*FULL?                     '
    AUTOMIGR='AUTOMATIC*MIGRATION*ALLOWED         '
    AUTOBKUP='AUTOMATIC*BACKUP*ALLOWED            '
    EMPTY   ='IS*VOLUME*EMPTY?                    '
    SINGLE  ='3480*SINGLEFILE*FORMAT?             '
    ;
    OUTPUT MCV;
 END;
 INPUT @001 MCDDSN  $44.
       @045 MCHLEN  IB2.
       @047 MCKTYPE IB2.
       @ ;
 IF MCKTYPE=0 THEN DO;
    INPUT @049 MCHTSLU        TODSTAMP8.
          @057 MCHTSCR        TODSTAMP8.
          @065 MCDVSN         $6.
          @071 MCDFLG1        $CHAR1.
          @072 MCDFLG2        IB1.
          @073 MCDCOMPR       IB1.
          @074 MCDRV          IB3.
          @077 MCDDLC1     ?? PD4.
          @081 MCDTLR         IB4.
          @085 MCDDLR1     ?? PD4.
          @089 MCDTLU         IB4.
          @093 MCDDLU      ?? PD4.
          @097 MCDTMIG        IB4.
          @101 MCDDMIG1    ?? PD4.
          @105 MCDDSORG       IB2.
          @107 MCDBLKSZ       IB2.
          @109 MCDKEYLN       IB1.
          @110 MCDRECFM       IB1.
          @111 MCDDSIND       IB1.
          @112 MCDHID         $1.
          @113 MCDSIZE        IB4.
          @117 MCDSIZEB       IB4.
          @121 MCDCSZ         IB4.
          @125 MCDNMIG        IB2.
          @127 MCDDAYS        IB2.
          @129 MCDFRVSN       $6.
          @135 FLASG2         IB1.
          @136 MCDMCL43       $1.
          @137 MCDCTID        $4.
          @141 MCDUCBTY       IB4.
          @145 MCDTRES        IB4.
          @149 MCDDRES     ?? PD4.
          @153 MCDMDEVT       IB4.
          @157 MCDJDAYS       IB1.
          @158 MCDJDATE       IB3.
          @161 MCDJVEXD       IB3.
          @164 MCDPDEP        IB1.
          @165 MCDJCT         IB1.
          @217 MCDEXPD1   ??  PD4.
          @ ;
    IF MCDFLG1='1.......'B;
    IF MCDFLG1='....1...'B THEN SDSP='YES'; ELSE SDSP='NO ';
    IF MCDFLG1='.....1..'B THEN LEVEL='ML2'; ELSE LEVEL='ML1';
    I=INDEX(MCDDSN,'.');
    IF I=0 THEN I=8;
    HIQUAL=SUBSTR(MCDDSN,1,I-1);
    I=INDEX(MCDDSN,' ');
    DO J = 1 TO I;
       IF SUBSTR(MCDDSN,J,1)='.'
       THEN LOWQUAL=SUBSTR(MCDDSN,J+1);
    END;
    DROP I J;
    IF MCDDLC1¬=.
    THEN MCDDLC=PUT(DATEJUL(MCDDLC1),DATE.);
    ELSE MCDDLC='.';
    IF MCDDLR1¬=.
    THEN MCDDLR=PUT(DATEJUL(MCDDLR1),DATE.);
    ELSE MCDDLR='.';
    IF MCDDMIG1¬=.
    THEN MCDDMIG=PUT(DATEJUL(MCDDMIG1),DATE.);
    ELSE MCDDMIG='.';
    IF MCDEXPD1¬=.
    THEN MCDEXPDT=PUT(DATEJUL(MCDEXPDT),DATE.);
    ELSE MCDEXPDT='.';
    AGE=TODAY()-DATEJUL(MCDDLR1);
    FORMAT AGE 3.;
    IF LEVEL='ML1'
    THEN DO;
       IF SDSP='NO'
       THEN ML1TRKS=CEIL(MCDCSZ/18);
       ELSE ML1TRKS=MCDCSZ/18;
    END;
    ELSE ML1TRKS=0;
    IF LEVEL='ML1' THEN OUTPUT ML1;
    IF LEVEL='ML2' THEN OUTPUT ML2;
 END;
    LABEL
    HIQUAL  ='HIGH*LEVEL*QUALIFIER                '
    MCDDSN  ='DATA*SET*NAME                       '
    MCDDLC  ='CREATION*DATE                       '
    MCDDLC  ='DATE*LAST*REFERENCED                '
    MCDDMIG ='DATE*MIGRATED                       '
    MCDVSN  ='MIGRATION*VOLUME*SERIAL             '
    MCDFRVSN='VOLUME*MIGRATED*FROM                '
    SDSP    ='MIGRATED*INTO*SDSP?                 '
    MCDCOMPR='PERCENT*COMPRESSED                  '
    MCDSIZE ='ORIGINAL*SIZE*IN TRKS               '
    ;

PROC PRINT DATA=WORK.MCV SPLIT='*'; ID MCVVSN;
 TITLE PRIMARY AND MIGRATION VOLUMES CONTROLLED BY DFHSM;
 TITLE2 ;

PROC SUMMARY DATA=WORK.ML1 NWAY;
 CLASS HIQUAL ;
 VAR MCDCSZ ML1TRKS MCDCOMPR AGE MCDSIZE ;
 OUTPUT OUT=S N(MCDCSZ)=DATASETS SUM(ML1TRKS)=
 MEAN(MCDCOMPR)=AVGCOMPR MEAN(AGE)=AVGAGE
 SUM(MCDSIZE)=ML0TRKS;

DATA S;
 SET S;
    LABEL
    AVGAGE  ='AVERAGE*DAYS*UNUSED                 '
    ML0TRKS ='TRACKS*USED ON*LEVEL 0              '
    ML1TRKS ='TRACKS*USED ON*LEVEL 1              '
    AVGCOMPR='AVERAGE*PERCENT*COMPRESSION         '
    ;

PROC PRINT DATA=WORK.S;
 ID HIQUAL; VAR DATASETS AVGAGE ML0TRKS ML1TRKS AVGCOMPR;
 TITLE SUMMARY OF MIGRATED DATASETS BY HIGH LEVEL QUALIFIER;
 TITLE2 LEVEL 1 ONLY;
 SUM DATASETS ML0TRKS ML1TRKS;


PROC SUMMARY DATA=WORK.ML2 NWAY;
 CLASS HIQUAL ;
 VAR MCDCSZ ML1TRKS MCDCOMPR AGE MCDSIZE ;
 OUTPUT OUT=S N(MCDCSZ)=DATASETS SUM(ML1TRKS)=
 MEAN(MCDCOMPR)=AVGCOMPR MEAN(AGE)=AVGAGE
 SUM(MCDSIZE MCDCSZ)=ML0TRKS ML2BLKS;

DATA S;
 SET S;
    LABEL
    AVGAGE  ='AVERAGE*DAYS*UNUSED                 '
    ML0TRKS ='TRACKS*USED ON*LEVEL 0              '
    ML2TRKS ='TRACKS*USED ON*LEVEL 2              '
    AVGCOMPR='AVERAGE*PERCENT*COMPRESSION         '
    ;

PROC PRINT DATA=WORK.S;
 ID HIQUAL; VAR DATASETS AVGAGE ML0TRKS ML2BLKS AVGCOMPR;
 TITLE SUMMARY OF MIGRATED DATASETS BY HIGH LEVEL QUALIFIER;
 TITLE2 LEVEL 2 ONLY;
 SUM DATASETS ML0TRKS ML2BLKS;

PROC SUMMARY DATA=WORK.ML1 NWAY;
 CLASS MCDVSN ;
 VAR MCDCSZ;
 OUTPUT OUT=S N=DATASETS SUM=BLOCKS;

PROC CHART DATA=WORK.S;
 VBAR MCDVSN / TYPE=SUM SUMVAR=DATASETS DISCRETE NOSPACE;
 TITLE SUMMARY OF MIGRATED DATASETS BY ML1 VOLUME;
 TITLE2 ;

PROC CHART DATA=WORK.S;
 VBAR MCDVSN / TYPE=SUM SUMVAR=BLOCKS DISCRETE NOSPACE;
 TITLE SUMMARY OF BLOCKS ON ML1 VOLUMES;
 TITLE2 ;


PROC SUMMARY DATA=WORK.ML2 NWAY;
 CLASS MCDVSN ;
 VAR MCDCSZ;
 OUTPUT OUT=S N=DATASETS SUM=BLOCKS;

PROC CHART DATA=WORK.S;
 VBAR MCDVSN / TYPE=SUM SUMVAR=DATASETS DISCRETE NOSPACE;
 TITLE SUMMARY OF MIGRATED DATASETS BY ML2 VOLUME;
 TITLE2 ;

PROC CHART DATA=WORK.S;
 VBAR MCDVSN / TYPE=SUM SUMVAR=BLOCKS DISCRETE NOSPACE;
 TITLE SUMMARY OF BLOCKS ON ML2 VOLUMES;
 TITLE2 ;

PROC SUMMARY DATA=WORK.ML1 NWAY;
 CLASS SDSP ;
 VAR MCDCSZ;
 OUTPUT OUT=S N=DATASETS SUM=BLOCKS;

PROC CHART DATA=WORK.S;
 VBAR SDSP / TYPE=SUM SUMVAR=DATASETS DISCRETE NOSPACE;
 TITLE SUMMARY OF MIGRATED DATASETS BY SDSP VS NOSDSP;

PROC CHART DATA=WORK.S;
 VBAR SDSP / TYPE=SUM SUMVAR=BLOCKS DISCRETE NOSPACE;
 TITLE SUMMARY OF 2K BLOCKS BY SDSP VS NOSDSP;



PROC SORT DATA=WORK.ML1; BY DESCENDING ML1TRKS;

OPTIONS OBS=50;
PROC PRINT UNIFORM DATA=WORK.ML1;
 ID MCDDSN;
 VAR MCDDLC MCDDLR MCDDMIG
 MCDVSN MCDFRVSN SDSP MCDCOMPR MCDSIZE ML1TRKS;
 SUM MCDSIZE ML1TRKS;
 TITLE LISTING OF LARGEST MIGRATED DATASETS ON LEVEL 1;

OPTIONS OBS=MAX;
PROC SUMMARY DATA=WORK.ML1 NWAY;
 CLASS LOWQUAL;
 VAR ML1TRKS MCDCOMPR;
 OUTPUT OUT=S N(MCDCOMPR)=DATASETS SUM(ML1TRKS)=
 MEAN(MCDCOMPR)= ;

DATA S;
 SET S;
 IF DATASETS GT 9 OR ML1TRKS GT 99;

PROC PRINT DATA=WORK.S;
 ID LOWQUAL; VAR DATASETS ML1TRKS MCDCOMPR;
             SUM DATASETS ML1TRKS;
 TITLE AVERAGE COMPRESSION AMOUNT BY LOWEST LEVEL QUALIFIER;



PROC UNIVARIATE DATA=WORK.ML1 NOPRINT;
 VAR MCDSIZE;
 OUTPUT OUT=S1 N=DATASETS MEAN=AVGSIZE P90=PCTL90
 P95=PCTL95 P99=PCTL99 MAX=LARGEST ;

PROC PRINT DATA=WORK.S1; ID DATASETS;
 TITLE STATISTICS ON ORIGINAL SIZES OF MIGRATED DATASETS;
 TITLE2 IN TRACKS - LEVEL 1;

PROC UNIVARIATE DATA=WORK.ML2 NOPRINT;
 VAR MCDSIZE;
 OUTPUT OUT=S2 N=DATASETS MEAN=AVGSIZE P90=PCTL90
 P95=PCTL95 P99=PCTL99 MAX=LARGEST ;

PROC PRINT DATA=WORK.S2; ID DATASETS;
 TITLE STATISTICS ON ORIGINAL SIZES OF MIGRATED DATASETS;
 TITLE2 IN TRACKS - LEVEL 2;

PROC FORMAT;
 VALUE BTYPFMT
  32='DATA SET (CODE B)      '
  33='DUMP VOLUME            '
  34='DUMP CLASS             '
  36='BACKUP VERSION ENTRY   '
  38='MOVE BACKUP COPY       '
  39='BACKUP MIGRATED DATASET'
  40='VOLUME BACKED UP       '
  41='DUMP GENERATION        '
  44='BACKUP VOLUME          '
  48='CONTROL                '
 ;
DATA A;
 INFILE BCDS VSAM BUFND=16 BUFNI=16 ;
 INPUT @045 MCHLEN  IB2.
       @047 MCKTYPE IB1.
         ;

PROC FREQ DATA=WORK.A;
 TABLES MCKTYPE;
 FORMAT MCKTYPE BTYPFMT. ;
 TITLE COUNTS OF LOGICAL RECORD TYPES ON THE BCDS;
 TITLE2 ;

PROC FREQ DATA=WORK.A;
 TABLES MCKTYPE;
 WEIGHT MCHLEN;
 FORMAT MCKTYPE BTYPFMT. ;
 TITLE PROPORTIONS OF THE TOTAL SPACE TAKEN BY BCDS RECORD TYPES;


DATA
 MCT
 (KEEP=
 MCTVSN MCTDAY MCTTSFBD MCTTSLBD MCTTSLCD
 FULL SINGLE
 )
 MCP
 (KEEP=
 MCPVSN MCPTSLBD MCPTSLBT
 AUTORECL AUTOBKUP VOLTYPE
 )
 ;
 INFILE BCDS VSAM BUFND=16 BUFNI=16 ;
 INPUT
      @001 TYPE       PIB1.
      @  ;
 IF TYPE=2CX THEN DO;
    INPUT
         @002 MCTVSN       $6.
         @083 MCTFLGS      PIB2.
         @105 MCTTSFB1  ?? PD4.
         @113 MCTTSLB1  ?? PD4.
         @127 MCTVOLSQ     PIB2.
         @168 MCTDAY       PIB1.
         @185 MCTTSLC1  ?? PD4.
         @  ;

    IF MCTFLGS='.1..............'B
    THEN FULL='YES';
    ELSE FULL='NO ';
    IF MCTFLGS='.............1..'B
    THEN SINGLE='YES';
    ELSE SINGLE='NO ';
    IF MCTTSFB1¬=.
    THEN MCTTSFBD=PUT(DATEJUL(MCTTSFB1),DATE.);
    ELSE MCTTSFBD='.';
    DROP MCTTSFB1;
    IF MCTTSLB1¬=.
    THEN MCTTSLBD=PUT(DATEJUL(MCTTSLB1),DATE.);
    ELSE MCTTSLBD='.';
    DROP MCTTSLB1;
    IF MCTTSLC1¬=.
    THEN MCTTSLCD=PUT(DATEJUL(MCTTSLC1),DATE.);
    ELSE MCTTSLCD='.';
    DROP MCTTSLC1;
    LABEL
    MCTVSN  ='BACKUP*VOLUME*SERIAL                    '
    MCTDAY  ='BACKUP*CYCLE*DAY                        '
    MCTTSFBD='DATE OF*1ST BKUP*THIS VOL               '
    MCTTSLBD='DATE OF*LAST BKUP*THIS VOL              '
    MCTTSLCD='DATE OF*MOST RECENT*CLEANUP             '
    FULL    ='IS*VOLUME*FULL?                         '
    SINGLE  ='3480*SINGLEFILE*FORMAT?                 '
     ;
    OUTPUT MCT;
 END;

 IF TYPE=28X THEN DO;
    INPUT
         @002 MCPVSN       $6.
         @073 MCPFLGS      PIB2.
         @077 MCPTSLBH     PK1.
         @078 MCPTSLBM     PK1.
         @079 MCPTSLBS     PK2.2
         @081 MCPTSLB1  ?? PD4.
         @ ;
    IF MCPTSLB1¬=.
    THEN MCPTSLBD=PUT(DATEJUL(MCPTSLB1),DATE.);
    ELSE MCPTSLBD='.';
    DROP MCPTSLB1;
    MCPTSLBT=HMS(MCPTSLBH,MCPTSLBM,MCPTSLBS);
    FORMAT MCPTSLBT TIME10.2 ;
    IF MCPFLGS='1...............'B
    THEN VOLTYPE='PRIMARY  ';
    ELSE VOLTYPE='MIGRATION';
    IF MCPFLGS='.......1........'B
    THEN AUTOBKUP='YES';
    ELSE AUTOBKUP='NO ';
    IF MCPFLGS='......1.........'B
    THEN AUTORECL='NO ';
    ELSE AUTORECL='YES';
    LABEL
    MCPVSN  ='SERIAL OF*VOLUME*BACKED UP           '
    MCPTSLBD='DATE OF*MOST RECENT*BACKUP           '
    MCPTSLBT='TIME OF*MOST RECENT*BACKUP           '
    AUTORECL='AUTOMATIC*RECALL*ALLOWED             '
    AUTOBKUP='AUTOMATIC*BACKUP*ALLOWED             '
    VOLTYPE ='VOLUME*TYPE                          '
    ;
    OUTPUT MCP;
 END;

PROC PRINT DATA=WORK.MCT SPLIT='*'; ID MCTVSN;
TITLE VOLUMES CONTAINING BACKUP VERSIONS;
TITLE2 ;

PROC PRINT DATA=WORK.MCP SPLIT='*'; ID MCPVSN;
TITLE VOLUMES FROM WHICH BACKUPS HAVE BEEN TAKEN;
TITLE2 ;

DATA TTOC
     (KEEP=VOLSER TYPE DATASETS FULL VSAM VALID
     PREVVOL NEXTVOL
     BLOCKS PSWD RCYCLMSG
     );
 INFILE OCDS VSAM BUFND=16 BUFNI=16 EOF=EOFOCDS;
 INPUT @001 TTCKEY  $44.
       @045 MCHLEN  IB2.
       @047 MCKTYPE IB2.
       @049 MCHTSLU        TODSTAMP8.
       @057 MCHTSCR        TODSTAMP8.
       @065 TTCHSTID       $1.
       @066 TTCFFLGS       IB2.
       @069 TTCUNIT        $8.
       @077 TTCNUM         IB2.
       @079 TTCDSNUM       IB2.
       @081 TTCTBLK        IB4.
       @085 TTCVBLK        IB4.
       @089 TTCPREVL       $6.
       @095 TTCSUCVL       $6.
       @101 TTCLFBID       IB4.
       @105 TTCFFBID       IB4.
       @ ;
 RETAIN
           VOLSER TYPE DATASETS FULL VSAM VALID
     PREVVOL NEXTVOL
     BLOCKS PSWD RCYCLMSG
 ;
 IF SUBSTR(TTCKEY,12,4)='0000'
 THEN DO;
    OUTPUT;
    VALID=0;
    VSAM=0;
    DATASETS=0;
    BLOCKS=0;
    VOLSER=SUBSTR(TTCKEY,5,6);
    FULL=REPEAT(' ',3);
    PREVVOL=TTCPREVL;
    NEXTVOL=TTCSUCVL;
    IF TTCFFLGS='1...............'B
    THEN FULL='YES';
    ELSE FULL='NO ';
    IF TTCFFLGS='...1............'B
    THEN PSWD='YES';
    ELSE PSWD='NO ';
    IF TTCFFLGS='....1...........'B
    THEN RCYCLMSG='YES';
    ELSE RCYCLMSG='NO ';
    IF SUBSTR(TTCKEY,2,2) ='SP' THEN TYPE='SPILL       ';
    IF SUBSTR(TTCKEY,2,2) ='UN' THEN TYPE='UNASSIGNED  ';
    IF SUBSTR(TTCKEY,2,2) ='L2' THEN TYPE='LEVEL 2     ';
    IF SUBSTR(TTCKEY,2,2)>='00' THEN TYPE='DAILY BACKUP';
 END;
 DATASETS=DATASETS+TTCDSNUM;
 DO COL=157 TO MCHLEN BY 56;
    INPUT @COL              TTCDSN        $44.
          @COL+044          TTCNBLKS      IB4.
          @COL+048          TTCDLR     ?? PD3.
          @COL+052          TTCEFLGS      IB1.
          @COL+053          TTCEXPDT   ?? PD3.
          @ ;
    IF TTCEFLGS='.1......'B THEN VALID=VALID+1;
    IF TTCEFLGS='1.......'B THEN VSAM=VSAM+1;
    BLOCKS=BLOCKS+TTCNBLKS;
 END;
 RETURN;
 EOFOCDS: OUTPUT;

DATA TTOC;
 SET TTOC;
 IF DATASETS=. THEN DELETE;

PROC PRINT; ID VOLSER;
 SUM DATASETS VALID BLOCKS;
 TITLE TAPE VOLUMES IN USE BY DFHSM;
./       ADD   NAME=HSMFSR
PROC FORMAT;
 VALUE FSRFMT
  1='MIGRATE L0->L1 '
  2='MIGRATE L1->L2 '
  3='MIGRATE L0->L2 '
  4='RECALL L1->L0  '
  5='RECALL L2->L0  '
  6='HDELETE        '
  7='DAILY BACKUP   '
  8='SPILL BACKUP   '
  9='RECOVERY       '
 10='RECYCLE BACKVOL'
 11='HBDELETE       '
 12='RECYCLE ML2    '
 13='VOLUME DUMP    '
 14='RESTORE        '
 ;

DATA FSR;
  INFILE SMF STOPOVER LENGTH=LENGTH COL=COL RECFM=VBS LRECL=32756
             JFCB=SMFJFCB START=BEGINCPY;
  LENGTH PREVTIME SMFTIME 8 ID MVSXA OFFSMF 2 ;
  FORMAT
         MVSXAFLG                   HEX2.
         SMFJFCB                 $HEX200.
         RUNDATE                 MMDDYY8.
         PREVTIME SMFTIME     DATETIME19.2
         SYSTEM                       $4.
  ;
  IF OFFSMF=. THEN DO;
     IF SUBSTR(SMFJFCB,100,1)='....1...'B  THEN OFFSMF=4;
     ELSE OFFSMF=0;
     BEGINCPY=OFFSMF+1;
     RETAIN BEGINCPY OFFSMF RUNDATE SMFTIME SYSTEM;
     RUNDATE=TODAY();
  END;
  PREVTIME=SMFTIME;
  PREVSYS = SYSTEM;
  IF OFFSMF=4 THEN DO;
    INPUT @5 EOFSTRNG $CHAR7. @;
    IF EOFSTRNG=:'SMF EOF'
    OR EOFSTRNG=:'SMFEOF' THEN STOP;
  END;
  INPUT @1+OFFSMF MVSXAFLG     PIB1.
        @2+OFFSMF ID           PIB1.
        @3+OFFSMF SMFTIME SMFSTAMP8.
       @11+OFFSMF SYSTEM         $4.
  @;
  MVSXA=0;
  IF MVSXAFLG='.....1..'B THEN MVSXA=1;
  IF ID=241;

  INPUT @015+OFFSMF  FSRJBN      $8.
        @023+OFFSMF  FSRRST      SMFSTAMP8.
        @031+OFFSMF  FSRUID      $8.
        @039+OFFSMF  FSRTYPE     PIB1.
        @041+OFFSMF  FSRDSN      $44.
        @085+OFFSMF  FSRTVOL     $6.
        @091+OFFSMF  FSRDEVT     PIB4.
        @095+OFFSMF  FSRFVOL     $6.
        @105+OFFSMF  FSRRC       PIB4.
        @109+OFFSMF  FSRREAS     PIB4.
        @113+OFFSMF  FSRABCC     PIB4.
        @117+OFFSMF  FSRDARC     PIB2.
        @119+OFFSMF  FSRGRP      $8.
        @127+OFFSMF  FSRRACF     IB1.
        @129+OFFSMF  FSRRQN      IB4.
        @133+OFFSMF  FSRDATR     PD4.
        @137+OFFSMF  FSRTIMRH    PK1.
        @138+OFFSMF  FSRTIMRM    PK1.
        @139+OFFSMF  FSRTIMRS    PK2.2
        @141+OFFSMF  FSRTIMSH    PK1.
        @142+OFFSMF  FSRTIMSM    PK1.
        @143+OFFSMF  FSRTIMSS    PK2.2
        @145+OFFSMF  FSRTIMEH    PK1.
        @146+OFFSMF  FSRTIMEM    PK1.
        @147+OFFSMF  FSRTIMES    PK2.2
        @149+OFFSMF  FSRTIMAH    PK1.
        @150+OFFSMF  FSRTIMAM    PK1.
        @151+OFFSMF  FSRTIMAS    PK2.2
        @153+OFFSMF  FSRDLU   ?? PD4.
        @157+OFFSMF  FSRDLM   ?? PD4.
        @161+OFFSMF  FSRBYTR     IB4.
        @165+OFFSMF  FSRBYTW     IB4.
        @169+OFFSMF  FSRTRKR     IB2.
        @171+OFFSMF  FSRTRKW     IB2.
        @173+OFFSMF  FSRDORG     PIB2.
        @175+OFFSMF  FSRFLG2     PIB2.
        @ ;
 IF FSRFLG2='....1...........'B
 THEN INPUT
        @101+OFFSMF  FSRDATE  ?? PD4.
        @ ;
 ELSE INPUT
        @101+OFFSMF  FSRGEN      PIB4.
        @ ;
 INPUT
        @181+OFFSMF  FSRAGE      IB2.
        @183+OFFSMF  FSRRECFM    IB1.
        @184+OFFSMF  FSROPTCD    IB1.
        @237+OFFSMF  FSRNENT1    IB2.
        @239+OFFSMF  FSRNENT2    IB2.
        @ ;
 FSRTIMR=HMS(FSRTIMRH,FSRTIMRM,FSRTIMRS);
 FORMAT FSRTIMR TIME8. ;
 DROP FSRTIMRH FSRTIMRM FSRTIMRS ;
 FSRTIMS=HMS(FSRTIMSH,FSRTIMSM,FSRTIMSS);
 FORMAT FSRTIMS TIME8. ;
 DROP FSRTIMSH FSRTIMSM FSRTIMSS ;
 FSRTIME=HMS(FSRTIMEH,FSRTIMEM,FSRTIMES);
 FORMAT FSRTIME TIME8. ;
 DROP FSRTIMEH FSRTIMEM FSRTIMES ;
 FSRTIMA=HMS(FSRTIMAH,FSRTIMAM,FSRTIMAS);
 FORMAT FSRTIMA TIME8. ;
 DROP FSRTIMAH FSRTIMAM FSRTIMAS ;
 DURATION=FSRTIME-FSRTIMR;
 FORMAT DURATION TIME8. ;
 WAITING=FSRTIMS-FSRTIMR;
 FORMAT WAITING TIME8. ;
 PENDING=FSRTIMA-FSRTIMR;
 FORMAT PENDING TIME8. ;
 FUNCTION=PUT(FSRTYPE,FSRFMT.);
 DATE=PUT(DATEPART(SMFTIME),DATE.);
 IF FSRTYPE=1 OR FSRTYPE=3
 THEN DO;
    L0VOL=FSRFVOL;
    L1VOL=FSRTVOL;
    L0BYTES=FSRBYTR;
    L1BYTES=FSRBYTW;
    L0TRKS=FSRTRKR;
    L1TRKS=FSRTRKW;
 END;
 IF FSRTYPE=4
 THEN DO;
    L0VOL=FSRTVOL;
    L1VOL=FSRFVOL;
    L0BYTES=FSRBYTW;
    L1BYTES=FSRBYTR;
    L0TRKS=FSRTRKW;
    L1TRKS=FSRTRKR;
 END;
  LABEL
  FSRDSN  ='DATASET*NAME                            '
  FUNCTION='DFHSM*OPERATION*TYPE                    '
  FSRTIMR ='TIME OF*USER''S*REQUEST                 '
  FSRTVOL ='RECEIVING*VOLUME*SERIAL                 '
  FSRFVOL ='ORIGINAL*VOLUME*SERIAL                  '
  DURATION='TIME TAKEN*TO PROCESS*REQUEST           '
  WAITING ='TIME REQUEST*WAS QUEUED*BY DFHSM        '
  PENDING ='MOUNT*PENDING*TIME                      '
  FSRRC   ='MWE*RETURN*CODE                         '
  L0VOL   ='PRIMARY*VOLUME*SERIAL                   '
  L1VOL   ='LEVEL 1*MIGRATION*VOLUME                '
  L0BYTES ='BYTES*TRANSFERRED*ON PRIMARY            '
  L0TRKS  ='TRACKS*TRANSFERRED*ON PRIMARY           '
  L1BYTES ='BYTES*TRANSFERRED*ON LEVEL 1            '
  L1TRKS  ='TRACKS*TRANSFERRED*ON LEVEL 1           '
  ;

PROC SORT; BY DATE FSRTIMR;


PROC PRINT SPLIT='*';
 ID FSRDSN;
 VAR FSRJBN FUNCTION FSRTIMR
 FSRTVOL FSRFVOL DURATION WAITING FSRRC;
 BY DATE;

PROC SORT; BY FUNCTION;

PROC SUMMARY DATA=WORK.FSR NWAY;
 CLASS FSRRC;
 BY FUNCTION;
 VAR FSRAGE;
 OUTPUT OUT=S N=COUNT;

PROC PRINT DATA=WORK.S;
 ID FSRRC; VAR COUNT; BY FUNCTION;

PROC DELETE DATA=WORK.S;


PROC SUMMARY DATA=WORK.FSR NWAY;
 CLASS FUNCTION;
 VAR DURATION WAITING;
 OUTPUT OUT=S MEAN(DURATION WAITING)=AVGRESP AVGQUEUE
              MAX(DURATION WAITING)=MAXRESP MAXQUEUE
              N=COUNT ;
  LABEL
  AVGRESP ='AVERAGE*SERVICE*TIME                    '
  MAXRESP ='MAXIMUM*SERVICE*TIME                    '
  AVGQUEUE='AVERAGE*QUEUE*TIME                      '
  MAXQUEUE='MAXIMUM*QUEUE*TIME                      '
  COUNT   ='TIMES*FUNCTION*EXECUTED                 '
  ;

PROC PRINT DATA=WORK.S SPLIT='*';
 ID FUNCTION;
 VAR COUNT AVGRESP MAXRESP AVGQUEUE MAXQUEUE;
 FORMAT AVGRESP MAXRESP AVGQUEUE MAXQUEUE TIME8. ;

PROC SUMMARY DATA=WORK.FSR NWAY;
 CLASS DATE L1VOL;
 VAR L1BYTES L1TRKS;
 OUTPUT OUT=S SUM= ;

PROC PRINT SPLIT='*';
 ID L1VOL; VAR L1BYTES L1TRKS; BY DATE;


PROC SUMMARY DATA=WORK.FSR NWAY;
 CLASS DATE L0VOL;
 VAR L0BYTES L0TRKS;
 OUTPUT OUT=S SUM= ;

PROC PRINT SPLIT='*';
 ID L0VOL; VAR L0BYTES L0TRKS; BY DATE;

PROC SORT DATA=WORK.FSR; BY FUNCTION;

PROC CHART DATA=WORK.FSR;
 VBAR DURATION / TYPE=FREQ NOSPACE
 MIDPOINTS=0.1 0.25 0.5 0.75 1.0 1.5 2 3 4 5 7.5 10 15 30 60 90 120 180
 240 300 600 1200 1800;
 BY FUNCTION;

PROC CHART DATA=WORK.FSR;
 VBAR FSRAGE / TYPE=FREQ NOSPACE DISCRETE;
 BY FUNCTION;

PROC CHART DATA=WORK.FSR;
 VBAR PENDING / TYPE=FREQ NOSPACE DISCRETE;
 BY FUNCTION;

./       ADD   NAME=HSMLOG
PROC FORMAT;
 VALUE FSRFMT
  1='MIGRATE L0->L1         '
  2='MIGRATE L1->L2         '
  3='MIGRATE L0->L2         '
  4='RECALL L1->L0          '
  5='RECALL L2->L0          '
  6='DELETE MIGRATED DATASET'
  7='DAILY BACKUP           '
  8='SPILL BACKUP           '
  9='RECOVERY               '
 10='RECYCLE BACKUP VOLUME  '
 11='DATA SET DELETION      '
 12='RECYCLE ML2 VOLUME     '
 13='FULL VOLUME DUMP       '
 14='VOLUME/DATASET RESTORE '
 ;

 VALUE MWEFMT
  0='RETURN THE QCT POINTER       '
  1='START UP DFHSM               '
  2='SHUTDOWN DFHSM               '
  3='RECALL A DATASET             '
  4='UNUSED                       '
  5='RECOVER A DATASET OR VOLUME  '
  6='MIGRATE A DATASET OR VOLUME  '
  7='BACKUP A DATASET OR VOLUME   '
  8='READ A CONTROL DATASET RECORD'
  9='PROCESS COMMAND TEXT         '
 10='POST AN MWE COMPLETE         '
 11='PURGE THE MWE                '
 12='DELETE A MIGRATED DATASET    '
 ;

 VALUE LOGFMT
  1='DFHSM STARTUP                         '
  2='OPERATOR COMMAND RECEIVED             '
  3='OUTPUT MESSAGE TO OPERATOR            '
  4='MWE RECEIVED BY ARCCTL                '
  5='RECALL OR DELETION STARTED            '
  6='RECALL OR DELETION ENDED              '
  7='MIGRATION STARTED                     '
  8='MIGRATION ENDED                       '
  9='ARCERP PROCESSING PERFORMED           '
 10='SUBTASK ABNORMAL END                  '
 11='MWE RECEIVED BY MIGRATION SUBTASK     '
 12='DFHSM SHUTDOWN                        '
 13='MWE COMPLETED                         '
 14='STATISTICS RECORD                     '
 15='CONTROL DATASET UPDATE OR NEW ENTRY   '
 16='CONTROL DATASET ENTRY DELETED         '
 17='BACKUP OF DATASET STARTED             '
 18='BACKUP OF DATASET ENDED               '
 19='RECOVERY OF BACKUP VERSION STARTED    '
 20='RECOVERY OF BACKUP VERSION ENDED      '
 21='DATASET DELETION OR RETIREMENT STARTED'
 22='DELETION ENDED                        '
 23='RECYCLE STARTED                       '
 24='RECYCLE ENDED                         '
 ;
DATA OPERATNS(KEEP=DATE TIME FUNCTION UID DSNAME VSN RC REAS
                   KBYTES)
     CMDLOG(KEEP=DATE TIME UID COMMAND)
     MSGLOG(KEEP=DATE TIME TO TEXT)
     DSR   (KEEP=DATE TIME DSRIPL DSRABEND DSRSHUT DSRNMWE DSREJST
               DSREVENT         DSRNVMG DSRNVBU
               PL1NDS PL1NTRKR PL1NTRKW
               PL1NBYTR PL1NBYTW PL1NDSF PL1NVOL PL1NSYS PL1TAGE
               PL1TTINQ PL1TTWV PL1TTINP PL1TTOT
               L1PNDS L1PNTRKR L1PNTRKW
               L1PNBYTR L1PNBYTW L1PNDSF L1PNVOL L1PNSYS L1PTAGE
               L1PTTINQ L1PTTWV L1PTTINP L1PTTOT
     )
     ;
 INFILE HSMLOG ;
 INPUT  @1   MRECL     IB2.
  @ ;
 I = 3;
 DO WHILE (I <= MRECL);
  MWEFUNC=.;
  MWEDSN=REPEAT(' ',44);
  MWEUID=REPEAT(' ',8);
  UID=REPEAT(' ',8);
  VSN=REPEAT(' ',6);
  DATE=.;
  TIME=.;
  FUNCTION=REPEAT(' ',38);
  DSNAME=REPEAT(' ',44);
  INPUT
        @I    MLOGL     IB2.
        @I+2  MLOGID    IB1.
        @I+3  MLOGFLGS  IB1.
        @I+4  MLOGJUL   PD4.
        @I+8  MLOGHH    PK1.
        @I+9  MLOGMM    PK1.
        @I+10 MLOGSS    PK1.
        @I+11 MLOGTT    PK1.
     @ ;
  DATE=DATEJUL(MLOGJUL);
  TIME=HMS(MLOGHH,MLOGMM,MLOGSS);
  IF MLOGID=03 THEN LINK ID03;
  IF MLOGID=04 THEN LINK ID04;
  IF MLOGID=06 THEN LINK ID06;
  IF MLOGID=08 THEN LINK ID06;
  IF MLOGID=14 THEN LINK ID14;
  I = I+MLOGL;
 END;
 RETURN;
 ID03: /* MESSAGE TEXT.          */
 INPUT @I+16   TO       $8.
       @ ;
 INPUT @I+24   TEXTL    IB1.
       @ ;
 TEXTL=TEXTL-1;
 INPUT @I+25   MSGTEXT  $VARYING132. TEXTL
       @ ;
 TEXT=PUT(MSGTEXT,$110.);
 OUTPUT MSGLOG;
 RETURN;
 ID04: /* ARCCTL RECEIVES MWE.   */
 INPUT @I+12   MWEFWD   IB4.
       @I+16   MWEBWD   IB4.
       @I+20   MWESPN   IB1.
       @I+21   MWELEN   IB3.
       @I+24   MWEFSR   IB4.
       @I+28   MWETSTIM IB4.
       @I+32   MWETSDAT PD4.
       @I+36   MWEFUNC  IB1.
       @I+40   MWEUID   $8.
       @ ;
 IF MWEFUNC¬=9 THEN RETURN;
 INPUT @I+152  MWECMDL  IB2.
       @ ;
 MWECMDL=MWECMDL-4;
 INPUT @I+156  MWECMDT  $VARYING80. MWECMDL
       @ ;
 COMMAND=PUT(MWECMDT,$80.);
 UID=MWEUID;
 OUTPUT CMDLOG;
 RETURN;
 ID06: /* RECALL/DELETE ENDED. */
 INPUT @I+30   FSRJBN   $8.
       @I+54   FSRTYPE  IB1.
       @I+56   FSRDSN   $44.
       @I+100  FSRTVOL  $6.
       @I+110  FSRFVOL  $6.
       @I+120  FSRRC    IB4.
       @I+124  FSRREAS  IB4.
       @I+176  FSRBYTR  IB4.
       @I+180  FSRBYTW  IB4.
       @ ;
 FUNCTION=PUT(FSRTYPE,FSRFMT.);
 UID=FSRJBN;
 DSNAME=FSRDSN;
 IF FSRTYPE=4 OR FSRTYPE=5 OR FSRTYPE=9
 THEN VSN=FSRTVOL;
 ELSE VSN=FSRFVOL;
 RC=FSRRC;
 REAS=FSRREAS;
 KBYTES=(FSRBYTR+FSRBYTW)/1024;
 OUTPUT OPERATNS;
 RETURN;
 ID14: /* STATISTICS RECORD. */
 INPUT @I+12   DSRKEY   $44.
       @ ;
 IF SUBSTR(DSRKEY,2,3)¬='DSR' THEN RETURN;
 INPUT @I+076  DSRIPL   IB4.
       @I+080  DSRABEND IB4.
       @I+084  DSRSHUT  IB4.
       @I+088  DSRNMWE  IB4.
       @I+096  DSREJST1 IB4.
       @I+112  DSREVENT IB4.
       @I+120  DSRNVMG  IB2.
       @I+124  DSRNVBU  IB2.
       @I+196  PL1NDS   IB2.
       @I+204  PL1NTRKR IB4.
       @I+208  PL1NTRKW IB4.
       @I+212  PL1NBYTR IB4.
       @I+216  PL1NBYTW IB4.
       @I+220  PL1NDSF  IB2.
       @I+222  PL1NVOL  IB2.
       @I+224  PL1NSYS  IB2.
       @I+226  PL1TAGE  IB2.
       @I+228  PL1TTINQ IB4.
       @I+232  PL1TTWV  IB4.
       @I+236  PL1TTINP IB4.
       @I+240  PL1TTOT  IB4.
       @I+192+196 L1PNDS   IB2.
       @I+192+204 L1PNTRKR IB4.
       @I+192+208 L1PNTRKW IB4.
       @I+192+212 L1PNBYTR IB4.
       @I+192+216 L1PNBYTW IB4.
       @I+192+220 L1PNDSF  IB2.
       @I+192+222 L1PNVOL  IB2.
       @I+192+224 L1PNSYS  IB2.
       @I+192+226 L1PTAGE  IB2.
       @I+192+228 L1PTTINQ IB4.
       @I+192+232 L1PTTWV  IB4.
       @I+192+236 L1PTTINP IB4.
       @I+192+240 L1PTTOT  IB4.
       @ ;
 DSREJST1=DSREJST1/1000;
 HH=DSREJST1/(60*60);
 MM=(DSREJST1/60)-(HH*60);
 SS=DSREJST1-((MM*60)+(HH*60*60));
 DSREJST=HMS(HH,MM,SS);
 OUTPUT DSR;
 RETURN;

PROC SORT DATA=WORK.OPERATNS; BY FUNCTION DATE TIME;

PROC PLOT DATA=WORK.OPERATNS;
 BY FUNCTION DATE;
 PLOT KBYTES*TIME;
 FORMAT DATE DATE. ;
 FORMAT TIME TIME. ;

PROC SUMMARY DATA=WORK.OPERATNS;
 CLASS FUNCTION DATE;
 VAR TIME;
 OUTPUT OUT=S N(TIME)=COUNT;

PROC PRINT DATA=WORK.S;
 ID FUNCTION; VAR DATE COUNT;
 FORMAT DATE DATE. ;

/*

PROC PRINT  DATA=WORK.OPERATNS; ID DATE;
 VAR TIME FUNCTION RC REAS UID VSN DSNAME;
 FORMAT DATE DATE. ;
 FORMAT TIME TIME. ;

PROC PRINT  DATA=WORK.CMDLOG; ID UID;
 VAR DATE TIME COMMAND;
 FORMAT DATE DATE. ;
 FORMAT TIME TIME. ;
 */

/*
PROC SORT DATA=WORK.MSGLOG; BY DATE;

PROC PRINT  DATA=WORK.MSGLOG; ID TIME;
 BY DATE;
 VAR TO TEXT;
 FORMAT DATE DATE. ;
 FORMAT TIME TIME. ;
 */

PROC PRINT  DATA=WORK.DSR;    ID DATE;
 FORMAT DATE DATE. ;
 FORMAT TIME TIME. ;
 FORMAT DSREJST TIME. ;
./       ADD   NAME=LOGREC
DATA A;
 INFILE SERLOG ;
 INPUT @001   TYPE     IB1.
       @ ;
       IF TYPE='0001....'B THEN CLASS='MACHINE CHECK      ';
  ELSE IF TYPE='0010....'B THEN CLASS='CHANNEL CHECK      ';
  ELSE IF TYPE='0011....'B THEN CLASS='UNIT CHECK (OBR)   ';
  ELSE IF TYPE='0100....'B THEN CLASS='SOFTWARE ERROR     ';
  ELSE IF TYPE='0101....'B THEN CLASS='IPL RECORD         ';
  ELSE IF TYPE='0110....'B THEN CLASS='DDR RECORD         ';
  ELSE IF TYPE='0111....'B THEN CLASS='MISSING INTERRUPT  ';
  ELSE IF TYPE='1000....'B THEN CLASS='SYSTEM TERMINATION ';
  ELSE IF TYPE='1001....'B THEN CLASS='NON-STANDARD MDR   ';
  ELSE IF TYPE='1010....'B THEN CLASS='MACHINE CHECK FRAME';
  ELSE IF TYPE='1011....'B THEN CLASS='CHANNEL CHECK FRAME';

PROC FREQ DATA=WORK.A;
 TABLES CLASS;

OPTIONS OBS=50000;
DATA OBR (KEEP=DATE TIME JOBID CCW DEVTYPE PCUA SENSE LEVEL)
     SFT (KEEP=DATE TIME JOBID PROGRAM ABEND LMOD CSECT)
 ;
 INFILE SERLOG MISSOVER;
 INPUT @001   TYPE     IB1.
       @ ;

  IF TYPE='0011....'B THEN LINK TYPE03;
  IF TYPE='0100....'B THEN LINK TYPE04;
  RETURN;
  TYPE03:
  IF TYPE='0011.11.'B THEN DELETE;  /* VTAM OBR RECORD. */
  INPUT @003   SWITCHES IB2.
        @ ;
  IF SWITCHES='..........0.....'B ;
  IF SWITCHES='.............1..'B THEN DELETE; /* VOLUME DEMOUNT. */
  IF SWITCHES='.........1......'B THEN LEVEL='TEMP'; ELSE LEVEL='PERM';
  INPUT @009   DATE1    PD4.
        @013   TIME     TU4.
        @025   JOBID    $8.
        @033   CCW      $PHEX8.
        @049   DEVDEPC  IB1.
        @053   DEVT1    $PHEX5.
        @057   SDRCNT   IB1.
        @058   PCUA1    $PHEX4.
        @063   SENSCNT  IB2.
        @ ;
  YY = ROUND(DATE1,1000);
  DDD = DATE1-YY;
  DATE = DATEJUL(1000*YY+DDD);
  SENSOFF=65+(DEVDEPC*8)+SDRCNT;
  INPUT @SENSOFF SENSE1  $PHEX5.
        @ ;
  PCUA=SUBSTR(PCUA1,4,3);
  DEVTYPE=SUBSTR(DEVT1,1,8);
  SENSE=SUBSTR(SENSE1,1,8);
  IF SUBSTR(SENSE,1,2)='40' & DEVTYPE='1000080E' THEN DELETE;
  IF DEVTYPE='0000080F' THEN DEVTYPE='3825  ';
  IF DEVTYPE='78048080' THEN DEVTYPE='3490  ';
  IF DEVTYPE='78008000' THEN DEVTYPE='3480  ';
  IF DEVTYPE='78008080' THEN DEVTYPE='3480  ';
  IF DEVTYPE='32108003' THEN DEVTYPE='3420  ';
  IF DEVTYPE='1000080E' THEN DEVTYPE='3800-3';
  IF DEVTYPE='10800809' THEN DEVTYPE='3800-3';
  IF DEVTYPE='1200100B' THEN DEVTYPE='3286  ';
  IF DEVTYPE='12801009' THEN DEVTYPE='3277  ';
  IF DEVTYPE='12201009' THEN DEVTYPE='3278  ';
  IF DEVTYPE='10014100' THEN DEVTYPE='CTCA  ';
  IF DEVTYPE='3010200E' THEN DEVTYPE='3380  ';
  OUTPUT OBR;
  RETURN;

  TYPE04:
  INPUT @004   HDRDS    IB1.
        @009   DATE1    PD4.
        @013   TIME     TU4.
        @025   JOBID    $8.
        @037   ABEND    $PHEX4.
        @121   PROGRAM  $8.
        @325   LMOD     $8.
        @333   CSECT    $8.
        @ ;
  IF HDRDS='1.......'B THEN DELETE;
  IF HDRDS='.1......'B THEN DELETE;
  YY = ROUND(DATE1,1000);
  DDD = DATE1-YY;
  DATE = DATEJUL(1000*YY+DDD);
  OUTPUT SFT;
  RETURN;


PROC SUMMARY DATA=WORK.OBR NWAY;
 CLASS DEVTYPE LEVEL;
 VAR TIME;
 OUTPUT OUT=S N=COUNT;
PROC PRINT; ID DEVTYPE; VAR LEVEL COUNT;


PROC PRINT DATA=WORK.OBR;
 ID DATE;
 FORMAT TIME TIME. ;

PROC PRINT DATA=WORK.SFT;
 ID DATE;
 FORMAT TIME TIME. ;
./       ADD   NAME=RMF79
OPTIONS OBS=MAX;
DATA
 ASD  (KEEP=DATE TIME JOB ESFRAMES CSFRAMES)
 SRCS (KEEP=DATE TIME AFC HIUIC ASMQ)
 SPAG (KEEP=DATE TIME MIGAGE ESRTE ESFRAMES MIGRTE PAGEINS PAGEOUTS)
 ;
  INFILE SMF MISSOVER LENGTH=LENGTH COL=COL RECFM=VBS LRECL=32756
             JFCB=SMFJFCB START=BEGINCPY;
  LENGTH                             OFFSMF 2 ;
  FORMAT
         SMFJFCB                 $HEX200.
  ;
  IF OFFSMF=. THEN DO;
     IF SUBSTR(SMFJFCB,100,1)='....1...'B  THEN OFFSMF=4;
     ELSE OFFSMF=0;
     BEGINCPY=OFFSMF+1;
     RETAIN BEGINCPY OFFSMF         ;
  END;
  IF OFFSMF=4 THEN DO;
    INPUT @5 EOFSTRNG $CHAR7. @;
    IF EOFSTRNG=:'SMF EOF'
    OR EOFSTRNG=:'SMFEOF' THEN STOP;
  END;
  INPUT @2+OFFSMF TYPE         PIB1. @;
  IF TYPE=79;

  INPUT @1+OFFSMF
       SMF79FLG    IB1.   /* HEADER FLAG BYTE                       */
       SMF79RTY    IB1.   /* RECORD TYPE                            */
       TIMESTMP    SMFSTAMP8.
       SMF79SID    $4.    /* SYSTEM ID FROM INSTALLATION            */
       SMF79SSI    $4.    /* SUBSYSTEM ID (RMF)                     */
       SMF79STY    IB2.   /* SUBTYPE                                */
       SMF79TRN    IB2.   /* NUMBER OF TRIPLETS IN THIS RECORD      */
       SMF79AAA    IB2.   /* RESERVED                               */
       SMF79PRS    IB4.   /* OFFSET TO RMF PRODUCT SECTION          */
       SMF79PRL    IB2.   /* LENGTH OF RMF PRODUCT SECTION          */
       SMF79PRN    IB2.   /* NUMBER OF RMF PRODUCT SECTIONS         */
       SMF79MCS    IB4.   /* OFFSET TO MONITOR II CONTROL SECTION   */
       SMF79MCL    IB2.   /* LENGTH OF MONITOR II CONTROL SECTION   */
       SMF79MCN    IB2.   /* NUMBER OF MONITOR II CONTROL SECTION   */
       SMF79ASS    IB4.   /* OFFSET TO DATA SECTION                 */
       SMF79ASL    IB2.   /* LENGTH OF DATA SECTION                 */
       SMF79ASN    IB2.   /* NUMBER OF DATA SECTION                 */
       SMF79DCS    IB4.   /* OFFSET TO DATA CONTROL SECTION         */
       SMF79DCL    IB2.   /* LENGTH OF DATA CONTROL SECTION         */
       SMF79DCN    IB2.   /* NUMBER OF DATA CONTROL SECTION         */
       SMF79QSS    IB4.   /* OFFSET TO I/O QUEUING GLBL.SECT.       */
       SMF79QSL    IB2.   /* LENGTH OF I/O QUEUING GLBL.SECT.       */
       SMF79QSN    IB2.   /* NUMBER OF I/O QUEUING GLBL.SECT.       */
 @ ;

 DATE=DATEPART(TIMESTMP);
 TIME=TIMEPART(TIMESTMP);
 FORMAT DATE DATE. ;
 FORMAT TIME TIME. ;

 IF SMF79STY=1 THEN DO;
  I=SMF79ASS-4;
  J=SMF79ASL;
  K=SMF79ASN;
  DO L=1 TO K;
   INPUT @1+OFFSMF+I
       R791ASID    IB2.   /* ADDRESS SPACE IDENTIFIER               */
       R791JBN     $8.    /* NAME OF JOB                            */
       R791DMN     IB2.   /* DOMAIN NUMBER                          */
       R791NPG     IB2.   /* PERFORMANCE GROUP                      */
       R791PGP     IB2.   /* PERFORMANCE GROUP PERIOD               */
       R791TTOD    IB4.   /* REAL TIME INTO TRANSACTION             */
       R791CL      $2.    /* CURRENT LOCATION                       */
       R791TAS     IB2.   /* TYPE OF USER                           */
       R791SRC     $2.    /* REASON LAST SWAP OUT                   */
       R791DP      IB2.   /* DISPATCHER PRIORITY                    */
       R791SEQN    IB2.   /* RESERVED                         @S1C  */
       R791FMCT    IB2.   /* NUMBER OF REAL STORAGE FRAMES          */
       R791WSS     IB2.   /* WORKING SET AT LAST SWAP IN            */
       R791SWC     IB2.   /* TRANSACTION SWAP COUNT                 */
       R791SWMR    IB2.   /* SRM WORKLOAD RECOM VALUE               */
       R791SCRV    IB2.   /* SRM PROCESSOR RECOM VALUE              */
       R791SIOC    IB2.   /* SRM I/O RECOM VALUE                    */
       R791WMS     IB4.   /* SRM SSERVICE FOR THE CURRENT           */
       R791TCPU    IB4.   /* CPU (TCB+SRB) FOR CURRENT JOB STEP IN  */
       R791SSRV    IB2.   /* SRM STORAGE RECOMMENDATION VALUE       */
       R791ES      IB2.   /* NUMBER OF EXT. STORAGE SLOTS     @P2A  */
       R791ESSL    IB4.   /* AVAILABLE FOR FUTURE USE         @P2A  */
       @;
       IF R791DMN=6
       THEN DO;
          JOB=R791JBN;
          CSFRAMES=R791FMCT;
          ESFRAMES=R791ES;
          OUTPUT ASD;
       END;
       I=I+J;
  END;
 END;


 IF SMF79STY=3 THEN DO;
  I=SMF79ASS-4;
  J=SMF79ASL;
  K=SMF79ASN;
  DO L=1 TO K;
   INPUT @1+OFFSMF+I
       R793AFC     IB2.   /* NUMBER OF AVAILABLE FRAMES              */
       R793CRI     IB2.   /* HIGH UIC COUNT                          */
       R793SQA     IB2.   /* NUMBER OF SQA FRAMES                    */
       R793CMNF    IB2.   /* NUMBER OF COMMON (LPA+CSA)              */
       R793CMFF    IB2.   /* NUMBER OF COMMON (LPA+CSA)              */
       R793PRFX    IB2.   /* NUMBER OF PRIVATE FIXED FRAMES          */
       R793CPUU    IB2.   /* PROCESSOR UTILIZATION (0-101)           */
       R793DQ      IB2.   /* LENGTH OF ASCB READY QUEUE              */
       R793INC     IB2.   /* NUMBER OF ADDRESS SPACES IN STORAGE     */
       R793OUTU    IB2.   /* NUMBER OF ADDRESS SPACES OUT OF         */
       R793LCU     IB2.   /* RESERVED                                */
       R793ASMQ    IB2.   /* SRM MEASURE OF ASM QUEUE LENGTH         */
       R793LPAF    IB2.   /* NUMBER OF LPA PAGEABLE FRAMES           */
       R793CSAF    IB2.   /* NUMBER OF CSA PAGEABLE FRAMES           */
       R793LPFX    IB2.   /* NUMBER OF LPA FIXED FRAMES              */
       R793CSFX    IB2.   /* NUMBER OF CSA FIXED FRAMES              */
       R793LSQA    IB2.   /* NUMBER OF LSQA FRAME                    */
       R793NLQF    IB2.   /* NUMBER OF PRIVATE NON LSQA FIX FRAMES   */
       R793LOUT    IB2.   /* NUMBER OF ADDRESS SPACES LOGICALLY      */
       @;
       AFC=R793AFC;
       HIUIC=R793CRI;
       ASMQ=R793ASMQ;
       OUTPUT SRCS;
       I=I+J;
  END;
 END;

 IF SMF79STY=4 THEN DO;
  I=SMF79ASS-4;
  J=SMF79ASL;
  K=SMF79ASN;
  DO L=1 TO K;
   INPUT @1+OFFSMF+I
       R794CMNI    IB4.   /* SYSTEM COMMON (LPA+CSA) PAGES IN        */
       R794CMNO    IB4.   /* SYSTEM COMMON (CSA) PAGES OUT           */
       R794CMNR    IB4.   /* SYSTEM COMMON (LPA+CSA) PAGES           */
       R794SWPO    IB4.   /* NUMBER OF SWAPS (OUT)            @P1C   */
       R794PSPI    IB4.   /* NUMBER OF PAGES SWAPPED IN              */
       R794PSPO    IB4.   /* NUMBER OF PAGES SWAPPED OUT             */
       R794PRVI    IB4.   /* NUMBER OF PRIVATE PAGES                 */
       R794PRVO    IB4.   /* NUMBER OF PRIVATE PAGES                 */
       R794PRVR    IB4.   /* NUMBER OF PRIVATE PAGES                 */
       R794VIO     IB4.   /* NUMBER OF VIO PAGES (IN+OUT)            */
       R794AFC     IB2.   /* NUMBER AVAILABLE FRAMES                 */
       R794CRI     IB2.   /* HIGH UIC COUNT                          */
       R794ACRI    IB2.   /* AVERAGE OF HIGH UIC COUNT               */
       R794RV1     IB2.   /* RESERVED                                */
       R794LPAI    IB4.   /* SYSTEM LPA PAGES IN          @G537NLS   */
       R794CSAI    IB4.   /* SYSTEM CSA PAGES OUT         @G537NLS   */
       R794LPAR    IB4.   /* SYSTEM LPA PAGES RECLAIMED   @G537NLS   */
       R794CSAR    IB4.   /* SYSTEM CSA PAGES RECLAIMED   @G537NLS   */
       R794TWSS    IB2.   /* TARGET WORKING SETSIZE FOR THE COMMON   */
       R794MAGE    IB2.   /* MIGRATION AGE                           */
       R794ERTE    IB4.   /* NO. PAGES TO EXT. STORAGE               */
       R794EVAL    IB4.   /* NO. OF EXTENDED STORAGE SLOTS           */
       R794ESSL    IB4.   /* AVAILABLE FOR FUTURE USE                */
       R794MRTE    IB4.   /* NO. OF PAGES MIGRATED FROM              */
       MIGAGE      IB4.   /* !!!!! */
       @;
 /*    MIGAGE=R794MAGE; */
       PAGEINS=(R794PRVI-LAG1(R794PRVI))/(TIME-LAG1(TIME));
       PAGEOUTS=(R794PRVO-LAG1(R794PRVO))/(TIME-LAG1(TIME));
       ESRTE=(R794ERTE-LAG1(R794ERTE))/(TIME-LAG1(TIME));
       ESFRAMES=R794EVAL;
       MIGRTE=(R794MRTE-LAG1(R794MRTE))/(TIME-LAG1(TIME));
       OUTPUT SPAG;
       I=I+J;
  END;
 END;

PROC SORT DATA=WORK.ASD; BY JOB DATE TIME;
PROC PLOT DATA=WORK.ASD;
 PLOT CSFRAMES*TIME='C' ESFRAMES*TIME='E'  / OVERLAY;
 BY JOB DATE;

PROC PLOT DATA=WORK.SPAG;
 PLOT
       MIGAGE*TIME
       ESRTE*TIME
       ESFRAMES*TIME
       MIGRTE*TIME
       PAGEINS*TIME
       PAGEOUTS*TIME
       ;


PROC PRINT DATA=WORK.SRCS; ID DATE;
PROC PRINT DATA=WORK.SPAG; ID DATE;
./       ADD   NAME=SASDCOL
//LANEJ     JOB LANEJ,SASDCOL,NOTIFY=LANEJ,REGION=6M,
//*        USER=IBMUSER,
//         MSGLEVEL=(1,1),MSGCLASS=X,CLASS=Z
//*JOBLIB DD DSN=TECTSG.ISPFJCL.LOAD,DISP=SHR
//*PORTRAIT OUTPUT PAGEDEF=A16D,FORMDEF=A16D DEFAULT=YES
//TWOUP    OUTPUT PAGEDEF=A26D,FORMDEF=A26D,DEFAULT=YES,JESDS=ALL
//*FOURUP   OUTPUT PAGEDEF=U46D,FORMDEF=U46D DEFAULT=YES
//*-------------------------------------------------------------*
//*   THIS JCL IS IN:        LANEJ.TECTSG.CNTL(SASDCOL)
//*-------------------------------------------------------------*
//S1 EXEC SAS607,TIME=1439,
//  OPTIONS='ERRORABEND NOSOURCE NOSOURCE2 NOMACROGEN',
//  CONFIG='TECTSG.MXG.V99.SOURCE(CONFIG07)'
//WORK     DD UNIT=WORK,SPACE=(CYL,(500,50)),DCB=RECFM=FS
//SASLOG   DD SYSOUT=*
//SASLIST  DD SYSOUT=*
//SORTWK01 DD SPACE=(CYL,(25)),UNIT=WORK
//SORTWK02 DD SPACE=(CYL,(25)),UNIT=WORK
//SORTWK03 DD SPACE=(CYL,(25)),UNIT=WORK
//LIBRARY  DD DSN=TECTSG.MXG.V99.FORMATS,DISP=SHR
//DCOLLECT DD DSN=TECTSG.DCOLLECT.DASDCAP,DISP=SHR
//         DD DSN=TECTSG.DCOLLECT.VOLUMES,DISP=SHR
//SOURCLIB DD DSN=TECTSG.MXG.USER.SOURCE,DISP=SHR
//         DD DSN=TECTSG.MXG.V99.SOURCE,DISP=SHR
//SYSIN DD *
%INCLUDE SOURCLIB(IMACDCOL,VMACDCOL,IMACKEEP);
DATA
_VARDCOL
_CDEDCOL

DATA DCOLVOLS;
 SET DCOLVOLS;
 IF DCVVOLSR=:'PROD' | DCVVOLSR=:'DEVL';

DATA DCOLCAPD;
 SET DCOLCAPD;
 IF UCVOLSR=:'PROD' | UCVOLSR=:'DEVL';

PROC SORT DATA=WORK.DCOLVOLS; BY DCVVOLSR DCUTMSTP;
PROC SORT DATA=WORK.DCOLCAPD; BY UCVOLSR DCUTMSTP;
PROC SORT DATA=WORK.DCOLCAPT; BY         DCUTMSTP;

PROC PLOT DATA=WORK.DCOLVOLS;
 PLOT (
         DCVALLOC DCVFDSCB          DCVFRAG1 DCVFRESP DCVFREXT
         DCVFVIRS                            DCVLGEXT DCVPERCT
          ) * DCUTMSTP;
 BY DCVVOLSR;
PROC PLOT DATA=WORK.DCOLCAPD;
 PLOT (
         UCAFOCC  UCBFOCC UCNOMIG
          ) * DCUTMSTP;
        BY UCVOLSR;
PROC PLOT DATA=WORK.DCOLCAPT;
 PLOT (
         UCEMPTY UTFULL UTPART
          ) * DCUTMSTP;
./       ADD   NAME=SASTSOMN
OPTIONS OBS=MAX;

MACRO    TOD  HH = FLOOR (TIM1 /360000);
              MM = FLOOR ((TIM1 -360000*HH)/6000);
              SS = FLOOR ((TIM1 -360000*HH-6000*MM)/100);

              TIM=HMS(HH,MM,SS);
              FORMAT TIM TIME. ;
              %

 DATA CMDS
  (KEEP = USER TXN NRTR TYPE)
      USRINTVL
  (KEEP = WEEKDAYS DATE USER TIM
          CPU THINK TRIVRESP TOTSHORT RESPONSE TRANS )
      CMDRECS
  (KEEP = WEEKDAYS DATE USER TIM TXN
          TGETS TPUTS CPU        EXCP SWAPOUT SERVUNIT)
   ;
   INFILE SMFDD MISSOVER JFCB=JFCBMANX;
   IF _N_ = 1 THEN DO;
            IF SUBSTR(JFCBMANX,100,1) = '....1...'B
               THEN SMFCOL1 = 6 ;
            ELSE SMFCOL1 = 2;
            RETAIN SMFCOL1;
            DROP SMFCOL1;
            END;
          INPUT @SMFCOL1 RECNO PIB1.
                 EOFMARK $8. @;
          IF EOFMARK = 'FEOFMARK' THEN STOP;
   INPUT
         @SMFCOL1+5    SMFDATE PD4.@ ;
   IF RECNO = 198 OR RECNO = 197;
   DATE = DATEJUL(SMFDATE);
   FORMAT DATE DATE.;
   WEEKDAYS = PUT(DATE,WEEKDATE3.) ;
   IF RECNO = 198 THEN GOTO REC198;
   INPUT @SMFCOL1+09 SYSID  $4.
         @SMFCOL1+13 OFFSET  PIB2.
         @SMFCOL1+19 INTLEN   PIB4. @;
   INPUT @SMFCOL1+39 TIM1 PIB4.
         @SMFCOL1+87 MAX_USER  PIB2. @;
   TOD
   INTLEN  = INTLEN  / 38400;
 MULTSEG:
*  REPEAT FOLLOWING CODE FOR INDIVIDUAL USER SEGMENTS;
   IF OFFSET = 0 THEN RETURN;
   N = SMFCOL1 + OFFSET - 1;
   INPUT @N  USER $7.
         @N+24 TRIVTM IB4.
         @N+28 TOTSHORT PIB2.
         @N+40 NTRIVTM PIB4.
         @N+44 TOTMED  PIB2.
         @N+46 UCBE    PIB2.
         @N+56 LONGTM  PIB4.
         @N+60 TOTLONG PIB2.
         @N+70 OFFSET  PIB2.
         @N+72 TCB     PIB4.
         @N+76 SRB     PIB4.
         @N+88 THINKTM PIB4.
         @N+134 THINKS PIB2.
         @N+138 NRCMDS PIB1. @;
   TRANS = 0;
   IF TXNS     = . THEN TXNS  = 0;
   TCB = TCB / 38400;
   SRB = SRB / 38400;
   CPU = TCB + SRB;
   FORMAT CPU 6.2 ;
   THINKTM = THINKTM / 38400;
   IF THINKS LE 0 THEN THINK = 0;
   ELSE THINK = THINKTM / THINKS;
   FORMAT THINK 7.2 ;
   TRIVTM = TRIVTM / 38400;
   NTRIVTM = NTRIVTM / 38400;
   LONGTM = LONGTM / 38400;
   RESPONSE = TRIVTM + NTRIVTM + LONGTM;
   TRANS = TOTSHORT + TOTMED + TOTLONG;
   IF RESPONSE <= 0  OR TRANS <= 0 THEN GOTO MULTSEG;
   RESPONSE = RESPONSE/ TRANS;
   FORMAT RESPONSE 6.2 ;
   IF TOTSHORT LE 0 THEN TRIVRESP=0;
   ELSE TRIVRESP = TRIVTM / TOTSHORT;
   FORMAT TRIVRESP 4.2 ;
   OUTPUT USRINTVL;
LOOPCMD:
    TXN = '        ';
    IF NRCMDS <= 0 THEN GOTO RESTMON;
       INPUT    CMD  $2.
                NRTR PIB1. @;
   TYPE='TSMCMDXX  ';
   LINK DECODE;
IF TXN¬=USER THEN OUTPUT CMDS;
       CMD = '  ';
       NRCMDS = NRCMDS - 1;
       GOTO LOOPCMD;
RESTMON:
   INPUT @N+UCBE TSMFEXIT PIB2.
         @N+UCBE+14 NOCMDS PIB1.@;
CYCLE:
   INPUT @N+TSMFEXIT     TXN  $8.
         @N+TSMFEXIT+8   NRTR PIB1.
         @N+TSMFEXIT+9   FLAG $1.@;
   IF FLAG='.1......'B THEN TYPE='CLIST     ';
   IF FLAG='S'         THEN TYPE='ISPF PANEL';
   IF FLAG='T'         THEN TYPE='TSO CP    ';
   IF FLAG='U'         THEN TYPE='DIALOG PGM';
   IF FLAG='V'         THEN TYPE='ISPF SERV ';
   NOCMDS = NOCMDS - 1;
   IF TXN¬=USER THEN OUTPUT CMDS;
   IF NOCMDS LE 0 THEN GOTO MULTSEG;
   TSMFEXIT = TSMFEXIT + 10;
   GOTO CYCLE;
REC198:
   INPUT
         @SMFCOL1+15  USER   $8.
         @SMFCOL1+31 TIM1 PIB4.
         @SMFCOL1+43 TXN $8.
         @SMFCOL1+51 TGETS PIB2.
         @SMFCOL1+53 TPUTS PIB2.
         @SMFCOL1+63 INCPUT PIB4.
         @SMFCOL1+67 SRB PIB4.
         @SMFCOL1+71 EXCP PIB4.
         @SMFCOL1+121 SWAPOUT PIB2.
         @SMFCOL1+131 CMD     $2.
         @SMFCOL1+147 SERVUNIT PIB4.
         @SMFCOL1+171 OFFDSN   PIB2.
         @SMFCOL1+174 FLAG1    PIB1.
         @
         ;
   TOD
   IF OFFDSN GT 0
    & FLAG1='0.......'B  THEN DO;
      INPUT @OFFDSN  DSNL   PIB1. @ ;
      IF DSNL LE 8 THEN DO;
         INPUT @OFFDSN TXN1 $VARYING44. DSNL @ ;
         TXN=PUT(TXN1,$8.);
      END;
   END;
   IF SUBSTR(TXN,1,1) LT 'A' THEN LINK DECODE;
   TSOCPU = (INCPUT / 384)/100;
   TSOSRB = (SRB  / 384)/100;
   CPU      = TSOCPU+TSOSRB;
   TRANS = 1;
   OUTPUT CMDRECS;
   RETURN;

DECODE:
IF CMD = 'A1' THEN TXN =         'ACCOUNT ';
IF CMD = 'A2' THEN TXN =         'ALLOCATE';
IF CMD = '6E' THEN TXN =         'APL     ';
IF CMD = 'A4' THEN TXN =         'ASM     ';
IF CMD = 'A5' THEN TXN =         'ATTRIB  ';
IF CMD = 'CA' THEN TXN =         'CALL    ';
IF CMD = 'C3' THEN TXN =         'CALC    ';
IF CMD = 'C1' THEN TXN =         'CONVERT ';
IF CMD = 'C2' THEN TXN =         'COPY    ';
IF CMD = 'C4' THEN TXN =         'COBOL   ';
IF CMD = 'D1' THEN TXN =         'DELETE  ';
IF CMD = 'E2' THEN TXN =         'EDIT    ';
IF CMD = 'E$' THEN TXN =         'END     ';
IF CMD = 'E5' THEN TXN =         'EXEC    ';
IF CMD = 'F1' THEN TXN =         'FORMAT  ';
IF CMD = 'F2' THEN TXN =         'FREE    ';
IF CMD = 'F3' THEN TXN =         'FREEALL ';
IF CMD = 'F4' THEN TXN =         'FORT    ';
IF CMD = 'G1' THEN TXN =         'GOFORT  ';
IF CMD = 'H1' THEN TXN =         'HELP    ';
IF CMD = 'I1' THEN TXN =         'IND$FILE';
IF CMD = 'L1' THEN TXN =         'LINK    ';
IF CMD = 'L2' THEN TXN =         'LIST    ';
IF CMD = 'L3' THEN TXN =         'LISTALC ';
IF CMD = 'L5' THEN TXN =         'LISTBC  ';
IF CMD = 'L8' THEN TXN =         'LISTDS  ';
IF CMD = 'Y1' THEN TXN =         'LOGOFF  ';
IF CMD = 'LN' THEN TXN =         'LOGON   ';
IF CMD = 'Y2' THEN TXN =         'LOADGO  ';
IF CMD = 'M1' THEN TXN =         'MERGE   ';
IF CMD = 'O1' THEN TXN =         'OPERATOR';
IF CMD = 'P2' THEN TXN =         'PLI     ';
IF CMD = 'P3' THEN TXN =         'PLIC    ';
IF CMD = 'P4' THEN TXN =         'PROFILE ';
IF CMD = 'P5' THEN TXN =         'PROTECT ';
IF CMD = 'R3' THEN TXN =         'RENAME  ';
IF CMD = 'R4' THEN TXN =         'RUN     ';
IF CMD = 'S2' THEN TXN =         'SEND    ';
IF CMD = '$$' THEN TXN =         'SPF     ';
IF CMD = 'T1' THEN TXN =         'TERMINAL';
IF CMD = 'T2' THEN TXN =         'TEST    ';
IF CMD = 'T3' THEN TXN =         'TESTCOB ';
IF CMD = 'T4' THEN TXN =         'TESTFORT';
IF CMD = 'T5' THEN TXN =         'TIM1E    ';
IF CMD = 'A0' THEN TXN =         'TRANSMIT';
IF CMD = 'C0' THEN TXN =         'TSOEXEC ';
IF CMD = 'B0' THEN TXN =         'RECEIVE ';
IF CMD = 'T6' THEN TXN =         'TSOSORT ';
IF CMD = '6G' THEN TXN =         '@       ';
IF CMD = 'W5' THEN TXN =         'ALTER   ';
IF CMD = 'B2' THEN TXN =         'BLDINDEX';
IF CMD = '87' THEN TXN =         'CHKLIST ';
IF CMD = 'C5' THEN TXN =         'CNVTCAT ';
IF CMD = 'D2' THEN TXN =         'DEFINE  ';
IF CMD = 'E7' THEN TXN =         'EXPORT  ';
IF CMD = 'E8' THEN TXN =         'EXPORTRA';
IF CMD = 'I2' THEN TXN =         'IMPORT  ';
IF CMD = '88' THEN TXN =         'IMPORTRA';
IF CMD = 'Y4' THEN TXN =         'LISTCAT ';
IF CMD = 'Y5' THEN TXN =         'LISTCRA ';
IF CMD = 'P8' THEN TXN =         'PRINT   ';
IF CMD = 'R5' THEN TXN =         'REPRO   ';
IF CMD = 'R6' THEN TXN =         'RESETCAT';
IF CMD = 'V1' THEN TXN =         'VERIFY  ';
IF CMD = 'C6' THEN TXN =         'CANCEL  ';
IF CMD = 'O2' THEN TXN =         'OUTPUT  ';
IF CMD = 'S5' THEN TXN =         'STATUS  ';
IF CMD = 'S6' THEN TXN =         'SUBMIT  ';
IF CMD = 'W1' THEN TXN =         'WHEN    ';
IF CMD = '70' THEN TXN =         'RMFMON  ';
IF CMD = '71' THEN TXN =         'HALTERDS';
IF CMD = '72' THEN TXN =         'HBACKDS ';
IF CMD = '73' THEN TXN =         'HBDELETE';
IF CMD = '74' THEN TXN =         'HDELETE ';
IF CMD = '75' THEN TXN =         'HLIST   ';
IF CMD = '76' THEN TXN =         'HMIGRATE';
IF CMD = '77' THEN TXN =         'HQUERY  ';
IF CMD = '78' THEN TXN =         'HRECALL ';
IF CMD = '79' THEN TXN =         'HRECOVER';
IF CMD = '7A' THEN TXN =         'HSENDCMD';
IF CMD = '7B' THEN TXN =         'IPCS    ';
IF CMD = '7C' THEN TXN =         'IPCSDDIR';
IF CMD = '7D' THEN TXN =         'SYSDSCAN';
IF CMD = '7E' THEN TXN =         'ADDGROUP';
IF CMD = '7F' THEN TXN =         'ADDSD   ';
IF CMD = '7G' THEN TXN =         'ADDUSER ';
IF CMD = '7H' THEN TXN =         'ALTDSD  ';
IF CMD = '7I' THEN TXN =         'ALTGROUP';
IF CMD = '7J' THEN TXN =         'ALTUSER ';
IF CMD = '7K' THEN TXN =         'CONNECT ';
IF CMD = '7L' THEN TXN =         'DELDSD  ';
IF CMD = '7M' THEN TXN =         'DELGROUP';
IF CMD = '7N' THEN TXN =         'DELUSER ';
IF CMD = '7O' THEN TXN =         'LISTDSD ';
IF CMD = '7P' THEN TXN =         'LISTGRP ';
IF CMD = '7Q' THEN TXN =         'LISTUSER';
IF CMD = '7R' THEN TXN =         'PASSWORD';
IF CMD = '7S' THEN TXN =         'PERMIT  ';
IF CMD = '7T' THEN TXN =         'RALTER  ';
IF CMD = '7U' THEN TXN =         'RDEFINE ';
IF CMD = '7V' THEN TXN =         'RDELETE ';
IF CMD = '7W' THEN TXN =         'REMOVE  ';
IF CMD = '7X' THEN TXN =         'RLIST   ';
IF CMD = '7Y' THEN TXN =         'RVARY   ';
IF CMD = '7Z' THEN TXN =         'SEARCH  ';
IF CMD = '80' THEN TXN =         'SETROPTS';
IF CMD = '81' THEN TXN =         'SMCOPY  ';
IF CMD = '82' THEN TXN =         'SMFIND  ';
IF CMD = '83' THEN TXN =         'SMPUT   ';
IF CMD = '$3' THEN TXN =         'BOTTOM  ';
IF CMD = '$4' THEN TXN =         'CHANGE  ';
IF CMD = '$6' THEN TXN =         'COPY    ';
IF CMD = '$7' THEN TXN =         'DELETE  ';
IF CMD = '$8' THEN TXN =         'DOWN    ';
IF CMD = '$2' THEN TXN =         'EDITDATA';
IF CMD = '$9' THEN TXN =         'END     ';
IF CMD = '$B' THEN TXN =         'FIND    ';
IF CMD = '$P' THEN TXN =         'FORMAT  ';
IF CMD = '84' THEN TXN =         'FSE     ';
IF CMD = '85' THEN TXN =         'FULSEDIT';
IF CMD = '2A' THEN TXN =         'PF      ';
IF CMD = '2B' THEN TXN =         'PB      ';
IF CMD = '2C' THEN TXN =         'HF      ';
IF CMD = '2D' THEN TXN =         'HB      ';
IF CMD = '2E' THEN TXN =         'LS      ';
IF CMD = '2F' THEN TXN =         'SS      ';
IF CMD = '$H' THEN TXN =         'HELP    ';
IF CMD = '$E' THEN TXN =         'INPUT   ';
IF CMD = '$F' THEN TXN =         'INSERT  ';
IF CMD = '$2' THEN TXN =         '*       ';
IF CMD = '$A' THEN TXN =         'LIST    ';
IF CMD = '$1' THEN TXN =         'MERGE   ';
IF CMD = '$M' THEN TXN =         'MOVE    ';
IF CMD = '$O' THEN TXN =         'RENUM   ';
IF CMD = '$Q' THEN TXN =         'RUN     ';
IF CMD = '$R' THEN TXN =         'SAVE    ';
IF CMD = '$S' THEN TXN =         'SCAN    ';
IF CMD = '$V' THEN TXN =         'TABSET  ';
IF CMD = '$X' THEN TXN =         'TOP     ';
IF CMD = '$Y' THEN TXN =         'UNNUM   ';
IF CMD = '$Z' THEN TXN =         'UP      ';
IF CMD = '$#' THEN TXN =         'VERIFY  ';
IF CMD = 'A2' THEN TXN =         'ALLOCATE';
IF CMD = 'A5' THEN TXN =         'ATTRIB  ';
IF CMD = '86' THEN TXN =         'CKPOINT ';
IF CMD = 'E5' THEN TXN =         'EXEC    ';
IF CMD = 'F2' THEN TXN =         'FREE    ';
IF CMD = 'P4' THEN TXN =         'PROFILE ';
IF CMD = 'S2' THEN TXN =         'SEND    ';
IF CMD = 'S6' THEN TXN =         'SUBMIT  ';
IF CMD = '#1' THEN TXN =         'ASSIGN  ';
IF CMD = 'A2' THEN TXN =         'ALLOCATE';
IF CMD = '#2' THEN TXN =         'AT      ';
IF CMD = '#O' THEN TXN =         'AND     ';
IF CMD = 'A5' THEN TXN =         'ATTRIB  ';
IF CMD = '#3' THEN TXN =         'CALL    ';
IF CMD = '#4' THEN TXN =         'COPY    ';
IF CMD = '#5' THEN TXN =         'DELETE  ';
IF CMD = '#6' THEN TXN =         'DROP    ';
IF CMD = '#7' THEN TXN =         'END     ';
IF CMD = '#8' THEN TXN =         'EQUATE  ';
IF CMD = 'E5' THEN TXN =         'EXEC    ';
IF CMD = 'F2' THEN TXN =         'FREE    ';
IF CMD = '#9' THEN TXN =         'FREEMAIN';
IF CMD = '#A' THEN TXN =         'GETMAIN ';
IF CMD = '#B' THEN TXN =         'GO      ';
IF CMD = '#C' THEN TXN =         'HELP    ';
IF CMD = 'L1' THEN TXN =         'LINK    ';
IF CMD = '#D' THEN TXN =         'LIST    ';
IF CMD = 'L3' THEN TXN =         'LISTALC ';
IF CMD = 'L5' THEN TXN =         'LISTBC  ';
IF CMD = 'Y4' THEN TXN =         'LISTCAT ';
IF CMD = '#E' THEN TXN =         'LISTDCB ';
IF CMD = '#F' THEN TXN =         'LISTDEB ';
IF CMD = 'L8' THEN TXN =         'LISTDS  ';
IF CMD = '#G' THEN TXN =         'LISTMAP ';
IF CMD = '#H' THEN TXN =         'LISTPSW ';
IF CMD = '#I' THEN TXN =         'LISTTCB ';
IF CMD = '#J' THEN TXN =         'LOAD    ';
IF CMD = '#K' THEN TXN =         'OFF     ';
IF CMD = '#P' THEN TXN =         'OR      ';
IF CMD = 'P4' THEN TXN =         'PROFILE ';
IF CMD = 'P5' THEN TXN =         'PROTECT ';
IF CMD = 'R3' THEN TXN =         'RENAME  ';
IF CMD = '#M' THEN TXN =         'RUN     ';
IF CMD = '#L' THEN TXN =         'QUALIFY ';
IF CMD = 'S2' THEN TXN =         'SEND    ';
IF CMD = 'T1' THEN TXN =         'TERMINAL';
IF CMD = '#N' THEN TXN =         'WHERE   ';
IF CMD = 'C6' THEN TXN =         'CANCEL  ';
IF CMD = 'S5' THEN TXN =         'STATUS  ';
IF CMD = 'S6' THEN TXN =         'SUBMIT  ';
IF CMD = '@0' THEN TXN =         'SPFTERM ';
IF CMD = '@1' THEN TXN =         'SPFLOGL ';
IF CMD = '4V' THEN TXN =         'SPFLIST ';
IF CMD = '4W' THEN TXN =         'SPFDSPLY';
IF CMD = '@2' THEN TXN =         'SPFEDIT ';
IF CMD = '@3' THEN TXN =         'BROWSE  ';
IF CMD = '@4' THEN TXN =         'LIBUTIL ';
IF CMD = '@5' THEN TXN =         'LIBUTILC';
IF CMD = '@6' THEN TXN =         'LIBUTILX';
IF CMD = '@7' THEN TXN =         'LIBUTILL';
IF CMD = '@8' THEN TXN =         'LIBUTILP';
IF CMD = '@9' THEN TXN =         'LIBUTILR';
IF CMD = '@A' THEN TXN =         'LIBUTILD';
IF CMD = '@B' THEN TXN =         'DSALLOC ';
IF CMD = '@C' THEN TXN =         'DSRENAME';
IF CMD = '@D' THEN TXN =         'DSDELETE';
IF CMD = '@E' THEN TXN =         'DSINFO  ';
IF CMD = '@F' THEN TXN =         'UTILMC  ';
IF CMD = '@G' THEN TXN =         'UTILCAT ';
IF CMD = '38' THEN TXN =         'UTILRESR';
IF CMD = '40' THEN TXN =         'UTILRESN';
IF CMD = '41' THEN TXN =         'UTILRESD';
IF CMD = '3L' THEN TXN =         'UTILRES ';
IF CMD = '36' THEN TXN =         'UTLHCPYJ';
IF CMD = '37' THEN TXN =         'UTLHCPYL';
IF CMD = '3M' THEN TXN =         'UTLHCPY ';
IF CMD = '3N' THEN TXN =         'CMDTABLE';
IF CMD = '4X' THEN TXN =         'UTILFMT ';
IF CMD = '3Q' THEN TXN =         'DMTSTFUN';
IF CMD = '3R' THEN TXN =         'DMTSTPAN';
IF CMD = '3S' THEN TXN =         'DMTSTVAR';
IF CMD = '3T' THEN TXN =         'DMTSTTBL';
IF CMD = '3U' THEN TXN =         'DMTSTLOG';
IF CMD = '3V' THEN TXN =         'DMTSTSRV';
IF CMD = '3W' THEN TXN =         'DMTSTTRC';
IF CMD = '3X' THEN TXN =         'DMTSTBRK';
IF CMD = '@J' THEN TXN =         'FORASM  ';
IF CMD = '@K' THEN TXN =         'FORCOB  ';
IF CMD = '@L' THEN TXN =         'FORFORG1';
IF CMD = '@M' THEN TXN =         'FORPLIC ';
IF CMD = '@N' THEN TXN =         'FORPLIOP';
IF CMD = '@O' THEN TXN =         'FORLINK ';
IF CMD = '@P' THEN TXN =         'FORCOBID';
IF CMD = '@Q' THEN TXN =         'FORFORID';
IF CMD = '44' THEN TXN =         'FORPASCL';
IF CMD = '4J' THEN TXN =         'FORMEM  ';
IF CMD = '@R' THEN TXN =         'BCKASM  ';
IF CMD = '@S' THEN TXN =         'BCKCOB  ';
IF CMD = '@T' THEN TXN =         'BCKFORG1';
IF CMD = '@U' THEN TXN =         'BCKPLIC ';
IF CMD = '@V' THEN TXN =         'BCKPLIOP';
IF CMD = '@W' THEN TXN =         'BCKLINK ';
IF CMD = '45' THEN TXN =         'BCKPASCL';
IF CMD = '4K' THEN TXN =         'BCKMEM  ';
IF CMD = '@X' THEN TXN =         'SPFVTOC ';
IF CMD = '@Y' THEN TXN =         'TUTORIAL';
IF CMD = '4L' THEN TXN =         'LMFCNTL ';
IF CMD = '4M' THEN TXN =         'LMFSET  ';
IF CMD = '4N' THEN TXN =         'LMFDIST ';
IF CMD = '4O' THEN TXN =         'LMFACTV ';
IF CMD = '4U' THEN TXN =         'LMFREVW ';
IF CMD = '@Z' THEN TXN =         'SPFERR01';
IF CMD = '@@' THEN TXN =         'SPFERR02';
IF CMD = '@#' THEN TXN =         'SPFERR03';
IF CMD = '34' THEN TXN =         'SPFERR04';
IF CMD = '35' THEN TXN =         'SPFERR05';
IF CMD = '42' THEN TXN =         'SPFERR06';
IF CMD = '43' THEN TXN =         'SPFERR07';
IF CMD = '48' THEN TXN =         'SPFERR08';
IF CMD = '@?' THEN TXN =         'DATUTILC';
IF CMD = '@-' THEN TXN =         'DATUTILU';
IF CMD = '3K' THEN TXN =         'DATUTIL ';
IF CMD = '46' THEN TXN =         'CONVMNU ';
IF CMD = '47' THEN TXN =         'CONVMSG ';
IF CMD = '3O' THEN TXN =         'CNVTMNMG';
IF CMD = '@+' THEN TXN =         'TESTMENU';
IF CMD = '@=' THEN TXN =         'SPFPK1  ';
IF CMD = '@!' THEN TXN =         'SPFPK2  ';
IF CMD = '@¬' THEN TXN =         'SPFPK3  ';
IF CMD = '3A' THEN TXN =         'SPFPFK  ';
IF CMD = '@:' THEN TXN =         'UTILBRWS';
IF CMD = '30' THEN TXN =         'UTILOUT ';
IF CMD = '31' THEN TXN =         'UTILOUTD';
IF CMD = '32' THEN TXN =         'UTILOUTP';
IF CMD = '33' THEN TXN =         'UTILOUTR';
IF CMD = '@;' THEN TXN =         'UTILOUTL';
IF CMD = '20' THEN TXN =         'SCRIPTD ';
IF CMD = '21' THEN TXN =         'SCRIPTF ';
IF CMD = '3P' THEN TXN =         'SCRIPT  ';
IF CMD = '49' THEN TXN =         'PANBRWSE';
IF CMD = '4A' THEN TXN =         'PANEDIT ';
IF CMD = '4B' THEN TXN =         'PANCHNGE';
IF CMD = '4C' THEN TXN =         'PANMANIP';
IF CMD = '4D' THEN TXN =         '$DMPROGM';
IF CMD = '4E' THEN TXN =         '$DMPANEL';
IF CMD = '01' THEN TXN =         'AFTER   ';
IF CMD = '02' THEN TXN =         'BEFORE  ';
IF CMD = '03' THEN TXN =         'BOUNDS  ';
IF CMD = '04' THEN TXN =         'COLS    ';
IF CMD = '05' THEN TXN =         'COPY    ';
IF CMD = '06' THEN TXN =         'DELETE  ';
IF CMD = '07' THEN TXN =         'INSERT  ';
IF CMD = '08' THEN TXN =         'MASK    ';
IF CMD = '09' THEN TXN =         'MOVE    ';
IF CMD = '11' THEN TXN =         'OVERLAY ';
IF CMD = '0A' THEN TXN =         'REPEAT  ';
IF CMD = '0B' THEN TXN =         'DATASHFT';
IF CMD = '0C' THEN TXN =         'DATASHFT';
IF CMD = '0D' THEN TXN =         'TABS    ';
IF CMD = '0E' THEN TXN =         'SHOW    ';
IF CMD = '0F' THEN TXN =         'EXCLUDE ';
IF CMD = '0G' THEN TXN =         'FIRST   ';
IF CMD = '0H' THEN TXN =         'LAST    ';
IF CMD = '0I' THEN TXN =         'COLSHIFT';
IF CMD = '0J' THEN TXN =         'COLSHIFT';
IF CMD = '0K' THEN TXN =         'TXTENTRY';
IF CMD = '0L' THEN TXN =         'TXTFLOW ';
IF CMD = '0M' THEN TXN =         'TXTSPLIT';
IF CMD = '0N' THEN TXN =         'MOVE$   ';
IF CMD = '3B' THEN TXN =         'EDITERR ';
IF CMD = '3C' THEN TXN =         'MOVCOP$ ';
IF CMD = '3D' THEN TXN =         'EDITOPTS';
IF CMD = '3E' THEN TXN =         'MODEL   ';
IF CMD = '3F' THEN TXN =         'SORT    ';
IF CMD = '3G' THEN TXN =         'CREATREP';
IF CMD = '3H' THEN TXN =         'DELETE$ ';
IF CMD = '3I' THEN TXN =         'LC      ';
IF CMD = '3J' THEN TXN =         'UC      ';
IF CMD = '3Y' THEN TXN =         'MICSSAF ';
IF CMD = '0O' THEN TXN =         'CANCEL  ';
IF CMD = '0P' THEN TXN =         'CHANGE  ';
IF CMD = '0Q' THEN TXN =         'FIND    ';
IF CMD = '@H' THEN TXN =         'RCHANGE ';
IF CMD = '@I' THEN TXN =         'RFIND   ';
IF CMD = '0R' THEN TXN =         'LOCATE  ';
IF CMD = '0S' THEN TXN =         'PROFILE ';
IF CMD = '4Q' THEN TXN =         'AUTOLIST';
IF CMD = '4R' THEN TXN =         'AUTONUM ';
IF CMD = '4S' THEN TXN =         'AUTOSAVE';
IF CMD = '4T' THEN TXN =         'PACK    ';
IF CMD = '4F' THEN TXN =         'VERSION ';
IF CMD = '4G' THEN TXN =         'LEVEL   ';
IF CMD = '4H' THEN TXN =         'EDRECUR ';
IF CMD = '4P' THEN TXN =         'DEFINE  ';
IF CMD = '4I' THEN TXN =         'NOTES   ';
IF CMD = '0T' THEN TXN =         'RESET   ';
IF CMD = '0U' THEN TXN =         'SAVE    ';
IF CMD = '0V' THEN TXN =         'SUBMIT  ';
IF CMD = '0W' THEN TXN =         'ASIS    ';
IF CMD = '0Y' THEN TXN =         'CAPS    ';
IF CMD = '0Z' THEN TXN =         'COPY$   ';
IF CMD = '10' THEN TXN =         'CREATE  ';
IF CMD = '12' THEN TXN =         'HEX     ';
IF CMD = '13' THEN TXN =         'NONULLS ';
IF CMD = '14' THEN TXN =         'NONUMBER';
IF CMD = '15' THEN TXN =         'NOTABS  ';
IF CMD = '16' THEN TXN =         'NULLS   ';
IF CMD = '17' THEN TXN =         'NUMBER  ';
IF CMD = '18' THEN TXN =         'PRINT   ';
IF CMD = '19' THEN TXN =         'RECOVERY';
IF CMD = '1A' THEN TXN =         'RENUMBER';
IF CMD = '1B' THEN TXN =         'REPLACE ';
IF CMD = '1C' THEN TXN =         'STATS   ';
IF CMD = '1D' THEN TXN =         'TABS    ';
IF CMD = '1E' THEN TXN =         'UNNUMBER';
RETURN;

   OPTIONS OBS=MAX ;

   PROC SUMMARY DATA=WORK.CMDS NWAY;
    CLASS TYPE TXN;
    VAR NRTR;
    OUTPUT OUT=CMDSUMRY SUM=COUNT;

   PROC SUMMARY DATA=WORK.USRINTVL NWAY;
    CLASS USER;
    VAR   CPU THINK TRIVRESP TOTSHORT RESPONSE TRANS ;
    OUTPUT OUT=USRSUMRY
    MEAN(THINK TRIVRESP RESPONSE)=
    SUM(CPU TOTSHORT TRANS)= ;

   PROC SUMMARY DATA=WORK.CMDRECS NWAY;
    CLASS TXN;
    VAR CPU EXCP SERVUNIT;
    OUTPUT OUT=COMMANDS SUM= N(CPU)=COUNT;

   PROC PRINT DATA = COMMANDS; ID TXN;
    VAR COUNT CPU EXCP SERVUNIT;
    SUM COUNT CPU EXCP SERVUNIT;

   PROC SORT DATA = COMMANDS; BY DESCENDING CPU;
   OPTIONS OBS=12;
   DATA COMMANDS;
    SET COMMANDS;
   OPTIONS OBS=MAX;
   PROC SORT DATA=COMMANDS; BY TXN;

   PROC CHART DATA = COMMANDS;
    VBAR TXN / TYPE=SUM SUMVAR=CPU DISCRETE NOSPACE;

   PROC PRINT DATA = USRSUMRY; ID USER;
    VAR CPU THINK TRIVRESP TOTSHORT RESPONSE TRANS ;
    SUM CPU TOTSHORT TRANS;

   PROC PRINT DATA = CMDSUMRY; ID TXN; VAR TYPE COUNT;
   SUM COUNT;
./       ADD   NAME=SYSLOG5
OPTIONS OBS=MAX;

DATA A;
 INFILE SYSLOG
 LENGTH=LENGTH MISSOVER;
 INPUT     HCLCC      $CHAR1.  /* CARRIAGE CONTROL                   */
           HCLRECTP   $CHAR1.  /* RECORD TYPE                        */
 @ ;
 IF HCLRECTP='X' /* UNKNOWN SOURCE                                */
  | HCLRECTP='S' /* CONTINUATION LINE                             */
  | HCLRECTP='L' /* MLWTO LABEL LINE                              */
  | HCLRECTP='D' /* MLWTO DATA LINE                               */
  | HCLRECTP='E' /* MLWTO END LINE                                */
 THEN DELETE;
 INPUT     HCLREQTP   $CHAR1.  /* REQUEST TYPE                       */
           HCLROUTC   HEX7.    /* ROUTING CODES                      */
           HCLRV1     $CHAR1.  /* BLANK                              */
           HCLSYSID   $CHAR8.  /* SYSTEM ID                          */
           HCLRV2     $CHAR1.  /* BLANK                              */
           HCLYEAR    $CHAR2.  /* YEAR                  YY           */
           HCLDAY     $CHAR3.  /* DAY OF YEAR             DDD        */
           HCLRV3     $CHAR1.  /* BLANK                              */
           HCLHR      $CHAR2.  /* HOURS                 HH           */
           HCLCOLN1   $CHAR1.  /* COLON                   :          */
           HCLMIN     $CHAR2.  /* MINUTES                  MM        */
           HCLCOLN2   $CHAR1.  /* COLON                      :       */
           HCLSEC     $CHAR2.  /* SECONDS                     SS     */
           HCLDOT1    $CHAR1.  /* DECIMAL POINT                 .    */
           HCLTHSEC   $CHAR2.  /* .01 SECONDS                    TH  */
           HCLRV4     $CHAR1.  /* BLANK                              */
           HCLJOBID   $CHAR8.  /* ID OF JOB THAT ISSUED MESSAGE -    */
           HCLRV5     $CHAR1.  /* BLANK                              */
           HCLREQFL   $CHAR8.  /* USER EXIT/MPF REQUEST FLAGS        */
           HCLRV6     $CHAR1.  /* BLANK                              */
           HCLWTOR    $CHAR1.  /* @ FOR USER WTOR.                   */
           @ ;



 IF HCLRECTP='W'               /* WTOR. */
 THEN DO;
    INPUT HCLRV7 $CHAR3. @ ;
    LENGTH=LENGTH-3;
 END;
 LENGTH=LENGTH-57;
 INPUT
           HCLTEXT $VARYING78. LENGTH
           ;

 IF HCLREQTP¬=' ' & HCLREQTP¬='R'
 THEN DELETE;
 ELSE DO;
    MSGID=SUBSTR(HCLTEXT,1,9);
    MSGID=SCAN(MSGID,1,' ');
    IF SUBSTR(MSGID,1,1)='+'
    THEN MSGID=SUBSTR(MSGID,2);
 END;
 IF MSGID='IST264I';
 LUNAME=SUBSTR(HCLTEXT,27,8);
 IF LUNAME=:'TPXUN';
 YY=PUT(HCLYEAR,2.);
 DDD=PUT(HCLDAY,3.);
 J=(YY*1000)+DDD;
 DATE=DATEJUL(J);
 HH=PUT(HCLHR,2.);
 MM=PUT(HCLMIN,2.);
 SS=PUT(HCLSEC,2.);
 TIME=(HH*3600)+(MM*60)+SS;
 HOUR=HH;


PROC SUMMARY NWAY;
 CLASS DATE;
 VAR HH;
 OUTPUT OUT=S N= ;

PROC PRINT; ID DATE; VAR N;
 FORMAT DATE DATE.;

PROC SORT;
 BY DATE HOUR;

PROC CHART;
 VBAR HOUR / TYPE=FREQ DISCRETE NOSPACE;
 BY DATE;
 FORMAT DATE DATE.;
./       ADD   NAME=TMRECORD
DATA A;
 INFILE TMC;
 INPUT
     TMDSN          $44.            /* DATA SET NAME                 */
          @;
 IF SUBSTR(TMDSN,1,1) < 'A'
  | SUBSTR(TMDSN,1,1) > 'Z' THEN DELETE;
 INPUT
     TMSTPNAM       $8.             /* CREATING STEP NAME            */
     TMSLOT         IB2.            /* VAULT SLOT NUMBER             */
     TMVOLSEQ       IB2.            /* VOLUME SEQUENCE NUMBER        */
     TMCRTDT1       PD3.            /* CREATION DATE                 */
     TMEXPDT1       PD3.            /* EXPIRATION DATE               */
     TMTRTCH        IB1.            /* RECORDING TECHNIQUE           */
     TMDEN          IB1.            /* DENSITY                       */
     TMLTYPE        IB1.            /* TAPE LABEL TYPE               */
     TMRECFM        IB1.            /* RECORD FORMAT                 */
     TMBLKSI        IB2.            /* MAXIMUM BLOCK SIZE            */
     TMLRECL        IB2.            /* LOGICAL RECORD LENGTH         */
     TMFLAG2        IB1.            /* INTERNAL FLAG BITS            */
     TMVOLSER       $6.             /* VOLUME SERIAL NUMBER          */
     TMNXTVOL       $6.             /* NEXT VOLSER OF DATA SET       */
     TMPRVVOL       $6.             /* PREVIOUS VOLSER OF DATA SET   */
     TMDSSIF        IB1.            /* INTERNAL FLAGS FOR PASSWORD   */
     TMDSSPW        IB4.            /* DATA SET SECURITY PASSWORD    */
     TMDSNBS        IB2.            /* NUMBER OF DATA SET NAME BLOCKS*/
     TMADSNB        IB4.            /* ADDRESS OF 1ST DSNB           */
     TMFRSVOL       $6.             /* FIRST VOLSER OF DATA SET      */
     TMBATCH        IB1.            /* BATCH UPDATE ID NUMBER        */
     TMFLAG3        IB1.            /* INTERNAL FLAG BITS            */
     TMCRTTI        PD3.            /* CREATION TIME                 */
     TMCRUNI        IB2.            /* CREATION UNIT                 */
     TMUSUNI        IB2.            /* UNIT LAST USED                */
     TMLASUSD       PD3.            /* DATE LAST USED                */
     TMLASUSJ       $8.             /* JOB NAME WHICH LAST USED VOL  */
     TMBTHDT        PD3.            /* DATE TAPE IS FIRST USED       */
     TMUCOUNT       IB2.            /* NUMBER OF TIMES TAPE OPENED   */
     TMFLAG1       PIB1.            /* INTERNAL FLAG BITS            */
     TMCLNCNT       IB1.            /* NUMBER OF TIMES TAPE $EANED   */
     TMOUTDAT       PD3.            /* DATE TAPE WAS TAKEN OUT       */
     TMOUTAR        $4.             /* OUT OF AREA CODE              */
     TMUSECLN       IB2.            /* USE COUNT AT LAST $EANING     */
     TMDATCLN       PD3.            /* DATE OF LAST $EANING          */
     TMBLKCNT       IB4.            /* DATA SET BLOCK COUNT          */
     TMRERROR       IB1.            /* NUMBER OF READ ERRORS         */
     TMWERROR       IB1.            /* NUMBER OF WRITE ERRORS        */
     TMJOBNM        $8.             /* CREATING JOB NAME             */
     @;
    IF TMCRTDT1¬=.
    THEN TMCRTDT=PUT(DATEJUL(TMCRTDT1),DATE.);
    ELSE TMCRTDT='.';
    DROP TMCRTDT1;
    IF TMEXPDT1¬=.
    THEN TMEXPDT=PUT(DATEJUL(TMEXPDT1),DATE.);
    ELSE TMEXPDT='.';
    DROP TMEXPDT1;
    IF TMFLAG1='.....1..'B
    THEN VOLTYPE='SCRATCH';
    ELSE VOLTYPE='FILE   ';
    LENGTH HLQ $ 8;
    I=INDEX(TMDSN,'.');
    IF I=0 THEN I=LENGTH(TMDSN);
    HLQ=SUBSTR(TMDSN,1,I-1);

PROC SORT; BY TMDSN TMVOLSER;

PROC PRINT;
 ID TMDSN;
 VAR TMVOLSER TMCRTDT TMEXPDT TMBLKSI TMFLAG1 TMBLKCNT TMJOBNM   ;
 FORMAT TMFLAG1 BINARY. ;

PROC FREQ;
 TABLES HLQ;
./       ADD   NAME=TTOC
DATA TTOC
     (KEEP=VOLSER TYPE DATASETS FULL VSAM VALID
     PREVVOL NEXTVOL
     BLOCKS PSWD RCYCLMSG
     );
 INFILE OCDS VSAM BUFND=16 BUFNI=16 EOF=EOFOCDS;
 INPUT @001 TTCKEY  $44.
       @045 MCHLEN  IB2.
       @047 MCKTYPE IB2.
       @049 MCHTSLU        TODSTAMP8.
       @057 MCHTSCR        TODSTAMP8.
       @065 TTCHSTID       $1.
       @066 TTCFFLGS       IB2.
       @069 TTCUNIT        $8.
       @077 TTCNUM         IB2.
       @079 TTCDSNUM       IB2.
       @081 TTCTBLK        IB4.
       @085 TTCVBLK        IB4.
       @089 TTCPREVL       $6.
       @095 TTCSUCVL       $6.
       @101 TTCLFBID       IB4.
       @105 TTCFFBID       IB4.
       @ ;
 RETAIN
           VOLSER TYPE DATASETS FULL VSAM VALID
     PREVVOL NEXTVOL
     BLOCKS PSWD RCYCLMSG
 ;
 IF SUBSTR(TTCKEY,12,4)='0000'
 THEN DO;
    OUTPUT;
    VALID=0;
    VSAM=0;
    DATASETS=0;
    BLOCKS=0;
    VOLSER=SUBSTR(TTCKEY,5,6);
    FULL=REPEAT(' ',3);
    PREVVOL=TTCPREVL;
    NEXTVOL=TTCSUCVL;
    IF TTCFFLGS='1...............'B
    THEN FULL='YES';
    ELSE FULL='NO ';
    IF TTCFFLGS='...1............'B
    THEN PSWD='YES';
    ELSE PSWD='NO ';
    IF TTCFFLGS='....1...........'B
    THEN RCYCLMSG='YES';
    ELSE RCYCLMSG='NO ';
    IF SUBSTR(TTCKEY,2,2) ='SP' THEN TYPE='SPILL       ';
    IF SUBSTR(TTCKEY,2,2) ='UN' THEN TYPE='UNASSIGNED  ';
    IF SUBSTR(TTCKEY,2,2) ='L2' THEN TYPE='LEVEL 2     ';
    IF SUBSTR(TTCKEY,2,2)>='00' THEN TYPE='DAILY BACKUP';
 END;
 DATASETS=DATASETS+TTCDSNUM;
 DO COL=157 TO MCHLEN BY 56;
    INPUT @COL              TTCDSN        $44.
          @COL+044          TTCNBLKS      IB4.
          @COL+048          TTCDLR     ?? PD3.
          @COL+052          TTCEFLGS      IB1.
          @COL+053          TTCEXPDT   ?? PD3.
          @ ;
    IF TTCEFLGS='.1......'B THEN VALID=VALID+1;
    IF TTCEFLGS='1.......'B THEN VSAM=VSAM+1;
    BLOCKS=BLOCKS+TTCNBLKS;
 END;
 RETURN;
 EOFOCDS: OUTPUT;

DATA TTOC;
 SET TTOC;
 IF DATASETS=. THEN DELETE;

PROC PRINT; ID VOLSER;
 SUM DATASETS VALID BLOCKS;
./       ADD   NAME=VTAMOBR
DATA A;
 INFILE SERLOG ;
 INPUT @001   TYPE     IB1.
       @ ;
       IF TYPE='0001....'B THEN CLASS='MACHINE CHECK      ';
  ELSE IF TYPE='0010....'B THEN CLASS='CHANNEL CHECK      ';
  ELSE IF TYPE='0011....'B THEN CLASS='UNIT CHECK (OBR)   ';
  ELSE IF TYPE='0100....'B THEN CLASS='SOFTWARE ERROR     ';
  ELSE IF TYPE='0101....'B THEN CLASS='IPL RECORD         ';
  ELSE IF TYPE='0110....'B THEN CLASS='DDR RECORD         ';
  ELSE IF TYPE='0111....'B THEN CLASS='MISSING INTERRUPT  ';
  ELSE IF TYPE='1000....'B THEN CLASS='SYSTEM TERMINATION ';
  ELSE IF TYPE='1001....'B THEN CLASS='NON-STANDARD MDR   ';
  ELSE IF TYPE='1010....'B THEN CLASS='MACHINE CHECK FRAME';
  ELSE IF TYPE='1011....'B THEN CLASS='CHANNEL CHECK FRAME';

PROC FREQ DATA=WORK.A;
 TABLES CLASS;

DATA OBR (KEEP=DATE TIME JOBID CCW DEVTYPE PCUA SENSE LEVEL DATE1)
     SFT (KEEP=DATE TIME JOBID PROGRAM ABEND LMOD CSECT DATE1)
 ;
 INFILE SERLOG MISSOVER;
 INPUT @001   TYPE     IB1.
       @ ;

  IF TYPE='0011....'B THEN LINK TYPE03;
  IF TYPE='0100....'B THEN LINK TYPE04;
  RETURN;
  TYPE03:
 /*   IF TYPE¬='0011.11.'B THEN DELETE;     VTAM OBR RECORD. */
  INPUT @003   SWITCHES IB2.
        @ ;
 /*   IF SWITCHES='..........0.....'B ; */
  IF SWITCHES='.............1..'B THEN DELETE; /* VOLUME DEMOUNT. */
  IF SWITCHES='.........1......'B THEN LEVEL='TEMP'; ELSE LEVEL='PERM';
  INPUT @009   DATE1    PD4.
        @013   TIME     TU4.
        @025   JOBID    $8.
        @033   CCW      $PHEX8.
        @049   DEVDEPC  IB1.
        @053   DEVT1    $PHEX5.
        @057   SDRCNT   IB1.
        @058   PCUA1    $PHEX4.
        @063   SENSCNT  IB2.
        @ ;
  SENSOFF=65+(DEVDEPC*8)+SDRCNT;
  INPUT @SENSOFF SENSE1  $PHEX5.
        @ ;
  YY = ROUND(DATE1,1000);
  DDD = DATE1-YY;
  YY = YY/1000;
  DATE = DATEJUL(1000*YY+DDD);
  PCUA=SUBSTR(PCUA1,4,3);
  DEVTYPE=SUBSTR(DEVT1,1,8);
  SENSE=SUBSTR(SENSE1,1,8);
 /* IF SUBSTR(SENSE,1,2)='40' & DEVTYPE='1000080E' THEN DELETE; */
  IF DEVTYPE='12501009' THEN DEVTYPE='3270  ';
  IF DEVTYPE='500040F1' THEN DEVTYPE='3270  ';
  IF DEVTYPE='50004015' THEN DEVTYPE='3270  ';
  IF DEVTYPE='80062024' THEN DEVTYPE='3390  ';
  IF DEVTYPE='80062023' THEN DEVTYPE='3380  ';
  IF DEVTYPE='10800811' THEN DEVTYPE='4245  ';
  IF DEVTYPE='0000080F' THEN DEVTYPE='3825  ';
  IF DEVTYPE='78048080' THEN DEVTYPE='3490  ';
  IF DEVTYPE='78008000' THEN DEVTYPE='3480  ';
  IF DEVTYPE='78008080' THEN DEVTYPE='3480  ';
  IF DEVTYPE='32108003' THEN DEVTYPE='3420  ';
  IF DEVTYPE='1000080E' THEN DEVTYPE='3800-3';
  IF DEVTYPE='10800809' THEN DEVTYPE='3800-3';
  IF DEVTYPE='1200100B' THEN DEVTYPE='3286  ';
  IF DEVTYPE='12801009' THEN DEVTYPE='3277  ';
  IF DEVTYPE='12201009' THEN DEVTYPE='3278  ';
  IF DEVTYPE='10014100' THEN DEVTYPE='CTCA  ';
  IF DEVTYPE='3010200E' THEN DEVTYPE='3380  ';
  OUTPUT OBR;
  RETURN;

  TYPE04:
  INPUT @004   HDRDS    IB1.
        @009   DATE1    PD4.
        @013   TIME     TU4.
        @025   JOBID    $8.
        @037   ABEND    $PHEX4.
        @121   PROGRAM  $8.
        @325   LMOD     $8.
        @333   CSECT    $8.
        @ ;
  IF HDRDS='1.......'B THEN DELETE;
  IF HDRDS='.1......'B THEN DELETE;
  YY = ROUND(DATE1,1000);
  DDD = DATE1-YY;
  YY = YY/1000;
  DATE = DATEJUL(1000*YY+DDD);
  OUTPUT SFT;
  RETURN;


PROC SUMMARY DATA=WORK.OBR NWAY;
 CLASS DEVTYPE DATE;
 ID DATE;
 VAR TIME;
 OUTPUT OUT=S N=COUNT;
PROC SORT; BY DEVTYPE DATE;
PROC PLOT;
 PLOT COUNT*DATE; BY DEVTYPE;
 FORMAT DATE DATE. ;

