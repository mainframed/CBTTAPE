./       ADD   NAME=$$$BFGES
WE AT BFG HAV CONVERTED THE # COMMAND SUBSYSTEM TO RUN ON ESA(CURRENTLY
AN EXPRESS ESA 3.1.0E AT 8903). THE CODE HAS HELD UP VERY WELL FROM
XA, ONLY TWO MODULES WERE MODIFIED:

  1. CSCSJ03D (#I) - CONTROL BLOCK SIZES CHANGED IN ESA (PART, SART)
  2. CSCSL03D (#J) - FIELD ASCBSEQN WAS REMOVED BY IBM.

FOR ADDTIONAL CHANGES SEE MEMBER $$$BFGXA WHICH SHOWS THE CHANGES
MADE TO SUPPORT XA 2.1.3 AND ABOVE.

IF YOU NEED TO USE THIS FOR AN XA SYSTEM THEN BACKOUT THE RENAMES IN
$MVSES31 WHICH WILL RETURN THIS TO THE XA LEVEL.


THE FOLLOWING CHART SUMMARIZES THE MODIFICATIONS AND CURRENT STATUS
OF THE DIFFERENT # SUBSYSTEM MODULES UNDER ESA.

ESA STATUS
                                       T
                                       E  MODIFIED  STILL
                                       S    FOR      HAS
 MODULE        FUNCTION                T    ESA     BUGS
 --------      ----------------------- -   -----    -----
 CMDDOCTN  -   (DOCUMENTATION)
 CMDDUMMY  -   (CMDDUMMY MODULE)       X
 CMDINSTL  -   (INSTALLATION JCL)
 CMDPRINT  -   (DOCUMENTATION PRINT)
 CMDSBCSC  -   (CROSS-SYSTEM CNTRL)    X
 CMDSBINT  -   (INIT AND MONITOR)      X
 CMDSBMON  -   (STANDALONE MONITOR)                   X  NEEDS BTAM/XA
 CMDSBSYS  -   (PROCESSOR)             X
 CMDSBTSO  -   (TSO FULL SCREEN MON)   X
 CMDTSO    -   (TSO DIRECTOR)          X
 CSCGA03D  -   (A - ACTIVITY MONITOR)
 CSCGE03D  -   (E - EXCEPTION GRAPH)                  X  USES TCH INSTR
 CSCGF03D  -   (F - FRAME USE GRAPH)
 CSCGH03D  -   (H - HELP FOR GRAPH)
 CSCGI03D  -   (I - JES2 INIT GRAPH)                  X  NEEDS JES2 BLK
 CSCGJ03D  -   (J - JOB CPU GRAPH)
 CSCGO03D  -   (O - I/O ACT GRAPH)                    X  USES TCH INSTR
 CSCGQ03D  -   (Q - QUE)
 CSCGS03D  -   (S - SYS. IND. GRAPH)
 CSCGU03D  -   (U - FREE DASD SPACE)
 CSCSA03D  -   (#N -  D ENQ P1)        X
 CSCSB03D  -   (#N -  D ENQ P2)        X
 CSCSC03D  -   (#L -  D LINES)         X
 CSCSD03D  -   (#D -  COREZAP)         X
 CSCSE03D  -   (#A -  ASCB INFO)       X
 CSCSF03D  -   (#F -  D FRAMES)        X
 CSCSG03D  -   (#R -  D ALLOC)         X
 CSCSH03D  -   (#S -  D LPA)           X
 CSCSI03D  -   (#V -  D DEVICE)                       X  NEEDS UCB LOOK
 CSCSJ03D  -   (#I -  D SYS INDS)      X     X
 CSCSK03D  -   (#C -  CALCULATOR)      X
 CSCSL03D  -   (#J -  D A)             X     X
 CSCSM03D  -   (#H -  HELP)            X
 CSCSN03D  -   (#T -  D TIOT)          X
 CSCSO03D  -   (#M -  TSO SEND)
 CSCSP0ED  -   (#P -  D SU)
 CSCSQ03D  -   (#Q -  ANALYZE ENQ)     X
 CSCSR03D  -   (#O -  I/O PENDING)     X
 CSCSS03D  -   (#E -  EXECUTE)
 CSCSZ03D  -   (#Z -  D A)
 CSCZA03D  -   (##A -  JOB ACTIVITY)
 CSCZB03D  -   (##B -  DEVICE MON.)
 CSCZC03D  -   (##C -  CHANNEL MON.)                  X  USES TCH INSTR
 CSCZJ03D  -   (##J -  JOB MON.)
 CSCZP03D  -   (##P -  PAGING MON.)
 CSCZS03D  -   (##S -  SYSIND MON.)
./       ADD   NAME=$$$BFGXA
WE AT BFG HAV CONVERTED THE # COMMAND SUBSYSTEM TO RUN ON XA (CURRENTLY
AN EXPRESS XA 2.1.3 AT 8501). IN DOING THIS WE FOUND SOME BUGS THAT
CROSS ALL THE MODULES:

  1. ESTAE PARMLIST LENGTH WAS HARD CODED, AND XA WAS LONGER. CAUSED
     MANY FUNNY BRANCHES NOT TO THE ESTAE ROUTINE.  THE CODE AT THE
     ESTAE ISSUANCE WAS CHANGED IN ALL MODULES HAVING ESTAES.  ALL
     ESTAES FOR XA WERE CHANGED TO RECORD ANY FAILURES IN LOGREC
     TO ALLOW EASIER DEBUGGING.
  2. CMDTSO DEPENDED ON R4 NOT BEING MODIFIED DURING THE CALLING OF
     ANY CSCXX03D MODULE. THIS RESTIRCTION DOES NOT EXIST IN THE
     CONSOLE COMMAND INVOCATION.  THUS CERTAIN COMMANDS BOMBED FOR
     NO APPARENT REASON. THIS WAS FIXED.

THIS FILE SUPERCEEDS BOTH FILES 409 AND 417, IN CURRENCY, AND IN FACT
BOTH THOSE FILES WERE MERGED INTO THIS AS A BASE FOR OUR CONVERSION.

WE ALSO FIXED ANY REENTRANCY PROBLEMS THAT OCCURED IN THE MODULES.
(YOU WOULD BE SUPPRISED WHAT WAS FOUND.)

CERTAIN MODULES WERE FIXED FOR XA AND SUPPORT ABOVE THE LINE PROCESSING:

  1. #S WILL NOW ACCEPT 4 BYTE ADDRESSES AND DISPLAY 4 BYTE ADDRESSES.
  2. #D WILL NOW ACCEPT 4 BYTE ADDRESSES AND DISPLAY 4 BYTE ADDRESSES.

#T HAS BEEN ENHANCED (REALLY FIXED) TO DISPLAY THE LAST LINE OF
ITS FORMAT DATA. PREVIOUSLY THE LAST ENTRY WAS SKIPPED.

THE FOLLOWING CHART SUMMARIZES THE MODIFICATIONS AND CURRENT STATUS
OF THE DIFFERENT # SUBSYSTEM MODULES UNDER XA.

XA STATUS
                                       T
                                       E  MODIFIED  STILL
                                       S    FOR      HAS
 MODULE        FUNCTION                T     XA     BUGS
 --------      ----------------------- -   -----    -----
 CMDDOCTN  -   (DOCUMENTATION)
 CMDDUMMY  -   (CMDDUMMY MODULE)       X
 CMDINSTL  -   (INSTALLATION JCL)
 CMDPRINT  -   (DOCUMENTATION PRINT)
 CMDSBCSC  -   (CROSS-SYSTEM CNTRL)    X     X
 CMDSBINT  -   (INIT AND MONITOR)      X     X
 CMDSBMON  -   (STANDALONE MONITOR)                   X  NEEDS BTAM/XA
 CMDSBSYS  -   (PROCESSOR)             X
 CMDSBTSO  -   (TSO FULL SCREEN MON)   X     X
 CMDTSO    -   (TSO DIRECTOR)          X     X
 CSCGA03D  -   (A - ACTIVITY MONITOR)
 CSCGE03D  -   (E - EXCEPTION GRAPH)                  X  USES TCH INSTR
 CSCGF03D  -   (F - FRAME USE GRAPH)
 CSCGH03D  -   (H - HELP FOR GRAPH)
 CSCGI03D  -   (I - JES2 INIT GRAPH)                  X  NEEDS JES2 BLK
 CSCGJ03D  -   (J - JOB CPU GRAPH)
 CSCGO03D  -   (O - I/O ACT GRAPH)                    X  USES TCH INSTR
 CSCGQ03D  -   (Q - QUE)
 CSCGS03D  -   (S - SYS. IND. GRAPH)
 CSCGU03D  -   (U - FREE DASD SPACE)
 CSCSA03D  -   (#N -  D ENQ P1)        X
 CSCSB03D  -   (#N -  D ENQ P2)        X
 CSCSC03D  -   (#L -  D LINES)
 CSCSD03D  -   (#D -  COREZAP)         X     X
 CSCSE03D  -   (#A -  ASCB INFO)       X     X
 CSCSF03D  -   (#F -  D FRAMES)        X     X
 CSCSG03D  -   (#R -  D ALLOC)         X     X
 CSCSH03D  -   (#S -  D LPA)           X     X
 CSCSI03D  -   (#V -  D DEVICE)        X     X        X  NEEDS UCB LOOK
 CSCSJ03D  -   (#I -  D SYS INDS)      X     X
 CSCSK03D  -   (#C -  CALCULATOR)
 CSCSL03D  -   (#J -  D A)             X     X
 CSCSM03D  -   (#H -  HELP)            X
 CSCSN03D  -   (#T -  D TIOT)          X     X
 CSCSO03D  -   (#M -  TSO SEND)
 CSCSP0ED  -   (#P -  D SU)
 CSCSQ03D  -   (#Q -  ANALYZE ENQ)     X
 CSCSR03D  -   (#O -  I/O PENDING)     X     X
 CSCSS03D  -   (#E -  EXECUTE)
 CSCSZ03D  -   (#Z -  D A)
 CSCZA03D  -   (##A -  JOB ACTIVITY)         X
 CSCZB03D  -   (##B -  DEVICE MON.)
 CSCZC03D  -   (##C -  CHANNEL MON.)                  X  USES TCH INSTR
 CSCZJ03D  -   (##J -  JOB MON.)             X
 CSCZP03D  -   (##P -  PAGING MON.)
 CSCZS03D  -   (##S -  SYSIND MON.)
./       ADD   NAME=$$ORIGIN
THE SOURCE OF THIS DATASET IS THE COMBINATION OF FILES:
     266  -  BASE # SUBSYSTEM
     409  -  CORRECTED #T AND #D
     417  -  INITIAL XA COMMANDS
THESE FILES CAME FROM VERSION 259 (4/1/86) OF THE CBT MODS TAPE
./       ADD   NAME=$HELP
)F       FUNCTION -
               # IS THE TSO INTERFACE FOR THE EXTENDED OPERATOR
                    # COMMANDS. FOR FULL SCREEN MODE TYPE #FS
                    OR CMDSBTSO
)X       SYNTAX -
               # H  THERE MUST BE ONE SPACE BETWEEN THE # AND THE
                    OPERAND
)O       OPERANDS:
               H   - THE HELP DATA SET FOR ALL THE # COMMANDS
                        ACCESSABLE TO THE TSO USER.
         WARNING:
               CERTAIN COMMANDS AND/OR SUBCOMMANDS CANNOT BE
               EXECUTED UNDER TSO UNLESS THE TMP IS AUTHORIZED
               ERROR MESSAGES ARE ISSUED IF ANY OF THE FOLLOWING
               COMMANDS ARE ISSUED.
                 1. # L  2. # JT  3. # T  4. # D(ZAP)  5. # X

               IF THE COMMAND YOU WISH TO ENTER CONTAINS A
               COMMA (,) SUBSTITUTE AN AT SIGN (@)

               IF THE COMMAND YOU WISH TO ENTER CONTAINS A
               SLASH-ASTERICK (/*) SUBSTITUTE A SLASH-NOT (/Â¬)

         EXAMPLES:
               # H  LIST OF ALL THE COMMANDS
               # J  EXTENDED DISPLAY ACTIVE
               # A  DISPLAY JOB STATUS
               # R  DISPLAY DEVICE STATUS
               # HJ DISPLAY HELP FOR THE # J COMMAND
               # HA DISPLAY HELP FOR THE # A COMMAND
               # HR DISPLAY HELP FOR THE # R COMMAND
./       ADD   NAME=$JCL
//CMD1   PROC  PROG=CMDSBINT,
//             A=ASE0,
//             B='$',
//             C=CSK0,
//             D=DSD0,
//             E=ESS0,
//             F=FSF0,
//             G='$',
//             H=HSM0,
//             I=ISJ0,
//             J=JSL0,
//             K='$',
//             L=LSC0,
//             M=MSO0,
//             N=NSA0,
//             O=OSR0,
//             P=PSP0,
//             Q=QSQ0,
//             R=RSG0,
//             S=SSH0,
//             T=TSN0,
//             U='$',
//             V=VSI0,
//             W='$',
//             X='$',
//             Y='$',
//             Z='$'
//CMD1  EXEC PGM=&PROG,TIME=1440,DPRTY=(15,10),PERFORM=12,
// PARM='&A&B&C&D&E&F&G&H&I&J&K&L&M&N&O&P&Q&R&S&T&U&V&W&X&Y&Z'
//SYSUDUMP  DD  SYSOUT=1
./       ADD   NAME=$MODS
 AUG   10, 1981

 IF YOU IEBCOPY IN THE LOAD MODULES FROM THE MVSMODS TAPE (FILE 267)
 YOU WILL END UP WITH THE MVS/SP RELEASE 1 VERSION OF THESE # COMMANDS
 IN YOUR SYSTEM. IF YOU WANT THE NON MVS/SE VERSIONS OF THE LOAD
 MODULES YOU WILL HAVE TO ASSEMBLE AND RELINK THE NON MVS/SE
 MODULES YOURSELF. IF YOU WANT THE MVS/SE RELEASE 2 VERSION YOU SHOULD
 SEE THE MEMBER IN THIS PDS CALLED $MVSSE2

      DO NOT JUST RUN FILE 267 INTO YOUR LPALIB YOU WILL
      HAVE UNBELIEVEABLE PROBLEMS IF YOU DO. CERTAIN MODULES
      CAN NOT RESIDE THERE. READ THE REST OF THE DOCUMENT
      IN OTHER MEMBERS OF THIS PDS FOR ADDITIONAL INFORMATION.

//STEP267B  EXEC  IEBCOPY
//SYSUT1 DD DSN=SYS2.MLINKLIB,DISP=SHR
//SYSUT2 DD DSN=MVS.MVSMODS.TAPE,DISP=(NEW,CATLG),
// UNIT=SYSDA,SPACE=(CYL,(5,2,56),RLSE),
// DCB=(RECFM=U,BLKSIZE=19069)
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CMDPRINT,,R)) DOCUMENTATION PRINTER  ANY LIBRARY
 S M=((CMDSBCSC,,R)) X-SYSTEM PGM   NOT LPA LINKLIST AC=1
 S M=((CMDSBINT,,R)) INIT & MONITOR NOT LPA LINKLIST AC=1
 S M=((CMDSBSYS,,R)) PROCESSOR      NOT LPA LINKLIST AC=1
 S M=((CMDSBMON,,R)) STANDALONE MON LINKLIST NOT RENT
 S M=((CSCSA03D,,R))          #N     ANY LIBRARY
 S M=((CSCSC03D,,R))          #L     ANY LIBRARY
 S M=((CSCSD03D,,R))          #D     ANY LIBRARY
 S M=((CSCSE03D,,R))          #A     ANY LIBRARY
 S M=((CSCSF03D,,R))          #F     ANY LIBRARY
 S M=((CSCSG03D,,R))          #R     ANY LIBRARY
 S M=((CSCSH03D,,R))          #S     ANY LIBRARY
 S M=((CSCSI03D,,R))          #V     ANY LIBRARY
 S M=((CSCSJ03D,,R))          #I     ANY LIBRARY
 S M=((CSCSK03D,,R))          #C     ANY LIBRARY
 S M=((CSCSL03D,,R))          #J     ANY LIBRARY
 S M=((CSCSM03D,,R))          #H     ANY LIBRARY
 S M=((CSCSN03D,,R))          #T     ANY LIBRARY
 S M=((CSCSO03D,,R))          #M     ANY LIBRARY
 S M=((CSCSP03D,,R))          #P     ANY LIBRARY
 S M=((CSCSQ03D,,R))          #Q     ANY LIBRARY
 S M=((CSCSR03D,,R))          #O     ANY LIBRARY
 S M=((CSCSS03D,,R))          #E     ANY LIBRARY
 S M=((CSCZA03D,,R))          ##A    ANY LIBRARY
 S M=((CSCZB03D,,R))          ##B    ANY LIBRARY
 S M=((CSCZC03D,,R))          ##C    ANY LIBRARY
 S M=((CSCZJ03D,,R))          ##J    ANY LIBRARY
 S M=((CSCZP03D,,R))          ##P    ANY LIBRARY
 S M=((CSCZS03D,,R))          ##S    ANY LIBRARY
/*
//STEP267C EXEC IEBCOPY
//SYSUT1 DD DSN=SYS2.MLINKLIB,DISP=SHR
//SYSUT2 DD DSN=MVS.MVSMODS.TAPE,DISP=SHR
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CSCSA03D,IEESA03D,R))  #N     LPA LIBRARY
 S M=((CSCSC03D,IEESC03D,R))  #L     LPA LIBRARY
 S M=((CSCSD03D,IEESD03D,R))  #D     LPA LIBRARY
 S M=((CSCSE03D,IEESE03D,R))  #A     LPA LIBRARY
 S M=((CSCSF03D,IEESF03D,R))  #F     LPA LIBRARY
 S M=((CSCSG03D,IEESG03D,R))  #R     LPA LIBRARY
 S M=((CSCSH03D,IEESH03D,R))  #S     LPA LIBRARY
 S M=((CSCSI03D,IEESI03D,R))  #V     LPA LIBRARY
 S M=((CSCSJ03D,IEESJ03D,R))  #I     LPA LIBRARY
 S M=((CSCSK03D,IEESK03D,R))  #C     LPA LIBRARY
 S M=((CSCSL03D,IEESL03D,R))  #J     LPA LIBRARY
 S M=((CSCSM03D,IEESM03D,R))  #H     LPA LIBRARY
 S M=((CSCSN03D,IEESN03D,R))  #T     LPA LIBRARY
 S M=((CSCSO03D,IEESO03D,R))  #M     LPA LIBRARY
 S M=((CSCSP03D,IEESP03D,R))  #P     LPA LIBRARY
 S M=((CSCSQ03D,IEESQ03D,R))  #Q     LPA LIBRARY
 S M=((CSCSR03D,IEESR03D,R))  #O     LPA LIBRARY
 S M=((CSCSS03D,IEESS03D,R))  #E     LPA LIBRARY
 S M=((CSCZA03D,IEEZA03D,R))  ##A    LPA LIBRARY
 S M=((CSCZB03D,IEEZB03D,R))  ##B    LPA LIBRARY
 S M=((CSCZC03D,IEEZC03D,R))  ##C    LPA LIBRARY
 S M=((CSCZJ03D,IEEZJ03D,R))  ##J    LPA LIBRARY
 S M=((CSCZP03D,IEEZP03D,R))  ##P    LPA LIBRARY
 S M=((CSCZS03D,IEEZS03D,R))  ##S    LPA LIBRARY
/*
//STEP267D EXEC IEBCOPY
//SYSUT1 DD DSN=SYS2.MLINKLIB,DISP=SHR
//SYSUT2 DD DSN=MVS.MVSMODS.TAPE,DISP=SHR
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CMDTSO,,R))    TSO DRIVER                 ANY LIBRARY NO RENT
 S M=((CMDSBTSO,,R))  TSO FULL SCREEN DRIVER     ANY LIBRARY NO RENT
 S M=((CSCGA03D,,R))  TSO JOB ACTIVITY MON       ANY LIBRARY
 S M=((CSCGE03D,,R))  TSO EXCEPTION GRAPH        ANY LIBRARY
 S M=((CSCGF03D,,R))  TSO FRAME USE GRAPH        ANY LIBRARY
 S M=((CSCGH03D,,R))  TSO HELP FOR GRAPHICS      ANY LIBRARY
 S M=((CSCGI03D,,R))  TSO JES2 INIT GRAPH        ANY LIBRARY
 S M=((CSCGJ03D,,R))  TSO JOB CPU GRAPH          ANY LIBRARY
 S M=((CSCGO03D,,R))  TSO I/O ACTIVITY MON       ANY LIBRARY
 S M=((CSCGQ03D,,R))  TSO QUE COMMAND            ANY LIBRARY
 S M=((CSCGS03D,,R))  TSO SYS. IND. GRAPH        ANY LIBRARY
 S M=((CSCGU03D,,R))  TSO FREE DASD SPACE GRAPH  ANY LIBRARY
//STEP267E EXEC IEBCOPY
//SYSUT1 DD DSN=SYS1.LPALIB,DISP=SHR
//SYSUT2 DD DSN=MVS.MVSMODS.TAPE,DISP=SHR
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CMDDUMMY,,R))    CMDDUMMY     MUST BE FIXED LPA AC=0,RENT,REUS
//STEP267F  EXEC IEBCOPY
//IN        DD   DSN=MVS.MVSMODS.TAPE,DISP=SHR
//OT        DD   UNIT=TAPEHI,VOL=SER=MVSTAP,DISP=(OLD,PASS),
//          LABEL=(267,NL),DCB=DEN=3
 COPY INDD=IN,OUTDD=OT
./       ADD   NAME=$PASSWRD
 NOVEMBER 4, 1979

 FOR THOSE WHO WISH TO KNOW THE 8 DIGIT PASSWORD FOR SWITCHING
 THE  MASTER  CONSOLE  WITH  THE  #CZ COMMAND IT IS AS FOLLOWS

 DIGIT      WHAT IT IS

   1        1ST DIGIT OF THE SMF SYSTEM ID
   2        1ST DIGIT OF THE JULIAN DAY
   3        1ST DIGIT OF THE HOUR
   4        2ND DIGIT OF THE JULIAN DAY
   5        2ND DIGIT OF THE HOUR
   6        3RD DIGIT OF THE JULIAN DAY
   7        1ST DIGIT OF THE MINUTE
   8        2ND DIGIT OF THE MINUTE

./       ADD   NAME=ALLOC
         MACRO
&NAME    ALLOC &DUMMY,&PERM,&DSN=,&DDN=,&DDNRET=,&MEMBER=,&DISP=,      X
               &VOL=,&UNIT=,&SYSOUT=,&FREE=,&COPIES=,&LABEL=,          X
               &BLKSIZE=,&DEN=,&DSORG=,&KEYLEN=,&LRECL=,&RECFM=,       X
               &PASWORD=,&DSNRET=,&MF=AUTO,&PREFIX=,&ERROR=,           X
               &SPACE=,&F=,&FILE=,&DA=,&QNAME=,&DSORGRT=,              X
               &VOLRET=,&DCBDSN=,&DCBDDN=,&SPECIAL=,&DDNTO=,           X
               &FORMS=,&DEST=,&SSREQ=,&FORUSER=,&TU=,&DSNPDE=
.**********************************************************************
.*                                                                    *
.*    THIS MACRO PROVIDES A DYNAMIC ALLOCATION FUNCTION BY BUILDING   *
.*    A DYNAMIC ALLOCATION PARAMETER LIST AND INVOKING SVC 99.        *
.*    IT FIRST SETS UP A WORKAREA ENVIRONMENT FOR THE PARAMETER LIST  *
.*    AND THEN TESTS THE KEYWORDS SUPPLIED AND INVOKES INNER MACROS   *
.*    TO BUILD THE TEXT UNITS. THE INNER MACROS THEMSELVES USE INNER  *
.*    MACROS TO UPDATE GLOBAL VARIABLES, STORE TEXT UNIT POINTERS ETC *
.*    THERE ARE THREE WAYS OF SPECIFYING THE WORK AREA ADDRESS.       *
.*    A) MF=AUTO, MF=G, MF=(E,ADDRESS,LNTHSYMB).                      *
.*    IN THE FIRST FORM, AN INNER MACRO DYNSPACE IS CALLED TO NAME    *
.*    A WORK AREA, THE NAME BEING RETURNED IN THE GLOBAL SETC         *
.*    VARIABLE &DYNSP. A DSECT IS CREATED TO MAP THIS AREA.           *
.*    THE GLOBAL VARIABLES &DTUO (TEXT UNIT OFFSET COUNTER) AND       *
.*    &DTUPO (TEXT UNIT POINTER OFFSET ACCUMULATOR) ARE SET TO ZERO.  *
.*    THESE ACCUMULATORS ARE UPDATED AS EACH TEXT UNIT PROCESSOR      *
.*    AQUIRES STORAGE. AFTER ALL TEXT UNITS HAVE BEEN BUILT, THE      *
.*    AMOUNT OF SPACE USED IS CALCULATED, AND THE DYNSPACE MACRO IS   *
.*    THEN CALLED AGAIN TO LOG THE AMOUNT NEEDED. DYNSPACE SETS A     *
.*    GLOBAL VARIABLE &DYNSPQ TO THE HIGHEST AMOUNT ANY ALLOC OR      *
.*    FREE MACRO REQUESTED, AND WHEN CALLED WITH THE EXPAND OPTION,   *
.*    (NO OPERANDS OR NAME FIELD SUPPLIED), EXPANDS INTO A DS FOR     *
.*    THAT QUANTITY. (SEE DYNSPACE)                                   *
.*    MF=G SPECIFIES THAT THE ALLOC MACRO ENTER THE BEGIN MACRO       *
.*    WORKAREA TO ACQUIRE THE STORAGE NECESSARY. IT DOES THIS VIA     *
.*    THE RCPDS MACRO. (SEE RCPDS). HOWEVER, IF THE ALLOC MACRO IS    *
.*    CALLED SEVERAL TIMES WITH THIS OPTION, A LOT OF STORAGE WILL BE *
.*    USED UP, AS THE STORAGE WILL NOT BE SHARED. THUS, THIS FORM     *
.*    SHOULD ONLY BE USED IF THE ALLOC/FREE MACRO IS ONLY TO BE USED  *
.*    ONCE OR TWICE DURING AN ASSEMBLY.                               *
.*    MF=E CAUSES THE MACRO TO USE A USER SPECIFIED WORK AREA. THE    *
.*    SECOND PARAMETER GIVES THE NAME OF THE WORKAREA, AND AN         *
.*    OPTIONAL THIRD PARAMETER IS THE NAME OF A SYMBOL TO BE EQUATED  *
.*    TO THE LENGTH OF THE REQUIRED WORK AREA.                        *
.*                                                                    *
.*    DYNAMIC ALLOCATION FUNCTIONS ARE SIMILAR TO THOSE AVAILABLE    *
.*    WITH JCL, USING THE SAME KEYWORDS. HOWEVER, CERTAIN FORMATS    *
.*    ARE SLIGHTLY DIFFERENT. FOR INSTANCE, CERTAIN KEYWORDS CAN     *
.*    HAVE VARYING PARAMETERS, EG DATASET NAME, DDNAME, VOLSER ETC.  *
.*    PROVISION IS MADE FOR BOTH VARIABLE SPECIFICATION.             *
.*    IN THE ABSOLUTE FORM, THE PARAMETER IS ENTERED IN QUOTES,      *
.*    E.G.   ALLOC DSN='SYS1.LINKLIB',DISP=SHR                       *
.*    HOWEVER, THIS NAME REMAINS FIXED FOR THE ASSEMBLY.             *
.*    IN THE VARIABLE FORMAT, THE ADDRESS OF A LOCATOR IS SPECIFIED, *
.*    WHERE THE LOCATOR CONSISTS OF A SIX BYTE FIELD, THE FIRST 4    *
.*    BYTES OF WHICH POINT TO THE PARAMETER, WHILE THE NEXT TWO      *
.*    CONTAIN THE LENGTH.                                            *
.*    EG          ALLOC DSN=LOCATOR                                  *
.*       LOCATOR  DC    A(DSN),Y(12)                                 *
.*       DSN      DC    C'SYS1.LINKLIB'                              *
.*                                                                   *
.*       NUMERIC QUANTITIES E.G. COPIES= FOR SYSOUT, SHOULD EITHER   *
.*       SPECIFY A NUMERIC VALUE, COPIES=3,                          *
.*       A VALUE IN A REGISTER, COPIES=(R3),                         *
.*       OR THE NAME OFF A FULLWORD CONTAINING THE VALUE,            *
.*          COPIES=NUMCOPYS, WHERE NUMCOPYS IS THE NAME OF A         *
.*       FULLWORD FIELD.                                             *
.*                                                                   *
.*       OTHER KEYWORDS SUCH AS DISP= CAN ONLY HAVE THE ABSOLUTE     *
.*       FORM, AND VALUES SHOULD NOT BE ENTERED WITHIN QUOTES.       *
.*       ADDITIONAL FACILITIES NOT AVAILABLE WITH JCL ARE THE        *
.*       RETURN BY THE SYSTEM OF INFORMATION ON THE DATASET, EG      *
.*       DSORG. THIS IS DONE BY SPECIFYING DSORGRT=SYMBOL, WHERE     *
.*       SYMBOL IS A SYMBOL WHICH WILL BE EQUATED TO A TWO BYTE      *
.*       FIELD CONTAINING THE DSORG TYPE (SEE JOB MANAGEMENT,        *
.*       SUPERVISOR AND TSO).                                        *
.*       THE SYSTEM CAN ALSO GENERATE AND RETURN A DDNAME. THIS IS   *
.*       CARRIED OUT BY ENTERING DDNTO=(ADDR1,ADDR2,,...)            *
.*       WHERE ADDR1,ADDR2 ETC ARE THE NAMES OF 8 BYTE FIELDS WHICH  *
.*       ARE TO RECEIVE THE DDNAME.                                  *
.*       FOR FURTHER INFORMATION ON DYNAMIC ALLOCATION, SEE          *
.*       JOB MANAGEMENT, SUPERVISOR AND TSO.                         *
.*                                                                   *
.**********************************************************************
         GBLA  &RCPDYN            COUNTER FOR NO ENTRIES TO MACRO
         GBLA  &DTUO              OFFSET TO TEXT UNITS
         GBLA  &DTUPO             OFFSET TO TEXT UNIT POINTERS
         GBLB  &RCPS99(2)         TELL RCPDSECT NEED DSECTS
         GBLC  &DYNP              PREFIX FOR LABELS FOR THIS CALL
         GBLC  &DYNSP         NAME FOR AUTOMATIC STORAGE ALLOC
         LCLA  &DDNRTO,&DSNRTO         FOR EQUATES FOR RETURNED FLDS
         LCLA  &VOLRTO,&DSRGRTO        FOR EQUATES FOR RETURNED FIELDS
         LCLA  &I                 COUNTER
         LCLB  &DSECT             DSECT NEEDED FOR STORAGE, MF=E
         LCLC  &C,&T,&PAR
.*
.*   THE ALLOC MACRO PROVIDES A DYNAMIC ALLOCATION FUNCTION,
&RCPS99(1)     SETB           1
&RCPDYN  SETA  &RCPDYN+1          INCEREMENT COUNTER
&DYNP    SETC  'DYN&RCPDYN' SET DEFAULT PREFIX
&NAME    DS    0H
         AIF   ('&PREFIX' EQ '').TMF
         AIF   (K'&PREFIX LT 4).POK
         MNOTE 4,'PREFIX TOO LONG, 1ST 4 CHARS USED'
&DYNP    SETC  '&PREFIX'(1,4)
         AGO   .TMF
.POK     ANOP
&DYNP    SETC  '&PREFIX'
.TMF     AIF   ('&MF(1)' EQ 'G').GEN
         AIF   ('&MF' NE 'AUTO').TMFE
NAME     DYNSPACE             GET NAME FOR SPACE
         LA    R1,&DYNSP               LOAD ADDRESS OF PARAM LIST
         USING &DYNP.DS,R1             USE GENERATED DSECT
&T       SETC  'A'
&PAR     SETC  '&DYNSP+4'
&DSECT   SETB  1
         AGO   .START
.TMFE    AIF   ('&MF(2)' NE '').E2OK
         MNOTE 4,'PLIST ADDRESS OMITTED, MF=G USED'
         AGO   .GEN
.E2OK    ANOP
&DSECT   SETB  1
         AIF   ('&MF(2)' EQ '(').RMFE
         LA    R1,&MF(2)               LOAD PARAM LIST ADDRESS
         USING &DYNP.DS,R1             USE GENERATED DSECT
         AGO   .START
.RMFE    AIF   ('&MF(2)' EQ '(R1)' OR '&MF(2)' EQ '(1)').START
         LR    R1,&PAR                 LOAD S99 PARAM LIST ADDRESS
         AGO   .START
.GEN     LA    R1,&DYNP.RBP            LOAD ADDRESS OF S99 RBP
.START   LA    R15,&DYNP.RB            LOAD ADDRESS OF S99 RB
         USING S99RB,R15
         ST    R15,0(R1)               AND STORE IN RB POINTER
         XC    4(&DYNP.LEN-4,R1),4(R1) ZERO PARAMETER LIST
         MVI   S99RBLN,20              MOVE IN LIST LENGTH
         MVI   S99VERB,S99VRBAL        MOVE IN VERB CODE
         LA    R14,&DYNP.TUP           LOAD ADDRESS OF TU POINTERS
         ST    R14,S99TXTPP            STORE ADDRESS IN S99 RB
         LA    R15,&DYNP.TU            POINT TO SPACE FOR TEXT UNITS
         USING S99TUNIT,R15
&DTUO    SETA  0
&DTUPO   SETA  0
         AIF   ('&SSREQ' EQ 'YES').SSREQ
.TDSN    AIF   ('&DSN&DA' NE '').DSN
         AIF   ('&DSNPDE' NE '').DSNPDE
         AIF   ('&DSNRET' NE '').DSNRT
         AIF   ('&SYSOUT' NE '').SYSOUT
         AIF   ('&DUMMY' NE '').DUMMY
         AIF   ('&QNAME' NE '').QNAME
.TDDN    AIF   ('&DDN&FILE&F' NE '').DDN
         AIF   ('&DDNRET&DDNTO' NE '').DDNRT
.TUNIT   AIF   ('&UNIT&VOL' NE '').UNIT
.TVOLRET AIF   ('&VOLRET' NE '').VOLRET
.TDSRGO  AIF   ('&DSORGRT' NE '').DSORGRT
.TLABEL  AIF   ('&LABEL' NE '').LABEL
.TPSWD   AIF   ('&PASWORD' NE '').PASWORD
.TFORUSE AIF   ('&FORUSER' NE '').FORUSER
.TTU     AIF   ('&TU' NE '').TU
.TDISP   AIF   ('&DISP' NE '').DISP
.TSPACE  AIF   ('&SPACE' NE '').SPACE
.TLRECL  AIF   ('&LRECL' NE '').DCB
         AIF   ('&DEN' NE '').DCB
         AIF   ('&RECFM' NE '').DCB
         AIF   ('&BLKSIZE' NE '').DCB
         AIF   ('&DSORG' NE '').DCB
         AIF   ('&KEYLEN' NE '').DCB
.TDCBDSN AIF   ('&DCBDSN' NE '').DCBDSN
.TDCBDDN AIF   ('&DCBDDN' NE '').DCBDDN
.TFREE   AIF   ('&FREE' EQ 'CLOSE').FREE                         TE7343
.TPERM   AIF   ('&PERM' EQ 'PERM' OR '&PERM' EQ 'PERMANENT').PERM
         AIF   ('&DUMMY' EQ 'PERM' OR '&DUMMY' EQ 'PERMANENT').PERM
.TSPECI  AIF   ('&SPECIAL' NE '').SPECIAL
         AGO   .SVC99
.SSREQ   RCPSSREQ
         AGO   .TDSN
.DSN     RCPDSN &DSN&DA,&MEMBER
         AGO   .TDDN
.DSNPDE  RCPDSNPD &DSNPDE
         AGO   .TDDN
.DSNRT   RCPDSNRT &DSNRET
&DSNRTO  SETA  &DTUO-46
         AGO   .TDDN
.SYSOUT  RCPSYSOU &SYSOUT,COPIES=&COPIES,FREE=&FREE,DEST=&DEST,        X
               FORMS=&FORMS
         AGO   .TDDN
.DUMMY   RCPDUMMY &DUMMY
         AGO   .TDDN
.QNAME   RCPQNAME &QNAME
         AGO   .TDDN
.DDN     RCPDDN &DDN&F&FILE
         AGO   .TUNIT
.DDNRT   RCPDDNRT &DDNRET
&DDNRTO  SETA  &DTUO-10
         AGO   .TUNIT
.UNIT   RCPUNIT &UNIT,&VOL
         AGO   .TVOLRET
.VOLRET  RCPVOLRT &VOLRET
&VOLRTO  SETA  &DTUO-8
         AGO   .TDSRGO
.DSORGRT RCPDSRGR
&DSRGRTO SETA  &DTUO-2
         AGO   .TLABEL
.LABEL   RCPLABEL &LABEL
         AGO   .TPSWD
.PASWORD RCPPSWD &PASWORD
         AGO   .TFORUSE
.FORUSER RCPFORUS &FORUSER
         AGO   .TTU
.TU      RCPTU &TU
         AGO   .TDISP
.DISP    RCPDISP &DISP
         AGO   .TSPACE
.SPACE   RCPSPACE &SPACE
         AGO   .TLRECL
.DCB     RCPDDCB LRECL=&LRECL,DEN=&DEN,RECFM=&RECFM,BLKSIZE=&BLKSIZE,  X
               DSORG=&DSORG,KEYLEN=&KEYLEN
         AGO .TDCBDSN
.DCBDSN  RCPDCBDS &DCBDSN
         AGO .TDCBDDN
.DCBDDN  RCPDCBDD &DCBDDN
         AGO .TFREE                                              TE7343
.FREE    RCPFREE  &FREE                                          TE7343
         AGO   .TPERM
.PERM    RCPPERM
         AGO   .TSPECI
.SPECIAL RCPSPEC &SPECIAL
.SVC99   ANOP
&DTUPO   SETA  &DTUPO-4
         SPACE
         MVI   &DYNP.TUP+&DTUPO,X'80'  SET HIGH ORDER BIT ON TEXT PTRS
         MVI   &DYNP.RBP,X'80'         SET HIGH ORDER BIT ON RB PTR
         RCPSR2 UNSAVE
&DTUPO   SETA  &DTUPO+4
         AIF   (NOT &DSECT).DYNA
         DROP  R1,R15                  DEACTIVATE ADDRESSABILITY
         LA    R14,4(R1)               POINT TO REQUEST BLOCK
.DYNA    DYNALLOC
         AIF   (NOT &DSECT).LTR
         USING &DYNP.RB,R14            SET UP ADDRESSABILITY
**       NOTE  R14 HAS RB ADDRESS, R15 HAS SVC 99 RETURN CODE        **
.LTR     AIF   ('&ERROR' EQ '').TDDTO
         LTR   R15,R15                 TEST RETURN CODE
         BNZ   &ERROR                  BRANCH IF NON ZERO
.TDDTO   AIF   ('&DDNTO' EQ '').RESERVE
&I       SETA  0
.DDNTOL  ANOP
&I       SETA  &I+1
         AIF   ('&DDNTO(&I)' EQ '').RESERVE
         AIF   ('&DDNTO(&I)'(1,1) EQ '(').DDNTOR
         MVC   &DDNTO(&I).(8),&DYNP.TU+&DDNRTO+2
         AGO   .DDNTOL
.DDNTOR  ANOP
&C       SETC  '&DDNTO(&I)'(2,K'&DDNTO(&I)-2)
         MVC   0(8,&C),&DYNP.TU+&DDNRTO+2
         AGO   .DDNTOL
.RESERVE AIF   (&DSECT).RESDS
         SPACE 1
***********************************************************************
**       RESERVE SPACE FOR DYNALLOC PARAMETER LIST                   **
***********************************************************************
         RCPDS
.SSP     ANOP
&DYNP.RBP DS   F                       SVC 99 REQ BLOCK POINTER
&DYNP.RB  DS   5F                      SVC 99 REQUEST BLOCK
&DYNP.TUP DS   CL&DTUPO                SPACE FOR TEXT POINTERS
         AIF   (&DTUO EQ 0).DTU21
&DYNP.TU  DS   CL&DTUO                 SPACE FOR TEXT UNITS
         AIF   (&DSNRTO EQ 0).TDDNRTO
&DSNRET  EQU   &DYNP.TU+&DSNRTO        OFFSET TO RETURNED DSN
.TDDNRTO AIF   ('&DDNRET' EQ '').DTU11
&DDNRET  EQU   &DYNP.TU+&DDNRTO        OFFSET TO RETURNED DDNAME
.DTU11   AIF   (&VOLRTO EQ 0).DTU12
&VOLRET  EQU   &DYNP.TU+&VOLRTO        OFFSET TO RETURNED VOLSER
.DTU12   AIF   (&DSRGRTO EQ 0).DTU10
&DSORGRT EQU   &DYNP.TU+&DSRGRTO       OFFSET TO RETURNED DSORG
         AGO   .DTU10
.DTU21   ANOP
&DYNP.TU  DS   0C                      NO SPACE NEEDED FOR TEXT UNITS
.DTU10   ANOP
&DYNP.LEN EQU  *-&DYNP.RBP             LENGTH OF SPACE USED
         AIF   (&DSECT).DSP
         RCPDS
         SPACE 3
         AGO   .EXIT
.RESDS   ANOP
         AIF   ('&DYNSP' EQ '').SP3
         DYNSPACE ADD
.SP3     SPACE
&DYNP.DS DSECT                         DSECT TO MAP SVC 99 DATA
         AGO   .SSP
.DSP     AIF   ('&MF(3)' EQ '').END1
&MF(3)   EQU   &DYNP.LEN               LENGTH OF AREA
.END1    ANOP
&SYSECT  CSECT
         SPACE 3
.EXIT    MEND
./       ADD   NAME=BFGINSTL
//CMDSBJB1 JOB (U32048,17F),GUY,CLASS=A,MSGCLASS=E,TYPRUN=HOLD
/*JOBPARM  L=999,BYTES=99999
//*
//*  COMMENTED OUT THE QUE ASSEMBLIES (SEE MEMBER CALLED $QUE IN THIS
//*  PDS)  ARNOLD CASINGHINO UPDATE 09/16/84
//*
//*
//*   CMDINSTL  VERSION 2.4   LAST UPDATED 11/16/82
//*
//*
//DMALLOC PROC  ASMLIB='SFTB.SP310#.SOURCE',     THE PDS YOU GOT
//         LINKLIB='SFTB.SP310#.LOAD',
//         LINKUNT=3380,
//         LINKVOL=SYS001
//DMALLOC EXEC  PGM=IEFBR14
//LINKLIB  DD DSN=&LINKLIB.,UNIT=&LINKUNT.,VOL=SER=&LINKVOL.,
//         DISP=(,CATLG),SPACE=(CYL,(5,1,28)),
//         DCB=(RECFM=U,BLKSIZE=6144)
//ASMLIB   DD DSN=&ASMLIB,DISP=SHR
//        PEND
//DMASM    PROC   MEMBER=,LNCT=55,
//         ASMLIB='SFTB.SP310#.SOURCE',
//         LINKLIB='SFTB.SP310#.LOAD'
//ASM EXEC PGM=ASMBLR,PARM=(LOAD,NODECK,'LINECNT=&LNCT.')
//SYSLIB   DD   DSN=&ASMLIB,DISP=SHR
//         DD   DSN=SYS1.HASPSRC,DISP=SHR
//         DD   DSN=SYS1.MACLIB,VOL=SER=ESARES,UNIT=DISK,DISP=SHR
//         DD   DSN=SYS1.AMODGEN,VOL=SER=ESADLB,UNIT=DISK,DISP=SHR
//SYSUT1  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT2  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT3  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSPRINT  DD  SYSOUT=*
//SYSLIN DD  DSN=&&SYSGO,UNIT=SYSDA,SPACE=(TRK,(90,50)),
//    DISP=(,PASS)
//SYSIN    DD  DSN=&ASMLIB.(&MEMBER.),DISP=SHR
//LKED EXEC PGM=IEWL,
//          PARM='XREF,LET,LIST,AC=1,SIZE=(140K,6400)'
//SYSLIN   DD   DSN=&&SYSGO,DISP=(OLD,DELETE)
//     DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=*
//     PEND
//ALLOC  EXEC DMALLOC
//ASMPR  EXEC DMASM,MEMBER=CMDPRINT
//DOCCMD1 EXEC  PGM=CMDPRINT,PARM='01072'
//STEPLIB  DD  DSN=SFTB.SP310#.LOAD,DISP=SHR
//SYSPRINT DD   SYSOUT=Z
//SYSUDUMP DD   SYSOUT=*
#$#
                    VERSION
             $DOC         .COMMAND SUB-SYSTEM -   (ADDIT DOCUMENTATION)
             $HELP        .COMMAND SUB-SYSTEM -   (TSO HELP MEMBER)
             $HINTS       .COMMAND SUB-SYSTEM -   (ADDIT INSTALL HINTS)
             $JCL         .COMMAND SUB-SYSTEM -   (JCL TO RUN CMD1)
             $MODS        .COMMAND SUB-SYSTEM -   (MVSMODS IEBCOPY)
             CMDDOCTN     .COMMAND SUB-SYSTEM -   (DOCUMENTATION)
             CMDDUMMY     .COMMAND SUB-SYSTEM -   (CMDDUMMY MODULE)
             CMDINSTL     .COMMAND SUB-SYSTEM -   (INSTALLATION JCL)
             CMDPRINT     .COMMAND SUB-SYSTEM -   (DOCUMENTATION PRINT)
             CMDSBCSC     .COMMAND SUB-SYSTEM -   (CROSS-SYSTEM CNTRL)
             CMDSBINT     .COMMAND SUB-SYSTEM -   (INIT AND MONITOR)
             CMDSBMON     .COMMAND SUB-SYSTEM -   (STANDALONE MONITOR)
             CMDSBSYS     .COMMAND SUB-SYSTEM -   (PROCESSOR)
             CMDSBTSO     .COMMAND SUB-SYSTEM -   (TSO FULL SCREEN MON)
             CMDTSO       .COMMAND SUB-SYSTEM -   (TSO DIRECTOR)
             CSCGA03D     .COMMAND SUB-SYSTEM -   (A - ACTIVITY MON.)
             CSCGE03D     .COMMAND SUB-SYSTEM -   (E - EXCEPTION MON.)
             CSCGF03D     .COMMAND SUB-SYSTEM -   (F - FRAME USE GRAPH)
             CSCGH03D     .COMMAND SUB-SYSTEM -   (H - HELP FOR GRAPH)
             CSCGI03D     .COMMAND SUB-SYSTEM -   (I - JES2 INIT DISP)
             CSCGJ03D     .COMMAND SUB-SYSTEM -   (J - JOB CPU GRAPH)
             CSCGO03D     .COMMAND SUB-SYSTEM -   (O - I/O ACTIVITY)
             CSCGQ03D     .COMMAND SUB-SYSTEM -   (Q - QUE)
             CSCGS03D     .COMMAND SUB-SYSTEM -   (S - SYS. IND. GRAPH)
             CSCGU03D     .COMMAND SUB-SYSTEM -   (U -DASD SPACE DISPL)
CSCSA03D     IEESA03D     .COMMAND SUB-SYSTEM -   (#N -  D ENQ P1)
CSCSB03D     IEESB03D     .COMMAND SUB-SYSTEM -   (#N -  D ENQ P2)
CSCSC03D     IEESC03D     .COMMAND SUB-SYSTEM -   (#L -  D LINES)
CSCSD03D     IEESD03D     .COMMAND SUB-SYSTEM -   (#D -  COREZAP)
CSCSE03D     IEESE03D     .COMMAND SUB-SYSTEM -   (#A -  ASCB INFO)
CSCSF03D     IEESF03D     .COMMAND SUB-SYSTEM -   (#F -  D FRAMES)
CSCSG03D     IEESG03D     .COMMAND SUB-SYSTEM -   (#R -  D ALLOC)
CSCSH03D     IEESH03D     .COMMAND SUB-SYSTEM -   (#S -  D LPA)
CSCSI03D     IEESI03D     .COMMAND SUB-SYSTEM -   (#V -  D DEVICE)
CSCSJ03D     IEESJ03D     .COMMAND SUB-SYSTEM -   (#I -  D PAGES)
CSCSK03D     IEESK03D     .COMMAND SUB-SYSTEM -   (#C -  CALCULATOR)
CSCSL03D     IEESL03D     .COMMAND SUB-SYSTEM -   (#J -  D A)
CSCSZ03D     IEESZ03D     .COMMAND SUB-SYSTEM -   (#Z -  D A)
CSCSM03D     IEESM03D     .COMMAND SUB-SYSTEM -   (#H -  HELP)
CSCSN03D     IEESN03D     .COMMAND SUB-SYSTEM -   (#T -  D TIOT)
CSCSO03D     IEESO03D     .COMMAND SUB-SYSTEM -   (#M -  TSO SEND)
CSCSP0ED     IEESP03D     .COMMAND SUB-SYSTEM -   (#P -  D SU)
CSCSQ03D     IEESQ03D     .COMMAND SUB-SYSTEM -   (#Q -  ANALYZE ENQ)
CSCSR03D     IEESR03D     .COMMAND SUB-SYSTEM -   (#O -  I/O PENDING)
CSCSS03D     IEESS03D     .COMMAND SUB-SYSTEM -   (#E -  EXECUTE)
CSCZA03D     IEEZA03D     .COMMAND SUB-SYSTEM -   (##A -  ACTIVITY MON.)
CSCZB03D     IEEZB03D     .COMMAND SUB-SYSTEM -   (##B -  DEVICE MON.)
CSCZC03D     IEEZC03D     .COMMAND SUB-SYSTEM -   (##C -  CHANNEL MON.)
CSCZJ03D     IEEZJ03D     .COMMAND SUB-SYSTEM -   (##J -  JOB MON.)
CSCZP03D     IEEZP03D     .COMMAND SUB-SYSTEM -   (##P -  PAGING MON.)
CSCZS03D     IEEZS03D     .COMMAND SUB-SYSTEM -   (##S -  SYSIND MON.)
             NSEGF03D     .CMD SUB-SYS (NONSE) -  (F - FRAME USE GRAPH)
             NSEGJ03D     .CMD SUB-SYS (NONSE) -  (J - JOB CPU GRAPH)
             NSEGS03D     .CMD SUB-SYS (NONSE) -  (S - SYS. IND. GRAPH)
             NSESE03D     .CMD SUB-SYS (NONSE) -  (#A -  ASCB INFO)
             NSESJ03D     .CMD SUB-SYS (NONSE) -  (#I -  D PAGES)
             NSESL03D     .CMD SUB-SYS (NONSE) -  (#J -  D A)
             NSEZJ03D     .CMD SUB-SYS (NONSE) -  (##J -  JOB MON.)
             NSEZS03D     .CMD SUB-SYS (NONSE) -  (##S -  SYSIND MON.)
#$#
             MACROS VERSION  FOR CMDSBMON
             ALLOC    1.0 .MACRO NEEDED FOR CMDSBMON
             DYNSPACE 1.0 .MACRO NEEDED FOR CMDSBMON
             FREE     1.0 .MACRO NEEDED FOR CMDSBMON
             RCPBFRGS 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPBTU   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPBTU2  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPCKID  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDDN   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDDNRT 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDEBUG 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDFPL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDINC  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDISP  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDS    1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSECT 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSN   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSNPD 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSNRT 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSRGR 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDUMMY 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPENDD  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFDDN  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFDISP 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFDSN  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFHOLD 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFORUS 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFREE  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPIOPL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLINK  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOAD  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOCSW 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOCS1 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOCS2 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPMCA   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPNTU   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPERM  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPPL   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPROC  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPSWD  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPQNAME 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPRNGE  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSPACE 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSPEC  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSR2   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSSREQ 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSUBL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSYSOU 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTU    1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTUBFR 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTXTL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTYPE  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPUNALC 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPUNIT  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPVCHAR 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPVOLRT 1.0 .MACRO NEEDED FOR CMDSBMON
             S99FAIL  1.0 .MACRO NEEDED FOR CMDSBMON
#$#
                   VERSION
             CSCGQQ00 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - QUEUECMN)
             CSCGQQ01 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - QUEUE)
             CSCGQQ02 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - ALLOCATE)
             CSCGQQ03 1.1 .CMD SUB-SYSTEM -       (Q - QCMD - CKPT)
             CSCGQQ04 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - DDNAME)
             CSCGQQ05 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - DISPLAY)
             CSCGQQ05 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - DISPLAY)
             CSCGQQ06 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - FINDJOB)
             CSCGQQ07 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - FORMAT)
             CSCGQQ08 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - HELP)
             CSCGQQ09 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - HEXBLK)
             CSCGQQ10 1.1 .CMD SUB-SYSTEM -       (Q - QCMD - INIT)
             CSCGQQ11 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - JCL)
             CSCGQQ12 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - JLOG)
             CSCGQQ13 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - JMSG)
             CSCGQQ14 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - LIST)
             CSCGQQ15 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - LISTDS)
             CSCGQQ16 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - PARSE)
             CSCGQQ17 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - READSPC)
             CSCGQQ18 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - REPOS)
             CSCGQQ19 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - SAVE)
             CSCGQQ20 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - SEARCH)
             CSCGQQ21 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - SYSLOG)
             CSCGQQ22 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - XDS)
#$#
                   VERSION
             MACROS VERSION  FOR THE QUE COMMAND
             $JQT     1.0 .MACRO NEEDED FOR QUEUE
             QCLNK    1.0 .MACRO NEEDED FOR QUEUE
             QCOMMON  1.1 .MACRO NEEDED FOR QUEUE
             QSTART   1.1 .MACRO NEEDED FOR QUEUE
             QSTOP    1.0 .MACRO NEEDED FOR QUEUE
             QTILT    1.0 .MACRO NEEDED FOR QUEUE
/*
//DOCCMD2 EXEC  PGM=CMDPRINT,PARM='01072'
//STEPLIB  DD  DSN=SFTB.SP310#.LOAD,DISP=SHR
//SYSPRINT DD   SYSOUT=Z
//SYSUDUMP DD   SYSOUT=*
//SYSIN    DD   DSN=SFTB.SP310#.SOURCE(CMDDOCTN),DISP=SHR
//UPD1    EXEC  PGM=IEBUPDTE,PARM=NEW
//SYSPRINT DD SYSOUT=*
//SYSUT1   DD DSN=SYS2.PROCLIB,DISP=SHR
//SYSUT2   DD DSN=SYS2.PROCLIB,DISP=SHR
//SYSIN  DD  DATA
./ ADD NAME=CMD1                           CHANGE THIS CARD TO ./
//CMD1   PROC  A=ASE0,
//             B='$',
//             C=CSK0,
//             D=DSD0,
//             E=ESS0,
//             F=FSF0,
//             G='$',
//             H=HSM0,
//             I=ISJ0,
//             J=JSL0,
//             K='$',
//             L=LSC0,
//             M=MSO0,
//             N=NSA0,
//             O=OSR0,
//             P=PSP0,
//             Q=QSQ0,
//             R=RSG0,
//             S=SSH0,
//             T=TSN0,
//             U='$',
//             V=VSI0,
//             W='$',
//             X='$',
//             Y='$',
//             Z=ZSZ0
//CMD1  EXEC PGM=CMDSBINT,TIME=1440,DPRTY=(15,10)
// PARM='&A&B&C&D&E&F&G&H&I&J&K&L&M&N&O&P&Q&R&S&T&U&V&W&X&Y&Z'
//SYSUDUMP  DD  SYSOUT=A
//CSC#ASYS  DD  DUMMY
//CSC#BSYS  DD  DUMMY
//CSC#CSYS  DD  DUMMY
//CSCDATA   DD  DSN=SYS1.SYSTEM.CMDSBSYS.CSCDATA,DISP=SHR
//*
//*      WHERE  -    FOR CSC#.... REPLACE .... WITH SMF SYSID OF ONE
//*                  OF THE SYSTEMS USING CROSS-SYSTEM COMMANDS.
//*                  AS MANY CSC#.... DD CARDS AS NECESSARY MAY EXIST.
//*
./ ADD NAME=CMDSBMON                          CHANGE THIS CARD TO ./
//CMDSBMON  PROC  U=XXX
//CMDSBMON  EXEC  PGM=CMDSBMON,PARM='&U.',REGION=8000K
//SYSUDUMP  DD    SYSOUT=A
//CMDLOG    DD    SYSOUT=A
//CSCDATA  DD  DSN=SYS1.SYSTEM.CMDSBSYS.CSCDATA,DISP=SHR
//*   WHERE  XXX  IS THE 3270 UNIT ADDRESS
/*
//*
//*
//*     END OF CMD SUB-SYSTEM INSTALL JOB 1
//*
//*
//CMDSBJB2 JOB (U32048,17F),GUY,CLASS=A,MSGCLASS=E,TYPRUN=HOLD
/*JOBPARM  L=999,BYTES=99999
//DMASM    PROC   MEMBER=,LNCT=55,
//         ASMLIB='SFTB.SP310#.SOURCE',
//         LINKLIB='SFTB.SP310#.LOAD'
//ASM EXEC PGM=IEV90,PARM=(LOAD,NODECK,'LINECNT=&LNCT.'),
//        REGION=4096K
//SYSLIB   DD   DSN=&ASMLIB,DISP=SHR
//         DD   DSN=SYS1.HASPSRC,DISP=SHR
//         DD   DSN=SYS1.MACLIB,VOL=SER=ESARES,UNIT=DISK,DISP=SHR
//         DD   DSN=SYS1.AMODGEN,VOL=SER=ESADLB,UNIT=DISK,DISP=SHR
//SYSUT1  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT2  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT3  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSPRINT  DD  SYSOUT=*
//SYSLIN DD  DSN=&&SYSGO,UNIT=SYSDA,SPACE=(TRK,(90,50)),
//    DISP=(,PASS),DCB=BLKSIZE=400
//SYSIN    DD  DSN=&ASMLIB.(&MEMBER.),DISP=SHR
//DMLINK EXEC PGM=IEWL,
//        REGION=4096K,
//          PARM='XREF,LET,LIST,AC=1'
//SYSLIN   DD   DSN=&&SYSGO,DISP=(OLD,DELETE)
//     DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=*
//     PEND
//DMLINK   PROC   MEMBER=,
//         LINKLIB='SFTB.SP310#.LOAD'
//DMLINK EXEC PGM=IEWL,
//        REGION=4096K,
//          PARM='XREF,LET,LIST,AC=1'
//SYSLIN   DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=*
//     PEND
//ASM00 EXEC DMASM,MEMBER=CMDDUMMY
//ASM01 EXEC DMASM,MEMBER=CMDSBCSC
//ASM02 EXEC DMASM,MEMBER=CMDSBINT
//ASM03 EXEC DMASM,MEMBER=CMDSBSYS
//ASM04 EXEC DMASM,MEMBER=CMDTSO
//ASM05 EXEC DMASM,MEMBER=CMDSBTSO
//ASM05A EXEC DMASM,MEMBER=CMDSBMON
//ASM06 EXEC DMASM,MEMBER=CSCSB03D
//ASM07 EXEC DMASM,MEMBER=CSCSA03D
//DMLINK.SYSIN DD *
 INCLUDE SYSLIB(CSCSB03D)
 ENTRY IEESA03D
/*
//ASM08 EXEC DMASM,MEMBER=CSCSC03D
//ASM09 EXEC DMASM,MEMBER=CSCSD03D
//ASM10 EXEC DMASM,MEMBER=CSCSE03D
//ASM11 EXEC DMASM,MEMBER=CSCSF03D
//ASM12 EXEC DMASM,MEMBER=CSCSG03D
//ASM13 EXEC DMASM,MEMBER=CSCSH03D
//ASM14 EXEC DMASM,MEMBER=CSCSI03D
//ASM15 EXEC DMASM,MEMBER=CSCSJ03D
//ASM16 EXEC DMASM,MEMBER=CSCSK03D
//ASM17 EXEC DMASM,MEMBER=CSCSL03D
//ASM17A EXEC DMASM,MEMBER=CSCSZ03D
//ASM18 EXEC DMASM,MEMBER=CSCSM03D
//ASM19 EXEC DMASM,MEMBER=CSCSN03D
//ASM20 EXEC DMASM,MEMBER=CSCSO03D
//ASM21 EXEC DMASM,MEMBER=CSCSP03D
//ASM22 EXEC DMASM,MEMBER=CSCSQ03D
//ASM23 EXEC DMASM,MEMBER=CSCSR03D
//ASM24 EXEC DMASM,MEMBER=CSCSS03D
//ASM25 EXEC DMASM,MEMBER=CSCZB03D
//ASM26 EXEC DMASM,MEMBER=CSCZC03D
//ASM27 EXEC DMASM,MEMBER=CSCZJ03D
//ASM28 EXEC DMASM,MEMBER=CSCZP03D
//ASM29 EXEC DMASM,MEMBER=CSCZS03D
//ASM30 EXEC DMASM,MEMBER=CSCGA03D
//ASM31 EXEC DMASM,MEMBER=CSCGE03D
//ASM32 EXEC DMASM,MEMBER=CSCGF03D
//ASM33 EXEC DMASM,MEMBER=CSCGH03D
//ASM34 EXEC DMASM,MEMBER=CSCGJ03D
//ASM35 EXEC DMASM,MEMBER=CSCGO03D
//ASM36 EXEC DMASM,MEMBER=CSCGS03D
//*ASM37 EXEC DM*ASM,MEMBER=CSCGQQ00
//*ASM38 EXEC DM*ASM,MEMBER=CSCGQQ01
//*ASM39 EXEC DM*ASM,MEMBER=CSCGQQ02
//*ASM40 EXEC DM*ASM,MEMBER=CSCGQQ03
//*ASM41 EXEC DM*ASM,MEMBER=CSCGQQ04
//*ASM42 EXEC DM*ASM,MEMBER=CSCGQQ05
//*ASM43 EXEC DM*ASM,MEMBER=CSCGQQ06
//*ASM44 EXEC DM*ASM,MEMBER=CSCGQQ07
//*ASM45 EXEC DM*ASM,MEMBER=CSCGQQ08
//*ASM46 EXEC DM*ASM,MEMBER=CSCGQQ09
//*ASM47 EXEC DM*ASM,MEMBER=CSCGQQ10
//*ASM48 EXEC DM*ASM,MEMBER=CSCGQQ11
//*ASM49 EXEC DM*ASM,MEMBER=CSCGQQ12
//*ASM50 EXEC DM*ASM,MEMBER=CSCGQQ13
//*ASM51 EXEC DM*ASM,MEMBER=CSCGQQ14
//*ASM52 EXEC DM*ASM,MEMBER=CSCGQQ15
//*ASM53 EXEC DM*ASM,MEMBER=CSCGQQ16
//*ASM54 EXEC DM*ASM,MEMBER=CSCGQQ17
//*ASM55 EXEC DM**ASM,MEMBER=CSCGQQ18
//*ASM56 EXEC DM*ASM,MEMBER=CSCGQQ19
//*ASM57 EXEC DM*ASM,MEMBER=CSCGQQ20
//*ASM58 EXEC DM*ASM,MEMBER=CSCGQQ21
//*ASM59 EXEC DM*ASM,MEMBER=CSCGQQ22
//*LNK60 EXEC DMLINK,MEMBER=CSCGQ03D
//*DMLINK.SYSIN DD *
//*  INCLUDE SYSLIB(CSCGQQ01)
//*  INCLUDE SYSLIB(CSCGQQ02)
//*  INCLUDE SYSLIB(CSCGQQ03)
//*  INCLUDE SYSLIB(CSCGQQ04)
//*  INCLUDE SYSLIB(CSCGQQ05)
//*  INCLUDE SYSLIB(CSCGQQ06)
//*  INCLUDE SYSLIB(CSCGQQ07)
//*  INCLUDE SYSLIB(CSCGQQ08)
//*  INCLUDE SYSLIB(CSCGQQ09)
//*  INCLUDE SYSLIB(CSCGQQ10)
//*  INCLUDE SYSLIB(CSCGQQ11)
//*  INCLUDE SYSLIB(CSCGQQ12)
//*  INCLUDE SYSLIB(CSCGQQ13)
//*  INCLUDE SYSLIB(CSCGQQ14)
//*  INCLUDE SYSLIB(CSCGQQ15)
//*  INCLUDE SYSLIB(CSCGQQ16)
//*  INCLUDE SYSLIB(CSCGQQ17)
//*  INCLUDE SYSLIB(CSCGQQ18)
//*  INCLUDE SYSLIB(CSCGQQ19)
//*  INCLUDE SYSLIB(CSCGQQ20)
//*  INCLUDE SYSLIB(CSCGQQ21)
//*  INCLUDE SYSLIB(CSCGQQ22)
//*  ENTRY QUEUE
//* /*
//ASM61 EXEC DMASM,MEMBER=CSCZA03D
//ASM62 EXEC DMASM,MEMBER=CSCGI03D
//ASM63 EXEC DMASM,MEMBER=CSCGU03D
//*
//*
//*     END OF CMD SUB-SYSTEM INSTALL JOB 2
//*
//*
//CMDSBJB4 JOB (U32048,17F),GUY,CLASS=A,MSGCLASS=E,TYPRUN=HOLD
//DMCOPY   PROC   LINKLIB='SFTB.SP310#.LOAD',
//         TARGLIB=
//DMCOPY EXEC PGM=IEBCOPY
//SYSPRINT  DD  SYSOUT=*
//SYSUT1  DD DSN=&LINKLIB.,DISP=SHR
//SYSUT2  DD DSN=&TARGLIB.,DISP=SHR
//SYSUT3 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSUT4 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//     PEND
//COPY2 EXEC DMCOPY,TARGLIB='SYS1.ESA.BFGLPA'
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CMDDUMMY,,R))
 S M=((CSCSA03D,IEESA03D,R))
 S M=((CSCSC03D,IEESC03D,R))
 S M=((CSCSD03D,IEESD03D,R))
 S M=((CSCSE03D,IEESE03D,R))
 S M=((CSCSF03D,IEESF03D,R))
 S M=((CSCSG03D,IEESG03D,R))
 S M=((CSCSH03D,IEESH03D,R))
 S M=((CSCSI03D,IEESI03D,R))
 S M=((CSCSJ03D,IEESJ03D,R))
 S M=((CSCSK03D,IEESK03D,R))
 S M=((CSCSL03D,IEESL03D,R))
 S M=((CSCSM03D,IEESM03D,R))
 S M=((CSCSN03D,IEESN03D,R))
 S M=((CSCSO03D,IEESO03D,R))
 S M=((CSCSP03D,IEESP03D,R))
 S M=((CSCSQ03D,IEESQ03D,R))
 S M=((CSCSR03D,IEESR03D,R))
 S M=((CSCSS03D,IEESS03D,R))
 S M=((CSCZA03D,IEEZA03D,R))
 S M=((CSCZB03D,IEEZB03D,R))
 S M=((CSCZC03D,IEEZC03D,R))
 S M=((CSCZJ03D,IEEZJ03D,R))
 S M=((CSCZP03D,IEEZP03D,R))
 S M=((CSCZS03D,IEEZS03D,R))
/*
./       ADD   NAME=BFGINST1
//LANEJ     JOB LANEJ,TECHSUPPORT,
//*            USER=IBMUSER,
//         NOTIFY=LANEJ,
//         REGION=6M,
//             MSGLEVEL=(1,1),MSGCLASS=X,
//             CLASS=Z
//*JOBLIB DD DSN=LANE.TECTSG.LOAD,DISP=SHR
//* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
//*   THIS JCL IS IN:        LANEJ.V325.FILE261.PDS(BFGINST1)
//* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
//L0 OUTPUT LINECT=0,DEFAULT=YES
//DMASM    PROC   MEMBER=,LNCT=80,
//         ASMLIB='LANEJ.V325.FILE261.PDS',
//         LINKLIB='LANEJ.TECTSG.LOAD'
//ASM EXEC PGM=IEV90,PARM=(LOAD,NODECK,'LINECNT=&LNCT.'),
//        REGION=4096K
//SYSLIB   DD   DSN=&ASMLIB,DISP=SHR
//*        DD   DSN=SYS1.HASPSRC,DISP=SHR
//         DD   DSN=SYS1.MACLIB,DISP=SHR
//         DD   DSN=SYS1.AMODGEN,DISP=SHR
//SYSUT1  DD  UNIT=SYSVIO,SPACE=(TRK,(90,50))
//SYSUT2  DD  UNIT=SYSVIO,SPACE=(TRK,(90,50))
//SYSUT3  DD  UNIT=SYSVIO,SPACE=(TRK,(90,50))
//SYSPRINT  DD  SYSOUT=*,FCB=8,OUTPUT=*.L0
//SYSLIN DD  DSN=&&SYSGO,UNIT=SYSVIO,SPACE=(TRK,(90,50)),
//    DISP=(,PASS),DCB=BLKSIZE=400
//SYSIN    DD  DSN=&ASMLIB.(&MEMBER.),DISP=SHR
//DMLINK EXEC PGM=IEWL,
//        REGION=4096K,
//          PARM='XREF,LET,LIST,AC=1'
//SYSLIN   DD   DSN=&&SYSGO,DISP=(OLD,DELETE)
//     DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSVIO,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=*
//     PEND
//DMLINK   PROC   MEMBER=,
//         LINKLIB='LANEJ.TECTSG.LOAD'
//DMLINK EXEC PGM=IEWL,
//        REGION=4096K,
//          PARM='XREF,LET,LIST,AC=1'
//SYSLIN   DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSVIO,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=*
//     PEND
//ASM17 EXEC DMASM,MEMBER=CSCSJ03D
//ASM00 EXEC DMASM,MEMBER=CMDDUMMY
//ASM01 EXEC DMASM,MEMBER=CMDSBCSC
//ASM02 EXEC DMASM,MEMBER=CMDSBINT
//ASM03 EXEC DMASM,MEMBER=CMDSBSYS
//ASM04 EXEC DMASM,MEMBER=CMDTSO
//ASM05 EXEC DMASM,MEMBER=CMDSBTSO
//ASM05A EXEC DMASM,MEMBER=CMDSBMON
//ASM06 EXEC DMASM,MEMBER=CSCSB03D
//ASM07 EXEC DMASM,MEMBER=CSCSA03D
//DMLINK.SYSIN DD *
 INCLUDE SYSLIB(CSCSB03D)
 ENTRY IEESA03D
/*
//ASM08 EXEC DMASM,MEMBER=CSCSC03D
//ASM09 EXEC DMASM,MEMBER=CSCSD03D
//ASM10 EXEC DMASM,MEMBER=CSCSE03D
//ASM11 EXEC DMASM,MEMBER=CSCSF03D
//ASM12 EXEC DMASM,MEMBER=CSCSG03D
//ASM13 EXEC DMASM,MEMBER=CSCSH03D
//ASM14 EXEC DMASM,MEMBER=CSCSI03D
//ASM15 EXEC DMASM,MEMBER=CSCSJ03D
//ASM16 EXEC DMASM,MEMBER=CSCSK03D
//ASM17A EXEC DMASM,MEMBER=CSCSZ03D
//ASM18 EXEC DMASM,MEMBER=CSCSM03D
//ASM19 EXEC DMASM,MEMBER=CSCSN03D
//ASM20 EXEC DMASM,MEMBER=CSCSO03D
//ASM21 EXEC DMASM,MEMBER=CSCSP03D
//ASM22 EXEC DMASM,MEMBER=CSCSQ03D
//ASM23 EXEC DMASM,MEMBER=CSCSR03D
//ASM24 EXEC DMASM,MEMBER=CSCSS03D
//ASM25 EXEC DMASM,MEMBER=CSCZB03D
//ASM26 EXEC DMASM,MEMBER=CSCZC03D
//ASM27 EXEC DMASM,MEMBER=CSCZJ03D
//ASM28 EXEC DMASM,MEMBER=CSCZP03D
//ASM29 EXEC DMASM,MEMBER=CSCZS03D
//ASM30 EXEC DMASM,MEMBER=CSCGA03D
//ASM31 EXEC DMASM,MEMBER=CSCGE03D
//ASM32 EXEC DMASM,MEMBER=CSCGF03D
//ASM33 EXEC DMASM,MEMBER=CSCGH03D
//ASM34 EXEC DMASM,MEMBER=CSCGJ03D
//ASM35 EXEC DMASM,MEMBER=CSCGO03D
//ASM36 EXEC DMASM,MEMBER=CSCGS03D
//*ASM37 EXEC DM*ASM,MEMBER=CSCGQQ00
//*ASM38 EXEC DM*ASM,MEMBER=CSCGQQ01
//*ASM39 EXEC DM*ASM,MEMBER=CSCGQQ02
//*ASM40 EXEC DM*ASM,MEMBER=CSCGQQ03
//*ASM41 EXEC DM*ASM,MEMBER=CSCGQQ04
//*ASM42 EXEC DM*ASM,MEMBER=CSCGQQ05
//*ASM43 EXEC DM*ASM,MEMBER=CSCGQQ06
//*ASM44 EXEC DM*ASM,MEMBER=CSCGQQ07
//*ASM45 EXEC DM*ASM,MEMBER=CSCGQQ08
//*ASM46 EXEC DM*ASM,MEMBER=CSCGQQ09
//*ASM47 EXEC DM*ASM,MEMBER=CSCGQQ10
//*ASM48 EXEC DM*ASM,MEMBER=CSCGQQ11
//*ASM49 EXEC DM*ASM,MEMBER=CSCGQQ12
//*ASM50 EXEC DM*ASM,MEMBER=CSCGQQ13
//*ASM51 EXEC DM*ASM,MEMBER=CSCGQQ14
//*ASM52 EXEC DM*ASM,MEMBER=CSCGQQ15
//*ASM53 EXEC DM*ASM,MEMBER=CSCGQQ16
//*ASM54 EXEC DM*ASM,MEMBER=CSCGQQ17
//*ASM55 EXEC DM**ASM,MEMBER=CSCGQQ18
//*ASM56 EXEC DM*ASM,MEMBER=CSCGQQ19
//*ASM57 EXEC DM*ASM,MEMBER=CSCGQQ20
//*ASM58 EXEC DM*ASM,MEMBER=CSCGQQ21
//*ASM59 EXEC DM*ASM,MEMBER=CSCGQQ22
//*LNK60 EXEC DMLINK,MEMBER=CSCGQ03D
//*DMLINK.SYSIN DD *
//*  INCLUDE SYSLIB(CSCGQQ01)
//*  INCLUDE SYSLIB(CSCGQQ02)
//*  INCLUDE SYSLIB(CSCGQQ03)
//*  INCLUDE SYSLIB(CSCGQQ04)
//*  INCLUDE SYSLIB(CSCGQQ05)
//*  INCLUDE SYSLIB(CSCGQQ06)
//*  INCLUDE SYSLIB(CSCGQQ07)
//*  INCLUDE SYSLIB(CSCGQQ08)
//*  INCLUDE SYSLIB(CSCGQQ09)
//*  INCLUDE SYSLIB(CSCGQQ10)
//*  INCLUDE SYSLIB(CSCGQQ11)
//*  INCLUDE SYSLIB(CSCGQQ12)
//*  INCLUDE SYSLIB(CSCGQQ13)
//*  INCLUDE SYSLIB(CSCGQQ14)
//*  INCLUDE SYSLIB(CSCGQQ15)
//*  INCLUDE SYSLIB(CSCGQQ16)
//*  INCLUDE SYSLIB(CSCGQQ17)
//*  INCLUDE SYSLIB(CSCGQQ18)
//*  INCLUDE SYSLIB(CSCGQQ19)
//*  INCLUDE SYSLIB(CSCGQQ20)
//*  INCLUDE SYSLIB(CSCGQQ21)
//*  INCLUDE SYSLIB(CSCGQQ22)
//*  ENTRY QUEUE
//* /*
//ASM61 EXEC DMASM,MEMBER=CSCZA03D
//ASM62 EXEC DMASM,MEMBER=CSCGI03D
//ASM63 EXEC DMASM,MEMBER=CSCGU03D
./       ADD   NAME=BFGINST2
//CMDSBJB4 JOB (U32048,17F),GUY,CLASS=A,MSGCLASS=T
//DMCOPY   PROC   LINKLIB='SFTB.SP310#.LOAD',
//         TARGLIB=
//DMCOPY EXEC PGM=IEBCOPY
//SYSPRINT  DD  SYSOUT=*
//SYSUT1  DD DSN=&LINKLIB.,DISP=SHR
//SYSUT2  DD DSN=&TARGLIB.,DISP=SHR
//SYSUT3 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSUT4 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//     PEND
//COPY2 EXEC DMCOPY,TARGLIB='SYS1.ESA.BFGLPA'
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CSCSJ03D,IEESJ03D,R))
/*
./       ADD   NAME=CMDDOCTN
#$#



















                      COMMAND  SUB-SYSTEM  COMMANDS
                  --------------------------------------





                     UPDATED ON -   DEC 30, 1981


                     VERSION -      2.5


                     WRITTEN BY -   A. R. MAGNUSON

                     UPDATED BY -   A. CASINGHINO
#$#



















                      COMMAND  SUB-SYSTEM  COMMANDS
                  --------------------------------------





                     UPDATED ON -   DEC 30, 1981


                     VERSION -      2.5


                     WRITTEN BY -   A. R. MAGNUSON

                     UPDATED BY  -  A. CASINGHINO
#$#

         COMMAND SUB-SYSTEM  -        BASIC OPERATION FLOW
-----------------------------------------------------------------------








  I------------I         I------------I            SSCVT CHAIN BUILT BY
  I    CVT     I         I   JESCT    I            NIP FROM 4 BYTE
  I  +X'128'   I-------->I   +X'18'   I---------/  NAMES IN SUBSYS NAME
  I            I         I            I       /    TABLE.
  I------------I         I------------I     /      CSECT -   IEFJESNM
                                          /        MODULE -  IEEVIPL
          /-----------------------------/
        /
      /
    /  I------------I         I------------I         I------------I
  /    I   SSCVT    I         I   SSCVT    I         I   SSCVT    I
/----->I  +X'04'    I-------->I   +X'04'   I-------->I   +X'04'   I--->
       I   'JES2'   I         I   'MSTR'   I         I   'CMD1'   I
       I            I         I            I         I   +X'16'   I---/
       I------------I         I------------I         I------------I /
                                                                  /
                                                                /
          /---------------------------------------------------/
        /
      /
    /  I-----------------------I     SSVT FOR CMD1 IS BUILT BY CMDSBINT
  /    I         SSVT          I     AT CMD1 START UP TIME.
/----->I                       I     CMDSBINT ISSUES GETMAIN FOR SSVT
       I +0   RESERVED         I     AND INITIALIZES IT.
       I +2   NO. OF FUNCTIONS I
       I +4   FUNCTION MATRIX  I
       I      (256 BYTES)      I
       I +260 CMDDUMMY ADDR    I
       I +264 CMD1 WORK AREA   I
       I-----------------------I
#$#


       I-----------------------I     GETMAIN SSVT.
       I      CMDSBINT         I     INITIALIZE SSVT.
       I-----------------------I     LOAD CMDDUMMY.
       I                       I     LOAD CMDSBSYS.
       I   INITIALIZATION      I     OVERLAY CMDDUMMY WITH CMDSBSYS.
       I                       I     ATTACH CMDSBCSC IF NECESSARY.
       I                       I     LOAD ALL COMMAND MODULES AND BUILD
       I                       I     CMD TABLE FOR USE BY CMDSBSYS.
       I                       I     STORE SSVT IN SSCVT TO ACTIVATE.
       I-----------------------I
       I                       I
       I                       I     HANDLE ALL ## COMMANDS.
       I   ## CMD MONITOR      I     STIMER WAIT IF ISSUED UNDER
       I                       I     MASTER SCHEDULER COULD LOCK OUT
       I                       I     CONSOLES.
       I-----------------------I




       I-----------------------I     READ CSCDATA DATA SET.
       I      CMDSBCSC         I     IF COMMAND, VALIDATE COMMAND AND
       I-----------------------I     WRITE IT TO CSCDATA DAT SET.
       I                       I     IF EXECUTE, LOAD, CHANGE WTO TO
       I                       I     BRANCH SEQUENCE TO SAVE OUTPUT.
       I                       I     BRANCH ENTER COMMAND MODULE.
       I  CROSS SYSTEM CONTROL I     WRITE CSCDATA DATA SET WITH
       I                       I     COMMAND OUTPUT.
       I                       I     IF OUTPUT, ISSUE WTO FOR ALL MSGS.
       I                       I     WRITE CSCDATA DATA SET TO CLEAR
       I                       I     AND ALLOW NEXT COMMAND.
       I-----------------------I




       I-----------------------I
       I      CMDSBSYS         I
       I-----------------------I
       I                       I     ENTERED FROM IEFJSREQ FOR ALL
       I   COMMAND PROCESSOR   I     COMMANDS.  OPERATES UNDER MASTER
       I                       I     SCHEDULER ADDRESS SPACE.
       I                       I     VALIDATE COMMAND.  IF NOT # OR ##
       I                       I     INDICATE COMMAND NOT PROCESSED IN
       I                       I     SSIB AND RETURN TO MASTER SCHEDLR.
       I                       I     IF ## COMMAND,  MOVE COMMAND TO
       I                       I     MONITOR CMD COMMUNICATION AREA.
       I                       I     IF CROSS SYSTEM COMMAND, MOVE
       I                       I     COMMAND TO CROSS SYSTEM CMD
       I                       I     COMMUNICATION AREA.
       I                       I     INDICATE COMMAND PROCESSED IN
       I                       I     SSIB AND RETURN TO MASTER SCHEDLR.
       I                       I     IF # COMMAND,  LOAD COMMAND MODULE
       I                       I     ADDR FROM CMD TABLE AND BRANCH.
       I-----------------------I
#$#
         CMD SUB-SYSTEM INSTALLATION



         1.  ASSEMBLE AND LINK EACH COMMAND MODULE INTO SYS1.LPALIB,
             OR SYS1.LINKLIB IF YOU PLAN TO MLPA THEM.
             NOTE THAT IEESA03D AND IEESB03D MUST BE LINKEDITED
             TOGETHER AS IEESA03D.


         2.  ASSEMBLE AND LINK CMDSBINT,CMDSBSYS, AND CMDSBCSC INTO
             SYS1.LINKLIB OR ANY LNKLSTNN LIBRARY YOU WISH.


         3.  ASSEMBLE AND LINK A DUMMY MODULE CALLED  CMDDUMMY  INTO
             SYS1.LPALIB, OR SYS1.LINKLIB IF YOU WANT TO MLPA IT.
             CMDDUMMY MUST BE AT LEAST 2048 BYTES LONG AND MUST BE
             SPECIFIED IN AN IEAFIXNN MEMBER OF PARMLIB TO CAUSE
             CMDDUMMY TO BE FIXED IN LOW CORE.
             AT SUB-SYSTEM INITIALIZATION CMDDUMMY IS OVERLAID IN LOW
             CORE WITH MODULE CMDSBSYS,  BY CMDSBINT THE COMMAND
             SUB-SYSTEM INITIALIZATION ROUTINE.


         4.  CREATE A PROC CALLED  CMD1  AND PUT IT IN SYS1.PROCLIB.

         //CMD1   PROC  A=ASE0,
         //             B='$',
         //             C=CSK0,
         //             D=DSD0,
         //             E=ESS0,
         //             F=FSF0,
         //             G='$',
         //             H=HSM0,
         //             I=ISJ0,
         //             J=JSL0,
         //             K='$',
         //             L=LSC0,
         //             M=MSO0,
         //             N=NSA0,
         //             O=OSR0,
         //             P=PSP0,
         //             Q=QSQ0,
         //             R=RSG0,
         //             S=SSH0,
         //             T=TSN0,
         //             U='$',
         //             V=VSI0,
         //             W='$',
         //             X='$',
         //             Y='$',
         //             Z='ZSZ0'
         //CMD1  EXEC PGM=CMDSBINT,TIME=1440,DPRTY=(15,10)
         // PARM='&A&B&C&D&E&F&G&H&I&J&K&L&M&N&O&P&Q&R&S&T&U&V&W&X&Y&Z'
         //SYSUDUMP  DD  SYSOUT=A
         //CSC#....  DD  DUMMY
         //CSCDATA   DD  DSN=SYS1.SYSTEM.CMDSBSYS.CSCDATA,DISP=SHR


         WHERE  -    FOR CSC#.... REPLACE .... WITH SMF SYSID OF ONE
                     OF THE SYSTEMS USING CROSS-SYSTEM COMMANDS.
                     AS MANY CSC##.... DD CARDS AS NECESSARY MAY EXIST.
#$#
         5.  ALLOCATE A ONE TRACK DATASET FOR THE CSCDATA DD IN THE
             CMD1 PROC. WRITE ONE 16 BYTE RECORD OF HEX ZEROS IN THE
             DATASET TO INITIALIZE IT.  IF YOU DO NOT WANT TO USE THE
             CROSS-SYSTEM COMMAND FACILITY DO NOT PUT THE CSCDATA
             DD CARD IN THE CMD1 JCL PROC.


         6.  SUPERZAP (OR SYSGEN IN SCHEDULER MACRO SUBSYS=CMD1),  THE
             SUB-SYSTEM NAME TABLE.

                 NAME IEEVIPL IEFJESNM
                 VER  0008  00000000
                 REP  0008  C3D4C4F1


         7.  COPY INTO A LNKLSTNN LIBRARY OR SYS1.LINKLIB ALL THE
             SUB-SYSTEM MODULES IEESA03D - IEEZS03D RENAMING THEM TO
             CSCSA03D - CSCZS03D. THESE ARE USED FOR THE CROSS-SYSTEM
             # COMMANDS AND THE TSO # COMMANDS.


         8.  SOME HELPFUL HINTS THAT MAY SAVE SOME PROBLEMS.
             A. TO LINK QCB TRACE TOGETHER USE THE FOLLOWING
                (1).  INCLUDE LIBRARY(IEESA03D)
                (2).  INCLUDE LIBRARY(IEESB03D)
                (3).  ENTRY IEESA03D
                (4).  NAME  IEESA03D(R)
             B. LINK CMDDUMMY WITH REUS, RENT LINKEDIT ATTRIBUTES.
             C. LINK CMDSBINT AND CMDSBCSC WITH AC=1 ATTRIBUTE.
             D. LINK CMDSBSYS WITH REUS, RENT AND AC=1 ATTRIBUTES.
             E. BE SURE ALL # COMMANDS (IEES*03D) ARE NOT IN ANY
                LNKLSTNN LIBRARIES. (UNLESS YOU ARE MPLAING FROM IT)
             F. MAKE SURE CMDSBSYS, CMDSBINT, AND CMDSBCSC
                ARE NOT IN LPA.
             G. MAKE SURE THAT CMDDUMMY IS IN FLPA.
             H. MAKE SURE THAT ALL # COMMANDS ARE IN LPA.
                (PLPA,MLPA, OR FLPA)
             I. WHEN LINKING THE # COMMANDS DO NOT USE RENT REUS
                ATTRIBUTES.  IT DOESNT MATTER FOR LPA BUT EXECUTION
                OF COPIED 'CSC' MODULES WITH THESE ATTRIBUTES WILL
                CAUSE 0C4'S.
#$#


         9.  THE BASE SYSTEM FOR THE CMD SUB-SYSTEM IS SE-1 WITHOUT
             SU64.  IT WILL BE NECESSARY TO REPLACE SOME MODULES IF
             YOUR SYSTEM IS NOT SE-1. THE MODULE PREFIX NAMES FOR
             REPLACEMENT MODULES ARE AS FOLLOWS -
             NSE -   NON-SE  NON-SU64       SE2 -   SE-2 AND SU64.
             SP1 -   MVS/SP1.0 1.1


         10. IF YOU WISH TO ALLOW # COMMANDS UNDER TSO,
             LINK MODULES CMDTSO, AND/OR CMDSBTSO WITH LINKEDIT
             ATTRIBUTES OF NOT REENTRANT INTO ANY LIBRARY.
             LINK GRAPHIC DISPLAY MODULES CSCGA03D, CSCGE03D, CSCGF03D,
             CSCGH03D, CSCGI03D, CSCGJ03D, CSCGO03D, CSCGQ03D,
             CSCGS03D, AND CSCGU03D,
             INTO THE SAME LIBRARY AS CMDSBTSO.
             NOTE -   REMEMBER REPLACEMENT MODULES.
             NSE -   NON-SE  NON-SU64       SE2 -   SE-2 AND SU64.
             SP1 -   MVS/SP1.0 1.1


         11. IF YOU WISH TO ALLOW # COMMANDS AT A STANDALONE 3270,
             LINK MODULE CMDSBMON WITH LINKEDIT ATTRIBUTES
             OF NOT REENTRANT INTO ANY AUTHORIZED LIBRARY.
             LINK GRAPHIC DISPLAY MODULES CSCGA03D, CSCGE03D, CSCGF03D,
             CSCGH03D, CSCGI03D, CSCGJ03D, CSCGO03D, CSCGQ03D,
             CSCGS03D, AND CSCGU03D,
             INTO THE SAME LIBRARY AS CMDSBMON.
             NOTE -   REMEMBER REPLACEMENT MODULES.
             NSE -   NON-SE  NON-SU64       SE2 -   SE-2 AND SU64.
             SP1 -   MVS/SP1.0 1.1


         12. PRIOR TO ASSEMBLING CSCGQQXX MODULES IT WILL BE NECESSARY
             TO EDIT MACRO QCOMMON IN ORDER TO PROVIDE SYS1.HASPCKPT
             DEVTYPE AND VOLSER, AND SYSTEM IDS OF ALL SYSTEMS IN A
             MULTI-ACCESS SPOOL ENVIRONMENT.
             SYSTEM IDS MUST BE SPECIFIED IN THE SAME ORDER AS THEY
             APPEAR IN THE JES2PARM MEMBER OF SYS1.PARMLIB.
             NOTE THAT THIS VERSION OF THE QUEUE COMMAND DOES NOT
             WORK WITH NJE SUPPORT AND MAY NOT WORK WITH THE DUAL
             CHECKPOINT PTF ON.
#$#
         COMMAND  SUB-SYSTEM  INITIALIZATION




               TO START  -


                           ISSUE COMMAND  (S CMD1)  WHICH WILL START
                           A JOB TO INITIALIZE AND CONNECT THE
                           COMMAND SUB-SYSTEM AND REMAIN ACTIVE TO
                           SERVICE MONITOR AND CROSS-SYSTEM COMMANDS.
                           CMD1 WILL SET ITSELF NON-SWAPPABLE.


                           IF YOU WISH TO BYPASS USE OF ANY OF THE
                           # COMMANDS, YOU MAY SO SPECIFY WHEN YOU
                           ISSUE THE START COMMAND.


                           EXAMPLE   -

                           S CMD1,D=$     (WILL ELIMINATE USE OF #D)



                           IF YOU WISH TO DISABLE ANY OF THE
                           ## COMMANDS, YOU MAY ISSUE ##$X COMMANDS
                           FOR EACH COMMAND YOU WISH TO DISABLE AFTER
                           YOU START CMD1.

                           WHERE  X -      IS THE COMMAND TO DELETE




               TO STOP THE CROSS-SYSTEM FACILITY -

                           ISSUE COMMAND (#**) WHICH WILL DISCONNECT
                           THE CROSS-SYSTEM COMMANDS AND ISSUE A
                           MESSAGE TO INDICATE CSC HAS BEEN STOPPED.




               TO END  -

                           ISSUE COMMAND (P CMD1) WHICH WILL DISCONNECT
                           THE COMMAND SUB-SYSTEM, AND ISSUE A
                           NON-ROLLABLE MESSAGE TO THE OPERATOR.


                           CMDSBSYS -   COMMAND SUB-SYSTEM TERMINATED
#$#
        COMMAND SUB-SYSTEM COMMANDS  (#X)



             ALL OF THE FOLLOWING COMMANDS HAVE SOME COMMON SYNTAX
             RULES AND SOME COMMON OUTPUT.



        SYNTAX -


             1.    THERE MUST BE 1 BLANK OR NO BLANKS BETWEEN THE #
                   AND THE COMMAND ID,  AND THERE MAY OR MAY NOT BE
                   A SPACE OR SPACES FOLLOWING THE COMMAND ID.

                   EXAMPLES -    #X    # X    #XY    #X Y    # X Y
                                ##X   ## X   ##XY   ##X Y   ## X Y

             2.    ,T=NNN   PARAMETER FOR ANY ## COMMAND SPECIFIES
                            A 1-3 DIGIT TIME LIMIT FOR THE MONITOR
                            COMMAND.  ANY VALUE FROM 1 TO 999 MAY BE
                            SPECIFIED.

             3.    IF THE  ,T=NNN  PARAMETER IS SPECIFIED IT MUST BE
                   THE LAST PARAMETER IN THE COMMAND, UNLESS THE
                   ,L=CC  PARAMETER IS ALSO SPECIFIED, IN WHICH CASE
                   THE ,T=NNN PARAMETER MUST PRECEDE IT.

             4.    ,L=CC    PARAMETER FOR ANY COMMAND DIRECTS THE
                            OUTPUT OF THE COMMAND TO THE SPECIFIED
                            CONSOLE ID.   OMISSION OF THIS PARAMETER
                            CAUSES THE COMMAND OUTPUT TO RETURN TO
                            THE CONSOLE THAT ISSUED THE COMMAND.

             5.    IF THE  ,L=CC  PARAMETER IS SPECIFIED IT MUST BE -
                       A.   THE LAST PARAMETER IN THE COMMAND
                       B.   FOR A TWO DIGIT DECIMAL CONSOLE ID

             6.    ,S=XXXX  PARAMETER FOR ANY # COMMAND SPECIFIES
                            A 4 DIGIT SYSTEM ID (FROM SMF PARMS)
                            TO SEND THE COMMAND TO.  THE COMMAND
                            IS EXECUTED ON THE SYSTEM IT IS SENT TO
                            AND THE OUTPUT IS SENT BACK TO THE
                            ISSUING CONSOLE OR THE CONSOLE
                            SPECIFIED BY THE L=NN PARAMETER.
                            COMMANDS  #T  AND ALL  ## COMMANDS
                            CANNOT BE EXECUTED CROSS-SYSTEM.


        OUTPUT -


             FOR ALL COMMANDS A HEADER LINE IS PRINTED INDICATING
             THE COMMAND ID, ISSUING CONSOLE ID, SYSTEM ID AND DATE.
             SINCE ALL COMMAND OUTPUT IS ECHOED IN THE SYSTEM LOG,
             THIS PROVIDES AN EASY IDENTIFICATION METHOD FOR
             WHICH SYSTEM AND WHAT DATE THE SYSTEM LOG REPRESENTS.


             EXAMPLE -

                   ---  CMD SBSYS (#X)  L=10  K168  76.362  ---



        ERROR RECOVERY -


             ALL COMMANDS EXECUTE IN AN ESTAE ENVIRONMENT,
             AND ISSUE APPROPRIATE MESSAGES IF AN ABEND OCCURS.
#$#
        COMMAND SUB-SYSTEM COMMANDS UNDER TSO    (# X)



        IN ORDER TO EXECUTE # COMMANDS UNDER TSO A CLIST NAMED '#'
        IS INSTALLED WHICH CALLS MODULE CMDTSO PASSING AS A
        PARAMETER THE # COMMAND AND ITS SUB-PARMS.
        NOTE THAT CROSS-SYSTEM COMMANDS CAN BE ISSUED FROM TSO
        AS IF THEY WERE ISSUED FROM AN OPERATOR CONSOLE AND THE
        OUTPUT IS RETURNED TO THE TSO TERMINAL.
        THE FOLLOWING IS A LIST OF THE '#' CLIST -

        PROC 1 CMD
        ALLOC FI(CSCDATA) DA('SYS1.SYSTEM.CMDSBSYS.CSCDATA') SHR
        CALL 'SYS1.LINKLIB(CMDTSO)' '&CMD.'
        END


        IN ORDER TO EXECUTE ## COMMANDS UNDER TSO A CLIST NAMED '##'
        IS INSTALLED WHICH CALLS MODULE CMDTSO PASSING AS A
        PARAMETER THE ## COMMAND AND ITS SUB-PARMS.
        NOTE THAT CROSS-SYSTEM COMMANDS CAN BE ISSUED FROM TSO
        AS IF THEY WERE ISSUED FROM AN OPERATOR CONSOLE AND THE
        OUTPUT IS RETURNED TO THE TSO TERMINAL.
        THE FOLLOWING IS A LIST OF THE '##' CLIST -

        PROC 1 CMD
        CALL 'SYS1.LINKLIB(CMDTSO)' '#&CMD.'
        END


        ALL OF THE FOLLOWING COMMANDS HAVE SOME COMMON SYNTAX
        RULES AND SOME COMMON OUTPUT.


        SYNTAX -


             1.    THERE MUST BE 1 BLANK BETWEEN THE  #  AND THE
                   COMMAND ID.     (# X)  OR  (## X).

             2.    THERE MAY NOT BE SPACES BETWEEN THE COMMAND ID
                   AND ANY SUB-PARAMETERS.   (# XY)  OR  (## XY).


        OUTPUT -


             FOR ALL COMMANDS A HEADER LINE IS PRINTED INDICATING
             THE COMMAND ID, SYSTEM ID, DATE, TIME, USERID, AND ASID.
             AN EXAMPLE OF THE HEADER FOLLOWS -

 ---  <TSO>  CMD SBSYS (#X)  K168  78.100  1430  TMTCE07  0023  ---




        NOTE -  A.   CERTAIN COMMANDS AND/OR SUBCOMMANDS CANNOT BE
                     EXECUTED UNDER TSO.
                     ERROR MESSAGES ARE ISSUED IF ANY OF THE FOLLOWING
                     COMMANDS ARE ISSUED.

                     1. # L    2. # T    3. # D (ZAP ONLY)
                     4. # E    5. ##C


                B.   IF THE COMMAND YOU WISH TO ENTER CONTAINS
                     A COMMA (,) SUBSTITUTE AN AT SIGN (@).

                C.   IF THE COMMAND YOU WISH TO ENTER CONTAINS
                     A SLASH-ASTERISK (/*) SUBSTITUTE A SLASH-NOT (/Â¬).
#$#
        COMMAND SUB-SYSTEM TSO FULL SCREEN SUPPORT



        IN ORDER TO EXECUTE THE TSO FULL SCREEN MONITOR
        ENTER CMDSBTSO TO EXECUTE THE MONITOR AS A COMMAND PROCESSOR
        (EXECUTION OF PGM OR OTHER CP IS ALLOWED ONLY IN THIS MODE),
        OR CREATE A CLIST AS FOLLOWS -

        PROC 0
        ALLOC FI(CSCDATA) DA('SYS1.SYSTEM.CMDSBSYS.CSCDATA') SHR
        CALL 'SYS1.LINKLIB(CMDSBTSO)'
        END


        WHEN EXECUTED THIS PROGRAM WILL ISSUE FULL SCREEN WRITES FOR
        COMMAND OUTPUT FOR ANY # COMMAND OR ## COMMAND AS WELL AS
        SOME SPECIAL GRAPHIC DISPLAY COMMANDS.  THE FIRST DISPLAY
        PRODUCED IS A MENU SCREEN WHICH IS SELF-EXPLANATORY.
        AN AUTOMATIC REFRESH OF ANY #, ##, OR GRAPHIC DISPLAY MAY BE
        REQUESTED BY ENTERING A 2-DIGIT NUMERIC NUMBER OF SECONDS
        IN REFRESH INTERVAL, AND OPTIONALLY A NUMBER OF INTERVALS
        TO ALLOW AUTOMATIC REFRESH (DEFAULT IS 20).
        NOTE THAT CROSS-SYSTEM COMMANDS CAN BE ISSUED FROM TSO
        AS IF THEY WERE ISSUED FROM AN OPERATOR CONSOLE AND THE
        OUTPUT IS RETURNED TO THE TSO TERMINAL.


        ALL OF THE FOLLOWING COMMANDS HAVE SOME COMMON SYNTAX
        RULES AND SOME COMMON OUTPUT.


        SYNTAX -


             1.    THERE MUST NOT BE SPACES BETWEEN THE # AND THE
                   COMMAND ID.     (#X)  OR  (##X).

             2.    THERE MUST NOT BE SPACES BETWEEN THE COMMAND ID
                   AND ANY SUB-PARAMETERS.   (#XY)  OR  (##XY).


        OUTPUT -


             FOR ALL COMMANDS A HEADER LINE IS PRINTED INDICATING
             THE COMMAND ID, SYSTEM ID, DATE, TIME, USERID, AND ASID.
             AN EXAMPLE OF THE HEADER FOLLOWS -

 ---  <TSO>  CMD SBSYS (#X)  K168  78.100  1430  TMTCE07  0023  ---




        NOTE -  A.   CERTAIN COMMANDS AND/OR SUBCOMMANDS CANNOT BE
                     EXECUTED UNDER TSO.
                     ERROR MESSAGES ARE ISSUED IF ANY OF THE FOLLOWING
                     COMMANDS ARE ISSUED.

                     1. # L    2. # T    3. # D (ZAP ONLY)
                     4. # E    5. ##C    6. E (CHANNEL BUSY ONLY)
#$#
        COMMAND SUB-SYSTEM STANDALONE 3270 FULL SCREEN SUPPORT



        IN ORDER TO EXECUTE THE STANDALONE FULL SCREEN MONITOR
        CREATE A PROC AS FOLLOWS -

        //CMDSBMON  PROC  U=XXX
        //CMDSBMON  EXEC  PGM=CMDSBMON,PARM='&U.'
        //CSCDATA  DD  DSN=SYS1.SYSTEM.CMDSBSYS.CSCDATA,DISP=SHR
        //SYSUDUMP  DD  SYSOUT=A
        //CMDLOG    DD  SYSOUT=A
        //*   WHERE  XXX  IS THE 3270 UNIT ADDRESS


        WHEN EXECUTED THIS PROGRAM WILL ISSUE FULL SCREEN WRITES FOR
        COMMAND OUTPUT FOR ANY # COMMAND OR ## COMMAND AS WELL AS
        SOME SPECIAL GRAPHIC DISPLAY COMMANDS.  THE FIRST DISPLAY
        PRODUCED IS A MENU SCREEN WHICH IS SELF-EXPLANATORY.
        AN AUTOMATIC REFRESH OF ANY #, ##, OR GRAPHIC DISPLAY MAY BE
        REQUESTED BY ENTERING A 2-DIGIT NUMERIC NUMBER OF SECONDS
        IN REFRESH INTERVAL, AND OPTIONALLY A NUMBER OF INTERVALS
        TO ALLOW AUTOMATIC REFRESH (DEFAULT IS 20).
        NOTE THAT CROSS-SYSTEM COMMANDS CAN BE ISSUED
        AS IF THEY WERE ISSUED FROM AN OPERATOR CONSOLE AND THE
        OUTPUT IS RETURNED TO THE TERMINAL.


        ALL OF THE FOLLOWING COMMANDS HAVE SOME COMMON SYNTAX
        RULES AND SOME COMMON OUTPUT.


        SYNTAX -


             1.    THERE MUST NOT BE SPACES BETWEEN THE # AND THE
                   COMMAND ID.     (#X)  OR  (##X).

             2.    THERE MUST NOT BE SPACES BETWEEN THE COMMAND ID
                   AND ANY SUB-PARAMETERS.   (#XY)  OR  (##XY).


        OUTPUT -


             FOR ALL COMMANDS A HEADER LINE IS PRINTED INDICATING
             THE COMMAND ID, SYSTEM ID, DATE, TIME, USERID, AND ASID.
             AN EXAMPLE OF THE HEADER FOLLOWS -

 ---  <MON>  CMD SBSYS (#X)  K168  78.100  1430  CMDSBMON  0023  ---




        NOTE -  A.   CERTAIN COMMANDS AND/OR SUBCOMMANDS CANNOT BE
                     EXECUTED UNDER THE STANDALONE MONITOR.
                     ERROR MESSAGES ARE ISSUED IF ANY OF THE FOLLOWING
                     COMMANDS ARE ISSUED.

                     1. # T

#$#
                 COMMAND SUB-SYSTEM GENERAL MESSAGES
              -----------------------------------------




MESSAGE ->        CMD SUBSYS - COMMAND PARAMETER ERROR

DESCRIPTION ->    INVALID COMMAND STRUCTURE.

OPER ACTION ->    REENTER COMMAND.



MESSAGE ->        CMD SUBSYS - COMMAND NOT SUPPORTED

DESCRIPTION ->    INVALID COMMAND ENTERED.

OPER ACTION ->    REENTER COMMAND.



MESSAGE ->        CMD SUBSYS - CONSOLE NOT ACTIVE

DESCRIPTION ->    CONSOLE SPECIFIED BY 'L=NN' PARAMETER IS NOT ACTIVE.

OPER ACTION ->    VARY CONSOLE ONLINE BEFORE RETRYING COMMAND.



MESSAGE ->        CMD SUBSYS - S CHKDUMP ISSUED FOR D DUMP

DESCRIPTION ->    SUB-SYSTEM HAS INTERCEPTED A 'D DUMP' COMMAND
                  AND ISSUED A 'S CHKDUMP' COMMAND.

OPER ACTION ->    NONE.  INFORMATION ONLY.



MESSAGE ->        CMD SUBSYS - COMMAND SUB-SYSTEM TERMINATED

DESCRIPTION ->    SUB-SYSTEM HAS TERMINATED NORMALLY.

OPER ACTION ->    RESTART THE SUB-SYSTEM.



MESSAGE ->        ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND

DESCRIPTION ->    AN ESTAE ROUTINE HAS BEEN ENTERED TO PROCESS AN
                  ABEND FOR THE COMMAND ENTERED.

OPER ACTION ->    REENTER COMMAND.



#$#
MESSAGE ->        CMD SUBSYS - COMMAND REJECTED, SUBSYS BUSY

DESCRIPTION ->    SUB-SYSTEM IS BUSY PROCESSING A PREVIOUS COMMAND.

OPER ACTION ->    REENTER COMMAND.  IF PROBLEM PERSISTS, RESTART
                  THE SUB-SYSTEM.



MESSAGE ->        CMD SUBSYS - COMMAND REJECTED, MONITOR BUSY

DESCRIPTION ->    MONITOR CONTROL IS BUSY PROCESSING A PREVIOUS COMMAND.

OPER ACTION ->    REENTER COMMAND.  IF PROBLEM PERSISTS FOR AN EXTENDED
                  PERIOD OF TIME, RESTART THE SUB-SYSTEM.



MESSAGE ->        CMD SUBSYS - MONITOR COMMAND ACCEPTED

DESCRIPTION ->    MONITOR CONTROL HAS ACCEPTED THE ENTERED COMMAND.

OPER ACTION ->    NONE.  INFORMATION ONLY.



MESSAGE ->        CMD SUBSYS - XMPOST ERROR - RESTART SUBSYS

DESCRIPTION ->    A CROSS-MEMORY POST ERROR HAS OCCURRED.

OPER ACTION ->    RESTART THE SUB-SYSTEM.



MESSAGE ->        CMD SUBSYS - ##X COMMAND DISABLED

DESCRIPTION ->    MONITOR COMMAND ##X HAS BEEN DISABLED.

OPER ACTION ->    TO REINSTATE COMMAND, RESTART THE SUB-SYSTEM.



MESSAGE ->        CMD SUBSYS - COMMAND NOT DISABLED

DESCRIPTION ->    MONITOR COMMAND DISABLE REQUEST HAS FAILED.

OPER ACTION ->    REENTER REQUEST.



#$#
MESSAGE ->        CMD SUBSYS - CSC PARAMETER ERROR

DESCRIPTION ->    CROSS-SYSTEM CONTROL PARAMETER ERROR.
                  MOST LIKELY THE 'S=XXXX' PARAMETER IS MISSING
                  OR INVALID.

OPER ACTION ->    REENTER COMMAND.



MESSAGE ->        CMD SUBSYS - CSC INVALID COMMAND

DESCRIPTION ->    CROSS-SYSTEM CONTROL INVALID COMMAND.
                  COMMAND DOES NOT EXIST OR IS NOT VALID WHEN
                  ISSUED AS A CROSS-SYSTEM COMMAND. (E.G. #T)

OPER ACTION ->    REENTER COMMAND.



MESSAGE ->        CMD SUBSYS - CSC #X COMMAND ACCEPTED

DESCRIPTION ->    CROSS-SYSTEM CONTROL HAS ACCEPTED THE ENTERED COMMAND.

OPER ACTION ->    NONE.  INFORMATION ONLY.



MESSAGE ->        CMD SUBSYS - CSC BUSY, CMD PENDING ON SSSS

DESCRIPTION ->    CROSS-SYSTEM CONTROL HAS DETECTED THAT A PREVIOUS
                  COMMAND ENTERED ON SOME SYSTEM IS PENDING, AND HAS
                  REJECTED THE COMMAND ENTERED.

OPER ACTION ->    REENTER COMMAND.



MESSAGE ->        CMD SUBSYS - CSC TIMEOUT, CMD PENDING ON SSSS

DESCRIPTION ->    CROSS-SYSTEM CONTROL HAS DETECTED THAT A PREVIOUS
                  COMMAND ENTERED ON SOME SYSTEM IS PENDING AND HAS
                  EXCEEDED THE EXPECTED COMPLETION TIME.  THE PENDING
                  COMMAND HAS BEEN AUTOMATICALLY RESET.

OPER ACTION ->    NONE.  INFORMATION ONLY.



MESSAGE ->        CMD SUBSYS - CSC STOPPED

DESCRIPTION ->    CROSS-SYSTEM CONTROL HAS BEEN STOPPED.

OPER ACTION ->    RESTART THE SUB-SYSTEM IF CROSS-SYSTEM COMMANDS
                  ARE DESIRED.



MESSAGE ->        CMD SUBSYS - COMMAND REJECTED, CSC NOT ACTIVE

DESCRIPTION ->    CROSS-SYSTEM CONTROL HAS BEEN STOPPED OR WAS NEVER
                  ACTIVE.

OPER ACTION ->    RESTART THE SUB-SYSTEM IF CROSS-SYSTEM COMMANDS
                  ARE DESIRED.



MESSAGE ->        CMD SUBSYS - COMMAND REJECTED, CSC BUSY

DESCRIPTION ->    CROSS-SYSTEM CONTROL IS BUSY PROCESSING A PREVIOUS
                  COMMAND.

OPER ACTION ->    REENTER COMMAND.  IF PROBLEM PERSISTS, CSC WILL
                  AUTOMATICALLY RESET THE PREVIOUS COMMAND.
#$#
      #A  COMMAND     (DISPLAY JOB STATUS -   EXPANDED  D A)



               #A   ASID       4 LINES OF OUTPUT FOR AN ASID


               #A   .JOBNAME   4 LINES OF OUTPUT FOR AN JOBNAME


               #A              2 LINES OF OUTPUT FOR ALL JOBS


               #A   0000       4 LINES OF OUTPUT FOR ALL JOBS


               #A   XX,L       4 LINES OF OUTPUT FOR SELECTED TYPE


               #A   XX         2 LINES OF OUTPUT FOR SELECTED TYPE


               #A   XX,S       1 LINE OF OUTPUT FOR SELECTED TYPE


               #A   XX,D       1 LINE OF DISPATCHABILITY OUTPUT


                    WHERE  XX   IS ONE OF THE FOLLOWING TYPES -


                    $A         SELECT ALL JOB, TSU, AND STC

                    $J         SELECT ALL JOBS

                    $S         SELECT ALL STARTED TASKS

                    $T         SELECT ALL TSO USERS

                    $I         SELECT ALL IDLE INITIATORS

                    NN         SELECT ALL JOBS IN DOMAIN -   NN
#$#
                   E X A M P L E


    TEST00   (000B) DP(112) SWL(010/016) SWC(0001)
       PERF-NRS(0B/07/0B) DPRTY-NR(70/76) DMN(01)
       Q(00) S(80) Y(40) A(58) T(83) E(00) U(00)
       AS(FE2578) SR(06) OU(FE1080) A(0063/00000)



    1ST LINE -

         TEST00                JOBNAME
         (000B)                ASID
         DP(112)               DISPATCHING PRIORITY  (FROM ASCB)
         SWL(010/016)          SWAP LOAD IN DECIMAL PAGES  (IN/OUT)
         SWC(0001)             SWAP COUNT IN DECIMAL


    2ND LINE -

         PERF-NRS(0B/07/0B)    PERFORMANCE GROUP  (NEW/RESET/SPECIFIED)
         DPRTY-NR(70/76)       DISPATCHING PRIORITY  (FROM OUCB)
         DMN(01)               DOMAIN NUMBER


    3RD LINE -

         (OUCB FLAGS -   SEE DESCRIPTION IN FE HANDBOOK)


    4TH LINE -

         AS(FE2578)            ASCB ADDRESS
         SR(06)                SWAP REASON CODE  (SEE TABLE BELOW)
         QP(01)                DISPATCHING QUEUE POSITION
         OU(FE1080)            OUCB ADDRESS
         A(0063/00000)         ADDRESS SPACE SLOTS/VIO SLOTS



         NOTE THAT IF THE SWAP REASON CODE IS  00,   QP(XX) WILL
         PRINT TO INDICATE THE DISPATCHING QUEUE POSITION.




    SWAP REASON CODES -


         01        TERMINAL WAIT -   OWAITHI
         02        TERMINAL WAIT -   INPUT
         03        LONG WAIT
         04        AUXILLARY STORAGE SHORTAGE
         05        REAL STORAGE SHORTAGE
         06        DETECTED WAIT
         07        REQUEST SWAP
         08        ENQ EXCHANGE SWAP
         09        EXCHANGE ON RECOMMENDATION VALUE
         0A        UNILATERAL SWAP
         0B        TRANSITION SWAP
         0C        LOGICAL SWAP
         0D        LOGICAL SWAP FAIL
#$#
          #C   COMMAND   (CALCULATOR, TOD, AND MSTCONS SWITCH)




         #C           DISPLAY TOD CLOCK HIGH-ORDER WORD

         #CS          DISPLAY CURRENT SMF DATA SET


         #CBNN,XX..X  SEND MESSAGE  NN  TIMES TO ALL ACTIVE
                      DISPLAY TYPE CONSOLES.


         #CMNN,XX..X  SEND MESSAGE  NN  TIMES TO THE
                      CONSOLE SPECIFIED BY THE L=XX PARAMETER


         #CXNNNN      CALCULATE CHARACTER LXYZ LOCATION FROM HEX


         #CXL-XXX-YY-Z  CALCULATE HEX LXYZ LOCATION FROM CHARACTER


         #CZ,PASSWRD  SWITCH MASTER CONSOLE DESIGNATION TO THE
                      CONSOLE SPECIFIED BY THE L=XX PARAMETER


         #C XXXX      CONVERT 1-8 DIGIT HEX VALUE TO DEC


         #C ,DDDD     CONVERT 1-8 DIGIT DEC VALUE TO HEX


         #C AAAOBBB   CALCULATOR MODE


               AAA    IS 1-8 DIGIT HEX OR ,DEC VALUE

               BBB    IS 1-8 DIGIT HEX OR ,DEC VALUE

               O      IS ARITHMETIC OPERATOR
                      +   ADD
                      -   SUBTRACT
                      .   MULTIPLY
                      /   DIVIDE
#$#
      #D  COMMAND     (DISPLAY AND ZAP CORE)

             ADDRESS SPACE FROM WHICH ADDRESS SPECIFIED IS RESOLVED
             IS THE CALLERS,  UNLESS >AAAA PREFIXES THE COMMAND SUBPARM
             WHERE  AAAA IS THE ASID OF THE ADDRESS SPACE TO DUMP/ZAP.
             EXAMPLE -    #D  >0002,0A0000


             FOR DUMPING CORE

                 #D 0000,NN          WHERE  NN  IS THE NUMBER OF LINES
                                     TO PRINT FROM 01 - 64. DEFAULT= 04


             FOR DUMPING A UCB

                 #D  U280  (WILL DUMP THE 280 UCB)


             FOR ZAPPING CORE

                 #D  0ACD/FF000000/FF160000

                     0ACD     = ADDRESS TO BE ZAPPED
                     FF000000 = DATA TO BE VERIFIED
                     FF160000 = DATA TO BE ZAPPED IN


             FOR TERMINATING AN ADDRESS SPACE

                 #D  EXIT,AAAA        TERMINATE ASID AAAA


             FOR CHANGING THE AUTHORIZED USE BIT OF SVC 107 (MODESET)

                 #D  S     SET SVC 107 USABLE BY NON-AUTH PROGRAM
                 #D  SA    SET SVC 107 NOT USABLE BY NON-AUTH PROGRAM


             FOR CHANGING AN ADDRESS SPACE STATUS

                 #D  NOSWAP,AAAA      SET ASID 'AAAA' NON-SWAPPABLE
                 #D  OKSWAP,AAAA      SET ASID 'AAAA' SWAPPABLE
                 #D  NOCANC,AAAA      SET ASID 'AAAA' NON-CANCELABLE
                 #D  OKCANC,AAAA      SET ASID 'AAAA' CANCELABLE
                 #D  CHAP,AAAA,DDD    CHAP ASID 'AAAA' TO DPRTY 'DDD'
                 #D  DOSWAP,AAAA      SWAP ASID 'AAAA' IN/OUT

             NOTE 1  -   IN ORDER FOR THE CHAP TO TAKE EFFECT THE JOB
                         MUST PASS FROM SWAPPED OUT TO SWAPPED IN.

             NOTE 2  -   IF A SET IPS COMMAND IS ISSUED OR IF THE JOB
                         CHANGES STEPS, THE JOB WILL BE RESET TO ITS
                         ORIGINAL STATE.




-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------





      #E  COMMAND     (EXECUTE COMMAND)



             FOR SENDING A COMMAND

                 #E XXXXX     XXXXX -   THE COMMAND TO BE EXECUTED

                 #E V PATH(XXX,YYY,C),ONLINE    VARY PATH RANGE ON

                 #E V PATH(XXX,YYY,C),OFFLINE   VARY PATH RANGE OFF


#$#
      #F  COMMAND     (DISPLAY PAGE FRAME ASSIGNMENTS)



             #F


             TOTAL       2048  8192K
             NUCLEUS       98   392K
             TOT FIXED    130   520K
             SQA FIXED     88   352K
             CMN FIXED     12    48K
             SYS PAGES    260  1040K     SQA=  340K
             AVAILABLE     24    96K
             MASTER        16    64K     LSQA=  32K
             JES2          48   192K     LSQA=  44K
             FFGRI1        68   272K     LSQA=  28K
             TEST00        10    40K     LSQA=  32K







-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------







         #F C     -       TO DISPLAY CSA VIRTUAL STORAGE USAGE



          CSA SIZE =      3752K      CSA ADDR =     790000
          SQA FREE =        56K     SQA AVAIL =     2092K
          NUC END =      0A9000     SEG END =       0B0000
          V=R SIZE =        80K      V=R ADDR =     0B4000
          PRV SIZE =      8288K      PRV ADDR =     0C8000
          FREE        SIZE=   1980K      ADDR =     790000
          ALLOCATED   SIZE=   1696K      ADDR =     97F000
          FREE        SIZE=     48K      ADDR =     B00000
          ALLOCATED   SIZE=     32K      ADDR =     B0C000
#$#
     #F R   -       TO DISPLAY THE V=R AREA SHOWING FRAME
                    ALLOCATION,  INCLUDING NO. OF FRAMES,
                    OWNING ASID AND PFT FLAGS.



             EXAMPLE OUTPUT -


                        PAGES.ASID.FLAGS
                        ----------------
                        012...0008...R-U
                        001...FFFF...A-A



             PAGES COLUMN -    NO. OF FRAMES OWNED BY THIS ASID
                               AND WITH THESE FLAGS IN DECIMAL.



             ASID COLUMN -     ASID OF ADDRESS SPACE LAST TO OWN
                               OR CURRENTLY OWNING THESE FRAMES.
                               FFFF INDICATES NO OWNER.



             FLAGS COLUMN -    THREE FLAG DIGITS WITH THE FOLLOWING
                               MEANINGS.  A - IN ANY FLAG DIGIT
                               INDICATES NO STATUS.


                   1ST DIGIT -    O     OFFLINE
                                  C     OFFLINE INTERCEPT
                                  R     V=R ALLOCATE
                                  I     V=R INTERCEPT
                                  A     AVAILABLE


                   2ND DIGIT -    B     BAD FRAME
                                  F     LONG TERM FIXED
                                  S     SQA/LSQA FRAME
                                  V     VIO FRAME


                   3RD DIGIT -    A     AVAILABLE QUEUE
                                  R     SQA RESERVED QUEUE
                                  C     COMMON QUEUE
                                  S     SQA QUEUE
                                  U     LOCAL QUEUE
                                  L     LSQA QUEUE
                                  N     NOT QUEUED
#$#
         #F MX   -        TO DISPLAY THE SPECIFIED MEGABYTE (M1 TO M9)
                          OF REAL STORAGE SHOWING FRAME ALLOCATION,
                          INCLUDING NUMBER OF FRAMES, OWNING ASID,
                          PFT FLAGS.


                          SEE  (#F R)  FOR DESCRIPTION OF OUTPUT.



                 NOTE -   MEGABYTE 0 CANNOT BE DISPLAYED AND WILL
                          CAUSE A PARM ERROR IF ATTEMPTED.
                          SINCE MEGABYTE 0 CANNOT BE VARIED
                          OFFLINE  (IT CONTAINS THE NUCLEUS),
                          THIS RESTRICTION SEEMS REASONABLE.






-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------






         #F OX  -     TO DISPLAY, FOR THE SPECIFIED MEGABYTE (O1 TO O9)
                      OF REAL STORAGE,  FRAME ALLOCATION FOR OFFLINE
                      INTERCEPTED FRAMES WHICH ARE NOT YET OFFLINE,
                      INCLUDING NUMBER OF FRAMES, OWNING ASID,
                      PFT FLAGS.


                      SEE  (#F R)  FOR DESCRIPTION OF OUTPUT.



             NOTE -   MEGABYTE 0 CANNOT BE DISPLAYED AND WILL
                      CAUSE A PARM ERROR IF ATTEMPTED.
                      SINCE MEGABYTE 0 CANNOT BE VARIED
                      OFFLINE  (IT CONTAINS THE NUCLEUS),
                      THIS RESTRICTION SEEMS REASONABLE.






-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------






         #F BX  -     TO DISPLAY, FOR THE SPECIFIED MEGABYTE (B1 TO B9)
                      OF REAL STORAGE,  FRAME ALLOCATION FOR
                      BAD FRAMES INCLUDING NUMBER OF FRAMES,
                      OWNING ASID AND PFT FLAGS.


                      SEE  (#F R)  FOR DESCRIPTION OF OUTPUT.



             NOTE -   MEGABYTE 0 CANNOT BE DISPLAYED AND WILL
                      CAUSE A PARM ERROR IF ATTEMPTED.
                      SINCE MEGABYTE 0 CANNOT BE VARIED
                      OFFLINE  (IT CONTAINS THE NUCLEUS),
                      THIS RESTRICTION SEEMS REASONABLE.
#$#
        #H  COMMAND      (DISPLAY  # COMMAND  HELP)



           #H         DISPLAYS COMMAND LIST

           #H X       DISPLAYS HELP FOR  COMMAND  #X

           #H #X      DISPLAYS HELP FOR  COMMAND  ##X



                    #A -   (SE)  DISPLAY JOB STATUS -  EXPANDED  D A
                    #C -   (SK)  HEX/DEC CALCULATOR AND TOD DISPLAY
                    #D -   (SD)  DISPLAY AND ZAP CORE
                    #E -   (SS)  EXECUTE A COMMAND
                    #F -   (SF)  DISPLAY PAGE FRAME ASSIGNMENTS
                    #H -   (SM)  DISPLAY HELP
                    #I -   (SJ)  DISPLAY IPS AND SWAP COUNTS
                    #J -   (SL)  MODIFIED DISPLAY ACTIVE REPLACEMENT
                    #L -   (SC)  DISPLAY LINES FOR TSO
                    #M -   (SO)  TSO MULTIPLE SEND
                    #N -   (SA)  DISPLAY ENQUEUE
                    #O -   (SR)  DISPLAY PENDING I/O AND ALLOCATION
                    #P -   (SP)  DISPLAY SU CONFIGURATION
                    #Q -   (SQ)  ANALYZE ENQUEUE CONFLICTS
                    #R -   (SG)  DISPLAY DEVICE STATUS
                    #S -   (SH)  DISPLAY LPA MODULES
                    #T -   (SN)  DISPLAY TIOT FOR A JOB
                    #V -   (SI)  DISPLAY UNIT
                    #Z -   (SZ)  MODIFIED DISPLAY ACTIVE REPLACEMENT
                    ##A -  (ZA)  MONITOR JOB ACTIVITY
                    ##B -  (ZB)  MONITOR DEVICES
                    ##C -  (ZC)  MONITOR CHANNELS
                    ##J -  (ZJ)  MONITOR JOBS
                    ##P -  (ZP)  MONITOR PAGING
                    ##S -  (ZS)  MONITOR SYSTEM INDICATORS
#$#
        #I  COMMAND      (DISPLAY IPS AND SWAP COUNTS)



               DISPLAYS CURRENT IPS MEMBER AND SWAP COUNTS
               BY REASON SINCE LAST IPL.



               CURRENT IPS -   IEAIPST2
               LGCP 100  AVCP 101  AVPG  27  AUIC  16  ASMQ  07
               TERM WAIT - OUT     (01)          0
               TERM WAIT - IN      (02)          0
               LONG WAIT           (03)        304
               AUX STOR SHORTAGE   (04)          0
               REAL STOR SHORTAGE  (05)          0
               DETECTED WAIT       (06)        932
               REQUEST SWAP        (07)         82
               ENQ EXCHANGE        (08)        112
               WORKLOAD EXCHANGE   (09)         89
               UNILATERAL SWAP     (0A)        243
               TRANSITION SWAP     (0B)         21
               LOGICAL SWAP        (0C)        289
               LOGICAL SWAP FAIL   (0D)         12






-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------






         #I A      (DISPLAY ASM COUNTS)



         EXAMPLE  -

               ILRSLOTC            16
               ILRSLOTV            16
               AVAIL SLOTS        836
               TOTAL SLOTS      4,338
               VIO SLOTS            0
               ADSPC SLOTS        796
               BAD SLOTS            0



         NOTE  -      AVAIL SLOTS IS THE NUMBER OF UNRESERVED
                      LOCAL PAGE DATA SET SLOTS.

         #I C      (DISPLAY AVAILABLE PCCWS)



         EXAMPLE  -

               NUMBER OF PCCWS BUILT BY RIM 00000044
               NUMBER OF AVAILABLE PCCWS    00000030


#$#
        #I P     (DISPLAY PAGE DATA SET USAGE)



        EXAMPLE -

             PLPA  A53  PAGE01  PLPAPAGE           ERR(000)
             SIZE(1044) AVAIL(0197) USED(82%) BRST(019)
             COMN  942  PAGE02  COMMPG2            ERR(000)
             SIZE(0522) AVAIL(0438) USED(17%) BRST(021)
             LOCL  A53  PAGE02  LOCALP2            ERR(000)
             SIZE(1566) AVAIL(1110) USED(30%) BRST(027)
             LOCL  942  PAGE01  LOCALPG2           ERR(000)
             SIZE(1566) AVAIL(1105) USED(30%) BRST(038)


             SIZE AND AVAILABLE FIGURES ARE DECIMAL NUMBER OF SLOTS.

             BRST IS THE PARERQTM VALUE DIVIDED BY 256, IN DECIMAL.
             IT REPRESENTS THE AVERAGE TIME REQUIRED TO
             TRANSFER 1 PAGE.





-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------


        #I R     (DISPLAY SRM VALUES)


        EXAMPLE  -

               SRM RESOURCE CONTROL TABLE
                                            THRESHOLD
                CPU UTILIZATION        45     98  101
                CPU UTIL W/ DEM PAG           95   98
                PAGING RATE             2   1000 1000
                DEMAND PAGING RATE     29     70   88
                TOTAL PAGING RATE      38
                PAGE DELAY TIME (MS)  726   1000 1000
                PAGE DELAY W/ DEM PAG        100  130
                AVG ASM QUEUE          27   1000 1000
                AVG UIC               255      2    4
                AVG AVAIL FRAMES      598


#$#

        #I S     (DISPLAY SWAP DATA SET USAGE)



        EXAMPLE -

             SWAP DS- 001  SETS- 200  PGS/SET-  12
             940  MVACAT  SYS1.SWAP01
             SIZE(2400) AVAIL(1200) USED(50%) ERR(0000)


             SIZE AND AVAILABLE FIGURES ARE DECIMAL NUMBER OF SLOTS.

             ERR  IS THE NUMBER OF ERRORS SUFFERED ON THE SWAP DS.





-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------





        #I X     (DISPLAY PERFORMANCE GROUP ACTIVITY)


        EXAMPLE - (TSO PERFORMANCE GROUP 2)

             PGN PER   TR CNT   TR RATE  AB RATE  SW RATE  AVGRESP
             02   1      2366      131      146     1.23     0.78
             02   2       234      108      110     1.45     5.62
             02   3        20      156      170     1.67   110.23
             02  ALL     2620      126      134     1.31     2.21

        TR CNT -      NO. OF TRANSACTIONS
        TR RATE -     TRANSACTION SERVICE RATE
        AB RATE -     ABSORPTION RATE
        SW RATE -     SWAP RATIO
        AVGRESP -     AVERAGE RESPONSE TIME
#$#
      #J  COMMAND      (MODIFIED DISPLAY ACTIVE REPLACEMENT)

      #J T  COMMAND    (MODIFIED DISPLAY ACTIVE -  TSO ONLY)

      #J NN  COMMAND   (MODIFIED DISPLAY ACTIVE -  FOR DOMAIN  'NN')


          EXAMPLE  -

     *****   IN  QUEUE   *****     ASID DPRTY QP  FLAGS   CPU TIME
     JES2     JES2     IEFPROC     0002  253  02  NSW      1.33.01
     TEST00   STEP1                0004  117  04  IN CP    2.55.33
     TEST01   STEPX    ASMBLR      0005  119  03  IN       0.10.68
     TMSBKUP  FDR                  0006  112  05  IN       1.11.24
     *****   OUT  QUEUE   *****    ASID DPRTY SR  FLAGS   CPU TIME
     RMF      148      IEFPROC     0003  251  03  OUTLW    1.11.98


      WHERE -

         ASID    DPRTY    QP/SR    FLAGS    CPU TIME
        ------  -------  -------  -------  ----------

         NNNN     DDD     QQ/SS    XXXYY    MMM.SS.HH


        NNNN         IS THE ADDRESS SPACE IDENTIFICATION

        DDD          IS THE JOBS DISPATCHING PRIORITY

        QQ           IS THE JOBS ASCB QUEUE POSITION, WHICH IS
                     A RELATIVE DISPATCHING PRIORITY

        SS           IS THE SWAP REASON CODE AS DESCRIBED IN THE
                     DOCUMENTATION FOR THE  # A COMMAND.

        XXXYY        IS THE JOB STATUS AS DESCRIBED BELOW

        MMM.SS.HH    IS THE CPU AND SRB ACCUMULATED JOB STEP TIME



        XXX -

            IN  -   IN CORE - SWAPPED IN
            NSW -   NON-SWAPPABLE
            OUT -   SWAPPED OUT
            GOO -   IN PROCESS OF BEING SWAPPED OUT
            GOI -   IN PROCESS OF BEING SWAPPED IN
            GOB -   CURRENTLY CHANGING STATUS


        YY -

            LW  -   LONG WAIT STATUS -  EXPLICIT OR IMPLICIT
            MW  -   LONG WAIT STATUS DETECTED BY MSO (MS6)
            CP  -   SIGNIFICANT CPU USER - SET BY IRARMCPM
            A   -   AUXILLARY STORAGE SHORTAGE
            S   -   REAL STORAGE SHORTAGE






-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------






      #L  COMMAND     (DISPLAY LINES FOR TSO)



                #L        (WILL SHOW USERID, ASID AND TP LINE)

                       IBMUSER   (000C)  - 3F1
#$#
      #M  COMMAND      (TSO MULTIPLE SEND)


                #M XXXXXX


                     WHERE  XXXXXX  IS A  1 - 68  DIGIT MESSAGE
                     TO BE SENT TEN TIMES TO ALL LOGGED ON TSO USERS






-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------






      #N  COMMAND     (DISPLAY ENQUE -   SEE ENQ/DEQ SUMMARY)



         #N   FORMAT IS AS FOLLOWS -

          #N (ZZZZZZ)XXXXXXXX/YYYYYYYY

             WHERE   -

                XXXXXXXX       IS THE 8 DIGIT MAJOR NAME OR  '*'
                YYYYYYYY       IS THE 1 - 44 DIGIT MINOR NAME OR  '*'
                (ZZZZZZ)       IS THE 1 - 8 DIGIT JOBNAME TO LIMIT
                               THE SEARCH.   (OPTIONAL)


                 #N *

                 #N SYSDSN/*

                 #N SYSIEFSD/*

                 #N SYSDSN/SYS1.LINKLIB



                IN RESPONSE TO THE #N COMMAND THE CURRENT STATUS
                TYPES ARE:

                             SHR - SHARED USE ENQ
                             EXCL- EXCLUSIVE USE ENQ
                             RSVS- SHARED USE WITH A RESERVE
                             RSVX- EXCLUSIVE USE WITH A RESERVE
#$#
                       MVS  ENQ/DEQ  SUMMARY



     MAJOR NAME   MINOR NAME               DESCRIPTION
     ----------   ----------    -----------------------------------

     SYSDSN       -DSNAME       ENQ FOR USER OR SYSTEM DATA SETS

     SYSIEA01     IEA           ABEND IN PROGRESS

     SYSIEFSD     CHNGDEVS      UCB MANIPULATION

                  Q4            UCB MANIPULATION

                  Q6            PROTECT KEY ALTERATION

                  Q10           CSCB CHAIN MANIPULATION

                  RPLL          JOB JOURNAL DATA SET (CKPT/RSTRT)

                  STCQUE        STARTED TASK CONTROL

                  TSOQUE        TSO DATA SETS

     SYSIGGV1     MCATOPEN      MASTER CATALOG

     SYSIGGV2     -CATLGNAME    USER CATALOGS

     SYSIKJBC     -RBA          TSO BRODCAST DATA SET (REL BYTE ADDR)

     SYSIKJUA     OPENUADS      UADS DATA SET

                  -USERID       TSO USERS

     SYSLMOD      -DSNAME       LINKEDIT RESERVE

     SYSSJWTP     JSCBWTP       WRITE-TO-PROGRAMMER MESSAGES

                  -RPL+ASID     MESSAGE DATA SET PROCESSING
                                (REQUEST PARAMETER LIST + ASID)

     SYSSMF01     BUF           SMF BUFFER WRITE

     SYSZUSRL     -UCBADDR      USER LABEL PROCESSING

     SYSVSAM      -CCCCNNNX     VSAM DATA SET PROCESSING
                                (CCCC- ACB ADDR, NNN- CI NO., X- STAT)

     SYSVTOC      -VOLSER       VTOC RESERVE

     SYSZRBMF     ACTIVE        MF1 ACTIVE INDICATOR

     SYSZCAXW     CAXW          CAXWA (CATLG AUXILLARY WORK AREA)

     SYSZCSD      CSDCPUJS      CSD UPDATE

     SYSZEC16     PURGE         PURGE DATA SET PROCESSING

     SYSZIGGI     -ASID         TSB PROCESSING

     SYSZJES2     SPOOL         AWAITING SPOOL SPACE

     SYSZPCCB     PCCB          PCCP (PRIV CATLG CONTROL BLOCK)

     SYSZPGAD     PAGEADD       SERIALIZE FOR PAGEADD COMMAND

     SYSZPSWD     -DSNAME       PASSWORD DATA SET PROCESSING

     SYSZSIPS     IRARMSET      IPS SET

     SYSZTIOT     -ASID         TIOT PROCESSING

     SYSZVARY     CPU           RECONFIGURATION COMMANDS

                  VALIDATE      STORAGE VALIDATION PROCESSING

     SYSZVMV      -UCBADDR      VIRTUAL VOLUME PROCESSING

     SYSZVOLS     -VOLSER       ALL ALLOCATED VOLUMES
#$#
    #O  COMMAND   (DISPLAY OUTSTANDING I/O AND ALLOCATION REQUESTS)



     #O                DISPLAY ALL OUTSTANDING I/O

     #O A              DISPLAY ACTIVE OUTSTANDING I/O

     #O Q              DISPLAY QUEUED OUTSTANDING I/O

     #O X              DISPLAY ALLOCATION QUEUE



              I/O OUTPUT EXAMPLE -

              UUU  VVVVVV  JJJJJJJJ  IIIIII  DDDDDDDD  SSSSSSS


              WHERE -
                      UUU -         UNIT ADDR
                      VVVVVV -      VOLSER
                      JJJJJJJJ -    JOBNAME OR ASID
                      IIIIII -      IOQ ADDR
                      DDDDDDDD -    I/O DRIVER NAME
                      SSSSSSS -     STATUS (ACTIVE OR QUEUED)



              ALLOCATION OUTPUT EXAMPLE -

              *SYSTEM*  *AQTOP*  M1M1M1M1M1M1  M2M2M2M2M2M2
              JJJJJJJJ  SSSSSSS  M1M1M1M1M1M1  M2M2M2M2M2M2


              WHERE -
                      1ST LINE IS SYSTEM WIDE ALLOCATION MASK
                      AND FOLLOWING LINES ARE JOB INFO

                      JJJJJJJJ -   JOBNAME OR ASID
                      SSSSSSS -    STATUS (ACTIVE OR QUEUED)
                                   OWNING -   JOB HOLDS MASK
                                   AQUEUE -   JOB QUEUED FOR 'A' QUEUE
                                   BQUEUE -   JOB QUEUED FOR 'AB' QUEUE
                                   WAITING -  OPERATOR REPLIED 'WAIT'
                      M1M1M1M1 -   A OWNERSHIP MASK
                      M2M2M2M2 -   B OWNERSHIP MASK
#$#

         #P           DISPLAY SU CONFIGURATION



             #P         DISPLAY NON-OBSOLETE INSTALLED SU'S

             #P I       DISPLAY ALL INSTALLED SU'S

             #P C       DISPLAY ALL NON-OBSOLETE SU'S

             #P A       DISPLAY ALL SU'S





-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------





      #Q  COMMAND     (ANALYZE ENQUE -   SEE ENQ/DEQ SUMMARY)



         #Q



                OUTPUT EXAMPLE -

                MAJOR= SYSDSN
                MINOR= SYS1.LINKLIB
                ROSLINK1  EXCL  RESERVE
                ROSLINK2  EXCL  RESERVE
                ROSLIST1  SHR



                IN RESPONSE TO THE #Q COMMAND THE CURRENT STATUS
                TYPES ARE:

                             SHR - SHARED USE ENQ
                             EXCL- EXCLUSIVE USE ENQ
                             RESERVE -  RESERVE INDICATOR
#$#
    #R  COMMAND   (DEVICE STATUS COMMAND)



     #R M              PENDING MOUNTS FOR TAPE

     #R T              TAPE BUSY AND PENDING MOUNTS

     #R D              DISK BUSY AND PENDING MOUNTS

     #R P              UNIT RECORD BUSY

     #R B              ALL DEVICE BUSY AND PENDING MOUNTS

     #R V              ALL PENDING VARIED OR UNLOADED DEVICES

     #R R              ALL RESERVES OUTSTANDING



     #R M=XXXXXXXX     PENDING MOUNTS FOR A JOB

     #R T=XXXXXXXX     ALLOCATED TAPE DEVICES FOR A JOB

     #R D=XXXXXXXX     ALLOCATED DISK DEVICES FOR A JOB

     #R P=XXXXXXXX     ALLOCATED UNIT RECORD DEVICES FOR A JOB

     #R B=XXXXXXXX     ALL ALLOCATED DEVICES FOR A JOB


         =XXXXXXXX     FOR ALL COMANDS IS EITHER A 4 DIGIT ASID OR A
                       1 - 8 DIGIT JOBNAME



     #R S=VVVVVV       DEVICE ON WHICH VOLUME VVVVVV IS MOUNTED


     #R U=NNN          DISPLAY SPECIFIED -

                           DEVICE          (NNN)
                           CONTROL UNIT    (NN)
                           CHANNEL         (N)






-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------






      #S  COMMAND     (DISPLAY LPA MODULES)



        #S PGMNAME   WILL DISPLAY LOAD MODULES IN FLPA, MLPA OR
        PLPA. THE VIRTUAL ADDRESS AND MODULES SIZE ARE DISPLAYED
        UNLESS THE MODULE  SPECIFIED IS REPRESENDED BY A MINOR
        CDE OR LPDE, IN WHICH CASE THE VIRUAL ADDRESS AND MAJOR
        NAME ARE DISPLAYED.

        #S *ADDR    WILL DISPLAY THE NAME OF THE LOAD MODULE
        AND ITS STARTING ADDRESS AND LENGTH.


        EXAMPLE -

        BBBBBB  NNNNNNNN  AAAAAA  LLLLLL  USE=CCCC

        WHERE -      BBBBBB -      IS THE LPDE OR CDE ADDRESS
                     NNNNNNNN -    IS THE MODULE NAME
                     AAAAAA -      IS THE MODULE ADDRESS
                     LLLLLL -      IS THE MODULE LENGTH
                     CCCC -        IS THE MODULE USE COUNT
#$#
      #T  COMMAND     (DISPLAY TIOT FOR A JOB)



            #T     NNNN         DISPLAY TIOT SHORT  ASID  NNNN
            #T     NNNN,L       DISPLAY TIOT LONG   ASID  NNNN



        EXAMPLE  SHORT FORM  -

        0006  JOBNAME1  STEPNAM1  PROCNAM1
        - DDNAME1  1A0  3350    MVSA37     6609


        EXAMPLE   LONG FORM  -

        0006  JOBNAME1  STEPNAM1  PROCNAM1
        - DDNAME1  1A0  3350    MVSA37     6609
        - SYS1.LINKLIB
        - DSO=(PO)  RFM=(U  )  LRECL=00000  BLKSZ=19069



        IN THE ABOVE EXAMPLES THE 1ST LINE IS THE JOB LINE
        THE 1ST DDLINE CONTAINS  DDNAME, UNIT ADDRESS, DEVICE TYPE,
        VOLSER, AND EXCP COUNT.
        THE 2ND DD LINE CONTAINS  DSNAME.
        THE 3RD DD LINE CONTAINS  DSORG, RECFM, LRECL, AND BLKSIZE.

        NOTE THAT THIS COMMAND EXECUTES AS AN SRB AND CONSEQUENTLY
        WILL OCCASIONALLY FAIL WITH NOTHING WRONG.  IN ADDITION, THIS
        COMMAND WILL ONLY WORK FOR JOBS WHICH ARE SWAPPED IN.
        STARTED TASKS WILL NOT DISPLAY ANY EXCP COUNTS.
#$#
      #V  COMMAND     (DISPLAY UNIT)



            #V D           (DISPLAY DASD MATRIX)
            #V D1          (DISPLAY 3330-1 MATRIX)
            #V D3          (DISPLAY 3330 MATRIX)
            #V D5          (DISPLAY 3350 MATRIX)
            #V T           (DISPLAY TAPE MATRIX)


            #V CUU         (DISPLAY SINGLE UNIT)

                EX.    #V 251


           #V CUX          (DISPLAY ALL UNITS BY CONTROL UNIT)

                EX.    #V 25X


           #V CUU,CUU...   (DISPLAY ALL UNITS IN LIST)

                EX.    #V 251,363,108,288


           #V CUX,CUX...   (DISPLAY ALL UNITS IN LIST BY C.U.)

                EX.    #V 25X,36X,47X


           #V S=VOLSER     (DISPLAY UNIT FOR THIS VOLSER)

                EX.    #V S=DAA001



           COMMAND OUTPUT IS AS FOLLOWS -


                 UUU  SSSSSS  FFF  UNIT=DDDDDD  AS=AAAA  PATH=X,Y
                    DCB=MM  USR=UU  RSV=RR  FLG=11111111/22222222
                                   - OR -
                    DEVTYPE=ZZZZZZZZ        FLG=11111111/22222222


                    UUU       IS THE UNIT ADDRESS
                    SSSSSS    THE VOLUME SERIAL OR DEVICE CLASS
                    FFF       ON, OFF, OF CHG
                    DDDDDD    THE DEVICE TYPE
                    AAAA      THE ADDRESS SPACE ID
                    X,Y       THE PRIMARY,SECONDARY DEVICE PATH
                    MM        THE NO. OF OPEN DCBS TO THE DEVICE
                    UU        THE NO. OF USERS
                    RR        THE DEVICE RESERVE COUNT
                    ZZZZZZZZ  THE 4 BYTE HEX DEVICE TYPE FIELD
                    1111/2222 THE FIRST 8 BYTES OF THE UCB IN HEX
#$#


     #Z     COMMAND (MODIFIED DISPLAY ACTIVE REPLACEMENT)

     #Z T   COMMAND (MODIFIED DISPLAY ACTIVE REPLACEMENT-TSO ONLY)

     #Z NN  COMMAND (MODIFIED DISPLAY ACTIVE REPLACEMENT-FOR

          EXAMPLE -


      *****   IN   QUEUE   ***** ASID DP PG QP SC FLAGS   CPU  CPUR
      MASTER                     0001 FF 00 01 00 NSW    1437 85564
      JES2     JES2     IEFPROC  0003 FF 09 02 00 NSW    1054 85514
      CMD1     CMD1     CMD1     0004 FF 12 03 00 NSW      11 86392
      FAT067D4 PROC#1   FAT067#3 0011 75 01 13 03 IN       76 14332
      CMDSBMON CMDSBMON CMDSBMON 0014 75 01 14 01 NSW       0 86399
      TCAMB    TCAMB    TCAM     0015 FC 06 05 00 NSW    1329 85291
      P731500A CIF408#1          0023 74 01 15 02 IN       48 14355
      DUMMYWTR 480      IEFPROC  0028 00 01 17 00 NSW     130 86272
      CBTLOG   CBTLOG   CBT290   0041 FC 01 06  R NSW       0 86399
      CIC888D0 PROC#1   DFHSIP#4 0046 FB 30 08 00 NSW     240 86110
      *****   OUT  QUEUE   ***** ASID DP PG SR SC FLAGS   CPU  CPUR
      ACF2     ACF2     IEFPROC  0002 FF 01 03 05 OUTLW     2 86397
      RMF      RMF      IEFPROC  0009 FF 00 03 56 OUTLW     3 86396
      TSSO     TSSO     TSSO     0040 FF 01 03 08 OUTLW     0 86399
      NCCF     NCCF     NCCF#1   004F FF 12 06 ** OUTMW     3 86396

         WHERE -

                ASID     ADDRESS SPACE ID
                DP       DISPATCHING PRIORITY
                PG       PERFORMANCE GROUP
                QP       ASCB QUEUE POSITION, WHICH IS
                         A RELATIVE DISPATCHING PRIORITY
                SR       SWAP REASON CODE AS IN THE OUTPUT
                         OF THE #I COMMAND
                SC       SWAP COUNT
                FLAGS    JOB STATUS DESCRIBED BELOW = XXXYY
                CPU      CPU/SRB ACCUMULATED JOB STEP TIME
                CPUR     CPU STEP TIME REMAINING
                XXX -
                    IN  -   IN CORE - SWAPPED IN
                    NSW -   NON-SWAPPABLE
                    OUT -   SWAPPED OUT
                    GOO -   IN PROCESS OF BEING SWAPPED OUT
                    GOI -   IN PROCESS OF BEING SWAPPED IN
                    GOB -   CURRENTLY CHANGING STATUS
                YY -
                    LW  -   LONG WAIT STATUS
                    MW  -   DETECTED WAIT
                    CP  -   SIGNIFICANT CPU USER
                    A   -   AUXILLARY STORAGE SHORTAGE
                    S   -   REAL STORAGE SHORTAGE

#$#


     ##A  COMMAND      (MONITOR JOB ACTIVITY)

     ##A D  COMMAND    (MONITOR DOMAIN ACTIVITY)

     ##A T  COMMAND    (MONITOR TSO USERS ACTIVITY)

     ##A NN  COMMAND   (MONITOR JOB ACTIVITY -  FOR DOMAIN  'NN')


     OUTPUT IS AS FOLLOWS -


                JOBNAME AND STEPNAME

                CPU PCT -   CURRENT CPU PERCENT BUSY

                SIO/SEC -   CURRENT EXCPS PER SEC

                PAG/SEC -   CURRENT PAGING PER SEC

                WORKSET -   CURRENT REAL STORAGE USE

                ASID -      ADDRESS SPACE ID

                DSP -       DISPATCHING PRTY

                DMN -       DOMAIN NUMBER

                PGN -       PERFORMANCE GROUP NUMBER

                SWC -       SWAP COUNT


                FLAGS -     FLAGS -  XX-NN

                            XX -   IN-  IN QUEUE
                            XX -   NS-  NON-SWAPPABLE
                            NN -   QUEUE POSITION
                            XX -   OU-  OUT QUEUE
                            NN -   SWAP REASON CODE
#$#
          ##BXXX,Y     MONITOR DEVICE BUSY FOR ALL DASD

          ##BUUU,Y     MONITOR DEVICE BUSY FOR DEVICE  UUU

          ##BUUX,Y     MONITOR DEVICE BUSY FOR DEVICES ON
                       CONTROL UNIT  UU


                       WHERE Y =  D -  DEVICE LIST
                                  J -  DEVICE AND JOB LIST
                                  S -  SEEK ANALYSIS


                       OUTPUT FORMAT AS FOLLOWS -

                       UUU VVVVVV  BUSY  NN%  NN%
                       -- JJJJJJJJ       NN%  NN%

                       NOTE -   TWO PERCENT BUSY VALUES ARE
                                DISPLAYED FOR DEVICE BUSY.

                                1ST -  DEVICE BUSY TOTAL
                                2ND -  DEVICE BUSY PRIMARY CHAN





-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------





          ##C          MONITOR CHANNEL BUSY
                       DISPLAY CHANNEL BUSY IN BOTH
                       NUMERIC AND BAR GRAPH FORM.


          ##CNN,Y      MONITOR CHANNEL AND DEVICE BUSY
                       DISPLAY CHANNEL AND DEVICE BUSY
                       FOR CHANNEL NN IN NUMERIC AND
                       BAR GRAPH FORM.


                       WHERE Y =  D -  DEVICE LIST
                                  J -  DEVICE AND JOB LIST



                  OUTPUT FORMAT AS FOLLOWS -

                  CHANNEL NN  BUSY       NN%
                  UUU VVVVVV  BUSY  NN%  NN%
                  -- JJJJJJJJ       NN%  NN%


                  NOTE -   TWO PERCENT BUSY VALUES ARE
                           DISPLAYED FOR DEVICE BUSY.

                           1ST -  DEVICE BUSY TOTAL
                           2ND -  DEVICE BUSY THIS CHANNEL
#$#


     ##J  COMMAND      (MONITOR JOBS)

     ##J T  COMMAND    (MONITOR TSO USERS)

     ##J NN  COMMAND   (MONITOR JOBS -  FOR DOMAIN  'NN')


          EXAMPLE  -

     *****   IN  QUEUE   *****    EXCPC   EXCPT    CPUC     CPUT
     JES2     JES2     IEFPROC      43    68,976   9.37   61.33.01
     TEST00   STEP1                 21     3,400   0.58       5.33
     TEST01   STEPX    ASMBLR      153   178,922  12.77    9.10.68
     TMSBKUP  FDR                    3       367   0.09       1.24
     *****   OUT  QUEUE   *****   EXCPC   EXCPT    CPUC     CPUT
     RMF      148      IEFPROC       0       666   0.00      11.98


      WHERE -

         EXCPC     EXCPT      CPUC      CPUT
        ------    -------    -------   -------

        XX,XXX   X,XXX,XXX   M.SS.TH  MMM.SS.TH


        EXCPC        IS THE EXCP COUNT FOR THE SAMPLED INTERVAL

        EXCPT        IS THE EXCP COUNT TOTAL FOR THE CURRENT STEP

        CPUC         IS THE CPU/SRB TIME FOR THE SAMPLED INTERVAL

        CPUT         IS THE CPU/SRB TIME TOTAL FOR THE CURRENT STEP
#$#


     ##P  COMMAND      (MONITOR PAGING)



        VIO PAGING        NNN.NN   PAGES/SEC
        SWAP PAGING       NNN.NN   PAGES/SEC
        COMMON PAGING     NNN.NN   PAGES/SEC
        ADDRSPC PAGING    NNN.NN   PAGES/SEC
        TOTAL PAGING      NNN.NN   PAGES/SEC





-----------------------------------------------------------------------
-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
-----------------------------------------------------------------------





         ##S          MONITOR SYSTEM INDICATORS
                      DISPLAYING AVERAGE, MINIMUM, AND MAXIMUM


         ##S D        MONITOR SYSTEM INDICATORS AND DOMAIN VALUES
                      DISPLAYING AVERAGE, MINIMUM, AND MAXIMUM


         ##S DA       MONITOR SYSTEM INDICATORS AND DOMAIN VALUES
                      DISPLAYING AVERAGE



                      SYSTEM INDICATORS -  LONG TERM CPU,
                           AVERAGE CPU, AVERAGE PAGING,
                           AVERAGE UIC, AND AVERAGE ASMQ.


                      DOMAIN VALUES -  WT, MIN, MAX AT INTERVAL START
                           TARGET MPL, CURRENT MPL, READY USERS,
                           GOING OUT USERS, OUT USERS, IN USERS,
                           WEIGHTED DOMAIN SERVICE
#$#

    THE FOLLOWING IS THE PRIMARY MENU SCREEN FOR CMDSBMON




 #####   CMD  SUB-SYSTEM  MONITOR   #####


 --->  ENTER  # CMDS,  ## CMDS,  OR  GRAPHIC MONITOR CMDS
              BEGINNING WHERE CURSOR IS POSITIONED


 --->  ENTER  NN/XX  TO CHANGE MONITOR REFRESH INTERVAL

              WHERE  NN  =   NUMBER OF SECONDS
                     XX  =   NUMBER OF INTERVALS


 --->  ENTER  ''Z''  OR  ''END''   TO TERMINATE


 --->  PRESS  PA1 TO STOP AUTOMATIC REFRESH
 --->  PRESS  PA2 OR CLEAR TO REPEAT THE LAST COMMAND
 --->  PRESS  PFK 1  TO DISPLAY PFK ASSIGNMENTS


 --->  ENTER  ''H''  TO OBTAIN HELP FOR GRAPHIC MONITOR CMDS
#$#

    THE FOLLOWING IS THE PFK MENU SCREEN FOR CMDSBMON




#####        PFK  ASSIGNMENTS        #####'


PFK1 =   DISPLAY PFK ASSIGNMENTS
PFK2 =   H
PFK3 =   E
PFK4 =   F
PFK5 =   J
PFK6 =   S
PFK7 =   #J
PFK8 =   #O
PFK9 =   #OX
PFK10 =  #Q
PFK11 =  ##SD
PFK12 =  05/50
PFK13 =  ##A,T=5
PFK14 =  H
PFK15 =  E
PFK16 =  F
PFK17 =  J
PFK18 =  S
PFK19 =  #J
PFK20 =  #O
PFK21 =  #OX
PFK22 =  #Q
PFK23 =  ##SD
PFK24 =  05/50



 --->  ENTER  NN=XXXX  AND PRESS PFK 1  TO CHANGE PFK FUNCTION'

              WHERE  NN -   IS THE PFK NUMBER  02 - 12'
                     XXXX - IS THE COMMAND TO BE ASSIGNED'
#$#
      GRAPHIC MONITOR COMMANDS



         ENTER  H X  FOR HELP WITH COMMAND  X'

         H -   (GH)  DISPLAY HELP
         A -   (GA)  DISPLAY JOB ACTIVITY
         E -   (GE)  DISPLAY EXCEPTIONS
         F -   (GF)  DISPLAY PAGE STATISTICS BY JOB
         J -   (GJ)  DISPLAY CPU UTILIZATION
         I -   (GI)  DISPLAY JES2 INITIATORS
         O -   (GO)  DISPLAY SYSTEM I/O ACTIVITY
         Q -   (GQ)  DISPLAY JES QUEUE  (MODIFIED Q CMD)
         S -   (GS)  DISPLAY SYSTEM INDICATORS
         U -   (GU)  DISPLAY DASD FREE SPACE
         # -   (SM)  DISPLAY HELP # COMMANDS

         FOLLOWING ARE FULL SCREEN POSITIONING COMMANDS.
         -NNN        SCROLL UP NNN LINES
         +NNN        SCROLL DOWN NNN LINES
         -           SCROLL TO TOP
         +           SCROLL TO BOTTOM
         =YXXXY      FIND STRING EQ XXX, Y IS DELIMITER
#$#
      GRAPHIC MONITOR COMMANDS



         A -         DISPLAY JOB ACTIVITY





         ANNNN       DISPLAY JOB ACTIVITY  FOR ASID NNNN


                     GRAPHIC DISPLAY OF -

                     JOBNAME,  STEPNAME,  PERCENT CPU
                     PERCENT CPU,
                     PAGE FRAME ALLOCATION,
                     PAGING IN PAGES PER SECOND,
                     AVERAGE JOB CPU UTILIZATION,
                     AVERAGE REAL FRAME USAGE,
                     CURRENT SWAP COUNT,
                     JOB I/O ACTIVITY.


                     JOB EXCEPTIONS AS FOLLOWS -

                     POSSIBLE LOOPS,
                     ABEND IN PROGRESS,
                     WAITING ON REPLIES,
                     WAITING ON ALLOCATION,
                     WAITING ON ENQUEUE CONFLICTS,
                     WAITING ON I/O PENDING,
                     WAITING TO BE SWAPPED IN.
#$#
      GRAPHIC MONITOR COMMANDS



         E -         DISPLAY EXCEPTIONS





         E -         DISPLAY ALL EXCEPTIONS
                     AUTOMATIC REFRESH MINIMUM 10 SEC

         ED -        DISPLAY EXCEPTIONS (NOT DEVICE)
                     AUTOMATIC REFRESH MINIMUM 10 SEC

         EC -        DISPLAY EXCEPTIONS (NOT CHAN/DEVICE)


                     EXCEPTIONAL SYSTEM CONDITIONS -

                     SQA SHORTAGE,
                     WTO BUFFER SHORTAGE,
                     EXCESS PAGING AND PAGE I/O BUSY,
                     EXCESS DEVICE UTILIZATION,
                     EXCESS CHANNEL UTILIZATION.


                     EXCEPTIONAL JOB CONDITIONS -

                     POSSIBLE LOOPS,
                     ABEND IN PROGRESS,
                     EXCESS JOB CPU UTILIZATION,
                     EXCESS REAL FRAME USAGE,
                     EXCESS SWAP COUNT,
                     WAITING ON REPLIES,
                     WAITING ON ALLOCATION,
                     WAITING ON ENQUEUE CONFLICTS,
                     WAITING ON I/O PENDING,
                     WAITING TO BE SWAPPED IN.
#$#



                   EXCEPTION MONITOR OUTPUT MESSAGES
                ---------------------------------------




    SYSTEM EXCEPTION MESSAGES
    --------------------------------------

    CHANNEL XX   XXX% BUSY  FOR XXXXX SEC
    UUU VVVVVV   XXX% BUSY  FOR XXXXX SEC
    UUU VVVVVV   NOT READY  FOR XXXXX SEC
    EXCESS SYSTEM PAGING FOR    XXXXX SEC
    LOCAL PAGE I/O DEGRADED FOR XXXXX SEC
    WTO BUFFER SHORTAGE, WQE COUNT= XXXXX
    SQA AVAIL= XXXXXK, CSA AVAIL= XXXXXK




    JOB RESOURCE USAGE EXCEPTION MESSAGES
    --------------------------------------

    JJJJJJJJ POSSIBLE LOOP FOR  XXXXX SEC
    JJJJJJJJ XXX% CPU FOR       XXXXX SEC
    JJJJJJJJ ABEND IN PROGRESS  XXXXX SEC
    JJJJJJJJ EXCESS SWAP COUNT = XXXXX
    JJJJJJJJ XXXXX FRAMES FOR   XXXXX SEC




    JOB WAIT EXCEPTION MESSAGES
    --------------------------------------

     ( NOTE -   A JOB IS CONSIDERED TO BE WAITING IF IT USES 0% CPU  )


    JJJJJJJJ ENQ SYSDSN   WAIT  XXXXX SEC       ENQ CONFLICT
    JJJJJJJJ I/O ON UUU   WAIT  XXXXX SEC       I/O PENDING
    JJJJJJJJ ALLOC QUEUE  WAIT  XXXXX SEC       ALLOC QUEUE
    JJJJJJJJ REPLY NN     WAIT  XXXXX SEC       REPLY PENDING
    JJJJJJJJ ???????????  WAIT  XXXXX SEC       REASON UNKNOWN
    JJJJJJJJ SWAP RRRRRR  WAIT  XXXXX SEC       SWAPPED OUT

       RRRRRR -     ( SWAP REASON CODES )
                    LONGWT           LONG WAIT
                    AUXSTOR          AUXILLARY STORAGE SHORTAGE
                    REALSTR          REAL STORAGE SHORTAGE
                    DETWAIT          MSO DETECTED WAIT
                    REQUEST          REQUEST SWAP
                    ENQEXC           ENQ EXCHANGE
                    WORKEXC          WORKLOAD EXCHANGE
                    UNILATR          UNILATERAL

#$#
      GRAPHIC MONITOR COMMANDS



         F -         DISPLAY PAGE STATISTICS





         F -         DISPLAY PAGE STATISTICS BY JOB


                     GRAPHIC DISPLAY OF -

                     PAGE FRAME ALLOCATION BY JOB AND
                     PAGING BY JOB IN PAGES PER SECOND.
#$#
      GRAPHIC MONITOR COMMANDS



         J -         DISPLAY CPU UTILIZATION






         JD -        DISPLAY CPU UTILIZATION

                     GRAPHIC DISPLAY OF -
                     ALL ACTIVE DOMAINS.


         J -         DISPLAY CPU UTILIZATION

                     GRAPHIC DISPLAY OF -
                     JOBNAME,  STEPNAME,  PERCENT CPU
                     UTILIZATION FOR ACTIVE JOBS.


         JT -        DISPLAY CPU UTILIZATION

                     GRAPHIC DISPLAY OF -
                     JOBNAME,  STEPNAME,  PERCENT CPU
                     UTILIZATION FOR ACTIVE TSO USERS.


         JNN -       DISPLAY CPU UTILIZATION

                     GRAPHIC DISPLAY OF -
                     JOBNAME,  STEPNAME,  PERCENT CPU
                     UTILIZATION FOR ALL JOBS IN DMN XX.

#$#
      GRAPHIC MONITOR COMMANDS



         I -         DISPLAY JES2 INITIATORS






         I -         DISPLAY JES2 INITIATORS


                     DISPLAY OF -

                     INITIATOR STATUS,
                     JOB NUMBER,
                     JOBNAME,
                     JOB CLASS,
                     INITIATOR CLASSES.
#$#
      GRAPHIC MONITOR COMMANDS



         O -         DISPLAY SYSTEM I/O ACTIVITY






         OXNN -      DISPLAY SYSTEM I/O ACTIVITY


                     WHERE -

                       X -   SCAN TYPE
                             A -   ALL DEVICES
                             V -   DASD AND TAPE
                             D -   DASD
                             T -   TAPE
                             U -   UNIT RECORD
                             C -   COMM AND DISPLAY

                       NN -  PERCENT BUSY THRESHOLD
                             20% BUSY IS THE DEFAULT
#$#
      GRAPHIC MONITOR COMMANDS



         Q -         DISPLAY JES QUEUE






         Q XXX       DISPLAY JES QUEUE  (MODIFIED Q CMD)


         (NNN)Q XXX  DISPLAY JES QUEUE  (MODIFIED Q CMD)


                     WHERE -

                       NNN -    IS THE NUMBER OF
                                1000 LINE SEGMENTS
                                TO INCREMENT INTO THE
                                DATA SET BEFORE
                                DISPLAY ANY DATA.

                       XXX -    IS THE Q COMMAND

                       H -         HELP WITH Q CMD
                       DI -        DISPLAY INPUT
                       DO -        DISPLAY OUTPUT
                       DA -        DISPLAY ACTIVE JOBS
                       DT -        DISPLAY ACTIVE TSO
                       DS -        DISPLAY ACTIVE STC
                       JLOG J -    DISPLAY JOBLOG JOB J
                       JCL J -     DISPLAY JOBJCL JOB J
                       JMSG J -    DISPLAY JOBMSG JOB J
                       DD J -      DISPLAY DD IDS JOB J
                       SL S -      DISPLAY SYSLOG STC S
                       L J DSID -  DISPLAY DATASET DSID
                                   JOB J


              NOTE -   J IS EITHER JOBNAME OR JOB NUMBER

              NOTE -   S IS STC NUMBER
#$#
      GRAPHIC MONITOR COMMANDS



         S -         DISPLAY SYSTEM INDICATORS






         S -         DISPLAY SYSTEM INDICATORS


                     GRAPHIC DISPLAY OF -

                     CURRENT AVERAGE CPU,
                     CURRENT LONG TERM CPU,
                     CURRENT AVERAGE PAGING,
                     CURRENT AVERAGE UIC,
                     CURRENT AVERAGE ASMQ LENGTH,  AND
                     CURRENT MPL FOR EACH DOMAIN
                     CONTAINING RUNNING JOBS.



         SA -        DISPLAY SYSTEM INDICATORS


                     GRAPHIC DISPLAY OF -

                     AVERAGE AVERAGE CPU,
                     AVERAGE LONG TERM CPU,
                     AVERAGE AVERAGE PAGING,
                     AVERAGE AVERAGE UIC,
                     AVERAGE AVERAGE ASMQ LENGTH,  AND
                     CURRENT MPL FOR EACH DOMAIN
                     CONTAINING RUNNING JOBS.
#$#
      GRAPHIC MONITOR COMMANDS



         U -         DISPLAY DASD SPACE






         U           DISPLAY DASD SPACE ALL ONLINE DASD


         U VVVV      DISPLAY DASD SPACE ON VOLUME VVVV
                     WHERE VVVV IS A 1-6 DIGIT VOLSER OR
                     VOLSER PREFIX


         U U=NNN     DISPLAY DASD SPACE ON UNIT NNN


         U D=XXXX    DISPLAY DASD SPACE ON DEVTYPE XXXX
                     (3330,3330V,3330-1,3350,2305-2)


                     DISPLAY OF -

                     UNIT, DEVTYPE, STATUS, VOLSER,
                     NO. OF DCBS OPEN, NO. OF USERS,
                     FREE CYLS, FREE TRKS, FREE EXTENTS,
                     LARGEST CONTIG EXTENT CYL/TRK
./       ADD   NAME=CMDDUMMY
         TITLE 'CMDDUMMY -   DUMMY # MODULE'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CMDDUMMY -       DUMMY # MODULE                           ***
***                                                                 ***
***       VERSION -        1.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***                                                                 ***
***       UPDATED -        02/20/77                                 ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
         EJECT
CMDDUMMY CSECT
*
* THIS MODULE MUST NOT EVER BE SMALLER THAN CMDSBSYS
* ELSE ALL # COMMANDS WILL OC1 (AT THE VERY LEAST)
*
         SR    15,15
         DS    CL4132
         END
./       ADD   NAME=CMDINSTL
//CMDSBJB1 JOB CLASS=R,REGION=512K,MSGCLASS=A
//*
//*  COMMENTED OUT THE QUE ASSEMBLIES (SEE MEMBER CALLED $QUE IN THIS
//*  PDS)  ARNOLD CASINGHINO UPDATE 09/16/84
//*
//*
//*   CMDINSTL  VERSION 2.4   LAST UPDATED 11/16/82
//*
//*
//DMALLOC PROC  ASMLIB='SYS1.CMDSBSYS.SOURCE',   THE PDS YOU GOT
//         LINKLIB='SYS1.CMDSBSYS.LOAD',
//         LINKUNT=3350,
//         LINKVOL=CMDVOL
//DMALLOC EXEC  PGM=IEFBR14
//LINKLIB  DD DSN=&LINKLIB.,UNIT=&LINKUNT.,VOL=SER=&LINKVOL.,
//         DISP=(,CATLG),SPACE=(CYL,(5,1,28)),
//         DCB=(RECFM=U,BLKSIZE=6144)
//        PEND
//DMASM    PROC   MEMBER=,LNCT=55,
//         ASMLIB='SYS1.CMDSBSYS.SOURCE',
//         LINKLIB='SYS1.CMDSBSYS.LOAD'
//ASM EXEC PGM=IEUASM,PARM=(LOAD,NODECK,'LINECNT=&LNCT.')
//SYSLIB   DD   DSN=SYS1.CMDSBSYS.SOURCE,DISP=SHR
//         DD   DSN=SYS1.HASPSRC,DISP=SHR
//         DD   DSN=SYS1.MACLIB,DISP=SHR
//         DD   DSN=SYS1.AMODGEN,DISP=SHR
//SYSUT1  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT2  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT3  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSPRINT  DD  SYSOUT=A
//SYSGO  DD  DSN=&&SYSGO,UNIT=SYSDA,SPACE=(TRK,(90,50)),
//    DISP=(,PASS)
//SYSIN    DD  DSN=&ASMLIB.(&MEMBER.),DISP=SHR
//LKED EXEC PGM=IEWL,
//          PARM='XREF,LET,LIST,AC=1,SIZE=(140K,6400)'
//SYSLIN   DD   DSN=&&SYSGO,DISP=(OLD,DELETE)
//     DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=A
//     PEND
//ALLOC  EXEC DMALLOC
//ASMPR  EXEC DMASM,MEMBER=CMDPRINT
//DOCCMD1 EXEC  PGM=CMDPRINT,PARM='01072'
//STEPLIB  DD  DSN=SYS1.CMDSBSYS.LOAD,DISP=SHR
//SYSPRINT DD   SYSOUT=A
//SYSUDUMP DD   SYSOUT=A
#$#
                    VERSION
             $DOC         .COMMAND SUB-SYSTEM -   (ADDIT DOCUMENTATION)
             $HELP        .COMMAND SUB-SYSTEM -   (TSO HELP MEMBER)
             $HINTS       .COMMAND SUB-SYSTEM -   (ADDIT INSTALL HINTS)
             $JCL         .COMMAND SUB-SYSTEM -   (JCL TO RUN CMD1)
             $MODS        .COMMAND SUB-SYSTEM -   (MVSMODS IEBCOPY)
             CMDDOCTN     .COMMAND SUB-SYSTEM -   (DOCUMENTATION)
             CMDDUMMY     .COMMAND SUB-SYSTEM -   (CMDDUMMY MODULE)
             CMDINSTL     .COMMAND SUB-SYSTEM -   (INSTALLATION JCL)
             CMDPRINT     .COMMAND SUB-SYSTEM -   (DOCUMENTATION PRINT)
             CMDSBCSC     .COMMAND SUB-SYSTEM -   (CROSS-SYSTEM CNTRL)
             CMDSBINT     .COMMAND SUB-SYSTEM -   (INIT AND MONITOR)
             CMDSBMON     .COMMAND SUB-SYSTEM -   (STANDALONE MONITOR)
             CMDSBSYS     .COMMAND SUB-SYSTEM -   (PROCESSOR)
             CMDSBTSO     .COMMAND SUB-SYSTEM -   (TSO FULL SCREEN MON)
             CMDTSO       .COMMAND SUB-SYSTEM -   (TSO DIRECTOR)
             CSCGA03D     .COMMAND SUB-SYSTEM -   (A - ACTIVITY MON.)
             CSCGE03D     .COMMAND SUB-SYSTEM -   (E - EXCEPTION MON.)
             CSCGF03D     .COMMAND SUB-SYSTEM -   (F - FRAME USE GRAPH)
             CSCGH03D     .COMMAND SUB-SYSTEM -   (H - HELP FOR GRAPH)
             CSCGI03D     .COMMAND SUB-SYSTEM -   (I - JES2 INIT DISP)
             CSCGJ03D     .COMMAND SUB-SYSTEM -   (J - JOB CPU GRAPH)
             CSCGO03D     .COMMAND SUB-SYSTEM -   (O - I/O ACTIVITY)
             CSCGQ03D     .COMMAND SUB-SYSTEM -   (Q - QUE)
             CSCGS03D     .COMMAND SUB-SYSTEM -   (S - SYS. IND. GRAPH)
             CSCGU03D     .COMMAND SUB-SYSTEM -   (U -DASD SPACE DISPL)
CSCSA03D     IEESA03D     .COMMAND SUB-SYSTEM -   (#N -  D ENQ P1)
CSCSB03D     IEESB03D     .COMMAND SUB-SYSTEM -   (#N -  D ENQ P2)
CSCSC03D     IEESC03D     .COMMAND SUB-SYSTEM -   (#L -  D LINES)
CSCSD03D     IEESD03D     .COMMAND SUB-SYSTEM -   (#D -  COREZAP)
CSCSE03D     IEESE03D     .COMMAND SUB-SYSTEM -   (#A -  ASCB INFO)
CSCSF03D     IEESF03D     .COMMAND SUB-SYSTEM -   (#F -  D FRAMES)
CSCSG03D     IEESG03D     .COMMAND SUB-SYSTEM -   (#R -  D ALLOC)
CSCSH03D     IEESH03D     .COMMAND SUB-SYSTEM -   (#S -  D LPA)
CSCSI03D     IEESI03D     .COMMAND SUB-SYSTEM -   (#V -  D DEVICE)
CSCSJ03D     IEESJ03D     .COMMAND SUB-SYSTEM -   (#I -  D PAGES)
CSCSK03D     IEESK03D     .COMMAND SUB-SYSTEM -   (#C -  CALCULATOR)
CSCSL03D     IEESL03D     .COMMAND SUB-SYSTEM -   (#J -  D A)
CSCSZ03D     IEESZ03D     .COMMAND SUB-SYSTEM -   (#Z -  D A)
CSCSM03D     IEESM03D     .COMMAND SUB-SYSTEM -   (#H -  HELP)
CSCSN03D     IEESN03D     .COMMAND SUB-SYSTEM -   (#T -  D TIOT)
CSCSO03D     IEESO03D     .COMMAND SUB-SYSTEM -   (#M -  TSO SEND)
CSCSP0ED     IEESP03D     .COMMAND SUB-SYSTEM -   (#P -  D SU)
CSCSQ03D     IEESQ03D     .COMMAND SUB-SYSTEM -   (#Q -  ANALYZE ENQ)
CSCSR03D     IEESR03D     .COMMAND SUB-SYSTEM -   (#O -  I/O PENDING)
CSCSS03D     IEESS03D     .COMMAND SUB-SYSTEM -   (#E -  EXECUTE)
CSCZA03D     IEEZA03D     .COMMAND SUB-SYSTEM -   (##A -  ACTIVITY MON.)
CSCZB03D     IEEZB03D     .COMMAND SUB-SYSTEM -   (##B -  DEVICE MON.)
CSCZC03D     IEEZC03D     .COMMAND SUB-SYSTEM -   (##C -  CHANNEL MON.)
CSCZJ03D     IEEZJ03D     .COMMAND SUB-SYSTEM -   (##J -  JOB MON.)
CSCZP03D     IEEZP03D     .COMMAND SUB-SYSTEM -   (##P -  PAGING MON.)
CSCZS03D     IEEZS03D     .COMMAND SUB-SYSTEM -   (##S -  SYSIND MON.)
             NSEGF03D     .CMD SUB-SYS (NONSE) -  (F - FRAME USE GRAPH)
             NSEGJ03D     .CMD SUB-SYS (NONSE) -  (J - JOB CPU GRAPH)
             NSEGS03D     .CMD SUB-SYS (NONSE) -  (S - SYS. IND. GRAPH)
             NSESE03D     .CMD SUB-SYS (NONSE) -  (#A -  ASCB INFO)
             NSESJ03D     .CMD SUB-SYS (NONSE) -  (#I -  D PAGES)
             NSESL03D     .CMD SUB-SYS (NONSE) -  (#J -  D A)
             NSEZJ03D     .CMD SUB-SYS (NONSE) -  (##J -  JOB MON.)
             NSEZS03D     .CMD SUB-SYS (NONSE) -  (##S -  SYSIND MON.)
#$#
             MACROS VERSION  FOR CMDSBMON
             ALLOC    1.0 .MACRO NEEDED FOR CMDSBMON
             DYNSPACE 1.0 .MACRO NEEDED FOR CMDSBMON
             FREE     1.0 .MACRO NEEDED FOR CMDSBMON
             RCPBFRGS 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPBTU   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPBTU2  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPCKID  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDDN   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDDNRT 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDEBUG 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDFPL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDINC  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDISP  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDS    1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSECT 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSN   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSNPD 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSNRT 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSRGR 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDUMMY 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPENDD  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFDDN  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFDISP 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFDSN  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFHOLD 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFORUS 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFREE  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPIOPL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLINK  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOAD  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOCSW 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOCS1 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOCS2 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPMCA   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPNTU   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPERM  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPPL   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPROC  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPSWD  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPQNAME 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPRNGE  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSPACE 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSPEC  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSR2   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSSREQ 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSUBL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSYSOU 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTU    1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTUBFR 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTXTL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTYPE  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPUNALC 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPUNIT  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPVCHAR 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPVOLRT 1.0 .MACRO NEEDED FOR CMDSBMON
             S99FAIL  1.0 .MACRO NEEDED FOR CMDSBMON
#$#
                   VERSION
             CSCGQQ00 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - QUEUECMN)
             CSCGQQ01 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - QUEUE)
             CSCGQQ02 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - ALLOCATE)
             CSCGQQ03 1.1 .CMD SUB-SYSTEM -       (Q - QCMD - CKPT)
             CSCGQQ04 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - DDNAME)
             CSCGQQ05 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - DISPLAY)
             CSCGQQ05 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - DISPLAY)
             CSCGQQ06 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - FINDJOB)
             CSCGQQ07 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - FORMAT)
             CSCGQQ08 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - HELP)
             CSCGQQ09 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - HEXBLK)
             CSCGQQ10 1.1 .CMD SUB-SYSTEM -       (Q - QCMD - INIT)
             CSCGQQ11 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - JCL)
             CSCGQQ12 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - JLOG)
             CSCGQQ13 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - JMSG)
             CSCGQQ14 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - LIST)
             CSCGQQ15 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - LISTDS)
             CSCGQQ16 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - PARSE)
             CSCGQQ17 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - READSPC)
             CSCGQQ18 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - REPOS)
             CSCGQQ19 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - SAVE)
             CSCGQQ20 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - SEARCH)
             CSCGQQ21 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - SYSLOG)
             CSCGQQ22 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - XDS)
#$#
                   VERSION
             MACROS VERSION  FOR THE QUE COMMAND
             $JQT     1.0 .MACRO NEEDED FOR QUEUE
             QCLNK    1.0 .MACRO NEEDED FOR QUEUE
             QCOMMON  1.1 .MACRO NEEDED FOR QUEUE
             QSTART   1.1 .MACRO NEEDED FOR QUEUE
             QSTOP    1.0 .MACRO NEEDED FOR QUEUE
             QTILT    1.0 .MACRO NEEDED FOR QUEUE
/*
//DOCCMD2 EXEC  PGM=CMDPRINT,PARM='01072'
//STEPLIB  DD  DSN=SYS1.CMDSBSYS.LOAD,DISP=SHR
//SYSPRINT DD   SYSOUT=A
//SYSUDUMP DD   SYSOUT=A
//SYSIN    DD   DSN=SYS1.CMDSBSYS.SOURCE(CMDDOCTN),DISP=SHR
//UPD1    EXEC  PGM=IEBUPDTE,PARM=NEW
//SYSPRINT DD SYSOUT=A
//SYSUT1   DD DSN=SYS1.PROCLIB,DISP=SHR
//SYSUT2   DD DSN=SYS1.PROCLIB,DISP=SHR
//SYSIN  DD  DATA
./ ADD NAME=CMD1                           CHANGE THIS CARD TO ./
//CMD1   PROC  A=ASE0,
//             B='$',
//             C=CSK0,
//             D=DSD0,
//             E=ESS0,
//             F=FSF0,
//             G='$',
//             H=HSM0,
//             I=ISJ0,
//             J=JSL0,
//             K='$',
//             L=LSC0,
//             M=MSO0,
//             N=NSA0,
//             O=OSR0,
//             P=PSP0,
//             Q=QSQ0,
//             R=RSG0,
//             S=SSH0,
//             T=TSN0,
//             U='$',
//             V=VSI0,
//             W='$',
//             X='$',
//             Y='$',
//             Z=ZSZ0
//CMD1  EXEC PGM=CMDSBINT,TIME=1440,DPRTY=(15,10)
// PARM='&A&B&C&D&E&F&G&H&I&J&K&L&M&N&O&P&Q&R&S&T&U&V&W&X&Y&Z'
//SYSUDUMP  DD  SYSOUT=A
//CSC#ASYS  DD  DUMMY
//CSC#BSYS  DD  DUMMY
//CSC#CSYS  DD  DUMMY
//CSCDATA   DD  DSN=SYS1.SYSTEM.CMDSBSYS.CSCDATA,DISP=SHR
//*
//*      WHERE  -    FOR CSC#.... REPLACE .... WITH SMF SYSID OF ONE
//*                  OF THE SYSTEMS USING CROSS-SYSTEM COMMANDS.
//*                  AS MANY CSC#.... DD CARDS AS NECESSARY MAY EXIST.
//*
./ ADD NAME=CMDSBMON                          CHANGE THIS CARD TO ./
//CMDSBMON  PROC  U=XXX
//CMDSBMON  EXEC  PGM=CMDSBMON,PARM='&U.',REGION=8000K
//SYSUDUMP  DD    SYSOUT=A
//CMDLOG    DD    SYSOUT=A
//CSCDATA  DD  DSN=SYS1.SYSTEM.CMDSBSYS.CSCDATA,DISP=SHR
//*   WHERE  XXX  IS THE 3270 UNIT ADDRESS
/*
//*
//*
//*     END OF CMD SUB-SYSTEM INSTALL JOB 1
//*
//*
//CMDSBJB2 JOB CLASS=R,REGION=512K,MSGCLASS=A
//DMASM    PROC   MEMBER=,LNCT=55,
//         ASMLIB='SYS1.CMDSBSYS.SOURCE',
//         LINKLIB='SYS1.CMDSBSYS.LOAD'
//ASM EXEC PGM=IEUASM,PARM=(LOAD,NODECK,'LINECNT=&LNCT.')
//SYSLIB   DD   DSN=SYS1.CMDSBSYS.SOURCE,DISP=SHR
//         DD   DSN=SYS1.HASPSRC,DISP=SHR
//         DD   DSN=SYS1.MACLIB,DISP=SHR
//         DD   DSN=SYS1.AMODGEN,DISP=SHR
//SYSUT1  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT2  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT3  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSPRINT  DD  SYSOUT=A
//SYSGO  DD  DSN=&&SYSGO,UNIT=SYSDA,SPACE=(TRK,(90,50)),
//    DISP=(,PASS)
//SYSIN    DD  DSN=&ASMLIB.(&MEMBER.),DISP=SHR
//DMLINK EXEC PGM=IEWL,
//          PARM='XREF,LET,LIST,AC=1,SIZE=(140K,6400)'
//SYSLIN   DD   DSN=&&SYSGO,DISP=(OLD,DELETE)
//     DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=A
//     PEND
//DMLINK   PROC   MEMBER=,
//         LINKLIB='SYS1.CMDSBSYS.LOAD'
//DMLINK EXEC PGM=IEWL,
//          PARM='XREF,LET,LIST,AC=1,SIZE=(140K,6400)'
//SYSLIN   DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=A
//     PEND
//ASM00 EXEC DMASM,MEMBER=CMDDUMMY
//ASM01 EXEC DMASM,MEMBER=CMDSBCSC
//ASM02 EXEC DMASM,MEMBER=CMDSBINT
//ASM03 EXEC DMASM,MEMBER=CMDSBSYS
//ASM04 EXEC DMASM,MEMBER=CMDTSO
//ASM05 EXEC DMASM,MEMBER=CMDSBTSO
//ASM05A EXEC DMASM,MEMBER=CMDSBMON
//ASM06 EXEC DMASM,MEMBER=CSCSB03D
//ASM07 EXEC DMASM,MEMBER=CSCSA03D
//DMLINK.SYSIN DD *
 INCLUDE SYSLIB(CSCSB03D)
 ENTRY IEESA03D
/*
//ASM08 EXEC DMASM,MEMBER=CSCSC03D
//ASM09 EXEC DMASM,MEMBER=CSCSD03D
//ASM10 EXEC DMASM,MEMBER=CSCSE03D
//ASM11 EXEC DMASM,MEMBER=CSCSF03D
//ASM12 EXEC DMASM,MEMBER=CSCSG03D
//ASM13 EXEC DMASM,MEMBER=CSCSH03D
//ASM14 EXEC DMASM,MEMBER=CSCSI03D
//ASM15 EXEC DMASM,MEMBER=CSCSJ03D
//ASM16 EXEC DMASM,MEMBER=CSCSK03D
//ASM17 EXEC DMASM,MEMBER=CSCSL03D
//ASM17A EXEC DMASM,MEMBER=CSCSZ03D
//ASM18 EXEC DMASM,MEMBER=CSCSM03D
//ASM19 EXEC DMASM,MEMBER=CSCSN03D
//ASM20 EXEC DMASM,MEMBER=CSCSO03D
//ASM21 EXEC DMASM,MEMBER=CSCSP03D
//ASM22 EXEC DMASM,MEMBER=CSCSQ03D
//ASM23 EXEC DMASM,MEMBER=CSCSR03D
//ASM24 EXEC DMASM,MEMBER=CSCSS03D
//ASM25 EXEC DMASM,MEMBER=CSCZB03D
//ASM26 EXEC DMASM,MEMBER=CSCZC03D
//ASM27 EXEC DMASM,MEMBER=CSCZJ03D
//ASM28 EXEC DMASM,MEMBER=CSCZP03D
//ASM29 EXEC DMASM,MEMBER=CSCZS03D
//ASM30 EXEC DMASM,MEMBER=CSCGA03D
//ASM31 EXEC DMASM,MEMBER=CSCGE03D
//ASM32 EXEC DMASM,MEMBER=CSCGF03D
//ASM33 EXEC DMASM,MEMBER=CSCGH03D
//ASM34 EXEC DMASM,MEMBER=CSCGJ03D
//ASM35 EXEC DMASM,MEMBER=CSCGO03D
//ASM36 EXEC DMASM,MEMBER=CSCGS03D
//*ASM37 EXEC DM*ASM,MEMBER=CSCGQQ00
//*ASM38 EXEC DM*ASM,MEMBER=CSCGQQ01
//*ASM39 EXEC DM*ASM,MEMBER=CSCGQQ02
//*ASM40 EXEC DM*ASM,MEMBER=CSCGQQ03
//*ASM41 EXEC DM*ASM,MEMBER=CSCGQQ04
//*ASM42 EXEC DM*ASM,MEMBER=CSCGQQ05
//*ASM43 EXEC DM*ASM,MEMBER=CSCGQQ06
//*ASM44 EXEC DM*ASM,MEMBER=CSCGQQ07
//*ASM45 EXEC DM*ASM,MEMBER=CSCGQQ08
//*ASM46 EXEC DM*ASM,MEMBER=CSCGQQ09
//*ASM47 EXEC DM*ASM,MEMBER=CSCGQQ10
//*ASM48 EXEC DM*ASM,MEMBER=CSCGQQ11
//*ASM49 EXEC DM*ASM,MEMBER=CSCGQQ12
//*ASM50 EXEC DM*ASM,MEMBER=CSCGQQ13
//*ASM51 EXEC DM*ASM,MEMBER=CSCGQQ14
//*ASM52 EXEC DM*ASM,MEMBER=CSCGQQ15
//*ASM53 EXEC DM*ASM,MEMBER=CSCGQQ16
//*ASM54 EXEC DM*ASM,MEMBER=CSCGQQ17
//*ASM55 EXEC DM**ASM,MEMBER=CSCGQQ18
//*ASM56 EXEC DM*ASM,MEMBER=CSCGQQ19
//*ASM57 EXEC DM*ASM,MEMBER=CSCGQQ20
//*ASM58 EXEC DM*ASM,MEMBER=CSCGQQ21
//*ASM59 EXEC DM*ASM,MEMBER=CSCGQQ22
//*LNK60 EXEC DMLINK,MEMBER=CSCGQ03D
//*DMLINK.SYSIN DD *
//*  INCLUDE SYSLIB(CSCGQQ01)
//*  INCLUDE SYSLIB(CSCGQQ02)
//*  INCLUDE SYSLIB(CSCGQQ03)
//*  INCLUDE SYSLIB(CSCGQQ04)
//*  INCLUDE SYSLIB(CSCGQQ05)
//*  INCLUDE SYSLIB(CSCGQQ06)
//*  INCLUDE SYSLIB(CSCGQQ07)
//*  INCLUDE SYSLIB(CSCGQQ08)
//*  INCLUDE SYSLIB(CSCGQQ09)
//*  INCLUDE SYSLIB(CSCGQQ10)
//*  INCLUDE SYSLIB(CSCGQQ11)
//*  INCLUDE SYSLIB(CSCGQQ12)
//*  INCLUDE SYSLIB(CSCGQQ13)
//*  INCLUDE SYSLIB(CSCGQQ14)
//*  INCLUDE SYSLIB(CSCGQQ15)
//*  INCLUDE SYSLIB(CSCGQQ16)
//*  INCLUDE SYSLIB(CSCGQQ17)
//*  INCLUDE SYSLIB(CSCGQQ18)
//*  INCLUDE SYSLIB(CSCGQQ19)
//*  INCLUDE SYSLIB(CSCGQQ20)
//*  INCLUDE SYSLIB(CSCGQQ21)
//*  INCLUDE SYSLIB(CSCGQQ22)
//*  ENTRY QUEUE
//* /*
//ASM61 EXEC DMASM,MEMBER=CSCZA03D
//ASM62 EXEC DMASM,MEMBER=CSCGI03D
//ASM63 EXEC DMASM,MEMBER=CSCGU03D
//*
//*
//*     END OF CMD SUB-SYSTEM INSTALL JOB 2
//*
//*
//CMDSBJB3 JOB CLASS=R,REGION=512K,MSGCLASS=A
//*
//*
//*   EXECUTE THIS JOB FOR NON-SE SYSTEMS ONLY
//*
//*
//*
//DMASM    PROC   MEMBER=,LNCT=55,LINKMEM=,
//         ASMLIB='SYS1.CMDSBSYS.SOURCE',
//         LINKLIB='SYS1.CMDSBSYS.LOAD'
//ASM EXEC PGM=IEUASM,PARM=(LOAD,NODECK,'LINECNT=&LNCT.')
//SYSLIB   DD   DSN=SYS1.CMDSBSYS.SOURCE,DISP=SHR
//         DD   DSN=SYS1.MACLIB,DISP=SHR
//         DD   DSN=SYS1.AMODGEN,DISP=SHR
//SYSUT1  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT2  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT3  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSPRINT  DD  SYSOUT=A
//SYSGO  DD  DSN=&&SYSGO,UNIT=SYSDA,SPACE=(TRK,(90,50)),
//    DISP=(,PASS)
//SYSIN    DD  DSN=&ASMLIB.(&MEMBER.),DISP=SHR
//LKED EXEC PGM=IEWL,
//          PARM='XREF,LET,LIST,AC=1,SIZE=(140K,6400)'
//SYSLIN   DD   DSN=&&SYSGO,DISP=(OLD,DELETE)
//     DD   DDNAME=SYSIN
//SYSLMOD DD DSN=&LINKLIB.(&LINKMEM.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=A
//     PEND
//ASM01 EXEC DMASM,MEMBER=NSESE03D,LINKMEM=CSCSE03D
//ASM02 EXEC DMASM,MEMBER=NSESJ03D,LINKMEM=CSCSJ03D
//ASM03 EXEC DMASM,MEMBER=NSESL03D,LINKMEM=CSCSL03D
//ASM04 EXEC DMASM,MEMBER=NSEZJ03D,LINKMEM=CSCZJ03D
//ASM05 EXEC DMASM,MEMBER=NSEZS03D,LINKMEM=CSCZS03D
//ASM06 EXEC DMASM,MEMBER=NSEGF03D,LINKMEM=CSCGF03D
//ASM07 EXEC DMASM,MEMBER=NSEGJ03D,LINKMEM=CSCGJ03D
//ASM08 EXEC DMASM,MEMBER=NSEGS03D,LINKMEM=CSCGS03D
//*
//*
//*     END OF CMD SUB-SYSTEM INSTALL JOB 3
//*
//*  -------------------------------------------------------------
//CMDSBJB4 JOB CLASS=R,REGION=512K,MSGCLASS=A
//DMCOPY   PROC   LINKLIB='SYS1.CMDSBSYS.LOAD',
//         TARGLIB=
//DMCOPY EXEC PGM=IEBCOPY
//SYSPRINT  DD  SYSOUT=A
//SYSUT1  DD DSN=&LINKLIB.,DISP=SHR
//SYSUT2  DD DSN=&TARGLIB.,DISP=SHR
//SYSUT3 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSUT4 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//     PEND
//COPY1 EXEC DMCOPY,TARGLIB='SYS1.LINKLIB'    ANY LINKLIST LIBRARY
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CMDPRINT,,R))
 S M=((CMDSBCSC,,R))
 S M=((CMDSBINT,,R))
 S M=((CMDSBSYS,,R))
 S M=((CMDSBMON,,R))
 S M=((CSCSA03D,,R))
 S M=((CSCSC03D,,R))
 S M=((CSCSD03D,,R))
 S M=((CSCSE03D,,R))
 S M=((CSCSF03D,,R))
 S M=((CSCSG03D,,R))
 S M=((CSCSH03D,,R))
 S M=((CSCSI03D,,R))
 S M=((CSCSJ03D,,R))
 S M=((CSCSK03D,,R))
 S M=((CSCSL03D,,R))
 S M=((CSCSM03D,,R))
 S M=((CSCSN03D,,R))
 S M=((CSCSO03D,,R))
 S M=((CSCSP03D,,R))
 S M=((CSCSQ03D,,R))
 S M=((CSCSR03D,,R))
 S M=((CSCSS03D,,R))
 S M=((CSCSZ03D,,R))
 S M=((CSCZA03D,,R))
 S M=((CSCZB03D,,R))
 S M=((CSCZC03D,,R))
 S M=((CSCZJ03D,,R))
 S M=((CSCZP03D,,R))
 S M=((CSCZS03D,,R))
/*
//COPY2 EXEC DMCOPY,TARGLIB='SYS1.LPALIB'   LPA FOR OPER COMMANDS
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CMDDUMMY,,R))
 S M=((CSCSA03D,IEESA03D,R))
 S M=((CSCSC03D,IEESC03D,R))
 S M=((CSCSD03D,IEESD03D,R))
 S M=((CSCSE03D,IEESE03D,R))
 S M=((CSCSF03D,IEESF03D,R))
 S M=((CSCSG03D,IEESG03D,R))
 S M=((CSCSH03D,IEESH03D,R))
 S M=((CSCSI03D,IEESI03D,R))
 S M=((CSCSJ03D,IEESJ03D,R))
 S M=((CSCSK03D,IEESK03D,R))
 S M=((CSCSL03D,IEESL03D,R))
 S M=((CSCSM03D,IEESM03D,R))
 S M=((CSCSN03D,IEESN03D,R))
 S M=((CSCSO03D,IEESO03D,R))
 S M=((CSCSP03D,IEESP03D,R))
 S M=((CSCSQ03D,IEESQ03D,R))
 S M=((CSCSR03D,IEESR03D,R))
 S M=((CSCSS03D,IEESS03D,R))
 S M=((CSCSS03D,IEESZ03D,R))
 S M=((CSCZA03D,IEEZA03D,R))
 S M=((CSCZB03D,IEEZB03D,R))
 S M=((CSCZC03D,IEEZC03D,R))
 S M=((CSCZJ03D,IEEZJ03D,R))
 S M=((CSCZP03D,IEEZP03D,R))
 S M=((CSCZS03D,IEEZS03D,R))
/*
//COPY3 EXEC DMCOPY,TARGLIB='SYS1.TSOLIB' FULL SCREEN FOR TSO AND OPER
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CMDTSO,,R))
 S M=((CMDSBTSO,,R))
 S M=((CSCGA03D,,R))        ACTIVITY MONITOR
 S M=((CSCGE03D,,R))        EXCEPTION MONITOR
 S M=((CSCGF03D,,R))        JOB FRAME MONITOR
 S M=((CSCGH03D,,R))        HELP FOR GRAPH MONITORS
 S M=((CSCGI03D,,R))        JES2 INIT DISPLAY
 S M=((CSCGJ03D,,R))        JOB CPU MONITOR
 S M=((CSCGO03D,,R))        I/O ACTIVITY MONITOR
 S M=((CSCGQ03D,,R))        QUE COMMAND
 S M=((CSCGS03D,,R))        SYSTEM IND. GRAPH
 S M=((CSCGU03D,,R))        DASD FREE SPACE
/*
./       ADD   NAME=CMDINSXA
//CMDSBJB1 JOB CLASS=R,REGION=512K,MSGCLASS=A
//*
//*  COMMENTED OUT THE QUE ASSEMBLIES (SEE MEMBER CALLED $QUE IN THIS
//*  PDS)  ARNOLD CASINGHINO UPDATE 09/16/84
//*
//*
//*   CMDINSTL  VERSION 2.4   LAST UPDATED 11/16/82
//*
//*
//DMALLOC PROC  ASMLIB='SFT.XA213#.SOURCE',      THE PDS YOU GOT
//         LINKLIB='SYS1.XA213#.LOAD',
//         LINKUNT=3380,
//         LINKVOL=SYS002
//DMALLOC EXEC  PGM=IEFBR14
//LINKLIB  DD DSN=&LINKLIB.,UNIT=&LINKUNT.,VOL=SER=&LINKVOL.,
//         DISP=(,CATLG),SPACE=(CYL,(5,1,28)),
//         DCB=(RECFM=U,BLKSIZE=6144)
//        PEND
//DMASM    PROC   MEMBER=,LNCT=55,
//         ASMLIB='SFT.XA213#.SOURCE',
//         LINKLIB='SYS1.XA213#.LOAD'
//ASM EXEC PGM=IEUASM,PARM=(LOAD,NODECK,'LINECNT=&LNCT.')
//SYSLIB   DD   DSN=&ASMLIB,DISP=SHR
//         DD   DSN=SYS1.HASPSRC,DISP=SHR
//         DD   DSN=SYS1.MACLIB,DISP=SHR
//         DD   DSN=SYS1.AMODGEN,DISP=SHR
//SYSUT1  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT2  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT3  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSPRINT  DD  SYSOUT=A
//SYSGO  DD  DSN=&&SYSGO,UNIT=SYSDA,SPACE=(TRK,(90,50)),
//    DISP=(,PASS)
//SYSIN    DD  DSN=&ASMLIB.(&MEMBER.),DISP=SHR
//LKED EXEC PGM=IEWL,
//          PARM='XREF,LET,LIST,AC=1,SIZE=(140K,6400)'
//SYSLIN   DD   DSN=&&SYSGO,DISP=(OLD,DELETE)
//     DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=A
//     PEND
//ALLOC  EXEC DMALLOC
//ASMPR  EXEC DMASM,MEMBER=CMDPRINT
//DOCCMD1 EXEC  PGM=CMDPRINT,PARM='01072'
//STEPLIB  DD  DSN=SYS1.XA213#.LOAD,DISP=SHR
//SYSPRINT DD   SYSOUT=A
//SYSUDUMP DD   SYSOUT=A
#$#
                    VERSION
             $DOC         .COMMAND SUB-SYSTEM -   (ADDIT DOCUMENTATION)
             $HELP        .COMMAND SUB-SYSTEM -   (TSO HELP MEMBER)
             $HINTS       .COMMAND SUB-SYSTEM -   (ADDIT INSTALL HINTS)
             $JCL         .COMMAND SUB-SYSTEM -   (JCL TO RUN CMD1)
             $MODS        .COMMAND SUB-SYSTEM -   (MVSMODS IEBCOPY)
             CMDDOCTN     .COMMAND SUB-SYSTEM -   (DOCUMENTATION)
             CMDDUMMY     .COMMAND SUB-SYSTEM -   (CMDDUMMY MODULE)
             CMDINSTL     .COMMAND SUB-SYSTEM -   (INSTALLATION JCL)
             CMDPRINT     .COMMAND SUB-SYSTEM -   (DOCUMENTATION PRINT)
             CMDSBCSC     .COMMAND SUB-SYSTEM -   (CROSS-SYSTEM CNTRL)
             CMDSBINT     .COMMAND SUB-SYSTEM -   (INIT AND MONITOR)
             CMDSBMON     .COMMAND SUB-SYSTEM -   (STANDALONE MONITOR)
             CMDSBSYS     .COMMAND SUB-SYSTEM -   (PROCESSOR)
             CMDSBTSO     .COMMAND SUB-SYSTEM -   (TSO FULL SCREEN MON)
             CMDTSO       .COMMAND SUB-SYSTEM -   (TSO DIRECTOR)
             CSCGA03D     .COMMAND SUB-SYSTEM -   (A - ACTIVITY MON.)
             CSCGE03D     .COMMAND SUB-SYSTEM -   (E - EXCEPTION MON.)
             CSCGF03D     .COMMAND SUB-SYSTEM -   (F - FRAME USE GRAPH)
             CSCGH03D     .COMMAND SUB-SYSTEM -   (H - HELP FOR GRAPH)
             CSCGI03D     .COMMAND SUB-SYSTEM -   (I - JES2 INIT DISP)
             CSCGJ03D     .COMMAND SUB-SYSTEM -   (J - JOB CPU GRAPH)
             CSCGO03D     .COMMAND SUB-SYSTEM -   (O - I/O ACTIVITY)
             CSCGQ03D     .COMMAND SUB-SYSTEM -   (Q - QUE)
             CSCGS03D     .COMMAND SUB-SYSTEM -   (S - SYS. IND. GRAPH)
             CSCGU03D     .COMMAND SUB-SYSTEM -   (U -DASD SPACE DISPL)
CSCSA03D     IEESA03D     .COMMAND SUB-SYSTEM -   (#N -  D ENQ P1)
CSCSB03D     IEESB03D     .COMMAND SUB-SYSTEM -   (#N -  D ENQ P2)
CSCSC03D     IEESC03D     .COMMAND SUB-SYSTEM -   (#L -  D LINES)
CSCSD03D     IEESD03D     .COMMAND SUB-SYSTEM -   (#D -  COREZAP)
CSCSE03D     IEESE03D     .COMMAND SUB-SYSTEM -   (#A -  ASCB INFO)
CSCSF03D     IEESF03D     .COMMAND SUB-SYSTEM -   (#F -  D FRAMES)
CSCSG03D     IEESG03D     .COMMAND SUB-SYSTEM -   (#R -  D ALLOC)
CSCSH03D     IEESH03D     .COMMAND SUB-SYSTEM -   (#S -  D LPA)
CSCSI03D     IEESI03D     .COMMAND SUB-SYSTEM -   (#V -  D DEVICE)
CSCSJ03D     IEESJ03D     .COMMAND SUB-SYSTEM -   (#I -  D PAGES)
CSCSK03D     IEESK03D     .COMMAND SUB-SYSTEM -   (#C -  CALCULATOR)
CSCSL03D     IEESL03D     .COMMAND SUB-SYSTEM -   (#J -  D A)
CSCSZ03D     IEESZ03D     .COMMAND SUB-SYSTEM -   (#Z -  D A)
CSCSM03D     IEESM03D     .COMMAND SUB-SYSTEM -   (#H -  HELP)
CSCSN03D     IEESN03D     .COMMAND SUB-SYSTEM -   (#T -  D TIOT)
CSCSO03D     IEESO03D     .COMMAND SUB-SYSTEM -   (#M -  TSO SEND)
CSCSP0ED     IEESP03D     .COMMAND SUB-SYSTEM -   (#P -  D SU)
CSCSQ03D     IEESQ03D     .COMMAND SUB-SYSTEM -   (#Q -  ANALYZE ENQ)
CSCSR03D     IEESR03D     .COMMAND SUB-SYSTEM -   (#O -  I/O PENDING)
CSCSS03D     IEESS03D     .COMMAND SUB-SYSTEM -   (#E -  EXECUTE)
CSCZA03D     IEEZA03D     .COMMAND SUB-SYSTEM -   (##A -  ACTIVITY MON.)
CSCZB03D     IEEZB03D     .COMMAND SUB-SYSTEM -   (##B -  DEVICE MON.)
CSCZC03D     IEEZC03D     .COMMAND SUB-SYSTEM -   (##C -  CHANNEL MON.)
CSCZJ03D     IEEZJ03D     .COMMAND SUB-SYSTEM -   (##J -  JOB MON.)
CSCZP03D     IEEZP03D     .COMMAND SUB-SYSTEM -   (##P -  PAGING MON.)
CSCZS03D     IEEZS03D     .COMMAND SUB-SYSTEM -   (##S -  SYSIND MON.)
             NSEGF03D     .CMD SUB-SYS (NONSE) -  (F - FRAME USE GRAPH)
             NSEGJ03D     .CMD SUB-SYS (NONSE) -  (J - JOB CPU GRAPH)
             NSEGS03D     .CMD SUB-SYS (NONSE) -  (S - SYS. IND. GRAPH)
             NSESE03D     .CMD SUB-SYS (NONSE) -  (#A -  ASCB INFO)
             NSESJ03D     .CMD SUB-SYS (NONSE) -  (#I -  D PAGES)
             NSESL03D     .CMD SUB-SYS (NONSE) -  (#J -  D A)
             NSEZJ03D     .CMD SUB-SYS (NONSE) -  (##J -  JOB MON.)
             NSEZS03D     .CMD SUB-SYS (NONSE) -  (##S -  SYSIND MON.)
#$#
             MACROS VERSION  FOR CMDSBMON
             ALLOC    1.0 .MACRO NEEDED FOR CMDSBMON
             DYNSPACE 1.0 .MACRO NEEDED FOR CMDSBMON
             FREE     1.0 .MACRO NEEDED FOR CMDSBMON
             RCPBFRGS 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPBTU   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPBTU2  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPCKID  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDDN   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDDNRT 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDEBUG 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDFPL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDINC  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDISP  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDS    1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSECT 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSN   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSNPD 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSNRT 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDSRGR 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPDUMMY 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPENDD  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFDDN  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFDISP 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFDSN  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFHOLD 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFORUS 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPFREE  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPIOPL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLINK  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOAD  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOCSW 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOCS1 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPLOCS2 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPMCA   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPNTU   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPERM  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPPL   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPROC  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPPSWD  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPQNAME 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPRNGE  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSPACE 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSPEC  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSR2   1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSSREQ 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSUBL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPSYSOU 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTU    1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTUBFR 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTXTL  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPTYPE  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPUNALC 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPUNIT  1.0 .MACRO NEEDED FOR CMDSBMON
             RCPVCHAR 1.0 .MACRO NEEDED FOR CMDSBMON
             RCPVOLRT 1.0 .MACRO NEEDED FOR CMDSBMON
             S99FAIL  1.0 .MACRO NEEDED FOR CMDSBMON
#$#
                   VERSION
             CSCGQQ00 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - QUEUECMN)
             CSCGQQ01 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - QUEUE)
             CSCGQQ02 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - ALLOCATE)
             CSCGQQ03 1.1 .CMD SUB-SYSTEM -       (Q - QCMD - CKPT)
             CSCGQQ04 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - DDNAME)
             CSCGQQ05 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - DISPLAY)
             CSCGQQ05 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - DISPLAY)
             CSCGQQ06 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - FINDJOB)
             CSCGQQ07 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - FORMAT)
             CSCGQQ08 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - HELP)
             CSCGQQ09 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - HEXBLK)
             CSCGQQ10 1.1 .CMD SUB-SYSTEM -       (Q - QCMD - INIT)
             CSCGQQ11 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - JCL)
             CSCGQQ12 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - JLOG)
             CSCGQQ13 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - JMSG)
             CSCGQQ14 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - LIST)
             CSCGQQ15 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - LISTDS)
             CSCGQQ16 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - PARSE)
             CSCGQQ17 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - READSPC)
             CSCGQQ18 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - REPOS)
             CSCGQQ19 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - SAVE)
             CSCGQQ20 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - SEARCH)
             CSCGQQ21 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - SYSLOG)
             CSCGQQ22 1.0 .CMD SUB-SYSTEM -       (Q - QCMD - XDS)
#$#
                   VERSION
             MACROS VERSION  FOR THE QUE COMMAND
             $JQT     1.0 .MACRO NEEDED FOR QUEUE
             QCLNK    1.0 .MACRO NEEDED FOR QUEUE
             QCOMMON  1.1 .MACRO NEEDED FOR QUEUE
             QSTART   1.1 .MACRO NEEDED FOR QUEUE
             QSTOP    1.0 .MACRO NEEDED FOR QUEUE
             QTILT    1.0 .MACRO NEEDED FOR QUEUE
/*
//DOCCMD2 EXEC  PGM=CMDPRINT,PARM='01072'
//STEPLIB  DD  DSN=SYS1.XA213#.LOAD,DISP=SHR
//SYSPRINT DD   SYSOUT=A
//SYSUDUMP DD   SYSOUT=A
//SYSIN    DD   DSN=SFT.XA213#.SOURCE(CMDDOCTN),DISP=SHR
//UPD1    EXEC  PGM=IEBUPDTE,PARM=NEW
//SYSPRINT DD SYSOUT=A
//SYSUT1   DD DSN=SYS1.PROCLIB,DISP=SHR
//SYSUT2   DD DSN=SYS1.PROCLIB,DISP=SHR
//SYSIN  DD  DATA
./ ADD NAME=CMD1                           CHANGE THIS CARD TO ./
//CMD1   PROC  A=ASE0,
//             B='$',
//             C=CSK0,
//             D=DSD0,
//             E=ESS0,
//             F=FSF0,
//             G='$',
//             H=HSM0,
//             I=ISJ0,
//             J=JSL0,
//             K='$',
//             L=LSC0,
//             M=MSO0,
//             N=NSA0,
//             O=OSR0,
//             P=PSP0,
//             Q=QSQ0,
//             R=RSG0,
//             S=SSH0,
//             T=TSN0,
//             U='$',
//             V=VSI0,
//             W='$',
//             X='$',
//             Y='$',
//             Z=ZSZ0
//CMD1  EXEC PGM=CMDSBINT,TIME=1440,DPRTY=(15,10)
// PARM='&A&B&C&D&E&F&G&H&I&J&K&L&M&N&O&P&Q&R&S&T&U&V&W&X&Y&Z'
//SYSUDUMP  DD  SYSOUT=A
//CSC#ASYS  DD  DUMMY
//CSC#BSYS  DD  DUMMY
//CSC#CSYS  DD  DUMMY
//CSCDATA   DD  DSN=SYS1.SYSTEM.CMDSBSYS.CSCDATA,DISP=SHR
//*
//*      WHERE  -    FOR CSC#.... REPLACE .... WITH SMF SYSID OF ONE
//*                  OF THE SYSTEMS USING CROSS-SYSTEM COMMANDS.
//*                  AS MANY CSC#.... DD CARDS AS NECESSARY MAY EXIST.
//*
./ ADD NAME=CMDSBMON                          CHANGE THIS CARD TO ./
//CMDSBMON  PROC  U=XXX
//CMDSBMON  EXEC  PGM=CMDSBMON,PARM='&U.',REGION=8000K
//SYSUDUMP  DD    SYSOUT=A
//CMDLOG    DD    SYSOUT=A
//CSCDATA  DD  DSN=SYS1.SYSTEM.CMDSBSYS.CSCDATA,DISP=SHR
//*   WHERE  XXX  IS THE 3270 UNIT ADDRESS
/*
//*
//*
//*     END OF CMD SUB-SYSTEM INSTALL JOB 1
//*
//*
//CMDSBJB2 JOB CLASS=R,REGION=512K,MSGCLASS=A
//DMASM    PROC   MEMBER=,LNCT=55,
//         ASMLIB='SFT.XA213#.SOURCE',
//         LINKLIB='SYS1.XA213#.LOAD'
//ASM EXEC PGM=IEUASM,PARM=(LOAD,NODECK,'LINECNT=&LNCT.')
//SYSLIB   DD   DSN=&ASMLIB,DISP=SHR
//         DD   DSN=SYS1.HASPSRC,DISP=SHR
//         DD   DSN=SYS1.MACLIB,DISP=SHR
//         DD   DSN=SYS1.AMODGEN,DISP=SHR
//SYSUT1  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT2  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT3  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSPRINT  DD  SYSOUT=A
//SYSGO  DD  DSN=&&SYSGO,UNIT=SYSDA,SPACE=(TRK,(90,50)),
//    DISP=(,PASS)
//SYSIN    DD  DSN=&ASMLIB.(&MEMBER.),DISP=SHR
//DMLINK EXEC PGM=IEWL,
//          PARM='XREF,LET,LIST,AC=1,SIZE=(140K,6400)'
//SYSLIN   DD   DSN=&&SYSGO,DISP=(OLD,DELETE)
//     DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=A
//     PEND
//DMLINK   PROC   MEMBER=,
//         LINKLIB='SYS1.XA213#.LOAD'
//DMLINK EXEC PGM=IEWL,
//          PARM='XREF,LET,LIST,AC=1,SIZE=(140K,6400)'
//SYSLIN   DD   DDNAME=SYSIN
//SYSLIB  DD DSN=&LINKLIB.,DISP=SHR
//SYSLMOD DD DSN=&LINKLIB.(&MEMBER.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=A
//     PEND
//ASM00 EXEC DMASM,MEMBER=CMDDUMMY
//ASM01 EXEC DMASM,MEMBER=CMDSBCSC
//ASM02 EXEC DMASM,MEMBER=CMDSBINT
//ASM03 EXEC DMASM,MEMBER=CMDSBSYS
//ASM04 EXEC DMASM,MEMBER=CMDTSO
//ASM05 EXEC DMASM,MEMBER=CMDSBTSO
//ASM05A EXEC DMASM,MEMBER=CMDSBMON
//ASM06 EXEC DMASM,MEMBER=CSCSB03D
//ASM07 EXEC DMASM,MEMBER=CSCSA03D
//DMLINK.SYSIN DD *
 INCLUDE SYSLIB(CSCSB03D)
 ENTRY IEESA03D
/*
//ASM08 EXEC DMASM,MEMBER=CSCSC03D
//ASM09 EXEC DMASM,MEMBER=CSCSD03D
//ASM10 EXEC DMASM,MEMBER=CSCSE03D
//ASM11 EXEC DMASM,MEMBER=CSCSF03D
//ASM12 EXEC DMASM,MEMBER=CSCSG03D
//ASM13 EXEC DMASM,MEMBER=CSCSH03D
//ASM14 EXEC DMASM,MEMBER=CSCSI03D
//ASM15 EXEC DMASM,MEMBER=CSCSJ03D
//ASM16 EXEC DMASM,MEMBER=CSCSK03D
//ASM17 EXEC DMASM,MEMBER=CSCSL03D
//ASM17A EXEC DMASM,MEMBER=CSCSZ03D
//ASM18 EXEC DMASM,MEMBER=CSCSM03D
//ASM19 EXEC DMASM,MEMBER=CSCSN03D
//ASM20 EXEC DMASM,MEMBER=CSCSO03D
//ASM21 EXEC DMASM,MEMBER=CSCSP03D
//ASM22 EXEC DMASM,MEMBER=CSCSQ03D
//ASM23 EXEC DMASM,MEMBER=CSCSR03D
//ASM24 EXEC DMASM,MEMBER=CSCSS03D
//ASM25 EXEC DMASM,MEMBER=CSCZB03D
//ASM26 EXEC DMASM,MEMBER=CSCZC03D
//ASM27 EXEC DMASM,MEMBER=CSCZJ03D
//ASM28 EXEC DMASM,MEMBER=CSCZP03D
//ASM29 EXEC DMASM,MEMBER=CSCZS03D
//ASM30 EXEC DMASM,MEMBER=CSCGA03D
//ASM31 EXEC DMASM,MEMBER=CSCGE03D
//ASM32 EXEC DMASM,MEMBER=CSCGF03D
//ASM33 EXEC DMASM,MEMBER=CSCGH03D
//ASM34 EXEC DMASM,MEMBER=CSCGJ03D
//ASM35 EXEC DMASM,MEMBER=CSCGO03D
//ASM36 EXEC DMASM,MEMBER=CSCGS03D
//*ASM37 EXEC DM*ASM,MEMBER=CSCGQQ00
//*ASM38 EXEC DM*ASM,MEMBER=CSCGQQ01
//*ASM39 EXEC DM*ASM,MEMBER=CSCGQQ02
//*ASM40 EXEC DM*ASM,MEMBER=CSCGQQ03
//*ASM41 EXEC DM*ASM,MEMBER=CSCGQQ04
//*ASM42 EXEC DM*ASM,MEMBER=CSCGQQ05
//*ASM43 EXEC DM*ASM,MEMBER=CSCGQQ06
//*ASM44 EXEC DM*ASM,MEMBER=CSCGQQ07
//*ASM45 EXEC DM*ASM,MEMBER=CSCGQQ08
//*ASM46 EXEC DM*ASM,MEMBER=CSCGQQ09
//*ASM47 EXEC DM*ASM,MEMBER=CSCGQQ10
//*ASM48 EXEC DM*ASM,MEMBER=CSCGQQ11
//*ASM49 EXEC DM*ASM,MEMBER=CSCGQQ12
//*ASM50 EXEC DM*ASM,MEMBER=CSCGQQ13
//*ASM51 EXEC DM*ASM,MEMBER=CSCGQQ14
//*ASM52 EXEC DM*ASM,MEMBER=CSCGQQ15
//*ASM53 EXEC DM*ASM,MEMBER=CSCGQQ16
//*ASM54 EXEC DM*ASM,MEMBER=CSCGQQ17
//*ASM55 EXEC DM**ASM,MEMBER=CSCGQQ18
//*ASM56 EXEC DM*ASM,MEMBER=CSCGQQ19
//*ASM57 EXEC DM*ASM,MEMBER=CSCGQQ20
//*ASM58 EXEC DM*ASM,MEMBER=CSCGQQ21
//*ASM59 EXEC DM*ASM,MEMBER=CSCGQQ22
//*LNK60 EXEC DMLINK,MEMBER=CSCGQ03D
//*DMLINK.SYSIN DD *
//*  INCLUDE SYSLIB(CSCGQQ01)
//*  INCLUDE SYSLIB(CSCGQQ02)
//*  INCLUDE SYSLIB(CSCGQQ03)
//*  INCLUDE SYSLIB(CSCGQQ04)
//*  INCLUDE SYSLIB(CSCGQQ05)
//*  INCLUDE SYSLIB(CSCGQQ06)
//*  INCLUDE SYSLIB(CSCGQQ07)
//*  INCLUDE SYSLIB(CSCGQQ08)
//*  INCLUDE SYSLIB(CSCGQQ09)
//*  INCLUDE SYSLIB(CSCGQQ10)
//*  INCLUDE SYSLIB(CSCGQQ11)
//*  INCLUDE SYSLIB(CSCGQQ12)
//*  INCLUDE SYSLIB(CSCGQQ13)
//*  INCLUDE SYSLIB(CSCGQQ14)
//*  INCLUDE SYSLIB(CSCGQQ15)
//*  INCLUDE SYSLIB(CSCGQQ16)
//*  INCLUDE SYSLIB(CSCGQQ17)
//*  INCLUDE SYSLIB(CSCGQQ18)
//*  INCLUDE SYSLIB(CSCGQQ19)
//*  INCLUDE SYSLIB(CSCGQQ20)
//*  INCLUDE SYSLIB(CSCGQQ21)
//*  INCLUDE SYSLIB(CSCGQQ22)
//*  ENTRY QUEUE
//* /*
//ASM61 EXEC DMASM,MEMBER=CSCZA03D
//ASM62 EXEC DMASM,MEMBER=CSCGI03D
//ASM63 EXEC DMASM,MEMBER=CSCGU03D
//*
//*
//*     END OF CMD SUB-SYSTEM INSTALL JOB 2
//*
//*
//CMDSBJB3 JOB CLASS=R,REGION=512K,MSGCLASS=A
//*
//*
//*   EXECUTE THIS JOB FOR NON-SE SYSTEMS ONLY
//*
//*
//*
//DMASM    PROC   MEMBER=,LNCT=55,LINKMEM=,
//         ASMLIB='SFT.XA213#.SOURCE',
//         LINKLIB='SYS1.XA213#.LOAD'
//ASM EXEC PGM=IEUASM,PARM=(LOAD,NODECK,'LINECNT=&LNCT.')
//SYSLIB   DD   DSN=&ASMLIB,DISP=SHR
//         DD   DSN=SYS1.MACLIB,DISP=SHR
//         DD   DSN=SYS1.AMODGEN,DISP=SHR
//SYSUT1  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT2  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSUT3  DD  UNIT=SYSDA,SPACE=(TRK,(90,50))
//SYSPRINT  DD  SYSOUT=A
//SYSGO  DD  DSN=&&SYSGO,UNIT=SYSDA,SPACE=(TRK,(90,50)),
//    DISP=(,PASS)
//SYSIN    DD  DSN=&ASMLIB.(&MEMBER.),DISP=SHR
//LKED EXEC PGM=IEWL,
//          PARM='XREF,LET,LIST,AC=1,SIZE=(140K,6400)'
//SYSLIN   DD   DSN=&&SYSGO,DISP=(OLD,DELETE)
//     DD   DDNAME=SYSIN
//SYSLMOD DD DSN=&LINKLIB.(&LINKMEM.),DISP=SHR
//SYSUT1 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSPRINT  DD  SYSOUT=A
//     PEND
//ASM01 EXEC DMASM,MEMBER=NSESE03D,LINKMEM=CSCSE03D
//ASM02 EXEC DMASM,MEMBER=NSESJ03D,LINKMEM=CSCSJ03D
//ASM03 EXEC DMASM,MEMBER=NSESL03D,LINKMEM=CSCSL03D
//ASM04 EXEC DMASM,MEMBER=NSEZJ03D,LINKMEM=CSCZJ03D
//ASM05 EXEC DMASM,MEMBER=NSEZS03D,LINKMEM=CSCZS03D
//ASM06 EXEC DMASM,MEMBER=NSEGF03D,LINKMEM=CSCGF03D
//ASM07 EXEC DMASM,MEMBER=NSEGJ03D,LINKMEM=CSCGJ03D
//ASM08 EXEC DMASM,MEMBER=NSEGS03D,LINKMEM=CSCGS03D
//*
//*
//*     END OF CMD SUB-SYSTEM INSTALL JOB 3
//*
//*  -------------------------------------------------------------
//CMDSBJB4 JOB CLASS=R,REGION=512K,MSGCLASS=A
//DMCOPY   PROC   LINKLIB='SYS1.XA213#.LOAD',
//         TARGLIB=
//DMCOPY EXEC PGM=IEBCOPY
//SYSPRINT  DD  SYSOUT=A
//SYSUT1  DD DSN=&LINKLIB.,DISP=SHR
//SYSUT2  DD DSN=&TARGLIB.,DISP=SHR
//SYSUT3 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//SYSUT4 DD UNIT=SYSDA,SPACE=(TRK,(50,20))
//     PEND
//COPY1 EXEC DMCOPY,TARGLIB='SYS1.LINKLIB'    ANY LINKLIST LIBRARY
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CMDPRINT,,R))
 S M=((CMDSBCSC,,R))
 S M=((CMDSBINT,,R))
 S M=((CMDSBSYS,,R))
 S M=((CMDSBMON,,R))
 S M=((CSCSA03D,,R))
 S M=((CSCSC03D,,R))
 S M=((CSCSD03D,,R))
 S M=((CSCSE03D,,R))
 S M=((CSCSF03D,,R))
 S M=((CSCSG03D,,R))
 S M=((CSCSH03D,,R))
 S M=((CSCSI03D,,R))
 S M=((CSCSJ03D,,R))
 S M=((CSCSK03D,,R))
 S M=((CSCSL03D,,R))
 S M=((CSCSM03D,,R))
 S M=((CSCSN03D,,R))
 S M=((CSCSO03D,,R))
 S M=((CSCSP03D,,R))
 S M=((CSCSQ03D,,R))
 S M=((CSCSR03D,,R))
 S M=((CSCSS03D,,R))
 S M=((CSCSZ03D,,R))
 S M=((CSCZA03D,,R))
 S M=((CSCZB03D,,R))
 S M=((CSCZC03D,,R))
 S M=((CSCZJ03D,,R))
 S M=((CSCZP03D,,R))
 S M=((CSCZS03D,,R))
/*
//COPY2 EXEC DMCOPY,TARGLIB='SYS1.LPALIB'   LPA FOR OPER COMMANDS
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CMDDUMMY,,R))
 S M=((CSCSA03D,IEESA03D,R))
 S M=((CSCSC03D,IEESC03D,R))
 S M=((CSCSD03D,IEESD03D,R))
 S M=((CSCSE03D,IEESE03D,R))
 S M=((CSCSF03D,IEESF03D,R))
 S M=((CSCSG03D,IEESG03D,R))
 S M=((CSCSH03D,IEESH03D,R))
 S M=((CSCSI03D,IEESI03D,R))
 S M=((CSCSJ03D,IEESJ03D,R))
 S M=((CSCSK03D,IEESK03D,R))
 S M=((CSCSL03D,IEESL03D,R))
 S M=((CSCSM03D,IEESM03D,R))
 S M=((CSCSN03D,IEESN03D,R))
 S M=((CSCSO03D,IEESO03D,R))
 S M=((CSCSP03D,IEESP03D,R))
 S M=((CSCSQ03D,IEESQ03D,R))
 S M=((CSCSR03D,IEESR03D,R))
 S M=((CSCSS03D,IEESS03D,R))
 S M=((CSCSS03D,IEESZ03D,R))
 S M=((CSCZA03D,IEEZA03D,R))
 S M=((CSCZB03D,IEEZB03D,R))
 S M=((CSCZC03D,IEEZC03D,R))
 S M=((CSCZJ03D,IEEZJ03D,R))
 S M=((CSCZP03D,IEEZP03D,R))
 S M=((CSCZS03D,IEEZS03D,R))
/*
//COPY3 EXEC DMCOPY,TARGLIB='SYS1.TSOLIB' FULL SCREEN FOR TSO AND OPER
//SYSIN  DD  *
 C I=SYSUT1,O=SYSUT2
 S M=((CMDTSO,,R))
 S M=((CMDSBTSO,,R))
 S M=((CSCGA03D,,R))        ACTIVITY MONITOR
 S M=((CSCGE03D,,R))        EXCEPTION MONITOR
 S M=((CSCGF03D,,R))        JOB FRAME MONITOR
 S M=((CSCGH03D,,R))        HELP FOR GRAPH MONITORS
 S M=((CSCGI03D,,R))        JES2 INIT DISPLAY
 S M=((CSCGJ03D,,R))        JOB CPU MONITOR
 S M=((CSCGO03D,,R))        I/O ACTIVITY MONITOR
 S M=((CSCGQ03D,,R))        QUE COMMAND
 S M=((CSCGS03D,,R))        SYSTEM IND. GRAPH
 S M=((CSCGU03D,,R))        DASD FREE SPACE
/*
./       ADD   NAME=CMDPRINT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                     *
*                                                                     *
*                                                                     *
*                             OPRINT                                  *
*                          ------------                               *
*                                                                     *
*                                                                     *
*    FUNCTION -      TO PRINT DATASETS GENERATING PAGE EJECTS WHEN    *
*                    AN   #$#   IS ENCOUNTERED.   RECORD LENGTH IS    *
*                    CONTROLED BY PARMS AS IS NUMBER OF COPIES.       *
*                                                                     *
*    SYSIN -         DDNAME=SYSIN,  DATASET TO BE PRINTED.            *
*                                                                     *
*    SYSPRINT -      DDNAME=SYSPRINT,  SYSOUT DATA SET.               *
*                                                                     *
*    PARMS -         'CCLLL'                                          *
*                       CC  -     THE NUMBER OF COPIES DESIRED.       *
*                       LLL  -    THE SYSPRINT RECORD LENGTH FOR DATA *
*                                 MOVING ONLY.  DCB LRECL IS 133.     *
*                                                                     *
*                                                                     *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         EJECT
OPRINT   CSECT
         SAVE  (14,12)
         LR    R3,R15              BASE REG
         USING OPRINT,R3
         ST    R13,SAVE+4          SAVE AREA
         LA    R13,SAVE               CONVENTIONS
         L     R1,0(0,R1)          PARM ADDR
         MVC   COPIES(2),2(R1)
         MVC   RECLEN(3),4(R1)     SAVE SYSIN RECORD LENGTH
         PACK  DOUBLE(8),COPIES(2)
         CVB   R4,DOUBLE           NO. OF COPIES
         PACK  DOUBLE(8),RECLEN(3)
         CVB   R5,DOUBLE           GET LRECL
         CH    R5,=H'132'          MAX LRECL
         BH    ABEND               OVER MAX, ABEND
         BCTR  R5,0                SET MOVE LENGTH
         OPEN  (SYSPRINT,(OUTPUT))
OPEN     OPEN  (SYSIN)
GET      GET   SYSIN,WORK          GET A RECORD
         CLC   WORK(3),=C'#$#'     SKIP TO CHANNEL 1 IND
         BE    PUTSKIP             YES,GO SKIP
         EX    R5,PRTMOVE          MOVE SYSIN TO SYSPRINT
         PUT   SYSPRINT,PRINT      PUT A RECORD
         B     GET                 GET NEXT RECORD
PUTSKIP  PUT   SYSPRINT,PRINT-1    SKIP TO CHANNEL 1
         B     GET                 GET NEXT RECORD
PRTMOVE  MVC   PRINT+1(1),WORK     EXECUTED MOVE
ABEND    ABEND 1
EOJ      CLOSE (SYSIN)
         BCT   R4,OPEN
         CLOSE (SYSPRINT)
         L     R13,SAVE+4
         RETURN (14,12),RC=0
         LTORG
SAVE     DS    18F
         DS    0D
DOUBLE   DC    2F'0'
RECLEN   DS    CL3
COPIES   DS    CL2
WORK     DS    CL132
         DC    X'8B'
PRINT    DC    X'09',CL132' '
         EJECT
SYSIN    DCB   DDNAME=SYSIN,DSORG=PS,RECFM=FB,MACRF=(GM),EODAD=EOJ
SYSPRINT DCB DDNAME=SYSPRINT,DSORG=PS,RECFM=FBM,LRECL=133,BLKSIZE=1330,X
               MACRF=(PM)
         EJECT
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CMDSBCSC
         TITLE 'CMDSBCSC -   CROSS-SYSTEM CONTROL MODULE'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CMDSBCSC -       CROSS-SYSTEM CONTROL MODULE              ***
***                                                                 ***
***       VERSION -        3.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/XA SP 2.1.1                          ***
***                                                                 ***
***       UPDATED -        02/13/81                                 ***
***                                                                 ***
***                        02/02/84   SNET-JAL 31-BIT CODING FOR XA ***
***                                                                 ***
***       WARNINGS -       THE CSCDATA DATA SET USED BY THIS        ***
***                        MODULE MUST BE INITIALIZED WITH 16       ***
***                        BYTES OF BINARY ZEROES.  ALLOCATE        ***
***                        THIS DATA SET WITH RECFM=U,LRECL=0,      ***
***                        BLKSIZE=16.                              ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
         EJECT
CMDSBCSC CSECT
         SAVE  (14,12)                   SAVE REGISTERS
         LR    R3,R15                    ESTABLISH BASE REGISTER
         USING CMDSBCSC,R3
         ST    R13,SAVE+4                CALLERS SAVE AREA ADDRESS
         LA    R13,SAVE                  GET OUR SAVE AREA ADDRESS
         LA    R12,0(0,R1)               COMM AREA ADDRESS
         USING AREA,R12                  ADDRESSABILITY FOR COMM AREA
         LA    R2,XSA
         ST    R2,SAVER2
         ST    R12,SAVER12
         L     R1,16                     CVT
         L     R1,196(0,R1)              SMCA
         MVC   CSCSID(4),16(R1)          SAVE SYSTEM ID
         MVC   CSCIN+62(2),=H'19069'     SET FULL BLOCKSIZE
         OPEN  (CSCIN,(INPUT))           OPEN COMMUNICATION DATA SET
         TM    CSCIN+48,X'10'            Q. WAS OPEN OK ?
         BZ    CSCEXIT                   A. NO TURN OFF FACILITY
         MODESET KEY=ZERO,MODE=SUP       SWITCH INTO PROTECT KEY ZERO
         SPACE 1
***********************************************************************
*  WE NOW WAIT FOR TWENTY SECONDS, AFTER WHICH A READ WILL BE ISSUED  *
*             TO THE COMMUNICATIONS DATA SET.                         *
***********************************************************************
CSC      STIMER WAIT,DINTVL=CSCWAIT
         L     R1,16                     CVT
         L     R1,0(0,R1)                TCB WORDS
         L     R1,12(0,R1)               CURRENT ASCB
         SR    R10,R10             -JAL/XA-
         L     R10,AMODE31         -JAL/XA-
         BSM   0,R10               -JAL/XA-
AMODE31  DC    A(OUCBCONT+X'80000000') -JAL/XA-
OUCBCONT DS    0H                  -JAL/XA-
         L     R1,144(0,R1)        OUCB
         OI    17(R1),X'80'        SET NON-SWAPPABLE
         LA    R10,AMODE24         -JAL/XA-
         BSM   0,R10               -JAL/XA-
AMODE24  DS    0H                  -JAL/XA-
         L     R1,RESETCNT               RESET COUNT
         BCT   R1,CSC1                   BR AROUND RESET
         L     R1,=F'-1'                 FORCE NEVER RESET
         MVC   CSCWAIT+4(4),=CL4'2000'   20 SECOND WAIT
         MVC   PREVCNT(4),=F'3'
         MVC   PREVSTRT(4),=F'3'
         SPACE 1
CSC1     ST    R1,RESETCNT               SAVE NEW COUNT
         BAL   R10,CSCREAD               READ CSC DATA
         CLI   CSCCMD,X'00'              COMMAND REQUEST
         BNE   CSCCOM                    YES
         SPACE 1
CSC2     CLC   CSCSID(4),4(R11)    OUTPUT OR COM REQUEST FOR THIS SYS
         BNE   CSC                 NO
         CLI   0(R11),X'00'        OUTPUT REQUEST
         BE    CSCOUT$             YES
         B     CSCLNK              NO, CMD REQUEST
         EJECT
CSCCOM   CLI   CSCCMD,C'*'         CROSS-SYSTEM TERMINATE REQUEST
         BE    CSCEXIT             YES
         CLC   0(8,R11),=8X'00'    CROSS-SYSTEM BUSY
         BE    CSCCOM1             NO
         MVI   CSCCMD,X'00'
         MVC   COMSID(4),4(R11)
         LA    R1,COMMSG           BUSY MSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     CSC2
         SPACE 1
CSCCOM1  SR    R1,R1
         IC    R1,XAU
         STH   R1,8(0,R11)         SAVE UCM ID
         MVC   0(4,R11),CSCSID     SENDING SYSID
         XC    10(2,R11),10(R11)
         MVC   12(4,R11),=F'148'   COMMAND RECORD LENGTH
         MVC   16(78,R11),CSCCMD   MOVE COMMAND TO RECORD
         MVC   96(52,R11),CSCHDR   MOVE HEADER TO RECORD
         BAL   R10,CSCSYS          MOVE RECEIVING SYSID TO RECORD
         BAL   R10,CSCWRITE        REWRITE RECORD
         MVC   RECVMSG+24(1),16(R11)
         SR    R0,R0
         IC    R0,XAU
         LA    R1,RECVMSG
         SVC   35
         MVI   CSCCMD,X'00'
         B     CSC
         SPACE 3
CSCOUT$  LH    R8,8(0,R11)         UCM ID
         LH    R9,10(0,R11)        WTO COUNT
         LA    R1,96(0,R11)        HEADER ADDR
         LR    R0,R8               UCM ID
         SVC   35
         LA    R11,148(0,R11)      1ST WTO ADDR
         SPACE 1
CSCOUT1  LR    R0,R8               UCM ID
         MVC   RECWTO(80),0(R11)
         LA    R1,RECWTO           MSG ADDR
         SVC   35
         LH    R1,0(0,R11)         WTO LENGTH
         LA    R11,0(R1,R11)       NEXT MSG
         BCT   R9,CSCOUT1
         BAL   R10,CSCCLEAR        RESET DATASET TO ALLOW REUSE
         B     CSC
         EJECT
CSCLNK   MVC   4(4,R11),0(R11)     SET UP RECEIVING SYSID
         LA    R1,148(0,R11)       1ST WTO SLOT
         ST    R1,0(0,R11)         SAVE ADDR
         LA    R1,148
         ST    R1,RECORD+12        SET BASE LENGTH
         BAL   R10,CSCSET          SET UP ENTRY
         B     CSCLNK1             BYPASS COMMAND ENTRY IF INVALID CMD
         LA    R2,EXITLIST         PARM LIST FOR COMMAND
         BALR  R14,R15             BR TO COMMAND MODULE
         SPACE 3
         BALR  R15,0
         USING *,R15
         L     R3,=A(CMDSBCSC)     RELOAD ORIG ENTRY POINT
         DROP  R15
         SPACE 1
         L     R4,MODLOC
         DELETE EPLOC=(R4)
         SPACE 1
         L     R2,SAVER2
         L     R12,SAVER12
         LA    R13,SAVE
         SPACE 1
CSCLNK1  XC    RECORD(4),RECORD    INDICATE OUTPUT READY
         BAL   R10,CSCWRITE        REWRITE CSC DATA
         B     CSC
         EJECT
CSCSYS   LA    R1,16(0,R11)        COMMAND BEGIN
         LA    R8,94(0,R11)        COMMAND END
         SPACE 1
CSCSYS1  CLC   0(2,R8),=C'S='      SYSID PARM
         BE    CSCSYS3             YES
         BCTR  R8,0
         CR    R1,R8               SYSID PARM MISSING
         BNE   CSCSYS1             NO
         SPACE 1
CSCSYS2  LA    R1,CSCERR           ERROR MESSAGE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         MVI   CSCCMD,X'00'
         B     CSC
         SPACE 1
CSCSYS3  MVC   4(4,R11),2(R8)      SET UP RECEIVING SYSID
         LA    R1,CSCSTABL
         BCTR  R8,0
         MVC   0(8,R8),=CL8' '
         SPACE 1
CSCSYS4  CLC   4(4,R11),0(R1)      VALID
         BCR   8,R10               YES
         LA    R1,4(0,R1)
         CLC   0(4,R1),=F'0'       END OF SYSID TABLE
         BNE   CSCSYS4             NO, TRY NEXT
         B     CSCSYS2             INVALID, ERR MSG
         EJECT
CSCREAD  MVC   CSCIN+62(2),=H'19069' FULL BLOCKSIZE
***********************************************************************
*                                                                     *
*               READ THE COMMUNICATIONS DATA SET                      *
*                                                                     *
***********************************************************************
*
         POINT CSCIN,RECORD1
         READ  DECB1,SF,CSCIN,RECORD,'S'
         CHECK DECB1
         LA    R11,RECORD
         CLC   0(12,R11),=XL12'00' ZERO REQUEST
         BE    CSCREAD1            NO
         CLC   0(96,R11),PREVREC   SAME REQUEST
         BNE   CSCREAD1            NO
         L     R1,PREVCNT
         BCT   R1,CSCREAD2         CONTINUE
         L     R1,PREVSTRT         SET NEW COUNT
         ST    R1,PREVCNT          SAVE COUNT
         LA    R10,CSC             NEW RETURN ADDR
         MVC   TIMESID(4),4(R11)
         LA    R1,TIMEMSG          TIMEOUT MSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     CSCCLEAR
         SPACE 1
CSCREAD1 MVC   PREVREC(96),0(R11)  SAVE NEW REQUEST
         LA    R1,5                SET NEW COUNT
         SPACE 1
CSCREAD2 ST    R1,PREVCNT          SAVE COUNT
         BR    R10
         EJECT
CSCCLEAR XC    RECORD(16),RECORD
         SPACE 1
CSCWRITE L     R1,RECORD+12        RECORD LENGTH
         LTR   R1,R1               ZERO LENGTH
         BNZ   CSCWRIT1            NO
         LA    R1,16               MINIMUM LENGTH
         SPACE 1
CSCWRIT1 STH   R1,CSCOUT+62       SAVE LENGTH FOR WRITE
         LR    R2,R1
***********************************************************************
*                                                                     *
*              RE-WRITE THE COMMUNICATIONS DATA SET RECORD            *
*                                                                     *
***********************************************************************
         TM    CSCOUT+48,X'10'            Q. WAS OPEN DONE ?
         BO    CSCDOIO                    A. YES DO IO OPERATION
         OPEN  (CSCOUT,(OUTPUT))          OPEN COMMUNICATIONS DATA SET
         TM    CSCOUT+48,X'10'            Q. OPEN MAKE IT ?
         BZ    CSCEXIT                    A. NO - TURN OFF FACILITY
CSCDOIO  POINT CSCOUT,RECORD1
         WRITE DECB2,SF,CSCOUT,RECORD,'S'
         CHECK DECB2
         MVC   RESETCNT(4),=F'20' RESET IN 100 SECONDS
         MVC   CSCWAIT+4(4),=CL4'0500'  5 SECOND STIMER WAIT
         MVC   PREVCNT(4),=F'5'
         MVC   PREVSTRT(4),=F'5'
         BR    R10
         SPACE 3
         USING CSCENTRY,R15
CSCENTRY STM   R13,R14,8(R2)       SAVE WORK REGS
         L     R14,RECORD+12       CURRENT LENGTH
         AH    R14,0(0,R1)         ADD WTO LENGTH
         ST    R14,RECORD+12       SAVE NEW LENGTH
         L     R14,RECORD          NEXT WTO SLOT
         LH    R13,0(0,R1)         WTO LENGTH
         BCTR  R13,0
         EX    R13,CSCMOVE         MOVE WTO TO OUTPUT
         LA    R14,1(R13,R14)      NEXT WTO SLOT
         ST    R14,RECORD          SAVE NEXT SLOT ADDR
         LH    R14,RECORD+10       WTO COUNT
         LA    R14,1(0,R14)        ADD 1
         STH   R14,RECORD+10       SAVE WTO COUNT
         LM    R13,R14,8(R2)       RELOAD ORIG REGS
         BR    R14
         SPACE 1
CSCMOVE  MVC   0(0,R14),0(R1)
         DROP  R15
         EJECT
CSCSET   TR    16(1,R11),COMTAB    MODULE NAME INDEX
         SR    R4,R4
         IC    R4,16(0,R11)        MODULE NAME INDEX
         SLL   R4,3                MULTIPLY BY 8
         LTR   R4,R4               INVALID CSC COMMAND DETECTED
         BZ    CSCSET4             YES, DO DUMMY OUTPUT
         LA    R4,MODLIST(R4)      MODULE NAME ADDR
         SR    R15,R15
         CLI   17(R11),C' '        SUB-PARM EXIST
         BE    CSCSET0             NO
         LA    R15,17(0,R11)       SUBPARM ADDR
         SPACE 1
CSCSET0  ST    R15,EXITLIST+20     SAVE SUB-PARM ADDR
         ST    R4,MODLOC           SAVE EP NAME LOCATION
         LOAD  EPLOC=(R4)
         LR    R5,R0               MODULE ADDR
         LA    R15,0(0,R5)         MODULE ADDR
         LA    R6,0(0,R1)          MODULE DOUBLEWORDS
         SLL   R6,3                MODULE LENGTH
         SH    R6,=H'6'            ADJUST SCAN LENGTH
         SPACE  1
CSCSET1  CLC   0(6,R5),=X'430020280A23'   WTO INSTRUCTIONS
         BE    CSCSET3             YES
         SPACE 1
CSCSET2  LA    R5,2(0,R5)          NEXT INSTRUCTION
         BCTR  R6,0
         BCT   R6,CSCSET1          PROCESS NEXT
         B     4(R10)
         SPACE 1
CSCSET3  MVC   0(6,R5),=X'58F0200005EF'
         B     CSCSET2
         SPACE 1
CSCSET4  L     R14,RECORD+12       CURRENT RECORD LENGTH
         LA    R1,CSCINV           MSG TO INSERT
         AH    R14,0(0,R1)         ADD MSG LENGTH
         ST    R14,RECORD+12       SAVE NEW RECORD LENGTH
         L     R14,RECORD          OUTPUT SLOT ADDRESS
         LH    R6,0(0,R1)          WTO LENGTH
         BCTR  R6,0                ADJUST FOR EXECUTED MOVE
         EX    R6,CSCMOVE          MOVE MSG TO RECORD
         MVC   RECORD+10(2),=H'1'  WTO COUNT = 1
         BR    R10
         SPACE 3
CSCEXIT  MODESET KEY=NZERO,MODE=PROB
         TM    CSCOUT+48,X'10'            Q. WAS OPEN DONE ?
         BZ    CLOSE2                     A. NO SKIP CLOSE
         CLOSE (CSCOUT)
CLOSE2   TM    CSCIN+48,X'10'            Q. WAS OPEN DONE ?
         BZ    LASTMSG                   A. NO SKIP CLOSE
         CLOSE (CSCIN)
LASTMSG  WTO   'CMD SUBSYS -   CSC FACILITY DISABLED'
         L     R13,SAVE+4
         RETURN (14,12),RC=0
         EJECT
         LTORG
         SPACE 3
RECORD1  DC    A(256)              TTRZ RECORD 1
SAVE     DS    18F
         DS    0D
CSCWAIT  DC    CL8'00002000'
CSCSID   DS    F
MODLOC   DS    F
SAVER2   DS    F
SAVER12  DS    F
RESETCNT DC    F'-1'
PREVCNT  DC    F'3'
PREVSTRT DC    F'3'
PREVREC  DC    CL96' '
RECWTO   DC    CL80' '
         SPACE 3
EXITLIST DC    A(CSCENTRY)
         DC    11F'0'
         EJECT
CSCINV   DS    0CL48
         DC    X'00300100'
         DC    CL44'CMD SUBSYS -   CSC INVALID COMMAND'
         SPACE 3
CSCERR   DS    0CL48
         DC    X'00300100'
         DC    CL44'CMD SUBSYS -   CSC PARAMETER ERROR'
         SPACE 3
RECVMSG  DS    0CL48
         DC    X'00300100'
         DC    CL44'CMD SUBSYS -   CSC #X COMMAND ACCEPTED'
         SPACE 3
COMMSG   DS    0CL48
         DC    X'00300100'
         DC    CL40'CMD SUBSYS -   CSC BUSY, CMD PENDING ON '
COMSID   DC    CL4' '
         SPACE 3
TIMEMSG  DS    0CL52
         DC    X'00340100'
         DC    CL43'CMD SUBSYS -   CSC TIMEOUT, CMD PENDING ON '
TIMESID  DC    CL4' ',C' '
         EJECT
         DS    0D
COMTAB   DC    193X'00'
*                 A B C D E F G H I
         DC    X'04000A031105000C09',XL7'00'
*                 J K L M N O P Q R
         DC    X'0B00020D01100E0F06',XL8'00'
*                 S T U V W X Y Z
         DC    X'0700000800030012',XL23'00'
         SPACE 3
MODLIST  DC    CL8' '
         DC    CL8'CSCSA03D'  1
         DC    CL8'CSCSC03D'  2
         DC    CL8'CSCSD03D'  3
         DC    CL8'CSCSE03D'  4
         DC    CL8'CSCSF03D'  5
         DC    CL8'CSCSG03D'  6
         DC    CL8'CSCSH03D'  7
         DC    CL8'CSCSI03D'  8
         DC    CL8'CSCSJ03D'  9
         DC    CL8'CSCSK03D'  A
         DC    CL8'CSCSL03D'  B
         DC    CL8'CSCSM03D'  C
         DC    CL8'CSCSO03D'  D
         DC    CL8'CSCSP03D'  E
         DC    CL8'CSCSQ03D'  F
         DC    CL8'CSCSR03D'  10
         DC    CL8'CSCSS03D'  11
         DC    CL8'CSCSZ03D'  12
         DC    CL8'        '
         DC    CL8'        '
         DC    CL8'        '
         EJECT
CSCIN    DCB   DDNAME=CSCDATA,DSORG=PS,RECFM=U,BLKSIZE=19069,          X
               MACRF=(RP),BUFNO=1
CSCOUT   DCB   DDNAME=CSCDATA,DSORG=PS,RECFM=U,BLKSIZE=19069,          X
               MACRF=(WP),BUFNO=1
         SPACE 5
RECORD   DS    CL19069
         EJECT
AREA     DSECT
SSVT     DS    H
SSVTFNUM DS    H
SSVTFCOD DS    XL256
SSVTFRTN DS    0F
SSVTFUNC DS    0F
SSVTFUN1 DS    F
         DS    8F
SSVTMSGT DS    F
SSVTLIST DS    2F
SSVTECB  DS    F
         DS    0D
SSVTWAIT DS    CL8
SSVTTIME DS    F
SSVTASCB DS    0F
SSVTSTAT DS    X
         DS    XL3
SSVTUMID DS    F
         SPACE 3
CMDTABLE DS    20F
CMDEND   DS    F
         EJECT
         DS    0D
USERWORK DS    0CL228
DOUBLE   DS    D
CMDSAVE  DS    18F
COMMAND  DS    CL80
INCONS   DS    CL2
         SPACE 2
         DS    0F
WTOLIST  DS    0CL52
         DS    CL19
CMDID    DS    C
         DS    CL5
UCMID    DS    CL2
         DS    CL2
SYSID    DS    CL4
         DS    CL2
YEAR     DS    CL2
         DS    C
DAY      DS    CL3
         DS    CL2
HOUR     DS    CL2
         DS    C
MINUTE   DS    CL2
         DS    CL4
PADDING  DS    CL12
         SPACE 2
XSA      DS    0CL48
         DS    5F
XAL      DS    F
XAT      DS    F
         DS    F
XAS      DS    2F
XAU      DS    X
         DS    XL7
         SPACE 2
CMD##    DS    CL78
HDRMSG   DS    CL52
DISBL    DS    CL48
         DS    0F
CSCHDR   DS    CL52
CSCCMD   DS    CL78
CSCSTABL DS    CL48
         SPACE 2
AREAEND  DS    0D
         EJECT
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CMDSBINT
         TITLE 'CMDSBINT -   INITIALIZATION AND MONITOR MODULE'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CMDSBINT -       INITIALIZATION AND MONITOR MODULE        ***
***                                                                 ***
***       VERSION -        2.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/XA SP2.1.1                           ***
***                                                                 ***
***       UPDATED -        12/15/79                                 ***
***                                                                 ***
***                        02/02/84 SNET-JAL 31-BIT CODING ADDED    ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
         EJECT
CMDSBINT CSECT
         SAVE  (14,12)
         LR    R3,R15
         USING CMDSBINT,R3
         ST    R13,SAVE+4
         LA    R13,SAVE
         L     R4,0(0,R1)          PARM ADDR
         LH    R5,0(0,R4)          PARM LENGTH
         LA    R4,2(0,R4)          PARM BEGIN
         LA    R7,TABLE            LOAD INIT TABLE ADDR
         LTR   R5,R5               ANY PARMS
         BNZ   PARM                YES, PROCESS
         SPACE 1
         ABEND 78,DUMP
         SPACE 3
PARM     CLI   0(R4),C'$'          BYPASSED OR NON-EXISTANT CMD
         BE    PARM2               YES, NEXT PARM
         MVC   0(4,R7),0(R4)       SET IN INIT TABLE
         LA    R7,4(0,R7)          NEXT TABLE SLOT
         C     R7,=A(TABEND)       ANY MORE SLOTS
         BE    PARMEND             NO, JUST USE THESE
         SPACE 1
PARM1    LA    R4,3(0,R4)          NEXT PARM-1
         SH    R5,=H'3'            DECR PARM LENGTH
         SPACE 1
PARM2    LA    R4,1(0,R4)          NEXT PARM
         BCTR  R5,0                DECR PARM LENGTH
         LTR   R5,R5               ARE ALL PARMS PROCESSED
         BP    PARM                NO, CONTINUE
         EJECT
PARMEND  MODESET KEY=ZERO,MODE=SUP
         SPACE 1
         L     R0,SIZE             LOAD SIZE AND SUBPOOL
         SPACE 1
         GETMAIN R,LV=(0)
         SPACE 1
         LR    R4,R1               SAVE ADDR OR SSVT AND WORK AREA
         USING AREA,R4
         XC    SSVT(4),SSVT        CLEAR SSVT 1ST 4 BYTES
         MVI   SSVTFNUM+1,X'01'    SET NO. OF SUPPORTED FUNCTIONS
         XC    SSVTFCOD(256),SSVTFCOD  CLEAR FUNCTION MATRIX
         XC    SSVTFUNC(156),SSVTFUNC  CLEAR REST OF SSVT
         XC    USERWORK(228),USERWORK  CLEAR WORK AREA
         XC    CMDXSA(48),CMDXSA   CLEAR # XSA
         XC    XSA(48),XSA         CLEAR ## XSA
         XC    CSCCMD(78),CSCCMD   CLEAR CSC COMMAND AREA
         XC    CSCSTABL(48),CSCSTABL CLEAR CSC SYSID TABLE
         MVI   SSVTSTAT,X'FF'      SET MONITOR BUSY INDICATOR
         MVI   SSVTFCOD+9,X'01'    SUPPORT CMD ENTRY
         LA    R1,SSVTECB          COMMAND ANSWER ECB
         ST    R1,SSVTLIST         ECB ADDR TO ECB LIST
         L     R1,16               CVT
         L     R1,0(0,R1)          TCB WORDS
         L     R1,12(0,R1)         CURRENT ASCB
         ST    R1,SSVTASCB         SAVE CMD1 ASCB ADDR
         L     R1,56(0,R1)         CSCB ADDR
         L     R1,40(0,R1)         STOP/MODIFY ECB ADDR
         ST    R1,SSVTLIST+4       ECB ADDR TO LIST
         MVI   SSVTLIST+4,X'80'    END OF LIST INDICATOR
         LA    R1,SSVTWAIT         WAIT TIME FIELD
         ST    R1,XAT              SAVE ADDR IN XSA
         EJECT
         L     R1,16               CVT
         L     R1,0(0,R1)          TCB WORDS
         L     R1,12(0,R1)         CURRENT ASCB
         SR    R15,R15             -JAL/XA-
         L     R15,AMODE31         -JAL/XA-
         BSM   0,R15               -JAL/XA-
AMODE31  DC    A(OUCBCONT+X'80000000') -JAL/XA-
OUCBCONT DS    0H                  -JAL/XA-
         L     R1,144(0,R1)        OUCB
         OI    17(R1),X'80'        SET NON-SWAPPABLE
         LA    R15,AMODE24         -JAL/XA-
         BSM   0,R15               -JAL/XA-
AMODE24  DS    0H                  -JAL/XA-
         L     R1,16               CVT
         L     R1,0(0,R1)          TCB WORDS
         L     R1,4(0,R1)          CURRENT TCB
         L     R1,12(0,R1)         TIOT
         LA    R1,24(0,R1)         DD ENTRIES
         LA    R14,CSCSTABL        CSC SYSID TABLE
         SPACE 1
CSCLOOP  CLC   4(8,R1),=CL8'CSCDATA'
         BE    CSCATCH             CSCDATA DD FOUND, ATTACH CMDSBCSC
         CLC   4(4,R1),=CL4'CSC#'
         BE    CSCLOOP2            CSC SYSID DD FOUND
         SPACE 1
CSCLOOP1 SR    R15,R15
         IC    R15,0(0,R1)         DD ENTRY LENGTH
         LA    R1,0(R15,R1)        NEXT DD ENTRY
         LTR   R15,R15             END OF TIOT
         BNZ   CSCLOOP             NO, CHECK NEXT
         L     R15,CSCTCB          CSC SUB-TASK TCB
         LTR   R15,R15             CSC ATTACHED
         BNZ   NOCSC               YES, CONTINUE
         MVI   CSCCMD,C'*'         INDICATE CSC NOT ACTIVE
         B     NOCSC
         SPACE 1
CSCLOOP2 MVC   0(4,R14),8(R1)      CSC SYSID
         LA    R14,4(0,R14)        NEXT ENTRY
         B     CSCLOOP1
         SPACE 1
CSCATCH  LA    R1,AREA
         XC    TERMECB(4),TERMECB
         ATTACH EP=CMDSBCSC,ECB=TERMECB
         ST    R1,CSCTCB           SAVE CSC TCB ADDR
         B     CSCLOOP1
NOCSC    EQU   *
         EJECT
         LOAD  EP=CMDSBSYS         LOAD CMD SUB-SYSTEM MODULE
         SPACE 1
         LR    R10,R0              LOAD FROM ADDR
         LA    R11,0(0,R1)         LOAD LENGTH
         SLL   R11,3               MULT NO. OF DOUBLEWORDS BY 8
         SPACE 1
         LOAD  EP=CMDDUMMY         LOAD DUMMY FLPA MODULE ADDR
         SPACE 1
         LR    R8,R0               SAVE
         A     R8,0(0,R10)            FUNCTION 1
         ST    R8,SSVTFUN1               ADDR IN SSVT
         LR    R8,R0               LOAD TO ADDR
         LA    R9,0(0,R1)          LOAD LENGTH
         SLL   R9,3                MULT NO. OF DOUBLEWORDS BY 8
         EJECT
*
*   THE FOLLOWING PAGE FIX CODE WILL FIX CMDDUMMY IN PLPA
*   ELIMINATING THE REQUIREMENT TO PUT IT IN A FIX LIST
*
*   THE ABOVE IS NOT TRUE YOU STILL NEED TO PUT
*   CMDDUMMY IN THE FIX LIST
*
PGFIX    LR    R5,R8               ... MODULE START
         SRL   R5,12               ... START PAGE
         LA    R6,0(R9,R8)         ... MODULE END
         SRL   R6,12               ... END PAGE
         XC    FIXECB(4),FIXECB    ... CLEAR PGFIX ECB
         PGFIX R,A=(5),ECB=FIXECB  ... FIX 1ST PAGE
         WAIT  ECB=FIXECB          ...
         CR    R5,R6               ... IS MODULE IN 1 OR 2 PAGES
         BE    PGFIX1              ... 1 PAGE, BYPASS 2ND PGFIX
         XC    FIXECB(4),FIXECB    ... CLEAR PGFIX ECB
         PGFIX R,A=(6),ECB=FIXECB  ... FIX 2ND PAGE
         WAIT  ECB=FIXECB          ...
         SPACE 1
PGFIX1   EQU   *
         EJECT
         MVCL  R8,R10              MOVE IN SUB-SYS MODULE
         L     R5,16               CVT
         L     R6,0(0,R5)          TCB WORDS
         L     R6,4(0,R6)          CURRENT TCB
         L     R6,12(0,R6)         TIOT
         L     R5,296(0,R5)        JESCT
         L     R5,24(0,R5)         1ST SSCVT ADDR
         EJECT
SSCVT1   CLC   8(4,R5),8(R6)       NAME MATCH
         BE    SSCVT2              YES, CONTINUE
         L     R5,4(0,R5)          NEXT SSCVT
         LTR   R5,R5               ZERO SSCVT
         BNZ   SSCVT1              NO, CONTINUE
         SPACE 1
         ABEND 77,DUMP             INIT ERROR
         SPACE 3
SSCVT2   LA    R7,TABLE            INPUT TABLE
         LA    R12,CMDTABLE        OUTPUT TABLE
         XC    0(84,R12),0(R12)    CLEAR OUTPUT TABLE
         SPACE 3
SSCVT3   MVC   CMDNAME+3(2),1(R7)  FINISH NAME
         SPACE 1
         LOAD  EPLOC=CMDNAME       LOAD IT
         SPACE 1
         CLI   3(R7),C'0'          TEST VERSION
         BNE   SSCVT5              YES, GET DUMMY TO OVERLAY
         ST    R0,0(0,R12)         SAVE ADDRESS
         MVC   0(1,R12),0(R7)      SAVE COMMAND ID
         DELETE EPLOC=CMDNAME
         EJECT
SSCVT4   LA    R7,4(0,R7)          INCR INPUT TABLE
         LA    R12,4(0,R12)        INCR OUTPUT TABLE
         CLI   0(R7),X'00'         END OF INPUT
         BE    SSCVT6              YES, EXIT
         B     SSCVT3              CONTINUE
         SPACE 3
SSCVT5   LR    R10,R0              SAVE TEST MODULE ADDR
         LA    R11,0(0,R1)         SAVE FROM LENGTH
         SLL   R11,3               MULT NO. OF DOUBLEWORDS BY 8
         MVC   TESTNAME+7(1),3(R7) FINISH NAME
         SPACE 1
         LOAD  EPLOC=TESTNAME
         SPACE 1
         ST    R0,0(0,R12)         SAVE ADDRESS
         MVC   0(1,R12),0(R7)      SAVE COMMAND ID
         LR    R8,R0               SAVE DUMMY MODULE ADDR
         LA    R9,2048             SAVE TO LENGTH
         MVCL  R8,R10              MOVE IN TEST MODULE
         B     SSCVT4              NEXT
         SPACE 3
SSCVT6   ST    R4,16(0,R5)         SAVE SSVT ADDR IN SSCVT
         LA    R8,CMD##TAB
         SPACE 1
SSCVT7   CLC   0(4,R8),=F'0'       END OF COMMANDS
         BE    WAIT                YES
         MVC   CMD#ID(1),0(R8)     SET UP COMMAND MODULE NAME
         LOAD  EPLOC=CMD#NAME
         ST    R0,0(0,R8)          SAVE MODULE ADDR
         MVC   0(1,R8),CMD#ID      RESTORE COMMAND ID
         LA    R8,4(0,R8)          NEXT COMMAND
         B     SSCVT7
         EJECT
WAIT     XC    SSVTECB(4),SSVTECB
         MVI   SSVTSTAT,X'00'      SET MONITOR READY INDICATOR
         WAIT  ECBLIST=SSVTLIST
         L     R1,SSVTASCB         ASCB ADDR
         L     R1,56(0,R1)         CSCB ADDR
         L     R14,40(0,R1)        ECB ADDR
         TM    0(R14),X'40'        STOP COMMAND ISSUED
         BZ    CMDPROC             NO
         WTO   'CMD SUBSYS -   COMMAND SUB-SYSTEM TERMINATED',DESC=2
         XC    16(4,R5),16(R5)     DISCONNECT CMD SUBSYS
         CLI   CSCCMD,C'*'         CSC ACTIVE
         BE    EXIT                NO, BYPASS DETACH
         MVI   CSCCMD,C'*'         INDICATE SHUTDOWN
         WAIT  ECB=TERMECB
         LA    R1,CSCTCB
         DETACH (1)
         SPACE 1
EXIT     LR    R1,R4               GETMAIN AREA
         L     R0,SIZE
         FREEMAIN R,LV=(0),A=(1)
         SPACE 3
RETURN   L     R13,SAVE+4
         SPACE 1
         RETURN (14,12),RC=0
         EJECT
CMDPROC  MVC   XAU(1),SSVTUMID+3
         MVC   SSVTWAIT(8),=8C'0'
         XC    SSVTTIME(4),SSVTTIME
         LA    R1,CMD##
         CLI   0(R1),C'$'          TABLE ENTRY DELETE REQUEST
         BE    CMDDEL              YES
         LA    R8,CMD##+73
         SPACE 1
CMDPROCA CLC   0(2,R8),=C'T='      TIME PARM
         BE    CMDPROCB            YES
         BCTR  R8,0                PREVIOUS CHARACTER
         CR    R1,R8               BACK TO BEGINNING
         BE    CMDPROC0            YES, NO T= PARM
         B     CMDPROCA
         SPACE 1
CMDPROCB LA    R1,PACK+3           TARGET FIELD
         MVC   PACK(4),=C'0000'
         CLI   4(R8),C' '          SENDING BYTE BLANK
         BE    *+12                YES, DONT MOVE
         MVC   0(1,R1),4(R8)       MOVE IT
         BCTR  R1,0                NEXT TARGET BYTE
         CLI   3(R8),C' '          SENDING BYTE BLANK
         BE    *+12                YES, DONT MOVE
         MVC   0(1,R1),3(R8)       MOVE IT
         BCTR  R1,0                NEXT TARGET BYTE
         CLI   2(R8),C' '          SENDING BYTE BLANK
         BE    *+10                YES, DONT MOVE
         MVC   0(1,R1),2(R8)       MOVE IT
         MVC   DOUBLE(4),=C'0000'
         MVZ   DOUBLE(4),PACK
         CLC   DOUBLE(4),=C'0000'  IS IT NUMERIC
         BE    CMDPROCC            YES
         MVC   PACK(4),=C'0000'
         SPACE 1
CMDPROCC PACK  DOUBLE(8),PACK(4)
         CVB   R15,DOUBLE          SECONDS TO BINARY
         SR    R14,R14
         ST    R15,SSVTTIME        SAVE BINARY SECONDS
         D     R14,=F'60'          CALCULATE MINUTES AND SECONDS
         CVD   R15,DOUBLE          MINUTES
         UNPK  SSVTWAIT+2(2),DOUBLE+6(2)
         OI    SSVTWAIT+3,X'F0'
         CVD   R14,DOUBLE          SECONDS
         UNPK  SSVTWAIT+4(2),DOUBLE+6(2)
         OI    SSVTWAIT+5,X'F0'
         MVC   0(4,R8),=CL4' '
         BCTR  R8,0
         CLI   0(R8),C','
         BNE   *+8
         MVI   0(R8),C' '
         EJECT
CMDPROC0 LA    R8,CMD##TAB         ## COMMAND TABLE
         SPACE 1
CMDPROC1 CLC   CMD##(1),0(R8)      COMMAND MATCH
         BE    CMDPROC3            YES
         LA    R8,4(0,R8)          NEXT TABLE ENTRY
         CLC   0(4,R8),=F'0'       END OF TABLE
         BNE   CMDPROC1            NO
         SPACE 1
CMDPROC2 SR    R0,R0
         IC    R0,XAU
         LA    R1,NOTSPMSG         COMMAND NOT SUPPORTED MSG
         SVC   35
         B     WAIT
         SPACE 1
CMDPROC3 SR    R0,R0
         IC    R0,XAU
         LA    R1,MONMSG           MONITOR COMMAND ACCEPTED MSG
         SVC   35
         LA    R1,CMD##+1          SUB-PARM ADDR
         CLI   0(R1),C' '          1 BLANK ALLOWED
         BNE   CMDPROC4            NOT BLANK
         LA    R1,1(0,R1)          NEXT CHAR
         CLI   0(R1),C' '          ANY SUB-PARM
         BNE   CMDPROC4            YES
         XC    XAL(4),XAL          CLEAR SUB-PARM ADDR
         B     CMDPROC5
         SPACE 1
CMDPROC4 ST    R1,XAL              SUB-PARM ADDR
         SPACE 1
CMDPROC5 STM   R14,R12,SAVE+12     SAVE REGS
         LA    R2,XSA              XSA ADDR
         L     R15,0(0,R8)         LOAD COMMAND MODULE ADDR
         LA    R15,0(0,R15)
         LTR   R15,R15             ZERO ADDR
         BZ    CMDPROC2            YES, NOT SUPPORTED
         BALR  R14,R15             BRANCH TO COMMAND MODULE
         EJECT
         USING CMDRETN,R14
CMDRETN  L     R1,CMDBASE
         LA    R3,0(0,R14)         LOAD RETURN POINT
         SR    R3,R1               CALC ENTRY POINT
         DROP  R14
         LM    R14,R12,SAVE+12     RELOAD REGS
         B     WAIT
         SPACE 3
CMDDEL   LA    R15,1(0,R1)         COMMAND ID
         LA    R1,CMD##TAB         COMMAND TABLE
         SPACE 1
CMDDEL1  CLC   0(1,R15),0(R1)      COMMAND MATCH
         BE    CMDDEL2             YES
         LA    R1,4(0,R1)          NEXT ENTRY
         CLC   0(4,R1),=F'0'       END OF TABLE
         BNE   CMDDEL1             NO, CHECK NEXT
         B     CMDDEL3             YES, NOT FOUND, IGNORE
         SPACE 1
CMDDEL2  MVI   0(R1),X'00'         DISABLE COMMAND
         MVC   DISBL(4),=X'00300100'
         MVC   DISBL+4(44),=CL44'CMD SUBSYS -   ##X  COMMAND DISABLED'
         MVC   DISBL+21(1),0(R15)
         SR    R0,R0
         IC    R0,XAU
         LA    R1,DISBL
         SVC   35
         B     WAIT
         SPACE 1
CMDDEL3  SR    R0,R0
         IC    R0,XAU
         LA    R1,NOTDSMSG
         SVC   35
         B     WAIT
         EJECT
         LTORG
         SPACE 5
SAVE     DS    18F
         DS    0D
DOUBLE   DS    2F
CSCTCB   DC    F'0'
TERMECB  DS    F
FIXECB   DS    F
PACK     DS    F
SIZE     DC    X'F1',AL3(AREAEND-AREA)
CMDBASE  DC    A(CMDRETN-CMDSBINT)
         SPACE 1
         DS    0D
CMDNAME  DC    CL8'IEEXX03D'
CMD#NAME DC    CL4'IEEZ'
CMD#ID   DC    C' '
         DC    CL3'03D'
TESTNAME DC    CL8'CMDTESTX'
         SPACE 1
TABLE    DC    20F'0'
TABEND   DC    F'0'
         SPACE 1
         DS    0F
CMD##TAB DC    C'A',AL3(0)
         DC    C'B',AL3(0)
         DC    C'C',AL3(0)
         DC    C'J',AL3(0)
         DC    C'P',AL3(0)
         DC    C'S',AL3(0)
         DC    F'0'
         SPACE 1
NOTSPMSG DC    X'00300100'
         DC    CL44'CMD SUBSYS -   COMMAND NOT SUPPORTED'
         SPACE 1
NOTDSMSG DC    X'00300100'
         DC    CL44'CMD SUBSYS -   COMMAND NOT DISABLED'
         SPACE 1
MONMSG   DC    X'00300100'
         DC    CL44'CMD SUBSYS -   MONITOR COMMAND ACCEPTED'
         EJECT
         DS    0D
XSA      DS    0CL48
         DS    5F
XAL      DS    F
XAT      DS    F
         DS    F
XAS      DS    2F
XAU      DS    X
         DS    XL7
         EJECT
AREA     DSECT
SSVT     DS    H
SSVTFNUM DS    H
SSVTFCOD DS    XL256
SSVTFRTN DS    0F
SSVTFUNC DS    0F
SSVTFUN1 DS    F
         DS    8F
SSVTMSGT DS    F
SSVTLIST DS    2F
SSVTECB  DS    F
         DS    0D
SSVTWAIT DS    CL8
SSVTTIME DS    F
SSVTASCB DS    0F
SSVTSTAT DS    X
         DS    XL3
SSVTUMID DS    F
         SPACE 3
CMDTABLE DS    20F
CMDEND   DS    F
         SPACE 3
         DS    0D
USERWORK DS    CL228
         SPACE 3
CMDXSA   DS    0CL48
         DS    5F
CMDXAL   DS    F
         DS    4F
CMDXAU   DS    X
         DS    XL7
         SPACE 3
CMD##    DS    CL78
HDRMSG   DS    CL52
DISBL    DS    CL48
         DS    0F
CSCHDR   DS    CL52
CSCCMD   DS    CL78
CSCSTABL DS    CL48
         SPACE 3
AREAEND  DS    0D
         EJECT
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CMDSBMON
         TITLE 'XA1SBMON -   STANDALONE FULL SCREEN MONITOR'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CMDSBMON -       STANDALONE FULL SCREEN MONITOR           ***
***                                                                 ***
***       VERSION -        3.0                                      ***
***                                                                 ***
***       MVS LEVEL -      XA 2.1.3                                 ***
***                                                                 ***
***       UPDATED -        06/24/86  BFG-XA SUPPORT FOR XA       FNB001
***                                                                 ***
***  THIS MODULE SEARCHES THE CODE IT IS LOADING (#Q, #N, ETC.) TO  ***
***     SEE IF SUBPOOL 241 IS BEING REQUESTED FOR THE GETMAIN.  THIS***
***     MODULE DOES THIS BY SEARCHING FOR X'F100' IN THE CODE.      ***
***     IF THE EXECUTION IS TAKING PLACE VIA THE SYSTEM CONSOLE,    ***
***     THEN SUBPOOL 241 IS ALLOWED.  IF THE EXECUTION IS TAKING    ***
***     PLACE WITHIN TSO, THEN THE X'F100' IS CHANGED TO X'0000'    ***
***     (FOR SUBPOOL 0) PRIOR TO THE ACTUAL EXECUTION OF THE CODE.  ***
***     IF THE PROPER CODING CONVENTIONS ARE NOT FOLLOWED IN THE    ***
***     SUB-MODULES (#Q, #N, ETC.), THIS CHECK MAY NOT BE SUCCESS-  ***
***     FUL, AND AN ABEND B0A WILL TAKE PLACE.
***                                                                 ***
***********************************************************************
***********************************************************************
         EJECT
CMDSBMON CSECT
         SAVE  (14,12)
         LR    R3,R15
         USING CMDSBMON,R3
         ST    R13,SAVE+4
         LA    R13,SAVE
         USING SAVE,R13
         L     R4,0(0,R1)
         L     R15,16              CVT ADDR
         L     R15,0(0,R15)        TCB WORDS
         L     R14,12(0,R15)       CURRENT ASCB
         L     R14,4(0,R15)        CURRENT TCB
         L     R14,12(0,R14)       TIOT
         CLC   0(8,R14),=CL8'CMDSBPAG'    SPECIAL NAME TO FORCE
         BNE   *+8                        PAGE EJECT BETWEEN LOG ENTRY
         MVI   LOGLINE-1,X'8B'
         MVC   UNIT(3),2(R4)         UNIT ADDR
         MVC   UNITVOFF(3),2(R4)     UNIT ADDR
         MVC   UNITVON(3),2(R4)      UNIT ADDR
         GETMAIN VU,LA=CMDOUTST,A=CMDOUTPT
         L     R15,CMDOUTPT+4        GETMAIN AREA LENGTH
         C     R15,=F'180000'        MINIMUM
         BL    ABEND                 NO
         S     R15,=F'100000'        MINUS GUARANTEE
         ST    R15,CMDOUTSZ+4        SET MAX SIZE
         L     R0,CMDOUTPT+4
         L     R1,CMDOUTPT
         FREEMAIN R,LV=(0),A=(1)
         GETMAIN VU,LA=CMDOUTSZ,A=CMDOUTPT
         SR    R14,R14
         L     R15,CMDOUTPT+4        GETMAIN AREA LENGTH
         D     R14,=F'80'
         SR    R14,R14
         M     R14,=F'80'            ROUND TO MULTIPLE OF 80
         A     R15,CMDOUTPT          GETMAIN AREA END
         S     R15,=F'240'           PRACTICAL END
         ST    R15,CMDOUTEN
         MVC   0(161,R15),CMDOUTOV   SET TRUNCATED MESSAGE
         MODESET KEY=ZERO,MODE=SUP
         MVC   SCRSAVE(4),PACK MOVE VALUE TO WORK AREA           BFG-XA
         TR    SCRSAVE(3),TOHEX                                  BFG-XA
         PACK  SCRSAVE+4(3),SCRSAVE(4) MAKE HEX                  BFG-XA
         LH    R4,SCRSAVE+4   GET HEX VALUE                      BFG-XA
         L     R6,SAVE+4      GET SAVE AREA VALUE                BFG-XA
         IOSLOOK DEV=(R4),UCB=(R5) GET UCB ADDRESS               BFG-XA
         ST    R6,SAVE+4                                         BFG-XA
         LTR   R15,R15        DID UCB EXIST                      BFG-XA
         BNZ   TERMINAT                                          BFG-XA
         CLI   18(R5),X'10'          DISPLAY TYPE UCB
         BNE   TERMINAT              NO, TERMINATE
         TM    3(R5),X'02'           ACTIVE CONSOLE
         BZ    VARYCONT              NO
         MVC   UNITVCON(3),UNIT      UNIT ADDR
         SR    R0,R0
         LA    R1,VARYOFF
         SVC   34
         SPACE 1
VARYWAIT STIMER WAIT,DINTVL=VARYTIME
         TM    3(R5),X'80'
         BO    VARYWAIT
         SPACE 1
VARYCONT SR    R0,R0
         LA    R1,VARYON
         SVC   34
         SPACE 1
VARYCWT  STIMER WAIT,DINTVL=VARYTIME
         TM    3(R5),X'80'
         BZ    VARYCWT
         BAL   R4,DYNALLOC
         XC    GETMADR(4),GETMADR
         OPEN  (TPDCB,(OUTPUT),CMDLOG,(OUTPUT))
         B     CMDINIT
         EJECT
DYNALLOC ALLOC UNIT=UNITADR,DDNTO=DDNAME,ERROR=ABEND
         MVC   TPDCB+40(8),DDNAME
         BR    R4
         EJECT
CMDINIT  MODESET KEY=ZERO,MODE=SUP
         L     R1,16               CVT
         L     R1,0(0,R1)          TCB WORDS
         L     R1,12(0,R1)         CURRENT ASCB
         L     R1,144(0,R1)        OUCB
         OI    17(R1),X'80'        SET NON-SWAPPABLE
         L     R0,SIZEGETM         GETMAIN SIZE
         L     R1,GETMADR          GETMAIN ADDR
         LTR   R1,R1               GETMAIN ALREADY DONE
         BNZ   CMDINIT1            YES
         GETMAIN R,LV=(0)          GET COMMAND WORK AREA
         LA    R1,0(0,R1)
         ST    R1,GETMADR          SAVE GETMAIN ADDR
         SPACE 1
CMDINIT1 LR    R4,R1
         L     R5,SIZEGETM
         LA    R5,0(0,R5)
         SR    R6,R6
         SR    R7,R7
         MVCL  R4,R6               CLEAR GETMAIN AREA
         MVI   RETCODE,X'00'
         L     R4,CMDOUTPT
         LA    R5,1760
         L     R6,=A(OPENTEXT)
         LA    R7,1760
         MVCL  R4,R6               MOVE OPENING TEXT TO OUTPUT
         L     R4,CMDOUTPT
         MVI   REFRSW,X'00'
         MVC   REFRESH(8),=CL8'00000000'
         EJECT
CMDGET   CLC   REFRESH(8),=CL8'00000000'  AUTO REFRESH
         BE    CMDGET1             NO
         L     R4,CMDOUTPT         OUTPUT ADDR
         BAL   R7,SCREEN           WRITE SCREEN AND GET NEXT COMMAND
         CLI   RETCODE,C'Z'        ATTENTION
         BE    CMDINIT             YES
         STIMER WAIT,DINTVL=REFRESH
         L     R1,REFRCNT
         BCT   R1,*+8              BRANCH UNTIL END OF AUTO REFRESH
         B     CMDINIT
         ST    R1,REFRCNT
         MVC   SCRREPLY+6(57),SCRLSREP
         LA    R14,SCRREPLY+6
         B     CMDGET2
         SPACE 1
CMDGET1  L     R4,CMDOUTPT         OUTPUT ADDR
         BAL   R7,SCREEN           WRITE SCREEN AND GET NEXT COMMAND
         CLI   RETCODE,C'Z'        ATTENTION
         BE    CMDINIT             YES
         SPACE 1
CMDGET2  L     R4,CMDOUTPT
         XC    CMDOUTBG(4),CMDOUTBG
         XC    CMDOUTCT(4),CMDOUTCT
         CLI   0(R14),C'('         OUTPUT INCREMENT
         BNE   CMDGET2A            NO
         CLI   4(R14),C')'         OUTPUT INCREMENT
         BNE   CMDGET2A            NO
         MVC   DOUBLE(3),=C'000'
         MVZ   DOUBLE(3),1(R14)
         CLC   DOUBLE(3),=C'000'   NUMERIC
         BNE   CMDGET2A            NO, ERROR
         PACK  DOUBLE(8),1(3,R14)
         LR    R1,R14              SAVE REG14
         SR    R14,R14
         CVB   R15,DOUBLE
         M     R14,=F'1000'
         ST    R15,CMDOUTBG
         LR    R14,R1              POINT TO COMMAND
         MVC   0(58,R14),5(R14)    SHIFT OVER COMMAND
         SPACE 1
CMDGET2A LA    R10,COMTAB          # COMMAND TABLE
         LA    R11,MODLIST         # COMMAND MODULE LIST
         MVI   TCMDTYP,C' '
         CLI   0(R14),C'#'         # COMMAND
         BNE   PLOOPA              NO, CHECK CONTROL COMMANDS
         LA    R14,1(0,R14)        ADJUST INPUT PARM
         CLI   0(R14),C'#'         ## COMMAND
         BNE   PLOOPC              NO
         LA    R14,1(0,R14)        ADJUST INPUT PARM
         BCTR  R1,0                ADJUST LENGTH
         LA    R10,COMTAB2         ## COMMAND TABLE
         LA    R11,MODLIST2        ## COMMAND MODULE LIST
         MVI   TCMDTYP,C'#'        INDICATE ##
         B     PLOOPC
         EJECT
PLOOPA   LA    R10,COMTAB3         GRAPHIC MONITOR COMMAND TABLE
         LA    R11,MODLIST3        GRAPHIC MONITOR MODULE LIST
         MVI   TCMDTYP,C'-'        INDICATE GRAPHIC MONITOR
         TM    0(R14),X'F0'        CHANGE REFRESH TIME COMMAND
         BNO   PLOOPC              NO, GRAPHIC MONITOR COMMAND
         TM    1(R14),X'F0'        CHANGE REFRESH TIME COMMAND
         BNO   PLOOPB              NO, ERROR
         MVC   REFRESH+4(2),0(R14)
         LA    R1,20               DEFAULT REFRESH COUNT
         CLI   2(R14),C'/'
         BNE   PLOOPA1
         TM    3(R14),X'F0'        CHANGE REFRESH TIME COMMAND
         BNO   PLOOPB              NO, ERROR
         TM    4(R14),X'F0'        CHANGE REFRESH TIME COMMAND
         BNO   PLOOPB              NO, ERROR
         PACK  DOUBLE(8),3(2,R14)
         CVB   R1,DOUBLE
         SPACE 1
PLOOPA1  MVC   0(80,R4),=CL80'CONTROL COMMAND ACCEPTED'
         MVI   80(R4),X'FF'
         ST    R1,REFRCNT
         B     CMDGET1
         SPACE 1
PLOOPB   MVC   0(80,R4),=CL80'ERROR IN CONTROL COMMAND'
         MVI   80(R4),X'FF'
         B     CMDGET
         SPACE 1
PLOOPC   MVC   COMMAND(1),0(R14)   SAVE COMMAND
         SR    R15,R15
         LA    R1,1(0,R14)         1ST BYTE OF SUB-PARM
         CLI   0(R1),C' '          1ST BYTE BLANK
         BNE   *+16                NO
         LA    R1,1(0,R1)          NEXT BYTE
         CLI   0(R1),C' '          2ND BYTE BLANK
         BE    PROCESS             YES, NO SUB-PARM
         LA    R15,PARM
         MVC   PARM(60),0(R1)
         EJECT
PROCESS  ST    R15,EXITLIST+20     SAVE TEXT ADDR
         MVC   WAITTIME(8),=8C'0'
         XC    CSCSYSID(4),CSCSYSID
         XC    HEXTIME(4),HEXTIME
         LA    R1,PARM
         LA    R8,PARM+74
         SPACE 1
PROCESS1 CLC   0(2,R8),=C'T='      TIME PARM
         BE    PROCESS2            YES
         CLC   0(2,R8),=C'S='      SYSID PARM
         BE    PROCESS4            YES
         BCTR  R8,0                PREVIOUS CHARACTER
         CR    R1,R8               BACK TO BEGINNING
         BNE   PROCESS1            NO, CHECK NEXT
         B     PROCESS5            YES, NO T= FOUND
         SPACE 1
PROCESS2 LA    R1,PACK+3           TARGET FIELD
         MVC   PACK(4),=C'0000'
         CLI   4(R8),C' '          SENDING BYTE BLANK
         BE    *+12                YES, DONT MOVE
         MVC   0(1,R1),4(R8)       MOVE IT
         BCTR  R1,0                NEXT TARGET BYTE
         CLI   3(R8),C' '          SENDING BYTE BLANK
         BE    *+12                YES, DONT MOVE
         MVC   0(1,R1),3(R8)       MOVE IT
         BCTR  R1,0                NEXT TARGET BYTE
         CLI   2(R8),C' '          SENDING BYTE BLANK
         BE    *+10                YES, DONT MOVE
         MVC   0(1,R1),2(R8)       MOVE IT
         MVC   DOUBLE(4),=C'0000'
         MVZ   DOUBLE(4),PACK
         CLC   DOUBLE(4),=C'0000'  IS IT NUMERIC
         BE    PROCESS3            YES
         MVC   PACK(4),=C'0000'
         SPACE 1
PROCESS3 PACK  DOUBLE(8),PACK(4)
         CVB   R15,DOUBLE          SECONDS TO BINARY
         SR    R14,R14
         ST    R15,HEXTIME         SAVE BINARY SECONDS
         D     R14,=F'60'          CALCULATE MINUTES AND SECONDS
         CVD   R15,DOUBLE          MINUTES
         UNPK  WAITTIME+2(2),DOUBLE+6(2)
         OI    WAITTIME+3,X'F0'
         CVD   R14,DOUBLE          SECONDS
         UNPK  WAITTIME+4(2),DOUBLE+6(2)
         OI    WAITTIME+5,X'F0'
         MVC   0(4,R8),=CL4' '
         BCTR  R8,0
         CLI   0(R8),C','
         BNE   *+8
         MVI   0(R8),C' '
         B     PROCESS5
         SPACE 1
PROCESS4 MVC   CSCSYSID(4),2(R8)
         BCTR  R8,0
         MVC   0(8,R8),=CL8' '
         MVC   CSCCMD(1),COMMAND
         MVC   CSCCMD+1(79),PARM
         EJECT
PROCESS5 LA    R1,WAITTIME
         ST    R1,EXITLIST+24      PASS WAITTIME TO COMMANDS
         MVC   TCOMMAND(1),COMMAND
         TR    COMMAND,0(R10)      TRANSLATE COMMAND TO INDEX
         SR    R9,R9
         IC    R9,COMMAND          INSERT INDEX
         SLL   R9,3                OFFSET INTO MODULE LIST
         L     R15,16              CVT ADDR
         L     R15,0(0,R15)        TCB WORDS
         L     R14,12(0,R15)       CURRENT ASCB
         MVC   ASID(2),36(R14)     SAVE ASID
         L     R14,4(0,R15)        CURRENT TCB
         L     R14,12(0,R14)       TIOT
         MVC   USERID(8),0(R14)    USERID (JOBNAME)
         UNPK  TASID(5),ASID(3)
         NC    TASID(4),=8X'0F'
         TR    TASID(4),=C'0123456789ABCDEF'
         MVI   TASID+4,C' '
         L     R15,16              CVT ADDR
         L     R15,196(0,R15)      SMCA
         MVC   SYSTEM(4),16(R15)   SYSTEM ID
         TIME  DEC
         ST    R1,DOUBLE
         UNPK  YEAR(3),DOUBLE+1(2)
         MVI   YEAR+2,C'.'
         UNPK  DAY(3),DOUBLE+2(2)
         OI    DAY+2,X'F0'
         ST    R0,DOUBLE
         UNPK  HOUR(3),DOUBLE(2)
         MVI   HOUR+2,C'.'
         UNPK  MINUTE(3),DOUBLE+1(2)
         MVI   MINUTE+2,C' '
         MVI   68(R4),C' '
         MVC   69(11,R4),68(R4)
         MVC   0(68,R4),HEADER
         LA    R4,80(0,R4)
         CLI   CSCSYSID,X'00'      CROSS-SYSTEM REQUEST
         BNE   CSCPROC             YES
         LTR   R9,R9               COMMAND IN LIST
         BNZ   LOAD                YES, GO PROCESS
         MVC   0(80,R4),=CL80'COMMAND NOT FOUND'
         LA    R4,80(0,R4)
         MVI   0(R4),X'FF'
         B     CMDGET
         EJECT
CSCPROC  LA    R1,10               RESET TIMER COUNT
         MVI   0(R4),C' '
         MVC   1(79,R4),0(R4)
         SPACE 1
CSCPROC0 ST    R1,RESETCNT         RESET TIMER COUNT
         BAL   R10,CSCREAD         READ CSC DATA
         L     R1,16               CVT
         L     R1,0(0,R1)          TCB WORDS
         L     R1,4(0,R1)          CURRENT TCB
         L     R1,12(0,R1)         TIOT
         CLC   0(8,R11),=8X'00'    CSC BUSY
         BE    CSCPROC4            NO
         CLI   4(R11),X'FF'        TSO ID CROSS-SYSTEM COMMAND
         BNE   CSCPROC1            NO
         CLC   5(3,R11),4(R1)      TSO ID MATCH
         BE    CSCPROC2            YES
         SPACE 1
CSCPROC1 STIMER WAIT,DINTVL=CSCWAIT
         L     R1,RESETCNT         RESET COUNT
         BCT   R1,CSCPROC0         TRY AGAIN
         MVC   TIMESID(4),4(R11)
         MVC   0(48,R4),TIMEMSG    TIMEOUT MSG
         LA    R4,80(0,R4)
         MVI   0(R4),X'FF'
         BAL   R10,CSCCLEAR        FORCE CLEAR
         B     CMDGET
         SPACE 3
CSCPROC2 LH    R9,10(0,R11)        WTO COUNT
         LA    R11,148(0,R11)      1ST WTO ADDR
         SPACE 1
CSCPROC3 MVI   0(R4),C' '
         MVC   1(79,R4),0(R4)
         LA    R1,4(0,R11)         MSG ADDR
         LH    R14,0(0,R11)        MSG LENGTH
         SH    R14,=H'5'
         EX    R14,CSCMVE
         LH    R1,0(0,R11)         WTO LENGTH
         LA    R11,0(R1,R11)       NEXT MSG
         LA    R4,80(0,R4)
         BCT   R9,CSCPROC3
         BAL   R10,CSCCLEAR        RESET DATASET TO ALLOW REUSE
         MVI   0(R4),X'FF'
         B     CMDGET
         SPACE 1
CSCMVE   MVC   0(0,R4),0(R1)
         EJECT
CSCPROC4 MVI   0(R11),X'FF'        TSO SENDER
         MVC   1(3,R11),4(R1)      TSO ID
         XC    8(2,R11),8(R11)
         MVC   12(4,R11),=F'148'   COMMAND RECORD LENGTH
         MVC   16(78,R11),CSCCMD   MOVE COMMAND TO RECORD
         XC    96(52,R11),96(R11)
         MVC   4(4,R11),CSCSYSID
         BAL   R10,CSCWRITE        REWRITE RECORD
         MVC   RECVMSG+20(1),16(R11)
         MVC   0(44,R4),RECVMSG
         LA    R4,80(0,R4)
         MVI   0(R4),X'FF'
         L     R4,CMDOUTPT         OUTPUT ADDR
         STM   R2,R12,SCRSAVE
         BAL   R7,SCREEN
         LM    R2,R12,SCRSAVE
         CLI   RETCODE,C'Z'        ATTENTION
         BE    CMDINIT             YES
         B     CSCPROC1
         EJECT
CSCREAD  MVC   CSCDATA+62(2),=H'19069' FULL BLOCKSIZE
         OPEN  (CSCDATA)
         L     R8,=A(RECORD)
         GET   CSCDATA,(R8)
         L     R11,=A(RECORD)
         CLC   0(12,R11),=XL12'00' ZERO REQUEST
         BE    CSCREAD1            NO
         CLC   0(96,R11),PREVREC   SAME REQUEST
         BE    CSCREAD2            NO
         SPACE 1
CSCREAD1 MVC   PREVREC(96),0(R11)  SAVE NEW REQUEST
         MVC   RESETCNT(4),=F'10'  SET NEW COUNT
         SPACE 1
CSCREAD2 CLOSE (CSCDATA)
         BR    R10
         EJECT
CSCCLEAR L     R1,=A(RECORD)
         XC    0(16,R1),0(R1)
         SPACE 1
CSCWRITE L     R1,=A(RECORD)
         L     R1,12(0,R1)         RECORD LENGTH
         LTR   R1,R1               ZERO LENGTH
         BNZ   CSCWRIT1            NO
         LA    R1,16               MINIMUM LENGTH
         SPACE 1
CSCWRIT1 STH   R1,CSCDATA+62       SAVE LENGTH FOR WRITE
         LR    R2,R1
         OPEN  (CSCDATA,(OUTPUT))
         L     R8,=A(RECORD)
         PUT   CSCDATA,(R8)
         CLOSE (CSCDATA)
         BR    R10
         EJECT
LOAD     LA    R9,0(R11,R9)        MODULE NAME ADDR
         MVC   LOADNAME(8),0(R9)
         LOAD  EPLOC=LOADNAME      LOAD COMMAND MODULE
         ST    R0,ENTRY            SAVE ENTRY ADDR
         LR    R5,R0               MODULE ADDR
         LA    R6,0(0,R1)          MODULE DOUBLEWORDS
         SLL   R6,3                MODULE LENGTH
         ST    R6,LENGTH           SAVE MODULE LENGTH
         SH    R6,=H'6'            ADJUST SCAN LENGTH
         SPACE  1
LOAD1    CLC   0(6,R5),=X'430020280A23'   WTO INSTRUCTIONS
         BE    LOAD3               YES
         SPACE 1
LOAD2    LA    R5,2(0,R5)          NEXT INSTRUCTION
         BCTR  R6,0
         BCT   R6,LOAD1            PROCESS NEXT
         B     LOAD4
         SPACE 1
LOAD3    MVC   0(6,R5),=X'58F0200005EF'
         B     LOAD2
         SPACE 1
LOAD4    L     R5,ENTRY            MODULE ADDR
         L     R6,LENGTH           MODULE LENGTH
         SH    R6,=H'4'            ADJUST SCAN LENGTH
         SPACE  1
LOAD5    CLC   0(2,R5),=X'F100'    SUBPOOL 241
         BE    LOAD7               YES
         SPACE 1
LOAD6    LA    R5,4(0,R5)          NEXT INSTRUCTION
         BCTR  R6,0
         BCTR  R6,0
         BCTR  R6,0
         BCT   R6,LOAD5            PROCESS NEXT
         B     EXECUTE             END OF MODULE
         SPACE 1
LOAD7    MVC   0(2,R5),=H'0'       SET SUBPOOL ZERO
         B     EXECUTE             END OF MODULE
         EJECT
SCREEN   LA    R5,22               MAX OUTPUT LINES
         LA    R6,SCRLIN02         OUTPUT BEGIN LINE
         LA    R8,SCRLIN02
         LA    R9,1760
         SR    R10,R10
         SR    R11,R11
         MVCL  R8,R10              CLEAR SCREEN AREA
         SPACE 1
SCREEN1  MVC   0(80,R6),0(R4)      SET OUTPUT LINE
         MVC   LOGLINE+1(80),0(R4)
         PUT   CMDLOG,LOGLINE
         L     R1,=A(SCRPLUS)
         MVI   0(R1),C' '
         LA    R4,80(0,R4)         NEXT INPUT LINE
         LA    R6,80(0,R6)         NEXT OUTPUT LINE
         CLI   0(R4),X'FF'         END OF INPUT
         BE    SCREEN2             YES, GO WRITE
         BCT   R5,SCREEN1
         L     R1,=A(SCRPLUS)
         MVI   0(R1),C'+'
         SPACE 1
SCREEN2  PUT   CMDLOG,LOGLINE-1    SPACE BETWEEN SCREENS
         LA    R14,SCRLIN02
         TR    0(80,R14),TABLE
         TR    80(80,R14),TABLE
         TR    160(80,R14),TABLE
         TR    240(80,R14),TABLE
         TR    320(80,R14),TABLE
         TR    400(80,R14),TABLE
         TR    480(80,R14),TABLE
         TR    560(80,R14),TABLE
         TR    640(80,R14),TABLE
         TR    720(80,R14),TABLE
         TR    800(80,R14),TABLE
         TR    880(80,R14),TABLE
         TR    960(80,R14),TABLE
         TR    1040(80,R14),TABLE
         TR    1120(80,R14),TABLE
         TR    1200(80,R14),TABLE
         TR    1280(80,R14),TABLE
         TR    1360(80,R14),TABLE
         TR    1440(80,R14),TABLE
         TR    1520(80,R14),TABLE
         TR    1600(80,R14),TABLE
         TR    1680(80,R14),TABLE
         SPACE 3
SCREEN2A CLI   SCRREPLY,X'6C'      ATTENTION
         BE    ATENTION            YES
         CLI   SCRREPLY,X'6D'      REPEAT
         BE    REPEAT              YES
         CLI   SCRREPLY,X'6E'      ATTENTION
         BE    ATENTION            YES
         LA    R2,SCRBEGIN
         RESETPL TPDECB,ATTENT
         SPACE 3
         XC    TPDECB(4),TPDECB
         WRITE TPDECB,TS,TPDCB,(2),SCRLEN,,1,MF=E
         WAIT  ECB=TPDECB
         SPACE 3
         XC    SCRREPLY(63),SCRREPLY
         XC    TPDECB(4),TPDECB
         LA    R2,SCRREPLY
         READ  TPDECB,TI,TPDCB,(2),63,,1,MF=E
         CLI   REFRSW,X'FF'        REFRESH IN PROGRESS
         BCR   8,R7                YES
         CLC   REFRESH(8),=CL8'00000000' REFRESH REQUESTED
         BE    *+8                 NO
         MVI   REFRSW,X'FF'
         WAIT  ECB=TPDECB
         CLI   SCRREPLY,X'6C'      ATTENTION
         BE    ATENTION            YES
         CLI   SCRREPLY,X'6D'      REPEAT
         BE    REPEAT              YES
         CLI   SCRREPLY,X'6E'      ATTENTION
         BE    REPEAT              YES
         OC    SCRREPLY(63),=CL63' '  CAPITALIZE
         CLI   SCRREPLY,X'7D'      ENTER KEY
         BNE   PFKCHK              NO, CHECK PFK ENTRY
         SPACE 3
SCREEN3  LA    R14,SCRREPLY+6
         MVC   SCRLSREP(57),SCRREPLY+6
         CLI   SCRREPLY+6,C'Z'       TERMINATE
         BE    EXIT                YES
         CLC   SCRREPLY+6(3),=C'END' TERMINATE
         BE    EXIT                YES
         CLI   SCRREPLY+6,C'-'     SCROLL BACK
         BE    SCROLL              YES
         CLI   SCRREPLY+6,C'+'     SCROLL FORWARD
         BE    SCROLL              YES
         CLI   SCRREPLY+6,C'='     SCROLL FIND EQ
         BE    SCROLL2             YES
         CLI   SCRREPLY+6,C' '     NEXT SCREEN REQUEST
         BCR   7,R7                NO
SCREEN3B LA    R8,SCRLIN02
         LA    R9,1760
         SR    R10,R10
         SR    R11,R11
         MVCL  R8,R10              CLEAR SCREEN AREA
         CLI   0(R4),X'FF'         ANY MORE OUTPUT
         BNE   SCREEN              YES
         MVC   SCRLIN02(80),=CL80'****   END  OF  OUTPUT   ****'
         B     SCREEN2
         EJECT
SCROLL   MVC   DOUBLE(3),=C'000'
         MVZ   DOUBLE(3),SCRREPLY+7
         CLC   DOUBLE(3),=C'000'   NUMERIC
         BNE   SCROLL1
         PACK  DOUBLE(8),SCRREPLY+7(3)
         CVB   R14,DOUBLE
         B     SCROLL2
         SPACE 1
SCROLL1  L     R14,=F'99999999'
         SPACE 1
SCROLL2  LA    R11,SCROLLEQ
         CLI   SCRREPLY+6,C'='     SCROLL FIND EQ
         BE    SCROLLF             YES
         CLI   SCRREPLY+6,C'-'     SCROLL UP
         BE    SCROLLU             YES
         CLI   SCRREPLY+6,C'+'     SCROLL DOWN
         BE    SCROLLD             YES
         BR    R7
         SPACE 1
SCROLLU  LA    R14,22(0,R14)       ADJUST TO TOP OF PAGE
         SPACE 1
SCROLLU1 C     R4,CMDOUTPT         TOP
         BE    SCREEN3B
         S     R4,=F'80'
         BCT   R14,SCROLLU1
         B     SCREEN3B
         SPACE 1
SCROLLD  CLI   0(R4),X'FF'         BOTTOM
         BE    SCROLLD1
         A     R4,=F'80'
         BCT   R14,SCROLLD
         SPACE 1
SCROLLD1 LA    R14,22
         SPACE 1
SCROLLD2 C     R4,CMDOUTPT         TOP
         BE    SCREEN3B
         S     R4,=F'80'
         BCT   R14,SCROLLD2
         B     SCREEN3B
         EJECT
SCROLLF  LA    R14,21
         SPACE 1
SCROLLF1 C     R4,CMDOUTPT         TOP
         BE    SCROLLF2
         S     R4,=F'80'
         BCT   R14,SCROLLF1
         SPACE 1
SCROLLF2 SR    R14,R14
         LA    R10,SCRREPLY+7
         LA    R9,55
         SPACE 1
SCROLLF3 BCT   R9,*+6
         BR    R7
         LA    R10,1(0,R10)        NEXT SEARCH BYTE
         LA    R14,1(0,R14)
         CLC   0(1,R10),SCRREPLY+7 DELIMITER FOUND
         BNE   SCROLLF3
         BCTR  R14,0
         BCTR  R14,0
         SPACE 1
SCROLLF4 CLI   0(R4),X'FF'         BOTTOM
         BNE   SCROLLF5
         S     R4,=F'80'
         B     SCREEN3B
         SPACE 1
SCROLLF5 LA    R8,0(0,R4)          BEGIN OF OUTPUT LINE
         LA    R9,80
         SPACE 1
SCROLLF6 EX    R14,SCROLLCL        COMPARE
         EX    0,0(0,R11)          BR ON CONDITION
         LA    R8,1(0,R8)
         BCT   R9,SCROLLF6         CHECK NEXT
         LA    R4,80(0,R4)
         B     SCROLLF4
         SPACE 1
SCROLLCL CLC   0(0,R8),SCRREPLY+8
SCROLLEQ BC    8,SCREEN3B
         EJECT
PFKCHK   LA    R2,PFKTAB
         SPACE 1
PFKCHK1  CLC   SCRREPLY(1),0(R2)   PFK MATCH
         BE    PFKCHK2
         CLI   0(R2),X'00'         END OF PFK TABLE
         BE    ATENTION            YES, I DONT KNOW
         LA    R2,4(0,R2)          NEXT ENTRY
         B     PFKCHK1
         SPACE 1
PFKCHK2  LA    R14,SCRREPLY+6
         CLI   0(R2),X'F1'         PFK 1
         BE    PFKCHK3             YES, CHANGE OR DISPLAY PFK
         L     R2,0(0,R2)          PFK DEFINITION
         MVC   SCRREPLY+6(57),9(R2)
         MVC   SCRLSREP(57),9(R2)
         BR    R7
         SPACE 1
PFKCHK3  CLI   SCRREPLY+6,C' '     DISPLAY PFK
         BNE   PFKCHK5             NO, CHANGE REQUEST
         SPACE 1
PFKCHK4  LR    R8,R7
         L     R4,CMDOUTPT
         LA    R5,1760
         L     R6,=A(PFKTEXT)
         LA    R7,1760
         MVCL  R4,R6               PFK LIST
         LR    R7,R8
         L     R4,CMDOUTPT
         B     SCREEN              DISPLAY PFK ASSIGNMENTS
         SPACE 1
PFKCHK5  MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),SCRREPLY+6
         CLC   DOUBLE(2),=C'00'    NUMERIC PFK
         BNE   PFKCHK4             NO, DISPLAY
         CLI   SCRREPLY+8,C'='     VALID FORMAT
         BNE   PFKCHK4             NO, DISPLAY
         PACK  DOUBLE(8),SCRREPLY+6(2)
         CVB   R4,DOUBLE
         CH    R4,=H'2'            MIN PFK NUMBER
         BL    PFKCHK4             NO, DISPLAY
         CH    R4,=H'24'           MAX PFK NUMBER               FNB001
         BH    PFKCHK4             NO, DISPLAY
         SLL   R4,2                MULT BY 4
         LA    R4,PFKTAB-4(R4)     TABLE SLOT ADDR
         L     R4,0(0,R4)          PFK DEFINITION ADDR
         MVC   9(50,R4),SCRREPLY+9 SAVE NEW PFK ASSIGNMENT
         B     PFKCHK4
         EJECT
ATENTION MVI   RETCODE,C'Z'        INDICATE ATTENTION
         MVI   SCRREPLY,X'00'
         BR    R7
         SPACE 3
REPEAT   LA    R14,SCRREPLY+6
         MVC   SCRREPLY+6(57),SCRLSREP   LAST COMMAND
         MVI   SCRREPLY,X'00'
         B     SCREEN3
         SPACE 3
EXECUTE  LA    R2,EXITLIST         PARM LIST
         L     R15,CMDOUTPT
         LA    R15,80(0,R15)
         ST    R15,EXITLIST+16
         L     R15,ENTRY           COMMAND ENTRY
         BALR  R14,R15             BRANCH
         SPACE 3
         BALR  R15,0
         USING *,R15
         L     R3,EXECSBMN         LOAD ORIGINAL BASE
         L     R13,EXECSAVE
         DELETE EPLOC=LOADNAME     DELETE MODULE
         B     CMDGET
         SPACE 1
EXECSBMN DC    A(CMDSBMON)
EXECSAVE DC    A(SAVE)
         DROP  R15
         SPACE 3
EXIT     CLOSE (TPDCB,,CMDLOG)
         FREE  UNALC,DDN=DDADR,ERROR=ABEND
         L     R0,SIZEGETM
         L     R1,GETMADR
         FREEMAIN R,LV=(0),A=(1)
         SPACE 1
TERMINAT SR    R0,R0
         LA    R1,VARYCONS
         CLI   UNITVCON,C' '       VARY CONSOLE TO BE DONE
         BE    *+6                 NO
         SVC   34
         L     R13,SAVE+4
         RETURN (14,12),RC=0
         SPACE 3
ABEND    ABEND 77,DUMP
         EJECT
         USING TPUT,R15
TPUT     ST    R14,8(0,R2)         SAVE RETURN ADDR
         ST    R13,CMDOUTSV        LOAD PREV REG13
         L     R13,CMDOUT13        LOAD R13 BASE REG
         ST    R4,12(0,R2)         SAVE WORK REG
         L     R4,16(0,R2)         LOAD OUTPUT ADDR
         LTR   R0,R0               NORMAL ENTRY
         BNZ   TPUT0               NO, QUEUE COMMAND
         C     R4,CMDOUTEN         END OF OUTPUT
         BE    TPUT4               YES
         MVI   0(R4),C' '
         MVC   1(79,R4),0(R4)
         LH    R14,0(0,R1)         ORIG MSG LENGTH
         SH    R14,=H'5'           NEW MSG LENGTH
         EX    R14,TPUTMVE         MSG TEXT ADDR
         LA    R4,80(0,R4)         ADD IN MSG LENGTH
         MVI   0(R4),X'FF'
         ST    R4,16(0,R2)         SAVE OUTPUT ADDR
         L     R14,8(0,R2)         LOAD RETURN ADDR
         L     R4,12(0,R2)         LOAD WORK REG
         L     R13,CMDOUTSV        LOAD PREV REG13
         BR    R14                 RETURN
         SPACE 1
TPUTMVE  MVC   0(0,R4),4(R1)
         SPACE 1
TPUT0    LR    R14,R0
         SPACE 1
TPUT1    L     R0,CMDOUTCT         LOAD CURRENT RECORD COUNT
         A     R0,=F'1'            ADD 1
         ST    R0,CMDOUTCT         SAVE NEW RECORD COUNT
         C     R0,CMDOUTBG         EQUAL TO 1ST REC TO PRINT
         BL    TPUT2               NOT YET
         MVC   0(80,R4),0(R1)
         LA    R4,80(0,R4)         ADD IN MSG LENGTH
         C     R4,CMDOUTEN         END OF OUTPUT
         BE    TPUT3               YES
         SPACE 1
TPUT2    LA    R1,80(0,R1)
         BCT   R14,TPUT1
         MVI   0(R4),X'FF'
         SPACE 1
TPUT3    ST    R4,16(0,R2)         SAVE OUTPUT ADDR
         SR    R0,R0
         C     R4,CMDOUTEN         END OF OUTPUT
         BL    *+8                 NO
         LA    R0,1                INDICATE END
         SPACE 1
TPUT4    L     R14,8(0,R2)         LOAD RETURN ADDR
         L     R4,12(0,R2)         LOAD WORK REG
         L     R13,CMDOUTSV        LOAD PREV REG13
         BR    R14                 RETURN
CMDOUTCT DC    F'0'                CURRENT COUNT
CMDOUTBG DC    F'0'                1ST RECORD TO PRINT
CMDOUTSV DC    F'0'                SAVE AREA REG13
CMDOUT13 DC    A(SAVE)             ADDR CMDSBMON SAVE AREA (2ND BASE)
         DROP  R15
         EJECT
         WRITE TPDECB,TS,TPDCB,SCRBEGIN,SCRLEN,,1,MF=L
         EJECT
SAVE     DS    18F
SCRSAVE  DS    12F
         DS    0D
VARYTIME DC    CL8'00000100'
DOUBLE   DS    2F
RETCODE  DC    F'0'
CMDOUTST DC    F'80000',F'8000000'
CMDOUTSZ DC    F'80000',F'7200000'
CMDOUTPT DC    F'0',F'0'
CMDOUTEN DC    F'0'
REFRESH  DC    CL8'00000000'
REFRCNT  DC    F'20'
LOADNAME DC    CL8' '
WAITTIME DS    2F
HEXTIME  DS    F
SIZEGETM DC    F'4096'
REFRSW   DS    F
PACK     DS    F
UNIT     DC    CL4' '
UNITADR  DC    A(UNIT)
UNITLEN  DC    H'3'                    AND LENGTH OF UNIT NAME
DDNAME   DC    CL8' '
DDADR    DC    A(DDNAME)
DDLEN    DC    H'8'                    AND LENGTH OF UNIT NAME
ENTRY    DS    F
LENGTH   DS    F
COMMAND  DC    F'0'
PARM     DC    CL80' '
CSCSYSID DC    F'0'
CSCCMD   DC    CL80' '
         DC    X'13'
LOGLINE  DC    X'09',CL80' '
         SPACE 3
VARYOFF  DC    X'00200000',C' V '
UNITVOFF DC    CL3' ',CL22',OFFLINE'
VARYON   DC    X'00200000',C' V '
UNITVON  DC    CL3' ',CL22',ONLINE'
VARYCONS DC    X'00200000',C' V '
UNITVCON DC    CL3' ',CL22',CONSOLE'
         SPACE 3
HEADER   DS    0CL68
         DC    C'---  <MON>  CMD SBSYS (#'
TCMDTYP  DC    C' '
TCOMMAND DC    C' ',C')  '
SYSTEM   DC    CL4' ',C'  '
YEAR     DC    CL2' ',C' '
DAY      DC    CL3' ',C'  '
HOUR     DC    CL2' ',C' '
MINUTE   DC    CL2' ',C'  '
USERID   DC    CL8' ',C' '
TASID    DC    CL4' ',C'  ---'
         SPACE 3
EXITLIST DC    A(TPUT)
ASID     DC    F'0'
         DC    9F'0'
GETMADR  DC    F'0'
         DC    A(SCRREPLY+8)
         EJECT
         LTORG
         EJECT
         DS    0D
TABLE    DC    64C' '
     DC    C'           .<(+|&&          $*);Â¬-/         '
     DC    C',%_>?          :#@''=" '
     DC    C'ABCDEFGHI',CL7' ',C'JKLMNOPQR',CL8' ',C'STUVWXYZ',CL23' '
     DC    C'ABCDEFGHI',CL7' ',C'JKLMNOPQR',CL8' ',C'STUVWXYZ',CL6' '
     DC    C'0123456789',CL6' '
         SPACE 3                                                 BFG-XA
TOHEX    DC    256X'00'                                          BFG-XA
         ORG   TOHEX+C'A'                                        BFG-XA
         DC    X'FAFBFCFDFEFF'                                   BFG-XA
         ORG   TOHEX+C'0'                                        BFG-XA
         DC    C'0123456789'                                     BFG-XA
         ORG   ,                                                 BFG-XA
         SPACE 3
         DS    0D
COMTAB   DC    193X'00'
*                 A B C D E F G H I
         DC    X'04000A030005000C09',XL7'00'
*                 J K L M N O P Q R
         DC    X'0B000200010F0D0E06',XL8'00'
*                 S T U V W X Y Z
         DC    X'0700000800030010',XL23'00'
         SPACE 3
MODLIST  DC    CL8' '
         DC    CL8'CSCSA03D'  1
         DC    CL8'CSCSC03D'  2
         DC    CL8'CSCSD03D'  3
         DC    CL8'CSCSE03D'  4
         DC    CL8'CSCSF03D'  5
         DC    CL8'CSCSG03D'  6
         DC    CL8'CSCSH03D'  7
         DC    CL8'CSCSI03D'  8
         DC    CL8'CSCSJ03D'  9
         DC    CL8'CSCSK03D'  A
         DC    CL8'CSCSL03D'  B
         DC    CL8'CSCSM03D'  C
         DC    CL8'CSCSP03D'  D
         DC    CL8'CSCSQ03D'  E
         DC    CL8'CSCSR03D'  F
         DC    CL8'CSCSZ03D' 10
         DC    CL8'        '
         DC    CL8'        '
         DC    CL8'        '
         EJECT
         DS    0D
COMTAB2  DC    193X'00'
*                 A B C D E F G H I
         DC    X'010203000000000000',XL7'00'
*                 J K L M N O P Q R
         DC    X'040000000000050000',XL8'00'
*                 S T U V W X Y Z
         DC    X'0600000000000000',XL23'00'
         SPACE 3
MODLIST2 DC    CL8'        '
         DC    CL8'CSCZA03D'  1
         DC    CL8'CSCZB03D'  2
         DC    CL8'CSCZC03D'  3
         DC    CL8'CSCZJ03D'  4
         DC    CL8'CSCZP03D'  5
         DC    CL8'CSCZS03D'  6
         DC    CL8'        '
         EJECT
         DS    0D
COMTAB3  DC    193X'00'
*                 A B C D E F G H I
         DC    X'010000000203000405',XL7'00'
*                 J K L M N O P Q R
         DC    X'060000000007000800',XL8'00'
*                 S T U V W X Y Z
         DC    X'09000A0000000000',XL23'00'
         SPACE 3
MODLIST3 DC    CL8'        '
         DC    CL8'CSCGA03D'  1
         DC    CL8'CSCGE03D'  2
         DC    CL8'CSCGF03D'  3
         DC    CL8'CSCGH03D'  4
         DC    CL8'CSCGI03D'  5
         DC    CL8'CSCGJ03D'  6
         DC    CL8'CSCGO03D'  7
         DC    CL8'CSCGQ03D'  8
         DC    CL8'CSCGS03D'  9
         DC    CL8'CSCGU03D'  A
         DC    CL8'        '
         EJECT
         DYNSPACE
         SPACE 3
CMDOUTOV DC    CL80' '
         DC    30C'-',CL20'  OUTPUT TRUNCATED  ',30C'-'
         DC    X'FF'
         SPACE 3
         DS    0D
CSCWAIT  DC    CL8'00000200'
RESETCNT DC    F'10'
PREVREC  DC    CL96' '
         SPACE 5
RECVMSG  DS    0CL44
         DC    CL44'CMD SUBSYS -   CSC #X COMMAND ACCEPTED'
         SPACE 3
TIMEMSG  DS    0CL48
         DC    CL43'CMD SUBSYS -   CSC TIMEOUT, CMD PENDING ON '
TIMESID  DC    CL4' ',C' '
         SPACE 5
PFKTAB   DC    X'F1',AL3(PFK01)
         DC    X'F2',AL3(PFK02)
         DC    X'F3',AL3(PFK03)
         DC    X'F4',AL3(PFK04)
         DC    X'F5',AL3(PFK05)
         DC    X'F6',AL3(PFK06)
         DC    X'F7',AL3(PFK07)
         DC    X'F8',AL3(PFK08)
         DC    X'F9',AL3(PFK09)
         DC    X'7A',AL3(PFK10)
         DC    X'7B',AL3(PFK11)
         DC    X'7C',AL3(PFK12)
         DC    X'C1',AL3(PFK13)                                 FNB001
         DC    X'C2',AL3(PFK14)                                 FNB001
         DC    X'C3',AL3(PFK15)                                 FNB001
         DC    X'C4',AL3(PFK16)                                 FNB001
         DC    X'C5',AL3(PFK17)                                 FNB001
         DC    X'C6',AL3(PFK18)                                 FNB001
         DC    X'C7',AL3(PFK19)                                 FNB001
         DC    X'C8',AL3(PFK20)                                 FNB001
         DC    X'C9',AL3(PFK21)                                 FNB001
         DC    X'4A',AL3(PFK22)                                 FNB001
         DC    X'4B',AL3(PFK23)                                 FNB001
         DC    X'4C',AL3(PFK24)                                 FNB001
         DC    X'00'
         EJECT
CSCDATA  DCB   DDNAME=CSCDATA,DSORG=PS,RECFM=U,BLKSIZE=19069,          X
               MACRF=(GM,PM)
         EJECT
TPDCB    DCB   DDNAME=TERMINAL,DSORG=CX,MACRF=(R,W),EROPT=T
CMDLOG   DCB   DDNAME=CMDLOG,DSORG=PS,MACRF=(PM),RECFM=FBM,LRECL=81,   X
               BLKSIZE=4050
         EJECT
SCRREPLY DC    CL63' ',CL17' '
SCRBEGIN DS    0D
SCRLIN01 DC    X'C31140403C404000'
         DC    C'CMD SUBSYSTEM -'
         DC    X'1DC8'
SCRLSREP DC    CL63' '
         DC    X'1DF0'
SCRLIN02 DC    CL80' '
SCRLIN03 DC    CL80' '
SCRLIN04 DC    CL80' '
SCRLIN05 DC    CL80' '
SCRLIN06 DC    CL80' '
SCRLIN07 DC    CL80' '
SCRLIN08 DC    CL80' '
SCRLIN09 DC    CL80' '
SCRLIN10 DC    CL80' '
SCRLIN11 DC    CL80' '
SCRLIN12 DC    CL80' '
SCRLIN13 DC    CL80' '
SCRLIN14 DC    CL80' '
SCRLIN15 DC    CL80' '
SCRLIN16 DC    CL80' '
SCRLIN17 DC    CL80' '
SCRLIN18 DC    CL80' '
SCRLIN19 DC    CL80' '
SCRLIN20 DC    CL80' '
SCRLIN21 DC    CL80' '
SCRLIN22 DC    CL80' '
SCRLIN23 DC    CL80' '
SCRLIN24 DC    C'REPLY -'
         DC    X'1DC8115DF71DF0'
SCRPLUS  DC    C' '
         DC    X'115CF813'
SCRLEN   EQU   *-SCRBEGIN
         EJECT
OPENTEXT DC    CL80'#####   CMD  SUB-SYSTEM  MONITOR   #####'
 DC CL80' '
 DC CL80' '
 DC CL80'--->  ENTER  # CMDS,  ## CMDS,  OR  GRAPHIC MONITOR CMDS'
 DC CL80'             BEGINNING WHERE CURSOR IS POSITIONED'
 DC CL80' '
 DC CL80' '
 DC CL80'--->  ENTER  NN/XX  TO CHANGE MONITOR REFRESH INTERVAL'
 DC CL80' '
 DC CL80'             WHERE  NN  =   NUMBER OF SECONDS'
 DC CL80'                    XX  =   NUMBER OF INTERVALS'
 DC CL80' '
 DC CL80' '
 DC CL80'--->  ENTER  ''Z''  OR  ''END''   TO TERMINATE'
 DC CL80' '
 DC CL80' '
 DC CL80'--->  PRESS  PA1 TO STOP AUTOMATIC REFRESH'
 DC CL80'--->  PRESS  PA2 OR CLEAR TO REPEAT THE LAST COMMAND'
 DC CL80'--->  PRESS  PFK 1  TO DISPLAY PFK ASSIGNMENTS'
 DC CL80' '
 DC CL80' '
 DC CL80'--->  ENTER  ''H''  TO OBTAIN HELP FOR GRAPHIC MONITOR CMDS'
         SPACE 5
PFKTEXT  DC    CL80'#####        PFK  ASSIGNMENTS        #####'
 DC CL80' '
 DC CL80' '
PFK01    DC    CL80'PFK1 =   DISPLAY PFK ASSIGNMENTS'
PFK02    DC    CL80'PFK2 =   H'
PFK03    DC    CL80'PFK3 =   E'
PFK04    DC    CL80'PFK4 =   F'
PFK05    DC    CL80'PFK5 =   J'
PFK06    DC    CL80'PFK6 =   S'
PFK07    DC    CL80'PFK7 =   #J'
PFK08    DC    CL80'PFK8 =   #O'
PFK09    DC    CL80'PFK9 =   #OX'
PFK10    DC    CL80'PFK10 =  #Q'
PFK11    DC    CL80'PFK11 =  ##SD'
PFK12    DC    CL80'PFK12 =  05/50'
PFK13    DC    CL80'PFK13 =  ##A,T=5'                           FNB001
PFK14    DC    CL80'PFK14 =  H'                                 FNB001
PFK15    DC    CL80'PFK15 =  E'                                 FNB001
PFK16    DC    CL80'PFK16 =  F'                                 FNB001
PFK17    DC    CL80'PFK17 =  J'                                 FNB001
PFK18    DC    CL80'PFK18 =  S'                                 FNB001
PFK19    DC    CL80'PFK19 =  #J'                                FNB001
PFK20    DC    CL80'PFK20 =  #O'                                FNB001
PFK21    DC    CL80'PFK21 =  #OX'                               FNB001
PFK22    DC    CL80'PFK22 =  #Q'                                FNB001
PFK23    DC    CL80'PFK23 =  ##SD'                              FNB001
PFK24    DC    CL80'PFK24 =  05/50'                             FNB001
 DC CL80' '
 DC CL80' '
 DC CL80' '
 DC CL80'--->  ENTER  NN=XXXX  AND PRESS PFK 1  TO CHANGE PFK FUNCTION'
 DC CL80' '
 DC CL80'             WHERE  NN -   IS THE PFK NUMBER  02 - 12'
 DC CL80'                    XXXX - IS THE COMMAND TO BE ASSIGNED'
         SPACE 5
RECORD   DS    CL19069
         EJECT
         CVT   DSECT=YES
         EJECT
         IECDIOCM
         EJECT
         IEFZB4D0
         EJECT
         IEFZB4D2
         EJECT
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CMDSBSYS
         TITLE 'CMDSBSYS -   COMMAND PROCESSOR MODULE'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CMDSBSYS -       COMMAND PROCESSOR MODULE                 ***
***                                                                 ***
***       VERSION -        1.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***                                                                 ***
***       UPDATED -        09/01/79                                 ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
         EJECT
CMDSBSYS CSECT
         SPACE 1
         DC    A(CMDENTRY-CMDSBSYS)
         SPACE 1
CMDENTRY EQU   *
         SAVE  (14,12)
         LR    R12,R15
         USING CMDENTRY,R12
         LR    R2,R0               LOAD SSCVT ADDR
         L     R10,16(0,R2)        LOAD SSVT ADDR
         LR    R11,R1              LOAD SSOB ADDR
         XC    12(4,R11),12(R11)   CLEAR RETURN CODE
         LA    R3,0(0,R10)         LOAD SSVT ADDR
         USING AREA,R3
         L     R10,16(0,R11)       LOAD FUNCTION DEPENDENT AREA ADDR
         SR    R4,R4               CLEAR UCMID HOLDER
         IC    R4,11(0,R10)        SAVE UCMID OF ISSUING CONSOLE
         L     R10,4(0,R10)        LOAD CMD BUFFER ADDR
         LH    R9,0(0,R10)         LOAD COMMAND LENGTH
         SH    R9,=H'4'            SUB 4 FOR HDR PORTION
         LA    R10,4(0,R10)        TEXT ADDR
         CLI   0(R10),C'D'         DISPLAY COMMAND
*        BE    CMDCHK              YES, CHECK FOR  D DUMP CMD
         CLI   0(R10),C'#'         OUR COMMAND
         BNE   CMDOUT              NO, LET MVS OR JES2 HANDLE
         XC    SSVTTIME(4),SSVTTIME
         CLC   0(2,R10),=C'##'     MONITOR COMMAND
         BNE   *+10                NO
         MVC   SSVTTIME(4),=F'30'  INDICATE MONITOR COMMAND REQUEST
         CLC   SAVE+4(4),=F'0'     CMDSBSYS ALREADY ACTIVE
         BNE   CMDACTIV            YES, REJECT COMMAND
         ST    R13,SAVE+4          SAVE AREA
         LA    R13,SAVE               CONVENTIONS
         STC   R4,XAU              SAVE UCM ID OF ISSUING CONSOLE
         SR    R1,R1               LOAD
         IC    R1,XAU                 INPUT CONSOLE UCM ID
         CVD   R1,DOUBLE           CONVERT AND PRINT
         UNPK  INCONS(2),DOUBLE+6(2)
         OI    INCONS+1,X'F0'
*        CH    R9,=H'80'           SELF-IMPOSED MAX LENGTH
*        BH    CMDERROR            TOO HIGH, ERROR
         CH    R9,=H'2'            SELF-IMPOSED MIN LENGTH
         BL    CMDERROR            TOO LOW, ERROR
         LA    R8,CMDTABLE         COMMAND TABLE ADDR
         LA    R10,1(0,R10)        NEXT BYTE
         BCTR  R9,0                SUB 1 FROM LENGTH
         CLI   0(R10),C' '         BLANK OR COMMAND
         BNE   CMD1                COMMAND
         LA    R10,1(0,R10)        BLANK, NEXT BYTE
         BCT   R9,CMD1                MUST BE COMMAND
         B     CMDERROR            NOT COMMAND, ERROR
         EJECT
CMD1     CLI   0(R10),C'#'         SUBSYS MONITOR REQUEST
         BE    CMD2                YES, CONTINUE
         CLC   0(2,R10),=C'**'     SUBSYS CSC STOP REQUEST
         BE    CMD2                YES, CONTINUE
         CLI   0(R8),X'00'         TABLE END
         BE    CMDNOSUP            YES, COMMAND NOT SUPPORTED
         CLC   0(1,R8),0(R10)      COMMAND MATCH
         BE    CMD2                YES, CONTINUE
         LA    R8,4(0,R8)          NEXT ENTRY
         B     CMD1
         SPACE 1
CMD2     MVI   COMMAND,C' '        CLEAR COMMAND
         MVC   COMMAND+1(79),COMMAND
         SPACE 1
CMD3     CLI   0(R10),C'#'         SUBSYS MONITOR REQUEST
         BE    CMD4                YES, CONTINUE
         CLC   0(2,R10),=C'**'     SUBSYS CSC STOP REQUEST
         BE    CMD4                YES, CONTINUE
         LA    R10,1(0,R10)        NEXT BYTE
         BCT   R9,CMD4             SUB 1 FROM LENGTH
         XC    XAL,XAL             CLEAR SUB-PARM ADDR
         B     CMDISSUE            GO PROCESS COMMAND
         SPACE 1
CMD4     CLI   0(R10),C' '         BLANK
         BE    CMD3                YES, CHECK NEXT
         LA    R1,COMMAND          LOAD COMMAND AREA ADDR
         ST    R1,XAL              SAVE SUB-PARM ADDR
         LR    R6,R10              SAVE SUB-PARM START
         LA    R10,0(R9,R10)       POINT TO
         BCTR  R10,0                  LAST BYTE
         EJECT
CMD5     CR    R6,R10              CHECK FOR NON-BLANKS BACK TO START
         BNL   CMDMOVE             GO MOVE IF ALREADY THERE
         CLI   0(R10),C' '         BLANK
         BNE   CMDMOVE             NO, GO MOVE SUB-PARM
         BCT   R10,CMD5            CHECK NEXT PREVIOUS BYTE
         B     CMDERROR            THIS CANNOT HAPPEN -   I THINK
         SPACE 3
CMDMOVE  LR    R1,R10              BACK UP 4 BYTES
         SH    R1,=H'4'
         SR    R10,R6              CALCULATE MOVE LENGTH
         MVC   SYSID(4),3(R1)      SAVE RECEIVING SYSID
         CLC   0(3,R1),=C',L='     DIRECTED OUTPUT
         BNE   CMDMOVEX            NO, CONTINUE
         TM    3(R1),X'F0'         NUMERIC
         BNO   CMDERROR               CONSOLE
         TM    4(R1),X'F0'               I.D.
         BNO   CMDERROR                     CHECK
         PACK  DOUBLE(8),3(2,R1)   CONVERT
         CVB   R14,DOUBLE             SAVE AND
         BAL   R7,CONSCHK                VALIDATE
         STC   R14,XAU                      NEW UCMID
         LR    R10,R1              POINT TO COMMA
         BCTR  R10,0               BACK UP 1
         SR    R10,R6              CALCULATE MOVE LENGTH
         BNM   CMDMOVEX            GO MOVE IF NOT NEGATIVE
         XC    XAL,XAL             CLEAR SUB-PARM ADDR
         B     CMDISSUE            GO PROCESS COMMAND
         SPACE 3
CMDMOVEX EX    R10,CMDMEXEC        MOVE SUB-PARM
         B     CMDISSUE            GO PROCESS COMMAND
         SPACE 3
CMDMEXEC MVC   COMMAND(0),0(R6)
         EJECT
CSCSYS   LA    R1,COMMAND-1        COMMAND BEGIN -1
         LA    R14,COMMAND+76      COMMAND END
         CLC   COMMAND(2),=C'**'   CSC STOP REQUEST
         BNE   *+12                NO
         MVI   CSCCMD,C'*'         SET CSC STOPPED
         B     CSCSYS4
         SPACE 1
CSCSYS1  CLC   0(3,R14),=C',S='    SYSID PARM
         BE    CSCSYS2             YES
         BCTR  R14,0
         CR    R1,R14              SYSID PARM MISSING
         BNE   CSCSYS1             NO
         BR    R7
         SPACE 1
CSCSYS2  CLI   CSCCMD,C'*'         IS CSC STOPPED
         BE    CSCSYS3             YES
         MVC   SYSID(4),3(R14)     SET UP RECEIVING SYSID
         CLC   SSVTTIME(4),=F'0'   MONITOR COMMAND
         BNE   CMDNOSUP            YES, NOT ALLOWED
         MVI   SSVTTIME,C'C'
         BR    R7
         SPACE 1
CSCSYS3  LA    R1,CSCNACT          CSC NOT ACTIVE MSG
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         B     CMDMSG
         SPACE 1
CSCSYS4  LA    R1,CSCSTOP          CSC NOT ACTIVE MSG
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         B     CMDMSG
         EJECT
CONSCHK  L     R15,16              CVT
         L     R15,100(0,R15)      UCM BASE
         L     R9,72(0,R15)        UCM 1ST ENTRY ADDR
         LM    R4,R5,76(R15)       UCM ENTRY LENGTH AND LAST ENTRY ADDR
         SPACE 3
CONSCHK1 CLM   R14,1,26(R9)        UCM ID MATCH
         BNE   CONSCHK2            NO, CHECK NEXT
         TM    25(R9),X'10'        IS CONSOLE ACTIVE
         BNO   CONSCHK3            NO, ERROR
         BR    R7                  YES,BACK TO NORMAL
         SPACE 3
CONSCHK2 BXLE  R9,R4,CONSCHK1      NEXT UCM ENTRY
         SPACE 3
CONSCHK3 LA    R1,UCMMSG           UCM ID ERROR MSG
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         B     CMDMSG
         EJECT
CMDISSUE MVC   WTOLIST(52),WTOOVLY
         BAL   R7,CSCSYS           CHECK FOR S=
         MVC   UCMID(2),INCONS     UCM ID OF INPUT CONSOLE
         MVC   CMDID(1),0(R8)      COMMAND ID FROM TABLE
         L     R1,16               CVT
         L     R1,196(0,R1)        SMCA
         CLI   SSVTTIME,C'C'       CROSS-SYSTEM COMMAND
         BE    *+10                YES
         MVC   SYSID(4),16(R1)     SYSTEM ID
         TIME  DEC
         ST    R1,DOUBLE
         UNPK  YEAR(3),DOUBLE+1(2)
         MVI   YEAR+2,C'.'
         UNPK  DAY(3),DOUBLE+2(2)
         OI    DAY+2,X'F0'
         ST    R0,DOUBLE
         UNPK  HOUR(3),DOUBLE(2)
         MVI   HOUR+2,C'.'
         UNPK  MINUTE(3),DOUBLE+1(2)
         MVI   MINUTE+2,C' '
         CLC   SSVTTIME(4),=F'30'  SUBSYS MONITOR REQUEST
         BE    CMDMON              YES, CONTINUE
         CLI   SSVTTIME,C'C'       CROSS-SYSTEM COMMAND
         BE    CMDMON              YES
         LA    R1,WTOLIST
         SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         SVC   35                  WTO
         MVC   XAS(1),SYSID
         MVC   XAS+1(1),DAY
         MVC   XAS+2(1),HOUR
         MVC   XAS+3(1),DAY+1
         MVC   XAS+4(1),HOUR+1
         MVC   XAS+5(1),DAY+2
         MVC   XAS+6(2),MINUTE
         EJECT
CMDBRNCH SR    R15,R15             LOAD COMMAND
         ICM   R15,7,1(R8)            MODULE ADDR
         LTR   R15,R15             ZERO MODULE ADDR
         BZ    CMDNOSUP            YES, NOT SUPPORTED
         LA    R2,XSA              XSA ADDR
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         LA    R14,CMDRETN         LOAD RETURN ADDR
         BR    R15                 EXIT TO COMMAND MODULE
         SPACE 3
CSC      MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         CLI   CSCCMD,X'00'        AVAILABLE
         BE    CSC1                YES
         LA    R1,CSCMSG
         B     CMDMSG
         SPACE 1
CSC1     MVC   HDRMSG+20(1),0(R8)  COMMAND ID
         MVC   CSCHDR(52),HDRMSG
         MVC   CSCCMD+1(77),COMMAND SUB PARM
         MVC   CSCCMD(1),0(R8)     COMMAND
         B     CMDEXIT
         EJECT
CMDMON   LA    R14,COMMAND+1
         CLI   0(R14),C' '         1 BLANK ALLOWED
         BNE   CMDMON0             YES
         LA    R14,1(0,R14)
         SPACE 1
CMDMON0  MVC   CMD##(78),0(R14)    SAVE MONITOR COMMAND
         MVC   HDRMSG(52),WTOLIST
         MVI   HDRMSG+19,C'#'
         CLI   SSVTTIME,C'C'       CROSS-SYSTEM COMMAND
         BNE   *+8                 NO
         MVI   HDRMSG+19,C'*'      YES, SO INDICATE
         MVC   HDRMSG+20(1),CMD##
         MVI   HDRMSG+21,C')'
         CLI   SSVTTIME,C'C'       CROSS-SYSTEM COMMAND
         BE    CSC                 YES
         CLI   SSVTSTAT,X'F0'      XMPOST ERROR
         BE    CMDMON3A            YES
         CLI   SSVTSTAT,X'FF'      MONITOR BUSY
         BE    CMDMON3             YES
         MVI   SSVTSTAT,X'FF'      SET MONITOR BUSY
         MVC   SSVTUMID+3(1),XAU   SAVE UCM ID
         SPACE 1
CMDMON1  LA    R4,SSVTECB          ECB TO POST
         L     R5,SSVTASCB         ASCB ADDR
         LA    R5,0(0,R5)
         STM   R14,R12,SAVE+12
         POST  (4),ASCB=(5),ERRET=CMDMON4
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         B     CMDEXIT
         SPACE 1
CMDMON3  LA    R1,MONAMSG          MONITOR BUSY MSG
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         B     CMDMSG
         SPACE 1
CMDMON3A LA    R1,POSTMSG          XMPOST ERROR MSG
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         B     CMDMSG
         EJECT
         USING *,R15
CMDMON4  BALR  R15,0
         LA    R15,0(0,R15)
         BCTR  R15,0
         BCTR  R15,0
         STM   R0,R14,POSTSAVE
         L     R5,16               CVT
         L     R5,296(0,R5)        JESCT
         L     R5,24(0,R5)         1ST SSCVT ADDR
         SPACE 1
CMDMON4A CLC   8(3,R5),=CL3'CMD'   NAME MATCH
         BE    CMDMON4B            YES, CONTINUE
         L     R5,4(0,R5)          NEXT SSCVT
         LTR   R5,R5               ZERO SSCVT
         BNZ   CMDMON4A            NO, CONTINUE
         B     CMDMON4C
         SPACE 3
         USING AREA,R3
         DROP  R15
CMDMON4B L     R3,16(0,R5)         SSVT ADDR
         LA    R13,SAVE
         LM    R14,R12,SAVE+12
         MVI   SSVTSTAT,X'F0'      SET POST ERROR IND
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         SPACE 1
CMDMON4C LM    R0,R14,POSTSAVE
         SR    R15,R15
         BR    R14
         EJECT
CMDERROR LA    R1,ERRMSG           ERROR
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         B     CMDMSG
         SPACE 3
CMDNOSUP LA    R1,SUPPMSG          NOT SUPPORTED
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         SPACE
CMDMSG   SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         SVC   35                  WTO
         SPACE 3
CMDEXIT  L     R13,4(0,R13)        LOAD PREVIOUS SAVE AREA ADDR
         XC    SAVE+4(4),SAVE+4    CLEAR PREVIOUS SAVE AREA ADDR
CMDOUT   RETURN (14,12),RC=0
         EJECT
CMDCHK   LA    R1,70
         SPACE 1
CMDCHK1  LA    R10,1(0,R10)
         CLI   0(R10),C' '         COMMAND END
         BE    CMDCHK2             YES
         BCT   R1,CMDCHK1
         B     CMDOUT
         SPACE 1
CMDCHK2  LA    R10,1(0,R10)
         CLI   0(R10),C' '         SUB PARM REACHED
         BNE   CMDCHK3             YES
         BCT   R1,CMDCHK2
         B     CMDOUT
         SPACE 1
CMDCHK3  CLC   0(2,R10),=C'D '     D DUMP COMMAND
         BE    CMDCHK4             YES
         CLC   0(2,R10),=C'D,'     D DUMP COMMAND
         BE    CMDCHK4             YES
         CLC   0(4,R10),=C'DUMP'   D DUMP COMMAND
         BNE   CMDOUT              NO
         SPACE 1
CMDCHK4  MVI   15(R11),X'04'       INDICATE MSG PROCESSED
         LA    R1,DDUMPMSG         LOAD DISPLAY DUMP MSG ADDR
         LR    R0,R4               LOAD UCMID
         SVC   35
         LA    R1,DDUMPCMD         S CHKDUMP COMMAND
         SR    R0,R0
         SVC   34
         RETURN (14,12),RC=0
         SPACE 3
CMDACTIV LA    R1,ACTVMSG          CMDSBSYS ACTIVE MSG
         MVI   15(R11),X'04'       INDICATE CMD SUBSYS PROCESSED
         LR    R0,R4               LOAD UCMID
         SVC   35
         RETURN (14,12),RC=0
         EJECT
         USING CMDRETN,R14
CMDRETN  L     R1,CMDBASE          LOAD RELATIVE OFFSET
         LA    R12,0(0,R14)        LOAD
         SR    R12,R1                 MODULE BASE ADDR
         B     CMDRETN1
         DROP  R14
         SPACE 3
         DS    0F
CMDBASE  DC    A(CMDRETN-CMDENTRY)
         SPACE 3
         USING CMDENTRY,R12
CMDRETN1 L     R1,16               CVT
         L     R1,296(0,R1)        JESCT
         L     R1,24(0,R1)         1ST SSCVT
         SPACE 3
CMDRETN2 CLC   8(3,R1),=C'CMD'     CMD SUB-SYSTEM SSCVT ENTRY
         BE    CMDRETN3            YES, CONTINUE
         L     R1,4(0,R1)          NEXT SSCVT
         B     CMDRETN2
         SPACE 3
CMDRETN3 L     R1,16(0,R1)         LOAD SSVT ADDR
         LA    R3,0(0,R1)          LOAD WORK AREA ADDR
         LA    R13,SAVE            LOAD SAVE AREA ADDR
         B     CMDEXIT
         EJECT
         LTORG
         SPACE 5
POSTSAVE DC    15F'0'
         SPACE 2
         DS    0F
SIZE     DC    X'F1',AL3(AREAEND-AREA)
         SPACE 2
         DS    0F
WTOOVLY  DS    0CL52
         DC    X'00340100'
         DC    CL4'--  ',CL8'CMDSBSYS',CL3' (#'
         DC    CL4' )  ',CL6'L=    ',CL4' ',CL8' ',CL7' ',CL4'  --'
         SPACE 2
MSGOVLY  DS    0CL52
         DC    X'00340100'
         DC    CL4'--  ',CL12'MSGSBSYS -',CL6' ',CL2' '
         DC    CL20'OUTSTANDING MESSAGES',CL4'  --'
         EJECT
ERRMSG   DS    0CL44
         DC    X'002C0100'
         DC    CL40'CMD SUBSYS -   COMMAND PARAMETER ERROR'
         SPACE 2
SUPPMSG  DS    0CL40
         DC    X'00280100'
         DC    CL36'CMD SUBSYS -   COMMAND NOT SUPPORTED'
         SPACE 2
UCMMSG   DS    0CL40
         DC    X'00280100'
         DC    CL36'CMD SUBSYS -   CONSOLE NOT ACTIVE'
         SPACE 2
ACTVMSG  DS    0CL48
         DC    X'00300100'
         DC    CL44'CMD SUBSYS -   COMMAND REJECTED, SUBSYS BUSY'
         SPACE 2
MONAMSG  DS    0CL52
         DC    X'00340100'
         DC    CL48'CMD SUBSYS -   COMMAND REJECTED, MONITOR BUSY'
         SPACE 2
CSCMSG   DS    0CL48
         DC    X'00300100'
         DC    CL44'CMD SUBSYS -   COMMAND REJECTED, CSC BUSY'
         SPACE 2
CSCSTOP  DS    0CL32
         DC    X'00200100'
         DC    CL28'CMD SUBSYS -   CSC STOPPED'
         SPACE 2
CSCNACT  DS    0CL52
         DC    X'00340100'
         DC    CL48'CMD SUBSYS -   COMMAND REJECTED, CSC NOT ACTIVE'
         SPACE 2
POSTMSG  DS    0CL52
         DC    X'00340100'
         DC    CL48'CMD SUBSYS -   XMPOST ERROR -  RESTART SUBSYS'
         SPACE 2
DDUMPMSG DS    0CL48
         DC    X'00300100'
         DC    CL44'CMD SUBSYS -   S CHKDUMP ISSUED FOR  D DUMP'
         SPACE 2
         DS    0F
DDUMPCMD DS    0CL16
         DC    X'00100000'
         DC    CL16' S CHKDUMP  '
         EJECT
AREA     DSECT
SSVT     DS    H
SSVTFNUM DS    H
SSVTFCOD DS    XL256
SSVTFRTN DS    0F
SSVTFUNC DS    0F
SSVTFUN1 DS    F
         DS    8F
SSVTMSGT DS    F
SSVTLIST DS    2F
SSVTECB  DS    F
         DS    0D
SSVTWAIT DS    CL8
SSVTTIME DS    F
SSVTASCB DS    0F
SSVTSTAT DS    X
         DS    XL3
SSVTUMID DS    F
         SPACE 3
CMDTABLE DS    20F
CMDEND   DS    F
         EJECT
         DS    0D
USERWORK DS    0CL228
DOUBLE   DS    D
SAVE     DS    18F
COMMAND  DS    CL80
INCONS   DS    CL2
         SPACE 2
         DS    0F
WTOLIST  DS    0CL52
         DS    CL19
CMDID    DS    C
         DS    CL5
UCMID    DS    CL2
         DS    CL2
SYSID    DS    CL4
         DS    CL2
YEAR     DS    CL2
         DS    C
DAY      DS    CL3
         DS    CL2
HOUR     DS    CL2
         DS    C
MINUTE   DS    CL2
         DS    CL4
PADDING  DS    CL12
         SPACE 2
XSA      DS    0CL48
         DS    5F
XAL      DS    F
XAT      DS    F
         DS    F
XAS      DS    2F
XAU      DS    X
         DS    XL7
         SPACE 2
CMD##    DS    CL78
HDRMSG   DS    CL52
DISBL    DS    CL48
         DS    0F
CSCHDR   DS    CL52
CSCCMD   DS    CL78
CSCSTABL DS    CL48
         SPACE 2
AREAEND  DS    0D
         EJECT
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CMDSBTSO
         PRINT NOGEN                                               @TEC
         TITLE 'CMDSBTSO -   TSO FULL SCREEN MONITOR'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CMDSBTSO -       TSO FULL SCREEN MONITOR                  ***
***                                                                 ***
***       VERSION -        2.4                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        12/15/79                                 ***
***                                                                 ***
***       UPDATED -        09/29/81    TO PROVIDE 3278/79 SUPPORT   ***
***                                    AND TO PROVIDE FOR 24 PFKS   ***
***                                                                 ***
***       UPDATED -        09/16/91    REMOVE REFERENCE TO THE Q    ***
***                                    GRAPHIC MONITOR COMMAND      ***
***                                                                 ***
***  THIS MODULE SEARCHES THE CODE IT IS LOADING (#Q, #N, ETC.) TO  ***
***  SEE IF SUBPOOL 241 IS BEING REQUESTED FOR THE GETMAIN.  THIS   ***
***  MODULE DOES THIS BY SEARCHING FOR X'F100' IN THE CODE.  IF THE ***
***  EXECUTION IS TAKING PLACE VIA THE SYSTEM CONSOLE, THEN SUBPOOL ***
***  241 IS ALLOWED.  IF THE EXECUTION IS TAKING PLACE WITHIN TSO,  ***
***  THEN THE X'F100' IS CHANGED TO X'0000' (FOR SUBPOOL 0) PRIOR TO***
***  THE ACTUAL EXECUTION OF THE CODE.  IF THE PROPER CODING        ***
***  CONVENTIONS ARE NOT FOLLOWED IN THE SUB-MODULES (#Q, #N, ETC.),***
***  THIS CHECK MAY NOT BE SUCCESS- FUL, AND AN ABEND B0A WILL TAKE ***
***  PLACE.
***********************************************************************
***********************************************************************
         EJECT
CMDSBTSO CSECT
         SAVE  (14,12)
         LR    R3,R15
         USING CMDSBTSO,R3
         ST    R13,SAVE+4
         LA    R13,SAVE
         USING SAVE,R13
         ST    R1,DIRCPPL          SAVE CPPL ADDR IF APPLICABLE
         XC    GETMADR(4),GETMADR
         SPACE 1
CMDINIT  STATTN  LINES=0,TENS=0,INPUT=ATTNCHAR
         STAX  ATENTION,REPLACE=YES,DEFER=NO
         L     R0,SIZEGETM         GETMAIN SIZE
         L     R1,GETMADR          GETMAIN ADDR
         LTR   R1,R1               GETMAIN ALREADY DONE
         BNZ   CMDINIT1            YES
         GETMAIN R,LV=(0)          GET COMMAND WORK AREA
         LA    R1,0(0,R1)
         ST    R1,GETMADR          SAVE GETMAIN ADDR
         SPACE 1
CMDINIT1 LR    R4,R1
         L     R5,SIZEGETM
         LA    R5,0(0,R5)
         SR    R6,R6
         SR    R7,R7
         MVCL  R4,R6               CLEAR GETMAIN AREA
         MVI   RETCODE,X'00'
         L     R4,=A(CMDOUTPT)
         LA    R5,1760
         L     R6,=A(OPENTEXT)
         LA    R7,1760
         MVCL  R4,R6               MOVE OPENING TEXT TO OUTPUT
         L     R4,=A(CMDOUTPT)
         MVI   REFRSW,X'00'
         MVC   REFRESH(8),=CL8'00000000'
         EJECT
CMDGET   CLC   REFRESH(8),=CL8'00000000'  AUTO REFRESH
         BE    CMDGET1             NO
         L     R4,=A(CMDOUTPT)     OUTPUT ADDR
         BAL   R7,SCREEN           WRITE SCREEN AND GET NEXT COMMAND
         CLI   RETCODE,C'Z'        ATTENTION
         BE    CMDINIT             YES
         STIMER  WAIT,DINTVL=REFRESH
         L     R1,REFRCNT
         BCT   R1,*+8              BRANCH UNTIL END OF AUTO REFRESH
         B     CMDINIT
         ST    R1,REFRCNT
         MVC   SCRREPLY+6(57),SCRLSREP
         LA    R14,SCRREPLY+6
         B     CMDGET2
         SPACE 1
CMDGET1  L     R4,=A(CMDOUTPT)     OUTPUT ADDR
         BAL   R7,SCREEN           WRITE SCREEN AND GET NEXT COMMAND
         CLI   RETCODE,C'Z'        ATTENTION
         BE    CMDINIT             YES
         SPACE 1
CMDGET2  L     R4,=A(CMDOUTPT)
         XC    CMDOUTBG(4),CMDOUTBG
         XC    CMDOUTCT(4),CMDOUTCT
         CLI   0(R14),C'('         OUTPUT INCREMENT
         BNE   CMDGET2A            NO
         CLI   4(R14),C')'         OUTPUT INCREMENT
         BNE   CMDGET2A            NO
         MVC   DOUBLE(3),=C'000'
         MVZ   DOUBLE(3),1(R14)
         CLC   DOUBLE(3),=C'000'   NUMERIC
         BNE   CMDGET2A            NO, ERROR
         PACK  DOUBLE(8),1(3,R14)
         LR    R1,R14              SAVE REG14
         SR    R14,R14
         CVB   R15,DOUBLE
         M     R14,=F'1000'
         ST    R15,CMDOUTBG
         LR    R14,R1              POINT TO COMMAND
         MVC   0(58,R14),5(R14)    SHIFT OVER COMMAND
         SPACE 1
CMDGET2A LA    R10,COMTAB          # COMMAND TABLE
         LA    R11,MODLIST         # COMMAND MODULE LIST
         MVI   TCMDTYP,C' '
         CLI   0(R14),C'@'         EXEC PROGRAM
         BE    DIREXEC             YES, GO HANDLE
         CLI   0(R14),C'.'         EXEC CP
         BE    DIREXEC             YES, GO HANDLE
         CLI   0(R14),C'#'         # COMMAND
         BNE   PLOOPA              NO, CHECK CONTROL COMMANDS
         LA    R14,1(0,R14)        ADJUST INPUT PARM
         CLI   0(R14),C'#'         ## COMMAND
         BNE   PLOOPC              NO
         LA    R14,1(0,R14)        ADJUST INPUT PARM
         BCTR  R1,0                ADJUST LENGTH
         LA    R10,COMTAB2         ## COMMAND TABLE
         LA    R11,MODLIST2        ## COMMAND MODULE LIST
         MVI   TCMDTYP,C'#'        INDICATE ##
         B     PLOOPC
         EJECT
PLOOPA   LA    R10,COMTAB3         GRAPHIC MONITOR COMMAND TABLE
         LA    R11,MODLIST3        GRAPHIC MONITOR MODULE LIST
         MVI   TCMDTYP,C'-'        INDICATE GRAPHIC MONITOR
         TM    0(R14),X'F0'        CHANGE REFRESH TIME COMMAND
         BNO   PLOOPC              NO, GRAPHIC MONITOR COMMAND
         TM    1(R14),X'F0'        CHANGE REFRESH TIME COMMAND
         BNO   PLOOPB              NO, ERROR
         MVC   REFRESH+4(2),0(R14)
         LA    R1,20               DEFAULT REFRESH COUNT
         CLI   2(R14),C'/'
         BNE   PLOOPA1
         TM    3(R14),X'F0'        CHANGE REFRESH TIME COMMAND
         BNO   PLOOPB              NO, ERROR
         TM    4(R14),X'F0'        CHANGE REFRESH TIME COMMAND
         BNO   PLOOPB              NO, ERROR
         PACK  DOUBLE(8),3(2,R14)
         CVB   R1,DOUBLE
         SPACE 1
PLOOPA1  MVC   0(80,R4),=CL80'CONTROL COMMAND ACCEPTED'
         MVI   80(R4),X'FF'
         ST    R1,REFRCNT
         B     CMDGET1
         SPACE 1
PLOOPB   MVC   0(80,R4),=CL80'ERROR IN CONTROL COMMAND'
         MVI   80(R4),X'FF'
         B     CMDGET
         SPACE 1
PLOOPC   MVC   COMMAND(1),0(R14)   SAVE COMMAND
         SR    R15,R15
         LA    R1,1(0,R14)         1ST BYTE OF SUB-PARM
         CLI   0(R1),C' '          1ST BYTE BLANK
         BNE   *+16                NO
         LA    R1,1(0,R1)          NEXT BYTE
         CLI   0(R1),C' '          2ND BYTE BLANK
         BE    PROCESS             YES, NO SUB-PARM
         LA    R15,PARM
         MVC   PARM(60),0(R1)
         EJECT
PROCESS  ST    R15,EXITLIST+20     SAVE TEXT ADDR
         MVC   WAITTIME(8),=8C'0'
         XC    CSCSYSID(4),CSCSYSID
         XC    HEXTIME(4),HEXTIME
         LA    R1,PARM
         LA    R8,PARM+74
         SPACE 1
PROCESS1 CLC   0(2,R8),=C'T='      TIME PARM
         BE    PROCESS2            YES
         CLC   0(2,R8),=C'S='      SYSID PARM
         BE    PROCESS4            YES
         BCTR  R8,0                PREVIOUS CHARACTER
         CR    R1,R8               BACK TO BEGINNING
         BNE   PROCESS1            NO, CHECK NEXT
         B     PROCESS5            YES, NO T= FOUND
         SPACE 1
PROCESS2 LA    R1,PACK+3           TARGET FIELD
         MVC   PACK(4),=C'0000'
         CLI   4(R8),C' '          SENDING BYTE BLANK
         BE    *+12                YES, DONT MOVE
         MVC   0(1,R1),4(R8)       MOVE IT
         BCTR  R1,0                NEXT TARGET BYTE
         CLI   3(R8),C' '          SENDING BYTE BLANK
         BE    *+12                YES, DONT MOVE
         MVC   0(1,R1),3(R8)       MOVE IT
         BCTR  R1,0                NEXT TARGET BYTE
         CLI   2(R8),C' '          SENDING BYTE BLANK
         BE    *+10                YES, DONT MOVE
         MVC   0(1,R1),2(R8)       MOVE IT
         MVC   DOUBLE(4),=C'0000'
         MVZ   DOUBLE(4),PACK
         CLC   DOUBLE(4),=C'0000'  IS IT NUMERIC
         BE    PROCESS3            YES
         MVC   PACK(4),=C'0000'
         SPACE 1
PROCESS3 PACK  DOUBLE(8),PACK(4)
         CVB   R15,DOUBLE          SECONDS TO BINARY
         SR    R14,R14
         ST    R15,HEXTIME         SAVE BINARY SECONDS
         D     R14,=F'60'          CALCULATE MINUTES AND SECONDS
         CVD   R15,DOUBLE          MINUTES
         UNPK  WAITTIME+2(2),DOUBLE+6(2)
         OI    WAITTIME+3,X'F0'
         CVD   R14,DOUBLE          SECONDS
         UNPK  WAITTIME+4(2),DOUBLE+6(2)
         OI    WAITTIME+5,X'F0'
         MVC   0(4,R8),=CL4' '
         BCTR  R8,0
         CLI   0(R8),C','
         BNE   *+8
         MVI   0(R8),C' '
         B     PROCESS5
         SPACE 1
PROCESS4 MVC   CSCSYSID(4),2(R8)
         BCTR  R8,0
         MVC   0(8,R8),=CL8' '
         MVC   CSCCMD(1),COMMAND
         MVC   CSCCMD+1(79),PARM
         EJECT
PROCESS5 LA    R1,WAITTIME
         ST    R1,EXITLIST+24      PASS WAITTIME TO COMMANDS
         MVC   TCOMMAND(1),COMMAND
         TR    COMMAND,0(R10)      TRANSLATE COMMAND TO INDEX
         SR    R9,R9
         IC    R9,COMMAND          INSERT INDEX
         SLL   R9,3                OFFSET INTO MODULE LIST
         L     R15,16              CVT ADDR
         L     R15,0(0,R15)        TCB WORDS
         L     R14,12(0,R15)       CURRENT ASCB
         MVC   ASID(2),36(R14)     SAVE ASID
         L     R14,4(0,R15)        CURRENT TCB
         L     R14,12(0,R14)       TIOT
         MVC   USERID(7),0(R14)    USERID (JOBNAME)
         UNPK  TASID(5),ASID(3)
         NC    TASID(4),=8X'0F'
         TR    TASID(4),=C'0123456789ABCDEF'
         MVI   TASID+4,C' '
         L     R15,16              CVT ADDR
         L     R15,196(0,R15)      SMCA
         MVC   SYSTEM(4),16(R15)   SYSTEM ID
         TIME  DEC
         ST    R1,DOUBLE
         UNPK  YEAR(3),DOUBLE+1(2)
         MVI   YEAR+2,C'.'
         UNPK  DAY(3),DOUBLE+2(2)
         OI    DAY+2,X'F0'
         ST    R0,DOUBLE
         UNPK  HOUR(3),DOUBLE(2)
         MVI   HOUR+2,C'.'
         UNPK  MINUTE(3),DOUBLE+1(2)
         MVI   MINUTE+2,C' '
         MVI   68(R4),C' '
         MVC   69(11,R4),68(R4)
         MVC   0(68,R4),HEADER
         LA    R4,80(0,R4)
         CLI   CSCSYSID,X'00'      CROSS-SYSTEM REQUEST
         BNE   CSCPROC             YES
         LTR   R9,R9               COMMAND IN LIST
         BNZ   LOAD                YES, GO PROCESS
         MVC   0(80,R4),=CL80'COMMAND NOT FOUND'
         LA    R4,80(0,R4)
         MVI   0(R4),X'FF'
         B     CMDGET
         EJECT
CSCPROC  LA    R1,10               RESET TIMER COUNT
         MVI   0(R4),C' '
         MVC   1(79,R4),0(R4)
         SPACE 1
CSCPROC0 ST    R1,RESETCNT         RESET TIMER COUNT
         BAL   R10,CSCREAD         READ CSC DATA
         L     R1,16               CVT
         L     R1,0(0,R1)          TCB WORDS
         L     R1,4(0,R1)          CURRENT TCB
         L     R1,12(0,R1)         TIOT
         CLC   0(8,R11),=8X'00'    CSC BUSY
         BE    CSCPROC4            NO
         CLI   4(R11),X'FF'        TSO ID CROSS-SYSTEM COMMAND
         BNE   CSCPROC1            NO
         CLC   5(3,R11),4(R1)      TSO ID MATCH
         BE    CSCPROC2            YES
         SPACE 1
CSCPROC1 STIMER  WAIT,DINTVL=CSCWAIT
         L     R1,RESETCNT         RESET COUNT
         BCT   R1,CSCPROC0         TRY AGAIN
         MVC   TIMESID(4),4(R11)
         MVC   0(48,R4),TIMEMSG    TIMEOUT MSG
         LA    R4,80(0,R4)
         MVI   0(R4),X'FF'
         BAL   R10,CSCCLEAR        FORCE CLEAR
         B     CMDGET
         SPACE 3
CSCPROC2 LH    R9,10(0,R11)        WTO COUNT
         LA    R11,148(0,R11)      1ST WTO ADDR
         SPACE 1
CSCPROC3 MVI   0(R4),C' '
         MVC   1(79,R4),0(R4)
         LA    R1,4(0,R11)         MSG ADDR
         LH    R14,0(0,R11)        MSG LENGTH
         SH    R14,=H'5'
         EX    R14,CSCMVE
         LH    R1,0(0,R11)         WTO LENGTH
         LA    R11,0(R1,R11)       NEXT MSG
         LA    R4,80(0,R4)
         BCT   R9,CSCPROC3
         BAL   R10,CSCCLEAR        RESET DATASET TO ALLOW REUSE
         MVI   0(R4),X'FF'
         B     CMDGET
         SPACE 1
CSCMVE   MVC   0(0,R4),0(R1)
         EJECT
CSCPROC4 MVI   0(R11),X'FF'        TSO SENDER
         MVC   1(3,R11),4(R1)      TSO ID
         XC    8(2,R11),8(R11)
         MVC   12(4,R11),=F'148'   COMMAND RECORD LENGTH
         MVC   16(78,R11),CSCCMD   MOVE COMMAND TO RECORD
         XC    96(52,R11),96(R11)
         MVC   4(4,R11),CSCSYSID
         BAL   R10,CSCWRITE        REWRITE RECORD
         MVC   RECVMSG+20(1),16(R11)
         MVC   0(44,R4),RECVMSG
         LA    R4,80(0,R4)
         MVI   0(R4),X'FF'
         L     R4,=A(CMDOUTPT)     OUTPUT ADDR
         STM   R2,R12,SCRSAVE
         BAL   R7,SCREEN
         LM    R2,R12,SCRSAVE
         CLI   RETCODE,C'Z'        ATTENTION
         BE    CMDINIT             YES
         B     CSCPROC1
         EJECT
CSCREAD  MVC   CSCDATA+62(2),=H'19069'  FULL BLOCKSIZE
         OPEN  (CSCDATA)
         L     R8,=A(RECORD)
         GET   CSCDATA,(R8)
         L     R11,=A(RECORD)
         CLC   0(12,R11),=XL12'00'  ZERO REQUEST
         BE    CSCREAD1            NO
         CLC   0(96,R11),PREVREC   SAME REQUEST
         BE    CSCREAD2            NO
         SPACE 1
CSCREAD1 MVC   PREVREC(96),0(R11)  SAVE NEW REQUEST
         MVC   RESETCNT(4),=F'10'  SET NEW COUNT
         SPACE 1
CSCREAD2 CLOSE (CSCDATA)
         BR    R10
         EJECT
CSCCLEAR L     R1,=A(RECORD)
         XC    0(16,R1),0(R1)
         SPACE 1
CSCWRITE L     R1,=A(RECORD)
         L     R1,12(0,R1)         RECORD LENGTH
         LTR   R1,R1               ZERO LENGTH
         BNZ   CSCWRIT1            NO
         LA    R1,16               MINIMUM LENGTH
         SPACE 1
CSCWRIT1 STH   R1,CSCDATA+62       SAVE LENGTH FOR WRITE
         LR    R2,R1
         OPEN  (CSCDATA,(OUTPUT))
         L     R8,=A(RECORD)
         PUT   CSCDATA,(R8)
         CLOSE (CSCDATA)
         BR    R10
         EJECT
LOAD     LA    R9,0(R11,R9)        MODULE NAME ADDR
         MVC   LOADNAME(8),0(R9)
         LOAD  EPLOC=LOADNAME      LOAD COMMAND MODULE
         ST    R0,ENTRY            SAVE ENTRY ADDR
         LR    R5,R0               MODULE ADDR
         LA    R6,0(0,R1)          MODULE DOUBLEWORDS
         SLL   R6,3                MODULE LENGTH
         ST    R6,LENGTH           SAVE MODULE LENGTH
         SH    R6,=H'6'            ADJUST SCAN LENGTH
         SPACE  1
LOAD1    CLC   0(6,R5),=X'430020280A23'  WTO INSTRUCTIONS
         BE    LOAD3               YES
         SPACE 1
LOAD2    LA    R5,2(0,R5)          NEXT INSTRUCTION
         BCTR  R6,0
         BCT   R6,LOAD1            PROCESS NEXT
         B     LOAD4
         SPACE 1
LOAD3    MVC   0(6,R5),=X'58F0200005EF'
         B     LOAD2
         SPACE 1
LOAD4    L     R5,ENTRY            MODULE ADDR
         L     R6,LENGTH           MODULE LENGTH
         SH    R6,=H'4'            ADJUST SCAN LENGTH
         SPACE  1
LOAD5    CLC   0(2,R5),=X'F100'    SUBPOOL 241
         BE    LOAD7               YES
         SPACE 1
LOAD6    LA    R5,4(0,R5)          NEXT INSTRUCTION
         BCTR  R6,0
         BCTR  R6,0
         BCTR  R6,0
         BCT   R6,LOAD5            PROCESS NEXT
         B     EXECUTE             END OF MODULE
         SPACE 1
LOAD7    MVC   0(2,R5),=H'0'       SET SUBPOOL ZERO
         B     EXECUTE             END OF MODULE
         EJECT
DIREXEC  ST    R14,DIRSAVE
         TPUT  SCRBEGIN,8,FULLSCR
         L     R14,DIRSAVE
         MVC   DIREPLOC(8),1(R14)
         L     R1,DIRCPPL
         CLI   0(R14),C'.'         COMMAND PROCESSOR
         BE    *+8                 YES
         LA    R1,DIRPARM
         STM   R14,R12,DIRSAVE
         LINK  EPLOC=DIREPLOC
         BALR  R15,0
         USING *,R15
         LM    R14,R12,DIRSAVE
         DROP  R15
         B     CMDINIT
         EJECT
SCREEN   LA    R5,22               MAX OUTPUT LINES
         LA    R6,SCRLIN02         OUTPUT BEGIN LINE
         LA    R8,SCRLIN02
         LA    R9,1760
         SR    R10,R10
         SR    R11,R11
         MVCL  R8,R10              CLEAR SCREEN AREA
         SPACE 1
SCREEN1  MVC   0(80,R6),0(R4)      SET OUTPUT LINE
         L     R1,=A(SCRPLUS)
         MVI   0(R1),C' '
         LA    R4,80(0,R4)         NEXT INPUT LINE
         LA    R6,80(0,R6)         NEXT OUTPUT LINE
         CLI   0(R4),X'FF'         END OF INPUT
         BE    SCREEN2             YES, GO WRITE
         BCT   R5,SCREEN1
         L     R1,=A(SCRPLUS)
         MVI   0(R1),C'+'
         SPACE 1
SCREEN2  LA    R14,SCRLIN02
         TR    0(80,R14),TABLE
         TR    80(80,R14),TABLE
         TR    160(80,R14),TABLE
         TR    240(80,R14),TABLE
         TR    320(80,R14),TABLE
         TR    400(80,R14),TABLE
         TR    480(80,R14),TABLE
         TR    560(80,R14),TABLE
         TR    640(80,R14),TABLE
         TR    720(80,R14),TABLE
         TR    800(80,R14),TABLE
         TR    880(80,R14),TABLE
         TR    960(80,R14),TABLE
         TR    1040(80,R14),TABLE
         TR    1120(80,R14),TABLE
         TR    1200(80,R14),TABLE
         TR    1280(80,R14),TABLE
         TR    1360(80,R14),TABLE
         TR    1440(80,R14),TABLE
         TR    1520(80,R14),TABLE
         TR    1600(80,R14),TABLE
         TR    1680(80,R14),TABLE
         EJECT
         LA    R1,SCRBEGIN
         TPUT  (1),SCRLEN,FULLSCR
         CLI   REFRSW,X'FF'        REFRESH IN PROGRESS
         BCR   8,R7                YES
         CLC   REFRESH(8),=CL8'00000000'  REFRESH REQUESTED
         BE    *+8                 NO
         MVI   REFRSW,X'FF'
         MVC   SCRREPLY(63),=CL63' '
         LA    R1,SCRREPLY         REPLY ADDR
         TGET  (1),63,ASIS         GET REPLY
         OC    SCRREPLY+6(57),=CL63' '  CAPS
         CH    R15,=H'12'          INPUT LARGER THAN BUFFER
         BNE   SCREEN3             NO
         TCLEARQ INPUT
         SPACE 1
SCREEN3  CLI   SCRREPLY,X'6C'      ATTENTION (PA1)              FNB001
         BCR   8,R7                YES
         CLI   SCRREPLY,X'7E'      ATTN KEY                     FNB001
         BCR   8,R7                YES                          FNB001
         CLI   SCRREPLY,X'6D'      REPEAT (CLEAR)
         BE    REPEAT              YES
         CLI   SCRREPLY,X'6E'      REPEAT (PA2)                 FNB001
         BE    REPEAT              YES
         CLI   SCRREPLY,X'7D'      ENTER KEY
         BNE   PFKCHK              NO, CHECK PFK ENTRY
         SPACE 1
SCREEN3A LA    R14,SCRREPLY+6
         MVC   SCRLSREP(57),SCRREPLY+6
         CLI   SCRREPLY+6,C'Z'     TERMINATE
         BE    EXIT                YES
         CLC   SCRREPLY+6(3),=C'END'  TERMINATE
         BE    EXIT                YES
         CLI   SCRREPLY+6,C'-'     SCROLL BACK
         BE    SCROLL              YES
         CLI   SCRREPLY+6,C'+'     SCROLL FORWARD
         BE    SCROLL              YES
         CLI   SCRREPLY+6,C'='     SCROLL FIND EQ
         BE    SCROLL2             YES
         CLI   SCRREPLY+6,C' '     NEXT SCREEN REQUEST
         BCR   7,R7                NO
         SPACE 1
SCREEN3B LA    R8,SCRLIN02
         LA    R9,1760
         SR    R10,R10
         SR    R11,R11
         MVCL  R8,R10              CLEAR SCREEN AREA
         CLI   0(R4),X'FF'         ANY MORE OUTPUT
         BNE   SCREEN              YES
         MVC   SCRLIN02(80),=CL80'****   END  OF  OUTPUT   ****'
         B     SCREEN2
         SPACE 1
SCREEN4  LA    R15,SCRREPLY(R1)
         LH    R2,=H'63'
         SR    R2,R1
         EX    R2,CMDSCCLR         CLEAR EXCESS PARM
         BR    R7
         SPACE 1
CMDSCCLR MVC   0(0,R15),=CL63' '
         EJECT
SCROLL   MVC   DOUBLE(3),=C'000'
         MVZ   DOUBLE(3),SCRREPLY+7
         CLC   DOUBLE(3),=C'000'   NUMERIC
         BNE   SCROLL1
         PACK  DOUBLE(8),SCRREPLY+7(3)
         CVB   R14,DOUBLE
         B     SCROLL2
         SPACE 1
SCROLL1  L     R14,=F'99999999'
         SPACE 1
SCROLL2  LA    R11,SCROLLEQ
         CLI   SCRREPLY+6,C'='     SCROLL FIND EQ
         BE    SCROLLF             YES
         CLI   SCRREPLY+6,C'-'     SCROLL UP
         BE    SCROLLU             YES
         CLI   SCRREPLY+6,C'+'     SCROLL DOWN
         BE    SCROLLD             YES
         BR    R7
         SPACE 1
SCROLLU  LA    R14,22(0,R14)       ADJUST TO TOP OF PAGE
         SPACE 1
SCROLLU1 C     R4,=A(CMDOUTPT)     TOP
         BE    SCREEN3B
         S     R4,=F'80'
         BCT   R14,SCROLLU1
         B     SCREEN3B
         SPACE 1
SCROLLD  CLI   0(R4),X'FF'         BOTTOM
         BE    SCROLLD1
         A     R4,=F'80'
         BCT   R14,SCROLLD
         SPACE 1
SCROLLD1 LA    R14,22
         SPACE 1
SCROLLD2 C     R4,=A(CMDOUTPT)     TOP
         BE    SCREEN3B
         S     R4,=F'80'
         BCT   R14,SCROLLD2
         B     SCREEN3B
         EJECT
SCROLLF  LA    R14,21
         SPACE 1
SCROLLF1 C     R4,=A(CMDOUTPT)     TOP
         BE    SCROLLF2
         S     R4,=F'80'
         BCT   R14,SCROLLF1
         SPACE 1
SCROLLF2 SR    R14,R14
         LA    R10,SCRREPLY+7
         LA    R9,55
         SPACE 1
SCROLLF3 BCT   R9,*+6
         BR    R7
         LA    R10,1(0,R10)        NEXT SEARCH BYTE
         LA    R14,1(0,R14)
         CLC   0(1,R10),SCRREPLY+7  DELIMITER FOUND
         BNE   SCROLLF3
         BCTR  R14,0
         BCTR  R14,0
         SPACE 1
SCROLLF4 CLI   0(R4),X'FF'         BOTTOM
         BNE   SCROLLF5
         S     R4,=F'80'
         B     SCREEN3B
         SPACE 1
SCROLLF5 LA    R8,0(0,R4)          BEGIN OF OUTPUT LINE
         LA    R9,80
         SPACE 1
SCROLLF6 EX    R14,SCROLLCL        COMPARE
         EX    0,0(0,R11)          BR ON CONDITION
         LA    R8,1(0,R8)
         BCT   R9,SCROLLF6         CHECK NEXT
         LA    R4,80(0,R4)
         B     SCROLLF4
         SPACE 1
SCROLLCL CLC   0(0,R8),SCRREPLY+8
SCROLLEQ BC    8,SCREEN3B
         EJECT
PFKCHK   L     R2,=A(PFKTAB)
         SPACE 1
PFKCHK1  CLC   SCRREPLY(1),0(R2)   PFK MATCH
         BE    PFKCHK2
         CLI   0(R2),X'00'         END OF PFK TABLE
         BE    ATENTKEY            YES, I DONT KNOW
         LA    R2,4(0,R2)          NEXT ENTRY
         B     PFKCHK1
         SPACE 1
PFKCHK2  LA    R14,SCRREPLY+6
         CLI   0(R2),X'F1'         PFK 1
         BE    PFKCHK3             YES, CHANGE OR DISPLAY PFK
         L     R2,0(0,R2)          PFK DEFINITION
         MVC   SCRREPLY+6(57),13(R2)                            FNB001
         MVC   SCRLSREP(57),13(R2)                              FNB001
         BR    R7
         SPACE 1
PFKCHK3  CLI   SCRREPLY+6,C' '     DISPLAY PFK
         BNE   PFKCHK5             NO, CHANGE REQUEST
         SPACE 1
PFKCHK4  LR    R8,R7
         L     R4,=A(CMDOUTPT)
         LA    R5,1760
         L     R6,=A(PFKTEXT)
         LA    R7,1760
         MVCL  R4,R6               PFK LIST
         LR    R7,R8
         L     R4,=A(CMDOUTPT)
         B     SCREEN              DISPLAY PFK ASSIGNMENTS
         SPACE 1
PFKCHK5  MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),SCRREPLY+6
         CLC   DOUBLE(2),=C'00'    NUMERIC PFK
         BNE   PFKCHK4             NO, DISPLAY
         CLI   SCRREPLY+8,C'='     VALID FORMAT
         BNE   PFKCHK4             NO, DISPLAY
         PACK  DOUBLE(8),SCRREPLY+6(2)
         CVB   R4,DOUBLE
         CH    R4,=H'2'            MIN PFK NUMBER
         BL    PFKCHK4             NO, DISPLAY
         CH    R4,=H'24'           MAX PFK NUMBER              @FNB0001
         BH    PFKCHK4             NO, DISPLAY
         SLL   R4,2                MULT BY 4
         L     R15,=A(PFKTAB-4)
         LA    R4,0(R15,R4)        TABLE SLOT ADDR
         L     R4,0(0,R4)          PFK DEFINITION ADDR
         MVC   13(50,R4),SCRREPLY+9  SAVE NEW PFK ASSIGNMENT    FNB001
         B     PFKCHK4
         EJECT
ATENTKEY LA    R14,SCRREPLY+6
         MVI   RETCODE,C'Z'        INDICATE ATTENTION
         XC    SCRREPLY(63),SCRREPLY
         BR    R7
         SPACE 3
REPEAT   LA    R14,SCRREPLY+6
         MVC   SCRREPLY+6(57),SCRLSREP  LAST COMMAND
         MVI   SCRREPLY,X'00'
         B     SCREEN3A
         SPACE 3
ATENTION BALR  R15,0
         USING *,R15
         MVI   RETCODE,C'Z'        INDICATE ATTENTION
         BR    R14
         DROP  R15
RETCODE  DC    F'0'
         EJECT
EXECUTE  LA    R2,EXITLIST         PARM LIST
         MVC   EXITLIST+16(4),=A(CMDOUTPT+80)
         L     R15,ENTRY           COMMAND ENTRY
         BALR  R14,R15             BRANCH
         SPACE 3
         BALR  R15,0
         USING *,R15
         L     R3,=A(CMDSBTSO)     LOAD ORIGINAL BASE
         L     R13,=A(SAVE)
         DELETE  EPLOC=LOADNAME    DELETE MODULE
         B     CMDGET
         DROP  R15
         SPACE 3
EXIT     TPUT  SCRBEGIN,8,FULLSCR
         STATTN  LINES=0,TENS=0,INPUT=0
         L     R0,SIZEGETM
         L     R1,GETMADR
         FREEMAIN  R,LV=(0),A=(1)
         L     R13,SAVE+4
         RETURN  (14,12),RC=0
         EJECT
         USING TPUT,R15
TPUT     ST    R14,8(0,R2)         SAVE RETURN ADDR
         ST    R4,12(0,R2)         SAVE WORK REG
         L     R4,16(0,R2)         LOAD OUTPUT ADDR
         LTR   R0,R0               NORMAL ENTRY
         BNZ   TPUT0               NO, QUEUE COMMAND
         C     R4,=A(CMDOUTEN)     END OF OUTPUT
         BCR   8,R14               YES
         MVI   0(R4),C' '
         MVC   1(79,R4),0(R4)
         LH    R14,0(0,R1)         ORIG MSG LENGTH
         SH    R14,=H'5'           NEW MSG LENGTH
         EX    R14,TPUTMVE         MSG TEXT ADDR
         LA    R4,80(0,R4)         ADD IN MSG LENGTH
         MVI   0(R4),X'FF'
         ST    R4,16(0,R2)         SAVE OUTPUT ADDR
         L     R14,8(0,R2)         LOAD RETURN ADDR
         L     R4,12(0,R2)         LOAD WORK REG
         BR    R14                 RETURN
         SPACE 1
TPUTMVE  MVC   0(0,R4),4(R1)
         SPACE 1
TPUT0    LR    R14,R0
         SPACE 1
TPUT1    L     R0,CMDOUTCT         LOAD CURRENT RECORD COUNT
         A     R0,=F'1'            ADD 1
         ST    R0,CMDOUTCT         SAVE NEW RECORD COUNT
         C     R0,CMDOUTBG         EQUAL TO 1ST REC TO PRINT
         BL    TPUT2               NOT YET
         MVC   0(80,R4),0(R1)
         LA    R4,80(0,R4)         ADD IN MSG LENGTH
         C     R4,=A(CMDOUTEN)     END OF OUTPUT
         BE    TPUT3               YES
         SPACE 1
TPUT2    LA    R1,80(0,R1)
         BCT   R14,TPUT1
         MVI   0(R4),X'FF'
         SPACE 1
TPUT3    ST    R4,16(0,R2)         SAVE OUTPUT ADDR
         SR    R0,R0
         C     R4,=A(CMDOUTEN)     END OF OUTPUT
         BL    *+8                 NO
         LA    R0,1                INDICATE END
         L     R14,8(0,R2)         LOAD RETURN ADDR
         L     R4,12(0,R2)         LOAD WORK REG
         BR    R14                 RETURN
CMDOUTCT DC    F'0'                CURRENT COUNT
CMDOUTBG DC    F'0'                1ST RECORD TO PRINT
         DROP  R15
         EJECT
         LTORG
         SPACE 3
SAVE     DS    18F
DIRSAVE  DS    18F
SCRSAVE  DS    12F
         DS    0D
ATTNCHAR DC    CL8'#'
DOUBLE   DS    2F
DIREPLOC DC    CL8' '
REFRESH  DC    CL8'00000000'
REFRCNT  DC    F'20'
         DS    0D
LOADNAME DC    CL8' '
WAITTIME DS    2F
HEXTIME  DS    F
SIZEGETM DC    F'16384'
REFRSW   DS    F
PACK     DS    F
ENTRY    DS    F
LENGTH   DS    F
COMMAND  DC    F'0'
PARM     DC    CL80' '
CSCSYSID DC    F'0'
CSCCMD   DC    CL80' '
         SPACE 1
DIRCPPL  DC    F'0'
DIRPARM  DC    H'0'
         DC    H'0'
         SPACE 3
HEADER   DS    0CL68
         DC    C'---  <TSO>  CMDSBSYS (#'                       FNB001
TCMDTYP  DC    C' '
TCOMMAND DC    C' ',C')  '
SYSTEM   DC    CL4' ',C'  '
YEAR     DC    CL2' ',C' '
DAY      DC    CL3' ',C'  '
HOUR     DC    CL2' ',C' '
MINUTE   DC    CL2' ',C'  '
USERID   DC    CL7' ',C'  '
TASID    DC    CL4' ',C'  ---'
         SPACE 3
EXITLIST DC    A(TPUT)
ASID     DC    F'0'
         DC    9F'0'
GETMADR  DC    F'0'
         DC    A(SCRREPLY+8)
         EJECT
         DS    0D
TABLE    DC    64C' '
         DC    C'           .<(+|&&          $*);Â¬-/         '
         DC    C',%_>?          :#@''=" '
     DC    C'ABCDEFGHI',CL7' ',C'JKLMNOPQR',CL8' ',C'STUVWXYZ',CL23' '
     DC    C'ABCDEFGHI',CL7' ',C'JKLMNOPQR',CL8' ',C'STUVWXYZ',CL6' '
         DC    C'0123456789',CL6' '
         SPACE 3
         DS    0D
COMTAB   DC    193X'00'
*                 A B C D E F G H I
         DC    X'04000A030005000C09',XL7'00'
*                 J K L M N O P Q R
         DC    X'0B000200010F0D0E06',XL8'00'
*                 S T U V W X Y Z
         DC    X'0700000800030010',XL23'00'
         SPACE 3
MODLIST  DC    CL8' '
         DC    CL8'CSCSA03D'     1
         DC    CL8'CSCSC03D'     2
         DC    CL8'CSCSD03D'     3
         DC    CL8'CSCSE03D'     4
         DC    CL8'CSCSF03D'     5
         DC    CL8'CSCSG03D'     6
         DC    CL8'CSCSH03D'     7
         DC    CL8'CSCSI03D'     8
         DC    CL8'CSCSJ03D'     9
         DC    CL8'CSCSK03D'     A
         DC    CL8'CSCSL03D'     B
         DC    CL8'CSCSM03D'     C
         DC    CL8'CSCSP03D'     D
         DC    CL8'CSCSQ03D'     E
         DC    CL8'CSCSR03D'     F
         DC    CL8'CSCSZ03D'    10
         DC    CL8'        '
         DC    CL8'        '
         DC    CL8'        '
         EJECT
         DS    0D
COMTAB2  DC    193X'00'
*                 A B C D E F G H I
         DC    X'010203000000000000',XL7'00'
*                 J K L M N O P Q R
         DC    X'040000000000050000',XL8'00'
*                 S T U V W X Y Z
         DC    X'0600000000000000',XL23'00'
         SPACE 3
MODLIST2 DC    CL8'        '   0
         DC    CL8'CSCZA03D'   1
         DC    CL8'CSCZB03D'   2
         DC    CL8'CSCZC03D'   3
         DC    CL8'CSCZJ03D'   4
         DC    CL8'CSCZP03D'   5
         DC    CL8'CSCZS03D'   6
         DC    CL8'        '
         EJECT
         DS    0D
COMTAB3  DC    193X'00'
*                 A B C D E F G H I
         DC    X'010000000203000405',XL7'00'
*                 J K L M N O P Q R
         DC    X'060000000007000000',XL8'00'                       @TEC
*                 S T U V W X Y Z
         DC    X'09000A0000000000',XL23'00'
         SPACE 3
MODLIST3 DC    CL8'        '
         DC    CL8'CSCGA03D'  1
         DC    CL8'CSCGE03D'  2
         DC    CL8'CSCGF03D'  3
         DC    CL8'CSCGH03D'  4
         DC    CL8'CSCGI03D'  5
         DC    CL8'CSCGJ03D'  6
         DC    CL8'CSCGO03D'  7
         DC    CL8'        '  8                                    @TEC
         DC    CL8'CSCGS03D'  9
         DC    CL8'CSCGU03D'  A
         DC    CL8'        '
         EJECT
         DS    0D
CSCWAIT  DC    CL8'00000200'
RESETCNT DC    F'10'
PREVREC  DC    CL96' '
         SPACE 5
RECVMSG  DS    0CL44
         DC    CL44'CMD SUBSYS -   CSC #X COMMAND ACCEPTED'
         SPACE 3
TIMEMSG  DS    0CL48
         DC    CL43'CMD SUBSYS -   CSC TIMEOUT, CMD PENDING ON '
TIMESID  DC    CL4' ',C' '
         EJECT
CSCDATA  DCB   DDNAME=CSCDATA,DSORG=PS,RECFM=U,BLKSIZE=19069,          X
               MACRF=(GM,PM)
         EJECT
SCRREPLY DC    CL63' ',CL17' '
SCRBEGIN DS    0D
SCRLIN01 DC    X'C31140403C404000'
         DC    C'CMD SUBSYSTEM -'
         DC    X'1DC8'
SCRLSREP DC    CL63' '
         DC    X'1DF0'
SCRLIN02 DC    CL80' '
SCRLIN03 DC    CL80' '
SCRLIN04 DC    CL80' '
SCRLIN05 DC    CL80' '
SCRLIN06 DC    CL80' '
SCRLIN07 DC    CL80' '
SCRLIN08 DC    CL80' '
SCRLIN09 DC    CL80' '
SCRLIN10 DC    CL80' '
SCRLIN11 DC    CL80' '
SCRLIN12 DC    CL80' '
SCRLIN13 DC    CL80' '
SCRLIN14 DC    CL80' '
SCRLIN15 DC    CL80' '
SCRLIN16 DC    CL80' '
SCRLIN17 DC    CL80' '
SCRLIN18 DC    CL80' '
SCRLIN19 DC    CL80' '
SCRLIN20 DC    CL80' '
SCRLIN21 DC    CL80' '
SCRLIN22 DC    CL80' '
SCRLIN23 DC    CL80' '
SCRLIN24 DC    C'REPLY -'
         DC    X'1DC8115DF71DF0'
SCRPLUS  DC    C' '
         DC    X'115CF813'
SCRLEN   EQU   *-SCRBEGIN
         EJECT
PFKTAB   DC    X'F1',AL3(PFK01)
         DC    X'F2',AL3(PFK02)
         DC    X'F3',AL3(PFK03)
         DC    X'F4',AL3(PFK04)
         DC    X'F5',AL3(PFK05)
         DC    X'F6',AL3(PFK06)
         DC    X'F7',AL3(PFK07)
         DC    X'F8',AL3(PFK08)
         DC    X'F9',AL3(PFK09)
         DC    X'7A',AL3(PFK10)
         DC    X'7B',AL3(PFK11)
         DC    X'7C',AL3(PFK12)
         DC    X'C1',AL3(PFK13)                                @FNB0001
         DC    X'C2',AL3(PFK14)                                @FNB0001
         DC    X'C3',AL3(PFK15)                                @FNB0001
         DC    X'C4',AL3(PFK16)                                @FNB0001
         DC    X'C5',AL3(PFK17)                                @FNB0001
         DC    X'C6',AL3(PFK18)                                @FNB0001
         DC    X'C7',AL3(PFK19)                                @FNB0001
         DC    X'C8',AL3(PFK20)                                @FNB0001
         DC    X'C9',AL3(PFK21)                                @FNB0001
         DC    X'4A',AL3(PFK22)                                @FNB0001
         DC    X'4B',AL3(PFK23)                                @FNB0001
         DC    X'4C',AL3(PFK24)                                @FNB0001
         DC    X'00'
         EJECT
OPENTEXT DC    CL80'#####   CMD  SUB-SYSTEM  MONITOR   #####'
         DC    CL80' '
         DC    CL80' '
 DC CL80'--->  ENTER  # CMDS,  ## CMDS,  OR  GRAPHIC MONITOR CMDS'
         DC    CL80'             BEGINNING WHERE CURSOR IS POSITIONED'
         DC    CL80' '
 DC CL80'--->  ENTER  NN/XX  TO CHANGE MONITOR REFRESH INTERVAL'
         DC    CL80' '
         DC    CL80'             WHERE  NN  =   NUMBER OF SECONDS'
         DC    CL80'                    XX  =   NUMBER OF INTERVALS'
         DC    CL80' '
 DC CL80'--->  ENTER  ''.XXXX''  TO CALL COMMAND PROCESSOR  XXXX'
         DC    CL80'             ''@XXXX''  TO CALL PROGRAM  XXXX'
         DC    CL80' '
         DC    CL80'--->  ENTER  ''Z''  OR  ''END''   TO TERMINATE'
         DC    CL80' '
         DC    CL80'--->  PRESS  PA1 TO STOP AUTOMATIC REFRESH'
         DC    CL80'--->  PRESS  PA2 TO REPEAT THE LAST COMMAND'
         DC    CL80'--->  PRESS  PFK 1  TO DISPLAY PFK ASSIGNMENTS'
         DC    CL80' '
 DC CL80'--->  ENTER  ''H''  TO OBTAIN HELP FOR GRAPHIC MONITOR CMDS'
         DC    CL80' '
         SPACE 5
PFKTEXT  DC    CL80'#####        PFK  ASSIGNMENTS        #####'
         DC    CL80' '
         DC    CL80' '
PFK01    DC    CL80'PFK1     =   DISPLAY PFK ASSIGNMENTS'      @FNB0001
PFK02    DC    CL80'PFK2     =   H'                            @FNB0001
PFK03    DC    CL80'PFK3     =   E'                            @FNB0001
PFK04    DC    CL80'PFK4     =   F'                            @FNB0001
PFK05    DC    CL80'PFK5     =   J'                            @FNB0001
PFK06    DC    CL80'PFK6     =   S'                            @FNB0001
PFK07    DC    CL80'PFK7     =   #J'                           @FNB0001
PFK08    DC    CL80'PFK8     =   #O'                           @FNB0001
PFK09    DC    CL80'PFK9     =   #OX'                          @FNB0001
PFK10    DC    CL80'PFK10    =   #Q'                           @FNB0001
PFK11    DC    CL80'PFK11    =   ##SD'                         @FNB0001
PFK12    DC    CL80'PFK12    =   05/50'                        @FNB0001
PFK13    DC    CL80'PFK13    =   #A'                           @FNB0001
PFK14    DC    CL80'PFK14    =   #R'                           @FNB0001
PFK15    DC    CL80'PFK15    =   ##P,T=5'                      @FNB0001
PFK16    DC    CL80'PFK16    =   ##A,T=5'                      @FNB0001
PFK17    DC    CL80'PFK17    =   #N*'                          @FNB0001
PFK18    DC    CL80'PFK18    =   #P'                           @FNB0001
PFK19    DC    CL80'PFK19    =   A'                            @FNB0001
PFK20    DC    CL80'PFK20    =   U'                            @FNB0001
PFK21    DC    CL80'PFK21    =   ##AT,T=5'                     @FNB0001
PFK22    DC    CL80'PFK22    =   #F'                           @FNB0001
PFK23    DC    CL80'PFK23    =   #I'                           @FNB0001
PFK24    DC    CL80'PFK24    =   01/50'                        @FNB0001
         DC    CL80' '
         DC    CL80' '
         DC    CL80' '
 DC CL80'--->  ENTER  NN=XXXX  AND PRESS PFK 1  TO CHANGE PFK FUNCTION'
         DC    CL80' '
 DC CL80'             WHERE  NN -   IS THE PFK NUMBER  02 - 24' FNB001
 DC CL80'                    XXXX - IS THE COMMAND TO BE ASSIGNED'
         SPACE 5
RECORD   DS    CL19069
         SPACE 5
CMDOUTPT DS    4000CL80
CMDOUTEN DC    CL80' '
         DC    30C'-',CL20'  OUTPUT TRUNCATED  ',30C'-'
         DC    X'FF'
         EJECT
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CMDTSO
         TITLE 'CMDTSO -   TSO DRIVER MODULE'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CMDTSO -         TSO DRIVER MODULE                        ***
***                                                                 ***
***       VERSION -        1.1                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***                                                                 ***
***       UPDATED -        12/01/79                                 ***
***                        05/31/86  GLA-BFG CORRECT DEPENDENCY     ***
***                                  ON R4 BEING PRESERVED ACROSS   ***
***                                  MODULE CALL                    ***
***                                                                 ***
***                                                                 ***
***  THIS MODULE SEARCHES THE CODE IT IS LOADING (#Q, #N, ETC.) TO  ***
***     SEE IF SUBPOOL 241 IS BEING REQUESTED FOR THE GETMAIN.  THIS***
***     MODULE DOES THIS BY SEARCHING FOR X'F100' IN THE CODE.      ***
***     IF THE EXECUTION IS TAKING PLACE VIA THE SYSTEM CONSOLE,    ***
***     THEN SUBPOOL 241 IS ALLOWED.  IF THE EXECUTION IS TAKING    ***
***     PLACE WITHIN TSO, THEN THE X'F100' IS CHANGED TO X'0000'    ***
***     (FOR SUBPOOL 0) PRIOR TO THE ACTUAL EXECUTION OF THE CODE.  ***
***     IF THE PROPER CODING CONVENTIONS ARE NOT FOLLOWED IN THE    ***
***     SUB-MODULES (#Q, #N, ETC.), THIS CHECK MAY NOT BE SUCCESS-  ***
***     FUL, AND AN ABEND B0A WILL TAKE PLACE.
***                                                                 ***
***********************************************************************
***********************************************************************
         EJECT
CMDTSO   CSECT
         SAVE  (14,12)
         LR    R3,R15
         USING CMDTSO,R3
         ST    R13,SAVE+4
         LA    R13,SAVE
         L     R1,0(0,R1)          PARM ADDR
         LH    R15,0(0,R1)         PARM LENGTH
         BCTR  R15,0               SUBTRACT MIN LENGTH
         LTR   R15,R15             ANY SUBPARMS
         BM    EXIT                NO PARMS AT ALL
         LA    R10,COMTAB          # COMMAND TABLE
         LA    R11,MODLIST         # COMMAND MODULE LIST
         CLI   2(R1),C'#'          ## COMMAND
         BNE   PLOOP0              NO
         LA    R1,1(0,R1)          ADJUST INPUT PARM
         BCTR  R15,0               ADJUST LENGTH
         LA    R10,COMTAB2         ## COMMAND TABLE
         LA    R11,MODLIST2        ## COMMAND MODULE LIST
         MVI   TCMDTYP,C'#'        INDICATE ##
         SPACE 1
PLOOP0   MVC   COMMAND(1),2(R1)    SAVE COMMAND
         LA    R1,3(0,R1)          1ST BYTE OF SUBPARM
         LTR   R15,R15             ANY SUBPARMS
         BZ    PROCESS             NO
         BCTR  R15,0
         CH    R15,=H'79'          MAX PARM LENGTH
         BNH   *+8                 NO
         LH    R15,=H'79'          SET MAX
         CLI   0(R1),C' '          1 BLANK ALLOWED
         BNE   *+10
         LA    R1,1(0,R1)
         BCTR  R15,0
         EX    R15,PARMMOVE        MOVE PARM
         LA    R15,PARM-1
         SPACE 1
PLOOP    LA    R15,1(0,R15)
         CLI   0(R15),C' '         END OF PARM
         BE    PLOOP1              YES
         CLI   0(R15),C'@'         COMMA REPLACE
         BNE   PLOOP               NO, NEXT DIGIT
         MVI   0(R15),C','         FORCE COMMA
         B     PLOOP
         SPACE 1
PARMMOVE MVC   PARM(0),0(R1)
         SPACE 1
PLOOP1   LA    R15,PARM
         EJECT
PROCESS  ST    R15,EXITLIST+20     SAVE TEXT ADDR
         MVC   WAITTIME(8),=8C'0'
         XC    CSCSYSID(4),CSCSYSID
         XC    HEXTIME(4),HEXTIME
         LA    R1,PARM
         LA    R8,PARM+74
         SPACE 1
PROCESS1 CLC   0(2,R8),=C'T='      TIME PARM
         BE    PROCESS2            YES
         CLC   0(2,R8),=C'S='      SYSID PARM
         BE    PROCESS4            YES
         BCTR  R8,0                PREVIOUS CHARACTER
         CR    R1,R8               BACK TO BEGINNING
         BNE   PROCESS1            NO, CHECK NEXT
         B     PROCESS5            YES, NO T= FOUND
         SPACE 1
PROCESS2 LA    R1,PACK+3           TARGET FIELD
         MVC   PACK(4),=C'0000'
         CLI   4(R8),C' '          SENDING BYTE BLANK
         BE    *+12                YES, DONT MOVE
         MVC   0(1,R1),4(R8)       MOVE IT
         BCTR  R1,0                NEXT TARGET BYTE
         CLI   3(R8),C' '          SENDING BYTE BLANK
         BE    *+12                YES, DONT MOVE
         MVC   0(1,R1),3(R8)       MOVE IT
         BCTR  R1,0                NEXT TARGET BYTE
         CLI   2(R8),C' '          SENDING BYTE BLANK
         BE    *+10                YES, DONT MOVE
         MVC   0(1,R1),2(R8)       MOVE IT
         MVC   DOUBLE(4),=C'0000'
         MVZ   DOUBLE(4),PACK
         CLC   DOUBLE(4),=C'0000'  IS IT NUMERIC
         BE    PROCESS3            YES
         MVC   PACK(4),=C'0000'
         SPACE 1
PROCESS3 PACK  DOUBLE(8),PACK(4)
         CVB   R15,DOUBLE          SECONDS TO BINARY
         SR    R14,R14
         ST    R15,HEXTIME         SAVE BINARY SECONDS
         D     R14,=F'60'          CALCULATE MINUTES AND SECONDS
         CVD   R15,DOUBLE          MINUTES
         UNPK  WAITTIME+2(2),DOUBLE+6(2)
         OI    WAITTIME+3,X'F0'
         CVD   R14,DOUBLE          SECONDS
         UNPK  WAITTIME+4(2),DOUBLE+6(2)
         OI    WAITTIME+5,X'F0'
         MVC   0(4,R8),=CL4' '
         BCTR  R8,0
         CLI   0(R8),C','
         BNE   *+8
         MVI   0(R8),C' '
         B     PROCESS5
         SPACE 1
PROCESS4 MVC   CSCSYSID(4),2(R8)
         BCTR  R8,0
         MVC   0(8,R8),=CL8' '
         MVC   CSCCMD(1),COMMAND
         MVC   CSCCMD+1(79),PARM
         EJECT
PROCESS5 LA    R1,WAITTIME
         ST    R1,EXITLIST+24      PASS WAITTIME TO COMMANDS
         MVC   TCOMMAND(1),COMMAND
         TR    COMMAND,0(R10)      TRANSLATE COMMAND TO INDEX
         SR    R4,R4
         IC    R4,COMMAND          INSERT INDEX
         SLL   R4,3                OFFSET INTO MODULE LIST
         L     R15,16              CVT ADDR
         L     R15,0(0,R15)        TCB WORDS
         L     R14,12(0,R15)       CURRENT ASCB
         MVC   ASID(2),36(R14)     SAVE ASID
         L     R14,4(0,R15)        CURRENT TCB
         L     R14,12(0,R14)       TIOT
         MVC   USERID(7),0(R14)    USERID (JOBNAME)
         UNPK  TASID(5),ASID(3)
         NC    TASID(4),=8X'0F'
         TR    TASID(4),=C'0123456789ABCDEF'
         MVI   TASID+4,C' '
         L     R15,16              CVT ADDR
         L     R15,196(0,R15)      SMCA
         MVC   SYSTEM(4),16(R15)   SYSTEM ID
         TIME  DEC
         ST    R1,DOUBLE
         UNPK  YEAR(3),DOUBLE+1(2)
         MVI   YEAR+2,C'.'
         UNPK  DAY(3),DOUBLE+2(2)
         OI    DAY+2,X'F0'
         ST    R0,DOUBLE
         UNPK  HOUR(3),DOUBLE(2)
         MVI   HOUR+2,C'.'
         UNPK  MINUTE(3),DOUBLE+1(2)
         MVI   MINUTE+2,C' '
         CLI   CSCSYSID,X'00'      CROSS-SYSTEM REQUEST
         BNE   CSCPROC             YES
         L     R0,ASID
         LA    R1,HEADER
         ICM   R0,3,=H'68'
         SVC   93
         LTR   R4,R4               COMMAND IN LIST
         BNZ   LOAD                YES, GO PROCESS
         L     R0,ASID             LOAD ASID
         LA    R1,=CL20'COMMAND NOT FOUND'
         ICM   R0,3,=H'20'         INSERT MESSAGE LENGTH
         SVC   93                  TPUT SVC
         B     EXIT
         EJECT
CSCPROC  LA    R1,10               RESET TIMER COUNT
         SPACE 1
CSCPROC0 ST    R1,RESETCNT         RESET TIMER COUNT
         BAL   R10,CSCREAD         READ CSC DATA
         L     R1,16               CVT
         L     R1,0(0,R1)          TCB WORDS
         L     R1,4(0,R1)          CURRENT TCB
         L     R1,12(0,R1)         TIOT
         CLC   0(8,R11),=8X'00'    CSC BUSY
         BE    CSCPROC4            NO
         CLI   4(R11),X'FF'        TSO ID CROSS-SYSTEM COMMAND
         BNE   CSCPROC1            NO
         CLC   5(3,R11),4(R1)      TSO ID MATCH
         BE    CSCPROC2            YES
         SPACE 1
CSCPROC1 STIMER WAIT,DINTVL=CSCWAIT
         L     R1,RESETCNT         RESET COUNT
         BCT   R1,CSCPROC0         TRY AGAIN
         MVC   TIMESID(4),4(R11)
         LA    R1,TIMEMSG          TIMEOUT MSG
         L     R0,ASID             LOAD ASID
         ICM   R0,3,=H'48'         INSERT MESSAGE LENGTH
         SVC   93                  TPUT SVC
         BAL   R10,CSCCLEAR        FORCE CLEAR
         B     EXIT
         SPACE 3
CSCPROC2 LH    R9,10(0,R11)        WTO COUNT
         LA    R11,148(0,R11)      1ST WTO ADDR
         SPACE 1
CSCPROC3 LA    R1,4(0,R11)         MSG ADDR
         LH    R0,0(0,R11)         MSG LENGTH
         SH    R0,=H'4'
         ICM   R0,12,ASID          ASID
         SVC   93
         LH    R1,0(0,R11)         WTO LENGTH
         LA    R11,0(R1,R11)       NEXT MSG
         BCT   R9,CSCPROC3
         BAL   R10,CSCCLEAR        RESET DATASET TO ALLOW REUSE
         B     EXIT
         EJECT
CSCPROC4 MVI   0(R11),X'FF'        TSO SENDER
         MVC   1(3,R11),4(R1)      TSO ID
         XC    8(2,R11),8(R11)
         MVC   12(4,R11),=F'148'   COMMAND RECORD LENGTH
         MVC   16(78,R11),CSCCMD   MOVE COMMAND TO RECORD
         XC    96(52,R11),96(R11)
         MVC   4(4,R11),CSCSYSID
         BAL   R10,CSCWRITE        REWRITE RECORD
         MVC   RECVMSG+20(1),16(R11)
         LA    R1,RECVMSG          TIMEOUT MSG
         L     R0,ASID             LOAD ASID
         ICM   R0,3,=H'44'         INSERT MESSAGE LENGTH
         SVC   93                  TPUT SVC
         B     CSCPROC1
         EJECT
CSCREAD  MVC   CSCDATA+62(2),=H'19069' FULL BLOCKSIZE
         OPEN  (CSCDATA)
         GET   CSCDATA,RECORD
         LA    R11,RECORD
         CLC   0(12,R11),=XL12'00' ZERO REQUEST
         BE    CSCREAD1            NO
         CLC   0(96,R11),PREVREC   SAME REQUEST
         BE    CSCREAD2            NO
         SPACE 1
CSCREAD1 MVC   PREVREC(96),0(R11)  SAVE NEW REQUEST
         MVC   RESETCNT(4),=F'10'  SET NEW COUNT
         SPACE 1
CSCREAD2 CLOSE (CSCDATA)
         BR    R10
         EJECT
CSCCLEAR XC    RECORD(16),RECORD
         SPACE 1
CSCWRITE L     R1,RECORD+12        RECORD LENGTH
         LTR   R1,R1               ZERO LENGTH
         BNZ   CSCWRIT1            NO
         LA    R1,16               MINIMUM LENGTH
         SPACE 1
CSCWRIT1 STH   R1,CSCDATA+62       SAVE LENGTH FOR WRITE
         LR    R2,R1
         OPEN  (CSCDATA,(OUTPUT))
         PUT   CSCDATA,RECORD
         CLOSE (CSCDATA)
         BR    R10
         EJECT
LOAD     LA    R4,0(R11,R4)        MODULE NAME ADDR
         ST    R4,EPNAME      SAVE ADDRESS OF NAME              GLA-BFG
         LOAD  EPLOC=(R4)          LOAD COMMAND MODULE
         ST    R0,ENTRY            SAVE ENTRY ADDR
         LR    R5,R0               MODULE ADDR
         LA    R6,0(0,R1)          MODULE DOUBLEWORDS
         SLL   R6,3                MODULE LENGTH
         ST    R6,LENGTH           SAVE MODULE LENGTH
         SH    R6,=H'6'            ADJUST SCAN LENGTH
         SPACE  1
LOAD1    CLC   0(6,R5),=X'430020280A23'   WTO INSTRUCTIONS
         BE    LOAD3               YES
         SPACE 1
LOAD2    LA    R5,2(0,R5)          NEXT INSTRUCTION
         BCTR  R6,0
         BCT   R6,LOAD1            PROCESS NEXT
         B     LOAD4
         SPACE 1
LOAD3    MVC   0(6,R5),=X'58F0200005EF'
         B     LOAD2
         SPACE 1
LOAD4    L     R5,ENTRY            MODULE ADDR
         L     R6,LENGTH           MODULE LENGTH
         SH    R6,=H'4'            ADJUST SCAN LENGTH
         SPACE  1
LOAD5    CLC   0(2,R5),=X'F100'    SUBPOOL 241
         BE    LOAD7               YES
         SPACE 1
LOAD6    LA    R5,4(0,R5)          NEXT INSTRUCTION
         BCTR  R6,0
         BCTR  R6,0
         BCTR  R6,0
         BCT   R6,LOAD5            PROCESS NEXT
         B     EXECUTE             END OF MODULE
         SPACE 1
LOAD7    MVC   0(2,R5),=H'0'       SET SUBPOOL ZERO
         EJECT
EXECUTE  LA    R2,EXITLIST         PARM LIST
         L     R15,ENTRY           COMMAND ENTRY
         BALR  R14,R15             BRANCH
         SPACE 3
         BALR  R15,0
         USING *,R15
         L     R3,=A(CMDTSO)       LOAD ORIGINAL BASE
         DROP  R15
         L     R4,EPNAME      GET ADDRESS OF NAME               GLA-BFG
         DELETE EPLOC=(R4)         DELETE MODULE                GLA-BFG
         SPACE 3
EXIT     L     R13,SAVE+4
         RETURN (14,12),RC=0
         SPACE 3
         USING TPUT,R15
TPUT     LH    R0,0(0,R1)          ORIG MSG LENGTH
         SH    R0,=H'4'            NEW MSG LENGTH
         LA    R1,4(0,R1)          MSG TEXT ADDR
         O     R0,ASID             ADD IN MSG LENGTH
         ST    R14,8(0,R2)         SAVE RETURN ADDR
         SVC   93                  TPUT SVC
         L     R14,8(0,R2)         LOAD RETURN ADDR
         BR    R14                 RETURN
         DROP  R15
         EJECT
         LTORG
         SPACE 3
SAVE     DS    18F
         DS    0D
DOUBLE   DS    2F
WAITTIME DS    2F
HEXTIME  DS    F
PACK     DS    F
ENTRY    DS    F
LENGTH   DS    F
EPNAME   DS    F              ADDRESS OF MODULE NAME            GLA-BFG
COMMAND  DC    F'0'
PARM     DC    CL80' '
CSCSYSID DC    F'0'
CSCCMD   DC    CL80' '
         SPACE 3
HEADER   DS    0CL68
         DC    C'---  <TSO>  CMD SBSYS (#'
TCMDTYP  DC    C' '
TCOMMAND DC    C' ',C')  '
SYSTEM   DC    CL4' ',C'  '
YEAR     DC    CL2' ',C' '
DAY      DC    CL3' ',C'  '
HOUR     DC    CL2' ',C' '
MINUTE   DC    CL2' ',C'  '
USERID   DC    CL7' ',C'  '
TASID    DC    CL4' ',C'  ---'
         SPACE 3
EXITLIST DC    A(TPUT)
ASID     DC    F'0'
         DC    10F'0'
         EJECT
         DS    0D
COMTAB   DC    193X'00'
*                 A B C D E F G H I
         DC    X'04000A030005000C09',XL7'00'
*                 J K L M N O P Q R
         DC    X'0B000200010F0D0E06',XL8'00'
*                 S T U V W X Y Z
         DC    X'0700000800030010',XL23'00'
         SPACE 3
MODLIST  DC    CL8' '
         DC    CL8'CSCSA03D'  1
         DC    CL8'CSCSC03D'  2
         DC    CL8'CSCSD03D'  3
         DC    CL8'CSCSE03D'  4
         DC    CL8'CSCSF03D'  5
         DC    CL8'CSCSG03D'  6
         DC    CL8'CSCSH03D'  7
         DC    CL8'CSCSI03D'  8
         DC    CL8'CSCSJ03D'  9
         DC    CL8'CSCSK03D'  A
         DC    CL8'CSCSL03D'  B
         DC    CL8'CSCSM03D'  C
         DC    CL8'CSCSP03D'  D
         DC    CL8'CSCSQ03D'  E
         DC    CL8'CSCSR03D'  F
         DC    CL8'CSCSZ03D' 10
         DC    CL8'        '
         DC    CL8'        '
         DC    CL8'        '
         EJECT
         DS    0D
COMTAB2  DC    193X'00'
*                 A B C D E F G H I
         DC    X'010203000000000000',XL7'00'
*                 J K L M N O P Q R
         DC    X'040000000000050000',XL8'00'
*                 S T U V W X Y Z
         DC    X'0600000000000000',XL23'00'
         SPACE 3
MODLIST2 DC    CL8'        '
         DC    CL8'CSCZA03D'  1
         DC    CL8'CSCZB03D'  2
         DC    CL8'CSCZC03D'  3
         DC    CL8'CSCZJ03D'  4
         DC    CL8'CSCZP03D'  5
         DC    CL8'CSCZS03D'  6
         DC    CL8'        '
         EJECT
         DS    0D
CSCWAIT  DC    CL8'00000200'
RESETCNT DC    F'10'
PREVREC  DC    CL96' '
         EJECT
RECVMSG  DS    0CL44
         DC    CL44'CMD SUBSYS -   CSC #X COMMAND ACCEPTED'
         SPACE 3
TIMEMSG  DS    0CL48
         DC    CL43'CMD SUBSYS -   CSC TIMEOUT, CMD PENDING ON '
TIMESID  DC    CL4' ',C' '
         EJECT
CSCDATA  DCB   DDNAME=CSCDATA,DSORG=PS,RECFM=U,BLKSIZE=19069,          X
               MACRF=(GM,PM)
         SPACE 5
RECORD   DS    CL19069
         EJECT
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCGA03D
         TITLE 'ESAGA03D -   A  JOB ACTIVITY MONITOR'
         PRINT NOGEN                                               @TEC
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SP1GA03D -       A  JOB ACTIVITY MONITOR                  ***
***                                                                 ***
***       VERSION -        3.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        08/22/91                                 ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
*-------------------------------------------------------------*    @TEC
* REGISTER USAGE                                              *    @TEC
*  0  -                                                       *    @TEC
*  1  - CTLBLK BASE:UCB                                       *    @TEC
*  2  - XSA BASE ADDRESS                                      *    @TEC
*  3  - WORK REGISTER                                         *    @TEC
*  4  - CTLBLK BASE:CVT,ASVT,ASCB,PVT,PFTE                    *    @TEC
*  5  - CTLBLK BASE:ASCB                                      *    @TEC
*  6  - OFFSET WITHIN UCBTAB                                  *    @TEC
*  7  - PROGRAM BASE 2                                        *    @TEC
*  8  - JOBTABLE BASE ADDRESS                                 *    @TEC
*  9  - CTLBLK BASE:OUCB                                      *    @TEC
*  10 - SUBROUTINE LINKAGE                                    *    @TEC
*  11 - SUBROUTINE LINKAGE                                    *    @TEC
*  12 - PROGRAM BASE 1                                        *    @TEC
*  13 - WORKING STORAGE BASE ADDRESS                          *    @TEC
*  14 -                                                       *    @TEC
*  15 -                                                       *    @TEC
*-------------------------------------------------------------*    @TEC
CSCGA03D CSECT
         LR    R12,R15
         LA    R7,4095(0,R12)
         LA    R7,1(0,R7)
         USING CSCGA03D,R12,R7
*        MODESET KEY=ZERO,MODE=SUP
         L     R0,SIZE                 LOAD SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET              SAVE RETURN ADDR
         ST    R2,XSASAVE              SAVE XSA ADDR
         USING XSA,R2
*-------------------------------------------------------------*    @TEC
* SET 31-BIT ADDRESSING                                       *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R9,AMODE31                                          @TEC
         BSM   0,R9                                                @TEC
AMODE31  DC    A(CONT31+X'80000000')                               @TEC
CONT31   DS    0H                                                  @TEC
         L     R3,XAL
         LA    R3,0(0,R3)
         L     R8,XAA                  ASCB/OUCB INFO STORAGE
         ST    R8,ACTSTORG
         USING JOBTABLE,R8
         MVC   JOBASID(2),=H'1'        FORCE MASTER AS DEFAULT
         LTR   R3,R3                   ANY PARM
         BZ    ESTAESET                NO
         SR    R0,R0
         SR    R1,R1
         LA    R5,4                    SAVE DESIRED LENGTH IN R5
PARMCVT0 CLI   0(R3),C' '              THEN WE AREA DONE
         BE    ESTAESET                WRONG NUMBER OF CHAR
         CLI   0(R3),C'A'              NOW CHECK FOR HEX CHARACTERS
         BL    ESTAESET
         CLI   0(R3),C'F'
         BH    PARMCVT1                NOW TRY NUMBERICS
         NI    0(R3),X'0F'             TURN OFF ZONE
         IC    R0,0(R3)                GET THE CHARACTER
         AH    R0,=H'9'                AND ADJUST TO PROPER VALUE
         B     PARMCVT2
         SPACE 1
PARMCVT1 CLI   0(R3),C'0'              NOW SEE IF NUMERIC
         BL    ESTAESET                IF NOT THEN ERROR
         CLI   0(R3),C'9'              AND TRY HIGH VALUE
         BH    ESTAESET
         NI    0(R3),X'0F'             TURN OFF ZONE
         IC    R0,0(R3)                GET DIGIT
         SPACE 1
PARMCVT2 SLL   R1,4                    CLEAR AREA
         OR    R1,R0                   PUT IN NEW DIGIT
         LA    R3,1(R3)                POINT PAST
         BCT   R5,PARMCVT0             TRY AGAIN TILL EMPTY
         B     PARMCVTX                ALL DONE AND HAD EXPECTED
*                                  NUMBER OF CHARS
         SPACE 1
PARMCVTX STH   R1,JOBASID
         SPACE 1
ESTAESET LR    R10,R13                 LOAD SAVE AREA ADDR
         B     ESTAEBYP                BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L         * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL              * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL  * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
CSCSTART DS    0H
*-------------------------------------------------------------*    @TEC
* CALCULATE AVERAGE TSO RESPONSE TIME                         *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R4,16                   CVT
         L     R4,604(0,R4)            RMCT
         MVC   WTOLIST(84),SRMOVLY
         L     R5,88(0,R4)             WAMT
         L     R1,THRTSOPG             TSO PERF GROUP NUMBER
         SLL   R1,2                    TIMES 4
         L     R6,88(R1,R5)            WAMP OFFSET                 @TEC
         AR    R5,R6                   WAMP ADDRESS
         SR    R14,R14
         L     R15,0(0,R5)             TOTAL ENDED TRANS
         LTR   R15,R15                 ZERO TRANS
         BZ    NOTSO                   YES, BYPASS 0C9
         L     R15,12(0,R5)            TOTAL ELAPSTM FOR ENDED TRANS
         D     R14,0(0,R5)             DIVIDE BY ENDED TRANSACTIONS
         SR    R14,R14
         D     R14,=F'1000'            DIVIDE BY 1000 FOR SECONDS
         SPACE 1
NOTSO    CVD   R15,DOUBLE              AVG SECONDS RESPONSE TIME
         SRDL  R14,32
         D     R14,=F'10'
         CVD   R15,DOUBLEX
         MVC   WTOLIST+8(7),=X'402021204B2020'
         ED    WTOLIST+8(4),DOUBLE+6
         UNPK  WTOLIST+13(2),DOUBLEX+6(2)
         OI    WTOLIST+14,X'F0'
*-------------------------------------------------------------*    @TEC
* GET LONG TERM CPU BUSY PERCENT                              *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R1,4(0,R4)              CCT                         @TEC
         LH    R1,104(0,R1)            LONG TERM CPU UTIL          @TEC
         SRL   R1,8                    SCALED BY 256?              @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+25(4),=X'40212020'
         ED    WTOLIST+25(4),DOUBLE+6
*-------------------------------------------------------------*    @TEC
* GET CURRENT CPU BUSY PERCENT                                *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R1,4(0,R4)              CCT                         @TEC
         LH    R1,102(0,R1)            AVERAGE CPU                 @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+38(4),=X'40212020'
         ED    WTOLIST+38(4),DOUBLE+6
*-------------------------------------------------------------*    @TEC
* GET PAGING RATE                                             *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R1,228(0,R4)            RCT                         @TEC
         LH    R1,64(0,R1)             AVERAGE PAGING              @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+51(4),=X'40212020'
         ED    WTOLIST+51(4),DOUBLE+6
*-------------------------------------------------------------*    @TEC
* GET AVERAGE UNREFERENCED INTERVAL COUNT                     *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R1,228(0,R4)            RCT                         @TEC
         LH    R1,54(0,R1)             AVERAGE UIC                 @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+65(4),=X'40212020'
         ED    WTOLIST+65(4),DOUBLE+6
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  MCS ID OF REQUESTING CONSOLE
         SVC   35
         MVI   WTOLIST+4,C' '
         MVC   WTOLIST+5(79),WTOLIST+4
         MVC   WTOLIST(4),=X'00540100'
         L     R3,THRSTIMR             PICK UP NUMBER OF INTERVALS
         BAL   R10,CHKUCB              (RE)INITIALIZE UCB INFO
         BAL   R10,CHKLOOP             SAMPLE UCBS.
         L     R8,XAA                  ASCB/OUCB INFO STORAGE
JOBOUT   L     R4,16                   CVT ADDR
         L     R4,556(0,R4)            ASVT ADDR
         LA    R4,524(0,R4)            ASCB SLOT ADDR
         LH    R5,JOBASID
         SLL   R5,2
         AR    R4,R5                   ASCB SLOT ADDR
         L     R5,0(0,R4)              ASCB ADDR
         LA    R5,0(0,R5)
         L     R6,56(0,R5)             CSCB ADDR
         XC    SAVETIM1(16),SAVETIM1
         BAL   R11,CSCBFORM            GET STEP NAME
         CLC   JOBSTEP(8),=XL8'00'     1ST PASS
         BE    *+14                    YES
         CLC   JOBSTEP(8),ACTSNAME     STEPNAME MATCH
         BE    *+10                    YES
         XC    JOBFLAG(90),JOBFLAG     RESET COUNTERS
         MVC   JOBSTEP(8),ACTSNAME
         L     R9,144(0,R5)            LOAD OUCB ADDR
         BAL   R11,ASCBFORM            GO FORMAT ASCB INFO
         CLI   WJOB1,C' '              ANY OUTPUT
         BE    JOBOUT1                 NO
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   WTOLIST+4,C' '
         MVC   WTOLIST+5(79),WTOLIST+4
         SPACE 1
JOBOUT1  CLI   WAITSW,X'00'            JOB WAITING
         BNE   RETURN                  YES, NO I/O DISPLAY
         CLC   SAVETIM1(16),=XL16'00'  1ST PASS
         BE    RETURN                  YES, NO I/O DISPLAY
         LA    R1,SEPRMSG
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         BAL   R10,CHKUCB6             GO FORMAT JOB I/O
         B     RETURN
         SPACE 2
*-------------------------------------------------------------*    @TEC
* FORMAT ASCB/OUCB INFO                                       *    @TEC
*-------------------------------------------------------------*    @TEC
ASCBFORM L     R8,XAA                  JOBTABLE ADDR
         LA    R1,=CL8'*MASTER*'
         CLC   36(2,R5),=H'1'          MASTER SCHEDULER
         BE    ASCBFRM1                YES
         L     R1,172(0,R5)            JOBNAME POINTER
         LTR   R1,R1                   ZERO
         BNZ   ASCBFRM1                NO
         L     R1,176(0,R5)            STC/TSU NAME POINTER
         LTR   R1,R1                   ZERO
         BNZ   ASCBFRM1                NO
         LA    R1,=CL8'*UNKNWN*'
         B     ASCBFRM1                NO
         SPACE 1
ASCBFRM0 XC    JOBFLAG(90),JOBFLAG     CLEAR COUNTERS
         B     ASCBFRM2
         SPACE 1
ASCBFRM1 CLC   JOBNAME(8),0(R1)        JOB/STC/TSU NAME MATCH
         BE    ASCBFRM2                YES
         MVC   JOBNAME(8),0(R1)        JOB/STC/TSU NAME
         MVC   JOBASID(2),36(R5)       JOB/STC/TSU ASID
         XC    JOBFLAG(90),JOBFLAG     CLEAR COUNTERS
ASCBFRM2 XC    ACTCPU(8),ACTCPU        CLEAR CPU UTIL FIELDS
         MVI   WAITSW,X'00'            INDICATE JOB NOT WAITING
         SR    R15,R15
         L     R15,320(0,R5)           EXCP COUNT                  @TEC
         A     R15,64(0,R9)            OUCB EXCP COUNT             @TEC
         ST    R15,JOBSIOCT            SIO PER SEC
         LM    R14,R15,64(R5)          TCB TIME
         SRDL  R14,22
         LR    R1,R15
         LM    R14,R15,200(R5)         SRB TIME
         SRDL  R14,22
         AR    R1,R15
         C     R1,JOBINTT              COMPARE PREVIOUS CPU TIME
         BNE   *+8                     JOB NOT WAITING
         MVI   WAITSW,X'FF'            INDICATE JOB WAITING
         BL    ASCBFRM0                CURRENT LOWER,  STEP CHANGE
         L     R15,JOBINTT             LOAD PREVIOUS CPU TIME
         LTR   R15,R15                 ANY PREVIOUS
         BNZ   *+8                     YES
         ST    R1,JOBINTT              PREVIOUS = CURRENT
         LR    R15,R1
         S     R15,JOBINTT             SUB PREVIOUS CPU TIME
         ST    R1,JOBINTT              PREVIOUS = CURRENT
         ST    R15,SAVETIM3            SAVE DIFFERENCE
         C     R1,JOBTIME              COMPARE PREVIOUS CPU TIME
         BNE   *+8                     JOB NOT WAITING
         MVI   WAITSW,X'FF'            INDICATE JOB WAITING
         BL    ASCBFRM0                CURRENT LOWER,  STEP CHANGE
         C     R1,JOBCPUT              COMPARE PREVIOUS CPU TIME
         BL    ASCBFRM0                CURRENT LOWER,  STEP CHANGE
         L     R15,JOBCPUT             LOAD PREVIOUS CPU TIME
         LTR   R15,R15                 ANY PREVIOUS
         BNZ   *+8                     YES
         ST    R1,JOBCPUT              PREVIOUS = CURRENT
         L     R15,JOBTIME             LOAD PREVIOUS CPU TIME
         LTR   R15,R15                 ANY PREVIOUS
         BNZ   *+8                     YES
         ST    R1,JOBTIME              PREVIOUS = CURRENT
         LR    R15,R1
         S     R15,JOBCPUT             SUB PREVIOUS CPU TIME
         S     R1,JOBTIME              SUB PREVIOUS CPU TIME
         ST    R15,SAVETIM1            SAVE DIFFERENCE
         ST    R1,SAVETIM2             SAVE DIFFERENCE
         TIME  BIN
         L     R1,JOBINTL              OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,JOBINTL              OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,JOBINTL              INTERVAL TIME
         ST    R0,JOBINTL              OLD TIME = NEW TIME
         LTR   R1,R1                   TIME EQUAL 0
         BZ    ASCBFRMA                ZERO, NO DIVIDE 0C9
         BM    ASCBFRM0                NEGATIVE, CLEAR COUNTERS
         L     R15,SAVETIM3            LOAD DIFFERENCE
         LTR   R15,R15                 NEGATIVE
         BM    ASCBFRM0                YES
         SR    R14,R14
         M     R14,=F'10'              PERCENT
         SR    R14,R14
         DR    R14,R1                  PERCENT UTIL
         ST    R15,ACTCPU              SAVE CPU UTIL
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R1                  PERCENT UTIL  (HUNDREDTHS)
         ST    R15,ACTCPUH             SAVE CPU UTIL (HUNDREDTHS)
ASCBFRMA BAL   R10,ACTIVE              GO FORMAT JOB ACTIVITY LINES
         BAL   R10,CHKABN              CHECK FOR JOBS ABENDING
         BAL   R10,CHKFRM              CHECK FOR JOBS WITH HIGH FRAMES
         BAL   R10,CHKSWP              CHECK FOR JOBS WITH SWAP COUNTS
         TIME  BIN
         L     R1,JOBCPUL              OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,JOBCPUL              OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,JOBCPUL              INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BE    ASCBFRMB                YES
         BM    ASCBFRM0                NEGATIVE, CLEAR COUNTERS
         L     R15,SAVETIM1            LOAD DIFFERENCE
         LTR   R15,R15                 NEGATIVE
         BM    ASCBFRM0                YES
         SR    R14,R14
         M     R14,=F'10'              PERCENT
         SR    R14,R14
         DR    R14,R1                  PERCENT UTIL
         BAL   R10,CHKCPU              CHECK JOB CPU UTILIZATION LIMIT
ASCBFRMB CLI   WAITSW,X'00'            WAIT????
         BNE   ASCBFRM4                YES
         XC    JOBWAIT(4),JOBWAIT      CLEAR WAIT COUNTER
         XC    SAVETIM4(4),SAVETIM4
         TIME  BIN                     POTENTIAL LOOP
         L     R1,JOBLOOP              OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,JOBLOOP              OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,JOBLOOP              INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BCR   8,R11                   YES, NO LOOP YET
         BM    ASCBFRM0                NEGATIVE, CLEAR COUNTERS
         L     R15,SAVETIM2            LOAD DIFFERENCE
         LTR   R15,R15                 NEGATIVE
         BM    ASCBFRM0                YES
         SR    R14,R14
         M     R14,=F'10'              PERCENT
         SR    R14,R14
         DR    R14,R1                  PERCENT UTIL
         C     R15,THRLOOPP            OVER CPU PERCENT THRESHOLD
         BNL   *+18                    YES
         XC    JOBLOOP(4),JOBLOOP      CLEAR LOOP COUNTER
         XC    JOBTIME(4),JOBTIME      CLEAR CPUTIME FIELD
         BR    R11
         LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             LOOP SECONDS
         CVD   R15,DOUBLE
         C     R15,THRLOOPT            OVER LOOP THRESHOLD
         BCR   4,R11                   NO
         CLC   36(2,R5),=H'1'          MASTER SCHEDULER
         BCR   8,R11                   YES, NO LOOP CHECK
         CLC   172(4,R5),=F'0'         JOB OR STC/TSU
         BNE   *+10                    JOB
         CLI   28(R6),X'01'            TSU OR STC
         BCR   7,R11                   STC
         L     R1,108(0,R9)            EXCP COUNT
         L     R15,JOBEXCP             PREVIOUS EXCP COUNT
         ST    R1,JOBEXCP              SAVE PREVIOUS EXCP COUNT
         CR    R1,R15                  COMPARE CURRENT TO PREVIOUS
         BL    ASCBFRM0                CURRENT LOWER,  STEP CHANGE
         BE    ASCBFRMC                NO EXCPS, POSSIBLE LOOP
         XC    JOBLOOP(4),JOBLOOP      CLEAR LOOP COUNTER
         XC    JOBTIME(4),JOBTIME      CLEAR CPUTIME FIELD
         BR    R11
         SPACE 1
ASCBFRMC CLI   WJOB1,C' '              1ST PASS
         BNE   ASCBFRM3                NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28'POSSIBLE LOOP FOR XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLE+5
         BR    R11
ASCBFRM3 MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28'POSSIBLE LOOP FOR XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R11
         SPACE 1
ASCBFRM4 CLI   WJOB1,C' '              ANY OUTPUT
         BE    ASCBFRMD                NO
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   WTOLIST+4,C' '
         MVC   WTOLIST+5(79),WTOLIST+4
         SPACE 1
ASCBFRMD LA    R1,WAITMSG
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         TIME  BIN
         L     R1,JOBWAIT              OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,JOBWAIT              OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,JOBWAIT              INTERVAL TIME
         XC    JOBLOOP(4),JOBLOOP      CLEAR LOOP COUNTER
         XC    JOBCPUT(4),JOBCPUT      CLEAR CPU TIME ACCUM
         XC    JOBCPUL(4),JOBCPUL      CLEAR ELAPSED TIME ACCUM
         LTR   R1,R1                   TIME EQUAL 0
         BCR   8,R11                   YES, NO WAIT YET
         BM    ASCBFRM0                NEGATIVE, CLEAR COUNTERS
         LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             WAIT SECONDS
         CVD   R15,DOUBLE
         ST    R15,CURRWAIT
         LA    R3,WMSG1
         CLI   WJOB1,C' '              1ST PASS
         BE    ASCBFRM5                YES
         LA    R3,WMSG2
ASCBFRM5 MVC   0(12,R3),=CL12' '
         BAL   R10,CHKENQ              CHECK ENQ OUTSTANDING
         CLI   0(R3),C' '              ANY ENQS FOR THIS JOB
         BNE   ASCBFRM6                YES
         BAL   R10,CHKALC              CHECK ALLOCATION QUEUE
         CLI   0(R3),C' '              ANY ALLOC PENDING FOR THIS JOB
         BNE   ASCBFRM6                YES
         BAL   R10,CHKQIO              CHECK I/O OUTSTANDING
         CLI   0(R3),C' '              ANY I/O FOR THIS JOB
         BNE   ASCBFRM6                YES
         BAL   R10,CHKREP              CHECK REPLY OUTSTANDING
         CLI   0(R3),C' '              ANY REPLIES FOR THIS JOB
         BNE   ASCBFRM6                YES
         L     R1,CURRWAIT             CURRENT WAIT TIME
         C     R1,THRSWPWT             OVER SWAP WAIT THRESHOLD
         BCR   4,R11                   NO
         CLC   172(4,R5),=F'0'         JOB OR STC/TSU
         BNE   *+10                    JOB
         CLI   28(R6),X'01'            TSU OR STC
         BCR   7,R11                   STC OR INIT
         BAL   R10,CHKSRC              CHECK SWAP REASON CODE
         CLI   0(R3),C'*'              EXCLUDED SRC
         BNE   *+10                    NO
         MVI   0(R3),C' '
         BR    R11
         CLI   0(R3),C' '              ANY SRC FOR THIS JOB
         BNE   ASCBFRM6                YES
         MVC   0(12,R3),=12C'?'
         SPACE 1
ASCBFRM6 CLI   WJOB1,C' '              1ST TIME
         BNE   ASCBFRM7                NO, 2ND PASS
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1+12(16),=CL16' WAIT XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLE+5
         BR    R11
         SPACE 1
ASCBFRM7 MVC   WJOB2(8),JOBNAME
         MVC   WMSG2+12(16),=CL16' WAIT XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R11
CHKCPU   STM   R0,R15,SAVEREGS
         CVD   R15,DOUBLE
         C     R15,THRCPULP            OVER CPU PERCENT THRESHOLD
         BL    CHKCPU2                 NO
         LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             LOOP SECONDS
         CVD   R15,DOUBLEX
         C     R15,THRCPULT            OVER CPU THRESHOLD
         BL    CHKCPU3                 NO
         CLI   WJOB1,C' '              1ST PASS
         BNE   CHKCPU1                 NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28'   XXX% CPU FOR   XXXXX SEC'
         MVC   WMSG1+2(4),=X'40202120'
         ED    WMSG1+2(4),DOUBLE+6
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLEX+5
         B     CHKCPU3
         SPACE 1
CHKCPU1  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28'   XXX% CPU FOR   XXXXX SEC'
         MVC   WMSG2+2(4),=X'40202120'
         ED    WMSG2+2(4),DOUBLE+6
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLEX+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         B     CHKCPU3
         SPACE 1
CHKCPU2  XC    JOBCPUL(4),JOBCPUL
         XC    JOBCPUT(4),JOBCPUT
         SPACE 1
CHKCPU3  LM    R0,R15,SAVEREGS
         BR    R10
CHKLOOP  STIMER  WAIT,DINTVL=THRINTVL
         LR    R4,R10
         BAL   R10,CHKUCB1
         LR    R10,R4
         BCT   R3,CHKLOOP
         BR    R10
CHKUCB   STM   R0,R15,SAVEREGS
         MVC   UCBTABND(2),=X'FFFF'
         LA    R6,UCBTAB-20
         SPACE 1
CHKUCB0  LA    R6,20(0,R6)
         CLC   0(2,R6),=X'FFFF'        END OF TABLE
         BE    CHKUCB9                 YES
         CLI   0(R6),X'00'             REFERENCED LAST PASS        @TEC
         BNE   *+16                    YES
         XC    0(8,R6),0(R6)
         XC    16(4,R6),16(R6)
         MVI   0(R6),X'00'                                         @TEC
         XC    8(8,R6),8(R6)
         B     CHKUCB0
         SPACE 1
CHKUCB1  XC    UCBDMSAV(24),UCBDMSAV
         STM   R0,R15,SAVEREGS
         L     R9,CVTPTR               CVT ADDR                    @TEC
         L     R9,CVTUCBSC-CVTMAP(R9)  LOOKUP ROUTINE ADDRESS      @TEC
         XC    WKAREA(100),WKAREA      CLEAR WORK AREA             @TEC
         LA    R1,WKAREA               SETUP PARAMETER LIST        @TEC
         ST    R1,PLIST                                            @TEC
         LA    R1,=X'20'               SPECIFY DASD                @TEC
         ST    R1,PLIST+4                                          @TEC
         LA    R1,ADDR                 WORD TO PUT ADDRESS OF UCB  @TEC
         ST    R1,PLIST+8                                          @TEC
         OI    PLIST+8,X'80'           31 BIT PARM END SET         @TEC
         SPACE 1
CHKUCB1A BAL   R10,UCBDML#0            GET NEXT UCB ADDR
         LTR   R1,R1                   END OF UCBS
         BZ    CHKUCB9                 YES, EXIT
         TM    3(R1),X'88'             ONLINE/ALLOCATED
         BNO   CHKUCB1A                NO
         CLI   18(R1),X'20'            DASD
         BE    *+18                    YES
         L     R14,20(0,R1)            UCB EXTENSION
         CLC   JOBASID(2),14(R14)      ASID MATCH
         BNE   CHKUCB1A                NO
         LA    R1,0(0,R1)
         LR    R14,R1
         S     R14,=F'4'
         L     R14,0(0,R14)            IOQ ADDR
         LA    R14,0(0,R14)
         LTR   R14,R14                 ZERO
         BZ    CHKUCB1A                YES
         L     R15,8(0,R14)            IOSB ADDR
         LA    R15,0(0,R15)
         LTR   R15,R15                 ZERO
         BZ    CHKUCB1A                YES
         LA    R6,UCBTAB-20
         MVC   SAVEBUSY(4),=F'0'
         CLC   JOBASID(2),28(R14)      ASID MATCH                  @TEC
         BNE   CHKUCB2                 NO
         CLC   JOBASID(2),6(R15)       ASID MATCH
         BNE   CHKUCB2                 NO
         MVC   SAVEBUSY(4),=F'1'
         SPACE 1
CHKUCB2  LA    R6,20(0,R6)             NEXT UCB ENTRY
         CLC   0(2,R6),=X'FFFF'        END OF UCB TABLE
         BE    CHKUCB3                 YES, CHECK FOR EMPTY SLOT
         CLM   R1,7,1(R6)              UCB ADDR MATCH              @TEC
         BNE   CHKUCB2                 NO
         B     CHKUCB5
         SPACE 1
CHKUCB3  LA    R6,UCBTAB-20
         SPACE 1
CHKUCB4  LA    R6,20(0,R6)             NEXT UCB ENTRY
         CLC   0(2,R6),=X'FFFF'        END OF UCB TABLE
         BE    CHKUCB1A                YES, NEXT UCB
         CLC   0(2,R6),=X'0000'        EMPTY SLOT
         BNE   CHKUCB4                 NO, NEXT ENTRY
         SPACE 1
CHKUCB5  STCM  R1,7,1(R6)              SAVE UCB ADDR               @TEC
         MVI   0(R6),X'FF'             SLOT IN USE                 @TEC
         L     R1,8(0,R6)
         LA    R1,1(0,R1)
         ST    R1,8(0,R6)              DEVICE BUSY
         L     R1,12(0,R6)
         A     R1,SAVEBUSY
         ST    R1,12(0,R6)             DEVICE BUSY THIS JOB
         B     CHKUCB1A
CHKUCB6  STM   R0,R15,SAVEREGS
         LA    R6,UCBTAB-20
         SPACE 1
CHKUCB7  LA    R6,20(0,R6)
         CLC   0(2,R6),=X'FFFF'        END OF UCB TABLE
         BE    CHKUCB9                 YES, EXIT
         SR    R1,R1
         ICM   R1,7,1(R6)              UCB ADDR                    @TEC
         LA    R3,UCBNRDY
         LA    R4,THRUCBNR
         TM    6(R1),X'40'             NOT READY
         BO    CHKUCB7A
         LA    R3,UCBBUSY
         LA    R4,THRUCBBS
         SR    R14,R14
         L     R15,8(0,R6)             UCB BUSY COUNT
         XC    8(4,R6),8(R6)
         M     R14,=F'100'
         D     R14,THRSTIMR            PERCENT BUSY
         LH    R1,16(0,R6)             CUMULATIVE PERCENT
         LTR   R1,R1                   ZERO
         BNZ   *+6                     NO
         LR    R1,R15                  FAKE START
         MH    R1,=H'3'                3/4 PREVIOUS
         AR    R1,R15                  1/4 CURRENT
         SRL   R1,2
         STH   R1,16(0,R6)             NEW CUM PERCENT
         SR    R14,R14
         L     R15,12(0,R6)            UCB BUSY COUNT
         XC    12(4,R6),12(R6)
         M     R14,=F'100'
         D     R14,THRSTIMR            PERCENT BUSY
         LH    R1,18(0,R6)             CUMULATIVE PERCENT
         LTR   R1,R1                   ZERO
         BNZ   *+6                     NO
         LR    R1,R15                  FAKE START
         MH    R1,=H'3'                3/4 PREVIOUS
         AR    R1,R15                  1/4 CURRENT
         SRL   R1,2
         STH   R1,18(0,R6)             NEW CUM PERCENT
         C     R1,THRUCBLM             THRESHOLD REACHED
         BL    CHKUCB7B                NO
         SPACE 1
CHKUCB7A TIME  BIN
         L     R1,4(0,R6)              OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,4(0,R6)              OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,4(0,R6)              INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BZ    CHKUCB7                 YES
         BP    CHKUCB8
         SPACE 1
CHKUCB7B XC    4(16,R6),4(R6)
         B     CHKUCB7
CHKUCB8  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             SECONDS
         LH    R1,16(0,R6)
         CVD   R1,DOUBLEY
         LH    R1,18(0,R6)
         CVD   R1,DOUBLE
         CVD   R15,DOUBLEX
         C     R15,0(0,R4)             TIME THRESHOLD REACHED
         BL    CHKUCB7                 NO
         CLI   WJOB1,C' '              1ST PASS
         BNE   CHKUCB8A                NO, 2ND HALF
         MVC   WJOB1(38),0(R3)
         SR    R1,R1
         ICM   R1,7,1(R6)              UCB ADDR                    @TEC
         MVC   WJOB1(3),13(R1)         DEVICE ADDRESS
         MVC   WJOB1+4(6),=6C' '
         TM    18(R1),X'A0'            TAPE OR DASD
         BZ    *+10                    NO
         MVC   WJOB1+4(6),28(R1)       DEVICE VOLSER
         MVC   WJOB1+27(6),=X'402020202120'
         ED    WJOB1+27(6),DOUBLEX+5
         LA    R1,UCBNRDY
         CR    R1,R3                   NOT READY MESSAGE
         BE    CHKUCB7                 YES, NO PERCENT
         MVC   WJOB1+11(4),=X'40202120'
         ED    WJOB1+11(4),DOUBLEY+6
         MVC   WJOB1+17(4),=X'40202120'
         ED    WJOB1+17(4),DOUBLE+6
         CLI   WJOB1+12,C' '
         BE    *+12
         MVI   WJOB1+11,C'('
         B     CHKUCB7
         CLI   WJOB1+13,C' '
         BE    *+12
         MVI   WJOB1+12,C'('
         B     CHKUCB7
         MVI   WJOB1+13,C'('
         B     CHKUCB7
         SPACE 1
CHKUCB8A MVC   WJOB2(38),0(R3)
         SR    R1,R1
         ICM   R1,7,1(R6)              UCB ADDR                    @TEC
         MVC   WJOB2(3),13(R1)         DEVICE ADDRESS
         MVC   WJOB2+4(6),=6C' '
         TM    18(R1),X'A0'            TAPE OR DASD
         BZ    *+10                    NO
         MVC   WJOB2+4(6),28(R1)       DEVICE VOLSER
         MVC   WJOB2+27(6),=X'402020202120'
         ED    WJOB2+27(6),DOUBLEX+5
         LA    R1,UCBNRDY
         CR    R1,R3                   NOT READY MESSAGE
         BE    CHKUCB8B                YES, NO PERCENT
         MVC   WJOB2+11(4),=X'40202120'
         ED    WJOB2+11(4),DOUBLEY+6
         MVC   WJOB2+17(4),=X'40202120'
         ED    WJOB2+17(4),DOUBLE+6
         CLI   WJOB2+12,C' '
         BE    *+12
         MVI   WJOB2+11,C'('
         B     CHKUCB8B
         CLI   WJOB2+13,C' '
         BE    *+12
         MVI   WJOB2+12,C'('
         B     CHKUCB8B
         MVI   WJOB2+13,C'('
         SPACE 1
CHKUCB8B LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         B     CHKUCB7
         SPACE 1
CHKUCB9  LM    R0,R15,SAVEREGS
         BR    R10
CHKABN   L     R1,16                   CVT
         L     R1,640(0,R1)            FIRST VALID MAJOR QCB
         B     CHKABN1+4               1ST MAJOR PROCESS
         SPACE 1
CHKABN1  L     R1,0(0,R1)              NEXT MAJOR
         LTR   R1,R1                   EXIST
         BCR   8,R10                   NO, END OF QCBS
         CLC   16(8,R1),=CL8'SYSIEA01'  ABEND QCB
         BNE   CHKABN1                 NO, NEXT MAJOR
         L     R14,8(0,R1)             1ST MINOR
         LTR   R14,R14                 EXIST
         BCR   8,R10                   NO
         B     CHKABN3
         SPACE 1
CHKABN2  L     R14,0(0,R14)            NEXT MINOR QCB
         LTR   R14,R14                 EXIST
         BCR   8,R10                   NO
         SPACE 1
CHKABN3  L     R15,8(0,R14)            1ST QEL
         SPACE 1
CHKABN4  LTR   R15,R15                 EXIST
         BZ    CHKABN2                 NO
         CLC   JOBASID(2),14(R15)      ASID MATCH
         BE    CHKABN5                 YES, JOB ABENDING
         L     R15,0(0,R15)            NEXT QEL
         LA    R15,0(0,R15)
         LTR   R15,R15                 EXIST
         BZ    CHKABN2                 NO
         B     CHKABN4
         SPACE 1
CHKABN5  TIME  BIN
         L     R1,JOBABEND             OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,JOBABEND             OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,JOBABEND             INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BCR   8,R10                   YES
         BP    CHKABN7
         SPACE 1
CHKABN6  XC    JOBABEND(4),JOBABEND
         BR    R10
         SPACE 1
CHKABN7  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             SECONDS
         CVD   R15,DOUBLEX
         C     R15,THRABEND            TIME THRESHOLD REACHED
         BCR   4,R10                   NO
         CLI   WJOB1,C' '              1ST PASS
         BNE   CHKABN8                 NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28'ABEND IN PROGRESS XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLEX+5
         BR    R10
         SPACE 1
CHKABN8  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28'ABEND IN PROGRESS XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLEX+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R10
CHKREP   L     R1,CURRWAIT             CURRENT WAIT TIME
         C     R1,THRREPWT             OVER REPLY WAIT THRESHOLD
         BCR   4,R10                   NO
         L     R1,16                   CVT
         L     R1,100(0,R1)            UCM BASE
         L     R1,28(0,R1)             1ST ORE
         LA    R1,0(0,R1)
         SPACE 1
CHKREP1  LTR   R1,R1                   ANY OUTSTANDING REPLIES
         BCR   8,R10                   NO
         CLC   JOBASID(2),24(R1)       ASID MATCH
         BE    CHKREP2                 YES
         L     R1,0(0,R1)              NEXT ORE
         LA    R1,0(0,R1)
         B     CHKREP1
         SPACE 1
CHKREP2  MVC   0(12,R3),=CL12'REPLY '
         MVC   7(2,R3),4(R1)           REPLY ID
         BR    R10
         SPACE 5
CHKSRC   LA    R1,SRCTAB
         SR    R15,R15
         IC    R15,41(0,R9)            SWAP REASON CODE
         CH    R15,=H'13'              MAX SWAP REASON CODE
         BCR   2,R10                   OVER MAX
         MH    R15,=H'12'
         LA    R1,0(R15,R1)            SWAP REASON CODE OUTPUT
         MVC   0(12,R3),0(R1)
         BR    R10
CHKFRM   L     R1,16                   LOAD CVT ADDR
         L     R1,356(0,R1)            LOAD PVT ADDR
         L     R1,8(0,R1)              LOAD RIT ADDR               @TEC
         L     R15,0(0,R1)             LOAD 1ST PFTE ADDR          @TEC
         L     R14,4(0,R1)             LOAD LAST PFTE ADDR         @TEC
         SR    R14,R15                 GET DIFFERENCE              @TEC
         SRL   R14,5                   NUMBER OF PFTE'S            @TEC
         SR    R1,R1                   CLEAR FRAME COUNT
         SPACE 1
CHKFRM1  CLC   0(2,R15),JOBASID        ASID MATCH
         BNE   CHKFRM2                 NO
         LA    R1,1(0,R1)              ADD 1 TO FRAME COUNT
         SPACE 1
CHKFRM2  LA    R15,32(0,R15)           NEXT PFT                    @TEC
         BCT   R14,CHKFRM1             PROCESS NEXT
         L     R15,JOBFRCNT            JOB FRAME COUNT  (WEIGHTED AVG)
         XC    JOBFRCNT(4),JOBFRCNT
         C     R1,THRFRAME             THRESHOLD REACHED
         BL    CHKFRM3                 NO
         LTR   R15,R15                 ZERO
         BNZ   *+6                     NO
         LR    R15,R1                  FAKE START
         MH    R15,=H'3'               3/4 PREVIOUS
         AR    R1,R15                  1/4 CURRENT
         SRL   R1,2
         ST    R1,JOBFRCNT
         CVD   R1,DOUBLE
         TIME  BIN
         L     R1,JOBFRAME             OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,JOBFRAME             OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,JOBFRAME             INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BCR   8,R10                   YES
         BP    CHKFRM4
         SPACE 1
CHKFRM3  XC    JOBFRAME(4),JOBFRAME
         BR    R10
CHKFRM4  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             SECONDS
         CVD   R15,DOUBLEX
         C     R15,THRFRMTM            FRAME USE TIME THRESHOLD?
         BCR   4,R10                   NO
         CLI   WJOB1,C' '              1ST PASS
         BNE   CHKFRM5                 NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28' XXXXX FRAMES FOR XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLEX+5
         MVC   WMSG1(6),=X'402020202120'
         ED    WMSG1(6),DOUBLE+5
         BR    R10
         SPACE 1
CHKFRM5  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28' XXXXX FRAMES FOR XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLEX+5
         MVC   WMSG2(6),=X'402020202120'
         ED    WMSG2(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R10
CHKSWP   CLC   36(2,R5),=H'1'          MASTER SCHEDULER
         BCR   8,R10                   YES, NO SWAP CHECK
         CLC   172(4,R5),=F'0'         JOB OR STC/TSU
         BCR   8,R10                   STC OR TSO
         LH    R1,42(0,R9)             SWAP COUNT
         CVD   R1,DOUBLE
         C     R1,THRSWAP              THRESHOLD REACHED
         BCR   4,R10
         SPACE 1
CHKSWP1  CLI   WJOB1,C' '              1ST PASS
         BNE   CHKSWP2                 NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28'CURRENT SWAP COUNT = XXXXX'
         MVC   WMSG1+20(6),=X'402020202120'
         ED    WMSG1+20(6),DOUBLE+5
         BR    R10
         SPACE 1
CHKSWP2  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28'CURRENT SWAP COUNT = XXXXX'
         MVC   WMSG2+20(6),=X'402020202120'
         ED    WMSG2+20(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R10
CHKENQ   L     R1,16                   CVT
         L     R1,640(0,R1)            FIRST VALID MAJOR QCB
         ST    R2,SAVEREGS
         B     CHKENQ1+4               1ST MAJOR PROCESS
         SPACE 1
CHKENQ1  L     R1,0(0,R1)              NEXT MAJOR
         LTR   R1,R1                   EXIST
         BZ    CHKENQ8                 NO, END OF QCBS
         MVC   MAJOR(8),16(R1)         SAVE MAJOR QCB
         L     R14,8(0,R1)             1ST MINOR
         LTR   R14,R14                 EXIST
         BZ    CHKENQ1                 NO
         B     CHKENQ3
         SPACE 1
CHKENQ2  L     R14,0(0,R14)            NEXT MINOR QCB
         LTR   R14,R14                 EXIST
         BZ    CHKENQ1                 NO
         SPACE 1
CHKENQ3  L     R15,8(0,R14)            1ST QEL
         SPACE 1
CHKENQ4  LTR   R15,R15                 EXIST
         BZ    CHKENQ2                 NO
         TM    12(R15),X'80'           SHARED
         BZ    CHKENQ5                 NO
         L     R15,0(0,R15)            NEXT QEL
         LA    R15,0(0,R15)
         B     CHKENQ4
         SPACE 1
CHKENQ5  C     R15,8(0,R14)            IS EXCL QEL THE 1ST QEL
         BNE   CHKENQ6                 NO
         L     R2,0(0,R15)             NEXT QEL
         LA    R2,0(0,R2)
         LTR   R2,R2                   EXIST
         BZ    CHKENQ2                 NO
         SPACE 1
CHKENQ6  L     R15,0(0,R15)            NEXT QEL
         LA    R15,0(0,R15)
         LTR   R15,R15                 EXIST
         BZ    CHKENQ2                 NO
         CLC   JOBASID(2),14(R15)      ASID MATCH
         BE    CHKENQ7                 YES, ENQ CONFLICT THIS JOB
         B     CHKENQ6
         SPACE 1
CHKENQ7  MVC   0(12,R3),=CL12'ENQ'
         MVC   4(8,R3),MAJOR
         SPACE 1
CHKENQ8  L     R2,SAVEREGS
         BR    R10
CHKALC   L     R1,CURRWAIT             CURRENT WAIT TIME
         C     R1,THRALCWT             OVER ALLOCATION WAIT THRESHOLD
         BCR   4,R10                   NO
         L     R1,16                   CVT
         L     R1,548(0,R1)            AQTOP
         L     R14,0(0,R1)             1ST QUEUE ELEMENT
         SPACE 1
CHKALC1  CR    R1,R14                  END OF CHAIN
         BCR   8,R10                   YES, NOT IN ALLOCATION
         SR    R15,R15
         LH    R15,22(0,R14)           ASID
         CH    R15,JOBASID             ASID MATCH
         BE    CHKALC2
         L     R14,0(0,R14)            NEXT QUEUE ELEMENT
         B     CHKALC1
         SPACE 1
CHKALC2  MVC   0(12,R3),=CL12'ALLOC QUEUE'
         BR    R10
CHKQIO   XC    UCBDMSAV(24),UCBDMSAV
         MVC   QIOASID(2),JOBASID      SAVE ASID
         STM   R0,R15,SAVEREGS
         L     R9,CVTPTR               CVT ADDR                    @TEC
         L     R9,CVTUCBSC-CVTMAP(R9)  LOOKUP ROUTINE ADDRESS      @TEC
         XC    WKAREA(100),WKAREA      CLEAR WORK AREA             @TEC
         LA    R1,WKAREA               SETUP PARAMETER LIST        @TEC
         ST    R1,PLIST                                            @TEC
         LA    R1,=X'20'               SPECIFY DASD                @TEC
         ST    R1,PLIST+4                                          @TEC
         LA    R1,ADDR                 WORD TO PUT ADDRESS OF UCB  @TEC
         ST    R1,PLIST+8                                          @TEC
         OI    PLIST+8,X'80'           31 BIT PARM END SET         @TEC
         SPACE 1
CHKQIO1  BAL   R10,UCBDML#0            GET NEXT UCB ADDR
         LTR   R1,R1                   END OF UCBS
         BZ    CHKQIO3                 YES, EXIT
         B     CHKQIO2
         SPACE 1
CHKQIO2  LR    R2,R1                   UCB ADDR
         LR    R4,R1                   UCB ADDR
         S     R4,=F'4'                DECR ADDR -4
         L     R4,0(0,R4)              IOQ ADDR
         LA    R4,0(0,R4)
         LTR   R4,R4                   ANY IOQ
         BZ    CHKQIO1                 NO, NEXT UCB
         L     R5,8(0,R4)              IOSB ADDR
         LA    R5,0(0,R5)
         LTR   R5,R5                   EXIST
         BZ    CHKQIO1                 NO, NEXT UCB
         B     CHKQIO9
         SPACE 1
CHKQIO3  L     R8,16                   CVT ADDR
         L     R8,140(0,R8)            LCH ADDR
         SPACE 1
CHKQIO4  CLC   16(4,R8),=F'0'          END OF LCH
         BE    CHKQIO8A                YES, EXIT
         CLC   0(4,R8),=X'FFFFFFFF'    IOQ ADDR EXIST
         BNE   CHKQIO6                 YES
         SPACE 1
CHKQIO5  LA    R8,32(0,R8)             NEXT LCH
         B     CHKQIO4
         SPACE 1
CHKQIO6  L     R4,0(0,R8)              1ST IOQ
         L     R6,4(0,R8)              LAST IOQ
         SPACE 1
CHKQIO7  L     R5,8(0,R4)              IOSB ADDR
         LA    R5,0(0,R5)
         LTR   R5,R5                   EXIST
         BZ    CHKQIO7A                NO
         L     R2,16(0,R5)             UCB ADDR
         CLC   QIOASID(2),6(R5)        ASID MATCH
         BE    CHKQIO8                 YES
         SPACE 1
CHKQIO7A CR    R4,R6                   END OF IOQS
         BE    CHKQIO5                 YES
         L     R4,0(0,R4)              NEXT IOQ
         B     CHKQIO7
         SPACE 1
CHKQIO8  MVC   0(12,R3),=CL12'I/O ON'
         MVC   8(3,R3),13(R2)
         SPACE 1
CHKQIO8A LM    R0,R15,SAVEREGS
         BR    R10
         SPACE 1
CHKQIO9  C     R2,16(0,R5)             UCB ADDR MATCH
         BNE   CHKQIO8A                NO, EXIT
         CLC   QIOASID(2),6(R5)        ASID MATCH
         BE    CHKQIO8                 YES
         B     CHKQIO1
UCBDML#0 DS    0H
         ST    R8,UCBDMSAV             SAVE WORK REG 1
         ST    R10,UCBDMSAV+8          SAVE WORK REG 3
         ST    R11,UCBDMSAV+12         SAVE WORK REG 4
UCBLOOP1 L     R9,CVTPTR               CVT ADDR                    @TEC
         L     R9,CVTUCBSC-CVTMAP(R9)  LOOKUP ROUTINE ADDRESS      @TEC
         LA    R1,PLIST                POINT AT PARM LIST          @TEC
         LR    R15,R9                  GET MODULE ADDRESS          @TEC
         BALR  R14,R15                 CALL MVS                    @TEC
         LTR   R15,R15                 UCB FOUND?                  @TEC
         BZ    UCBFND                  YES.                        @TEC
         SR    R1,R1                   SAY THAT'S ALL.             @TEC
         B     UCBDMCON                AND GO HOME.                @TEC
UCBFND   DS    0H
         L     R1,ADDR                 GET ADDR OF UCB             @TEC
         L     R8,UCBDMLOW             SET SEARCH ARGUMENT
         SPACE 1
UCBDML#1 LA    R8,1(0,R8)              NEXT UNIT ADDR POSSIBLE
         L     R10,=X'0000FFFF'        SET MAX NEXT LEAST HIGH
         SPACE 1
UCBDML#2 LTR   R1,R1                   MORE UCBS?                  @TEC
         BZ    UCBDMOUT                NO, GO PROCESS
         SPACE 1
UCBDML#4 TM    6(R1),X'8A'             BUSY AND/OR CHANNEL PROGRAM
*                                  ACTIVE
         BZ    UCBLOOP1                NO, NEXT UCB                @TEC
         TM    18(R1),X'20'            DASD?                       @TEC
         BZ    UCBLOOP1                NO. SKIP IT.                @TEC
         BAL   R11,UCBDMCNV            CONVERT UNIT ADDR TO HEX
         CR    R0,R8                   UNIT EQUAL                  @TEC
         BL    UCBLOOP1                LOW NOT EQUAL, NEXT UCB     @TEC
         LR    R10,R0                  SET NEXT LEAST HIGH UNIT AD @TEC
         ST    R1,UCBDMCUR             SET NEXT LEAST HIGH UCB ADD @TEC
         B     UCBDMOUT                GO PROCESS
UCBDMCNV SR    R14,R14
         SR    R15,R15
         IC    R15,13(0,R1)            UNIT ADDR DIGIT
         TM    13(R1),X'F0'            NUMERIC
         BO    *+8                     YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)            SET VALUE TO COVER A-F
         SLL   R15,28                  SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4                   INSERT INTO RESULTS REGISTER
         IC    R15,14(0,R1)            UNIT ADDR DIGIT
         TM    14(R1),X'F0'            NUMERIC
         BO    *+8                     YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)            SET VALUE TO COVER A-F
         SLL   R15,28                  SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4                   INSERT INTO RESULTS REGISTER
         IC    R15,15(0,R1)            UNIT ADDR DIGIT
         TM    15(R1),X'F0'            NUMERIC
         BO    *+8                     YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)            SET VALUE TO COVER A-F
         SLL   R15,28                  SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4                   INSERT INTO RESULTS REGISTER
         LR    R0,R14                  SET RESULTS REG             @TEC
         BR    R11
         SPACE 3
UCBDMOUT C     R10,=X'0000FFFF'        ALL DONE
         BE    UCBDMEX                 YES
         ST    R10,UCBDMLOW            NEXT LOW UNIT ADDR
         L     R1,UCBDMCUR             LOAD UCB ADDR FOR FOUND UNIT
         B     UCBDMCON                CONTINUE
         SPACE 1
UCBDMEX  SR    R1,R1                   CLEAR UCB ADDR REGISTER
         L     R8,UCBDMSAV             RELOAD WORK REG 1
         L     R10,UCBDMSAV+8          RELOAD WORK REG 3
         L     R11,UCBDMSAV+12         RELOAD WORK REG 4
         B     UCBDMRET                END OF UCBS
         SPACE 1
UCBDMCON L     R8,UCBDMSAV             RELOAD WORK REG 1
         L     R10,UCBDMSAV+8          RELOAD WORK REG 3
         L     R11,UCBDMSAV+12         RELOAD WORK REG 4
         SPACE 1
UCBDMRET EQU   *
         BR    R10
CSCBFORM CLI   28(R6),X'01'            TSO USER
         BE    CSCBFRM4                YES
         CLI   28(R6),X'03'            INIT
         BNE   CSCBFRM3                NO, GO HANDLE
         LA    R9,0(0,R6)              SAVE CSCB ADDR
         SR    R10,R10                 INSERT
         IC    R10,30(0,R6)
         SLL   R10,8                   ASID
         IC    R10,31(0,R6)
         SPACE 1
CSCBFRM1 L     R6,0(0,R6)              NEXT CSCB
         LA    R6,0(0,R6)              CLEAR HIGH ORDER
         LTR   R6,R6                   END OF CSCBS
         BNZ   *+10                    NO, CONTINUE
         LR    R6,R9                   LOAD CSCB ADDR
         B     CSCBFRM5                NO GOOD
         CR    R6,R9                   SAME CSCB
         BE    CSCBFRM5                YES, NO GOOD
         CH    R10,30(0,R6)            SAME ASID
         BNE   CSCBFRM1                NO, CHECK NEXT
         SPACE 1
CSCBFRM2 MVC   ACTSNAME(8),64(R6)      STEP NAME
         BR    R11
         SPACE 1
CSCBFRM3 MVC   ACTSNAME(8),8(R6)       STEP NAME
         BR    R11
         SPACE 1
CSCBFRM4 MVC   ACTSNAME(8),16(R6)
         BR    R11
         SPACE 1
CSCBFRM5 MVC   ACTSNAME(8),=CL8' '
         BR    R11
ACTIVE   STM   R0,R15,ACTREGS
         L     R8,ACTSTORG             ASCB/OUCB INFO STORAGE
         CLI   WJOB1,C' '              ANY OUTPUT
         BE    ACTIVE0                 NO
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         SPACE 1
ACTIVE0  MVI   ACTMSG1,C' '
         MVC   ACTMSG1+1(79),ACTMSG1
         MVC   ACTJNAME(8),JOBNAME
         MVC   ACTSNAME(8),JOBSTEP
         L     R15,ACTCPU              CPU UTIL
         LTR   R15,R15                 NEGATIVE CPU
         BM    ACTIVE1                 YES
         CVD   R15,DOUBLE              PERCENT TO PRINT
         MVC   ACTMSG1+19(4),=C'CPU='
         MVC   PCT1(7),=X'402020204B2020'
         ED    PCT1(4),DOUBLE+6
         MVI   ACTMSG1+22,C'='
         CH    R15,=H'46'              MAX
         BNH   *+8                     NO
         LH    R15,=H'46'              SET MAX
         EX    R15,PCTMVE1             GRAPHIC PERCENT
         LA    R15,PCTGRPH1(R15)
         MVI   0(R15),C'>'
         L     R15,ACTCPUH             CPU UTIL (HUNDREDTHS)
         CVD   R15,DOUBLE              PERCENT TO PRINT  (HUNDREDTHS)
         UNPK  PCT1+5(2),DOUBLE+6(2)
         OI    PCT1+6,X'F0'
         B     ACTIVE2
         SPACE 1
ACTIVE1  MVC   PCT1(7),=C'**CHG**'
         B     ACTIVE2
         SPACE 1
PCTMVE1  MVC   PCTGRPH1(0),PCTLINE
ACTIVE2  MVC   ACTLIST1(4),=X'00540100'
         LA    R1,ACTLIST1
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   OUTMSG+4,C' '
         MVC   OUTMSG+5(79),OUTMSG+4
         L     R6,JOBPREVT
         XC    JOBINTVL(4),JOBINTVL
         TIME  BIN
         LR    R5,R0                   CURRENT TIME
         SR    R5,R6                   INTERVAL TIME
         ST    R0,JOBPREVT
         LTR   R6,R6                   1ST TIME
         BZ    ACTIVE2A
         ST    R5,JOBINTVL             SAVE INTERVAL TIME
         SPACE 1
ACTIVE2A MVC   OUTMSG(4),=X'00540100'
         L     R14,16                  LOAD CVT ADDR
         L     R3,356(0,R14)           LOAD PVT ADDR
         L     R4,12(0,R3)             PFT APPARENT ADDR
         AH    R4,16(0,R3)             PFT ACTUAL ADDR
         SR    R5,R5                   INDEX
         IC    R5,18(0,R3)             TO
         SLL   R5,8                    END OF
         IC    R5,19(0,R3)             PFT
         SH    R5,16(0,R3)
         SRL   R5,4                    DIVIDE BY 16
         STM   R4,R5,PFTREGS           SAVE PFT REGS
         LH    R10,JOBASID
         BAL   R11,PAGEPRNT            GO COUNT AND FORMAT
         BAL   R11,JPAGE               GO COUNT AND FORMAT
         L     R2,XSASAVE
         LA    R1,OUTMSG               LOAD OUTPUT MSG ADDR
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         SPACE 1
ACTIVE3  MVI   ACTMSG2,C' '
         MVC   ACTMSG2+1(79),ACTMSG2
         MVC   ACTMSG2(5),=C'EXCP='
         L     R15,JOBSIOCT            EXCP COUNT
         L     R14,JOBSIOPR            PREV COUNT
         LTR   R14,R14                 ZERO
         BNZ   *+6                     NO
         LR    R14,R15                 PREV = CURRENT
         ST    R15,JOBSIOPR
         SR    R15,R14
         CVD   R15,DOUBLE              EXCP TO PRINT
         MVC   ACTMSG2+5(6),=X'402020202120'
         ED    ACTMSG2+5(6),DOUBLE+5
         L     R14,JOBINTVL            LOAD DIFFERENCE
         LTR   R14,R14                 POSITIVE
         BNP   ACTIVE3A                NO
         MVC   ACTMSG2+19(4),=C'E/S='
         SR    R14,R14
         M     R14,=F'100'
         D     R14,JOBINTVL            SIO PER SEC
         CVD   R15,DOUBLE
         MVC   PCT2(7),=X'402020204B2020'
         ED    PCT2(4),DOUBLE+6
         MVI   ACTMSG2+22,C'='
         CH    R15,=H'46'              MAX
         BNH   *+8                     NO
         LH    R15,=H'46'              SET MAX
         EX    R15,PCTMVE2             GRAPHIC PERCENT
         LA    R15,PCTGRPH2(R15)
         MVI   0(R15),C'>'
         SRDL  R14,32
         M     R14,=F'100'
         D     R14,JOBINTVL
         CVD   R15,DOUBLE              PERCENT TO PRINT  (HUNDREDTHS)
         UNPK  PCT2+5(2),DOUBLE+6(2)
         OI    PCT2+6,X'F0'
         SPACE 1
ACTIVE3A MVC   ACTLIST2(4),=X'00540100'
         LA    R1,ACTLIST2
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         SPACE 1
ACTIVE4  LM    R0,R15,ACTREGS
         BR    R10
         SPACE 1
PCTMVE2  MVC   PCTGRPH2(0),PCTLINE
JPAGE    L     R14,16                  LOAD CVT ADDR
         L     R14,556(0,R14)          LOAD ASVT ADDR
         LA    R14,524(0,R14)          1ST ASCB SLOT
         SLL   R10,2
         LA    R14,0(R10,R14)          THIS ASID ASCB SLOT
         L     R8,ACTSTORG             ASCB/OUCB INFO STORAGE
         L     R2,JOBINTVL
         L     R8,0(0,R14)             ASCB ADDR
         L     R1,148(0,R8)            OUXB ADDR
         LA    R1,0(0,R1)
         L     R8,ACTSTORG             ASCB/OUCB INFO STORAGE
         LTR   R5,R1                   VALID ADDR
         BCR   8,R11                   NO
         CLC   JOBPAGES(24),=24X'00'   1ST TIME
         BE    JPAGE3                  YES
         SPACE 1
JPAGE1   LTR   R2,R2                   1ST PASS
         BCR   8,R11
         MVC   OUTMSG+19(9),=CL9'PGS/SEC='
         LA    R10,JOBPAGES
         L     R14,16(0,R1)            CURR PAGEIN
         S     R14,0(0,R10)            SUB PREV PAGEIN
         LTR   R14,R14                 OVERFLOW
         BM    JPAGE2                  YES
         LR    R15,R14                 ACCUMULATE
         L     R14,20(0,R1)            CURR PAGEOUT
         S     R14,4(0,R10)            SUB PREV PAGEOUT
         LTR   R14,R14                 OVERFLOW
         BM    JPAGE2                  YES
         AR    R15,R14                 ACCUMULATE
         L     R14,24(0,R1)            CURR PAGE RECLAIM
         S     R14,8(0,R10)            SUB PREV PAGE RECLAIM
         LTR   R14,R14                 OVERFLOW
         BM    JPAGE2                  YES
         SR    R15,R14                 ACCUMULATE
         L     R14,28(0,R1)            CURR VIO PAGEIN
         S     R14,12(0,R10)           SUB PREV VIO PAGEIN
         LTR   R14,R14                 OVERFLOW
         BM    JPAGE2                  YES
         AR    R15,R14                 ACCUMULATE
         L     R14,32(0,R1)            CURR VIO PAGEOUT
         S     R14,16(0,R10)           SUB PREV VIO PAGEOUT
         LTR   R14,R14                 OVERFLOW
         BM    JPAGE2                  YES
         AR    R15,R14                 ACCUMULATE
         L     R14,36(0,R1)            CURR VIO RECLAIM
         S     R14,20(0,R10)           SUB PREV VIO RECLAIM
         LTR   R14,R14                 OVERFLOW
         BM    JPAGE2                  YES
         SR    R15,R14                 ACCUMULATE
         SR    R14,R14
         M     R14,=F'100'
         DR    R14,R2                  PAGES PER SEC
         CVD   R15,DOUBLE
         LR    R1,R15
         MVC   OUTMSG+28(10),=X'402021204B2020404040'
         ED    OUTMSG+28(4),DOUBLE+6
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R2                  HUNDREDTHS
         CVD   R15,DOUBLE
         UNPK  OUTMSG+33(2),DOUBLE+6(2)
         OI    OUTMSG+34,X'F0'
         SLL   R1,1
         C     R15,=F'50'              ROUND UP GRAPH
         BL    *+8                     NO
         LA    R1,1(0,R1)
         CH    R1,=H'46'
         BNH   *+8
         LH    R1,=H'46'               FORCE MAX
         EX    R1,PAGMVE
         LA    R1,OUTMSG+37(R1)
         MVI   0(R1),C'>'
         B     JPAGE3
         SPACE 1
JPAGE2   MVC   OUTMSG+28(18),=CL18'   0.00'
         SPACE 1
JPAGE3   MVC   JOBPAGES(24),16(R5)     SAVE OUXB PAGING ACCUM FIELDS
         BR    R11
         SPACE 1
PAGMVE   MVC   OUTMSG+37(0),PAGGRAPH
PAGEPRNT DS    0H
         LH    R0,JOBASID              LOAD ASID TO CHECK FOR      @TEC
         L     R4,16                   LOAD CVT ADDR               @TEC
         L     R4,356(0,R4)            LOAD PVT ADDR               @TEC
         L     R14,8(R4)               GET ADDR OR AREA IN RIT     @TEC
         L     R4,0(0,R14)             GET ADDR OF FIRST REAL PFTE @TEC
         L     R5,4(0,R14)             GET ADDR OF LAST REAL PFTE  @TEC
         SR    R5,R4                   GET DIFFERENCE              @TEC
         SRL   R5,5                    GET # ENTRIES               @TEC
         LA    R5,1(0,R5)              ADD IN LAST ONE             @TEC
         SR    R14,R14                 CLEAR FRAME COUNT           @TEC
         SPACE 3                                                   @TEC
PAGEPR1  SR    R15,R15                 LOAD                        @TEC
         ICM   R15,3,18(R4)            PFT ASID                    @TEC
         TM    10(R4),X'80'            AVAILABLE PAGE              @TEC
         BO    PAGEPR2                 DON'T COUNT IT              @TEC
         CR    R0,R15                  ASID MATCH                  @TEC
         BNE   PAGEPR2                 NO, DONT INCR FRAME COUNT   @TEC
         LA    R14,1(0,R14)            ADD 1 TO FRAME COUNT        @TEC
PAGEPR2  LA    R4,32(0,R4)             NEXT PFT                    @TEC
         BCT   R5,PAGEPR1              PROCESS NEXT                @TEC
         MVC   OUTMSG+4(5),=CL5'STOR='
         SLL   R14,2                   CHG FRAMES TO K
         CVD   R14,DOUBLE              CONVERT TO DECIMAL
         MVC   OUTMSG+9(7),=X'402020202120D2'
         ED    OUTMSG+9(6),DOUBLE+5
         BR    R11
         USING *,R15
STAEXIT  CH    R0,=H'12'               SDWA GOTTEN
         BE    STAEXIT1                NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)         SAVE REGISTER
         LR    R14,R13                 SAVE ORIG R13
         L     R13,0(R1)               GET ESTAE PARM
         L     R2,XSASAVE              GET XSA ADDRESS
         LR    R13,R14                 RESTORE R13
         ICM   R2,15,XAL-XSA(R2)       GET PARM ADDRESS
         BZ    ESTNOP                  IF NO PARMS THEN SKIP DATA
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC  SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX  MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2)  MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19     SET LENGTH OF DATA
         B     ESTNOP                  SKIP CONSTANTS
         ESTMODS ,                     GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8)  GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)         GET RETRY ADDRESS
         LA    R3,ESTMODS              POINT AT NAMES
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,  GLA-BFG          X
               RECORD=YES,RECPARM=(3),REGS=(14,12)  GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)         LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(CSCGA03D)        LOAD ENTRY POINT ADDR
         LR    R13,R1                  RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG              ADDRESSING ERROR
         L     R2,XSASAVE              RELOAD XSA ADDR
         LA    R11,RETURN              LOAD RET ADDR
MSGRTN   SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R11
         SPACE 3
RETURN   CLI   WJOB1,C' '              ANY OUTPUT
         BE    RETURN1                 NO
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         SPACE 1
RETURN1  ESTAE 0
         LA    R8,AMODE24                                          @TEC
         BSM   0,R8                                                @TEC
AMODE24  DS    0H                                                  @TEC
         L     R0,SIZE                 LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13                  LOAD GETMAIN AREA ADDR
         L     R2,SAVRET               RETURN ADDR
         FREEMAIN  R,LV=(0),A=(1)
*        MODESET KEY=NZERO,MODE=PROB
         SR    R15,R15
         LR    R14,R2
         BR    R14
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
STAEMSG  DC    X'00540100'
         DC    CL80'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
         DS    0F
WAITMSG  DC    X'00540100'
         DC    31C'-',CL18'   JOB  WAITING   ',31C'-'
         SPACE 3
         DS    0F
SEPRMSG  DC    X'00540100'
         DC    33C'-',CL14'   JOB  I/O   ',33C'-'
         SPACE 3
UCBNRDY  DC    CL38'XXX XXXXXX   NOT READY  FOR XXXXX SEC'
UCBBUSY  DC    CL38'XXX XXXXXX  XXX%) XXX% BUSY XXXXX SEC'
         SPACE 3
PAGGRAPH DC    C'0=1=2=3=4=5=6=7=8==10========15========20========='
PCTLINE  DC    CL51'0=========1=========2=========3=========4========='
         SPACE 3
SRMOVLY  DS    0CL84
         DC    XL4'00540100'
         DC    CL5'TSO-',CL10' '
         DC    CL6'LGCP-',CL7' '
         DC    CL6'AVCP-',CL7' '
         DC    CL6'AVPG-',CL7' '
         DC    CL7'AVUIC-',CL7' '
         DC    CL6'ASMQ-',CL6' '
         SPACE 3
SRCTAB   DC    CL12' '
         DC    CL12'SWAP TERMOUT'
         DC    CL12'SWAP TERMIN '
         DC    CL12'SWAP LONGWT '
         DC    CL12'SWAP AUXSTOR'
         DC    CL12'SWAP REALSTR'
         DC    CL12'SWAP DETWAIT'
         DC    CL12'SWAP REQUEST'
         DC    CL12'SWAP ENQEXC '
         DC    CL12'SWAP WORKEXC'
         DC    CL12'SWAP UNILATR'
         DC    CL12'SWAP TRANSIT'
         DC    CL12'SWAP LOGICAL'
         DC    CL12'SWAP LG FAIL'
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                     *
*                                                                     *
*        THRESHOLD VALUES FOR ALL DISPLAY LIMITS                      *
*                                                                     *
*                                                                     *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         SPACE 5
         DS    0D
THRINTVL DC    CL8'00000020'           DEVICE MONITOR STIMER
THRSTIMR DC    F'50'                   NO. OF STIMERS
THRTSOPG DC    F'2'                    TSO PERFORMANCE GROUP
THRSWAP  DC    F'01'                   HIGH SWAP COUNT THRESHOLD
THRFRAME DC    F'001'                  HIGH FRAME USE LIMIT
THRFRMTM DC    F'05'                   HIGH FRAME USE TIME THRESHOLD
THRABEND DC    F'05'                   JOB ABENDING TIME THRESHOLD
THRLOOPP DC    F'05'                   LOOP CPU PERCENT THRESHOLD
THRLOOPT DC    F'15'                   LOOP TIME THRESHOLD
THRCPULP DC    F'01'                   EXCESS JOB CPU PERCENT THRESHOLD
THRCPULT DC    F'05'                   EXCESS JOB CPU TIME THRESHOLD
THRSWPWT DC    F'05'                   SWAP WAIT TIME THRESHOLD
THRREPWT DC    F'05'                   REPLY WAIT TIME THRESHOLD
THRALCWT DC    F'05'                   ALLOCATION WAIT TIME THRESHOLD
THRUCBNR DC    F'05'                   DEVICE NOT READY THRESHOLD
*                                  (DASD)
THRUCBBS DC    F'05'                   DEVICE BUSY THRESHOLD
*                                  (DASD)
THRUCBLM DC    F'01'                   DEVICE BUSY LIMIT
*                                  (DASD)
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
ACTREGS  DS    18F
DOUBLE   DS    2F
DOUBLEX  DS    2F
DOUBLEY  DS    2F
MAJOR    DS    2F
NUMCHK   DS    2F
PARM     DS    F
WAITSW   DS    F                       X'FF' IF JOB WAITING
SAVEBUSY DS    F
ACTSTORG DS    F
ACTCPU   DS    F                       CPU UTIL
ACTCPUH  DS    F                       CPU UTIL (HUNDREDTHS)
QIOASID  DS    F
XSASAVE  DS    F
PFTREGS  DS    2F
SAVETIM1 DS    F
SAVETIM2 DS    F
SAVETIM3 DS    F
SAVETIM4 DS    F
CURRWAIT DS    F
         SPACE 2
PLIST    DS    3F                                                  @TEC
ADDR     DS    F                                                   @TEC
WKAREA   DS    0D,XL100                                            @TEC
UCBDMSAV DS    4F
UCBDMLOW DS    F
UCBDMCUR DS    F
         SPACE 3
         DS    0F
ACTLIST1 DS    F
ACTMSG1  DS    0CL80
ACTJNAME DS    CL8
         DS    CL1
ACTSNAME DS    CL8
         DS    CL2
         DS    CL5
PCT1     DS    CL7
         DS    CL2
PCTGRPH1 DS    CL47
         SPACE 3
         DS    0F
ACTLIST2 DS    F
ACTMSG2  DS    0CL80
         DS    CL24
PCT2     DS    CL7
         DS    CL2
PCTGRPH2 DS    CL47
         SPACE 3
         DS    0F
OUTMSG   DS    F
FRMMSG   DS    CL80
         SPACE 3
         DS    0F
WTOLIST  DS    F
JOBMSG   DS    0CL80
WJOB1    DS    CL8
         DS    CL2
WMSG1    DS    CL15
         DS    CL1
WRSN1    DS    CL12
         DS    CL4
WJOB2    DS    CL8
         DS    CL2
WMSG2    DS    CL15
         DS    CL1
WRSN2    DS    CL12
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0F
JOBTABLE DSECT
         DS    5F
*-------------------------------------------------------------*    @TEC
*  TABLE OF DATA ABOUT UCB'S IN USE BY MONITORED JOB.         *    @TEC
*                                                             *    @TEC
*  00-00 SET TO X'FF' IF SLOT IN USE                          *    @TEC
*  01-03 UCB ADDRESS (TROUBLE IF UCB'S GO ABOVE THE LINE).    *    @TEC
*  04-07 TIME VALUE FOR BUSY THRESHOLD MONITORING             *    @TEC
*  08-11 UCB BUSY COUNT                                       *    @TEC
*  12-15 UCB BUSY COUNT - THIS JOB                            *    @TEC
*  16-19 CUMULATIVE BUSY %                                    *    @TEC
*-------------------------------------------------------------*    @TEC
UCBTAB   DS    100CL20
UCBTABND DS    F
JOBNAME  DS    CL8
JOBSTEP  DS    CL8
JOBASID  DS    H
JOBFLAG  DS    H
JOBTIME  DS    F                       JOB CPUTIME SAVEAREA
JOBCPUT  DS    F
JOBINTT  DS    F                       INTERVAL CPU TIME
JOBEXCP  DS    F
JOBSIOCT DS    F
JOBSIOPR DS    F
JOBLOOP  DS    F                       MOST RECENT TIME NOT WAITING
JOBCPUL  DS    F
JOBINTL  DS    F
JOBWAIT  DS    F
JOBFRAME DS    F
JOBFRCNT DS    F
JOBABEND DS    F
JOBINTVL DS    F
JOBPREVT DS    F
JOBPAGES DS    6F
         DS    F
*-------------------------------------------------------------*    @TEC
* A COMMUNICATIONS AREA PASSED BY THE CONTROL PROGRAM         *    @TEC
*-------------------------------------------------------------*    @TEC
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
XAA      DS    F                       ADDRESS OF WORKING STORAGE
         PRINT NOGEN
         IHASDWA
         CVT   DSECT=YES                                           @TEC
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCGE03D
         TITLE 'CSCGE03D -   E  EXCEPTION MONITOR'
         PRINT NOGEN                                               @TEC
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SP1GE03D -       E  EXCEPTION MONITOR                     ***
***                                                                 ***
***       VERSION -        2.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        06/15/81                                 ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*
*
*                  EXCEPTION MONITOR OUTPUT MESSAGES
*               ---------------------------------------
*
*
*
*
*   SYSTEM EXCEPTION MESSAGES
*   --------------------------------------
*
*   CHANNEL XX   XXX% BUSY  FOR XXXXX SEC
*   UUU VVVVVV   XXX% BUSY  FOR XXXXX SEC
*   UUU VVVVVV   NOT READY  FOR XXXXX SEC
*   EXCESS SYSTEM PAGING FOR    XXXXX SEC
*   LOCAL PAGE I/O DEGRADED FOR XXXXX SEC
*   WTO BUFFER SHORTAGE, WQE COUNT= XXXXX
*   SQA AVAIL= XXXXXK, CSA AVAIL= XXXXXK
*
*
*
*
*   JOB RESOURCE USAGE EXCEPTION MESSAGES
*   --------------------------------------
*
*   JJJJJJJJ POSSIBLE LOOP FOR  XXXXX SEC
*   JJJJJJJJ XXX% CPU FOR       XXXXX SEC
*   JJJJJJJJ ABEND IN PROGRESS  XXXXX SEC
*   JJJJJJJJ EXCESS SWAP COUNT = XXXXX
*   JJJJJJJJ XXXXX FRAMES FOR   XXXXX SEC
*
*
*
*
*   JOB WAIT EXCEPTION MESSAGES
*   --------------------------------------
*
*    ( NOTE -   A JOB IS CONSIDERED TO BE WAITING IF IT USES 0% CPU  )
*
*
*   JJJJJJJJ ENQ SYSDSN   WAIT  XXXXX SEC       ENQ CONFLICT
*   JJJJJJJJ I/O ON UUU   WAIT  XXXXX SEC       I/O PENDING
*   JJJJJJJJ ALLOC QUEUE  WAIT  XXXXX SEC       ALLOC QUEUE
*   JJJJJJJJ REPLY NN     WAIT  XXXXX SEC       REPLY PENDING
*   JJJJJJJJ SWAP RRRRRR  WAIT  XXXXX SEC       SWAPPED OUT
*
*      RRRRRR -     ( SWAP REASON CODES )
*                   LONGWT           LONG WAIT
*                   AUXSTOR          AUXILLARY STORAGE SHORTAGE
*                   REALSTR          REAL STORAGE SHORTAGE
*                   DETWAIT          MSO DETECTED WAIT
*                   REQUEST          REQUEST SWAP
*                   ENQEXC           ENQ EXCHANGE
*                   WORKEXC          WORKLOAD EXCHANGE
*                   UNILATR          UNILATERAL
*
*
*
*   ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND
*
*
*
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
CSCGE03D CSECT
         LR    R12,R15
         LA    R7,4095(0,R12)
         LA    R7,1(0,R7)
         USING CSCGE03D,R12,R7
*        MODESET KEY=ZERO,MODE=SUP
         L     R0,SIZE                 LOAD GETMAIN SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET              SAVE RETURN ADDR
         ST    R2,XSASAVE              SAVE XSA ADDR
         USING XSA,R2
         L     R3,XAL
         LA    R3,0(0,R3)
         MVI   PARM,C'A'               ALL SCANS ACTIVE
         LTR   R3,R3                   ANY PARM
         BZ    *+10                    NO
         MVC   PARM(1),0(R3)           SET SCAN TYPE
         LR    R10,R13                 LOAD SAVE AREA ADDR
         L     R9,AMODE31                                          @TEC
         BSM   0,R9                                                @TEC
AMODE31  DC    A(CONT31+X'80000000')                               @TEC
CONT31   DS    0H                                                  @TEC
         B     ESTAEBYP                BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L         * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL              * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL  * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
CSCSTART L     R4,16                   CVT
         L     R4,604(0,R4)            RMCT
         MVC   WTOLIST(84),SRMOVLY
         L     R5,88(0,R4)             WAMT
         L     R1,THRTSOPG             TSO PERF GROUP NUMBER
         SLL   R1,2                    TIMES 4
         L     R6,88(R1,R5)            WAMP OFFSET                 @TEC
         AR    R5,R6                   WAMP ADDRESS
         SR    R14,R14
         L     R15,0(0,R5)             TOTAL ENDED TRANS
         LTR   R15,R15                 ZERO TRANS
         BZ    NOTSO                   YES, BYPASS 0C9
         L     R15,12(0,R5)            TOTAL ELAPSTM FOR ENDED TRANS
         D     R14,0(0,R5)             DIVIDE BY ENDED TRANSACTIONS
         SR    R14,R14
         D     R14,=F'1000'
NOTSO    CVD   R15,DOUBLE              AVG SECONDS RESPONSE TIME
         SRDL  R14,32
         D     R14,=F'10'
         CVD   R15,DOUBLEX
         MVC   WTOLIST+8(7),=X'402021204B2020'
         ED    WTOLIST+8(4),DOUBLE+6
         UNPK  WTOLIST+13(2),DOUBLEX+6(2)
         OI    WTOLIST+14,X'F0'
*-------------------------------------------------------------*    @TEC
* GET LONG TERM CPU BUSY PERCENT                              *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R1,4(0,R4)              CCT                         @TEC
         LH    R1,104(0,R1)            LONG TERM CPU UTIL          @TEC
         SRL   R1,8                    SCALED BY 256?              @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+25(4),=X'40212020'
         ED    WTOLIST+25(4),DOUBLE+6
*-------------------------------------------------------------*    @TEC
* GET CURRENT CPU BUSY PERCENT                                *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R1,4(0,R4)              CCT                         @TEC
         LH    R1,102(0,R1)            AVERAGE CPU                 @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+38(4),=X'40212020'
         ED    WTOLIST+38(4),DOUBLE+6
*-------------------------------------------------------------*    @TEC
* GET PAGING RATE                                             *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R1,228(0,R4)            RCT                         @TEC
         LH    R1,64(0,R1)             AVERAGE PAGING              @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+51(4),=X'40212020'
         ED    WTOLIST+51(4),DOUBLE+6
*-------------------------------------------------------------*    @TEC
* GET AVERAGE UNREFERENCED INTERVAL COUNT                     *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R1,228(0,R4)            RCT                         @TEC
         LH    R1,54(0,R1)             AVERAGE UIC                 @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+65(4),=X'40212020'
         ED    WTOLIST+65(4),DOUBLE+6
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  MCS ID OF REQUESTING CONSOLE
         SVC   35
         MVI   WTOLIST+4,C' '
         MVC   WTOLIST+5(79),WTOLIST+4
         MVC   WTOLIST(4),=X'00540100'
         L     R8,XAA                  ASCB/OUCB INFO STORAGE
         USING JOBTABLE,R8
         BAL   R10,CHKWQE
         BAL   R10,CHKSQA
         BAL   R10,CHKPAG
         L     R3,THRSTIMR
         CLI   PARM,C'C'               SKIP CHAN/DEV SCAN?
         BE    JOBOUT                  YES
         CLI   PARM,C'D'               DEVICE SCAN ELIMINATE
         BE    *+8                     YES
         BAL   R10,CHKUCB              CLEAR UCB TABLE
         BAL   R10,CHNLOOP
JOBOUT   L     R4,16                   CVT ADDR
         L     R4,556(0,R4)            ASVT ADDR
         LA    R4,524(0,R4)            ASCB SLOT ADDR
         B     JOBOUT2
JOBOUT1  L     R5,0(0,R4)              ASCB ADDR
         LA    R5,0(0,R5)
         L     R6,56(0,R5)             CSCB ADDR
         L     R9,144(0,R5)            LOAD OUCB ADDR
         BAL   R11,ASCBFORM            GO FORMAT ASCB INFO
JOBOUT2  LA    R4,4(0,R4)              INCR INTO ASVT
         CLC   1(3,R4),=F'0'           END OF ASVT
         BE    RETURN                  YES, RETURN
         TM    0(R4),X'80'             AVAILABLE ENTRY
         BO    JOBOUT2                 YES, CHECK NEXT
         B     JOBOUT1                 GO USE IT
ASCBFORM LH    R1,36(0,R5)             ASID
         MH    R1,=H'48'               TABLE ENTRY LENGTH
         L     R8,XAA                  JOBTABLE ADDR
         AR    R8,R1                   JOBTABLE ENTRY ADDR THIS ASID
         LA    R1,=CL8'*MASTER*'
         CLC   36(2,R5),=H'1'          MASTER SCHEDULER
         BE    ASCBFRM1                YES
         L     R1,172(0,R5)            JOBNAME POINTER
         LTR   R1,R1                   ZERO
         BNZ   ASCBFRM1                NO
         L     R1,176(0,R5)            STC/TSU NAME POINTER
         LTR   R1,R1                   ZERO
         BNZ   ASCBFRM1                NO
         LA    R1,=CL8'*UNKNWN*'
         B     ASCBFRM1                NO
ASCBFRM0 XC    JOBFLAG(38),JOBFLAG     CLEAR COUNTERS
         B     ASCBFRM2+12
ASCBFRM1 CLC   JOBNAME(8),0(R1)        JOB/STC/TSU NAME MATCH
         BE    ASCBFRM2                YES
         MVC   JOBNAME(8),0(R1)        JOB/STC/TSU NAME
         MVC   JOBASID(2),36(R5)       JOB/STC/TSU ASID
         XC    JOBFLAG(38),JOBFLAG     CLEAR COUNTERS
ASCBFRM2 DS    0H
         BAL   R10,CHKFRM              CHECK FOR JOBS WITH HIGH FRAMES
         BAL   R10,CHKSWP              CHECK FOR JOBS WITH SWAP COUNTS
         LM    R14,R15,64(R5)          TCB TIME
         SRDL  R14,22
         LR    R1,R15
         LM    R14,R15,200(R5)         SRB TIME
         SRDL  R14,22
         AR    R1,R15
         C     R1,JOBTIME              COMPARE PREVIOUS CPU TIME
         BE    ASCBFRM4                EQUAL, JOB WAITING
         BL    ASCBFRM0                CURRENT LOWER,  STEP CHANGE
         C     R1,JOBCPUT              COMPARE PREVIOUS CPU TIME
         BL    ASCBFRM0                CURRENT LOWER,  STEP CHANGE
         L     R15,JOBCPUT             LOAD PREVIOUS CPU TIME
         LTR   R15,R15                 ANY PREVIOUS
         BNZ   *+8                     YES
         ST    R1,JOBCPUT              PREVIOUS = CURRENT
         L     R15,JOBTIME             LOAD PREVIOUS CPU TIME
         LTR   R15,R15                 ANY PREVIOUS
         BNZ   *+8                     YES
         ST    R1,JOBTIME              PREVIOUS = CURRENT
         LR    R15,R1
         S     R15,JOBCPUT             SUB PREVIOUS CPU TIME
         S     R1,JOBTIME              SUB PREVIOUS CPU TIME
         ST    R15,SAVETIM1            SAVE DIFFERENCE
         ST    R1,SAVETIM2             SAVE DIFFERENCE
         XC    JOBWAIT(4),JOBWAIT      CLEAR WAIT COUNTER
         TIME  BIN
         L     R1,JOBCPUL              OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,JOBCPUL              OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,JOBCPUL              INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BE    ASCBFRMA                YES
         BM    ASCBFRM0                NEGATIVE, CLEAR COUNTERS
         L     R15,SAVETIM1            LOAD DIFFERENCE
         LTR   R15,R15                 NEGATIVE
         BM    ASCBFRM0                YES
         SR    R14,R14
         M     R14,=F'10'              PERCENT
         SR    R14,R14
         DR    R14,R1                  PERCENT UTIL
         BAL   R10,CHKCPU              CHECK JOB CPU UTILIZATION LIMIT
ASCBFRMA TIME  BIN                     POTENTIAL LOOP
         L     R1,JOBLOOP              OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,JOBLOOP              OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,JOBLOOP              INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BCR   8,R11                   YES, NO LOOP YET
         BM    ASCBFRM0                NEGATIVE, CLEAR COUNTERS
         L     R15,SAVETIM2            LOAD DIFFERENCE
         LTR   R15,R15                 NEGATIVE
         BM    ASCBFRM0                YES
         SR    R14,R14
         M     R14,=F'10'              PERCENT
         SR    R14,R14
         DR    R14,R1                  PERCENT UTIL
         C     R15,THRLOOPP            OVER CPU PERCENT THRESHOLD
         BNL   *+18                    YES
         XC    JOBLOOP(4),JOBLOOP
         XC    JOBTIME(4),JOBTIME
         BR    R11
         LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             LOOP SECONDS                @TEC
         CVD   R15,DOUBLE
         C     R15,THRLOOPT            OVER LOOP THRESHOLD
         BCR   4,R11                   NO
         CLC   36(2,R5),=H'1'          MASTER SCHEDULER
         BCR   8,R11                   YES, NO LOOP CHECK
         CLC   172(4,R5),=F'0'         JOB OR STC/TSU
         BNE   *+10                    JOB
         CLI   28(R6),X'01'            TSU OR STC
         BCR   7,R11                   STC
         L     R1,108(0,R9)            EXCP COUNT
         L     R15,JOBEXCP             PREVIOUS EXCP COUNT
         ST    R1,JOBEXCP              SAVE PREVIOUS EXCP COUNT
         CR    R1,R15                  COMPARE CURRENT TO PREVIOUS
         BL    ASCBFRM0                CURRENT LOWER,  STEP CHANGE
         BE    ASCBFRMC                NO EXCPS, POSSIBLE LOOP
         XC    JOBLOOP(4),JOBLOOP
         XC    JOBTIME(4),JOBTIME
         BR    R11
ASCBFRMC CLI   WJOB1,C' '              1ST PASS
         BNE   ASCBFRM3                NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28'POSSIBLE LOOP FOR XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLE+5
         BR    R11
ASCBFRM3 MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28'POSSIBLE LOOP FOR XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R11
ASCBFRM4 TIME  BIN
         L     R1,JOBWAIT              OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,JOBWAIT              OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,JOBWAIT              INTERVAL TIME
         XC    JOBLOOP(4),JOBLOOP      CLEAR LOOP COUNTER
         XC    JOBCPUT(4),JOBCPUT      CLEAR CPU TIME ACCUM
         XC    JOBCPUL(4),JOBCPUL      CLEAR ELAPSED TIME ACCUM
         LTR   R1,R1                   TIME EQUAL 0
         BCR   8,R11                   YES, NO WAIT YET
         BM    ASCBFRM0                NEGATIVE, CLEAR COUNTERS
         LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             WAIT SECONDS
         CVD   R15,DOUBLE
         ST    R15,CURRWAIT
         LA    R3,WMSG1
         CLI   WJOB1,C' '              1ST PASS
         BE    ASCBFRM5                YES
         LA    R3,WMSG2
ASCBFRM5 MVC   0(12,R3),=CL12' '
         BAL   R10,CHKENQ              CHECK ENQ OUTSTANDING
         CLI   0(R3),C' '              ANY ENQS FOR THIS JOB
         BNE   ASCBFRM6                YES
         BAL   R10,CHKALC              CHECK ALLOCATION QUEUE
         CLI   0(R3),C' '              ANY ALLOC PENDING FOR THIS JOB
         BNE   ASCBFRM6                YES
         BAL   R10,CHKQIO              CHECK I/O OUTSTANDING
         CLI   0(R3),C' '              ANY I/O FOR THIS JOB
         BNE   ASCBFRM6                YES
         BAL   R10,CHKREP              CHECK REPLY OUTSTANDING
         CLI   0(R3),C' '              ANY REPLIES FOR THIS JOB
         BNE   ASCBFRM6                YES
         L     R1,CURRWAIT             CURRENT WAIT TIME
         C     R1,THRSWPWT             OVER SWAP WAIT THRESHOLD
         BCR   4,R11                   NO
         CLC   172(4,R5),=F'0'         JOB OR STC/TSU
         BNE   *+10                    JOB
         CLI   28(R6),X'01'            TSU OR STC
         BCR   7,R11                   STC OR INIT
         BAL   R10,CHKSRC              CHECK SWAP REASON CODE
         CLI   0(R3),C'*'              EXCLUDED SRC
         BNE   *+10                    NO
         MVI   0(R3),C' '
         BR    R11
         CLI   0(R3),C' '              ANY SRC FOR THIS JOB
         BNE   ASCBFRM6                YES
         MVC   0(12,R3),=12C'?'
ASCBFRM6 CLI   WJOB1,C' '              1ST TIME
         BNE   ASCBFRM7                NO, 2ND PASS
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1+12(16),=CL16' WAIT XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLE+5
         BR    R11
ASCBFRM7 MVC   WJOB2(8),JOBNAME
         MVC   WMSG2+12(16),=CL16' WAIT XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R11
CHNLOOP  DS    0H
         LR    R4,R10
         CLI   PARM,C'D'               DEVICE SCAN ELIMINATE
         BE    *+8                     YES
         BAL   R10,CHKUCB1             CHECK BUSY UCBS
         LR    R10,R4
         L     R1,16                   CVT                         @TEC
         L     R1,604(0,R1)            RMCT                        @TEC
         L     R1,280(0,R1)            CMCT                        @TEC
         L     R14,28(0,R1)            END OF CPMT                 @TEC
         S     R14,12(0,R1)            MINUS START                 @TEC
         SRDA  R14,32                                              @TEC
         D     R14,=F'12'              12 BYTES PER CHPID          @TEC
         BCTR  R15,0                   MINUS 12 FOR THE HEADER     @TEC
         LR    R3,R15                  NUMBER OF CHPID'S           @TEC
         ST    R3,MAXCHPID             SAVE FOR LATER              @TEC
         L     R14,12(0,R1)            CPMT                        @TEC
         L     R0,8(0,R14)             START SAMPLE COUNT          @TEC
         ST    R0,CHBSMPCT             AND SAVE IT                 @TEC
         LA    R14,12(0,R14)           SKIP OVER HEADER            @TEC
         SR    R15,R15                 INDEX REGISTER              @TEC
CHNLOOP1 CLC   8(2,R14),=X'FFFF'       CHPID NOT INSTALLED.        @TEC
         BE    CHNLOOP2                                            @TEC
         L     R1,4(0,R14)             BUSY COUNT                  @TEC
         ST    R1,CHBSYPCT(R15)                                    @TEC
CHNLOOP2 LA    R14,12(0,R14)           NEXT CPMT ENTRY             @TEC
         LA    R15,4(0,R15)            NEXT SLOT                   @TEC
         BCT   R3,CHNLOOP1                                         @TEC
         STIMER  WAIT,DINTVL=THRINTVL
         L     R1,16                   CVT                         @TEC
         L     R1,604(0,R1)            RMCT                        @TEC
         L     R1,280(0,R1)            CMCT                        @TEC
         L     R14,28(0,R1)            END OF CPMT                 @TEC
         S     R14,12(0,R1)            MINUS START                 @TEC
         SRDA  R14,32                                              @TEC
         D     R14,=F'12'              12 BYTES PER CHPID          @TEC
         BCTR  R15,0                   MINUS 12 FOR THE HEADER     @TEC
         LR    R3,R15                  NUMBER OF CHPID'S           @TEC
         L     R14,12(0,R1)            CPMT                        @TEC
         L     R0,8(0,R14)             END SAMPLE COUNT            @TEC
         S     R0,CHBSMPCT             MINUS STARTING COUNT        @TEC
         LA    R14,12(0,R14)           SKIP OVER HEADER            @TEC
         SR    R15,R15                 INDEX REGISTER              @TEC
CHNLOOP3 CLC   8(2,R14),=X'FFFF'       CHPID NOT INSTALLED.        @TEC
         BE    CHNLOOP4                                            @TEC
         CLC   4(4,R14),=F'0'          NO CHANNEL ACTIVITY?        @TEC
         BE    CHNLOOP4                IF SO, SKIP IT              @TEC
         L     R4,4(0,R14)             BUSY SAMPLES                @TEC
         S     R4,CHBSYPCT(R15)        MINUS PRIOR                 @TEC
         SRDA  R4,32                                               @TEC
         M     R4,=F'100'                                          @TEC
         DR    R4,R0                                               @TEC
         ST    R5,CHBSYPCT(R15)        SAVE CHANNEL BUSY %         @TEC
CHNLOOP4 LA    R14,12(0,R14)           NEXT CPMT ENTRY             @TEC
         LA    R15,4(0,R15)            NEXT SLOT                   @TEC
         BCT   R3,CHNLOOP3                                         @TEC
         LR    R4,R10
         CLI   PARM,C'D'               DEVICE SCAN ELIMINATE
         BE    *+8                     YES
         BAL   R10,CHKUCB6             CHECK BUSY UCBS
         LR    R10,R4
         L     R14,MAXCHPID            PICK UP HIGHEST CHPID       @TEC
         LA    R5,THRCH1LM             CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH1BS             CHANNEL BUSY TIME THRESHOLD
         LA    R3,CHBSYPCT                                         @TEC
         LA    R4,CHBSYTIM                                         @TEC
         LA    R9,CHPNUMS                                          @TEC
CHNLOOP5 BAL   R11,CHNDISP                                         @TEC
         L     R14,R14SAVE             RESTORE LOOP REGISTER       @TEC
         LA    R3,4(0,R3)              BUSY PCT NEXT CHPID         @TEC
         LA    R4,4(0,R4)              BUSY TIME NEXT CHPID        @TEC
         LA    R9,2(0,R9)              NEXT CHPID NUMBER           @TEC
         LA    R5,8(0,R5)              NEXT PERCENT THRESHOLD      @TEC
         LA    R6,8(0,R6)              NEXT TIME THRESHOLD         @TEC
         BCT   R14,CHNLOOP5                                        @TEC
         BR    R10
CHNDISP  ST    R14,R14SAVE                                         @TEC
         L     R1,0(0,R3)
         C     R1,0(0,R5)              THRESHOLD REACHED
         BL    CHNDISP1                NO
         TIME  BIN
         L     R1,0(0,R4)              OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,0(0,R4)              OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,0(0,R4)              INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BCR   8,R11                   YES
         BP    CHNDISP2
CHNDISP1 XC    0(4,R4),0(R4)
         BR    R11
CHNDISP2 LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             SECONDS
         L     R1,0(0,R3)              PERCENT BUSY
         CVD   R1,DOUBLE
         CVD   R15,DOUBLEX
         C     R15,0(0,R6)             CHANNEL BUSY TIME THRESHOLD
         BCR   4,R11                   NO
         CLI   WJOB1,C' '              1ST PASS
         BNE   CHNDISP3                NO, 2ND HALF
         MVC   WJOB1(38),=CL38'CHANNEL XX   XXX% BUSY  FOR XXXXX SEC'
         MVC   WJOB1+8(2),0(R9)        CHANNEL NUMBER
         MVC   WJOB1+12(4),=X'40202120'
         ED    WJOB1+12(4),DOUBLE+6
         MVC   WJOB1+27(6),=X'402020202120'
         ED    WJOB1+27(6),DOUBLEX+5
         BR    R11
CHNDISP3 MVC   WJOB2(38),=CL38'CHANNEL XX   XXX% BUSY  FOR XXXXX SEC'
         MVC   WJOB2+8(2),0(R9)        CHANNEL NUMBER
         MVC   WJOB2+12(4),=X'40202120'
         ED    WJOB2+12(4),DOUBLE+6
         MVC   WJOB2+27(6),=X'402020202120'
         ED    WJOB2+27(6),DOUBLEX+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R11
CHKCPU   STM   R0,R15,SAVEREGS
         CVD   R15,DOUBLE
         C     R15,THRCPULP            OVER CPU PERCENT THRESHOLD
         BL    CHKCPU2                 NO
         LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             LOOP SECONDS                @TEC
         CVD   R15,DOUBLEX
         C     R15,THRCPULT            OVER CPU THRESHOLD
         BL    CHKCPU3                 NO
         CLI   WJOB1,C' '              1ST PASS
         BNE   CHKCPU1                 NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28' XXX% CPU FOR     XXXXX SEC'
         MVC   WMSG1(4),=X'40202120'
         ED    WMSG1(4),DOUBLE+6
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLEX+5
         B     CHKCPU3
CHKCPU1  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28' XXX% CPU FOR     XXXXX SEC'
         MVC   WMSG2(4),=X'40202120'
         ED    WMSG2(4),DOUBLE+6
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLEX+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         B     CHKCPU3
CHKCPU2  XC    JOBCPUL(4),JOBCPUL
         XC    JOBCPUT(4),JOBCPUT
CHKCPU3  LM    R0,R15,SAVEREGS
         BR    R10
CHKPAG   L     R9,16                   CVT
         L     R9,604(0,R9)            RMCT
         SR    R1,R1
         L     R1,228(0,R9)            RCT                         @TEC
         LH    R1,64(0,R1)             AVERAGE PAGING              @TEC
         C     R1,THRPAGLM             OVER PAGING THRESHOLD
         BH    CHKPAG1                 YES
         XC    PAGHITIM(4),PAGHITIM
         B     CHKPAG3                 CHECK PAGE I/O
CHKPAG1  TIME  BIN
         L     R1,PAGHITIM             OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,PAGHITIM             OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,PAGHITIM             INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BZ    CHKPAG3                 YES
         BP    CHKPAG2
         XC    PAGHITIM(4),PAGHITIM
         B     CHKPAG3                 CHECK PAGE I/O
CHKPAG2  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             SECONDS
         C     R15,THRPAGHI            PAGING HIGH TIME THRESHOLD
         BL    CHKPAG3                 NO, CHECK PAGE I/O
         CVD   R15,DOUBLE
         CLI   WJOB1,C' '
         BNE   CHKPAG2A
         MVC   WJOB1(38),=CL38'EXCESS SYSTEM PAGING FOR    XXXXX SEC'
         MVC   WJOB1+27(6),=X'402020202120'
         ED    WJOB1+27(6),DOUBLE+5
         B     CHKPAG3
CHKPAG2A MVC   WJOB2(38),=CL38'EXCESS SYSTEM PAGING FOR    XXXXX SEC'
         MVC   WJOB2+27(6),=X'402020202120'
         ED    WJOB2+27(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
CHKPAG3  L     R1,16                   CVT
         L     R1,704(0,R1)            ASMVT
         L     R1,8(0,R1)              PART
         LA    R1,80(0,R1)             PART ENTRIES
CHKPAG4  TM    8(R1),X'E0'             PLPA,COMMON OR DUPLEX?
         BZ    CHKPAG6                 NO.
CHKPAG5  LA    R1,96(0,R1)             NEXT PART ENTRY             @TEC
         CLI   8(R1),X'00'             END OF PART
         BE    CHKPAG5A                YES, EXIT
         TM    9(R1),X'80'             NOT IN USE
         BO    CHKPAG5                 YES, GET NEXT
         B     CHKPAG4
CHKPAG5A XC    PAGIOTIM(4),PAGIOTIM
         BR    R10
CHKPAG6  L     R14,56(0,R1)            PARERQTM -   BURST VALUE
         SRL   R14,8                   DIVIDE BY 256
         CVD   R14,DOUBLE
         C     R14,THRPAGTM            OVER PAGE I/O AVG SERV TIME
         BH    CHKPAG7                 YES
         B     CHKPAG5
CHKPAG7  TIME  BIN
         L     R1,PAGIOTIM             OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,PAGIOTIM             OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,PAGIOTIM             INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BCR   8,R10                   YES
         BP    CHKPAG8
         XC    PAGIOTIM(4),PAGIOTIM
         BR    R10
CHKPAG8  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             SECONDS
         C     R15,THRPAGIO            PAGE I/O HIGH TIME THRESHOLD
*                                  REACHED
         BCR   4,R10                   NO, EXIT
         CVD   R15,DOUBLE
         CLI   WJOB1,C' '
         BNE   CHKPAG8A
         MVC   WJOB1(38),=CL38'LOCAL PAGE I/O DEGRADED FOR XXXXX SEC'
         MVC   WJOB1+27(6),=X'402020202120'
         ED    WJOB1+27(6),DOUBLE+5
         BR    R10
CHKPAG8A MVC   WJOB2(38),=CL38'LOCAL PAGE I/O DEGRADED FOR XXXXX SEC'
         MVC   WJOB2+27(6),=X'402020202120'
         ED    WJOB2+27(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R10
CHKREP   L     R1,CURRWAIT             CURRENT WAIT TIME
         C     R1,THRREPWT             OVER REPLY WAIT THRESHOLD
         BCR   4,R10                   NO
         L     R1,16                   CVT
         L     R1,100(0,R1)            UCM BASE
         L     R1,28(0,R1)             1ST ORE
         LA    R1,0(0,R1)
CHKREP1  LTR   R1,R1                   ANY OUTSTANDING REPLIES
         BCR   8,R10                   NO
         CLC   JOBASID(2),24(R1)       ASID MATCH
         BE    CHKREP2                 YES
         L     R1,0(0,R1)              NEXT ORE
         LA    R1,0(0,R1)
         B     CHKREP1
CHKREP2  MVC   0(12,R3),=CL12'REPLY '
         MVC   7(2,R3),4(R1)           REPLY ID
         BR    R10
CHKSRC   LA    R1,SRCTAB
         SR    R15,R15
         IC    R15,41(0,R9)            SWAP REASON CODE
         CH    R15,=H'13'              MAX SWAP REASON CODE
         BCR   2,R10                   OVER MAX
         MH    R15,=H'12'
         LA    R1,0(R15,R1)            SWAP REASON CODE OUTPUT
         MVC   0(12,R3),0(R1)
         BR    R10
CHKFRM   CLC   36(2,R5),=H'1'          MASTER SCHEDULER
         BCR   8,R10                   YES, NO FRAME CHECK
*        CLC   172(4,R5),=F'0'         JOB OR STC/TSU
*        BNE   *+10                    JOB
*        CLI   28(R6),X'01'            TSU OR STC
*        BCR   7,R10                   STC
         L     R1,16                   LOAD CVT ADDR
         L     R1,356(0,R1)            LOAD PVT ADDR
         L     R14,8(R1)           GET ADDR OR AREA IN RIT         @TEC
         L     R0,0(0,R14)         GET ADDR OF FIRST REAL PFTE     @TEC
         L     R1,4(0,R14)         GET ADDR OF LAST REAL PFTE      @TEC
         SR    R1,R0               GET DIFFERENCE                  @TEC
         SRL   R1,5                GET # ENTRIES                   @TEC
         LA    R1,1(0,R1)          ADD IN LAST ONE                 @TEC
         LR    R14,R1              PUT IN PROPER AREA              @TEC
         SR    R1,R1                   CLEAR FRAME COUNT
         LR    R15,R0              FIRST PFTE                      @TEC
CHKFRM1  CLC   18(2,R15),JOBASID       ASID MATCH                  @TEC
         BNE   CHKFRM2                 NO
         LA    R1,1(0,R1)              ADD 1 TO FRAME COUNT
CHKFRM2  LA    R15,16(0,R15)           NEXT PFT
         BCT   R14,CHKFRM1             PROCESS NEXT
         L     R15,JOBFRCNT            JOB FRAME COUNT  (WEIGHTED AVG)
         XC    JOBFRCNT(4),JOBFRCNT
         C     R1,THRFRAME             THRESHOLD REACHED
         BL    CHKFRM3                 NO
         LTR   R15,R15                 ZERO
         BNZ   *+6                     NO
         LR    R15,R1                  FAKE START
         MH    R15,=H'3'               3/4 PREVIOUS
         AR    R1,R15                  1/4 CURRENT
         SRL   R1,2
         ST    R1,JOBFRCNT
         CVD   R1,DOUBLE
         TIME  BIN
         L     R1,JOBFRAME             OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,JOBFRAME             OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,JOBFRAME             INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BCR   8,R10                   YES
         BP    CHKFRM4
CHKFRM3  XC    JOBFRAME(4),JOBFRAME
         BR    R10
CHKFRM4  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             SECONDS
         CVD   R15,DOUBLEX
         C     R15,THRFRMTM            FRAME USAGE TIME THRESHOLD
*                                  REACHED
         BCR   4,R10                   NO
         CLI   WJOB1,C' '              1ST PASS
         BNE   CHKFRM5                 NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28' XXXXX FRAMES FOR XXXXX SEC'
         MVC   WMSG1+17(6),=X'402020202120'
         ED    WMSG1+17(6),DOUBLEX+5
         MVC   WMSG1(6),=X'402020202120'
         ED    WMSG1(6),DOUBLE+5
         BR    R10
CHKFRM5  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28' XXXXX FRAMES FOR XXXXX SEC'
         MVC   WMSG2+17(6),=X'402020202120'
         ED    WMSG2+17(6),DOUBLEX+5
         MVC   WMSG2(6),=X'402020202120'
         ED    WMSG2(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R10
CHKSWP   CLC   36(2,R5),=H'1'          MASTER SCHEDULER
         BCR   8,R10                   YES, NO SWAP CHECK
         CLC   172(4,R5),=F'0'         JOB OR STC/TSU
         BCR   8,R10                   STC OR TSO
         LH    R1,42(0,R9)             SWAP COUNT
         CVD   R1,DOUBLE
         C     R1,THRSWAP              THRESHOLD REACHED
         BCR   4,R10
CHKSWP1  CLI   WJOB1,C' '              1ST PASS
         BNE   CHKSWP2                 NO, 2ND HALF
         MVC   WJOB1(8),JOBNAME
         MVC   WMSG1(28),=CL28'EXCESS SWAP COUNT = XXXXX'
         MVC   WMSG1+19(6),=X'402020202120'
         ED    WMSG1+19(6),DOUBLE+5
         BR    R10
CHKSWP2  MVC   WJOB2(8),JOBNAME
         MVC   WMSG2(28),=CL28'EXCESS SWAP COUNT = XXXXX'
         MVC   WMSG2+19(6),=X'402020202120'
         ED    WMSG2+19(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R10
*-------------------------------------------------------------*    @TEC
* HOW MANY WTO BUFFERS ARE IN USE?                            *    @TEC
*-------------------------------------------------------------*    @TEC
CHKWQE   L     R1,16                   CVT
         L     R1,100(0,R1)            UCM BASE
         SR    R14,R14
         L     R15,52(0,R1)            CURRENT WQE COUNT           @TEC
         CVD   R15,DOUBLE
         M     R14,=F'100'
         LH    R1,238(0,R1)            WQE COUNT LIMIT
         DR    R14,R1                  PERCENT USED
         C     R15,THRWQELM            WQE THRESHOLD LIMIT REACHED
         BCR   4,R10                   NO
         CLI   WJOB1,C' '              1ST PASS
         BNE   CHKWQE1                 NO, 2ND HALF
         MVC   WJOB1(38),=CL38'WTO BUFFER SHORTAGE, WQE COUNT= XXXXX'
         MVC   WJOB1+31(6),=X'402020202120'
         ED    WJOB1+31(6),DOUBLE+5
         BR    R10
CHKWQE1  MVC   WJOB2(38),=CL38'WTO BUFFER SHORTAGE, WQE COUNT= XXXXX'
         MVC   WJOB2+31(6),=X'402020202120'
         ED    WJOB2+31(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R10
*-------------------------------------------------------------*    @TEC
* HOW MUCH SQA IS AVAILABLE? ADD UP TOTAL FREE AS PER FBQE'S  *    @TEC
* AND SUBTRACT GDACSARE.                                      *    @TEC
*-------------------------------------------------------------*    @TEC
CHKSQA   DS    0H
         L     R1,16               CVT                             @TEC
         L     R6,560(0,R1)        GDA                             @TEC
         L     R4,104(0,R6)        LAST FBQE FOR CSA               @TEC
         L     R5,100(0,R6)        1ST FBQE FOR CSA                @TEC
         SR    R3,R3                                               @TEC
         CR    R4,R5               LAST IN CHAIN                   @TEC
         BE    VCDISPB             YES                             @TEC
VCDISPA  A     R3,8(0,R5)          ADD FREE AREA                   @TEC
         L     R5,0(0,R5)          NEXT FBQE                       @TEC
         CR    R4,R5               END OF CHAIN                    @TEC
         BNE   VCDISPA             NO                              @TEC
VCDISPB  A     R3,8(0,R4)          ADD FREE AREA OF LAST           @TEC
         SRL   R3,10                   DIVIDE BY 1K                @TEC
         CVD   R3,DOUBLE                                           @TEC
         SLL   R3,10                                               @TEC
         L     R1,132(0,R6)        SQA+CSA AVAIL                   @TEC
         SR    R1,R3               SUBTRACT CSA                    @TEC
         BP    *+6                 IF NOT NEGATIVE, BYPASS         @TEC
         SR    R1,R1                                               @TEC
         SRL   R1,10                   DIVIDE BY 1K
         CVD   R1,DOUBLEX
CHKSQA4  C     R1,THRSQALM             THRESHOLD REACHED
         BCR   2,R10
CHKSQA5  CLI   WJOB1,C' '              1ST PASS
         BNE   CHKSQA6                 NO, 2ND HALF
         MVC   WJOB1(38),=CL38'SQA AVAIL= XXXXXK, CSA AVAIL= XXXXXK'
         MVC   WJOB1+10(6),=X'402020202120'
         ED    WJOB1+10(6),DOUBLEX+5
         MVC   WJOB1+29(6),=X'402020202120'
         ED    WJOB1+29(6),DOUBLE+5
         BR    R10
CHKSQA6  MVC   WJOB2(38),=CL38'SQA AVAIL= XXXXXK, CSA AVAIL= XXXXXK'
         MVC   WJOB2+10(6),=X'402020202120'
         ED    WJOB2+10(6),DOUBLEX+5
         MVC   WJOB2+29(6),=X'402020202120'
         ED    WJOB2+29(6),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R10
CHKENQ   L     R1,16                   CVT
         L     R1,640(0,R1)            FIRST VALID MAJOR QCB
         ST    R2,SAVEREGS
         B     CHKENQ1+4               1ST MAJOR PROCESS
CHKENQ1  L     R1,0(0,R1)              NEXT MAJOR
         LTR   R1,R1                   EXIST
         BZ    CHKENQ8                 NO, END OF QCBS
         MVC   MAJOR(8),16(R1)         SAVE MAJOR QCB
         L     R14,8(0,R1)             1ST MINOR
         LTR   R14,R14                 EXIST
         BZ    CHKENQ1                 NO
         B     CHKENQ3
CHKENQ2  L     R14,0(0,R14)            NEXT MINOR QCB
         LTR   R14,R14                 EXIST
         BZ    CHKENQ1                 NO
CHKENQ3  L     R15,8(0,R14)            1ST QEL
CHKENQ4  LTR   R15,R15                 EXIST
         BZ    CHKENQ2                 NO
         TM    12(R15),X'80'           SHARED
         BZ    CHKENQ5                 NO
         L     R15,0(0,R15)            NEXT QEL
         LA    R15,0(0,R15)
         B     CHKENQ4
CHKENQ5  C     R15,8(0,R14)            IS EXCL QEL THE 1ST QEL
         BNE   CHKENQ6                 NO
         L     R2,0(0,R15)             NEXT QEL
         LA    R2,0(0,R2)
         LTR   R2,R2                   EXIST
         BZ    CHKENQ2                 NO
CHKENQ6  L     R15,0(0,R15)            NEXT QEL
         LA    R15,0(0,R15)
         LTR   R15,R15                 EXIST
         BZ    CHKENQ2                 NO
         CLC   JOBASID(2),14(R15)      ASID MATCH
         BE    CHKENQ7                 YES, ENQ CONFLICT THIS JOB
         B     CHKENQ6
CHKENQ7  MVC   0(12,R3),=CL12'ENQ'
         MVC   4(8,R3),MAJOR
CHKENQ8  L     R2,SAVEREGS
         BR    R10
CHKALC   L     R1,CURRWAIT             CURRENT WAIT TIME
         C     R1,THRALCWT             OVER ALLOCATION WAIT THRESHOLD
         BCR   4,R10                   NO
         L     R1,16                   CVT
         L     R1,548(0,R1)            AQTOP
         L     R14,0(0,R1)             1ST QUEUE ELEMENT
CHKALC1  CR    R1,R14                  END OF CHAIN
         BCR   8,R10                   YES, NOT IN ALLOCATION
         SR    R15,R15
         LH    R15,22(0,R14)           ASID
         CH    R15,JOBASID             ASID MATCH
         BE    CHKALC2
         L     R14,0(0,R14)            NEXT QUEUE ELEMENT
         B     CHKALC1
CHKALC2  MVC   0(12,R3),=CL12'ALLOC QUEUE'
         BR    R10
*-------------------------------------------------------------*    @TEC
* INITIALIZE UCBTAB. CLEAR COUNT FIELDS IF NO ACTIVITY.       *    @TEC
*-------------------------------------------------------------*    @TEC
CHKUCB   STM   R0,R15,SAVEREGS
         MVC   UCBTABND(2),=X'FFFF'
         LA    R6,UCBTAB-16                                        @TEC
CHKUCB0  LA    R6,16(0,R6)                                         @TEC
         CLC   0(2,R6),=X'FFFF'        END OF TABLE
         BE    CHKUCB9                 YES
         CLI   12(R6),X'00'            BUSY PERCENT?               @TEC
         BNE   CHKUCB0                 NO
         XC    4(12,R6),4(R6)
         B     CHKUCB0
*-------------------------------------------------------------*    @TEC
* (RE)BUILD UCBTAB. FILL IN ADDRESSES OF ONLINE DASD.         *    @TEC
*-------------------------------------------------------------*    @TEC
CHKUCB1  XC    UCBDMSAV(24),UCBDMSAV
         STM   R0,R15,SAVEREGS
         L     R9,CVTPTR               CVT ADDR                    @TEC
         L     R9,CVTUCBSC-CVTMAP(R9)  LOOKUP ROUTINE ADDRESS      @TEC
         XC    WKAREA(100),WKAREA      CLEAR WORK AREA             @TEC
         LA    R1,WKAREA               SETUP PARAMETER LIST        @TEC
         ST    R1,PLIST                                            @TEC
         LA    R1,=X'20'               SPECIFY DASD                @TEC
         ST    R1,PLIST+4                                          @TEC
         LA    R1,ADDR                 WORD TO PUT ADDRESS OF UCB  @TEC
         ST    R1,PLIST+8                                          @TEC
         OI    PLIST+8,X'80'           31 BIT PARM END SET         @TEC
CHKUCB1A BAL   R10,UCBDML#0            GET NEXT UCB ADDR
         LTR   R1,R1                   END OF UCBS
         BZ    CHKUCB9                 YES, EXIT
         CLI   18(R1),X'20'            DASD
         BNE   CHKUCB1A                NO
         TM    3(R1),X'88'             ONLINE/ALLOCATED
         BNO   CHKUCB1A                NO
         LA    R6,UCBTAB-16                                        @TEC
CHKUCB2  LA    R6,16(0,R6)             NEXT UCB ENTRY              @TEC
         CLC   0(2,R6),=X'FFFF'        END OF UCB TABLE
         BE    CHKUCB3                 YES, CHECK FOR EMPTY SLOT
         CLM   R1,7,1(R6)              UCB ADDR MATCH              @TEC
         BNE   CHKUCB2                 NO
         B     CHKUCB5
CHKUCB3  LA    R6,UCBTAB-16                                        @TEC
CHKUCB4  LA    R6,16(0,R6)             NEXT UCB ENTRY              @TEC
         CLC   0(2,R6),=X'FFFF'        END OF UCB TABLE
         BE    CHKUCB1A                YES, NEXT UCB
         CLC   0(2,R6),=X'0000'        EMPTY SLOT
         BNE   CHKUCB4                 NO, NEXT ENTRY
CHKUCB5  STCM  R1,7,1(R6)              SAVE UCB ADDR               @TEC
         MVI   0(R6),X'FF'             SLOT IN USE                 @TEC
*        L     R1,8(0,R6)
*        LA    R1,1(0,R1)
*        ST    R1,8(0,R6)
         B     CHKUCB1A
*-------------------------------------------------------------*    @TEC
* UPDATE COUNT AND BUSY FIELDS FOR ONLINE DASD UCBS.          *    @TEC
*-------------------------------------------------------------*    @TEC
CHKUCB6  STM   R0,R15,SAVEREGS
         LA    R6,UCBTAB-16                                        @TEC
CHKUCB7  LA    R6,16(0,R6)                                         @TEC
         CLC   0(2,R6),=X'FFFF'        END OF UCB TABLE
         BE    CHKUCB9                 YES, EXIT
         CLC   0(2,R6),=X'0000'        EMPTY SLOT                  @TEC
         BE    CHKUCB7                 YES. SKIP IT.               @TEC
         SR    R1,R1
         ICM   R1,7,1(R6)              UCB ADDR                    @TEC
         LA    R3,UCBNRDY
         LA    R4,THRUCBNR
         TM    6(R1),X'40'             NOT READY
         BO    CHKUCB7A
         LA    R3,UCBBUSY
         LA    R4,THRUCBBS
         SR    R14,R14
         LH    R15,8(0,R6)             UCB SCAN COUNT              @TEC
         LA    R15,1(0,R15)                                        @TEC
         STH   R15,8(0,R6)             UPDATE SCAN COUNT           @TEC
         TM    6(R1),X'8A'             BUSY AND/OR CHANNEL PROGRAM @TEC
         BZ    CHKUCBNB                NO                          @TEC
         LR    R15,R1                  UCB ADDRESS                 @TEC
         S     R15,=F'4'                                           @TEC
         L     R15,0(0,R15)            IOQ ADDRESS                 @TEC
         LTR   R15,R15                 ANY IOQ                     @TEC
         BZ    CHKUCBB                 NO. CALL IT BUSY            @TEC
         L     R15,8(0,R15)            IOSB ADDRESS                @TEC
         LTR   R15,R15                 ANY IOSB                    @TEC
         BZ    CHKUCBB                 NO. CALL IT BUSY            @TEC
         CLI   4(R15),X'0E'            SUSPEND/RESUME?             @TEC
         BE    CHKUCBNB                SAY NOT BUSY                @TEC
CHKUCBB  DS    0H                                                  @TEC
         LH    R15,10(0,R6)            UCB BUSY COUNT              @TEC
         LA    R15,1(0,R15)                                        @TEC
         STH   R15,10(0,R6)            UPDATE BUSY COUNT           @TEC
CHKUCBNB DS    0H                                                  @TEC
         LH    R14,10(0,R6)            BUSY COUNT                  @TEC
         SRDA  R14,32                                              @TEC
         M     R14,=F'100'             TIMES 100                   @TEC
         LR    R14,R15                                             @TEC
         SRDA  R14,32                                              @TEC
         LH    R0,8(0,R6)              SCAN COUNT                  @TEC
         DR    R14,R0                  R15 = PERCENT BUSY          @TEC
         SR    R1,R1
*        IC    R1,12(0,R6)             CUMULATIVE PERCENT          @TEC
*        LTR   R1,R1                   ZERO
*        BNZ   *+6                     NO
*        LR    R1,R15                  FAKE START
*        MH    R1,=H'3'                3/4 PREVIOUS
*        AR    R1,R15                  1/4 CURRENT
*        SRL   R1,2
         STC   R15,12(0,R6)             NEW CUM PERCENT            @TEC
         C     R15,THRUCBLM            THRESHOLD REACHED
         BL    CHKUCB7B                NO
*-------------------------------------------------------------*    @TEC
* SAVE TIME WHEN DASD EXCEEDS BUSY THRESHOLD.                 *    @TEC
*-------------------------------------------------------------*    @TEC
CHKUCB7A TIME  BIN
         L     R1,4(0,R6)              OLD TIME
         LTR   R1,R1                   ANY OLD TIME
         BNZ   *+8                     YES
         ST    R0,4(0,R6)              OLD TIME = NEW TIME
         LR    R1,R0                   BINARY TIME
         S     R1,4(0,R6)              INTERVAL TIME
         LTR   R1,R1                   TIME EQUAL 0
         BZ    CHKUCB7                 YES
         BP    CHKUCB8
*-------------------------------------------------------------*    @TEC
* ZERO TIME IF DASD NOT ABOVE BUSY THRESHOLD.                 *    @TEC
*-------------------------------------------------------------*    @TEC
CHKUCB7B XC    4(4,R6),4(R6)
         B     CHKUCB7
*-------------------------------------------------------------*    @TEC
* DISPLAY MESSAGE FOR DASD NOT READY OR TOO BUSY.             *    @TEC
*-------------------------------------------------------------*    @TEC
CHKUCB8  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'             SECONDS
         SR    R1,R1
         IC    R1,12(0,R6)             BUSY PERCENT.               @TEC
         CVD   R1,DOUBLE
         CVD   R15,DOUBLEX
         C     R15,0(0,R4)             TIME THRESHOLD REACHED
         BL    CHKUCB7                 NO
         CLI   WJOB1,C' '              1ST PASS
         BNE   CHKUCB8A                NO, 2ND HALF
         MVC   WJOB1(38),0(R3)
         SR    R1,R1
         ICM   R1,7,1(R6)              UCB ADDR                    @TEC
         MVC   WJOB1(3),13(R1)         DEVICE ADDRESS
         MVC   WJOB1+4(6),28(R1)       DEVICE VOLSER
         MVC   WJOB1+27(6),=X'402020202120'
         ED    WJOB1+27(6),DOUBLEX+5
         LA    R1,UCBNRDY
         CR    R1,R3                   NOT READY MESSAGE
         BE    CHKUCB7                 YES, NO PERCENT
         MVC   WJOB1+12(4),=X'40202120'
         ED    WJOB1+12(4),DOUBLE+6
         B     CHKUCB7
CHKUCB8A MVC   WJOB2(38),0(R3)
         SR    R1,R1
         ICM   R1,7,1(R6)              UCB ADDR                    @TEC
         MVC   WJOB2(3),13(R1)         DEVICE ADDRESS
         MVC   WJOB2+4(6),28(R1)       DEVICE VOLSER
         MVC   WJOB2+27(6),=X'402020202120'
         ED    WJOB2+27(6),DOUBLEX+5
         LA    R1,UCBNRDY
         CR    R1,R3                   NOT READY MESSAGE
         BE    CHKUCB8B                YES, NO PERCENT
         MVC   WJOB2+12(4),=X'40202120'
         ED    WJOB2+12(4),DOUBLE+6
CHKUCB8B LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         B     CHKUCB7
CHKUCB9  LM    R0,R15,SAVEREGS
         BR    R10
CHKQIO   XC    UCBDMSAV(24),UCBDMSAV
         MVC   QIOASID(2),JOBASID      SAVE ASID
         STM   R0,R15,SAVEREGS
         L     R9,CVTPTR               CVT ADDR                    @TEC
         L     R9,CVTUCBSC-CVTMAP(R9)  LOOKUP ROUTINE ADDRESS      @TEC
         XC    WKAREA(100),WKAREA      CLEAR WORK AREA             @TEC
         LA    R1,WKAREA               SETUP PARAMETER LIST        @TEC
         ST    R1,PLIST                                            @TEC
         LA    R1,=X'20'               SPECIFY DASD                @TEC
         ST    R1,PLIST+4                                          @TEC
         LA    R1,ADDR                 WORD TO PUT ADDRESS OF UCB  @TEC
         ST    R1,PLIST+8                                          @TEC
         OI    PLIST+8,X'80'           31 BIT PARM END SET         @TEC
CHKQIO1  BAL   R10,UCBDML#0            GET NEXT UCB ADDR
         LTR   R1,R1                   END OF UCBS
         BZ    CHKQIO8A                YES, EXIT                   @TEC
         B     CHKQIO2
CHKQIO2  LR    R2,R1                   UCB ADDR
         CLI   18(R1),X'20'            DASD
         BE    *+18                    YES
         L     R4,20(0,R1)             UCB EXTENTION ADDR
         CLC   QIOASID(2),14(R4)       ASID MATCH
         BNE   CHKQIO1                 NO, NEXT UCB
         LR    R4,R1                   UCB ADDR
         S     R4,=F'4'                DECR ADDR -4
         L     R4,0(0,R4)              IOQ ADDR
         LA    R4,0(0,R4)
         LTR   R4,R4                   ANY IOQ
         BZ    CHKQIO1                 NO, NEXT UCB
         L     R5,8(0,R4)              IOSB ADDR
         LA    R5,0(0,R5)
         LTR   R5,R5                   EXIST
         BZ    CHKQIO1                 NO, NEXT UCB
         B     CHKQIO9
CHKQIO8  MVC   0(12,R3),=CL12'I/O ON'
         MVC   8(3,R3),13(R2)
CHKQIO8A LM    R0,R15,SAVEREGS
         BR    R10
CHKQIO9  C     R2,16(0,R5)             UCB ADDR MATCH
         BNE   CHKQIO8A                NO, EXIT
         CLC   QIOASID(2),6(R5)        ASID MATCH
         BE    CHKQIO8                 YES
         B     CHKQIO1
UCBDML#0 DS    0H
         ST    R8,UCBDMSAV             SAVE WORK REG 1
         ST    R10,UCBDMSAV+8          SAVE WORK REG 3
         ST    R11,UCBDMSAV+12         SAVE WORK REG 4
UCBLOOP1 L     R9,CVTPTR               CVT ADDR                    @TEC
         L     R9,CVTUCBSC-CVTMAP(R9)  LOOKUP ROUTINE ADDRESS      @TEC
         LA    R1,PLIST                POINT AT PARM LIST          @TEC
         LR    R15,R9                  GET MODULE ADDRESS          @TEC
         BALR  R14,R15                 CALL MVS                    @TEC
         LTR   R15,R15                 UCB FOUND?                  @TEC
         BZ    UCBFND                  YES.                        @TEC
         SR    R1,R1                   SAY THAT'S ALL.             @TEC
         B     UCBDMCON                AND GO HOME.                @TEC
UCBFND   DS    0H
         L     R1,ADDR                 GET ADDR OF UCB             @TEC
         L     R8,UCBDMLOW             SET SEARCH ARGUMENT
         SPACE 1
UCBDML#1 LA    R8,1(0,R8)              NEXT UNIT ADDR POSSIBLE
         L     R10,=X'0000FFFF'        SET MAX NEXT LEAST HIGH
         SPACE 1
UCBDML#2 LTR   R1,R1                   MORE UCBS?                  @TEC
         BZ    UCBDMOUT                NO, GO PROCESS
         SPACE 1
UCBDML#4 TM    6(R1),X'8A'             BUSY AND/OR CHANNEL PROGRAM
         NOP   UCBLOOP1                NO, NEXT UCB                @TEC
         TM    18(R1),X'20'            DASD?                       @TEC
         BZ    UCBLOOP1                NO. SKIP IT.                @TEC
         BAL   R11,UCBDMCNV            CONVERT UNIT ADDR TO HEX
         CR    R0,R8                   UNIT EQUAL                  @TEC
         BL    UCBLOOP1                LOW NOT EQUAL, NEXT UCB     @TEC
         LR    R10,R0                  SET NEXT LEAST HIGH UNIT AD @TEC
         ST    R1,UCBDMCUR             SET NEXT LEAST HIGH UCB ADD @TEC
         B     UCBDMOUT                GO PROCESS
UCBDMCNV SR    R14,R14
         SR    R15,R15
         IC    R15,13(0,R1)            UNIT ADDR DIGIT
         TM    13(R1),X'F0'            NUMERIC
         BO    *+8                     YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)            SET VALUE TO COVER A-F
         SLL   R15,28                  SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4                   INSERT INTO RESULTS REGISTER
         IC    R15,14(0,R1)            UNIT ADDR DIGIT
         TM    14(R1),X'F0'            NUMERIC
         BO    *+8                     YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)            SET VALUE TO COVER A-F
         SLL   R15,28                  SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4                   INSERT INTO RESULTS REGISTER
         IC    R15,15(0,R1)            UNIT ADDR DIGIT
         TM    15(R1),X'F0'            NUMERIC
         BO    *+8                     YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)            SET VALUE TO COVER A-F
         SLL   R15,28                  SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4                   INSERT INTO RESULTS REGISTER
         LR    R0,R14                  SET RESULTS REG             @TEC
         BR    R11
         SPACE 3
UCBDMOUT C     R10,=X'0000FFFF'        ALL DONE
         BE    UCBDMEX                 YES
         ST    R10,UCBDMLOW            NEXT LOW UNIT ADDR
         L     R1,UCBDMCUR             LOAD UCB ADDR FOR FOUND UNIT
         B     UCBDMCON                CONTINUE
         SPACE 1
UCBDMEX  SR    R1,R1                   CLEAR UCB ADDR REGISTER
         L     R8,UCBDMSAV             RELOAD WORK REG 1
         L     R10,UCBDMSAV+8          RELOAD WORK REG 3
         L     R11,UCBDMSAV+12         RELOAD WORK REG 4
         B     UCBDMRET                END OF UCBS
         SPACE 1
UCBDMCON L     R8,UCBDMSAV             RELOAD WORK REG 1
         L     R10,UCBDMSAV+8          RELOAD WORK REG 3
         L     R11,UCBDMSAV+12         RELOAD WORK REG 4
         SPACE 1
UCBDMRET EQU   *
         BR    R10
         USING *,R15
STAEXIT  CH    R0,=H'12'               SDWA GOTTEN
         BE    STAEXIT1                NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)         SAVE REGISTER
         LR    R14,R13                 SAVE ORIG R13
         L     R13,0(R1)               GET ESTAE PARM
         L     R2,XSASAVE              GET XSA ADDRESS
         LR    R13,R14                 RESTORE R13
         ICM   R2,15,XAL-XSA(R2)       GET PARM ADDRESS
         BZ    ESTNOP                  IF NO PARMS THEN SKIP DATA
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC  SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX  MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2)  MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19     SET LENGTH OF DATA
         B     ESTNOP                  SKIP CONSTANTS
         ESTMODS ,                     GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8)  GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)         GET RETRY ADDRESS
         LA    R3,ESTMODS              POINT AT NAMES
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,  GLA-BFG          X
               RECORD=YES,RECPARM=(3),REGS=(14,12)  GLA-BFG
STAEXIT1 L     R0,=A(STAERTRY)         LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         USING *,R15
STAERTRY L     R12,=A(CSCGE03D)        LOAD ENTRY POINT ADDR
         LR    R13,R1                  RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG              ADDRESSING ERROR
         L     R2,XSASAVE              RELOAD XSA ADDR
         LA    R11,RETURN              LOAD RET ADDR
MSGRTN   SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R11
RETURN   CLI   WJOB1,C' '              ANY OUTPUT
         BE    EXIT                    NO
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
EXIT     ESTAE 0
         LA    R8,AMODE24                                          @TEC
         BSM   0,R8                                                @TEC
AMODE24  DS    0H                                                  @TEC
         L     R0,SIZE                 LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13                  LOAD GETMAIN AREA ADDR
         L     R2,SAVRET               RETURN ADDR
         FREEMAIN  R,LV=(0),A=(1)
*        MODESET KEY=NZERO,MODE=PROB
         SR    R15,R15
         LR    R14,R2
         BR    R14
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
UCBNRDY  DC    CL38'XXX XXXXXX   NOT READY  FOR XXXXX SEC'
UCBBUSY  DC    CL38'XXX XXXXXX   XXX% BUSY  FOR XXXXX SEC'
         DS    0F
STAEMSG  DC    X'00540100'
         DC    CL80'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
SRMOVLY  DS    0CL84
         DC    XL4'00540100'
         DC    CL5'TSO-',CL10' '
         DC    CL6'LGCP-',CL7' '
         DC    CL6'AVCP-',CL7' '
         DC    CL6'AVPG-',CL7' '
         DC    CL7'AVUIC-',CL7' '
         DC    CL6'ASMQ-',CL6' '
CHPNUMS  DC    C'000102030405060708090A0B0C0D0E0F'                 @TEC
         DC    C'101112131415161718191A1B1C1D1E1F'                 @TEC
SRCTAB   DC    CL12' '
         DC    CL12'*'
         DC    CL12'*'
         DC    CL12'SWAP LONGWT '
         DC    CL12'SWAP AUXSTOR'
         DC    CL12'SWAP REALSTR'
         DC    CL12'SWAP DETWAIT'
         DC    CL12'SWAP REQUEST'
         DC    CL12'SWAP ENQEXC '
         DC    CL12'SWAP WORKEXC'
         DC    CL12'SWAP UNILATR'
         DC    CL12'SWAP TRANSIT'
         DC    CL12'*'
         DC    CL12'*'
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                     *
*                                                                     *
*        THRESHOLD VALUES FOR ALL DISPLAY LIMITS                      *
*                                                                     *
*                                                                     *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         DS    0D
THRINTVL DC    CL8'00001000'          10 SEC STIMER FOR CHANNEL BUSY
THRSTIMR DC    F'20'                   CHANNEL BUSY STIMER REPETITIONS
***   THE ABOVE VALUES MULTIPLIED TOGETHER GIVE THE MINIMUM
***   REFRESH FOR THIS COMMAND
THRTSOPG DC    F'2'                    TSO PERFORMANCE GROUP       @TEC
THRSWAP  DC    F'30'                   HIGH SWAP COUNT THRESHOLD
THRFRAME DC    F'200'                  HIGH FRAME USE LIMIT
*  SET THRFRAME LOWER IF PAGING IS HIGH   = 100 ?
THRFRMTM DC    F'60'                   HIGH FRAME USE TIME THRESHOLD
THRABEND DC    F'10'                   JOB ABENDING TIME THRESHOLD
THRLOOPP DC    F'05'                   LOOP CPU PERCENT THRESHOLD
THRLOOPT DC    F'30'                   LOOP TIME THRESHOLD
THRCPULP DC    F'20'                   EXCESS JOB CPU PERCENT THRESHOLD
THRCPULT DC    F'10'                   EXCESS JOB CPU TIME THRESHOLD
THRSWPWT DC    F'180'                  SWAP WAIT TIME THRESHOLD
THRREPWT DC    F'30'                   REPLY WAIT TIME THRESHOLD
THRALCWT DC    F'30'                   ALLOCATION WAIT TIME THRESHOLD
THRWQELM DC    F'60'                   HIGH WQE PERCENT USE THRESHOLD
THRSQALM DC    F'64'                   SQA SHORTAGE MIN 'K' THRESHOLD
THRPAGHI DC    F'60'                   HIGH PAGING TIME THRESHOLD
THRPAGLM DC    F'50'                   HIGH PAGING PAGES/SEC LIMIT
THRPAGIO DC    F'30'                   PAGE I/O SLOW TIME THRESHOLD
THRPAGTM DC    F'60'                   PAGE I/O SLOW BURST LIMIT
THRUCBNR DC    F'30'                   DEVICE NOT READY THRESHOLD
THRUCBBS DC    F'30'                   DEVICE BUSY THRESHOLD TIME
THRUCBLM DC    F'25'                   DEVICE BUSY LIMIT PERCENT
* CHANNEL LIMITS ARE SET TO 35% FOR DISK AND 70% FOR TAPE
THRCH1BS DC    F'20'                   CHANNEL 1 PERCENT BUSY THRESHOLD
THRCH1LM DC    F'20'                   CHANNEL 1 PERCENT BUSY LIMIT
         DC    64A(1)                                              @TEC
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
DOUBLEX  DS    2F
MAJOR    DS    2F
NUMCHK   DS    2F
PARM     DS    F
QIOASID  DS    F
XSASAVE  DS    F
SAVETIM1 DS    F
SAVETIM2 DS    F
SAVECPU1 DS    F
SAVECPU2 DS    F
CURRWAIT DS    F
UCBDMSAV DS    4F
UCBDMLOW DS    F
UCBDMCUR DS    F
PLIST    DS    3F                                                  @TEC
ADDR     DS    F                                                   @TEC
WKAREA   DS    0D,XL100                                            @TEC
         DS    F
MAXCHPID DS    F                                                   @TEC
R14SAVE  DS    F                                                   @TEC
         DS    0F
WTOLIST  DS    F
JOBMSG   DS    0CL80
WJOB1    DS    CL8
         DS    CL2
WMSG1    DS    CL15
         DS    CL1
WRSN1    DS    CL12
         DS    CL4
WJOB2    DS    CL8
         DS    CL2
WMSG2    DS    CL15
         DS    CL1
WRSN2    DS    CL12
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0F
JOBTABLE DSECT
PAGHITIM DS    F
PAGIOTIM DS    F
CHBSMPCT DS    F                       CHANNEL BUSY SAMPLE COUNT   @TEC
CHBSYTIM DS    32F                                                 @TEC
CHBSYPCT DS    32F                                                 @TEC
*-------------------------------------------------------------*    @TEC
* A TABLE OF SAVED INFO ABOUT UCBS:                           *    @TEC
* 00-00 A FLAG. X'FF' IF THE SLOT IS IN USE                   *    @TEC
* 01-03 UCB ADDRESS                                           *    @TEC
* 04-07 TIME THE UCB WAS FIRST NOTICED AS BUSY                *    @TEC
* 08-09 COUNT OF HOW MANY TIMES UCB HAS BEEN SCANNED          *    @TEC
* 10-11 COUNT OF HOW MANY TIMES UCB HAS BEEN FOUND BUSY       *    @TEC
* 12-12 CUMULATIVE PERCENT BUSY                               *    @TEC
* 13-15 UNUSED.                                               *    @TEC
*-------------------------------------------------------------*    @TEC
UCBTAB   DS    100CL16                                             @TEC
UCBTABND DS    F
JOBNAME  DS    CL8
JOBASID  DS    H
JOBFLAG  DS    H
JOBTIME  DS    F
JOBCPUT  DS    F
JOBEXCP  DS    F
JOBLOOP  DS    F
JOBCPUL  DS    F
JOBWAIT  DS    F
JOBFRAME DS    F
JOBFRCNT DS    F
JOBABEND DS    F
         DS    499CL48
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
XAA      DS    F
         IHASDWA
         CVT   DSECT=YES                                           @TEC
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCGF03D
         TITLE 'ESAGF03D -   F  DISPLAY STORAGE USAGE'             @TEC
         PRINT NOGEN                                               @TEC
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SP1GF03D -       F  DISPLAY STORAGE USAGE                 ***
***                                                                 ***
***       VERSION -        2.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        07/22/81  AXC-CBT HANDLE ESTAE           ***
***                        09/04/91  JCL-TEC                        ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
CSCGF03D CSECT
         LR    R12,R15
         USING CSCGF03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         L     R1,XAA
         ST    R1,JOBTABAD
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                          @TEC
         BSM   0,R9                                                @TEC
AMODE31  DC    A(CONT31+X'80000000')                               @TEC
CONT31   DS    0H                                                  @TEC
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L     * ESTAE PARM FIX        *
ESTAEOVX EQU   *-ESTAEOVL          * ESTAE PARM FIX        *
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL  * ESTAE PARM FIX        *
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
*-------------------------------------------------------------*    @TEC
* CALCULATE INTERVAL SINCE LAST INVOCATION (IF ANY)           *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R4,JOBTABAD         POINT TO TIME
         TIME  BIN
         L     R6,4(0,R4)          PREVIOUS TIME
         LR    R5,R0               CURRENT TIME
         SR    R5,R6               INTERVAL TIME
         ST    R0,4(0,R4)
         LTR   R6,R6               1ST TIME
         BZ    PFTLIST
         ST    R5,0(0,R4)          SAVE INTERVAL TIME
*-------------------------------------------------------------*    @TEC
* FORMAT SYSTEM-WIDE VARIABLES                                *    @TEC
*-------------------------------------------------------------*    @TEC
PFTLIST  MVC   OUTMSG(4),=X'00540100'
         L     R14,16              LOAD CVT ADDR
         L     R6,556(0,R14)       LOAD ASVT ADDR
         L     R7,516(0,R6)        MAX NO. OF ASCBS
         LA    R6,524(0,R6)        1ST ASCB SLOT
         L     R3,356(0,R14)       LOAD PVT ADDR
         L     R14,8(R3)           GET ADDR OR AREA IN RIT         @TEC
         L     R4,0(0,R14)         GET ADDR OF FIRST REAL PFTE     @TEC
         L     R5,4(0,R14)         GET ADDR OF LAST REAL PFTE      @TEC
         SR    R5,R4               GET DIFFERENCE                  @TEC
         SRL   R5,5                GET # ENTRIES                   @TEC
         LA    R5,1(0,R5)          ADD IN LAST ONE                 @TEC
         STM   R4,R5,PFTREGS       SAVE PFT REGS
         LR    R14,R5              PUT IN PROPER AREA              @TEC
         ST    R14,TOTFRMS
         CVD   R14,DOUBLE          CONVERT TO DECIMAL
         MVI   OUTMSG+4,C' '
         MVC   OUTMSG+5(79),OUTMSG+4
         MVC   OUTMSG+4(12),=CL12'TOTAL'
         MVC   OUTMSG+12(6),=X'402020202120'
         ED    OUTMSG+12(6),DOUBLE+5
         L     R14,16              LOAD CVT ADDR                   @TEC
         L     R4,560(0,R14)       GET GDA ADDRESS                 @TEC
         L     R14,152(0,R4)       GET GDAESQA                     @TEC
         L     R15,144(0,R4)       GET GDASQA                      @TEC
         A     R15,148(0,R4)       GDASQA + GDASQASZ               @TEC
         SR    R14,R15             SIZE OF NUCLEUS                 @TEC
         SRL   R14,12              GET NUMBER OF FRAMES            @TEC
         AH    R14,1830(0,R3)      TOTAL FIXED
         L     R1,TOTFRMS
         SR    R1,R14              TOTAL PAGABLE
         ST    R1,TOTFRMS          TOTAL PAGABLE
         CVD   R1,DOUBLE
         MVC   OUTMSG+24(12),=CL12'PAGABLE'
         MVC   OUTMSG+32(6),=X'402020202120'
         ED    OUTMSG+32(6),DOUBLE+5
         L     R14,16              CVT
         L     R14,604(0,R14)      RMCT
         L     R1,4(0,R14)         CCT                             @TEC
         LH    R1,104(0,R1)        LONG TERM CPU UTIL              @TEC
         SRL   R1,8                SCALED BY 256?                  @TEC
         CVD   R1,DOUBLE
         MVC   OUTMSG+44(14),=CL14'LGCPU='
         MVC   OUTMSG+50(4),=X'40202120'
         ED    OUTMSG+50(4),DOUBLE+6
         L     R1,4(0,R14)         CCT                             @TEC
         LH    R1,102(0,R1)        AVERAGE CPU                     @TEC
         CVD   R1,DOUBLE
         MVC   OUTMSG+58(14),=CL14'AVCPU='
         MVC   OUTMSG+64(4),=X'40202120'
         ED    OUTMSG+64(4),DOUBLE+6
         L     R1,228(0,R14)       RCT                             @TEC
         LH    R1,54(0,R1)         AVERAGE UIC                     @TEC
         CVD   R1,DOUBLE
         MVC   OUTMSG+72(12),=CL12'AVUIC='
         MVC   OUTMSG+78(4),=X'40202120'
         ED    OUTMSG+78(4),DOUBLE+6
         L     R1,228(0,R14)       RCT                             @TEC
         LH    R1,64(0,R1)         AVERAGE PAGING                  @TEC
         ST    R1,AVPAG
         SR    R2,R2
         BAL   R11,PGPRINT
         MVI   OUTMSG+4,C' '
         MVC   OUTMSG+5(79),OUTMSG+4
         L     R10,=X'0000FFFF'
         BAL   R11,PAGEPRNT        GO COUNT AND FORMAT
         MVI   OUTMSG+4,C' '
         MVC   OUTMSG+5(79),OUTMSG+4
         L     R2,XSASAVE
*-------------------------------------------------------------*    @TEC
* LOOP OVER ALL ASCB'S                                        *    @TEC
*-------------------------------------------------------------*    @TEC
GETASCB  LA    R6,4(0,R6)          NEXT SLOT
         BCT   R7,ASCBFND          GO PROCESS
         B     PAGEPJP             GO OUTPUT RESULTS
RETURN   EQU   *
         LA    R8,AMODE24                                          @TEC
         BSM   0,R8                                                @TEC
AMODE24  DS    0H                                                  @TEC
         ESTAE 0
         L     R0,SIZE
         LR    R1,R13              WORK AREA ADDR
         L     R14,SAVRET          LOAD RETURN ADDR
         FREEMAIN  R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
*-------------------------------------------------------------*    @TEC
* PROCESS DATA FOR ONE ADDRESS SPACE                          *    @TEC
*-------------------------------------------------------------*    @TEC
ASCBFND  TM    0(R6),X'80'         AVAILABLE SLOT
         BO    GETASCB             YES, GET NEXT SLOT
         L     R8,0(0,R6)          LOAD ASCB ADDR
         SR    R10,R10             LOAD
         IC    R10,36(0,R8)
         SLL   R10,8               ASID
         IC    R10,37(0,R8)
         BAL   R11,PAGEPRNT        GO COUNT AND FORMAT
         L     R2,XSASAVE
         B     GETASCB
*-------------------------------------------------------------*    @TEC
* CALCULATE ADDRESS SPACE'S INTERVAL PAGING RATE.             *    @TEC
*-------------------------------------------------------------*    @TEC
JPAGE    L     R14,16              LOAD CVT ADDR
         L     R14,556(0,R14)      LOAD ASVT ADDR
         LA    R14,524(0,R14)      1ST ASCB SLOT
         SLL   R10,2
         LA    R14,0(R10,R14)      THIS ASID ASCB SLOT
         LR    R10,R2              JOB TABLE SLOT THIS ASID
         L     R8,0(0,R14)         ASCB ADDR
         L     R2,JOBTABAD         POINT TO TIME
         L     R2,0(0,R2)          INTERVAL TIME
         L     R1,148(0,R8)        OUXB ADDR
         LA    R1,0(0,R1)
         LTR   R1,R1               VALID ADDR
         BCR   8,R11               NO
         ST    R1,SAVEOUXB
         CLC   0(24,R10),=24X'00'  1ST TIME
         BNE   JPAGE2              NO
JPAGE1   L     R1,SAVEOUXB
         MVC   0(24,R10),16(R1)    SAVE OUXB PAGING ACCUM FIELDS
         BR    R11
JPAGE2   LTR   R2,R2               1ST TIME
         BCR   8,R11
         L     R14,16(0,R1)        CURR PAGEIN
         S     R14,0(0,R10)        SUB PREV PAGEIN
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         LR    R15,R14             ACCUMULATE
         L     R14,20(0,R1)        CURR PAGEOUT
         S     R14,4(0,R10)        SUB PREV PAGEOUT
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         AR    R15,R14             ACCUMULATE
         L     R14,24(0,R1)        CURR PAGE RECLAIM
         S     R14,8(0,R10)        SUB PREV PAGE RECLAIM
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         SR    R15,R14             ACCUMULATE
         L     R14,28(0,R1)        CURR VIO PAGEIN
         S     R14,12(0,R10)       SUB PREV VIO PAGEIN
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         AR    R15,R14             ACCUMULATE
         L     R14,32(0,R1)        CURR VIO PAGEOUT
         S     R14,16(0,R10)       SUB PREV VIO PAGEOUT
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         AR    R15,R14             ACCUMULATE
         L     R14,36(0,R1)        CURR VIO RECLAIM
         S     R14,20(0,R10)       SUB PREV VIO RECLAIM
         LTR   R14,R14             OVERFLOW
         BM    JPAGE4              YES
         SR    R15,R14             ACCUMULATE
         SR    R14,R14
         M     R14,=F'100'
         DR    R14,R2              PAGES PER SEC
         CVD   R15,DOUBLE
         LR    R1,R15
         MVC   OUTMSG+25(10),=X'402021204B2020404040'
         ED    OUTMSG+25(4),DOUBLE+6
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R2              HUNDREDTHS
         CVD   R15,DOUBLE
         UNPK  OUTMSG+30(2),DOUBLE+6(2)
         OI    OUTMSG+31,X'F0'
         SLL   R1,1
         C     R15,=F'50'          ROUND UP GRAPH
         BL    *+8                 NO
         LA    R1,1(0,R1)
         LR    R15,R1
         C     R15,=F'45'
         BNH   *+8
         L     R15,=F'45'
         LTR   R15,R15
         BNP   *+6
         BCTR  R15,0
         LA    R1,OUTMSG+39(R15)
         MVI   0(R1),C'>'
         EX    R15,PAGMVE
         CLC   OUTMSG+32(6),=C'      '
         BE    JPAGE3A
         MVI   OUTMSG+32,C' '
         MVC   OUTMSG+33(50),OUTMSG+32
         MVC   OUTMSG+26(6),=C'  0.00'
         B     JPAGE1
JPAGE3A  CLC   OUTMSG+26(6),=C'  0.00'
         BNE   JPAGE1
         MVC   OUTMSG+38(2),=C'  '
         B     JPAGE1
JPAGE4   MVC   OUTMSG+25(18),=CL18'   0 '
         B     JPAGE1
PAGMVE   MVC   OUTMSG+38(0),PAGGRAPH
*-------------------------------------------------------------*    @TEC
* COUNT FRAMES BELONGING TO AN ADDRESS SPACE                  *    @TEC
*-------------------------------------------------------------*    @TEC
PAGEPRNT LM    R4,R5,PFTREGS       LOAD PFT REGS
         SR    R14,R14             CLEAR FRAME COUNT
         SR    R9,R9               CLEAR AVAILABLE FRAME COUNT
         SPACE 3
PAGEPR1  SR    R15,R15
         ICM   R15,3,18(R4)        LOAD PFT ASID                   @TEC
         CR    R10,R15             ASID MATCH
         BNE   PAGEPR2             NO, DONT INCR FRAME COUNT
         LA    R14,1(0,R14)        ADD 1 TO FRAME COUNT
         LA    R2,1
         SPACE 3
PAGEPR2  LA    R4,32(0,R4)         NEXT PFT                        @TEC
         BCT   R5,PAGEPR1          PROCESS NEXT
         C     R10,=X'00000001'    MASTER
         BE    ASIDMSTR            YES, GO PRINT MASTER
         C     R10,=X'0000FFFF'    SYS PAGES
         BNE   PAGEPR3             NO, ASID
         L     R15,AVPAG           AVERAGE PAGING
         CVD   R15,DOUBLE
         MVC   OUTMSG+4(12),=CL12'*SYSTEM*'
         MVC   OUTMSG+27(12),=CL12'AVPAG='
         MVC   OUTMSG+33(5),=X'4020212040'
         ED    OUTMSG+33(4),DOUBLE+6
         CH    R15,=H'46'
         BNH   *+8
         LH    R15,=H'46'          FORCE MAX
         EX    R15,SYSMVE
         LA    R15,OUTMSG+38(R15)
         MVI   0(R15),C'>'
         B     PAGEPR4
         SPACE 1
SYSMVE   MVC   OUTMSG+38(0),SYSGRAPH
PAGEPR3  LTR   R14,R14             ANY FRAMES
         BCR   8,R11               NO, BYPASS PRINT
         CH    R10,=H'256'         MAX ASID ALLOWED                @TEC
         BCR   2,R11               OVER MAX
         MH    R10,=H'28'          COUNT AREA SIZE
         A     R10,JOBTABAD        POINT TO ASID COUNT SLOTS
         ST    R14,24(0,R10)       SAVE FRAME COUNT
         BR    R11
         SPACE 3
PAGEPR4  CVD   R14,DOUBLE
         MVC   OUTMSG+12(6),=X'402020202120'
         ED    OUTMSG+12(6),DOUBLE+5
         CLC   OUTMSG+4(3),=C'AS  '
         BE    JOBFIND
PGPRINT  L     R1,TOTFRMS          LOAD TOTAL PAGABLE FRAMES
         LTR   R2,R2               DATA LINE
         BZ    PRINT               NO
         CVB   R15,DOUBLE
         SR    R14,R14
         M     R14,=F'100'
         DR    R14,R1
         LA    R15,1(0,R15)
         CVD   R15,DOUBLE          PERCENT FRAMES
         MVC   OUTMSG+19(5),=X'402021206C'
         ED    OUTMSG+19(4),DOUBLE+6
         SPACE 3
PRINT    LA    R1,OUTMSG           LOAD OUTPUT MSG ADDR
         SR    R0,R0
         L     R2,XSASAVE
         IC    R0,XAU
         SVC   35
         BR    R11
         SPACE 3
ASIDMSTR DS    0H
         MVC   OUTMSG+4(12),=CL12'*MASTER*'
         B     PAGEPR4
PAGEPJP  L     R2,JOBTABAD         JOB TABLE
         LA    R1,256              MAX ASID                        @TEC
         SR    R10,R10
         XC    HIGHFRAM(4),HIGHFRAM
         XC    HIGHJCNT(4),HIGHJCNT
         XC    HIGHASID(4),HIGHASID
PAGEPJP1 LA    R2,28(0,R2)         NEXT JOB ENTRY
         LA    R10,1(0,R10)        ASID
         L     R14,24(0,R2)        FRAME COUNT
         LTR   R14,R14             GOOD FRAME COUNT
         BNP   PAGEPJP2            NO
         C     R14,HIGHFRAM        HIGHER
         BL    PAGEPJP2            ANY FRAMES
         ST    R14,HIGHFRAM        HIGH FRAME COUNT
         ST    R10,HIGHASID        HIGH ASID
         ST    R2,HIGHJCNT         HIGH COUNT ADDR
PAGEPJP2 BCT   R1,PAGEPJP1
         L     R2,HIGHJCNT
         LTR   R2,R2               END OF OUTPUT
         BZ    RETURN              YES
         L     R10,HIGHASID
PAGEPJP3 ST    R10,SAVEASID
         MVI   OUTMSG+4,C' '
         MVC   OUTMSG+5(79),OUTMSG+4
         MVC   OUTMSG+4(12),=CL12'AS  '
         XC    24(4,R2),24(R2)     CLEAR FRAME COUNT
         BAL   R11,JPAGE           CALCULATE JOB INTERVAL PAGING
         L     R10,SAVEASID
         L     R14,HIGHFRAM
         STH   R10,DOUBLE+6
         UNPK  DOUBLE(5),DOUBLE+6(3)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   OUTMSG+7(4),DOUBLE  ASID TO MSG
         LA    R2,1
         BAL   R11,PAGEPR4
         B     PAGEPJP
*-------------------------------------------------------------*    @TEC
* MOVE JOBNAME INTO OUTPUT MESSAGE.                           *    @TEC
*-------------------------------------------------------------*    @TEC
JOBFIND  EQU   *
         L     R9,56(0,R8)         CSCB ADDR
         CLI   28(R9),X'03'        INIT
         BE    JOBFIND1            YES, GO SEARCH
JOBFIND0 MVC   OUTMSG+4(8),8(R9)   JOBNAME
         MVI   OUTMSG+12,C' '
         B     PGPRINT
JOBFIND1 LA    R1,0(0,R9)          SAVE ADDR
         SR    R14,R14             LOAD
         IC    R14,30(0,R9)
         SLL   R14,8               ASID
         IC    R14,31(0,R9)
JOBFIND2 L     R9,0(0,R9)          NEXT CSCB
         LA    R9,0(0,R9)
         LTR   R9,R9               END OF CHAIN
         BNZ   JOBFIND3            NO, CONTINUE
         LR    R9,R1               USE ORIG CSCB
         B     JOBFIND0
JOBFIND3 CR    R9,R1               END OF CHAIN
         BE    JOBFIND0            YES, USE ORIG CSCB
         CH    R14,30(0,R9)        ASID EQUAL
         BE    JOBFIND0            YES, USE THIS CSCB
         B     JOBFIND2
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
**************************************************************
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE
*  OPERANDS, REGISTERS, AND PSW IN IT.
**************************************************************
         STM   R14,R12,12(R13)     SAVE REGISTER
         LR    R14,R13             SAVE ORIG R13
         L     R13,0(R1)           GET ESTAE PARM
         L     R2,XSASAVE          GET XSA ADDRESS
         LR    R13,R14             RESTORE R13
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC  SET TO VRA
*                                  AND EBCDIC
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX  MOVE HEADER
         MVC   SDWAVRA+11-SDWA(8,1),0(R2)  MOVE IN DATA
         MVI   SDWAURAL-SDWA(1),19  SET LENGTH OF DATA
         B     ESTNOP              SKIP CONSTANTS
         ESTMODS ,
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8)
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS
         LA    R3,ESTMODS          POINT AT NAMES
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,                   X
               RECORD=YES,RECPARM=(3),REGS=(14,12)
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         USING *,R15
STAERTRY L     R12,=A(CSCGF03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     RETURN
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
PAGGRAPH DC    C'0=1=2=3=4=5=6=7=8==10========15========20========='
SYSGRAPH DC    C'0=========1=========2=========3=========4========='
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
DOUBLE2  DS    2F
XSASAVE  DS    F
AVPAG    DS    F
AVASQ    DS    F
HIGHASID DS    F
HIGHJCNT DS    F
HIGHFRAM DS    F
SAVEASID DS    F
SAVEOUXB DS    F
JOBTABAD DS    F
TOTFRMS  DS    F
PFTREGS  DS    2F
         DS    0F
OUTMSG   DS    84C
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0F
*-------------------------------------------------------------*    @TEC
* A TABLE OF 28-BYTE ENTRIES FOR SCANNED ASID'S:              *    @TEC
*                                                             *    @TEC
*  00-03 INTERVAL TIME                                        *    @TEC
*  04-07 PREVIOUS INVOCATION TIME                             *    @TEC
*  00-23 OUXB PAGING ACCUMULATOR FIELDS (OUXB+X'10')          *    @TEC
*  23-27 JOB FRAME COUNT                                      *    @TEC
*-------------------------------------------------------------*    @TEC
JOBTAB   DSECT
JOBOUXB  DS    256XL28                                             @TEC
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
XAA      DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCGH03D
         TITLE 'CSCGH03D -   TSO GRAPHIC MONITOR HELP'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CSCGH03D -       TSO GRAPHIC MONITOR HELP                 ***
***                                                                 ***
***       VERSION -        2.5                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        07/19/81  AXC-CBT FIX ESTAE              ***
***                        09/27/82  AXC-CBT ADD 3375 AND 3380      ***
***                                  SUPPORT                        ***
***                                                                 ***
***       UPDATED -        09/16/91  REMOVE REFERENCE TO Q GRAPHIC  ***
***                                  MONITOR COMMAND                ***
***                                                                 ***
***********************************************************************
***********************************************************************
CSCGH03D CSECT
         LR    R12,R15
         USING CSCGH03D,R12
         L     R0,SIZE
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         L     R3,XAL              LOAD SUB-PARM ADDR
         MVC   WTOLIST(4),=X'00340100'
         LA    R4,CMDTAB           LOAD COMMAND HELP TABLE ADDR
         LTR   R3,R3               ANY PARMS
         BZ    PRINT               NO, LEVEL 1 HELP
         SPACE 3
PARM     CLC   0(1,R3),0(R4)       TABLE MATCH
         BE    PRINT               YES, USE IT
         LA    R4,4(0,R4)          NEXT ENTRY
         CLI   0(R4),X'00'         END OF TABLE
         BNE   PARM                NO, CONTINUE
         LA    R1,ERRMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     RETURN
PRINT    L     R5,0(0,R4)          LEVEL 2 HELP LIST
         SPACE 3
PRINT1   MVC   WTOLIST+4(48),0(R5)
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         LA    R5,48(0,R5)         NEXT MSG
         CLI   0(R5),X'00'         END OF MSGS
         BNE   PRINT1              NO, CONTINUE
RETURN   EQU   *
         ESTAE 0
         L     R0,SIZE             LOAD FREEMAIN SIZE
         LR    R1,R13              LOAD FREEMAIN ADDR
         L     R14,SAVRET          LOAD RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14                 EXIT
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(CSCGH03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     RETURN
         LTORG
         SPACE 5
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
ERRMSG   DC    X'00340100'
         DC    CL48'HELP NOT AVAILABLE FOR THIS COMMAND, ENTER  H'
         SPACE 3
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
CMDTAB   DS    0F
         DC    C'H',AL3(HDRTAB)
         DC    C'A',AL3(ATAB)
         DC    C'E',AL3(ETAB)
         DC    C'F',AL3(FTAB)
         DC    C'I',AL3(ITAB)
         DC    C'J',AL3(JTAB)
         DC    C'O',AL3(OTAB)
*        DC    C'Q',AL3(QTAB)                                      @TEC
         DC    C'S',AL3(STAB)
         DC    C'U',AL3(UTAB)
         DC    C'#',AL3(#TAB)
         DC    F'0'
HDRTAB   DS    0F
         DC    CL48'ENTER  H X  FOR HELP WITH COMMAND  X'
         DC    CL48'H -   (GH)  DISPLAY HELP                       '
         DC    CL48'A -   (GA)  DISPLAY JOB ACTIVITY               '
         DC    CL48'E -   (GE)  DISPLAY EXCEPTIONS                 '
         DC    CL48'F -   (GF)  DISPLAY PAGE STATISTICS BY JOB     '
         DC    CL48'J -   (GJ)  DISPLAY CPU UTILIZATION            '
         DC    CL48'I -   (GI)  DISPLAY JES2 INITIATORS            '
         DC    CL48'O -   (GO)  DISPLAY SYSTEM I/O ACTIVITY        '
*        DC    CL48'Q -   (GQ)  DISPLAY JES QUEUE  (MODIFIED Q CMD)'
         DC    CL48'S -   (GS)  DISPLAY SYSTEM INDICATORS          '
         DC    CL48'U -   (GU)  DISPLAY DASD FREE SPACE            '
         DC    CL48'# -   (SM)  DISPLAY HELP # COMMANDS            '
         DC    CL48' '
         DC    CL48'FOLLOWING ARE FULL SCREEN POSITIONING COMMANDS.'
         DC    CL48'-NNN        SCROLL UP NNN LINES                '
         DC    CL48'+NNN        SCROLL DOWN NNN LINES              '
         DC    CL48'-           SCROLL TO TOP                      '
         DC    CL48'+           SCROLL TO BOTTOM                   '
         DC    CL48'=YXXXY      FIND STRING EQ XXX, Y IS DELIMITER '
         DC    F'0'
ATAB     DS    0F
 DC    CL48'ANNNN       DISPLAY JOB ACTIVITY  FOR ASID NNNN'
 DC    CL48'            GRAPHIC DISPLAY OF -               '
 DC    CL48'            JOBNAME,  STEPNAME,  PERCENT CPU   '
 DC    CL48'            PERCENT CPU,                       '
 DC    CL48'            PAGE FRAME ALLOCATION,             '
 DC    CL48'            PAGING IN PAGES PER SECOND,        '
 DC    CL48'            AVERAGE JOB CPU UTILIZATION,       '
 DC    CL48'            AVERAGE REAL FRAME USAGE,          '
 DC    CL48'            CURRENT SWAP COUNT,                '
 DC    CL48'            JOB I/O ACTIVITY.                  '
 DC    CL48'            JOB EXCEPTIONS AS FOLLOWS -        '
 DC    CL48'            POSSIBLE LOOPS,                    '
 DC    CL48'            ABEND IN PROGRESS,                 '
 DC    CL48'            WAITING ON REPLIES,                '
 DC    CL48'            WAITING ON ALLOCATION,             '
 DC    CL48'            WAITING ON ENQUEUE CONFLICTS,      '
 DC    CL48'            WAITING ON I/O PENDING,            '
 DC    CL48'            WAITING TO BE SWAPPED IN.          '
 DC    F'0'
ETAB     DS    0F
 DC    CL48'E -         DISPLAY ALL EXCEPTIONS              '
 DC    CL48'ED -        DISPLAY EXCEPTIONS (NOT DEVICE)     '
 DC    CL48'EC -        DISPLAY EXCEPTIONS (NOT CHAN/DEVICE)'
 DC    CL48'            AUTOMATIC REFRESH MINIMUM 10 SEC    '
 DC    CL48'                                                '
 DC    CL48'            EXCEPTIONAL SYSTEM CONDITIONS -     '
 DC    CL48'            EXCESS PAGING AND PAGE I/O BUSY,    '
 DC    CL48'            EXCESS DEVICE UTILIZATION,          '
 DC    CL48'            EXCESS CHANNEL UTILIZATION.         '
 DC    CL48'                                                '
 DC    CL48'            EXCEPTIONAL JOB CONDITIONS -        '
 DC    CL48'            POSSIBLE LOOPS,                     '
 DC    CL48'            ABEND IN PROGRESS,                  '
 DC    CL48'            EXCESS JOB CPU UTILIZATION,         '
 DC    CL48'            EXCESS REAL FRAME USAGE,            '
 DC    CL48'            EXCESS SWAP COUNT,                  '
 DC    CL48'            WAITING ON REPLIES,                 '
 DC    CL48'            WAITING ON ALLOCATION,              '
 DC    CL48'            WAITING ON ENQUEUE CONFLICTS,       '
 DC    CL48'            WAITING ON I/O PENDING,             '
 DC    CL48'            WAITING TO BE SWAPPED IN.           '
 DC    F'0'
FTAB     DS    0F
 DC    CL48'F -         DISPLAY PAGE STATISTICS BY JOB     '
 DC    CL48'            GRAPHIC DISPLAY OF -               '
 DC    CL48'            PAGE FRAME ALLOCATION BY JOB AND   '
 DC    CL48'            PAGING BY JOB IN PAGES PER SECOND. '
 DC    F'0'
JTAB     DS    0F
 DC    CL48'JD -        DISPLAY CPU UTILIZATION            '
 DC    CL48'            GRAPHIC DISPLAY OF -               '
 DC    CL48'            ALL ACTIVE DOMAINS.                '
 DC    CL48'                                               '
 DC    CL48'J -         DISPLAY CPU UTILIZATION            '
 DC    CL48'            GRAPHIC DISPLAY OF -               '
 DC    CL48'            JOBNAME,  STEPNAME,  PERCENT CPU   '
 DC    CL48'            UTILIZATION FOR ACTIVE JOBS.       '
 DC    CL48'                                               '
 DC    CL48'JT -        DISPLAY CPU UTILIZATION            '
 DC    CL48'            GRAPHIC DISPLAY OF -               '
 DC    CL48'            JOBNAME,  STEPNAME,  PERCENT CPU   '
 DC    CL48'            UTILIZATION FOR ACTIVE TSO USERS.  '
 DC    CL48'                                               '
 DC    CL48'JNN -       DISPLAY CPU UTILIZATION            '
 DC    CL48'            GRAPHIC DISPLAY OF -               '
 DC    CL48'            JOBNAME,  STEPNAME,  PERCENT CPU   '
 DC    CL48'            UTILIZATION FOR ALL JOBS IN DMN XX.'
 DC    CL48'                                               '
 DC    F'0'
ITAB     DS    0F
 DC    CL48'I -         DISPLAY JES2 INITIATORS            '
 DC    CL48'            DISPLAY OF -                       '
 DC    CL48'            INITIATOR STATUS,                  '
 DC    CL48'            JOB NUMBER,                        '
 DC    CL48'            JOBNAME,                           '
 DC    CL48'            JOB CLASS,                         '
 DC    CL48'            INITIATOR CLASSES.                 '
 DC    F'0'
OTAB     DS    0F
         DC    CL48'OXNN -      DISPLAY SYSTEM I/O ACTIVITY        '
         DC    CL48'            WHERE -                            '
         DC    CL48'              X -   SCAN TYPE                  '
         DC    CL48'                    A -   ALL DEVICES          '
         DC    CL48'                    V -   DASD AND TAPE        '
         DC    CL48'                    D -   DASD                 '
         DC    CL48'                    T -   TAPE                 '
         DC    CL48'                    U -   UNIT RECORD          '
         DC    CL48'                    C -   COMM AND DISPLAY     '
         DC    CL48'              NN -  PERCENT BUSY THRESHOLD     '
         DC    CL48'                    20% BUSY IS THE DEFAULT    '
         DC    F'0'
STAB     DS    0F
         DC    CL48'S -         DISPLAY SYSTEM INDICATORS          '
         DC    CL48'            GRAPHIC DISPLAY OF -               '
         DC    CL48'            CURRENT AVERAGE CPU,               '
         DC    CL48'            CURRENT LONG TERM CPU,             '
         DC    CL48'            CURRENT AVERAGE PAGING,            '
         DC    CL48'            CURRENT AVERAGE UIC,               '
         DC    CL48'            CURRENT AVERAGE ASMQ LENGTH,  AND  '
         DC    CL48'            CURRENT MPL FOR EACH DOMAIN        '
         DC    CL48'            CONTAINING RUNNING JOBS.           '
         DC    CL48'                                               '
         DC    CL48'SA -        DISPLAY SYSTEM INDICATORS          '
         DC    CL48'            GRAPHIC DISPLAY OF -               '
         DC    CL48'            AVERAGE AVERAGE CPU,               '
         DC    CL48'            AVERAGE LONG TERM CPU,             '
         DC    CL48'            AVERAGE AVERAGE PAGING,            '
         DC    CL48'            AVERAGE AVERAGE UIC,               '
         DC    CL48'            AVERAGE AVERAGE ASMQ LENGTH,  AND  '
         DC    CL48'            CURRENT MPL FOR EACH DOMAIN        '
         DC    CL48'            CONTAINING RUNNING JOBS.           '
         DC    F'0'
UTAB     DS    0F
         DC    CL48'U           DISPLAY DASD SPACE ALL ONLINE DASD '
         DC    CL48'U VVVV      DISPLAY DASD SPACE ON VOLUME VVVV  '
         DC    CL48'            WHERE VVVV IS A 1-6 DIGIT VOLSER OR'
         DC    CL48'            VOLSER PREFIX                      '
         DC    CL48'U U=NNN     DISPLAY DASD SPACE ON UNIT NNN     '
         DC    CL48'U D=XXXX    DISPLAY DASD SPACE ON DEVTYPE XXXX '
         DC    CL48'            (3330,3330V,3330-1,3350,2305-2,    '
         DC    CL48'             3375,3380)                        '
         DC    CL48'                                               '
         DC    CL48'            DISPLAY OF -                       '
         DC    CL48'            UNIT, DEVTYPE, STATUS, VOLSER,     '
         DC    CL48'            NO. OF DCBS OPEN, NO. OF USERS,    '
         DC    CL48'            FREE CYLS, FREE TRKS, FREE EXTENTS,'
         DC    CL48'            LARGEST CONTIG EXTENT CYL/TRK      '
         DC    F'0'
#TAB     DS    0F
         DC    CL48'ENTER  #H X  FOR HELP WITH COMMAND  X'
         DC    CL48'       L= NN    DIRECTS COMMAND OUTPUT TO       '
         DC    CL48'                CONSOLE WITH ID =  NN           '
         DC    CL48'       T= NNN   SETS TIME LIMIT IN SECONDS FOR  '
         DC    CL48'                MONITOR COMMANDS   1 - 999      '
         DC    CL48'       S= XXXX  DIRECTS THE COMMAND TO SYSTEM   '
         DC    CL48'                XXXX AND THE OUTPUT BACK TO     '
         DC    CL48'                THE ORIGINATOR.                 '
         DC    CL48'#A -   (SE)  DISPLAY JOB STATUS -  EXPANDED  D A'
         DC    CL48'#C -   (SK)  CALCULATOR, TOD, AND MSTCONS SWITCH'
         DC    CL48'#D -   (SD)  DISPLAY AND ZAP CORE               '
         DC    CL48'#E -   (SS)  EXECUTE AN OPERATOR COMMAND        '
         DC    CL48'#F -   (SF)  DISPLAY PAGE FRAME ASSIGNMENTS     '
         DC    CL48'#H -   (SM)  DISPLAY HELP                       '
         DC    CL48'#I -   (SJ)  DISPLAY IPS AND SWAP COUNTS        '
         DC    CL48'#J -   (SL)  MODIFIED DISPLAY ACTIVE REPLACEMENT'
         DC    CL48'#L -   (SC)  DISPLAY LINES FOR TSO              '
         DC    CL48'#M -   (SO)  TSO MULTIPLE SEND                  '
         DC    CL48'#N -   (SA)  DISPLAY ENQUEUE                    '
         DC    CL48'#O -   (SR)  DISPLAY PENDING I/O AND ALLOCATION '
         DC    CL48'#P -   (SP)  DISPLAY SU CONFIGURATION           '
         DC    CL48'#Q -   (SQ)  ANALYZE ENQUEUE CONFLICTS          '
         DC    CL48'#R -   (SG)  DISPLAY DEVICE STATUS              '
         DC    CL48'#S -   (SH)  DISPLAY LPA MODULES                '
         DC    CL48'#T -   (SN)  DISPLAY TIOT AND EXCP COUNTS BY DD '
         DC    CL48'#V -   (SI)  DISPLAY UNIT                       '
         DC    CL48'##A -  (ZA)  MONITOR JOB ACTIVITY               '
         DC    CL48'##B -  (ZB)  MONITOR DEVICE BUSY                '
         DC    CL48'##C -  (ZC)  MONITOR CHANNEL BUSY               '
         DC    CL48'##J -  (ZJ)  MONITOR JOBS                       '
         DC    CL48'##P -  (ZP)  MONITOR PAGING                     '
         DC    CL48'##S -  (ZS)  MONITOR SYSTEM INDICATORS          '
         DC    F'0'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    F
XSASAVE  DS    F
         SPACE 3
         DS    0F
WTOLIST  DS    CL54
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0D
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCGI03D
         TITLE 'CSCGI03D -   I  JES2 INIT DISPLAY'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CSCGI03D -       I  JES2 INIT DISPLAY                     ***
***                                                                 ***
***       VERSION -        1.2                                      ***
***                                                                 ***
***       MVS LEVEL -      UP TO MVS/SP1.3                          ***
***                                                                 ***
***       UPDATED -        03/24/83                                 ***
***                                                                 ***
***       NOTE -           WHEN YOU GET AN ASSEMBLE ERROR OF 12     ***
***                        AT THE CSECT SDWA JUST IGNORE THE ERROR  ***
***                        YOU WILL BE OKAY.                        ***
***                        THE ERROR MESSAGE (AT LEAST FROM ASMBLER ***
***                        H) IS 'PREVIOUS USE OF SYMBOL IS NOT     ***
***                        THIS SECTION TYPE'.                      ***
***                                                                 ***
***                                                                 ***
***       ADD MACRO CALLED $DEB BECAUSE THE $SJB MACRO NOW          ***
***           REFERENCES DEB FIELDS WHICH MEANS THAT THE $DEB       ***
***           MACRO MUST PRECEDE THE $SJB MACRO FOR ASSEMBLER F.    ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
CSCGI03D CSECT
         LR    R12,R15
         USING CSCGI03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         USING CVTDSECT,R1        SETUP CVT BASE
         USING JESCT,R6           SETUP JESCT BASE
         USING SSCT,R3            SETUP SSCT BASE
         USING SSVT,R4            SETUP SSVT BASE
         USING PITDSECT,R5        SETUP PIT BASE
         USING SJBDSECT,R11       SETUP SJB BASE
         LA    R1,ALINE1          PRINT HEADING LINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         LA    R1,ALINE2          PRINT HEADING LINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         LA    R1,ALINE3          PRINT HEADING LINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         MVI   LSW,C' '
CONTINUE L     R1,16              GET CVT
         L     R6,296(R1)         GET JESCT    (JES CONTROL TABLE)
         L     R3,JESSSCT         GET FIRST JES SSCT (SSCVT)
         SPACE 1
NEXTSSCT L     R4,SSCTSSVT        GET JES SSVT
         L     R5,$SVPIT          GET PIT ADDR--5.302 JES LOGIC+MAINT
         SPACE 1
NEXTPIT  MVC   IDENT(40),=CL40' ' CLEAR DETAIL LINE
         MVC   CLINEX(4),=X'00540100'
         TM    PITSTAT,PITHOLDA   PIT DRAINED $PI ?
         BNO   *+10               IF NOT CONTINUE
         MVC   STAT(6),=CL6'DRAIN'   MOVE IN DRAINED STATUS
         TM    PITSTAT,PITHOLD1   PIT DRAINED $P IN ?
         BNO   *+10               IF NOT CONTINUE
         MVC   STAT(6),=CL6'DRAIN'   MOVE IN DRAINED STATUS
         TM    PITSTAT,PITHALTA   PIT HALTED  $Z I ?
         BNO   *+10               IF NOT CONTINUE
         MVC   STAT(6),=CL6'HALT'    MOVE IN HALTED STATUS
         TM    PITSTAT,PITHALT1   PIT HALTED  $Z IN ?
         BNO   *+10               IF NOT CONTINUE
         MVC   STAT(6),=CL6'HALT'    MOVE IN HALTED STATUS
         TM    PITSTAT,PITINIT    OS INIT EXISTS FOR PIT?
         BNO   *+10               IF NOT CONTINUE
         MVC   STAT(6),=CL6'INACT'   MOVE IN INACTIVE
         TM    PITSTAT,PITBUSY    PIT BUSY ?
         BNO   *+10               IF NOT CONTINUE
         MVC   STAT(6),=CL6'ACTIV'   MOVE IN ACTIVE
         TM    PITSTAT,PITIDLE    PIT IDLE ?
         BNO   *+10               IF NOT CONTINUE
         MVC   STAT(6),=CL6'IDLE'     MOVE IN IDLE
         CLC   STAT(6),=6C' '        STATUS NOT AVAILABLE ?
         BNE   *+10               IF NOT CONTINUE
         MVC   STAT(6),=CL6'?????'   MOVE IN STATUS NOT AVAIL.
         MVC   IDENT(2),PITPATID     MOVE ID IN---FORMAT CL2
         MVC   INITNAM(8),PITCLASS   MOVE THE INIT CLASSES TO OUTPUT
         CLI   IDENT,C' '
         BNE   *+8
         MVI   IDENT,C'0'
*
*    &MAXCLAS PARAMETER ON GEN LIMITS MAX CLASSES, ABOVE MAY NEED
*    TO BE CHANGED IF OTHER THAN 8 CLASSES.
*
         TM    PITSTAT,PITBUSY    PIT BUSY ?
         BNO   PRINT              IF NOT CONTINUE
         L     R11,PITSJB         GET SJB ADDRESS
         MVC   JOBNAME(8),SJBJOBNM   GET JOBNAME FROM JOB CARD
         MVC   JOBNUM(4),SJBJOBID+4  GET JOBID FROM JOB CARD
         MVI   UCLASS,C'('
         MVI   UCLASS+2,C')'
         MVC   UCLASS+1(1),SJBJCLAS    GET USED CLASS
PRINT    CLI   LSW,C' '           CHECK PRINT SW FOR LEFT SIDE
         BE    MOVELEFT           MOVE IN LEFT PRINT AREA
         CLI   LSW,C'1'           CHECK PRINT SW FOR RIGHT SIDE
         BE    MOVERIGT           MOVE IN RIGHT PRINT AREA
         LA    R1,STAEMSG         WRITE ERROR LINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     FINAL              END IF ERROR
         SPACE 1
PUTIT    LA    R1,CLINEX          WRITE MESSAGE LINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         MVI   LSW,C' '           RESET PRINT SWITCH
         B     NEXTIT             GET NEXT PIT
         SPACE 1
FINAL    CLI   LSW,C' '           CHECK IF LAST DATA FILLED
         BE    EXIT               IF DONE, DON'T WRITE
         CLI   LSW,C'1'           CHECK IF LEFT ONLY FILLED
         BE    SPRIGHT            GO TO SPACE-RIGHT
         SPACE 1
LASTWR   LA    R1,CLINEX          WRITE MESSAGE LINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT
         SPACE 1
MOVELEFT MVC   LSW,=C'1'          SET LEFT PRINT FLAG
         MVC   CLEFT(40),PLINE        MOVE IN LEFT SIDE
         SPACE 1
NEXTIT   L     R5,PITNEXT         GET NEXT PIT---REFER 5.200 JES2
         LTR   R5,R5              CHK R5 FOR VALID ADDR
         BZ    FINAL              END PROCESS FOR SSCT
         B     NEXTPIT            GO BACK
         SPACE 1
SPRIGHT  MVC   CRIGHT(40),=CL40' ' MOVE SPACES TO RIGHT
         B     LASTWR             GO TO LAST WRITE
         SPACE 1
MOVERIGT MVC   LSW,=C'2'          SET FULL PRINT FLAG
         MVC   CRIGHT(40),PLINE       MOVE IN RIGHT SIDE
         B     PUTIT              GO TO WRITE LINE
EXIT     ESTAE 0
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(CSCGI03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         SPACE 3
CTLERROR LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
ALINE1   DC    X'00540100'
         DC    C'INITIATOR   JOB           JOB  INIT     '
         DC    C'INITIATOR   JOB           JOB  INIT     '
         SPACE 3
         DS    0F
ALINE2   DC    X'00540100'
         DC    C'ID  STATUS  NUM  JOBNAME  CLS  CLASS    '
         DC    C'ID  STATUS  NUM  JOBNAME  CLS  CLASS    '
         SPACE 3
         DS    0F
ALINE3   DC    X'00540100'
         DC    C'--------------------------------------  '
         DC    C'--------------------------------------  '
         SPACE 3
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
WORK     DSECT
WORKSTRT DS    0D
DOUBLE   DS    2F
SAVRET   DS    F
XSASAVE  DS    F
LSW      DS    C                  LINE PRINT SWITCH
*
* LSW ' ' IS NO FILLED, '1' IS LEFT FILLED, '2' IS BOTH FILLED
*
         SPACE 3
PLINE    DS    0CL40
IDENT    DS    CL4
STAT     DS    CL7
JOBNUM   DS    CL6
JOBNAME  DS    CL9
UCLASS   DS    CL5
INITNAM  DS    CL9
         SPACE 3
         DS    0F
CLINEX   DS    F
CLINE    DS    0CL80
CLEFT    DS    CL40
CRIGHT   DS    CL40
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X
         SPACE 3
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
XAA      DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         $DEB               GEN $DEB
         $SJB               GEN $SJB
         $PIT               GEN $PIT
         PRINT OFF
         $CVT               GEN $CVT
         $JESCT             GEN $JESCT
         $SSCT              GEN $SSCT
         $SVT               GEN $SVT
         END
./       ADD   NAME=CSCGJ03D
         TITLE 'ESAGJ03D -   J  JOB MONITOR'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CSCGJ03D -       J  JOB MONITOR                           ***
***                                                                 ***
***       VERSION -        1.1                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.1                            ***
***                                                                 ***
***       UPDATED -        09/01/79                                 ***
***                        09/04/91 31-BIT ADDR.                    ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
CSCGJ03D CSECT
         LR    R12,R15
         USING CSCGJ03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                          @TEC
         BSM   0,R9                                                @TEC
AMODE31  DC    A(CONT31+X'80000000')                               @TEC
CONT31   DS    0H                                                  @TEC
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         MVI   TSOSW,C' '
         XC    JOBTOT2(8),JOBTOT2
         XC    DMNTAB(200),DMNTAB
         MVC   DMNTAB+200(200),DMNTAB
         MVC   DMNTAB+400(200),DMNTAB
         MVC   DMNTAB+600(200),DMNTAB
         L     R3,XAL              PARM LIST ADDR
         LA    R3,0(0,R3)
         LTR   R3,R3               ANY PARM
         BZ    PARM2               NO
         MVC   TSOSW(2),0(R3)      SAVE PARM
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'T'          TSO DISPLAY
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'J'          JOB DISPLAY
         BE    PARM1               YES, CONTINUE
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),TSOSW
         CLC   DOUBLE(2),=C'00'    DOMAIN DISPLAY
         BNE   PARM1
         PACK  DOUBLE(8),TSOSW(2)
         CVB   R1,DOUBLE
         STC   R1,DOMAIN           SAVE DOMAIN
         MVI   TSOSW,C'X'
         B     PARM2
         SPACE 1
PARM1    MVI   TSOSW,C' '
         SPACE 1
PARM2    MVC   WTOLIST(4),=X'00540100'
         MVI   SCANRET,C' '        SET FOUND
         MVI   SCANTYPE,C'I'       SET IN QUEUE SCAN
SETINIT  L     R4,16               CVT
         L     R4,556(0,R4)        ASVT
         LA    R4,524(0,R4)        ASCB SLOT ADDR
         L     R8,XAA              ASCB/OUCB INFO STORAGE
         USING JOBTABLE,R8
         SPACE 1
SETINIT1 CLC   0(16,R8),=4F'0'     1ST TIME
         BNE   SETINIT3            NO
         SPACE 1
SETINIT2 LA    R4,4(0,R4)          INCR INTO ASVT
         CLC   1(3,R4),=F'0'       END OF ASVT
         BE    RETURN              YES, EXIT
         TM    0(R4),X'80'         AVAILABLE SLOT
         BO    SETINIT2            YES
         L     R5,0(0,R4)          ASCB ADDR
         LA    R5,0(0,R5)
         ST    R5,0(0,R8)          ENTRY ID
         LM    R14,R15,64(R5)      TCB TIME
         SRDL  R14,22
         LR    R1,R15
         LM    R14,R15,200(R5)     SRB TIME
         SRDL  R14,22
         AR    R15,R1
         ST    R15,4(0,R8)         SAVE PREVIOUS CPU TIME
         TIME  BIN
         ST    R0,16(0,R8)
         LA    R8,20(0,R8)         NEXT ENTRY
         B     SETINIT2
         SPACE 1
SETINIT3 LA    R1,HDRI             IN QUEUE HDR
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    JOBOUT              YES, CONTINUE
         BAL   R11,MSGRTN1
JOBOUT   L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(0,R4)        ASCB SLOT ADDR
         B     JOBOUT4
         SPACE 1
JOBOUT1  L     R5,0(0,R4)          ASCB ADDR
         LA    R5,0(0,R5)
         L     R6,56(0,R5)         CSCB ADDR
         L     R7,144(0,R5)        LOAD OUCB ADDR
         CLI   SCANTYPE,C'I'       IN QUEUE SCAN
         BNE   JOBOUT2             NO
         CLI   41(R7),X'00'        SRC PRESENT
         BNE   JOBOUT6             YES, GO CHECK DET WAIT
         CLI   38(R5),X'7F'        LOGICAL SWAP
         BE    JOBOUT4             YES, OUT
         B     JOBOUT3             CONTINUE
         SPACE 1
JOBOUT2  CLI   38(R5),X'7F'        LOGICAL SWAP
         BE    JOBOUT3             YES, OUT QUEUE
         CLI   41(R7),X'00'        SWAP REASON
         BE    JOBOUT4             NO, IN QUEUE
         CLI   41(R7),X'06'        DETECTED WAIT
         BNE   JOBOUT3             NO
         TM    21(R7),X'01'        MSO DET WAIT BIT ON
         BZ    JOBOUT4             NO, IGNORE SRC
         SPACE 1
JOBOUT3  MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BAL   R11,ASCBFORM        GO FORMAT ASCB INFO
         L     R6,144(0,R5)        OUCB ADDR
         L     R3,60(0,R5)         TSB ADDR
         L     R5,56(0,R5)         CSCB ADDR
         BAL   R11,CSCBFORM        GO FORMAT CSCB INFO
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    JOBOUT4             YES, CONTINUE
         CLC   JOBTOT1,=F'0'       ANY CPU THIS JOB?               @TEC
         BE    JOBOUT4             NO. SKIP IT                     @TEC
         LA    R1,WTOLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
         SPACE 1
JOBOUT4  LA    R4,4(0,R4)          INCR INTO ASVT
         CLC   1(3,R4),=F'0'       END OF ASVT
         BE    JOBOUT5             YES, RETURN
         TM    0(R4),X'80'         AVAILABLE ENTRY
         BO    JOBOUT4             YES, CHECK NEXT
         B     JOBOUT1             GO USE IT
         SPACE 1
JOBOUT5  CLI   SCANTYPE,C'O'       OUT QUEUE SCAN
         BE    DMNCHK              YES, EXIT
         MVI   SCANRET,C' '        INIT OUTPUT SWITCH
         MVI   SCANTYPE,C'O'       SET OUT QUEUE SCAN NEXT
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    JOBOUT              YES, CONTINUE
         BAL   R11,JOBTOTL         TOTAL INPUT QUEUE
         LA    R1,WTOLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
         LA    R1,HDRO             OUT QUEUE HDR
         BAL   R11,MSGRTN1
         B     JOBOUT              NEXT PASS
         SPACE 1
JOBOUT6  CLI   41(R7),X'06'        DETECTED WAIT
         BNE   JOBOUT4             NO
         TM    21(R7),X'01'        MSO DET WAIT BIT ON
         BZ    JOBOUT3             NO, IGNORE SRC
         B     JOBOUT4
ASCBFORM UNPK  DOUBLE(5),36(3,R5)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   ASID(4),DOUBLE      SAVE ASID
         L     R8,XAA              JOBTABLE ADDR
         SPACE 1
ASCBFRM1 CLC   0(4,R8),=F'0'       JOBTABLE END
         BE    ASCBFRM2            YES
         C     R5,0(0,R8)          ASCB MATCH
         BE    ASCBFRM2            YES
         LA    R8,20(0,R8)         NEXT ENTRY
         B     ASCBFRM1
         SPACE 1
ASCBFRM2 LM    R14,R15,64(R5)      TCB TIME
         SRDL  R14,22
         LR    R1,R15
         LM    R14,R15,200(R5)     SRB TIME
         SRDL  R14,22
         AR    R1,R15
         L     R15,4(0,R8)         LOAD PREVIOUS CPU TIME
         LTR   R15,R15             ANY PREVIOUS
         BNZ   *+6                 NO
         LR    R15,R1              PREVIOUS = CURRENT
         ST    R15,8(0,R8)         SAVE PREVIOUS CPU TIME
         ST    R1,4(0,R8)          SAVE TOTAL CPU TIME
         S     R1,8(0,R8)          SUB PREVIOUS CPU TIME
         ST    R1,12(0,R8)         SAVE DIFFERENCE
         TIME  BIN
         L     R1,16(0,R8)         OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,16(0,R8)         OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,16(0,R8)         INTERVAL TIME
         ST    R0,16(0,R8)         NEW TIME BEGIN
         LTR   R1,R1               TIME EQUAL 0
         BZ    ASCBFRMY            YES, NO DIVIDE
         L     R15,12(0,R8)        LOAD DIFFERENCE
         LTR   R15,R15             NEGATIVE
         BM    ASCBFRMX            YES
         SR    R14,R14
         M     R14,=F'10'          PERCENT
         SR    R14,R14
         DR    R14,R1              PERCENT UTIL
         ST    R15,JOBTOT1+4       SAVE JOB TOTAL PCT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   PCT(7),=X'402020204B2020'
         ED    PCT(4),DOUBLE+6
         CH    R15,=H'50'          MAX
         BNH   *+8                 NO
         LH    R15,=H'50'          SET MAX
         EX    R15,PCTMVE          GRAPHIC PERCENT
         LA    R15,PCTGRAPH(R15)
         MVI   0(R15),C'>'
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R1              PERCENT UTIL  (HUNDREDTHS)
         ST    R15,JOBTOT1         SAVE JOB TOTAL HUNDREDTHS
         CVD   R15,DOUBLE          PERCENT TO PRINT  (HUNDREDTHS)
         UNPK  PCT+5(2),DOUBLE+6(2)
         OI    PCT+6,X'F0'
         BR    R11
         SPACE 1
ASCBFRMX MVC   PCT(7),=C'**CHG**'
         BR    R11
         SPACE 1
ASCBFRMY MVC   PCT(7),=C'**ERR**'
         BR    R11
         SPACE 1
PCTMVE   MVC   PCTGRAPH(0),PCTLINE
JOBTOTL  MVC   WTOLIST+4(20),=CL20'## IN Q TOTAL ##'
         SR    R14,R14
         L     R15,JOBTOT2
         D     R14,=F'100'
         A     R15,JOBTOT2+4       TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   PCT(7),=X'402020204B2020'
         ED    PCT(4),DOUBLE+6
         SRL   R15,1
         CH    R15,=H'50'          MAX
         BNH   *+8                 NO
         LH    R15,=H'50'          SET MAX
         EX    R15,PCTTOT          GRAPHIC PERCENT
         LA    R15,PCTGRAPH(R15)
         MVI   0(R15),C'>'
         CVD   R14,DOUBLE
         UNPK  PCT+5(2),DOUBLE+6(2)
         OI    PCT+6,X'F0'
         BR    R11
         SPACE 1
PCTTOT   MVC   PCTGRAPH(0),PCTTLINE
DMNCHK   MVC   DMNLIST(4),=X'00540100'
         CLI   TSOSW,C'D'          DOMAIN LIST
         BNE   RETURN              NO
         LA    R4,DMNTAB-8
         SR    R5,R5
         SPACE 1
DMNCHK1  CVD   R5,DOUBLE           DOMAIN NUMBER
         MVC   DMNLIST+4(80),=CL80'DOMAIN XX'
         UNPK  DMNNBR(2),DOUBLE+6(2)
         OI    DMNNBR+1,X'F0'
         LA    R5,1(0,R5)          NEXT DOMAIN
         LA    R4,8(0,R4)          NEXT TABLE ENTRY
         C     R5,=F'51'           END OF DOMAINS
         BE    DMNCHK2             YES, TOTAL
         CLC   0(8,R4),=2F'0'      ANY TIME IN THIS DOMAIN
         BE    DMNCHK1             NO
         SR    R14,R14
         L     R15,0(0,R4)
         D     R14,=F'100'
         A     R15,4(0,R4)         TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNPCT(7),=X'402020204B2020'
         ED    DMNPCT(4),DOUBLE+6
         SRL   R15,1
         CH    R15,=H'50'          MAX
         BNH   *+8                 NO
         LH    R15,=H'50'          SET MAX
         EX    R15,DMNTOT          GRAPHIC PERCENT
         LA    R15,DMNGRAPH(R15)
         MVI   0(R15),C'>'
         CVD   R14,DOUBLE
         UNPK  DMNPCT+5(2),DOUBLE+6(2)
         OI    DMNPCT+6,X'F0'
         LA    R1,DMNLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
         B     DMNCHK1
         SPACE 3
DMNCHK2  MVC   DMNLIST+4(80),=CL80'TOTAL PCT'
         SR    R14,R14
         L     R15,JOBTOT2
         D     R14,=F'100'
         A     R15,JOBTOT2+4       TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNPCT(7),=X'402020204B2020'
         ED    DMNPCT(4),DOUBLE+6
         SRL   R15,1
         CH    R15,=H'50'          MAX
         BNH   *+8                 NO
         LH    R15,=H'50'          SET MAX
         EX    R15,DMNTOT          GRAPHIC PERCENT
         LA    R15,DMNGRAPH(R15)
         MVI   0(R15),C'>'
         CVD   R14,DOUBLE
         UNPK  DMNPCT+5(2),DOUBLE+6(2)
         OI    DMNPCT+6,X'F0'
         LA    R1,DMNLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
         B     RETURN
         SPACE 1
DMNTOT   MVC   DMNGRAPH(0),PCTTLINE
CSCBFORM CLI   TSOSW,C'T'          TSO USER DISPLAY
         BNE   CSCBFRM0            NO
         CLI   28(R5),X'01'        TSO USER
         BNE   JOBOUT4             NO, BYPASS
         B     CSCBFRM6
         SPACE 1
CSCBFRM0 CLI   TSOSW,C'D'          DOMAIN LIST
         BE    *+12                YES, CONTINUE
         CLI   28(R5),X'01'        TSO USER
         BE    JOBOUT4             YES, DONT PROCESS
         CLI   28(R5),X'03'        INIT
         BNE   CSCBFRM3            NO, GO HANDLE
         LA    R9,0(0,R5)          SAVE CSCB ADDR
         SR    R10,R10             INSERT
         IC    R10,30(0,R5)
         SLL   R10,8               ASID
         IC    R10,31(0,R5)
         SPACE 1
CSCBFRM1 L     R5,0(0,R5)          NEXT CSCB
         LA    R5,0(0,R5)          CLEAR HIGH ORDER
         LTR   R5,R5               END OF CSCBS
         BNZ   *+10                NO, CONTINUE
         LR    R5,R9               LOAD CSCB ADDR
         B     JOBOUT4             NO GOOD
         CR    R5,R9               SAME CSCB
         BE    JOBOUT4             YES, NO GOOD
         CH    R10,30(0,R5)        SAME ASID
         BNE   CSCBFRM1            NO, CHECK NEXT
         SPACE 1
CSCBFRM2 MVC   JOBNAME(8),8(R5)
         MVC   STEPNAME(8),64(R5)
         B     CSCBFRM4
         SPACE 1
CSCBFRM3 MVC   JOBNAME(8),16(R5)
         MVC   STEPNAME(8),8(R5)
         SPACE 1
CSCBFRM4 CLI   TSOSW,C'X'          DOMAIN DISPLAY
         BNE   CSCBFRM5            NO
         CLC   DOMAIN(1),40(R6)    DOMAIN MATCH
         BNE   JOBOUT4
         SPACE 1
CSCBFRM5 LM    R14,R15,JOBTOT1
         A     R14,JOBTOT2
         A     R15,JOBTOT2+4
         STM   R14,R15,JOBTOT2
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    CSCBFRM7            YES
         CLC   ASID(4),=C'0001'
         BCR   7,R11
         MVC   JOBNAME(20),=CL20'MASTER'
         BR    R11
         SPACE 1
CSCBFRM6 MVC   JOBNAME(8),8(R5)
         MVC   STEPNAME(8),16(R5)
         B     CSCBFRM5
         SPACE 1
CSCBFRM7 SR    R1,R1
         IC    R1,40(0,R6)         DOMAIN NUMBER
         SLL   R1,3
         LA    R1,DMNTAB(R1)       DOMAIN TABLE SLOT
         LM    R14,R15,JOBTOT1
         A     R14,0(0,R1)
         A     R15,4(0,R1)
         STM   R14,R15,0(R1)       SAVE DOMAIN TOTALS
         B     JOBOUT4
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(CSCGJ03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         LA    R11,RETURN          LOAD RET ADDR
MSGRTN   MVI   SCANRET,C'P'
         SPACE 1
MSGRTN1  SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         BR    R11
         SPACE 3
RETURN   ESTAE 0
         LA    R8,AMODE24                                          @TEC
         BSM   0,R8                                                @TEC
AMODE24  DS    0H                                                  @TEC
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
STAEMSG  DC    X'00540100'
         DC    CL80'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
PCTLINE  DC    CL51'0=========1=========2=========3=========4========='
PCTTLINE DC    CL51'0====1====2====3====4====5====6====7====8====9===='
         SPACE 1
         DS    0F
NFNDMSG  DC    X'00540100'
         DC    CL80'NO JOBS ON OUT QUEUE'
         SPACE 1
HDRI     DC    X'00540100'
         DC    CL26'****   IN  QUEUE   ****'
         DC    CL54' CPU PERCENT UTILIZATION'
         SPACE 1
HDRO     DC    X'00540100'
         DC    CL26'****   OUT  QUEUE   ****'
         DC    CL54' CPU PERCENT UTILIZATION'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
JOBTOT1  DS    2F
JOBTOT2  DS    2F
XSASAVE  DS    F
ASID     DS    F
SCANRET  DS    C
SCANTYPE DS    C
TSOSW    DS    C
DOMAIN   DS    C
         SPACE 5
         DS    0F
WTOLIST  DS    F
JOBMSG   DS    0CL80
JOBNAME  DS    CL8
         DS    CL1
STEPNAME DS    CL8
         DS    CL3
PCT      DS    CL7
         DS    CL2
PCTGRAPH DS    CL51
         SPACE 5
         DS    0F
DMNLIST  DS    F
DMNMSG   DS    0CL80
         DS    CL7
DMNNBR   DS    CL2
         DS    CL4
DMNPCT   DS    CL7
         DS    CL3
DMNGRAPH DS    CL51
         DS    CL6
         SPACE 2
ESTAELST DS    0F,(ESTAEOVX)X
DMNTAB   DS    200F
WORKEND  DS    0F
         SPACE 5
JOBTABLE DSECT
JOBTAB   DS    800F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
XAA      DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCGO03D
         TITLE 'ESAGO03D -   O  I/O MONITOR'
         PRINT NOGEN                                               @TEC
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       ESAGO03D -       O  I/O MONITOR                           ***
***                                                                 ***
***       VERSION -        2.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        09/06/91                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
CSCGO03D CSECT
         LR    R12,R15
         LA    R7,4095(0,R12)
         LA    R7,1(0,R7)
         USING CSCGO03D,R12,R7
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
PARMCHK  L     R3,XAL
         LA    R3,0(0,R3)
         MVI   PARMDEV,C'D'        DASD IS DEFAULT
         LTR   R3,R3               ANY PARM
         BZ    PARMCHK1            NO
         MVC   PARMDEV(1),0(R3)    SET SCAN TYPE
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),1(R3)     BUSY PCT
         CLC   DOUBLE(2),=C'00'    NUMERIC
         BNE   PARMCHK1            NO
         PACK  DOUBLE(8),1(2,R3)
         CVB   R1,DOUBLE
         ST    R1,THRLIMIT
PARMCHK1 LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                          @TEC
         BSM   0,R9                                                @TEC
AMODE31  DC    A(CONT31+X'80000000')                               @TEC
CONT31   DS    0H                                                  @TEC
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L
ESTAEOVX EQU   *-ESTAEOVL
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
CSCSTART L     R4,16               CVT
         L     R4,604(0,R4)        RMCT
         MVC   WTOLIST(84),SRMOVLY
         L     R5,88(0,R4)         WAMT
         L     R1,THRTSOPG         TSO PERF GROUP NUMBER
         SLL   R1,2                TIMES 4
         L     R6,88(R1,R5)        WAMP OFFSET                     @TEC
         AR    R5,R6               WAMP ADDRESS
         SR    R14,R14
         L     R15,0(0,R5)         TOTAL ENDED TRANS
         LTR   R15,R15             ZERO TRANS
         BZ    NOTSO               YES, BYPASS 0C9
         L     R15,12(0,R5)        TOTAL ELAPSED TIME FOR ENDED TRANS
         D     R14,0(0,R5)         DIVIDE BY ENDED TRANSACTIONS
         SR    R14,R14
         D     R14,=F'1000'
NOTSO    CVD   R15,DOUBLE          AVG SECONDS RESPONSE TIME
         SRDL  R14,32
         D     R14,=F'10'
         CVD   R15,DOUBLEX
         MVC   WTOLIST+8(7),=X'402021204B2020'
         ED    WTOLIST+8(4),DOUBLE+6
         UNPK  WTOLIST+13(2),DOUBLEX+6(2)
         OI    WTOLIST+14,X'F0'
         L     R1,4(0,R4)          CCT                             @TEC
         LH    R1,104(0,R1)        LONG TERM CPU %                 @TEC
         SRL   R1,8                SCALED BY 256                   @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+25(4),=X'40212020'
         ED    WTOLIST+25(4),DOUBLE+6
         L     R1,4(0,R4)          CCT                             @TEC
         LH    R1,102(0,R1)        AVERAGE CPU                     @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+38(4),=X'40212020'
         ED    WTOLIST+38(4),DOUBLE+6
         L     R1,228(0,R4)        RCT                             @TEC
         LH    R1,64(0,R1)         AVERAGE PAGING                  @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+51(4),=X'40212020'
         ED    WTOLIST+51(4),DOUBLE+6
         L     R1,228(0,R4)        RCT                             @TEC
         LH    R1,54(0,R1)         AVERAGE UIC                     @TEC
         CVD   R1,DOUBLE
         MVC   WTOLIST+65(4),=X'40212020'
         ED    WTOLIST+65(4),DOUBLE+6
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              MCS ID OF REQUESTING CONSOLE
         SVC   35
         MVI   WTOLIST+4,C' '
         MVC   WTOLIST+5(79),WTOLIST+4
         MVC   WTOLIST(4),=X'00540100'
         L     R8,XAA              ASCB/OUCB INFO STORAGE
         USING JOBTABLE,R8
         L     R3,THRSTIMR
         BAL   R10,CHKUCB          CLEAR UCB TABLE
         BAL   R10,CHNLOOP
         CLI   WJOB1,C' '          ANY OUTPUT
         BE    CHNNODSP            NO
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              MCS ID OF REQUESTING CONSOLE
         SVC   35
CHNNODSP MVI   WTOLIST+4,C' '
         MVC   WTOLIST+5(79),WTOLIST+4
         MVC   WTOLIST(4),=X'00540100'
         BAL   R10,CHKUCB6         CHECK BUSY UCBS
         B     RETURN
CHNLOOP  DS    0H
         LR    R4,R10
         BAL   R10,CHKUCB1         CHECK BUSY UCBS
         LR    R10,R4
         L     R1,16               CVT                             @TEC
         L     R1,604(0,R1)        RMCT                            @TEC
         L     R1,280(0,R1)        CMCT                            @TEC
         L     R14,28(0,R1)        END OF CPMT                     @TEC
         S     R14,12(0,R1)        MINUS START                     @TEC
         SRDA  R14,32                                              @TEC
         D     R14,=F'12'          12 BYTES PER CHPID              @TEC
         BCTR  R15,0               MINUS 12 FOR THE HEADER         @TEC
         LR    R3,R15              NUMBER OF CHPID'S               @TEC
         ST    R3,MAXCHPID         SAVE FOR LATER                  @TEC
         L     R14,12(0,R1)        CPMT                            @TEC
         L     R0,8(0,R14)         START SAMPLE COUNT              @TEC
         ST    R0,CHBSMPCT         AND SAVE IT                     @TEC
         LA    R14,12(0,R14)       SKIP OVER HEADER                @TEC
         SR    R15,R15             INDEX REGISTER                  @TEC
CHNLOOP1 CLC   8(2,R14),=X'FFFF'   CHPID NOT INSTALLED.            @TEC
         BE    CHNLOOP2                                            @TEC
         L     R1,4(0,R14)         BUSY COUNT                      @TEC
         ST    R1,CHBSYPCT(R15)                                    @TEC
CHNLOOP2 LA    R14,12(0,R14)       NEXT CPMT ENTRY                 @TEC
         LA    R15,4(0,R15)        NEXT SLOT                       @TEC
         BCT   R3,CHNLOOP1                                         @TEC
         STIMER  WAIT,DINTVL=THRINTVL
         L     R1,16               CVT                             @TEC
         L     R1,604(0,R1)        RMCT                            @TEC
         L     R1,280(0,R1)        CMCT                            @TEC
         L     R14,28(0,R1)        END OF CPMT                     @TEC
         S     R14,12(0,R1)        MINUS START                     @TEC
         SRDA  R14,32                                              @TEC
         D     R14,=F'12'          12 BYTES PER CHPID              @TEC
         BCTR  R15,0               MINUS 12 FOR THE HEADER         @TEC
         LR    R3,R15              NUMBER OF CHPID'S               @TEC
         L     R14,12(0,R1)        CPMT                            @TEC
         L     R0,8(0,R14)         END SAMPLE COUNT                @TEC
         S     R0,CHBSMPCT         MINUS STARTING COUNT            @TEC
         LA    R14,12(0,R14)       SKIP OVER HEADER                @TEC
         SR    R15,R15             INDEX REGISTER                  @TEC
CHNLOOP3 CLC   8(2,R14),=X'FFFF'   CHPID NOT INSTALLED.            @TEC
         BE    CHNLOOP4                                            @TEC
         CLC   4(4,R14),=F'0'      NO CHANNEL ACTIVITY?            @TEC
         BE    CHNLOOP4            IF SO, SKIP IT                  @TEC
         L     R4,4(0,R14)         BUSY SAMPLES                    @TEC
         S     R4,CHBSYPCT(R15)    MINUS PRIOR                     @TEC
         SRDA  R4,32                                               @TEC
         M     R4,=F'100'                                          @TEC
         DR    R4,R0                                               @TEC
         ST    R5,CHBSYPCT(R15)    SAVE CHANNEL BUSY %             @TEC
CHNLOOP4 LA    R14,12(0,R14)       NEXT CPMT ENTRY                 @TEC
         LA    R15,4(0,R15)        NEXT SLOT                       @TEC
         BCT   R3,CHNLOOP3                                         @TEC
         LR    R4,R10
         BAL   R10,CHKUCB6         CHECK BUSY UCBS
         LR    R10,R4
         L     R14,MAXCHPID        PICK UP HIGHEST CHPID           @TEC
         LA    R5,THRCH1LM         CHANNEL BUSY PERCENT LIMIT
         LA    R6,THRCH1BS         CHANNEL BUSY TIME THRESHOLD
         LA    R3,CHBSYPCT                                         @TEC
         LA    R4,CHBSYTIM                                         @TEC
         LA    R9,CHPNUMS                                          @TEC
CHNLOOP5 BAL   R11,CHNDISP                                         @TEC
         L     R14,R14SAVE         RESTORE LOOP REGISTER           @TEC
         LA    R3,4(0,R3)          BUSY PCT NEXT CHPID             @TEC
         LA    R4,4(0,R4)          BUSY TIME NEXT CHPID            @TEC
         LA    R9,2(0,R9)          NEXT CHPID NUMBER               @TEC
         LA    R5,8(0,R5)          NEXT PERCENT THRESHOLD          @TEC
         LA    R6,8(0,R6)          NEXT TIME THRESHOLD             @TEC
         BCT   R14,CHNLOOP5                                        @TEC
         BR    R10
CHNDISP  ST    R14,R14SAVE                                         @TEC
         L     R1,0(0,R3)
         C     R1,0(0,R5)          THRESHOLD REACHED
         BL    CHNDISP1            NO
         TIME  BIN
         L     R1,0(0,R4)          OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,0(0,R4)          OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,0(0,R4)          INTERVAL TIME
         LTR   R1,R1               TIME EQUAL 0
         BCR   8,R11               YES
         BP    CHNDISP2
CHNDISP1 XC    0(4,R4),0(R4)
         BR    R11
CHNDISP2 LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         SECONDS
         L     R1,0(0,R3)          PERCENT BUSY
         CVD   R1,DOUBLE
         CVD   R15,DOUBLEX
         C     R15,0(0,R6)         CHANNEL BUSY TIME THRESHOLD REACHED
         BCR   4,R11               NO
         CLI   WJOB1,C' '          1ST PASS
         BNE   CHNDISP3            NO
         MVC   WJOB1(16),=CL16'CHANNEL XX  XXX%'
         MVC   WJOB1+8(2),0(R9)    CHANNEL NUMBER
         MVC   WJOB1+11(4),=X'40202120'
         ED    WJOB1+11(4),DOUBLE+6
         BR    R11
CHNDISP3 CLI   WJOB2,C' '          2ND PASS
         BNE   CHNDISP4            NO
         MVC   WJOB2(16),=CL16'CHANNEL XX  XXX%'
         MVC   WJOB2+8(2),0(R9)    CHANNEL NUMBER
         MVC   WJOB2+11(4),=X'40202120'
         ED    WJOB2+11(4),DOUBLE+6
         BR    R11
CHNDISP4 CLI   WJOB3,C' '          3RD PASS
         BNE   CHNDISP5            NO
         MVC   WJOB3(16),=CL16'CHANNEL XX  XXX%'
         MVC   WJOB3+8(2),0(R9)    CHANNEL NUMBER
         MVC   WJOB3+11(4),=X'40202120'
         ED    WJOB3+11(4),DOUBLE+6
         BR    R11
CHNDISP5 MVC   WJOB4(16),=CL16'CHANNEL XX  XXX%'
         MVC   WJOB4+8(2),0(R9)    CHANNEL NUMBER
         MVC   WJOB4+11(4),=X'40202120'
         ED    WJOB4+11(4),DOUBLE+6
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R11
CHKUCB   STM   R0,R15,SAVEREGS
         MVC   UCBTABND(2),=X'FFFF'
         LA    R6,UCBTAB-16                                        @TEC
CHKUCB0  LA    R6,16(0,R6)                                         @TEC
         CLC   0(2,R6),=X'FFFF'    END OF TABLE
         BE    CHKUCB9             YES
         CLI   2(R6),X'00'         REFERENCED LAST PASS
         BNE   *+10                YES
         XC    0(8,R6),0(R6)
         MVI   2(R6),X'00'
         XC    8(4,R6),8(R6)
         B     CHKUCB0
CHKUCB1  XC    UCBDMSAV(24),UCBDMSAV
         STM   R0,R15,SAVEREGS
         L     R9,CVTPTR           CVT ADDR                        @TEC
         L     R9,CVTUCBSC-CVTMAP(R9)  LOOKUP ROUTINE ADDRESS      @TEC
         XC    WKAREA(100),WKAREA  CLEAR WORK AREA                 @TEC
         LA    R1,WKAREA           SETUP PARAMETER LIST            @TEC
         ST    R1,PLIST                                            @TEC
         LA    R1,=X'20'           SPECIFY DASD                    @TEC
         ST    R1,PLIST+4                                          @TEC
         LA    R1,ADDR             WORD TO PUT ADDRESS OF UCB      @TEC
         ST    R1,PLIST+8                                          @TEC
         OI    PLIST+8,X'80'       31 BIT PARM END SET             @TEC
CHKUCB1A BAL   R10,UCBDML#0        GET NEXT UCB ADDR
         LTR   R1,R1               END OF UCBS
         BZ    CHKUCB9             YES, EXIT
         LA    R6,UCBTAB-16                                        @TEC
         TM    3(R1),X'88'         ONLINE/ALLOCATED
         BNO   CHKUCB1A            NO
         CLI   PARMDEV,C'A'        ALL DEV REQ
         BE    CHKUCB2             YES
         CLI   PARMDEV,C'D'        DASD REQ
         BNE   *+12                NO
         CLI   18(R1),X'20'        DASD
         BE    CHKUCB2             YES
         CLI   PARMDEV,C'T'        TAPE REQ
         BNE   *+12                NO
         CLI   18(R1),X'80'        TAPE
         BE    CHKUCB2             YES
         CLI   PARMDEV,C'V'        ALL DEV WITH VOLSER REQ
         BNE   *+20                NO
         CLI   18(R1),X'20'        DASD
         BE    CHKUCB2             YES
         CLI   18(R1),X'80'        TAPE
         BE    CHKUCB2             YES
         CLI   PARMDEV,C'U'        UNIT REC REQ
         BNE   *+12                NO
         CLI   18(R1),X'08'        UNIT REC
         BE    CHKUCB2             YES
         CLI   PARMDEV,C'C'        COMM REQ
         BNE   CHKUCB1A            NO
         CLI   18(R1),X'20'        DASD
         BE    CHKUCB1A            YES
         CLI   18(R1),X'80'        TAPE
         BE    CHKUCB1A            YES
         CLI   18(R1),X'08'        UNIT REC
         BE    CHKUCB1A            YES
CHKUCB2  LA    R6,16(0,R6)         NEXT UCB ENTRY                  @TEC
         CLC   0(2,R6),=X'FFFF'    END OF UCB TABLE
         BE    CHKUCB3             YES, CHECK FOR EMPTY SLOT
         C     R1,12(0,R6)         UCB ADDR MATCH                  @TEC
         BNE   CHKUCB2             NO
         B     CHKUCB5
CHKUCB3  LA    R6,UCBTAB-16                                        @TEC
CHKUCB4  LA    R6,16(0,R6)         NEXT UCB ENTRY                  @TEC
         CLC   0(2,R6),=X'FFFF'    END OF UCB TABLE
         BE    CHKUCB1A            YES, NEXT UCB
         CLC   12(4,R6),=F'0'      EMPTY SLOT                      @TEC
         BNE   CHKUCB4             NO, NEXT ENTRY
CHKUCB5  ST    R1,12(0,R6)         SAVE UCB ADDR                   @TEC
         MVI   2(R6),X'FF'         SLOT IN USE
         L     R1,8(0,R6)
         LA    R1,1(0,R1)
         ST    R1,8(0,R6)
         B     CHKUCB1A
CHKUCB6  STM   R0,R15,SAVEREGS
         XC    PREVUADR(4),PREVUADR
CHKUCB6A LA    R6,UCBTAB-16                                        @TEC
         XC    CURRULST(4),CURRULST
         MVC   CURRUADR(4),=X'0000FFFF'
CHKUCB7  LA    R6,16(0,R6)                                         @TEC
         CLC   0(2,R6),=X'FFFF'    END OF UCB TABLE
         BE    CHKUCB7A            YES, GO CHECK
         SR    R1,R1
         L     R1,12(0,R6)         UCB ADDR                        @TEC
         C     R1,PREVUADR         COMPARE TO PREVIOUS UCB
         BNH   CHKUCB7             LOWER, NEXT
         C     R1,CURRUADR         COMPARE TO CURRENT UCB
         BNL   CHKUCB7             NOT LOWER, NEXT
         ST    R1,CURRUADR
         ST    R6,CURRULST
         B     CHKUCB7
CHKUCB7A L     R1,CURRUADR         LOAD UCB ADDR
         L     R6,CURRULST         LOAD UCB TABLE ENTRY ADDR
         LTR   R6,R6               END OF UCBS
         BZ    CHKUCB9             YES
         ST    R1,PREVUADR         SAVE PREV UCB ADDR
         LA    R3,UCBNRDY
         LA    R4,THRBSYTM
         TM    6(R1),X'40'         NOT READY
         BO    CHKUCB7B
         LA    R3,UCBBUSY
         LA    R4,THRBSYTM
         SR    R14,R14
         L     R15,8(0,R6)         UCB BUSY COUNT
         XC    8(4,R6),8(R6)
         M     R14,=F'100'
         D     R14,THRSTIMR        PERCENT BUSY
         SR    R1,R1
         IC    R1,3(0,R6)          CUMULATIVE PERCENT
         LTR   R1,R1               ZERO
         BNZ   *+6                 NO
         LR    R1,R15              FAKE START
         MH    R1,=H'3'            3/4 PREVIOUS
         AR    R1,R15              1/4 CURRENT
         SRL   R1,2
         STC   R1,3(0,R6)          NEW CUM PERCENT
         C     R1,THRLIMIT         THRESHOLD REACHED
         BL    CHKUCB7C            NO
CHKUCB7B TIME  BIN
         L     R1,4(0,R6)          OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,4(0,R6)          OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,4(0,R6)          INTERVAL TIME
         LTR   R1,R1               TIME EQUAL 0
         BZ    CHKUCB6A            YES
         BP    CHKUCB8
CHKUCB7C XC    4(8,R6),4(R6)
         B     CHKUCB6A
CHKUCB8  LR    R14,R1
         SRDL  R14,32
         D     R14,=F'100'         SECONDS
         SR    R1,R1
         IC    R1,3(0,R6)
         CVD   R1,DOUBLE
         CVD   R15,DOUBLEX
         C     R15,0(0,R4)         TIME THRESHOLD REACHED
         BL    CHKUCB6A            NO
         CLI   WJOB1,C' '          1ST PASS
         BNE   CHKUCB8A            NO
         MVC   WJOB1(16),0(R3)
         SR    R1,R1
         L     R1,12(0,R6)         UCB ADDR                        @TEC
         MVC   WJOB1(3),13(R1)     DEVICE ADDRESS
         TM    18(R1),X'A0'        DASD OR TAPE
         BZ    *+10                NO, NO VOLSER
         MVC   WJOB1+4(6),28(R1)   DEVICE VOLSER
         LA    R1,UCBNRDY
         CR    R1,R3               NOT READY MESSAGE
         BE    CHKUCB6A            YES, NO PERCENT
         MVC   WJOB1+11(4),=X'40202120'
         ED    WJOB1+11(4),DOUBLE+6
         B     CHKUCB6A
CHKUCB8A CLI   WJOB2,C' '          2ND PASS
         BNE   CHKUCB8B            NO
         MVC   WJOB2(16),0(R3)
         SR    R1,R1
         L     R1,12(0,R6)         UCB ADDR                        @TEC
         MVC   WJOB2(3),13(R1)     DEVICE ADDRESS
         TM    18(R1),X'A0'        DASD OR TAPE
         BZ    *+10                NO, NO VOLSER
         MVC   WJOB2+4(6),28(R1)   DEVICE VOLSER
         LA    R1,UCBNRDY
         CR    R1,R3               NOT READY MESSAGE
         BE    CHKUCB6A            YES, NO PERCENT
         MVC   WJOB2+11(4),=X'40202120'
         ED    WJOB2+11(4),DOUBLE+6
         B     CHKUCB6A
CHKUCB8B CLI   WJOB3,C' '          3RD PASS
         BNE   CHKUCB8C            NO
         MVC   WJOB3(16),0(R3)
         SR    R1,R1
         L     R1,12(0,R6)         UCB ADDR                        @TEC
         MVC   WJOB3(3),13(R1)     DEVICE ADDRESS
         TM    18(R1),X'A0'        DASD OR TAPE
         BZ    *+10                NO, NO VOLSER
         MVC   WJOB3+4(6),28(R1)   DEVICE VOLSER
         LA    R1,UCBNRDY
         CR    R1,R3               NOT READY MESSAGE
         BE    CHKUCB6A            YES, NO PERCENT
         MVC   WJOB3+11(4),=X'40202120'
         ED    WJOB3+11(4),DOUBLE+6
         B     CHKUCB6A
CHKUCB8C MVC   WJOB4(16),0(R3)
         SR    R1,R1
         L     R1,12(0,R6)         UCB ADDR                        @TEC
         MVC   WJOB4(3),13(R1)     DEVICE ADDRESS
         TM    18(R1),X'A0'        DASD OR TAPE
         BZ    *+10                NO, NO VOLSER
         MVC   WJOB4+4(6),28(R1)   DEVICE VOLSER
         LA    R1,UCBNRDY
         CR    R1,R3               NOT READY MESSAGE
         BE    CHKUCB8D            YES, NO PERCENT
         MVC   WJOB4+11(4),=X'40202120'
         ED    WJOB4+11(4),DOUBLE+6
CHKUCB8D LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         B     CHKUCB6A
CHKUCB9  LM    R0,R15,SAVEREGS
         BR    R10
UCBDML#0 ST    R8,UCBDMSAV         .SAVE WORK REG 1
         ST    R10,UCBDMSAV+8      .SAVE WORK REG 3
         ST    R11,UCBDMSAV+12     .SAVE WORK REG 4
UCBLOOP1 L     R9,CVTPTR           CVT ADDR                        @TEC
         L     R9,CVTUCBSC-CVTMAP(R9)  LOOKUP ROUTINE ADDRESS      @TEC
         LA    R1,PLIST            POINT AT PARM LIST              @TEC
         LR    R15,R9              GET MODULE ADDRESS              @TEC
         BALR  R14,R15             CALL MVS                        @TEC
         LTR   R15,R15             UCB FOUND?                      @TEC
         BZ    UCBFND              YES.                            @TEC
         SR    R1,R1               SAY THAT'S ALL.                 @TEC
         B     UCBDMCON            AND GO HOME.                    @TEC
UCBFND   DS    0H
         L     R1,ADDR             GET ADDR OF UCB                 @TEC
         L     R8,UCBDMLOW         .SET SEARCH ARGUMENT
UCBDML#1 LA    R8,1(0,R8)          .NEXT UNIT ADDR POSSIBLE
         L     R10,=X'0000FFFF'    .SET MAX NEXT LEAST HIGH
UCBDML#2 LTR   R1,R1               MORE UCBS?                      @TEC
         BZ    UCBDMOUT            .YES, GO PROCESS
UCBDML#4 TM    6(R1),X'8A'         BUSY AND/OR CHANNEL PROGRAM ACTIVE
         BZ    UCBLOOP1            NO, NEXT UCB                    @TEC
         BAL   R11,UCBDMCNV        .CONVERT UNIT ADDR TO HEX
         CR    R0,R8               .UNIT EQUAL                     @TEC
         BL    UCBLOOP1            .LOW NOT EQUAL, NEXT UCB        @TEC
         LR    R10,R0              .SET NEXT LEAST HIGH UNIT ADDR  @TEC
         ST    R1,UCBDMCUR         SET NEXT LEAST HIGH UCB ADD     @TEC
         B     UCBDMOUT            .GO PROCESS
UCBDMCNV SR    R14,R14
         SR    R15,R15
         IC    R15,13(0,R1)        .UNIT ADDR DIGIT
         TM    13(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,14(0,R1)        .UNIT ADDR DIGIT
         TM    14(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,15(0,R1)        .UNIT ADDR DIGIT
         TM    15(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         LR    R0,R14              .SET RESULTS REG                @TEC
         BR    R11
UCBDMOUT C     R10,=X'0000FFFF'    .ALL DONE
         BE    UCBDMEX             .YES
         ST    R10,UCBDMLOW        .NEXT LOW UNIT ADDR
         L     R1,UCBDMCUR         .LOAD UCB ADDR FOR FOUND UNIT
         B     UCBDMCON            .CONTINUE
UCBDMEX  SR    R1,R1               .CLEAR UCB ADDR REGISTER
         L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         B     UCBDMRET            .END OF UCBS
UCBDMCON L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
UCBDMRET EQU   *
         BR    R10
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
**************************************************************
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE
*  OPERANDS, REGISTERS, AND PSW IN IT.
**************************************************************
         STM   R14,R12,12(R13)     SAVE REGISTER
         LR    R14,R13             SAVE ORIG R13
         L     R13,0(R1)           GET ESTAE PARM
         L     R2,XSASAVE          GET XSA ADDRESS
         LR    R13,R14             RESTORE R13
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC  SET TO VRA
*                                  AND EBCDIC
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX  MOVE HEADER
         MVC   SDWAVRA+11-SDWA(8,1),0(R2)  MOVE IN DATA
         MVI   SDWAURAL-SDWA(1),19  SET LENGTH OF DATA
         B     ESTNOP              SKIP CONSTANTS
         ESTMODS ,
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8)
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS
         LA    R3,ESTMODS          POINT AT NAMES
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,                   X
               RECORD=YES,RECPARM=(3),REGS=(14,12)
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         USING *,R15
STAERTRY L     R12,=A(CSCGO03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         LA    R11,RETURN          LOAD RET ADDR
MSGRTN   SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BR    R11
RETURN   CLI   WJOB1,C' '          ANY OUTPUT
         BE    EXIT                NO
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
EXIT     ESTAE 0
         LA    R8,AMODE24                                          @TEC
         BSM   0,R8                                                @TEC
AMODE24  DS    0H                                                  @TEC
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R2,SAVRET           RETURN ADDR
         FREEMAIN  R,LV=(0),A=(1)
         SR    R15,R15
         LR    R14,R2
         BR    R14
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
UCBNRDY  DC    CL16'XXX         NRDY'
UCBBUSY  DC    CL16'XXX         XXX%'
         DS    0F
CHPNUMS  DC    C'000102030405060708090A0B0C0D0E0F'                 @TEC
         DC    C'101112131415161718191A1B1C1D1E1F'                 @TEC
THRCH1BS DC    F'20'               CHANNEL 1 PERCENT BUSY THRESHOLD
THRCH1LM DC    F'20'               CHANNEL 1 PERCENT BUSY LIMIT
         DC    64A(1)                                              @TEC
         DS    0F
STAEMSG  DC    X'00540100'
         DC    CL80'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
SRMOVLY  DS    0CL84
         DC    XL4'00540100'
         DC    CL5'TSO-',CL10' '
         DC    CL6'LGCP-',CL7' '
         DC    CL6'AVCP-',CL7' '
         DC    CL6'AVPG-',CL7' '
         DC    CL7'AVUIC-',CL7' '
         DC    CL6'ASMQ-',CL6' '
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                     *
*                                                                     *
*        THRESHOLD VALUES FOR ALL DISPLAY LIMITS                      *
*                                                                     *
*                                                                     *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         DS    0D
THRINTVL DC    CL8'00000500'       5 SEC STIMER FOR CHANNEL BUSY
THRSTIMR DC    F'50'               CHANNEL BUSY STIMER REPETITIONS
***   THE ABOVE VALUES MULTIPLIED TOGETHER GIVE THE MINIMUM
***   REFRESH FOR THIS COMMAND
THRTSOPG DC    F'02'               TSO PERFORMANCE GROUP
THRBSYTM DC    F'05'               BUSY / NOT READY THRESHOLD
THRLIMIT DC    F'20'               BUSY / NOT READY LIMIT
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
DOUBLEX  DS    2F
PARMDEV  DS    F
XSASAVE  DS    F
PREVUADR DS    F
CURRUADR DS    F
CURRULST DS    F
UCBDMSAV DS    5F
UCBDMLOW DS    F
UCBDMCUR DS    F
PLIST    DS    3F                                                  @TEC
ADDR     DS    F                                                   @TEC
WKAREA   DS    0D,XL100                                            @TEC
         DS    F
MAXCHPID DS    F                                                   @TEC
R14SAVE  DS    F                                                   @TEC
         DS    0F
WTOLIST  DS    F
JOBMSG   DS    0CL80
WJOB1    DS    CL16
         DS    CL5
WJOB2    DS    CL16
         DS    CL5
WJOB3    DS    CL16
         DS    CL5
WJOB4    DS    CL16
         DS    CL1
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0F
JOBTABLE DSECT
CHBSMPCT DS    F                   CHANNEL BUSY SAMPLE COUNT       @TEC
CHBSYTIM DS    32F                                                 @TEC
CHBSYPCT DS    32F                                                 @TEC
UCBTAB   DS    100CL16                                             @TEC
UCBTABND DS    F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
XAA      DS    F
CHAN1    EQU   256
CHAN2    EQU   512
CHAN3    EQU   768
CHAN4    EQU   1024
CHAN5    EQU   1280
CHAN6    EQU   1536
CHAN7    EQU   1792
CHAN8    EQU   2048
CHAN9    EQU   2304
CHAN10   EQU   2560
CHAN11   EQU   2816
CHAN12   EQU   3072
CHAN13   EQU   3328
CHAN14   EQU   3584
CHAN15   EQU   3840
         IHASDWA
         CVT   DSECT=YES                                           @TEC
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCGS03D
         TITLE 'ESAGS03D -   S  SYSTEM INDICATOR DISPLAY'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SP1GS03D -       S  SYSTEM INDICATOR DISPLAY              ***
***                                                                 ***
***       VERSION -        1.1                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        08/19/91  JCL-TEC                        ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
CSCGS03D CSECT
         LR    R12,R15
         USING CSCGS03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         L     R3,XAL
         LA    R3,0(0,R3)
         XC    PARM(3),PARM
         LTR   R3,R3
         BZ    *+10                NO PARM
         MVC   PARM(3),0(R3)
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                          @TEC
         BSM   0,R9                                                @TEC
AMODE31  DC    A(CONT31+X'80000000')                               @TEC
CONT31   DS    0H                                                  @TEC
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         MVC   WTOLIST(4),=X'00540100'
         MVC   WTOLIST+4(80),WTOHDR
         MVC   WTOLIST+22(9),=C'AVRG CURR'
         CLI   PARM,C'A'           AVERAGE GRAPHIC DISPLAY
         BNE   *+10                NO
         MVC   WTOLIST+22(9),=C'CURR AVRG'
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         L     R5,XAA
         USING AVERAGE,R5
         CLC   0(4,R5),=F'0'       1ST PASS
         BNE   SYSIND              NO
         LA    R1,LGCPU
         ST    R1,LGCPU
         LA    R1,AVCPU
         ST    R1,AVCPU
         LA    R1,AVPAG
         ST    R1,AVPAG
         LA    R1,AVUIC
         ST    R1,AVUIC
         LA    R1,AVASQ
         ST    R1,AVASQ
SYSIND   L     R4,16               CVT
         L     R4,604(0,R4)        RMCT
         SR    R1,R1
         L     R1,4(0,R4)          CCT                             @TEC
         LH    R1,104(0,R1)        LONG TERM CPU UTIL              @TEC
         SRL   R1,8                SCALED BY 256?                  @TEC
         LA    R6,LGCPU
         LA    R11,LGCPUEND
         BAL   R7,SYSACCUM
         LA    R6,LGCPUOVL
         LA    R8,2
         LA    R10,GRAPH2
         BAL   R7,SYSWTO
         L     R1,4(0,R4)          CCT                             @TEC
         LH    R1,102(0,R1)        AVERAGE CPU                     @TEC
         LA    R6,AVCPU
         LA    R11,AVCPUEND
         BAL   R7,SYSACCUM
         LA    R6,AVCPUOVL
         LA    R8,2
         LA    R10,GRAPH2
         BAL   R7,SYSWTO
         L     R1,228(0,R4)        RCT                             @TEC
         LH    R1,64(0,R1)         AVERAGE PAGING                  @TEC
         LA    R6,AVPAG
         LA    R11,AVPAGEND
         BAL   R7,SYSACCUM
         LA    R6,AVPAGOVL
         LA    R8,1
         LA    R10,GRAPH1
         BAL   R7,SYSWTO
         L     R1,228(0,R4)        RCT                             @TEC
         LH    R1,54(0,R1)         AVERAGE UIC                     @TEC
         LA    R6,AVUIC
         LA    R11,AVUICEND
         BAL   R7,SYSACCUM
         LA    R6,AVUICOVL
         LA    R8,1
         LA    R10,GRAPH1
         BAL   R7,SYSWTO
*        LH    R1,878(0,R4)        AVERAGE ASMQ             AXC-SP1
*        LA    R6,AVASQ
*        LA    R11,AVASQEND
*        BAL   R7,SYSACCUM
*        LA    R6,AVASQOVL
*        LA    R8,1
*        LA    R10,GRAPH1
*        BAL   R7,SYSWTO
DOMAIN   L     R4,16               CVT
         L     R4,604(0,R4)        RMCT
         MVC   DOMAINO1(80),DOMAINB1
         MVC   DOMAINO2(80),DOMAINB2
         LH    R9,188(0,R4)        NO. OF DOMAINS
         BCTR  R9,0
         L     R4,180(0,R4)        DMDT
         SPACE 1
DOMAIN1  LA    R4,64(0,R4)         NEXT DOMAIN                     @TEC
         CLC   6(4,R4),=F'0'       EMPTY DOMAIN
         BNE   DOMAIN2             NO
         CLC   12(4,R4),=F'0'      EMPTY DOMAIN
         BNE   DOMAIN2             NO
         BCT   R9,DOMAIN1          NEXT DOMAIN
         B     RETURN
         SPACE 1
DOMAIN2  SR    R1,R1
         IC    R1,0(0,R4)          DOMAIN NUMBER
         CVD   R1,DOUBLE
         LA    R6,DOMAINO1
         UNPK  DOMAINO1+4(2),DOUBLE+6(2)
         OI    DOMAINO1+5,X'F0'
         LH    R1,10(0,R4)         CURRENT MPL
         LR    R11,R1
         LA    R8,1
         LA    R10,GRAPH1
         BAL   R7,SYSWTO
         SR    R1,R1
         IC    R1,0(0,R4)          DOMAIN NUMBER
         CVD   R1,DOUBLE
         LA    R6,DOMAINO2
         UNPK  DOMAINO2+4(2),DOUBLE+6(2)
         OI    DOMAINO2+5,X'F0'
         LH    R1,6(0,R4)          CURRENT MPL
         LA    R1,8(0,R1)
         SRL   R1,4
         LR    R11,R1
         LA    R8,1
         LA    R10,GRAPH1
         BAL   R7,SYSWTO
         BCT   R9,DOMAIN1          NEXT DOMAIN
         B     RETURN
SYSACCUM SR    R14,R14
         SR    R15,R15
         L     R10,0(0,R6)         PREVIOUS SLOT
         LA    R10,4(0,R10)        NEXT SLOT
         CR    R10,R11             SLOT OK
         BL    SYSACC1             YES
         LA    R10,4(0,R6)         1ST SLOT
         SPACE 1
SYSACC1  ST    R1,0(0,R10)         SAVE VALUE
         ST    R10,0(0,R6)         SAVE NEW SLOT ADDR
         SR    R10,R10
         SPACE 1
SYSACC2  LA    R6,4(0,R6)          NEXT TABLE SLOT
         CLC   0(4,R6),=F'0'       END OF SLOTS
         BE    SYSACC3             YES
         CR    R6,R11              END OF SLOTS
         BE    SYSACC3             YES
         LA    R10,1(0,R10)        NO. OF SLOTS FOR AVERAGE
         A     R15,0(0,R6)         ADD TO TOTAL
         B     SYSACC2
         SPACE 1
SYSACC3  C     R10,=F'0'           0C9 POSSIBLE
         BE    SYSACC4             YES
         DR    R14,R10             AVG VALUE
         LR    R11,R15
         BR    R7
         SPACE 1
SYSACC4  SR    R11,R11
         BR    R7
SYSWTO   MVC   WTOLIST+4(80),0(R6)
         CLI   PARM,C'A'           AVG GRAPHIC DISPLAY
         BNE   *+10                NO
         LR    R14,R1
         LR    R1,R11
         LR    R11,R14
         CVD   R11,DOUBLE
         MVC   AAA(4),=X'40202120'
         ED    AAA(4),DOUBLE+6
         CVD   R1,DOUBLE
         MVC   BBB(4),=X'40202120'
         ED    BBB(4),DOUBLE+6
         SR    R14,R14
         SR    R15,R15
         C     R8,=F'0'            0C9 POSSIBLE
         BE    SYSWTO1             YES
         LR    R15,R1
         DR    R14,R8              NUMBER OF GRAPH POSITIONS
         SPACE 1
SYSWTO1  CH    R15,=H'50'          MAX POSITIONS
         BNH   *+8                 NO
         LH    R15,=H'50'          FORCE MAX
         EX    R15,GRAPHMVE
         LA    R1,GRAPH(R15)
         MVI   0(R1),C'>'
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         BR    R7
         SPACE 1
GRAPHMVE MVC   GRAPH(0),0(R10)
MSGRTN   SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         SPACE 3
RETURN   ESTAE 0
         LA    R8,AMODE24                                          @TEC
         BSM   0,R8                                                @TEC
AMODE24  DS    0H                                                  @TEC
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(CSCGS03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         B     MSGRTN
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
WTOHDR   DC   CL29' '
         DC   5CL10'|----|----',C'| '
GRAPH1   DC   CL51'0=========1=========2=========3=========4=========='
GRAPH2   DC   CL51'0====1====2====3====4====5====6====7====8====9====='
         SPACE 3
LGCPUOVL DC    CL80'LONG TERM CPU     '
AVCPUOVL DC    CL80'AVERAGE CPU       '
AVPAGOVL DC    CL80'AVERAGE PAGING    '
AVUICOVL DC    CL80'AVERAGE UIC       '
AVASQOVL DC    CL80'ASMQ LENGTH       '
         SPACE 1
DOMAINB1 DC    CL80'DMN XX CURR MPL   '
DOMAINB2 DC    CL80'DMN XX RDY USER   '
         SPACE 3
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
XSASAVE  DS    F
PARM     DS    F
DOMAINO1 DS    CL80
DOMAINO2 DS    CL80
ESTAELST DS    0F,(ESTAEOVX)X
         SPACE 3
         DS    0F
WTOLIST  DS    F
         DS    CL17
AAA      DS    CL4
         DS    CL1
BBB      DS    CL4
         DS    CL3
GRAPH    DS    CL51
         SPACE 3
WORKEND  DS    0F
         SPACE 5
AVERAGE  DSECT
LGCPU    DS    21F
LGCPUEND DS    0F
AVCPU    DS    21F
AVCPUEND DS    0F
AVPAG    DS    21F
AVPAGEND DS    0F
AVUIC    DS    21F
AVUICEND DS    0F
AVASQ    DS    21F
AVASQEND DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
XAA      DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCGU03D
         TITLE 'CSCGU03D -   U  DISK SPACE MAP'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       CSCGU03D -       U  DISK SPACE MAP                        ***
***                                                                 ***
***       VERSION -        1.2                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE TO MVS/SP1.3                      ***
***                                                                 ***
***       UPDATED -        01/10/82  RLL - CHANGE ESTAE PARM LENGTH ***
***                        09/27/82  CBT-AXC ADD 3375 AND 3380      ***
***                                          SUPPORT                ***
***                                                                 ***
***********************************************************************
***********************************************************************
CSCGU03D CSECT
         LR    R12,R15
         USING CSCGU03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         L     R3,XAL
         LA    R3,0(0,R3)
         XC    PARM(8),PARM
         LTR   R3,R3
         BZ    *+10                NO PARM
         MVC   PARM(8),0(R3)
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         LA    R1,HDR1
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         L     R9,16               .CVT
         L     R9,40(0,R9)         .UCB LOOKUP TABLE
         XC    UCBDMSAV(24),UCBDMSAV
CHEK     BAL   R10,UCBDML#0        GET NEXT UCB ADDR
         LTR   R1,R1               END OF UCBS
         BZ    EOJ                 YES, EXIT
         LR    R4,R1
         CLI   18(R4),X'20'   SEE IF UCB IS FOR DASD
         BNE   CHEK           NO, IGNORE IT
         TM    3(R4),X'80'    IS DEVICE ONLINE
         BZ    CHEK           NO, IGNORE IT
         TM    3(R4),X'50'    PENDING OFFLINE/UNLOAD
         BNZ   CHEK           YES, IGNORE IT
         TM    35(R4),X'80'   MOUNT PENDING
         BNZ   CHEK           YES, IGNORE IT
         CLI   28(R4),X'00'   ANY VOLUME INFORMATION?
         BE    CHEK           NO, VOLUME NOT VERIFIED YET
         CLI   PARM,X'00'     ANY VOLUME PARM
         BE    CHEK2          NO, ALL UNITS
         CLC   PARM(2),=C'D=' DEVICE TYPE
         BE    CHEK2          YES
         CLC   PARM(2),=C'U=' SINGLE UNIT
         BNE   CHEK0          NO
         CLC   PARM+2(3),13(R4)  UNIT MATCH
         BE    CHEK2          YES
         B     CHEK
         SPACE 1
CHEK0    LA    R1,7
         LA    R14,27(0,R4)
         LA    R15,PARM-1
         SPACE 1
CHEK1    BCT   R1,*+8
         B     CHEK2
         LA    R14,1(0,R14)
         LA    R15,1(0,R15)
         CLI   0(R15),X'00'   END OF CHECK
         BE    CHEK2          YES
         CLI   0(R15),X'40'   END OF CHECK
         BE    CHEK2          YES
         CLC   0(1,R14),0(R15)  VOL MATCH
         BE    CHEK1          YES
         B     CHEK
CHEK2    MVC   DTLLNE-4(84),DTLOVL
         MVC   CLASS(6),=CL6'3330-1' INDICATE 3330 MOD 11
         CLI   19(R4),X'0D'   IS IT A MODEL 11 3330?
         BE    CHKSTATS       YES, CHECK STATUS
         MVC   CLASS(6),=CL6'3330' INDICATE A MODEL 1 3330
         CLI   19(R4),X'09'   IS IT A MODEL 1 3330?
         BE    CHKSTATS       YES, CHECK STATUS
         MVC   CLASS(6),=CL6'3350' INDICATE A 3350
         CLI   19(R4),X'0B'   IS IT A 3350?
         BE    CHKSTATS       YES, CHECK STATUS
         MVC   CLASS(6),=CL6'3375' INDICATE A 3375         CBT-AXC
         CLI   19(R4),X'0C'   IS IT A 3375?                CBT-AXC
         BE    CHKSTATS       YES, CHECK STATUS            CBT-AXC
         MVC   CLASS(6),=CL6'3380' INDICATE A 3380         CBT-AXC
         CLI   19(R4),X'0E'   IS IT A 3380?                CBT-AXC
         BE    CHKSTATS       YES, CHECK STATUS            CBT-AXC
         MVC   CLASS(6),=CL6'2314' INDICATE 2314/2319
         CLI   19(R4),X'08'   IS IT A 2314/2319?
         BE    CHKSTATS       YES, CHECK STATUS
         MVC   CLASS(6),=CL6'2305-1' INDICATE A DRUM MODEL 1
         CLI   19(R4),X'06'   IS IT A 2305 MOD 1?
         BE    CHKSTATS       YES, CHECK STATUS
         MVC   CLASS(6),=CL6'2305-2' INDICATE A DRUM MODEL 2
         CLI   19(R4),X'07'   IS IT A MODEL 2 DRUM?
         BE    CHKSTATS       YES, CHECK STATUS
         MVC   CLASS(6),=CL6'MSSC' INDICATE THE MSS CONTROL
         CLI   19(R4),X'42'   IS IT THE MSS?
         BE    CHKSTATS       YES, CHECK STATUS
         MVC   CLASS(6),=CL6' ' UNKNOWN DEVICE TYPE
         SPACE 1
CHKSTATS TM    17(R4),X'08'   IS THIS A VIRTUAL VOLUME?
         BZ    NOTVIRT        NO, CONTINUE
         MVI   CLASS+4,C'V'  INDICATE VIRTUAL DEVICE
         SPACE 1
NOTVIRT  CLC   PARM(2),=C'D=' DEVTYPE CHECK
         BNE   NOTVIRT1       NO
         CLC   CLASS(6),PARM+2  DEV MATCH
         BNE   CHEK           NO
         SPACE 1
NOTVIRT1 MVI   STATUS,C'O'    INDICATE DEVICE UNALLOCATED
         TM    3(R4),X'08'    IS IT ALLOCATED
         BNO   *+8            YES, DONT RESET STATUS
         MVI   STATUS,C'A'    NO, INDICATE DEVICE ALLOCATED
         MVC   ATTR(3),=C'PRV'   INDICATE PRIVATE
         TM    34(R4),X'10'   IS IT PRIVATE
         BO    DOSVC          YES, CONTINUE
         MVC   ATTR(3),=C'PUB'   INDICATE PUBLIC
         TM    34(R4),X'08'   IS IT PUBLIC
         BO    DOSVC          YES, CONTINUE
         MVC   ATTR(3),=C'STG'   INDICATE STORAGE
         TM    34(R4),X'04'   IS IT STORAGE
         BO    DOSVC          YES, CONTINUE
         MVC   ATTR(3),=C'   '   CLEAR INDICATOR
         SPACE 1
DOSVC    LA    0,0(0,R4)      LOAD PNTR TO UCB INTO REG 0
         LA    R1,MSGAREA     LOAD PNTR TO MSGAREA INTO REG 1
         SVC   78             GET DATA FOR THIS DASD
         LTR   R15,R15        TEST REG 15 FOR ZERO
         BNZ   CHEK           ERROR, CHECK NEXT DEVICE
CNTNU    MVC   VOLUME(6),28(R4)  MOVE VOLUME SERIAL NUMBER
         MVC   ADDR(3),13(R4)    MOVE DEVICE ADDRESS
         ICM   R11,1,35(R4)   OPEN DCBS
         N     R11,=X'0000007F' TURN OFF UCBMOUNT BIT, IF ON
         CVD   R11,DBWRD      CHANGE TO PACKED DECIMAL
         MVC   DCBS(6),=X'402020202120'
         ED    DCBS(6),DBWRD+5  MOVE TO DETAIL LINE
         ICM   R11,1,38(R4)   NUMBER OF CURRENT USERS
         CVD   R11,DBWRD      CHANGE TO PACKED DECIMAL
         MVC   USRS(6),=X'402020202120'
         ED    USRS(6),DBWRD+5  MOVE TO DETAIL LINE
         PACK  DBWRD(8),FREECYL(4)
         MVC   DTLCYL(6),=X'402020202120'
         ED    DTLCYL(6),DBWRD+5
         PACK  DBWRD(8),FREETRK(4)
         MVC   DTLTRK(6),=X'402020202120'
         ED    DTLTRK(6),DBWRD+5
         PACK  DBWRD(8),FREEXTNT(4)
         MVC   DTLEXT(4),=X'40202120'
         ED    DTLEXT(4),DBWRD+6
         PACK  DBWRD(8),CONTGCYL(4)
         MVC   DTLCCY(6),=X'402020202120'
         ED    DTLCCY(6),DBWRD+5
         PACK  DBWRD(8),CONTGTRK(4)
         MVC   DTLCTR(6),=X'402020202120'
         ED    DTLCTR(6),DBWRD+5
         LA    R1,DTLLNE-4
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     CHEK           CONTINUE
         SPACE 1
EOJ      ESTAE 0                                      ****(RLL)****
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
UCBDML#0 ST    R8,UCBDMSAV         .SAVE WORK REG 1
         ST    R10,UCBDMSAV+8      .SAVE WORK REG 3
         ST    R11,UCBDMSAV+12     .SAVE WORK REG 4
         L     R8,UCBDMLOW         .SET SEARCH ARGUMENT
         SPACE 1
UCBDML#1 LA    R8,1(0,R8)          .NEXT UNIT ADDR POSSIBLE
         L     R10,=X'0000FFFF'    .SET MAX NEXT LEAST HIGH
         SPACE 1
UCBDML#2 CLC   0(2,R9),=X'FFFF'    .END OF TABLE
         BE    UCBDMOUT            .YES, GO PROCESS
         SR    R1,R1
         ICM   R1,3,0(R9)          .LOAD UCB ADDR
         LTR   R1,R1               .ZERO ADDR
         BNZ   UCBDML#4            .NO, CONTINUE
         SPACE 1
UCBDML#3 LA    R9,2(0,R9)          .NEXT UCB LOOKUP TABLE ENTRY
         B     UCBDML#2
         SPACE 1
UCBDML#4 BAL   R11,UCBDMCNV        .CONVERT UNIT ADDR TO HEX
         CR    R1,R8               .UNIT EQUAL
         BL    UCBDML#3            .LOW NOT EQUAL, NEXT UCB
         LR    R10,R1              .SET NEXT LEAST HIGH UNIT ADDR
         MVC   UCBDMCUR+2(2),0(R9) .SET NEXT LEAST HIGH UCB ADDR
         B     UCBDMOUT            .GO PROCESS
UCBDMCNV SR    R14,R14
         SR    R15,R15
         IC    R15,13(0,R1)        .UNIT ADDR DIGIT
         TM    13(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,14(0,R1)        .UNIT ADDR DIGIT
         TM    14(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,15(0,R1)        .UNIT ADDR DIGIT
         TM    15(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         LR    R1,R14              .SET RESULTS REG
         BR    R11
         SPACE 3
UCBDMOUT C     R10,=X'0000FFFF'    .ALL DONE
         BE    UCBDMEX             .YES
         ST    R10,UCBDMLOW        .NEXT LOW UNIT ADDR
         L     R1,UCBDMCUR         .LOAD UCB ADDR FOR FOUND UNIT
         B     UCBDMCON            .CONTINUE
         SPACE 1
UCBDMEX  SR    R1,R1               .CLEAR UCB ADDR REGISTER
         L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         B     UCBDMRET            .END OF UCBS
         SPACE 1
UCBDMCON L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         SPACE 1
UCBDMRET EQU   *
         BR    R10
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(CSCGU03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EOJ
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
HDR1     DC    X'00540100'
         DC    CL40'UNIT  DEVICE   STATUS    VOLSER   DCBS  '
         DC    CL40' USERS    CYLS  TRKS  EXT  CTGCYL CTGTRK'
         SPACE 3
DTLOVL   DC    X'00540100'
         DC    CL17' ',CL5'(   )',CL58' '
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
DBWRD    DS    2F
XSASAVE  DS    F
PARM     DS    2F
         SPACE 3
UCBDMSAV DS    4F
UCBDMLOW DS    F
UCBDMCUR DS    F
         SPACE 3
DTLPREFX DS    F
DTLLNE   DS    0CL80
ADDR     DS    CL6            DEVICE ADDRESS
CLASS    DS    CL9            DEVICE TYPE (CLASS)
STATUS   DS    CL3            STATUS (OPEN/ALLOCATED)
ATTR     DS    CL7            MOUNT ATTRIBUTE
VOLUME   DS    CL7            VOLUME SERIAL NUMBER
DCBS     DS    CL8            OPEN DCBS
USRS     DS    CL8            OPEN DCBS
DTLCYL   DS    CL6            TOTAL FREE CYLINDERS
DTLTRK   DS    CL7            TOTAL FREE TRACKS
DTLEXT   DS    CL6            NUMBER OF EXTENTS
DTLCCY   DS    CL7            LARGEST CONTIG CYLS
DTLCTR   DS    CL6            LARGEST CONTIG ADDITIONAL TRACKS
         SPACE 3
*
*        THE FOLLOWING IS THE SVC 78 PARAMETER LIST
*
MSGAREA  DS    0CL30
         DS    CL6            CONSTANT - 'SPACE='
FREECYL  DS    CL4            TOTAL NO. FREE CYLINDERS
         DS    CL1            CONSTANT - ','
FREETRK  DS    CL4            TOTAL NO. FREE TRACKS OUTSIDE CYLS
         DS    CL1            CONSTANT - ','
FREEXTNT DS    CL4            TOTAL NO. FREE EXTENTS
         DS    CL1            CONSTANT - '/'
CONTGCYL DS    CL4            LARGEST CONTIGUOUS FREE AREA
         DS    CL1             IN CYLS AND TRKS
CONTGTRK DS    CL4
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X                         ****(RLL)****
         SPACE 3
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
XAA      DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSA03D
*          DATA SET TEC1283    AT LEVEL 001 AS OF 09/14/82
         TITLE 'IEESA03D -   #N  DISPLAY ENQUEUE 1ST LOAD'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESA03D -       #N DISPLAY ENQUEUE 1ST LOAD              ***
***                                                                 ***
***       VERSION -        2.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS 3.8 SP2/3                            ***
***                                                                 ***
***       UPDATED -        07/22/81  AXC-CBT HANDLE ESTAE           ***
***               -        10/30/81  SP2/3  -BNSW-                  ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESA03D CSECT
         B     14(0,R15)          BRANCH AROUND ID
         DC    AL1(8)
         DC    CL8'IEESA03D'      IDENTIFIER
         LR    R12,R15            SET ADDRESSABILITY
         USING IEESA03D,R12
         LA    R0,LWKDSECT        SIZE OF SAVE-AREA AND WORK-AREA
         O     R0,SUB241          GET FROM SUBPOOL
         LR    R4,R0              SAVE SP AND LENGTH
         GETMAIN R,LV=(0)
         XC    0(256,R1),0(R1)    ZERO-OUT PART OF WORK AREA
         XC    256(256,R1),256(R1)  MORE
         LR    R13,R1
         USING WKDSECT,R13        FIRST 18 WRDS ARE SAVE-AREA
         ST    R14,SAVA           PUT RETURN ADDRESS IN UNUSED SLOT
         MVC   SUBPOOL(4),SUB241  SAVE FREEMAIN SUBPOOL
         ST    R2,XSASAVE         SAVE XSA PTR
         STH   R4,WKSIZE          SAVE SIZE
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
***********************************************************************
*
*        GET CORE FOR WORK TABLE
*
***********************************************************************
         L     R0,CORSIZ          LOAD GETMAIN SIZE
         O     R0,SUBPOOL         SUBPOOL
         STH   R0,CORESIZE        SAVE SP AND LENGTH
         GETMAIN R,LV=(0)
         LA    R1,0(0,R1)
         ST    R1,CORE            SAVE GETMAIN ADDR
***********************************************************************
*
*        PARSE INPUT STRING
*
***********************************************************************
         MVC   SJOB(8),=CL8' '
         MVI   MAJNAM,C' '
         MVC   MAJNAM+1(256),MAJNAM    CLEAR MAJOR/MINOR NAME FIELDS
         MVC   MAJNAM+257(6),MAJNAM+256
         USING XSA,R2
         L     R3,XAL             LIST POINTER
         LA    R3,0(,R3)          CLEAR HI-BYTE -- VERB INDEX
         LTR   R3,R3              PARAMETER EXIST ?
         BZ    NOPARM             NO...ASSUME DEFAULTS.
         CLI   0(R3),C'('         JOBNAME SELECT
         BNE   PRMJOBBY           NO, BYPASS
         LA    R1,SJOB-1          SELECTION NAME
         SPACE 1
PRMJOB1  LA    R1,1(0,R1)
         LA    R3,1(0,R3)
         CLI   0(R3),C')'         END OF JOBNAME
         BE    PRMJOB2            YES
         CLI   0(R3),C' '         END OF JOBNAME
         BE    PRMJOBBY           YES
         MVC   0(1,R1),0(R3)      MOVE 1 BYTE OF JOBNAME
         B     PRMJOB1
         SPACE 1
PRMJOB2  LA    R3,1(0,R3)
         SPACE 1
PRMJOBBY LR    R8,R3              START OF LIST
         CLI   0(R3),C'Â¬'         FIND ONLY MAJOR NAMES ?
         BNE   *+8                NO
         MVI   0(R3),C'*'
         CLI   0(R3),C'*'         FIND ONLY MAJOR NAMES ?
         BE    SETMAJNM           YES..
         LA    R4,0               LENGTH COUNTER
         LA    R5,9
LOOP2    CLI   0(R3),C'/'         MAJOR/MINOR DELIMITER ?
         BE    GOTMAJOR           YES...
         CLI   0(R3),C' '         END-OF-STRING ?
         BE    PARMERR            YES...NO MINOR NAME GIVEN.
         LA    R4,1(,R4)          INCREMENT LENGTH
         LA    R3,1(,R3)          INCREMENT PTR
         BCT   R5,LOOP2           TRY NEXT CHAR
         B     BADERR             MAJOR NAME TOO LONG.
GOTMAJOR BCTR  R4,0               SET FOR EXECUTE
         LA    R6,MAJNAM          WHERE TO GO IN EXECUTE
         EX    R4,MVNAM           GET MAJOR NAME
         STH   R4,MAJLGTH         SAVE MODIFIED LENGTH
         LA    R4,0               RESET LENGTH COUNTER
         LA    R3,1(,R3)          MOVE PAST '/'
         LR    R8,R3              SAVE START OF MINOR NAME
         LA    R5,256             MAX LENGTH OF MINOR NAME
LOOP3    CLI   0(R3),C' '         END-OF-STRING
         BE    GOTMINOR           YES...
         LA    R3,1(,R3)          INCREMENT PTR
         LA    R4,1(,R4)          INCREMENT LENGTH
         BCT   R5,LOOP3
         B     BADERR             MINOR NAME TOO LONG
GOTMINOR BCTR  R4,0
         LA    R6,MINNAME         WHERE TO GO IN EXECUTE
         EX    R4,MVNAM           GET MINOR NAME
         LA    R4,1(,R4)          RESET LENGTH
         STH   R4,MINLGTH         SAVE LENGTH
***********************************************************************
*
*        SCAN FOR '*' IN MINOR NAME
*
***********************************************************************
         LA    R3,MINNAME
         LA    R4,0               COUNT OF CHAR PRIOR TO '*'
         LH    R5,MINLGTH
LOOP4    CLI   0(R3),C'Â¬'         FIND IT ?
         BNE   *+8                NO
         MVI   0(R3),C'*'
         CLI   0(R3),C'*'         FIND IT ?
         BE    ASK                YES...
         LA    R3,1(,R3)          NO..NEXT CHAR
         LA    R4,1(,R4)          INCREMENT COUNT
         BCT   R5,LOOP4
         B     NOASK              NO '*' IN MINOR NAME
ASK      LTR   R4,R4              ANY CHAR PRIOR TO '*' ?
         BZ    ALLMINOR           NO..GET ALL MINOR NAMES
         MVI   SWTCH,X'0F'        YES..PARTIAL MINOR NAME GIVEN
         STH   R4,MINLGTH         SET NEW LENGTH
         B     NOASK              JOIN COMMON CODE
ALLMINOR MVI   SWTCH,X'F0'        SET FOR ALL MINOR NAMES
         B     NOASK
SETMAJNM MVI   MAJNAM,C'*'        SET MAJOR NAME
         XC    MAJLGTH(2),MAJLGTH SET MODIFIED LENGTH
         MVI   SWTCH+1,X'0F'      SET FOR ONLY MAJOR NAMES
***********************************************************************
*
*        NO PARAMETERS SPECIFIED, ASSUME DEFAULTS
*
***********************************************************************
NOPARM   EQU   *
         XC    MAJLGTH(4),MAJLGTH ZERO OUT NAME LENGTH FIELDS
         LA    R5,7               SET MODIFIED LENGTH OF
         STH   R5,MAJLGTH         MAJOR NAME AND MOVE IN NAME
         MVC   MAJNAM(8),=CL8'SYSIEFSD'
         MVI   MINNAME,C'*'       SET MINOR NAME
         MVI   SWTCH,X'F0'        SET FOR ALL MINOR NAMES
***********************************************************************
*
*        OBTAIN FIRST MAJOR QCB
*
***********************************************************************
NOASK    EQU   *
         L     R5,X'10'           CVT PTR
         LA    R3,0               CURRENT NUMBER OF TABLE ENTRIES
         LA    R5,1000            MAX NUMBER OF ENTRIES
         L     R4,CORE            START OF FREE CORE TABLE
         SPACE
         B     SP3                LEAVE OLD CODE INTACT *****
         SPACE
         L     R2,640(0,R5)       FIRST VALID MAJOR QCB
         LTR   R2,R2              DOES IT EXIST ?
         BZ    NOMAJNAM           NO...
         TM    SWTCH+1,X'0F'      OBTAIN ONLY MAJOR NAMES ?
         BZ    LOOP5              NO...CONTINUE NORMALLY
***********************************************************************
*
*        OBTAIN ONLY MAJOR QCB NAMES HERE
*
***********************************************************************
MAJLOOP  MVC   0(8,R4),16(R2)     GET MAJOR QCB NAME
         LA    R3,1(,R3)          INCREMENT COUNTER
         LA    R4,8(,R4)          NEXT TABLE ENTRY
         CR    R3,R5              OVERFLOW TABLE ?
         BH    TABLOVFL           YES...
         L     R2,0(,R2)          NEXT MAJOR QCB
         LTR   R2,R2              EXIST ?
         BNZ   MAJLOOP            YES...GO GET IT
         B     EXITOK1            ALL FINISHED.
***********************************************************************
*
*        FIND REQUESTED MAJOR NAME QCB
*
***********************************************************************
LOOP5    CLC   16(8,R2),MAJNAM    MAJOR NAMES MATCH ?
         BE    LOOKMIN            YES...FIND MINOR NAMES
         L     R2,0(,R2)          NEXT MAJOR QCB
         LTR   R2,R2              END-OF-LIST ?
         BNZ   LOOP5              NO...TRY NEXT QCB
         B     NOMAJNAM           SET ERROR CODE
***********************************************************************
*
*        MAJOR QCB FOUND, LOOK FOR MINOR QCB(S)
*
***********************************************************************
LOOKMIN  L     R7,8(,R2)          FIRST MINOR QCB
         LTR   R7,R7              EXIST ?
         BNZ   MINOROK            YES...SHOULDN'T FALL THRU
         B     QCBERR             SET ERROR CODE
MINOROK  TM    SWTCH,X'F0'        ALL MINOR NAMES ?
         BZ    CHKMIN             NO...
         CLC   20(3,R7),=C'SYS'   SYSTEM NAME
         BNE   CHKQEL             NO, CONTINUE
         CLC   28(2,R7),=C'.T'    SYSTEM NAME
         BNE   CHKQEL             NO, CONTINUE
         CLI   36(R7),C'.'        SYSTEM NAME
         BNE   CHKQEL             NO, CONTINUE
         MVC   NUMCHK(6),=6C'0'   SET NUMERIC FIELD
         MVZ   NUMCHK(5),23(R7)   MOVE NUMERIC ZONES
         CLC   NUMCHK(6),=6C'0'   STILL NUMERIC
         BNE   CHKQEL             NO, NOT SYSTEM NAME
         MVZ   NUMCHK(6),30(R7)   MOVE NUMERIC ZONES
         CLC   NUMCHK(6),=6C'0'   STILL NUMERIC
         BE    NEXTMIN            NO, SYSTEM NAME
CHKQEL   SR    R9,R9
         IC    R9,16(R7)          LENGTH OF MINOR QCB NAME
         CH    R9,=H'44'          GTR 44 BYTES ?
         BNH   LGTHOK             NO...USE AS IS
         LA    R9,44              YES..RESET TO 44 AND TRUNCATE NAME
LGTHOK   STC   R9,1(,R4)          PUT NAME LENGTH IN TABLE
         LA    R9,2(,R9)          INCREASE FOR FOLLOWING COMPUTATIONS
         SR    R10,R10
         LR    R11,R9             LENGTH OF MINOR NAME+CONTROL BYTES
         D     R10,=F'9'          MULTIPLE OF 9 ?
         LTR   R10,R10            ANY REMAINDER ?
         BZ    L9                 NO...
         LA    R11,1(,R11)        YES...ROUND UP
L9       STC   R11,0(,R4)         PUT NO. OF TABLE ENTRIES IN TABLE
         CLI   20(R7),C'$'        PRINTABLE NAME           AXC
         BL    UNKNOWN            NO, UNKNOWN
         CLI   20(R7),C'9'        PRINTABLE NAME
         BH    UNKNOWN            NO, UNKNOWN
         ST    R3,MINENTRY        SAVE CURRENT TABLE ENTRIES
         AR    R3,R11             INCREMENT NO. OF ENTRIES
         CR    R3,R5              OVERFLOW TABLE ?
         BH    TABLOFL2           HOPEFULLY NOT.
         BCTR  R9,0               REDUCE LENGTH
         BCTR  R9,0               TO ORIGINAL AND THEN
         BCTR  R9,0               SET FOR EXECUTE INST
         EX    R9,QCBNAME         GET MINOR QCB NAME
*                                 NO. OF TABLE SLOTS TAKEN BY NAME
UNKBACK  SR    R10,R10            MULTIPLIED BY 9 BYTES/SLOT
         M     R10,=F'9'          EQUALS TOTAL LENGTH TAKEN
         ST    R4,MINADDR
         AR    R4,R11             ADDED TO SLOT POINTER
         L     R8,8(,R7)          FIRST QEL
         LTR   R8,R8              EXIST ?
         BNZ   QELOK              YES...SHOULDN'T FALL THRU
         B     QELERR             SET ERROR CODE
QELOK    SR    R14,R14            INSERT
         IC    R14,14(0,R8)          ASID
         SLL   R14,8                    INTO REG 14
         IC    R14,15(0,R8)                AND MULTIPLY
         SLL   R14,2                          BY FOUR
         L     R15,16             CVT ADDR
         L     R15,556(0,R15)     ASVT ADDR
         L     R15,524(R14,R15)   ASCB ADDR
         L     R14,56(0,R15)      CSCB ADDR
         CLI   28(R14),X'03'      INIT CSCB ADDR
         BE    QELOKJOB           YES, GO HANDLE
QELOKBAK LA    R14,0(0,R14)       CLEAR HIGH ORDER
         LTR   R14,R14            CSCB ZERO
         BZ    QELOKAS            YES, GO PRINT ASID
         MVC   0(8,R4),8(R14)     JOBNAME
         CLC   SJOB(8),=CL8' '    ANY SELECTION JOB
         BE    QELOKBK            NO, BYPASS
         CLC   0(8,R4),SJOB       JOB MATCH SELECTION JOB
         BE    QELOKBK            YES, CONTINUE
         B     NEXTQELS
QELOKAS  CLC   SJOB(8),=CL8' '    ANY SELECTION JOB
         BNE   NEXTQELS           YES, NO ASID SELECTION
         MVC   0(4,R4),=CL4'AS= '
         UNPK  4(5,R4),14(3,R8)   UNPK ASID
         NC    4(4,R4),=4X'0F'    TRANSLATE TO PRINT
         TR    4(4,R4),=C'0123456789ABCDEF'
QELOKBK  MVI   8(R4),C'S'         ASSUME SHR'D ENQ
         TM    12(R8),X'10'       RESERVE
         BZ    QELOKBKX           NO, BR AROUND
         MVI   8(R4),C'R'         IND SHR RESERVE
QELOKBKX TM    12(R8),X'80'       IS IT SHR'D ?
         BO    NEXTONE            YES...
         MVI   8(R4),C'E'         NO...MUST BE EXCLUSIVE
         TM    12(R8),X'10'       RESERVE
         BZ    NEXTONE            NO, BR AROUND
         MVI   8(R4),C'X'         IND EXCL RESERVE
NEXTONE  LA    R3,1(,R3)          INCREMENT ENTRY NUMBER
         LA    R4,9(,R4)          INCREMENT TABLE LOCATION
         CR    R3,R5              TOO MANY ENTRIES IN TABLE ?
         BH    TABLOVFL           YES...IGNORE REMAINDER
         MVI   SWTCH+1,X'F0'      FLAG MINORS FOUND
         CLC   SJOB(8),=CL8' '    ANY SELECTION JOB
         BNE   NEXTMIN            YES, NEXT MINOR QCB
NEXTQEL  L     R8,0(,R8)          NEXT QEL
         LA    R8,0(,R8)          CLEAR HI-BYTE
         LTR   R8,R8              QEL EXIST ?
         BNZ   QELOK              YES.
         B     NEXTMIN            NO...GET NEXT MINOR QCB
NEXTQELS L     R8,0(,R8)          NEXT QEL
         LA    R8,0(,R8)          CLEAR HI-BYTE
         LTR   R8,R8              QEL EXIST ?
         BNZ   QELOK              YES.
         L     R3,MINENTRY        RESET NUMBER OF ENTRIES
         L     R4,MINADDR         RESET MIN NAME ADDR
         B     NEXTMIN            NO...GET NEXT MINOR QCB
         SPACE 1
CHKMIN   SR    R8,R8
         IC    R8,16(,R7)         LENGTH OF MINOR NAME
         TM    SWTCH,X'0F'        ALL NAMES STARTING WITH GIVEN ?
         BO    ALL                YES.
         CH    R8,MINLGTH         MINOR NAME LENGTHS AGREE ?
         BNE   NEXTMIN            NO...TRY ANOTHER MINOR QCB
COMP     BCTR  R8,0               LENGTHS AGREE..BUT DO NAMES ?
         EX    R8,COMPMINR        FIND OUT.
         BE    CHKQEL             YES..GET OWNER'S JOBNAME/USERID
NEXTMIN  L     R7,0(,R7)          NEXT MINOR QCB
         LTR   R7,R7              EXIST ?
         BZ    EXITOK             NO..OUTPUT DATA
         B     MINOROK            TRY THIS MINOR QCB.
ALL      LH    R8,MINLGTH         LENGTH OF MINOR NAME TO START WITH
         B     COMP               JOIN COMMON CODE
QELOKJOB LR    R15,R14            CSCB ADDR
         SR    R1,R1              INSERT
         IC    R1,14(0,R8)           ASID
         SLL   R1,8                     INTO
         IC    R1,15(0,R8)                 REG 1
QELOKJB1 L     R14,0(0,R14)      NEXT CSCB
         LTR   R14,R14           END OF CSCBS
         BNZ   *+10              NO, CONTINUE
         LR    R14,R15           LOAD CSCB ADDR
         B     QELOKBAK          CONTINUE
         CR    R14,R15           SAME CSCB
         BE    QELOKBAK          YES, INIT
         CH    R1,30(0,R14)      ASID MATCH
         BNE   QELOKJB1          NO, CHECK NEXT
         B     QELOKBAK          GO USE CSCB
SP3      DS    0H                 FOR MVS SP3, USE GQSCAN
         USING RIB,R2
         USING RIBE,R7
         USING RIBVAR,R15
         ST    R4,SPSTART         KEEP START POINT
         XC    TOKEN,TOKEN        FOR 1ST GQSCAN
         MVC   GQSCANL(GQSCANE-GQSCANP),GQSCANP SET UP LIST FORM
         MVI   SWTCHA,0           MAJOR NAME NOT FOUND YET
         SPACE
         TM    SWTCH+1,X'0F'      IF QNAME IS KNOWN
         BZ    SPLOOP5            THEN GO FIND SPECIFIC/GENERIC RNAME
*                                 ELSE FIND ALL MAJOR NAMES
***********************************************************************
*
*        OBTAIN MAJOR QCB NAMES HERE USING GQSCAN
*
***********************************************************************
         SPACE
SPMAJGQ  GQSCAN AREA=(AREA,L'AREA),TOKEN=TOKEN,MF=(E,GQSCANL),         *
               SCOPE=ALL,REQCNT=1
         ST    R15,GQRET          KEEP RC
         CH    R15,=H'8'          IF WE GET GRS ERROR
         BH    QCBERR             THEN CALL IT QCB ERROR
         CH    R15,=H'4'          IF NO MORE FOUND
         BE    EXITOK1            THEN GO CALL PRINT MODULE
         STH   R0,RIBELEN         L'RIBE
         LA    R2,AREA            A(1ST RIB)
SPMAJMAJ ST    R1,NUMRIBS         NUMBER OF MAJOR NAMES (RIBS)
         SPACE
*        CHECK FOR DUPLICATE QNAMES ALREADY IN TABLE
         LTR   R1,R3              NUMBER IN TABLE
         BZ    SPSTMAJ            NONE - GO STORE 1ST ONE
         L     R15,SPSTART        1ST IN TABLE
SPCOMAJ  CLC   0(8,R15),RIBQNAME  IF QNAME IS ALREADY IN TABLE
         BE    SPMAJNXT           THEN DON'T PUT IT IN AGAIN
         LA    R15,8(R15)         NEXT IN TABLE
         BCT   R1,SPCOMAJ         REPEAT FOR ALL IN TABLE
         SPACE
SPSTMAJ  MVC   0(8,R4),RIBQNAME   MAJ NAME INTO TABLE
         LA    R3,1(,R3)          COUNT NUMBER IN TABLE
         LA    R4,8(,R4)          NEXT TABLE ENTRY
         CR    R3,R5              TOO MANY?
         BH    TABLOVFL           YES - GET OUT
*        GET NEXT RIB
SPMAJNXT LA    R15,RIBEND         END OF RIBN
         LA    R7,RIBVAR          VAR PORTION
         AH    R7,RIBVLEN         1ST RIBE
         L     R1,RIBNRIBE        NUMBER OF RIBE'S
         MH    R1,RIBELEN         * LENGTH OF EACH
         AR    R7,R1              NEXT RIB
         LR    R2,R7
         L     R1,NUMRIBS         NUMBER STILL IN AREA
         BCT   R1,SPMAJMAJ        PROCESS THOSE IN AREA
         CLC   =F'8',GQRET        IF THERE ARE MORE
         BE    SPMAJGQ            THEN GO GET THEM
         B     EXITOK1            ELSE GO TO PRINT ROUTINE
         SPACE 3
***********************************************************************
*
*        OBTAIN RNAMES HERE FOR SPECIFIC QNAME USING GQSCAN
*
***********************************************************************
SPLOOP5  DS    0H                 FIND SPECIFIC,GENERIC OR ALL RNAMES
         GQSCAN AREA=(AREA,L'AREA),TOKEN=TOKEN,MF=(E,GQSCANL),         *
               RESNAME=(MAJNAM),SCOPE=ALL,REQCNT=1
         ST    R15,GQRET          KEEP RC
         CH    R15,=H'8'          IF WE GET GRS ERROR
         BH    QCBERR             THEN CALL IT QCB ERROR
         CH    R15,=H'4'          IF NOT FOUND
         BE    SPNOMAJ            THEN GET OUT
         MVI   SWTCHA,1           MAJ NAME WAS FOUND
         STH   R0,RIBELEN         L'RIBE
         LA    R2,AREA            A(RIB)
SPMINMAJ ST    R1,NUMRIBS         NUMBER OF RIBS
         MVI   SWTCHB,0           RNAME NOT MOVED YET
         LA    R15,RIBEND         END OF FIXED PORTION
         LA    R7,RIBVAR          VAR PORTION
         AH    R7,RIBVLEN         A(1ST RIBE)
         L     R1,RIBNRIBE        NUMBER OF RIBE'S
SPRIBE   ST    R1,NUMRIBES
         SPACE 2
*        DO REQUIRED SELECTION
         CLC   SJOB(8),=CL8' '    IF THERE IS NO SELECTION JOB
         BE    SPNOJOBS           THEN SELECT ALL JOBS
         CLC   RIBEJBNM,SJOB      ELSE CHECK JOBNAME
         BNE   SPNEXTE            NOT SPECIFIED JOB - GO ON TO NEXT
SPNOJOBS TM    SWTCH,X'F0'        ALL MINOR NAMES REQUIRED?
         BZ    SPCHKMIN           NO...
         CLC   =C'SYS',RIBRNAME   SYSTEM NAME
         BNE   SPINTAB            NO, GO PUT IN TABLE
         CLC   =C'.T',RIBRNAME+8  SYSTEM NAME
         BNE   SPINTAB            NO, CONTINUE
         CLI   RIBRNAME+16,C'.'   SYSTEM NAME
         BNE   SPINTAB            NO, CONTINUE
         MVC   NUMCHK(6),=6C'0'   SET NUMERIC FIELD
         MVZ   NUMCHK(5),23(R7)   MOVE NUMERIC ZONES
         CLC   NUMCHK(6),=6C'0'   STILL NUMERIC
         BNE   SPINTAB            NO, NOT SYSTEM NAME
         MVZ   NUMCHK(6),30(R7)   MOVE NUMERIC ZONES
         CLC   NUMCHK(6),=6C'0'   STILL NUMERIC
         BE    SPNEXTE            NO, SYSTEM NAME
         B     SPINTAB            GO PUT IN TABLE
         SPACE 2
SPCHKMIN DS    0H                 SPECIFIC OR GENERIC RNAME SELECTION
         SR    R8,R8
         IC    R8,RIBRNMLN        LENGTH OF MINOR NAME
         TM    SWTCH,X'0F'        ALL NAMES STARTING WITH GIVEN ?
         BO    SPALL              YES.
         CH    R8,MINLGTH         MINOR NAME LENGTHS AGREE ?
         BNE   SPNEXTE            NO...GO ON TO NEXT
SPCOMP   BCTR  R8,0               LENGTHS AGREE..BUT DO NAMES ?
         EX    R8,SPCLC           IF RNAMES MATCH
         BE    SPINTAB            THEN GO PUT IN TABLE
         B     SPNEXTE            ELSE GO ON TO NEXT
         SPACE
SPALL    LH    R8,MINLGTH         LENGTH OF MINOR NAME TO START WITH
         B     SPCOMP             JOIN COMMON CODE
         SPACE 2
SPINTAB  BAL   R14,SPSTORE        PUT INTO TABLE
         SPACE
SPNEXTE  AH    R7,RIBELEN         NEXT RIBE IN AREA.
         L     R1,NUMRIBES        REPEAT FOR
         BCT   R1,SPRIBE          RIBES IN AREA.
         SPACE
         LR    R2,R7              NEXT RIB
         L     R1,NUMRIBS         NUMBER OF RIBS REMAINING
         BCT   R1,SPMINMAJ        REPEAT FOR ALL RIBS IN AREA
         SPACE
         CLC   =F'8',GQRET        IF THERE ARE MORE
         BE    SPLOOP5            THEN GO GET THEM
         B     EXITOK             ELSE GO PRINT
         SPACE 3
SPNOMAJ  DS    0H                 NONE THIS TIME, DID WE
         CLI   SWTCHA,0           FIND ANY AT ALL?
         BNE   EXITOK             FOUND ON PREVIOUS GQSCAN.
         B     NOMAJNAM           THIS WAS 1ST GQSCAN - MAJ NOT FOUND
         SPACE 3
SPSTORE  DS    0H                 STORE INFO IN TABLE
         CLI   SWTCHB,0           IF THIS IS 1ST FOR THIS RESOURCE
         BE    SPSRNAM            THEN GO PUT RNAME IN TABLE
SPSJOB   EQU   *                  PUT JOB INFO INTO TABLE
         MVC   0(8,R4),RIBEJBNM   PUT JOBNAME IN TABLE
         MVI   8(R4),C'S'         ASSUME SHR'D ENQ
         TM    RIBERFLG,RIBERESV  RESERVE
         BNO   SPLOKBKX           NO, BR AROUND
         MVI   8(R4),C'R'         IND SHR RESERVE
SPLOKBKX TM    RIBERFLG,RIBETYPE  IS IT SHR'D ?
         BO    SPXTONE            YES...
         MVI   8(R4),C'E'         NO...MUST BE EXCLUSIVE
         TM    RIBERFLG,RIBERESV  RESERVE
         BNO   SPXTONE            NO, BR AROUND
         MVI   8(R4),C'X'         IND EXCL RESERVE
SPXTONE  LA    R3,1(,R3)          INCREMENT ENTRY NUMBER
         LA    R4,9(,R4)          INCREMENT TABLE LOCATION
         CR    R3,R5              TOO MANY ENTRIES IN TABLE ?
         BH    TABLOVFL           YES...IGNORE REMAINDER
         MVI   SWTCH+1,X'F0'      FLAG MINORS FOUND
         BR    R14                RETURN FROM SPSTORE
SPSRNAM  DS    0H                 PUT RESOURCE INFO INTO TABLE
         MVI   SWTCHB,1           DON'T MOVE RNAME AGAIN
         SR    R9,R9
         IC    R9,RIBRNMLN        LENGTH OF MINOR NAME
         CH    R9,=H'44'          GTR 44 BYTES ?
         BNH   SPLGTHOK           NO...USE AS IS
         LA    R9,44              YES..RESET TO 44 AND TRUNCATE NAME
SPLGTHOK STC   R9,1(,R4)          PUT NAME LENGTH IN TABLE
         LA    R9,2(,R9)          INCREASE FOR FOLLOWING COMPUTATIONS
         SR    R10,R10
         LR    R11,R9             LENGTH OF MINOR NAME+CONTROL BYTES
         D     R10,=F'9'          MULTIPLE OF 9 ?
         LTR   R10,R10            ANY REMAINDER ?
         BZ    SPL9               NO...
         LA    R11,1(,R11)        YES...ROUND UP
SPL9     STC   R11,0(,R4)         PUT NO. OF TABLE ENTRIES IN TABLE
         CLI   RIBRNAME,C'$'      PRINTABLE NAME           AXC
         BL    SPUNAME            NO, UNKNOWN
         CLI   RIBRNAME,C'9'      PRINTABLE NAME
         BH    SPUNAME            NO, UNKNOWN
         AR    R3,R11             INCREMENT NO. OF ENTRIES
         CR    R3,R5              OVERFLOW TABLE ?
         BH    TABLOFL2           HOPEFULLY NOT.
         BCTR  R9,0               REDUCE LENGTH
         BCTR  R9,0               TO ORIGINAL AND THEN
         BCTR  R9,0               SET FOR EXECUTE INST
         EX    R9,SPRNAM          MOVE MINOR NAME
*                                 NO. OF TABLE SLOTS TAKEN BY NAME
SPKBACK  SR    R10,R10            MULTIPLIED BY 9 BYTES/SLOT
         M     R10,=F'9'          EQUALS TOTAL LENGTH TAKEN
         AR    R4,R11             ADDED TO SLOT POINTER
         B     SPSJOB             GO PUT JOB INFO INTO TABLE
         SPACE 3
SPUNAME  MVC   2(7,R4),=CL7'UNKNOWN'
         MVI   1(R4),X'07'        SET MINOR NAME LENGTH
         MVI   0(R4),X'09'        SET FOR TABLE ENTRIES
         LA    R11,9              LOAD ADJUSTED LENGTH
         AR    R3,R11             INCR NO. OF ENTRIES
         CR    R3,R5              OVERFLOW TABLE
         BH    TABLOFL2           HOPEFULLY NOT
         SH    R9,=H'3'           ADJUST LENGTH
         B     SPKBACK
         SPACE 3
SPRNAM   MVC   2(0,R4),RIBRNAME   EX TO MOVE RNAME INTO TABLE
SPCLC    CLC   MINNAME(0),RIBRNAME EX TO DO RNAME SELECTION
         USING XSA,R2
***********************************************************************
*
*        TABLE COMPLETE, READY FOR EXIT
*
***********************************************************************
EXITOK   DS    0H
         TM    SWTCH+1,X'F0'      MINOR NAMES FOUND ?
         BZ    NOOUTPUT           NO...
EXITOK1  LA    R1,0               MESSAGE CODE=0, ALL SUCCESSFUL
SETSIZE  STH   R3,TBLSIZE         SET TABLE SIZE FOR I/O MODULE
         MVC   0(4,R4),=F'-1'     SET END OF TABLE
         SPACE 5
***********************************************************************
*
*        XCTL TO SECOND LOAD OF MODULE FOR ALL I/O
*
***********************************************************************
XCTL     EQU   *
         ESTAE 0
         STH   R1,MSGCODE         SET CODE FOR IGCSB03D
         MVC   XCTLNAME(8),=CL8'IGCSB03D' NAME OF ENTRY POINT
         L     R15,=V(IEESB03D)     SECOND LOAD
         BR    R15
         SPACE 3
UNKNOWN  MVC   2(7,R4),=CL7'UNKNOWN'
         MVI   1(R4),X'07'        SET MINOR NAME LENGTH
         MVI   0(R4),X'09'        SET FOR TABLE ENTRIES
         LA    R11,9              LOAD ADJUSTED LENGTH
         AR    R3,R11             INCR NO. OF ENTRIES
         CR    R3,R5              OVERFLOW TABLE
         BH    TABLOFL2           HOPEFULLY NOT
         SH    R9,=H'3'           ADJUST LENGTH FOR EXECUTE
         B     UNKBACK
***********************************************************************
*
*        ERROR MESSAGE CODES SET HERE
*
***********************************************************************
NOMAJNAM LA    R1,4               MAJOR NAME QCB NOT FOUND
         B     XCTL
         SPACE 2
QCBERR   LA    R1,8               MINOR QCB CHAIN ERROR
         B     XCTL
         SPACE 2
QELERR   LA    R1,12              QEL CHAIN ERROR
         B     XCTL
         SPACE 2
GETERR   LA    R1,16              NO FREE CORE AVAILABLE FROM GETMAIN
         B     XCTL
         SPACE 2
BADERR   LA    R1,20              INVALID MAJOR/MINOR NAME
         B     XCTL
         SPACE 2
PARMERR  LA    R1,24              NO MINOR NAME SPECIFIED
         B     XCTL
         SPACE 2
NOOUTPUT LA    R1,28              MINOR NAME QCB NOT FOUND
         B     XCTL
         SPACE 2
TABLOVFL LA    R1,32              LOST DATA--TABLE SIZE EXCEEDED
         B     SETSIZE
         SPACE 2
TABLOFL2 SR    R3,R11             TABLE OVERFLOW ON MINOR QCB NAME
         B     TABLOVFL           OMIT IT FROM TABLE
         SPACE 2
CMDERR   LA    R1,36              COMMAND ERROR
         B     XCTL
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESA03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     CMDERR
***********************************************************************
*
*        CONSTANTS, DSECTS, ETC HERE
*
***********************************************************************
MVNAM    MVC   0(*-*,R6),0(R8)
COMPMINR CLC   MINNAME(*-*),20(R7)
QCBNAME  MVC   2(*-*,R4),20(R7)
GQSCANP  GQSCAN MF=L
GQSCANE  EQU   *                  TO GET LENGTH OF GQSCAN PARM LIST
         DS    0F
TSMSK    DC    X'00007FFF'
SUB241   DC    X'F1000000'
ENABLE   DC    X'FF'
CORSIZ   DC    F'9120'
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
*
WKDSECT  DSECT
SAVA     DS    18F                SAVE-AREA
SUBPOOL  DS    F                  GETMAIN SUBPOOL
XSASAVE  DS    F                  EXTENDED SAVE-AREA PTR
CORE     DS    F                  POINTER TO FREE CORE TABLE
MAJLGTH  DS    H                  MODIFIED LENGTH OF MAJOR NAME
MINLGTH  DS    H                  MODIFIED LENGTH OF MINOR NAME
SWTCH    DS    H                  PROGRAM SWITCHES
***********************************************************************
*
*              SWTCH -- BIT DEFINITIONS
*
*        OFFSET   VALUE   MEANING
*       -------  ------- ---------
*          +0     X'00'   FULLLY QUALIFIED MINOR NAME GIVEN
*
*          +0     X'F0'   OBTAIN ALL MINOR NAMES
*
*          +0     X'0F'   OBTAIN ALL MINOR NAMES STARTING WITH GIVEN
*
*          +1     X'F0'   FOUND MINOR NAME, OUTPUT EXISTS
*
*          +1     X'0F'   OBTAIN ONLY MAJOR QCB NAMES
*
***********************************************************************
WKSIZE   DS    H                  SIZE OF WORK-AREA
CORESIZE DS    H                  SIZE OF FREE-CORE TABLE
MSGCODE  DS    H                  I/O MESSAGE CODE
TBLSIZE  DS    H                  NUMBER OF TABLE ENTRIES
MAJNAM   DS    CL8                MAJOR NAME
MINNAME  DS    CL255              MINOR NAME
NUMCHK   EQU   MINNAME+200
WTOLIST  DS    F                  WTO CONTROL BYTES
BUFFER   DS    CL65               WTO MESSAGE BUFFER
XCTLLIST DS    0F                 XCTL CONTROL INFO
XCTLEP   DS    F                  ADDRESS OF EP PARAMETER
XCTLDCB  DS    F                  DCB ADDRESS PARAMETER
XCTLNAME DS    CL8                ENTRY POINT NAME
         DS    0F
MINADDR  DS    F
MINENTRY DS    F
SJOB     DS    CL8                SELECTION JOB
ESTAELST DS    0F,(ESTAEOVX)X
TOKEN    DS    F                  GQSCAN TOKEN
SPSTART  DS    A                  START POINT OF QNAMES IN TABLE
GQRET    DS    F                  GQSCAN RETURN CODE
NUMRIBS  DS    F                  NUMBER OF RIB'S IN AREA
NUMRIBES DS    F                  NUMBER OF RIBE'S
RIBELEN  DS    H                  LENGTH OF RIBE
GQSCANL  GQSCAN MF=L
SWTCHA   DS    X                  0 IF MAJOR NAME NOT FOUND
SWTCHB   DS    X                  0 IF RNAME NOT MOVED YET
         DS    0D
AREA     DS    XL1024             GQSCAN RETURN AREA
LWKDSECT EQU   *-WKDSECT
DSXSA    DSECT
XSA      DS    0D
XAP      DS    F                  PTR TO XCTL NAME
XAD      DS    F                  DCB PTR
XAX      DS    D                  XCTL NAME
XAE      DS    0C                 ERROR CODE
XAR      DS    F                  PTR TO PARM LIST (REG1)
XAN      DS    0C                 VERB INDEX
XAL      DS    F                  PTR TO LIST POSITION
XAV      DS    D                  VERB
XAS      DS    D                  TEMP SAVE-AREA
XAU      DS    C                  UCM ENTRY INDICATOR
         DS    C                  RESERVED
XAJ      DS    H                  TJID ENTRY INDICATOR
         DS    F                  RESERVED
         PRINT NOGEN
         IHASDWA
         ISGRIB
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         SPACE 2
         END
./       ADD   NAME=CSCSB03D
         TITLE 'IEESB03D -   #N  DISPLAY ENQUEUE 2ND LOAD'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESB03D -       #N DISPLAY ENQUEUE 2ND LOAD              ***
***                                                                 ***
***       VERSION -        1.2                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***                                                                 ***
***       UPDATED -        07/22/81  AXC-CBT HANDLE ESTAE           ***
***                                                                 ***
***                        04/21/86  GLA-BFG PASS PARM TO ESTAE OK  ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESB03D CSECT
         LR    R12,R15
         USING IEESB03D,R12
         USING WKDSECT,R13
         USING XSA,R2
         SPACE 2
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(13),MF=(E,(1))                            GLA-BFG
         L     R2,XSASAVE         A(EXTENDED SAVE AREA)
         LH    R7,XAJ             TJID, IF IT EXISTS.
         SLL   R7,16              MOVE TO HIGH ORDER BYTES.
         SR    R10,R10            CLEAR REGISTER
         IC    R10,XAU            R10 = CONSOL ID FOR MCS
         MVI   WTOLIST+2,X'01'    MCSFLAG = QREG0
         LH    R3,MSGCODE         GET MESSAGE ERROR CODE, IF ANY
         LTR   R3,R3              ANY ERRORS ?
         BZ    FORMAT             NO...
         CH    R3,=H'36'          CONTROL BLOCK ERROR
         BE    CLEANUP            YES, EXIT
         L     R5,MSGTABLE(R3)    YES...GET DISPLACEMENT OF MESSAGE
         LA    R5,0(R12,R5)       ADD BASE FOR ABSOLUTE ADDRESS
         LH    R4,0(,R5)          LENGTH OF MESSAGE
         BCTR  R4,0               SET FOR EXECUTE
         EX    R4,GETMSG
         LA    R4,5(,R4)          RESET LENGTH+4 FOR CONTROL BYTES
         STH   R4,WTOLIST         PUT LENGTH IN CONTROL FIELD
         BAL   R11,IOCS           OUTPUT MESSAGE
         CH    R3,=H'32'          "LOST DATA" ERROR CODE ?
         BNE   CLEANUP            NO...ALL FINISHED THEN.
***********************************************************************
*
*        FORMAT DATA AND WRITE IT OUT
*
***********************************************************************
FORMAT   EQU   *
         LA    R3,36              SET MESSAGE CODE
         LA    R9,2               LOOP COUNTER
         TM    SWTCH+1,X'0F'      ONLY MAJOR QCB NAMES?
         BZ    LOOP1              NO..OK AS IS.
         LA    R3,44              YES..SET FOR CORRECT HEADER MSG.
LOOP1    L     R5,MSGTABLE(R3)    DISPLACEMENT OF MESSAGE
         LA    R5,0(R12,R5)       ADD BASE FOR ABSOLUTE ADDRESS
         LH    R4,0(,R5)          LENGTH
         BCTR  R4,0               SET FOR EXECUTE
         EX    R4,GETMSG          MOVE MESSAGE TO BUFFER
         LA    R4,5(,R4)          CORRECT LENGTH
         STH   R4,WTOLIST         SET IN MESSAGE
         BAL   R11,IOCS           DO OUTPUT
         LA    R3,4(,R3)          NEXT MESSAGE CODE
         BCT   R9,LOOP1           DO NEXT MESSAGE
*
         LH    R3,TBLSIZE         NO. OF ENTRIES IN TABLE
         L     R5,CORE            START OF TABLE
         LA    R6,BUFFER          START OF OUTPUT BUFFER
*
         TM    SWTCH+1,X'0F'      ONLY MAJOR QCB NAMES ?
         BO    MAJONLY            YES..
*
LOOP2    MVI   BUFFER,C' '
         MVC   BUFFER+1(64),BUFFER  BLANK-OUT BUFFER
         LA    R4,24              SET NORMAL WTO LENGTH
         SR    R9,R9
         IC    R9,0(,R5)          GET FIRST CHAR IN ENTRY
         CH    R9,=H'91'          LESS THAN X'5B'...CHAR '$' ?
         BL    SETNAME            YES..
GETOWNER MVC   2(8,R6),0(R5)      JOBNAME/USERID
         MVC   11(6,R6),=CL6'- SHR '   ASSUME SHR'D ENQ
         CLI   8(R5),C'S'         IS IT SO ?
         BE    PRINT
         MVC   13(4,R6),=CL4'EXCL'  NO...MUST BE EXCLUSIVE
         CLI   8(R5),C'E'         IS IT SO
         BE    PRINT
         MVC   13(4,R6),=CL4'RSVS'  NO, SHR RESERVE
         CLI   8(R5),C'R'         IS IT SO
         BE    PRINT
         MVC   13(4,R6),=CL4'RSVX'  NO, EXCL RESERVE
PRINT    STH   R4,WTOLIST         SET MESSAGE LENGTH
         BAL   R11,IOCS           OUTPUT BUFFER
         LA    R5,9(,R5)          NEXT ENTRY IN TABLE
         CLC   0(4,R5),=F'-1'     END OF TABLE
         BE    CLEANUP            YES
         BCT   R3,LOOP2           DO NEXT ENTRY, IF ANY
         B     CLEANUP            FINISHED...
*
SETNAME  SR    R11,R11            MUST BE A MINOR QCB ENTRY.
         IC    R11,1(,R5)         LENGTH OF MINOR NAME
         LR    R4,R11
         LA    R4,24(,R4)         TOTAL MESSAGE LENGTH
         BCTR  R11,0              SET FOR EXECUTE INST
         EX    R11,GETNAME        MOVE NAME INTO BUFFER
         SR    R3,R9              DELETE NO. OF TABLE ENTRIES
         SR    R8,R8              (NO. OF ENTRIES) X (SIZE OF ENTRY)
         M     R8,=F'9'           PLUS CURRENT POINTER EQUAL
         AR    R5,R9              NEXT TABLE ENTRY
         B     GETOWNER           GET JOBNAME/USERID, ETC.
         SPACE 2
***********************************************************************
*
*        PRINT ONLY MAJOR QCB NAMES HERE
*
***********************************************************************
LOOP3    EQU   *
MAJONLY  LA    R4,17              SIZE OF MESSAGE
         STH   R4,WTOLIST         PLACE IN CONTROL FIELD
         MVI   BUFFER,C' '
         MVC   BUFFER+1(64),BUFFER BLANK-OUT BUFFER
         MVC   5(8,R6),0(R5)      GET MAJOR NAME FROM TABLE
         BAL   R11,IOCS           WRITE IT OUT
         LA    R5,8(,R5)          NEXT ENTRY IN TABLE,IF ANY
         CLC   0(4,R5),=F'-1'     END OF TABLE
         BE    CLEANUP            YES
         BCT   R3,LOOP3           GET IT, IF IT EXISTS
         B     CLEANUP            FINISHED...
***********************************************************************
*
*        RELEASE ALL CORE AND EXIT
*
***********************************************************************
CLEANUP  EQU   *
         ESTAE 0
         L     R1,CORE            START OF CORE TABLE
         LH    R0,CORESIZE        SIZE OF TABLE
         O     R0,SUBPOOL         RELEASE FROM SAME SUBPOOL
         FREEMAIN R,LV=(0),A=(1)
         SPACE 2
CLEAN2   EQU   *
         LH    R0,WKSIZE          SIZE OF WORK-AREA
         O     R0,SUBPOOL         RELEASE FROM SAME SUBPOOL
         LR    R1,R13             START OF WORK-AREA
         L     R14,SAVA           SET RETURN ADDRESS
         FREEMAIN R,LV=(0),A=(1)
         SPACE 2
         SR    R15,R15
         BR    R14                RETURN
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESB03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     CLEANUP
***********************************************************************
*
*        IOCS -- I/O CONTROL SECTION
*
*        ON ENTRY:
*                 R4  = MESSAGE LENGTH+4 (INCLUDES WTO CONTROL BYTES)
*                 R10 = CONSOL ID FOR MCS
*                 R11 = RETURN ADDRESS
*
*        NOTE: OUTPUT BUFFER IS SETUP PRIOR TO ENTRY
*
***********************************************************************
IOCS     DS    0H
         SPACE 2
OPER     LA    R1,WTOLIST         WRITE MESSAGE TO OPERATOR
         SR    R0,R0
         IC    R0,XAU             R0 = CONSOL ID FOR MCS
         SVC   35
         BR    R11                RETURN
***********************************************************************
*
*        CONSTANTS, TABLES, ETC.
*
***********************************************************************
MSGTABLE DS    0F                 MSGCODE
         DC    A(*)                 0 - NOT USED
         DC    A(MSG1-IEESB03D)     4
         DC    A(MSG2-IEESB03D)     8
         DC    A(MSG3-IEESB03D)     12
         DC    A(MSG4-IEESB03D)     16
         DC    A(MSG5-IEESB03D)     20
         DC    A(MSG6-IEESB03D)     24
         DC    A(MSG7-IEESB03D)     28
         DC    A(MSG8-IEESB03D)     32
         DC    A(MSG9-IEESB03D)     36
         DC    A(MSG10-IEESB03D)    40
         DC    A(MSG11-IEESB03D)    44
         DC    A(MSG12-IEESB03D)    48
*
MSG1     DC    H'32',C'*** MAJOR NAME QCB NOT FOUND ***'
MSG2     DC    H'37',C'*** ERROR IN MINOR QCB CHAIN ***'
MSG3     DC    H'27',C'*** QEL CHAIN ERROR ***'
MSG4     DC    H'46',C'*** NO FREE SQA CORE AVAILABLE...TRY AGAIN ***'
MSG5     DC    H'42',C'*** INVALID MAJOR/MINOR NAME SPECIFIED ***'
MSG6     DC    H'31',C'*** NO MINOR NAME SPECIFIED ***'
MSG7     DC    H'32',C'*** MINOR NAME QCB NOT FOUND ***'
MSG8     DC    H'54',C'*** LOST DATA...MAXIMUM NUMBER OF ENTRIES EXCEEDX
               ED ***'
MSG9     DC    H'30',C'  JOB/USER   MODE   MINOR NAME'
MSG10    DC    H'31',C' ------------------------------'
MSG11    DC    H'16',C'  MAJOR QCB NAME'
MSG12    DC    H'17',C' ----------------'
         SPACE 2
         DS    0F
SUB255   DC    X'FF000000'
GETMSG   MVC   BUFFER(*-*),2(R5)
GETNAME  MVC   BUFFER+20(*-*),2(R5)
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 2
WKDSECT  DSECT
SAVA     DS    18F                SAVE-AREA
SUBPOOL  DS    F                  SUBPOOL MASK
XSASAVE  DS    F                  EXTENDED SAVE-AREA PTR
CORE     DS    F                  POINTER TO FREE CORE
MAJLGTH  DS    H                  MODIFIED LENGTH OF MAJOR NAME
MINLGTH  DS    H                  MODFIED LENGTH OF MINOR NAME
SWTCH    DS    H                  PROGRAM SWITCHES
WKSIZE   DS    H                  SIZE OF WORK-AREA
CORESIZE DS    H                  SIZE OF FREE CORE
MSGCODE  DS    H                  I/O MESSAGE CODE
TBLSIZE  DS    H                  NUMBER OF TABLE ENTRIES
MAJNAM   DS    CL8                MAJOR NAME
MINNAME  DS    CL255              MINOR NAME
WTOLIST  DS    F                  WTO CONTROL BYTES
BUFFER   DS    CL65               WTO MESSAGE BUFFER
XCTLLIST DS    0F                 XCTL CONTROL INFO
XCTLEP   DS    F                  ADDRESS OF EP PARAMETER
XCTLDCB  DS    F                  DCB ADDRESS PARAMETER
XCTLNAME DS    CL8                ENTRY POINT NAME
         DS    0F
MINADDR  DS    F
MINENTRY DS    F
SJOB     DS    CL8
ESTAELST DS    0F,(ESTAEOVX)X
LWKDSECT EQU   *-WKDSECT
         SPACE 2
DSXSA    DSECT
XSA      DS    0D
XAP      DS    F                  PTR TO XCTL NAME
XAD      DS    F                  DCB PTR
XAX      DS    D                  XCTL NAME
XAE      DS    0C                 ERROR CODE
XAR      DS    F                  PTR TO PARM LIST (REG1)
XAN      DS    0C                 VERB INDEX
XAL      DS    F                  PTR TO LIST POSITION
XAV      DS    D                  VERB
XAS      DS    D                  TEMP SAVE-AREA
XAU      DS    C                  UCM ENTRY INDICATOR
         DS    C                  RESERVED
XAJ      DS    H                  TJID ENTRY INDICATOR
         DS    F                  RESERVED
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         SPACE 2
         END
./       ADD   NAME=CSCSC03D
         TITLE 'IEESC03D -   #L  DISPLAY TSO LINES'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESC03D -       #L DISPLAY TSO LINES                     ***
***                                                                 ***
***       VERSION -        1.4                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***                                                                 ***
***       UPDATED -        07/19/81  AXC-CBT HANDLE ESTAE           ***
***                        08/10/81  JCC-BCB TEST FOR END OF ASCBS  ***
***                                          ADD VTAM LOGIC         ***
***                        08/10/81  JGS - TEST IF UNDER TSO      NERDC
***                        01/11/82  RLL - CHANGE ESTAE PARM LENGTH ***
***                        01/19/82  AXC-CBT CHANGE TSO CHECK       ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESC03D CSECT
         LR    R12,R15            SET ADDRESSABILITY
         USING IEESC03D,R12
         LA    R0,LWKDSECT        SIZE OF SAVE-AREA AND WORK-AREA
         O     R0,SUB241          GET FROM SUB-POOL 241
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WKDSECT,R13        FIRST 18 WRDS ARE SAVE-AREA
         USING XSA,R2
         XC    0(LWKDSECT,R13),0(R13)  ZERO-OUT WORK AREA
         ST    R14,SAVA           PUT RETURN ADDRESS IN UNUSED SLOT
         ST    R2,XSASAVE         SAVE XSA POINTER
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         SR    R3,R3              CLEAR REGISTER
         IC    R3,XAU             R3 = CONSOL ID FOR MCS
         MVI   WTOLIST+2,X'01'    MCSFLAGS = QREG0
         XC    SWTCH,SWTCH        ZERO-OUT SWTCH
         LA    R6,BUFFER          START OF BUFFER
         MVI   BUFFER,C' '        BLANK-OUT BUFFER
         MVC   BUFFER+1(59),BUFFER                                JCC
         LA    R7,2               ENTRIES PER LINE
         L     R11,16             CVT ADDR
         L     R9,556(0,R11)      LOAD ASVT ADDR
         L     R5,516(0,R9)       MAX # OF ASIDS                  JCC
         MH    R5,=H'4'           MULTIPLY BY 4                   JCC
         LA    R5,528(R5,R9)      ADD TO ADDR OF FIRST ASCB       JCC
         ST    R5,ASCBEND         STORE ADDR OF LAST ASCB         JCC
         ZAP   TOTUSER,=P'0'      CLEAR TOTAL FIELD               JCC
         LA    R9,520(0,R9)       ASVT ENTRY ADDR
         B     NEXTONE            GO GET ASCB
***********************************************************************
*
*        LOOP THRU ALL ASCBS
*
***********************************************************************
         USING TSB,R11                                            JCC
LOOP1    LM    R10,R11,56(R8)      LOAD CSCB/TSB ADDR
         LTR   R11,R11             ANY TSB
         BZ    NEXTONE             NO, NOT TP USER
         AP    TOTUSER,=P'1'       ADD 1 TO USER TOTAL            JCC
         MVI   SWTCH,X'F0'         OUTPUT EXISTS
         MVC   1(8,R6),8(R10)      JOBNAME
         MVI   10(R6),C'('         BRACKET ASCB
         UNPK  11(5,R6),36(3,R8)   UNPACK ASID
         NC    11(4,R6),=4X'0F'       AND
         TR    11(4,R6),=C'0123456789ABCDEF' TRANSLATE
         MVI   15(R6),C')'         BRACKET ASID
*        CLC   =C'0A23',TSTSVC35   IF EXECUTING UNDER TSO         NERDC
         CLC   =XL2'0A23',TSTSVC35   IF EXECUTING UNDER TSO     CBT-AX
*        BNE   SKIPLINE             BYPASS ABEND S0C4             NERDC
         BNE   LOOP1C               BYPASS ABEND S0C4           CBT-AXC
         MVI   17(R6),C'-'
         TM    TSBFLG5,TSBVTAM     IF THIS IS VTAM                JCC
         BO    VTAMRTN             THEN GO TO EXTENSION           JCC
         UNPK  18(5,R6),82(3,R11)  UNPACK LINE ADDR
         NC    19(3,R6),=4X'0F'       AND
         TR    19(3,R6),=C'0123456789ABCDEF' TRANSLATE
         MVI   18(R6),C' '
         MVI   22(R6),C' '
LOOP1C   DS    0H                                                 JCC
         LA    R6,ENTRYSIZ(0,R6)   INCR INTO BUFFER
         BCT   R7,NEXTONE          NEXT ASCB
         LA    R4,60               MSG LENGTH                     JCC
         BAL   R11,IOCS            GO WTO
         LA    R7,2                ENTRIES PER LINE
         LA    R6,BUFFER           LOAD BUFFER ADDR
         MVI   0(R6),C' '
         MVC   1(59,R6),0(R6)                                     JCC
         SPACE 3
NEXTONE  LA    R9,4(0,R9)          INCR INTO ASVT
         L     R8,0(0,R9)          LOAD ASCB ADDR
         C     R9,ASCBEND          END OF ASCBS?                  JCC
         BNL   LOOP2               YES, EXIT                      JCC
         TM    0(R9),X'80'         ASID ASSIGNED
         BO    NEXTONE             NO, CHECK NEXT
         B     LOOP1
VTAMRTN  DS    0H                                                 JCC
         L     R5,TSBEXTNT         FETCH TSB EXTENSION ADDRESS    JCC
         USING TSBX,R5             TELL THE ASSEMBLER             JCC
         TM    TSBXFLG1,TSBXWREC   IF NOT WAITING RECONNECT       JCC
         BNO   VTGETSYM            THEN GO GET SYMBOLIC NAME      JCC
         MVC   19(8,R6),=CL8'*DISCON*'   SET DISCONNECT STATUS    JCC
         B     LOOP1C              GO BACK TO LOOP                JCC
VTGETSYM DS    0H                                                 JCC
         MVC   19(8,R6),TSBTRMID   MOVE SYMBOLIC NAME TO LINE     JCC
         B     LOOP1C              GO BACK TO LOOP                JCC
         DROP  R5,R11                                             JCC
         SPACE 3
LOOP2    CH    R7,=H'2'            ANY TO WRITE
         BE    CLEANUP             NO, EXIT
         LA    R4,60               MSG LENGTH                     JCC
         BAL   R11,IOCS            WRITE LAST
***********************************************************************
*
*        RELEASE ALL CORE AND RETURN
*
***********************************************************************
CLEANUP  TM    SWTCH,X'F0'        DID OUTPUT EXIST ?
         BZ    NOOUTPUT           NO...
         MVI   BUFFER,C' '        CLEAR THE                       JCC
         MVC   BUFFER+1(59),BUFFER          BUFFER AREA           JCC
         MVC   BUFFER(28),TOTMSG     MOVE THE TOTAL MESSAGE       JCC
         MVC   BUFFER+28(4),=X'40202120'  MOVE EDIT MASK          JCC
         ED    BUFFER+28(4),TOTUSER  EDIT THE TOTAL               JCC
         LA    R4,60              MESSAGE LENGTH                  JCC
         BAL   R11,IOCS           WRITE TOTALS                    JCC
         SPACE 2
CLNUPX   EQU   *
         ESTAE 0
         LA    R0,LWKDSECT        SIZE OF CORE
         O     R0,SUB241          RETURN TO SUB-POOL 241
         LR    R1,R13             START OF CORE
         L     R4,SAVA
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         LR    R14,R4
         BR    R14                RETURN
***********************************************************************
*
*        I/O CONTROL SECTION
*
*        ON ENTRY :
*                  R3  = CONSOL ID FOR MCS
*                  R4  = LENGTH OF MESSAGE
*                  R11 = RETURN ADDRESS
*
***********************************************************************
IOCS     DS    0H
OPER     LA    R4,4(,R4)          ADD CONTROL BYTES TO LENGTH
         STH   R4,WTOLIST         SET LENGTH IN CONTROL FIELD
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU             R0 = CONSOL ID FOR MCS
TSTSVC35 SVC   35                 LABEL FOR TEST IF UNDER TSO     NERDC
         BR    R11                RETURN
***********************************************************************
*
*        ISSUE ERROR MESSAGES HERE
*
***********************************************************************
NOOUTPUT MVC   BUFFER(LMSG),MSG   SET ERROR MESSAGE
         LA    R4,LMSG
         SPACE 2
         BAL   R11,IOCS
         B     CLNUPX
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESC03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     CLNUPX
***********************************************************************
*
*        DSECTS, EQUATES, TABLES, ETC.
*
***********************************************************************
         SPACE 2
         DS    0F                 ALIGN ON FULL WORD BOUNDARY
SUB241   DC    X'F1000000'        MASK FOR SUB-POOL 241
ENTRYSIZ EQU   28                 SIZE OF EACH ENTRY IN BUFFER    JCC
MSG      DC    C'   ***    NO ACTIVE TP USERS    ***'
LMSG     EQU   *-MSG
TOTMSG   DC    CL28'TOTAL NUMBER OF TSO USERS IS'                 JCC
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 2
WKDSECT  DSECT
SAVA     DS    18F                SAVE-AREA
XSASAVE  DS    F                  EXTENDED SAVE-AREA ADDRESS
WTOLIST  DS    F                  WTO CONTROL WORD
BUFFER   DS    CL60               WTO BUFFER                      JCC
SWTCH    DS    CL1
ESTAELST DS    0F,(ESTAEOVX)X                         ****(RLL)****
ASCBEND  DS    F                                                  JCC
TOTUSER  DS    PL2                                                JCC
LWKDSECT EQU   *-WKDSECT
         SPACE 2
DSXSA    DSECT
XSA      DS    0D
XAP      DS    F                  PTR TO XCTL NAME
XAD      DS    F                  DCB PTR
XAX      DS    D                  XCTL NAME
XAE      DS    0C                 ERROR CODE
XAR      DS    F                  PTR TO PARM LIST (REG1)
XAN      DS    0C                 VERB INDEX
XAL      DS    F                  PTR TO LIST POSITION
XAV      DS    D                  VERB
XAS      DS    D                  TEMP SAVE-AREA
XAU      DS    C                  UCM ENTRY INDICATOR
         DS    C                  RESERVED
XAJ      DS    H                  TJID ENTRY INDICATOR
         DS    F                  RESERVED
         IKJTSB LIST=YES,EXT=YES                                  JCC
         PRINT NOGEN
         IHASDWA ,                RESERVED
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSD03D
         PRINT NOGEN
         TITLE 'XA1SD03D -   #D  DISPLAY/ZAP CORE'  BFG
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SE2SD03D -       #D DISPLAY/ZAP CORE                      ***
***                                                                 ***
***       VERSION -        4.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/XA 2.1.1 TO MVS/XA 2.1.3             ***
***                                                                 ***
***       WARNING   -      BE SURE TO CHANGE THE CONSTANT AT THE    ***
***                        LABEL CALLED SWAPPG TO YOUR OWN          ***
***                        PERFORMANCE SWAP OUT NUMBER (MAX AND     ***
***                        MIN OF 0 ON A DOMAIN)                    ***
***                                                                 ***
***       UPDATED -                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESD03D CSECT
***********************************************************************
*
*        THIS MODULE ATTEMPTS TO PERFORM THE BASIC FUNCTION OF
*        DISPLAYING AND MODIFYING CORE IN ANY ADDRESS SPACE EXCEPT FOR
*        LPA MODULES.
*        THE SYNTAX ACCEPTED IS AS FOLLOWS.
*
*
*              #DEXIT,AAAA        TERMINATE MEMORY FOR ASID AAAA
*
*              #DCHAP,AAAA,DDD    SET ASID AAAA TO DPRTY=DDD
*
*              #DNOCANC,AAAA      SET ASID AAAA NON-CANCELLABLE
*
*              #DOKCANC,AAAA      SET ASID AAAA CANCELABLE
*
*              #DNOSWAP,AAAA      SET ASID AAAA NON-SWAPABLE
*
*              #DOKSWAP,AAAA      SET ASID AAAA SWAPABLE
*
*              #DDOSWAP,AAAA      SWAP ASID AAAA IN/OUT
*
*              #DUNNN
*
*              #DSSSSSS,LL
*
*              #DSSSSSS/VVVVVVVV/RRRRRRRR
*
*              #D>AAAA,SSSSSS,LL
*
*              #D>AAAA,SSSSSS/VVVVVVVV/RRRRRRRR
*
*        WHERE THE FOLLOWING MEANINGS HOLD
*              NNN      THE CUU OF THE DESIRED DEVICE. 64 BYTES ARE
*                       DUMPPED.
*              LL       NUMBER OF LINES OF 16 BYTES TO DUMP.
*                       LIMIT IS 16.
*              SSSSSS   THE ADDRESS OF THE AFFECTED AREA
*              VVVVVVVV THE VALUE EXPECTED TO BE FOUND AT XXXXXX
*              RRRRRRRR THE VALUE TO PLACE AT XXXXXX
*              AAAA     THE ASID OF THE ADDRESS SPACE TO WORK IN
*
*  THE DEFAULTS ARE:
*      - IF >AAAA IS NOT SPECIFIED THEN THE MASTER SCHEDULAR
*        ADDRESS SPACE IS USED.
*      - IF LL IS NOT SPECIFIED THEN 64 BYTES ARE DUMPPED.
*
*  NOTE:
*      - VVVVVVVV AND RRRRRRRR MUST BE 8 CHARACTERS LONG.  ALL
*        OTHER VARIABLES CAN BE SHORTER THAN SHOWN.
*
*
*
***********************************************************************
         LR    R12,R15
         USING IEESD03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         STM   R14,R12,SAVRET      SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         LA    R0,WTOLIST          POINT TO START OF CLEAR
         LA    R1,WORKEND-WTOLIST  AND SET THE LENGTH
         SR    R15,R15             CLEAR LENGTH 2
         MVCL  R0,R14              CLEAR THE AREA
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L     * ESTAE PARM FIX        *
ESTAEOVX EQU   *-ESTAEOVL          * ESTAE PARM FIX        *
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL  * ESTAE PARM FIX        *
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         MVC   PLINES(4),=F'4'     DEFAULT PRINT LINES
         L     R3,XAL              LOAD LIST POINTER
         LA    R3,0(0,R3)          CLEAR HIGH ORDER
         LTR   R3,R3               PARM EXIST
         BZ    NOPARM              NO, MVS MSG
         LR    R7,R3               SAVE PARM START
         CLI   0(R3),C'U'          IS THIS A UCB REQUEST
         BE    UCBLOOP             YES SO PROCESS
         CLI   0(R3),C'S'          IS THIS A SPECIAL REQUEST
         BE    SVCLOOP             YES SO PROCESS
         CLC   0(5,R3),=CL5'EXIT,'  EXIT REQUEST
         BE    MEMTERM             YES SO PROCESS
         CLC   0(5,R3),=CL5'CHAP,'  CHAP REQUEST
         BE    CHAP                YES SO PROCESS
         CLC   0(6,R3),=CL6'OKSWAP'  SET SWAPABLE
         BE    SETSWAP             YES SO PROCESS
         CLC   0(6,R3),=CL6'NOSWAP'  SET NON-SWAPABLE
         BE    SETSWAP1            YES SO PROCESS
         CLC   0(6,R3),=CL6'DOSWAP'  SWAP IN/OUT
         BE    SETSWAP6            YES SO PROCESS
         CLC   0(6,R3),=CL6'OKCANC'  SET CANCELABLE
         BE    SETCANC             YES SO PROCESS
         CLC   0(6,R3),=CL6'NOCANC'  SET NON-CANCELABLE
         BE    SETCANC1            YES SO PROCESS
         CLI   0(R3),C'>'          IS IT AN ASID
         BNE   NOTASID             NOPE SO USE THIS ASID
         LA    R3,1(R3)            POINT AT ASID NUMBER
         LA    R4,4                SET MAX LENGTH
         BAL   R11,PARMCVT         CONVERT HEX NUMBER
         STH   R1,ASID             SAVE THE TARGET ASID
         CLI   0(R3),C','          IS SYNTAX CORRECT
         BNE   ERROR               GIVE ERROR IF NOT
         LA    R3,1(R3)            SKIP OVER THE COMMA
NOTASID  LA    R4,8                SET MAXLEN FOR ADDRESS
         BAL   R11,PARMCVT         CONVERT THE ADDRESS
         ST    R1,ADDR             SAVE ADDRESS TO DUMP OF REP AT
         CLI   0(R3),C','          IS IT DUMP FORMAT
         MVI   FLAG1,FG1DUMP       SET DUMP FLAG
         BE    DUMPPREP            GO SETUP DUMP PARMS
         CLI   0(R3),C' '          IF NEXT IS BLANK USE DEFAULT TO DUMP
         BE    DOFUNC
         MVI   FLAG1,FG1REP        SET REP FLAG
         CLI   0(R3),C'/'          IS THE SYNTAX CORRECT
         BNE   ERROR               BAD SYNTAX
         TITLE 'XA1SD03D  D COMMAND  --  PREPARE FOR THE REP FUNCTION'
         CLI   9(R3),C'/'          CHECK REST OF SYNTAX
         BNE   ERROR
         LA    R3,1(R3)            SKIP OVER THE '/'
         LA    R4,0                SET MAX LENGTH TO 0 TO FORCE
*                             A FULL WORD ONLY
         BAL   R11,PARMCVT         CONVERT THE VER VALUE
         ST    R1,ALTVER           SAVE EXPECTED VALUE
         LA    R3,1(R3)            SKIP OVER '/'
         LA    R4,0                SET MAX LENGTH TO 0 TO FORCE
*                             A FULL WORD ONLY
         BAL   R11,PARMCVT         CONVERT THE REP VALUE
         ST    R1,ALTREP           AND SAVE IT
         B     DOFUNC              GO SETUP TO DO FUNCTION
         TITLE 'XA1SD03D  D COMMAND  --  SETUP FOR THE DUMP FUNCTION'
DUMPPREP DS    0H
         TM    1(R3),X'F0'         NUMERIC
         BNO   ERROR               NO
         TM    2(R3),X'F0'         NUMERIC
         BNO   ERROR               NO
         CLC   1(2,R3),=CL2'00'    AXC-CBT POSSIBLE LOOP
         BE    MAX                 AXC-CBT YES
         PACK  DOUBLE(8),1(2,R3)
         CVB   R1,DOUBLE
         CH    R1,=H'16'           MAX IS 256 BYTES
         BNH   *+8
MAX      LA    R1,16               SET MAX
         ST    R1,PLINES           SAVE NUMBER OF LINES
         TITLE 'XA1SD03D  D COMMAND  --  PERFORM THE DESIRED FUNCTION'
*-------------------------------------------------------------*    @TEC
*   CHECK FOR CROSS MEMORY FUNCTION  AND IF SO VALIDATE ASCB. *    @TEC
*-------------------------------------------------------------*    @TEC
DOFUNC   L     R1,PLINES           COMPUTE LENGTH OF INFO TO DISPLAY
         SLL   R1,4                AS LINES*16
         ST    R1,LENGTH
         LH    R1,ASID             GET THE ASID
         LTR   R1,R1               IS IT ZERO
         BZ    DOSUBR              IF SO USE THIS ADDR SPACE  MS
         L     R3,CVTPTR           POINT TO CVT
         USING CVTMAP,R3
         L     R2,CVTTCBP          GO GET MY ASCB ADDR
         MVC   MYASCB,12(R2)       SAVE ADDR OF ASCB FOR POST
         MVC   MYTCB,4(R2)         SAVE THE TCB ADDRESS FOR STIMER
         L     R2,CVTASVT          POINT AT ASVT
         USING ASVT,R2
         C     R1,ASVTMAXU         IS ASID TOO BIG
         BH    ERROR               YES
         SLL   R1,2                ASID*4
         LA    R1,ASVTENTY-4(R1)   POINT AT DESIRED ENTRY
         MVC   TOASCB,0(R1)        MOVE THE ASCB ADDR IF ANY
         TM    TOASCB,ASVTAVAL     IS THIS ASCB ADDR OR AVAILABLE
         BO    ERROR               ASID DOES NOT EXIST
         DROP  R2,R3
         L     R2,TOASCB           POINT AT ASCB
         USING ASCB,R2
         TM    ASCBRCTF,ASCBOUT    IS ASCB SWAPPED OUT
         BO    SWAPOUT
         CLC   MYASCB,TOASCB       IS THE ASCB THE MS
         BE    DOSUBR              IF SO THEN USE SUBROUTINE
*-------------------------------------------------------------*    @TEC
*   NOW INITIALIZE THE SRB                                    *    @TEC
*-------------------------------------------------------------*    @TEC
         LA    R3,SRBAREA          POINT AT THE SRB
         USING SRBSECT,R3
         XC    SRBAREA,SRBAREA     CLEAR THE SRB
         MVC   SRBID,=C'SRB '      SET EBCDIC ID
         MVC   SRBASCB,TOASCB      SET ASCB ADDR TO RUN IN
         LA    R1,D#SRBCD          POINT AT SRB CODE
         ST    R1,SRBEP            SAVE ENTRY POINT
         ST    R13,SRBPARM         SAVE PARM ADDR AS WORK AREA
         LA    R1,D#RMTR           SET ADDR OF RESOURCE MGR TERMINATION
         ST    R1,SRBRMTR          AND SAVE IT
         MVC   SRBPASID,ASID       SET ASID OF DESIRED ASCB
         DROP  R3
*-------------------------------------------------------------*    @TEC
*   SCHEDULE SRB AND AWAIT COMPLETION                         *    @TEC
*-------------------------------------------------------------*    @TEC
         XC    ECB,ECB             CLEAR DONE ECB
         XC    ECB2,ECB2           CLEAR STIMER ECB
         LA    R1,ECB              NOW SETUP THE ECBLIST
         ST    R1,ECBLIST
         LA    R1,ECB2
         ST    R1,ECBLIST+4
         MVI   ECBLIST+4,X'80'     AXC
         L     R2,MYTCB            POINT AT TCB
         L     R2,0(0,R2)          POINT AT RB
         USING RBBASIC,R2
         ST    R1,RBEXSAVE+16      SAVE ECB2 ADDR IN RBXSA
         DROP  R2
         STIMER  REAL,D#STX,BINTVL==A(60*100)  WAIT 1 MINUTE
         SCHEDULE  SRB=(R3),SCOPE=GLOBAL
         WAIT  ECBLIST=ECBLIST
         TTIMER  CANCEL            CANCEL THE TIMER IF STILL EXISTS
         B     GOTBACK             GO AND CHECK COMPLETION
*-------------------------------------------------------------*    @TEC
*   USE THE SRB CODE AS A SUBROUTINE                          *    @TEC
*-------------------------------------------------------------*    @TEC
DOSUBR   OI    FLAG1,FG1SUBR       SET FLAG FOR SUBROUTINE
         LA    R1,DMYPRMS          SETUP DUMMY FRR PARMS
         ST    R1,FRRPRMS
         XC    DMYPRMS,DMYPRMS
         LR    R1,R13              SET UP PARM REGISTER
         LA    R15,D#SRBCD         SET ENTRY POINT ADDR
         LA    R14,GOTBACK         SET RETURN ADDRESS
         BR    R15                 GO DO IT
*-------------------------------------------------------------*    @TEC
*   THIS IS THE STIMER EXIT.  ITS  PURPOSE IS TO POST THE ECB *    @TEC
*   AT ECB2 AND WAKE UP COMM TASK IF THE SRB FAILS TO DO THIS *    @TEC
*   WE MUST FIND THE ADDRESS OF THE ECB WHICH IS SAVED IN THE *    @TEC
*   XSA AREA OF THE SVRB IN COMM TASK                         *    @TEC
*-------------------------------------------------------------*    @TEC
         USING *,R12
D#STX    SAVE  (14,12)
         LR    R12,R15             SET BAE REGISTER
         L     R3,CVTPTR
         L     R3,0(R3)            POINT AT TCB WORDS
         L     R3,0(R3)            POINT AT MY TCB
         L     R3,0(R3)            POINT AT MY RB
         USING RBBASIC-4,R3
D#STX1   SL    R3,=F'4'            POINT BACK TO LOOK AT INTC
         CLI   3(R3),X'01'         LOOK FOR WAIT SVC
         BE    D#STX2              IF FOUND THEN EXIT
         TM    XSTAB2,RBTCBNXT     TEST TCB FLAG
         BO    D#STX3              IF NOT FOUND PROPER RB
         L     R3,RBLINK           POINT AT PREVIOUS RB
         B     D#STX1              TRY AGAIN
D#STX2   L     R2,RBEXSAVE+16      GET ADDR OF ECB
         POST  (R2)                POST THE TIMER ECB
         RETURN  (14,12)
         DROP  R12,R3
*-------------------------------------------------------------*    @TEC
*   IF WE CAN NOT FIND THE RB THEN DUMP                       *    @TEC
*-------------------------------------------------------------*    @TEC
D#STX3   DC    H'0'
         USING IEESD03D,R12
         TITLE 'XA1SD03D  D COMMAND  --  PERFORM THE DUMP FUNCTION'
*-------------------------------------------------------------*    @TEC
*   WE HAVE  RETURNED  FOR  THE  SRB  FUNCTION  NOW CHECK THE *    @TEC
*   RESULTS AND IF GOOD THEN DUMP THE PROPER PART OF MEMORY   *    @TEC
*-------------------------------------------------------------*    @TEC
GOTBACK  TM    FLAG1,FG1SUBR       ARE WE IN SUBROUTINE MOVE
         BO    GOTBK2              IF SO THEN SKIP SOME TESTS
         TM    FLAG1,FG1SRDN       HAS THE SRB COMPLETED
         BZ    SRBFAIL             IF NOT THEN TIMER CAUGHT IT
         TM    FLAG2,FG2PSTR       DID XMPOST HAVE ERROR
         BO    XMPTERR             IF SO THEN MESSGAE
         TM    FLAG2,FG2PURG       WAS SRB PURGED
         BO    SRBPGERR            IF SO THEN TELL ABOUT IT
         TM    FLAG2,FG2ERRR       TEST FOR BAD ERROR
         BO    DISTERR             GIVE MESSAGE
GOTBK2   TM    FLAG2,FG2NVER       DID VER FAIL
         BO    NOTVER              IF SO THEN ISSUE MESSAGE
         TM    FLAG2,FG2IVLD       WAS ADDR INVALID
         BO    STAEMG
*-------------------------------------------------------------*    @TEC
*   NOW DUMP THE CORE SAVED  IN ALTVER FOR 'LENGTH' WHICH WAS *    @TEC
*   FROM 'ADDR'                                               *    @TEC
*-------------------------------------------------------------*    @TEC
FORMAT   L     R4,PLINES           LOAD PRINT LINES
         LA    R5,ALTVER           POINT AT DATA TO DUMP
FORMAT1  LA    R6,PRINT            PRINT AREA ADDR
         UNPK  0(9,R6),ADDR(5)     UNPACK ADDR
         MVC   8(1,R6),=CL4' '     BLANK 1 BYTE
         NC    0(8,R6),=8X'0F'     TRANSLATE TO PRINT
         TR    0(8,R6),=C'0123456789ABCDEF'
         MVI   45(R6),C'*'         START OF EBCDIC DATA
         MVC   46(16,R6),0(R5)     EBCDIC DATA
         TR    46(16,R6),EBCDICTB  TRANSLATE OUT UNPRINTABLES
         MVI   46+16(R6),C'*'      END OF EBCDIC DATA
         LA    R6,9(0,R6)          INCR INTO PRINT AREA
         LA    R7,4                NO. OF FULLWORDS PER LINE
FORMAT2  UNPK  0(9,R6),0(5,R5)     UNPACK DATA
         MVC   8(1,R6),=CL4' '     BLANK 1 BYTE                   NERDC
         NC    0(8,R6),=8X'0F'     TRANSLATE TO PRINT
         TR    0(8,R6),=C'0123456789ABCDEF'
         LA    R6,9(0,R6)          INCR INTO PRINT AREA           NERDC
         LA    R5,4(0,R5)          INCR INTO DATA
         BCT   R7,FORMAT2          GO FORMAT
         L     R2,XSASAVE          POINT AT XSA
         USING XSA,R2
         MVC   WTOLIST(4),=X'00430100'  FILL IN WTO LIST          NERDC
         LA    R1,WTOLIST          LOAD WTOLIST ADDR
         SR    R0,R0
         IC    R0,XAU              MCS ID
TSTSVC35 EQU   *
         SVC   35                  ISSUE WTO
         DROP  R2
         L     R1,ADDR             UPDATE ADDRESS OF DATA
         A     R1,=F'16'
         ST    R1,ADDR
         BCT   R4,FORMAT1          NEXT LINE
         B     RETURN              EXIT
EBCDICTB DC    C'                                '  TRANSLATE     NERDC
         DC    C'                                '  TABLE         NERDC
         DC    C'           .<(+|&&          $*);Â¬'  USED TO
         DC    C'-/         ,%_>?          :#@''="'  TRANSLATE
         DC    C' ABCDEFGHI       JKLMNOPQR      '  ALL           NERDC
         DC    C'  STUVWXYZ      0123456789      '  ILLEGAL       NERDC
         DC    C' ABCDEFGHI       JKLMNOPQR      '  CHARACTERS    NERDC
         DC    C'  STUVWXYZ      0123456789      '  TO BLANKS     NERDC
         TITLE 'XA1SD03D  D COMMAND  --  SVC CHANGE FUNCTION'
SVCLOOP  L     R4,16               CVT ADDR
         L     R4,200(0,R4)        SCVT ADDR
         L     R4,132(0,R4)        SVCTABLE ADDR
         LA    R4,860(0,R4)        SVC 107 FLAGS
         CLI   1(R3),C'A'          SET AUTH
         BNE   SVCLOOP1            NO, SET NOT AUTH
         OI    0(R4),X'08'         SET NOT APF AUTH
         LA    R1,SVCMSG1
         B     MSGRTN
SVCLOOP1 NI    0(R4),X'F7'         SET NOT APF AUTH
         LA    R1,SVCMSG2
         B     MSGRTN
         TITLE 'XA1SD03D  D COMMAND  --  UCB LOCATE FUNCTION'
UCBLOOP  L     R4,CVTPTR           CVT ADDR
         L     R4,CVTUCBSC-CVTMAP(R4)  LOOKUP ROUTINE ADDRESS
         XC    WKAREA(100),WKAREA  CLEAR WORK AREA
         LA    R1,WKAREA           SETUP PARAMETER LIST
         ST    R1,PLIST
         LA    R1,=X'00'           SPECIFY ALL DEVICES
         ST    R1,PLIST+4
         LA    R1,ADDR             WORD TO PUT ADDRESS OF UCB
         ST    R1,PLIST+8
         OI    PLIST+8,X'80'       31 BIT PARM END SET
UCBLOOP1 LA    R1,PLIST            POINT AT PARM LIST
         LR    R15,R4              GET MODULE ADDRESS
         BALR  R14,R15             CALL MVS
         LTR   R15,R15             ANY ERROR
         BNZ   UCBFND              IF ANY THEN USE LAST ADDRESS
         L     R5,ADDR             GET ADDR OF UCB
         CLC   1(3,R3),13(R5)      UNIT MATCH
         BNE   UCBLOOP1            YES, UCB FOUND
UCBFND   ST    R5,ADDR             SAVE ADDR TO DUMP AT
         OI    FLAG1,FG1DUMP       SET TO DUMP CORE
         B     DOFUNC              DUMP CORE USING SUBROUTINE
*                             BECAUSE ASID IS ZERO
         TITLE 'XA1SD03D  D COMMAND  --  CHARACTER TO HEX CONVERTOR'
*-------------------------------------------------------------*    @TEC
*        INPUT                                                *    @TEC
*              R4 = MAX NUM OF CHARS TO CONVERT               *    @TEC
*                   IF =0 THEN MUST BE 8 CHARACTERS           *    @TEC
*-------------------------------------------------------------*    @TEC
PARMCVT  XR    R0,R0
         LR    R1,R0               CLEAR SOME REGISTERS
         LR    R5,R4               SAVE DESIRED LENGTH IN R5
         LTR   R4,R4               IS IT ZERO (FLAG TO FORCE TO 8 ONLY)
         BNZ   PARMCVT0            NOPE. SO SKIP
         LA    R4,8                SET TO PROPER DATA
PARMCVT0 CLI   0(R3),C','          CHECK FOR DELIMITERS
         BE    PARMCVTD            IF ANY DELIMITER IS FOUND
         CLI   0(R3),C' '          THEN WE AREA DONE
         BE    PARMCVTD
         CLI   0(R3),C'/'
         BE    PARMCVTD
         CLI   0(R3),C'A'          NOW CHECK FOR HEX CHARACTERS
         BL    ERROR               AND IF INVALID THEN FLAG AS ERROR
         CLI   0(R3),C'F'
         BH    PARMCVT1            NOW TRY NUMBERICS
         NI    0(R3),X'0F'         TURN OFF ZONE
         IC    R0,0(R3)            GET THE CHARACTER
         AH    R0,=H'9'            AND ADJUST TO PROPER VALUE
         B     PARMCVT2
PARMCVT1 CLI   0(R3),C'0'          NOW SEE IF NUMERIC
         BL    ERROR               IF NOT THEN ERROR
         CLI   0(R3),C'9'          AND TRY HIGH VALUE
         BH    ERROR
         NI    0(R3),X'0F'         TURN OFF ZONE
         IC    R0,0(R3)            GET DIGIT
PARMCVT2 SLL   R1,4                CLEAR AREA
         OR    R1,R0               PUT IN NEW DIGIT
         LA    R3,1(R3)            POINT PAST
         BCT   R4,PARMCVT0         TRY AGAIN TILL EMPTY
         BR    R11                 ALL DONE. EXPECTED NUMBER OF CHARS
PARMCVTD DS    0H                  HEX NUMBER TERMINATED BEFORE FULL
         LTR   R5,R5               WAS A FULL WORD DESIRED
         BNZR  R11                 OUT IF NOT
         B     ERROR               FORCE FULLWORD TO BE PRESENT
         TITLE 'XA1SD03D  D COMMAND  --  SET SWAP ROUTINE'
SETSWAP  SR    R9,R9               SET UP FOR EXECUTE
         MVC   WTOLIST+4(44),SWAPRMSG
         MVC   WTOLIST+32(13),=CL13'SWAPPABLE'
         B     SETSWAP2
SETSWAP1 LA    R9,128              SET UP FOR EXECUTE
         MVC   WTOLIST+4(44),SWAPRMSG
         MVC   WTOLIST+32(13),=CL13'NON-SWAPPABLE'
SETSWAP2 CLI   6(R3),C','          IS SYNTAX CORRECT
         BNE   ERROR               GIVE ERROR IF NOT
         LA    R3,7(0,R3)          POINT TO ASID
         LA    R4,4                SET MAX LENGTH
         BAL   R11,PARMCVT         CONVERT HEX NUMBER
         STH   R1,ASID             SAVE THE TARGET ASID
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BNZ   *+14                NO
         L     R4,176(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BZ    *+10                YES
         MVC   WTOLIST+9(8),0(R4)  JOBNAME
         L     R5,144(0,R5)        LOAD OUCB ADDR
         C     R9,=F'256'          IS SWAP SWITCH ON?
         BE    SETSWAP7            YES, GO SWAP IT
         NI    17(R5),X'7F'        SET SWAPPABLE
         EX    R9,SETSWAPX         SET NON-SWAPPABLE OR LEAVE SWAPPABLE
SETSWAP4 DS    0H
         LA    R1,WTOLIST
         MVC   WTOLIST(4),=X'00300100'
         B     MSGRTN
SETSWAP6 DS    0H
         LA    R9,256              SET SWAP IN/OUT SWITCH ON
         MVC   WTOLIST+4(44),SWAPRMSG
         B     SETSWAP2            GO BACK TO COMMON RTN
SETSWAP7 DS    0H
*        MODESET KEY=ZERO              PREPARE FOR SYSEVENT
         USING OUCB,R5
         TM    OUCBSFL,OUCBNSW     IS THIS GUY SWAPPABLE?
         BNO   SETSWAP8            YES,CONTINUE
         MVC   WTOLIST+19(29),DOSWAP1  NO, SAY SO
         B     SETSWAPA            GET OUT AFTER RESET
SETSWAP8 DS    0H
         CLC   OUCBNPG,SWAPPG      IS THIS GUY ALREADY OUT?
         BE    SETSWAP9            YES, BRING HIM IN
         SLR   R1,R1               NO, CLEAR REG 1
         ICM   R1,B'0011',SWAPPG   SET PG TO PERM SWAP OUT
         SYSEVENT  RESETPG,ASIDL=ASID
         N     R1,=X'0000FF00'     IF THE SYSEVENT FAILED
         BNZ   SETSWAPE            TELL THE OPERATOR
         MVC   WTOLIST+19(29),DOSWAP2  OTHERWISE TELL HIM WHAT
         B     SETSWAPA            YOU DID AND GET OUT
SETSWAP9 DS    0H
         SLR   R1,R1               NO, CLEAR REG 1
         ICM   R1,B'0011',OUCBSPG  SET PG TO PERM SWAP OUT
         SYSEVENT  RESETPG,ASIDL=ASID
         N     R1,=X'0000FF00'     IF THE SYSEVENT FAILED
         BNZ   SETSWAPE            TELL THE OPERATOR
         MVC   WTOLIST+19(29),DOSWAP3  OTHERWISE TELL HIM WHAT
SETSWAPA DS    0H
*        MODESET KEY=NZERO             RESET TO OLD KEY
         B     SETSWAP4            YOU DID AND GET OUT
SETSWAPE DS    0H
         MVC   WTOLIST+19(29),DOSWAP4  TELL THE OPERATOR THE SWAP
         B     SETSWAPA            FAILED, AND GET OUT
         DROP  R5
SETSWAPX OI    17(R5),X'00'        EXECUTED OI FOR SWAP/NOSWAP
         TITLE 'XA1SD03D  D COMMAND  --  SET CANC ROUTINE'
SETCANC  LA    R9,8                SET UP FOR EXECUTE
         MVC   WTOLIST+4(44),SWAPRMSG
         MVC   WTOLIST+32(14),=CL14'CANCELABLE'
         B     SETCANC2
SETCANC1 SR    R9,R9               SET UP FOR EXECUTE
         MVC   WTOLIST+4(44),SWAPRMSG
         MVC   WTOLIST+32(14),=CL14'NON-CANCELABLE'
SETCANC2 CLI   6(R3),C','          IS SYNTAX CORRECT
         BNE   ERROR               GIVE ERROR IF NOT
         LA    R3,7(0,R3)          POINT TO ASID
         LA    R4,4                SET MAX LENGTH
         BAL   R11,PARMCVT         CONVERT HEX NUMBER
         STH   R1,ASID             SAVE THE TARGET ASID
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
*-------------------------------------------------------------*    @TEC
*   THE CSCB ADDR IN  THE  ASCB  POINTS TO THE INITIATOR CSCB *    @TEC
*   FOR  BATCH  JOBS.   THE  JOBNAME  POINTERS  IN  THE  ASCB *    @TEC
*   (ASCBJBNI  X'AC')  AND  (ASCBJBNS  X'B0')  POINT  TO  THE *    @TEC
*   APPROPRIATE JOB STEP  TASK  AT  CSCB+8 OR CSCB+X'10'.  IF *    @TEC
*   POSSIBLE WE WILL USE  THE  JOBNAME  POINTER TO GET TO THE *    @TEC
*   CORRECT CSCB.                                             *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO                             LMB
*-------------------------------------------------------------*    @TEC
*   IF NON ZERO THEN THIS IS A BATCH JOB.  THE ASCB+AC POINTS *    @TEC
*   TO CSCB+8 FOR THE JOBNAME                                 *    @TEC
*-------------------------------------------------------------*    @TEC
         BZ    JOBNM2              GET 2ND JOBNAME POSITION         LMB
         LA    R5,0(0,R4)          LOAD CSCB ADDR OF JOB (NOT INIT) LMB
         AH    R5,=H'-8'           BACK UP 8 BYTES TO START OF CSCB LMB
         B     SETCANMS            GO DO WTO                        LMB
JOBNM2   L     R4,176(0,R5)        JOBNAME POINTER                  LMB
         LTR   R4,R4               ZERO                             LMB
         BZ    OTHRCSCB            GET CSCB DIRECTLY FORM THE ASCB  LMB
         CLC   60(4,R5),=X'00000000'  IS THERE A TSB IN THE ASCB?   LMB
         BNZ   JOBTSO              THERE'S A TSB, IT IS A TSO ASID  LMB
*-------------------------------------------------------------*    @TEC
*   NO TSB, SO IT IS  A  STARTED TASK.  THE ASCB+B0 POINTS TO *    @TEC
*   CSCB+X'10' FOR THE JOBNAME.                               *    @TEC
*-------------------------------------------------------------*    @TEC
         LA    R5,0(0,R4)          LOAD CSCB ADDR OF TASK (NOT INIT)LMB
         AH    R5,=H'-16'          BACK UP 16 BYTES TO START OF CSCBLMB
         B     SETCANMS            GO DO WTO                        LMB
*-------------------------------------------------------------*    @TEC
*   A TSB, SO THIS  IS  A  TSO  ASID.   THE ASCB+B0 POINTS TO *    @TEC
*   CSCB+8 FOR THE JOBNAME.                                   *    @TEC
*-------------------------------------------------------------*    @TEC
JOBTSO   LA    R5,0(0,R4)          LOAD CSCB ADDR OF TASK           LMB
         AH    R5,=H'-8'           BACK UP 8 BYTES TO START OF CSCB LMB
         B     SETCANMS            GO DO WTO                        LMB
SETCANMS MVC   WTOLIST+9(8),0(R4)  JOBNAME
         B     SETCANBT            GO SET BITS
OTHRCSCB L     R5,56(0,R5)         ASCB-CSCB ADDR (MAY BE INITIATOR)LMB
SETCANBT DS    0H
         CLC   TSTSVC35(2),=X'0A23'  IS THIS TSO EXECUTION OF #D
         BE    *+24                NO. SKIP AUTH.
         LA    R0,1                                                @TEC
         SVC   232                                                 @TEC
         MODESET KEY=ZERO                                          @TEC
         NI    7(R5),X'F7'         SET NON-CANCELABLE
         EX    R9,SETCANCX         SET CANCELABLE OR LEAVE NON-CANC
         CLC   TSTSVC35(2),=X'0A23'  IS THIS TSO EXECUTION OF #D
         BE    *+22                NO. SKIP AUTH.
         MODESET KEY=NZERO                                         @TEC
         SR    R0,R0                                               @TEC
         SVC   232                                                 @TEC
         LA    R1,WTOLIST
         MVC   WTOLIST(4),=X'00300100'
         B     MSGRTN
SETCANCX OI    7(R5),X'00'         EXECUTED OI FOR SWAP/NOSWAP
         TITLE 'XA1SD03D  D COMMAND  --  EXIT ROUTINE'
MEMTERM  LA    R3,5(0,R3)          POINT TO ASID
         MVC   WTOLIST+4(44),EXITMSG
         LA    R4,4                SET MAX LENGTH
         BAL   R11,PARMCVT         CONVERT HEX NUMBER
         STH   R1,ASID             SAVE THE TARGET ASID
         LH    R8,ASID             SAVE THE TARGET ASID
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BNZ   *+14                NO
         L     R4,176(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BZ    *+10                YES
         MVC   WTOLIST+9(8),0(R4)  JOBNAME
         CALLRTM TYPE=MEMTERM,COMPCOD=3549,ASID=(R8)
         LA    R1,WTOLIST
         MVC   WTOLIST(4),=X'00300100'
         B     MSGRTN
         TITLE 'XA1SD03D  D COMMAND  --  CHAP ROUTINE'
CHAP     LA    R3,5(0,R3)          POINT TO ASID
         MVC   WTOLIST+4(44),CHAPMSG
         MVC   WTOLIST+42(3),5(R3)  DPRTY
         MVC   DOUBLE(3),=C'000'
         MVZ   DOUBLE(3),5(R3)
         CLC   DOUBLE(3),=C'000'
         BNE   ERROR               NOT NUMERIC
         PACK  DOUBLE(8),5(3,R3)
         CVB   R8,DOUBLE
         LA    R4,4                SET MAX LENGTH
         BAL   R11,PARMCVT         CONVERT HEX NUMBER
         STH   R1,ASID             SAVE THE TARGET ASID
         LR    R5,R1               LOAD ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         L     R5,0(0,R4)          ASCB ADDR
         L     R4,172(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BNZ   *+14                NO
         L     R4,176(0,R5)        JOBNAME POINTER
         LTR   R4,R4               ZERO
         BZ    *+10                YES
         MVC   WTOLIST+9(8),0(R4)  JOBNAME
         CH    R8,=H'255'          MAX DPRTY
         BH    ERROR               OVER, ERROR
         STC   R8,43(0,R5)         SET NEW DPRTY IN ASCB
         L     R5,144(0,R5)        OUCB ADDR
         STC   R8,26(0,R5)         SET NEW DPRTY IN OUCB
         LA    R1,WTOLIST
         MVC   WTOLIST(4),=X'00300100'
         B     MSGRTN
         TITLE 'XA1SD03D  D COMMAND  --  ERROR ROUTINES'
         USING *,R15
         USING XSA,R2
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
*-------------------------------------------------------------*    @TEC
*   THIS WILL RECORD ANY ABENDS  IN LOGREC WITH THE OPERANDS, *    @TEC
*   REGISTERS, AND PSW IN IT.                                 *    @TEC
*-------------------------------------------------------------*    @TEC
         STM   R14,R12,12(R13)     SAVE REGISTER
         LR    R14,R13             SAVE ORIG R13
         L     R13,0(R1)           GET ESTAE PARM
         L     R2,XSASAVE          GET XSA ADDRESS
         LR    R13,R14             RESTORE R13
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC  SET TO VRA
*                                  AND EBCDIC
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX  MOVE HEADER
         MVC   SDWAVRA+11-SDWA(8,1),0(R2)  MOVE IN DATA
         MVI   SDWAURAL-SDWA(1),19  SET LENGTH OF DATA
         B     ESTNOP              SKIP CONSTANTS
         ESTMODS ,
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8)
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS
         LA    R3,ESTMODS          POINT AT NAMES
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,                   X
               RECORD=YES,RECPARM=(3),REGS=(14,12)
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         USING *,R15
STAERTRY L     R12,=A(IEESD03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     RETURN
STAEMG   LA    R1,STAEMSG          ADDRESSING ERROR
MSGRTN   L     R2,XSASAVE          RELOAD XSA ADDR
         USING XSA,R2
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         DROP  R2
         B     RETURN
NOTVER   LA    R1,VERMSG           NOT VERIFIED
         B     MSGRTN              GO ISSUE WTO
ERROR    LA    R1,ERRMSG           PARM ERROR
         B     MSGRTN              GO ISSUE WTO
NOPARM   LA    R1,MVSMSG           MVS
         B     MSGRTN              GO ISSUE WTO
UCBNFND  LA    R1,UCBNFMSG         UCB NOT FOUND
         B     MSGRTN              GO ISSUE WTO
SWAPOUT  LA    R1,SWAPMSG          ADDRESS SPACE SWAPPED OUT
         B     MSGRTN
DISTERR  LA    R1,DISTMSG          ERROR OCCURRED IN SRB MODE
         B     MSGRTN
SRBFAIL  DS    0H                  SRB FAILED TO POST SO DUMP
         DC    H'0'
XMPTERR  LA    R1,XMPTMSG          POINT AT MSG
         B     MSGRTN
SRBPGERR LA    R1,PURGMSG          SRB WAS PURGED BEFORE PROCESS
         B     MSGRTN
RETURN   EQU   *
         ESTAE 0
         L     R0,SIZE
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN  R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         LTORG
         DS    0F
SIZE     DC    AL1(241),AL3(WORKEND-WORKSTRT)
         DS    0F
SWAPPG   DC    XL2'0005'           AXC-CBT
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         DS    0F
VERMSG   DC    X'00360100'
         DC    CL50'DATA NOT VERIFIED'
         DS    0F
SVCMSG1  DC    X'00360100'
         DC    CL50'REQUEST COMPLETE -   SET APFAUTH'
         DS    0F
SVCMSG2  DC    X'00360100'
         DC    CL50'REQUEST COMPLETE -   SET NOAUTH'
         DS    0F
ERRMSG   DC    X'00360100'
         DC    CL50'PARAMETER ERROR'
         DS    0F
EXITMSG  DC    CL44'JOB  XXXXXXXX  TERMINATED BY CMD SUB-SYSTEM'
         DS    0F
CHAPMSG  DC    CL44'JOB  XXXXXXXX  HAS BEEN SET TO DPRTY= NNN'
         DS    0F
SWAPRMSG DC    CL44'JOB  XXXXXXXX  HAS BEEN SET '
         DS    0F
MVSMSG   DC    X'00360100'
         DC    CL50'I AM THE ALL-POWERFUL WIZARD OF MVS, YOUR MASTER '
         DS    0F
UCBNFMSG DC    X'00360100'
         DC    CL50'UNIT SPECIFIED NOT FOUND'
         DS    0F
SWAPMSG  DC    X'00360100'
         DC    CL50'ADDRESS SPACE REQUESTED IS SWAPPED OUT'
         DS    0F
DISTMSG  DC    X'00360100'
         DC    CL50'DISASTEROUS ERROR OCCURED IN SRB MODE'
         DS    0F
XMPTMSG  DC    X'00360100'
         DC    CL50'CROSS-MEMORY POST FAILED'
         DS    0F
PURGMSG  DC    X'00360100'
         DC    CL50'ADDRESS SPACE PURGING SRBS'
DOSWAP1  DC    CL29'IS A NON-SWAPPABLE JOB       '
DOSWAP2  DC    CL29'RESET TO PERMANENT SWAP OUT  '
DOSWAP3  DC    CL29'RESET TO PREVIOUS VALUE      '
DOSWAP4  DC    CL29'SWAP FAILED, RETRY COMMAND   '
         DROP  R12,R13
         TITLE 'XA1SD03D  D COMMAND  --  SRB MODE CODE'
D#SRBCD  DS    0D
*-------------------------------------------------------------*    @TEC
*  THIS CODE PERFORMS THE FOLLOWING FUNCTIONS                 *    @TEC
*      1 ESTABLISHES AN FRR FOR ERROR RECOVERY                *    @TEC
*      2 VERIFIES THAT THE ADDRESSES THAT ARE NEEDED DO EXIST.*    @TEC
*      3 PERFORM THE MODIFICATION IF ALLOW AND NECESSARY      *    @TEC
*      4 SAVE THE PROPER CORE FOR DUMPING.                    *    @TEC
*      5 CROSS-MEMORY POST THE MAIN COMMAND PROCESSOR         *    @TEC
*-------------------------------------------------------------*    @TEC
         USING WORK,R8
         USING D#SRBCD,R7
         LR    R8,R1               SET THE MAIN PARM DSECT
         LR    R7,R15              SET THE BASE REGISTER
         ST    R14,ASRBRTN         SAVE RETURN ADDR
         TM    FLAG1,FG1SUBR       IS THIS A SUBROUTINE CALL
         BO    D#SRB1              YES SO SKIP FRR
         LA    R5,D#FRRCD          POINT AT FRR CODE
         SETFRR  A,FRRAD=(R5),WRKREGS=(2,3),PARMAD=(R4)
         ST    R4,FRRPRMS          SAVE ADDR OF FRRPRMS
*-------------------------------------------------------------*    @TEC
*   NOW INIT THE FRR PARM AREA AND VALIDATE THE INPUT ADDR    *    @TEC
*-------------------------------------------------------------*    @TEC
D#SRB1   L     R2,FRRPRMS          ACCESS THE 6 WORK PARM AREA
         STM   R7,R8,0(R2)         SAVE BASE AND WORK REGS
         MVI   0(R2),X'80'         SET VERIFICATION IN PROGRESS
         L     R1,=A(X'80000000'+D#SRB1A)
         BSM   0,R1                GO TO 31 BIT MODE
D#SRB1A  DS    0H
         L     R1,ADDR             POINT AT CORE TO TROUBLE
         CLI   0(R1),0             ACCESS START OF AREA
         L     R3,LENGTH
         ALR   R3,R1               SUM THEN UP
         BCTR  R3,0                AND BACK DOWN ONE
         CLI   0(R3),0             DOES END EXIST ALSO
         MVI   0(R2),0             SET VERIFICATION FLAG OFF
         TM    FLAG1,FG1DUMP       IS IT DUMP REQUEST
         BO    D#SRB3              GO SETUP DUMP
         CLC   0(4,R1),ALTVER      DOES THE INPUT VERIFY
         BE    D#SRB2              B IF YES
         MVI   FLAG2,FG2NVER       SET NOT VERIFY
         B     D#SRB3              GO AND DUMP IT
D#SRB2   MVC   0(4,R1),ALTREP      DO MODIFICATION
*-------------------------------------------------------------*    @TEC
*   NOW ADJSUST THE ADDR OF DUMP                              *    @TEC
*-------------------------------------------------------------*    @TEC
D#SRB3   SRL   R1,4
         SLL   R1,4                ADJUST ADDR SO IT IS ON BOUNDARY
         ST    R1,ADDR             SAVE IT FOR PRINTING
         L     R2,LENGTH           GET LENGTH TO DUMP
         BCTR  R2,0
         EX    R2,D#SRBMVC         MOVE THE DATA INTO WORK
*-------------------------------------------------------------*    @TEC
*   NOW WE TERMINATE PROCESSING BY  DOING A CROSS MEMORY POST *    @TEC
*   IF NOT IN SUBROUTINE MODE                                 *    @TEC
*-------------------------------------------------------------*    @TEC
FRRRTY   LA    R1,FRRRTY1          GET ADDRESS WITH 24 BIT MODE
         BSM   0,1                 GO TO THAT MODE
FRRRTY1  DS    0H
         TM    FLAG1,FG1SUBR       IS THIS SUBROUTINE MODE
         BO    D#EXIT              IF SO THEN EXIT
         SETFRR  D,WRKREGS=(2,3)
FRRPOST  L     R10,=A(X'40000000')  SET CODE FOR POST
         LR    R9,R8               SAVE WORK POINTER IN SAFE REG
         LA    R11,ECB             ADDR OF ECB TO POST
         ICM   R11,8,=X'80'        FLAG AS XMPOST
         LA    R12,D#POSTR         SET POST ERROR RETURN
         L     R13,MYASCB          ASCB TO POST
         L     R15,CVTPTR          POINT AT CVT
         L     R15,CVT0PT01-CVTMAP(R15)  GET POST ENTRY POINTR
         BALR  R14,R15             GO DO POST
         DROP  R7                  KILL MAIN ADDRESS
         USING *,R14               SET TEMP BASE
D#PRTN   LR    R8,R9               RESET BASE OF WORK
         SL    R14,=A(D#PRTN-D#SRBCD)  NOW HAVE CORRECTED BASE
         LR    R7,R14              SET TO PROPER REG
         DROP  R14
         USING D#SRBCD,R7          RESET MAIN BASE
         OI    FLAG1,FG1SRDN       FLAG SRB AS COMPLETED
D#EXIT   L     R14,ASRBRTN         RESTORE RETURN ADDR
         BR    R14                 EXIT
D#SRBMVC MVC   ALTVER(0),0(R1)     MOVE IN THE DATA TO DUMP
*-------------------------------------------------------------*    @TEC
*   POST ERROR ROUTINE ..  FLAG  ERROR  AND LET TIMER WAKE UP *    @TEC
*   COMM TASK                                                 *    @TEC
*-------------------------------------------------------------*    @TEC
D#POSTR  LR    R8,R9               RESET WORK BASE
         OI    FLAG2,FG2PSTR       FLAG POST ERROR
         BR    R14                 RETURN TO D#PRTN
         TITLE 'XA1SD03D  D COMMAND  --  FRR FOR THE SRB MODE'
D#FRRCD  DS    0D
         L     R2,0(R1)            POINT AT PARM AREA
         LM    R7,R8,0(R2)         SET BASE REGS
         TM    0(R2),X'80'         ARE WE IN VALIDATION
         BZ    D#FRR1              NOPE
*-------------------------------------------------------------*    @TEC
*   VALIDATION ERROR                                          *    @TEC
*-------------------------------------------------------------*    @TEC
         OI    FLAG2,FG2IVLD       SET FLAG FOR MESSAGE
         SETRP RECORD=NO,RC=4,RETADDR=FRRRTY,REGS,DUMP=NO,             X
               RETREGS=YES,FRESDWA=YES
         BR    R14                 EXIT
*-------------------------------------------------------------*    @TEC
*   ALL OTHER ERRORS                                          *    @TEC
*-------------------------------------------------------------*    @TEC
D#FRR1   OI    FLAG2,FG2ERRR       SET FLAG FOR MESSAGES
         SETRP RECORD=YES,RC=4,RETADDR=FRRRTY,REGS,DUMP=YES,           X
               RETREGS=YES,FRESDWA=YES
         BR    R14                 EXIT
         TITLE 'XA1SD03D  D COMMAND  --  RESOURCE MANAGER CLEANUP'
*-------------------------------------------------------------*    @TEC
*   THIS ROUTINE RECEIVES CONTROL IF  THE SRB MUST BE PURGED. *    @TEC
*-------------------------------------------------------------*    @TEC
D#RMTR   DS    0H
         USING *,R15
         LR    R7,R15              SET BASE REGISTER
         SL    R7,=A(D#RMTR-D#SRBCD)  BY COMPUTATION
         DROP  R15
         USING D#SRBCD,R7
         LR    R8,R2               SET UP POINTER TO WORK
         ST    R14,ASRBRTN         SAVE RETURN ADDR
         OI    FLAG2,FG2PURG       SET PURGED
         B     FRRPOST             GO AND POST TO CLEAN UP
         LTORG
         TITLE 'XA1SD03D  D COMMAND  --  DSECTS'
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         PRINT NOGEN
         CVT   DSECT=YES
         IHAASVT
         IHAASCB
         IHAFRRS
         IHAPSA
         IHASDWA
         IHASRB
         IHARB
         IRAOUCB
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
         DS    0D
DOUBLE   DS    2F
PLINES   DS    F
PLIST    DS    3F
XSASAVE  DS    F
WTOLIST  DS    F
PRINT    DS    63C
PST      STAE  PST,CT,MF=L
DMYPRMS  DS    6F                  DUMMY AREA FOR FRR PARMS FOR SUBR
*                                  MODE
FRRPRMS  DS    F                   ADDRESS OF 6 WORD FRR PARM
ASRBRTN  DS    F                   RETURN ADDR FOR SRB CODE
MYASCB   DS    F                   ASCB ADDR OF MAIN ROUTINE
MYTCB    DS    F                   TCB ADDRESS FOR MAIN ROUTINE
TOASCB   DS    F                   ASCB ADDR OF SRB ROUTINE
ECB      DS    F                   ECB FOR MAIN ROUTINE TO WAIT ON
ECB2     DS    F                   ECB FOR STIMER TO POST
ECBLIST  DS    2F
LENGTH   DS    F                   LENGTH OF STORAGE TO DUMP
SRBAREA  DS    ((SRBSIZE+3)/4)F    THE SRB ITSELF
ADDR     DS    F                   ADDRESS TO PROCESS AT
ALTREP   DS    F                   REPLACEMENT VALUE
ALTVER   DS    F,252C              SPACE FOR VER DATA AND DUMP DATA
ASID     DS    H                   ASID OF TOASCB
FLAG1    DS    X
FG1DUMP  EQU   X'80'
FG1REP   EQU   X'40'
FG1SRDN  EQU   X'02'               IF ON SRB HAS TERMINATED
FG1SUBR  EQU   X'01'
FLAG2    DS    X
FG2NVER  EQU   X'01'               VERIFICATION FAILED
FG2IVLD  EQU   X'02'               VALIDATION FAILED
FG2ERRR  EQU   X'04'               DISASTER OCCURED IN SRB
FG2PURG  EQU   X'08'               SRB WAS PURGED
FG2PSTR  EQU   X'10'               IF ON THEN SRB POST HAD ERROR
ESTAELST DS    0F,(ESTAEOVX)X
WKAREA   DS    0D,XL100
WORKEND  DS    0F
         END
./       ADD   NAME=CSCSE03D
         TITLE 'IEESE03D -   #A  EXTENDED DISPLAY ACTIVE'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SE2SE03D -       #A  EXTENDED DISPLAY ACTIVE              ***
***                                                                 ***
***       VERSION -        2.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/XA 2.1.1                             ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        08/10/81  JCC-BCB TEST FOR END OF ASCBS  ***
***                        02/07/84  JAL-SNET ADD 31-BIT CODING FOR ***
***                                      XA.                        ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESE03D CSECT
IEESE03D AMODE 24
IEESE03D RMODE 24
         SPLEVEL SET=2
         LR    R12,R15
         USING IEESE03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         MVC   PARM(10),=CL10' '
         MVI   LISTIND,C'L'        SET LIST
         MVI   SCANRET,C' '        SET FOUND
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         L     R3,XAL              LOAD LIST POINTER
         LA    R3,0(0,R3)          CLEAR HIGH ORDER
         LTR   R3,R3               PARM EXIST
         BZ    STAE                NO, ALL
         LR    R7,R3               SAVE PARM START
         LA    R4,10               MAXLENGTH
PARM1    CLI   0(R3),C' '          END OF PARM
         BE    PARM2               YES, USE IT
         LA    R3,1(0,R3)          INCR INTO PARM
         BCT   R4,PARM1            CHECK NEXT BYTE
         B     ERROR               PARM TOO LONG
         SPACE
PARM2    LA    R6,9                MAX LENGTH-1
         SR    R6,R4               ACTUAL LENGTH
         BNP   ERROR               ZERO LENGTH                     WJB
         EX    R6,JOBMOVE          MOVE PARM INFO
         SPACE 3
STAE     LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                     -JAL/XA-
         BSM   0,R9                                           -JAL/XA-
AMODE31  DC    A(CONT31+X'80000000')                          -JAL/XA-
CONT31   DS    0H                                             -JAL/XA-
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         B     JOBSCAN
         SPACE 3
JOBMOVE  MVC   PARM(0),0(R7)       MOVE PARM INFO
JOBSCAN  SR    R8,R8               CLEAR ASID
         XC    SCANTYPE(2),SCANTYPE CLEAR TYPE IND
         CLI   PARM,C'.'           JOBNAME REQUEST
         BE    JOBOUT              YES, GO PROCESS
         CLI   PARM,C' '           ALL REQUESTED
         BE    JOBOUTX             SET UP ALL, NO LIST
         TM    PARM+2,X'F0'        ONE JOB ONLY REQUEST
         BO    JOBSCAN1            YES
         CLC   PARM+2(2),=C',L'    LIST REQUESTED
         BE    JOBSCAN0            YES, CONTINUE
         MVI   LISTIND,C'D'        TURN OFF LIST
         CLC   PARM+2(2),=C',D'    DISPATCH LIST REQUEST
         BE    JOBSCAN0            NYES, CONTINUE
         MVI   LISTIND,C' '        SHORT LIST
         CLC   PARM+2(2),=C',S'    SHORT LIST REQUEST
         BNE   JOBSCAN0            NO
         MVI   LISTIND,C'S'        SHORT LIST
         SPACE
JOBSCAN0 MVI   SCANTYPE+1,X'04'    TSO USERS
         CLI   PARM+1,C'T'         IS REQUEST FOR TSO USERS
         BE    JOBOUT              YES, GO PROCESS
         MVI   SCANTYPE+1,X'08'    JOBS
         CLI   PARM+1,C'J'         IS REQUEST FOR JOBS
         BE    JOBOUT              YES, GO PROCESS
         MVI   SCANTYPE+1,X'0C'    STC
         CLI   PARM+1,C'S'         IS REQUEST FOR STC
         BE    JOBOUT              YES, GO PROCESS
         MVI   SCANTYPE+1,X'10'    INITS
         CLI   PARM+1,C'I'         IS REQUEST FOR INITS
         BE    JOBOUT              YES, GO PROCESS
         MVI   SCANTYPE+1,X'18'    ALL JOBS
         CLI   PARM+1,C'A'         IS REQUEST FOR INITS
         BE    JOBOUT              YES, GO PROCESS
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),PARM
         CLC   DOUBLE(2),=C'00'    DOMAIN SPECIFIED
         BNE   ERROR               NO, PARM ERROR
         PACK  DOUBLE(8),PARM(2)
         CVB   R1,DOUBLE
         STC   R1,DOMAINTS         SAVE SCAN DOMAIN
         MVI   SCANTYPE+1,X'14'    SET DOMAIN SCAN
         B     JOBOUT
         SPACE
JOBSCAN1 LA    R4,PARM             ASID INPUT ADDR
         LA    R5,4                LOAD NUMBER OF DIGITS
         SPACE
JOBSCAN2 LA    R9,9                SET ADD BYTE
         CLI   0(R4),C'A'          VALID CHAR
         BL    ERROR               NO, ERROR
         CLI   0(R4),C'F'          VALID CHAR
         BNH   JOBSCAN3            YES, GO USE
         CLI   0(R4),C'0'          VALID CHAR
         BL    ERROR               NO, ERROR
         CLI   0(R4),C'9'          VALID CHAR
         BH    ERROR               NO, ERROR
         SR    R9,R9               CLEAR ADD BYTE
         SPACE
JOBSCAN3 IC    R7,0(0,R4)          INSERT ASID BYTE
         SLL   R7,28               SHIFT OUT JUNK
         SRL   R7,28               SHIFT BACK
         AR    R9,R7               ADD TO CALC ACTUAL DIGIT
         SLL   R9,28               SHIFT OVER DIGIT
         SLDL  R8,4                SHIFT DIGIT INTO ACCUMULATOR
         LA    R4,1(0,R4)          NEXT ASID BYTE
         BCT   R5,JOBSCAN2         GET NEXT
         B     JOBOUT
JOBOUTX  MVI   LISTIND,C' '
         SPACE
JOBOUT   MVC   JOBMSG1,JOBLINE1
         MVC   JOBMSG2,JOBLINE2
         MVC   JOBMSG3,JOBLINE3
         MVC   JOBMSG4,JOBLINE4
         LR    R5,R8               LOAD ASID
         LTR   R5,R5               ZERO ASID
         BZ    *+6                 YES, BYPASS ADJUST
         BCTR  R5,0                ADJUST ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         L     R6,516(0,R4)        MAX # ASIDS                   JCC
         MH    R6,=H'4'            MULT BY LENGTH                JCC
         LA    R6,528(R4,R6)       FIND END OF ASID LIST         JCC
         ST    R6,ASVTEND          STORE THAT ADDR               JCC
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         B     JOBOUT4
         SPACE
JOBOUT1  L     R5,0(0,R4)          ASCB ADDR
         L     R6,56(0,R5)         CSCB ADDR
         L     R7,144(0,R5)        LOAD OUCB ADDR
         LH    R9,SCANTYPE         LOAD INCR INTO TABLE
         B     *+4(R9)             BR INTO TABLE
         B     JOBOUT2             ALL TYPES
         B     TSO                 TS USERS
         B     JOB                 JOBS
         B     STC                 STARTED TASKS
         B     JOB                 INITS
         B     DOM                 DOMAIN SCAN
         B     JOBOUT2             ALL JOBS
         SPACE
JOBOUT2  BAL   R11,ASCBFORM        GO FORMAT ASCB INFO
         UNPK  OUCB(7),145(4,R5)   OUCB ADDR
         NC    OUCB(6),=8X'0F'
         TR    OUCB(6),=C'0123456789ABCDEF'
         MVI   OUCB+6,C')'
         L     R6,144(0,R5)        OUCB ADDR
         L     R5,56(0,R5)         CSCB ADDR
         BAL   R11,CSCBFORM        GO FORMAT CSCB INFO
         BAL   R11,OUCBFORM        GO FORMAT OUCB INFO
         CLI   PARM,C'.'           JOBNAME REQUEST
         BNE   JOBOUT2A            NO, BYPASS MATCH
         CLC   PARM+1(8),JOBNAME
         BNE   JOBOUT3             NO MATCH, NO PRINT
JOBOUT2A EQU   *
         CLI   LISTIND,C'D'        DISPATCH LIST
         BE    JOBOUT5             YES, 1 LINE ONLY
         LA    R1,JOBMSG1          LOAD MSG1 ADDR
         BAL   R11,MSGRTN          GO PRINT MSG
         CLI   LISTIND,C'S'        SHORT LIST
         BE    JOBOUT3             YES, 1 LINE ONLY
         LA    R1,JOBMSG2          LOAD MSG2 ADDR
         BAL   R11,MSGRTN          GO PRINT MSG
         CLI   LISTIND,C' '        NO LIST REQUIRED
         BE    JOBOUT3             YES, BYPASS MSG2
         LA    R1,JOBMSG3
         BAL   R11,MSGRTN
         LA    R1,JOBMSG4
         BAL   R11,MSGRTN
         SPACE
JOBOUT3  LTR   R8,R8               ONE JOB ONLY
         BNZ   RETURN              YES, RETURN
         SPACE
JOBOUT4  LA    R4,4(0,R4)          INCR INTO ASVT
         C     R4,ASVTEND          END OF ASVT                   JCC
         BNL   RETURN              YES, RETURN                   JCC
         TM    0(R4),X'80'         AVAILABLE ENTRY
         BO    JOBOUT4             YES, CHECK NEXT
         B     JOBOUT1             GO USE IT
         SPACE 1
JOBOUT5  MVC   JOBMSG1+28(12),=CL12'DISPATCHABLE'
         L     R5,0(0,R4)          ASCB ADDR
         TM    208(R5),X'80'       LSMQ BIT ON
         BZ    *+10                NO, DISPATCHABLE
         MVC   JOBMSG1+28(12),=CL12' '
         LA    R1,JOBMSG1          LOAD MSG1 ADDR
         BAL   R11,MSGRTN          GO PRINT MSG
         B     JOBOUT3
TSO      CLI   28(R6),X'01'        TSO USER
         BE    JOBOUT2             YES, USE IT
         B     JOBOUT4
         SPACE 3
JOB      CLI   28(R6),X'03'        JOB INIT
         BE    JOBOUT2             YES, USE IT
         B     JOBOUT4
         SPACE 3
STC      CLI   28(R6),X'00'        MASTER/AUXTM
         BE    JOBOUT2             YES, USE IT
         CLI   28(R6),X'03'        JOB INIT
         BE    JOBOUT4             YES, BYPASS
         TM    18(R7),X'50'        START/MOUNT
         BZ    JOBOUT4             NO, CHECK NEXT
         B     JOBOUT2             YES, USE IT
         SPACE 3
DOM      CLC   DOMAINTS(1),40(R7)  DOMAIN MATCH     MVS/SE         WJB
         BE    JOBOUT2             YES, USE IT
         B     JOBOUT4
ASCBFORM LTR   R8,R8               ASID PRESENT
         BZ    ASCBFRM1            NO, CONTINUE
         SR    R14,R14             LOAD
         IC    R14,36(0,R5)
         SLL   R14,8                  ASID
         IC    R14,37(0,R5)
         CR    R14,R8              ASID MATCH
         BNE   JOBOUT4             NO, NO PRINT
         SPACE
ASCBFRM1 UNPK  DOUBLE(5),36(3,R5)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   ASID(4),DOUBLE      SET ASID IN MSG
         SR    R9,R9
         IC    R9,43(0,R5)         DPRTY TO MSG
         CVD   R9,DOUBLE
         UNPK  DPRTY(3),DOUBLE+6(2)
         OI    DPRTY+2,X'F0'
         LH    R1,122(0,R5)        NON-VAM SLOT COUNT
         CVD   R1,DOUBLE
         UNPK  NVAMSLOT(4),DOUBLE+5(3)
         OI    NVAMSLOT+3,X'F0'
         LH    R1,120(0,R5)        VAM SLOT COUNT
         CVD   R1,DOUBLE
         UNPK  VAMSLOT(5),DOUBLE+5(3)
         OI    VAMSLOT+4,X'F0'
         MVC   SRC-3(2),=C'QP'     SET QUE POSITION IND
         LH    R1,38(0,R5)         DISP POSITION
         CVD   R1,DOUBLE
         UNPK  SRC(2),DOUBLE+6(2)
         OI    SRC+1,X'F0'
         BR    R11
CSCBFORM CLI   28(R5),X'03'        INIT
         BNE   CSCBFRM3            NO, GO HANDLE
         CLI   PARM+1,C'S'         STC REQUEST
         BE    JOBOUT4             YES, EXIT
         LA    R9,0(0,R5)          SAVE CSCB ADDR
         SR    R10,R10             INSERT
         IC    R10,30(0,R5)
         SLL   R10,8               ASID
         IC    R10,31(0,R5)
         SPACE
CSCBFRM1 L     R5,0(0,R5)          NEXT CSCB
         LA    R5,0(0,R5)          CLEAR HIGH ORDER
         LTR   R5,R5               END OF CSCBS
         BNZ   *+10                NO, CONTINUE
         LR    R5,R9               LOAD CSCB ADDR
         B     CSCBFRM2            CONTINUE
         CR    R5,R9               SAME CSCB
         BE    CSCBFRM2            YES, USE IT
         CH    R10,30(0,R5)        SAME ASID
         BNE   CSCBFRM1            NO, CHECK NEXT
         CLI   PARM+1,C'I'         REQUEST FOR INITS
         BE    JOBOUT4             YES, BYPASS
         B     CSCBFRM3
         SPACE
CSCBFRM2 CLI   PARM+1,C'I'         REQUEST FOR INITS
         BNE   JOBOUT4             NO, BYPASS
         SPACE
CSCBFRM3 MVC   JOBNAME(8),8(R5)
         CLC   ASID(4),=C'0001'
         BCR   7,R11
         MVC   JOBNAME(8),=CL8'MASTER'
         BR    R11
OUCBFORM LH    R9,82(0,R6)         SWAP IN SIZE         MVS/SE     WJB
         CVD   R9,DOUBLE
         UNPK  SWAPIN(3),DOUBLE+6(2)
         OI    SWAPIN+2,X'F0'
         LH    R9,80(0,R6)         SWAP OUT SIZE        MVS/SE     WJB
         CVD   R9,DOUBLE
         UNPK  SWAPOUT(3),DOUBLE+6(2)
         OI    SWAPOUT+2,X'F0'
         CLI   41(R6),X'00'        JOB ON IN QUEUE      MVS/SE     WJB
         BE    OUCBFRM0            YES, NO SWAP REASON
         MVC   SRC-3(2),=C'SR'     SET COMMENT TO SWAP REASON
         UNPK  SRC(3),41(2,R6)     SWAP REASON         MVS/SE      WJB
         NC    SRC(2),=8X'0F'
         TR    SRC(2),=C'0123456789ABCDEF'
         MVI   SRC+2,C')'
         CLI   38(R6),X'7F'        MVS/SE LOGICAL SWAP
         BNE   OUCBFRM0            NO
         MVC   SRC(2),=C'LG'
         SPACE 1
OUCBFRM0 LH    R9,42(0,R6)         SWAP COUNT          MVS/SE      WJB
         CVD   R9,DOUBLE
         UNPK  SWP(4),DOUBLE+5(3)
         OI    SWP+3,X'F0'
         LA    R9,16(0,R6)         OUCB FLAGS BEGIN
         LA    R10,QFL             OUTPUT FLAGS BEGIN
         LA    R7,6                NUMBER OF FLAG BYTES
         SPACE
OUCBFRM1 UNPK  0(3,R10),0(2,R9)    UNPACK A FLAG BYTE
         NC    0(2,R10),=4X'0F'
         TR    0(2,R10),=C'0123456789ABCDEF'
         MVI   2(R10),C')'            AND TRANSLATE IT
         LA    R9,1(0,R9)          NEXT FLAG BYTE
         LA    R10,6(0,R10)        NEXT OUTPUT AREA
         BCT   R7,OUCBFRM1         GET NEXT
         UNPK  0(3,R10),1(2,R9)    LAST FLAG BYTE
         NC    0(2,R10),=4X'0F'
         TR    0(2,R10),=C'0123456789ABCDEF'
         MVI   2(R10),C')'
OUCBFRM2 UNPK  ASCB(7),45(4,R6)    ASCB ADDR         MVS/SE        WJB
         NC    ASCB(6),=8X'0F'
         TR    ASCB(6),=C'0123456789ABCDEF'
         MVI   ASCB+6,C')'
         UNPK  DOMAIN(3),40(2,R6)  DOMAIN NUMBER     MVS/SE        WJB
         NC    DOMAIN(2),=8X'0F'
         TR    DOMAIN(2),=C'0123456789ABCDEF'
         MVI   DOMAIN+2,C')'
         UNPK  NPG(3),185(2,R6)    NEW PERFORM NUMBER
         NC    NPG(2),=8X'0F'
         TR    NPG(2),=C'0123456789ABCDEF'
         MVI   NPG+2,C'/'
         UNPK  RPG(3),181(2,R6)    RESET PERFORM NUMBER
         NC    RPG(2),=8X'0F'
         TR    RPG(2),=C'0123456789ABCDEF'
         MVI   RPG+2,C'/'
         UNPK  SPG(3),183(2,R6)    SPECIFIED PERFORM NUMBER
         NC    SPG(2),=8X'0F'
         TR    SPG(2),=C'0123456789ABCDEF'
         MVI   SPG+2,C')'
         UNPK  NDP(3),26(2,R6)     NEW DPRTY
         NC    NDP(2),=8X'0F'
         TR    NDP(2),=C'0123456789ABCDEF'
         MVI   NDP+2,C'/'
         UNPK  RDP(3),27(2,R6)     REAL DPRTY
         NC    RDP(2),=8X'0F'
         TR    RDP(2),=C'0123456789ABCDEF'
         MVI   RDP+2,C')'
         BR    R11
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESE03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     RETURN
MSGRTN   MVI   SCANRET,C'P'
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         BR    R11
         SPACE 3
ERROR    LA    R11,RETURN          LOAD RET ADDR
         LA    R1,ERRMSG           PARM ERROR
         B     MSGRTN              GO ISSUE WTO
         SPACE 3
RETURN   CLI   SCANRET,C' '        ANY FOUND
         BE    NOTFOUND            NO, TELL OPERATOR
         ESTAE 0
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         LA    R8,AMODE24                                     -JAL/XA-
         BSM   0,R8                                           -JAL/XA-
AMODE24  DS    0H                                             -JAL/XA-
         SR    R15,R15
         BR    R14
         SPACE 3
NOTFOUND LA    R11,RETURN
         LA    R1,NFNDMSG
         B     MSGRTN
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
         DS    0F
ERRMSG   DC    X'00360100'
         DC    CL50'PARAMETER ERROR'
         SPACE 3
         DS    0F
NFNDMSG  DC    X'00360100'
         DC    CL50'REQUESTED TYPE OR ASID NOT FOUND'
         DS    0F
JOBLINE1 DC    X'00320100'
         DC    CL9' '
         DC    C'(    ) '
         DC    C'DP(   ) '
         DC    C'SWL(   /   ) '
         DC    C'SWC(    )'
         SPACE 3
         DS    0F
JOBLINE2 DC    X'00320100'
         DC    CL4' '
         DC    C'PERF-NRS(  /  /  ) '
         DC    C'DPRTY-NR(  /  ) '
         DC    C'DMN(  )'
         SPACE 3
         DS    0F
JOBLINE3 DC    X'00320100'
         DC    CL4' '
         DC    C'Q(  ) S(  ) Y(  ) A(  ) '
         DC    C'T(  ) E(  ) U(  ) '
         SPACE 3
         DS    0F
JOBLINE4 DC    X'00320100'
         DC    CL4' '
         DC    C'AS(      ) QP(  ) '
         DC    C'OU(      ) A(    /     )'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
XSASAVE  DS    F
ASVTEND  DS    F                                                 JCC
PARM     DS    3F
SCANTYPE DS    H
LISTIND  DS    C
DOMAINTS DS    C
SCANRET  DS    C
         DS    0F
JOBMSG1  DS    0CL50
         DS    F
JOBNAME  DS    CL10
ASID     DS    CL9
DPRTY    DS    CL9
SWAPIN   DS    CL4
SWAPOUT  DS    CL9
SWP      DS    CL5
         SPACE 3
         DS    0F
JOBMSG2  DS    0CL50
         DS    F
         DS    CL13
NPG      DS    CL3
RPG      DS    CL3
SPG      DS    CL13
NDP      DS    CL3
RDP      DS    CL8
DOMAIN   DS    CL3
         SPACE 3
         DS    0F
JOBMSG3  DS    0CL50
         DS    F
         DS    CL6
QFL      DS    CL6
SFL      DS    CL6
YFL      DS    CL6
AFL      DS    CL6
TFL      DS    CL6
EFL      DS    CL6
UFL      DS    CL4
         SPACE 3
         DS    0F
JOBMSG4  DS    0CL50
         DS    F
         DS    CL7
ASCB     DS    CL11
SRC      DS    CL7
OUCB     DS    CL10
NVAMSLOT DS    CL5
VAMSLOT  DS    CL6
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSF03D
         TITLE 'XA1SF03D -   #F  DISPLAY STORAGE USAGE'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SE2SF03D -       #F  DISPLAY STORAGE USAGE                ***
***                                                                 ***
***       VERSION -        2.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/XA  2.1    TO                        ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        01/26/83  AXC-CBT CHANGE ESTAE PARM LEN  ***
***                        05/25/86  GLA-BFG COMPLETE REWRITE FOR   ***
***                                  XA STRUCTURE                   ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESF03D CSECT
         LR    R12,R15
         USING IEESF03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         XC    OUTMSLIM(4),OUTMSLIM
         MVI   VOSWIT,X'00'        CLEAR OFFLINE SWITCH
         MVI   VBSWIT,X'00'        CLEAR BAD FRAME SWITCH
         MVI   OUTMSG+4,C' '
         MVC   OUTMSG+5(65),OUTMSG+4
         XC    OUTMSG+70(4),OUTMSG+70  CLEAR FLAGS
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R15,=A(X'80000000'+ESTAEBYP)
         BSM   0,R15               CHANGE MODES   TO 31 BIT
ESTAEOVL ESTAE STAEXIT,CT,MF=L     * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL          * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL  * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         L     R3,XAL              LOAD LIST POINTER
         LA    R3,0(0,R3)          CLEAR HIGH ORDER
         LTR   R3,R3               PARM EXIST
         BZ    PFTLIST             NO, GO PROCESS PFT LIST
         CLI   0(R3),C'C'          CSA DISPLAY REQUEST
         BE    VCDISP              YES, GO PROCESS
         CLI   0(R3),C'B'          BAD FRAME REQUEST
         BE    VBDISP              YES, GO PROCESS
         CLI   0(R3),C'R'          V=R DISPLAY REQUEST
         BE    VRDISP              YES, GO PROCESS
         CLI   0(R3),C'M'          MEGABYTE DISPLAY REQUEST
         BE    VVDISP              YES, GO PROCESS
         CLI   0(R3),C'O'          OFFLINE INTERCEPT REQUEST
         BE    VODISP              YES, GO PROCESS
         LA    R11,RETURN          LOAD RET ADDR
         LA    R1,ERRMSG           PARM ERROR
         B     PRINT               GO ISSUE WTO
PFTLIST  MVC   OUTMSG(4),=X'00460100'
         L     R14,16              LOAD CVT ADDR
         L     R6,556(0,R14)       LOAD ASVT ADDR
         L     R7,516(0,R6)        MAX NO. OF ASCBS
         LA    R6,524(0,R6)        1ST ASCB SLOT
         L     R3,356(0,R14)       LOAD PVT ADDR
         L     R14,8(R3)           GET ADDR OR AREA IN RIT
         L     R4,0(0,R14)         GET ADDR OF FIRST REAL PFTE
         L     R5,4(0,R14)         GET ADDR OF LAST REAL PFTE
         SR    R5,R4               GET DIFFERENCE
         SRL   R5,5                GET # ENTRIES
         LA    R5,1(0,R5)          ADD IN LAST ONE
         STM   R4,R5,PFTREGS       SAVE REGS OF PFT
*
**       GET TOTAL FRAMES
*
         LR    R14,R5              PUT IN PROPER AREA
         MVC   OUTMSG+4(12),=CL12'TOTAL'
         L     R2,=F'-1'
         BAL   R11,PGPRINT         GO PRINT
*
**       GET NUCLEUS FRAMES
**          = GDAESQA - (GDASQA + GDASQASZ)
*
         L     R14,16              LOAD CVT ADDR
         L     R4,560(0,R14)       GET GDA ADDRESS
         L     R14,152(0,R4)       GET GDAESQA
         L     R15,144(0,R4)       GET GDASQA
         A     R15,148(0,R4)       GDASQA + GDASQASZ
         SR    R14,R15             SIZE OF NUCLEUS
         SRL   R14,12              GET NUMBER OF FRAMES
         MVC   OUTMSG+4(12),=CL12'NUCLEUS'
         L     R2,=F'-1'
         BAL   R11,PGPRINT         GO PRINT
*
**       CYCLE PFT FOR INTERESTING SYSTEM COUNTS
*
         L     R10,=X'0000FFFF'
         BAL   R11,PAGEPRNT        GO COUNT AND FORMAT
         LR    R4,R2               SAVE VALUES
         LR    R5,R14              AND AGAIN
*
**       TOTAL FIXED  (R3 VALUE)
*
         MVC   OUTMSG+4(12),=CL12'TOT FIXED'
         LR    R14,R3              PUT IN PROPER REG
         L     R2,=F'-1'
         BAL   R11,PGPRINT         GO PRINT
*
**       TOTAL SQA FIXED (R8 VALUE)
*
         MVC   OUTMSG+4(12),=CL12'SQA FIXED'
         LR    R14,R8              PUT IN PROPER REG
         L     R2,=F'-1'
         BAL   R11,PGPRINT         GO PRINT
*
**       TOTAL SYSTEM (R14 VALUE NOW IN R5)
*
         MVC   OUTMSG+4(12),=CL12'SYS PAGES'
         LR    R14,R5              PUT IN PROPER REG
         L     R2,=F'-1'
         BAL   R11,PGPRINT         GO PRINT
*
**       TOTAL SQA    (R2 VALUE NOW IN R4)
*
         MVC   OUTMSG+4(12),=CL12'TOTAL SQA'
         LR    R14,R4              PUT IN PROPER REG
         L     R2,=F'-1'
         BAL   R11,PGPRINT         GO PRINT
*
**       TOTAL AVAIL  (R9 VALUE)
*
         MVC   OUTMSG+4(12),=CL12'AVAILABLE'
         LR    R14,R9              PUT IN PROPER REG
         L     R2,=F'-1'
         BAL   R11,PGPRINT         GO PRINT
*
**       NOW START EACH ASCB
*
         L     R2,XSASAVE
         MVC   OUTMSG+4(10),=CL12' '
         MVC   OUTMSG+14(56),=CL56'    TOTAL        FIXED         LSQA X
               FXD LSQA    '
         BAL   R11,PRINT           PRINT HEADER
GETASCB  LA    R6,4(0,R6)          NEXT SLOT
         BCT   R7,ASCBFND          GO PROCESS
         SPACE 3
RETURN   EQU   *
         ESTAE 0
         LA    R15,*+6             GET ADDRESS
         BSM   0,R15               CHANGE MODES
         L     R0,SIZE
         LR    R1,R13              WORK AREA ADDR
         L     R14,SAVRET          LOAD RETURN ADDR
         FREEMAIN  R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         SPACE 3
ASCBFND  TM    0(R6),X'80'         AVAILABLE SLOT
         BO    GETASCB             YES, GET NEXT SLOT
         L     R8,0(0,R6)          LOAD ASCB ADDR
         SR    R10,R10             LOAD
         ICM   R10,3,36(R8)        ASID
         BAL   R11,PAGEPRNT        GO COUNT AND FORMAT
         L     R2,XSASAVE
         B     GETASCB
PAGEPRNT LM    R4,R5,PFTREGS       LOAD PFT REGS
         SR    R14,R14             CLEAR FRAME COUNT
         SR    R2,R2               CLEAR LSQA/SQA COUNT
         SR    R9,R9               CLEAR AVAILABLE FRAME COUNT
         SR    R3,R3               CLEAR FIXED FRAME COUNT
         SR    R8,R8               CLEAR FIXED & SQA FRAME COUNT
         SPACE 3
PAGEPR1  SR    R15,R15             LOAD
         ICM   R15,3,18(R4)        PFT ASID
         TM    10(R4),X'80'        AVAILABLE PAGE
         BO    AVAILCNT            GO ADD TO AVAILABLE COUNT
         CR    R10,R15             ASID MATCH
         BNE   PAGEPR2A            NO, DONT INCR FRAME COUNT
         LA    R14,1(0,R14)        ADD 1 TO FRAME COUNT
         CLI   8(R4),X'82'         IS IT ALSO FIXED
         BNE   PAGEPR1A            SKIP IF NOT FIXED
         LA    R3,1(0,R3)          ADD 1 TO FIXED FRAME COUNT
PAGEPR1A TM    10(R4),X'10'        LSQA FRAME
         BZ    PAGEPR2             NO
         LA    R2,1(0,R2)          ADD 1 T0 LSQA FRAME COUNT
         CLI   8(R4),X'82'         IS IT ALSO FIXED
         BNE   PAGEPR2             IF NOT DONE
         LA    R8,1(0,R8)          ADD 1 TO FIXED & LSQA COUNT
         B     PAGEPR2             GO TO NEXT ENTRY
         SPACE 3
PAGEPR2A C     R10,=X'0000FFFF'    IS THIS THE SYSTEM
         BNE   PAGEPR2             IF NOT THEN SKIP OTHER FIXED
         CLI   8(R4),X'82'         IS THIS FIXED
         BNE   PAGEPR2             SKIP IF NOT FIXED
         LA    R3,1(0,R3)          ADD 1 TO TOTAL FIXED FRAME COUNT
         SPACE 3
PAGEPR2  LA    R4,32(0,R4)         NEXT PFT
         BCT   R5,PAGEPR1          PROCESS NEXT
         MVC   OUTMSG+4(12),=CL12'ASID'
         C     R10,=X'00000001'    MASTER
         BE    ASIDMSTR            YES, GO PRINT MASTER
         C     R10,=X'0000FFFF'    SYS PAGES
         BNE   PAGEPR3             NO, ASID
         BR    R11                 OUT IF SYSTEM
         SPACE 3
*
**       START FORMATING FOR ASID  -  NOTE:
**             R14 - TOTAL PAGES OWNED
**             R3  - TOTAL FIXED FRAMES OWNED
**             R2  - TOTAL LSQA FRAMES OWNED
**             R8  - TOTAL LSQA FIXED FRAMES
*
PAGEPR3  LTR   R14,R14             ANY FRAMES
         BZR   R11                 NO, BYPASS PRINT
         STH   R10,DOUBLE+6        SAVE ASID
         UNPK  DOUBLE(5),DOUBLE+6(3)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   OUTMSG+9(4),DOUBLE  ASID TO MSG
         SPACE 3
PAGEPR4  CVD   R14,DOUBLE
         MVC   OUTMSG+15(5),=X'2020202120'
         ED    OUTMSG+14(6),DOUBLE+5
         CLC   OUTMSG+4(4),=C'ASID'
         BE    JOBFIND
PGPRINT  DS    0H
         LA    R1,OUTMSG+13        POINT AT PLACE TO PUT IT
         BAL   R15,FORMNUM         FORMAT TOTAL PAGES
         LTR   R2,R2               TOP LINES INDICATOR ON
         BM    PRINT               IF YES BRANCH
         LR    R14,R3              GET NUMBER TO FORMAT
         LA    R1,OUTMSG+26        AND PLACE TO PUT IT
         BAL   R15,FORMNUM         FORMAT TOTAL FIXED FRAMES
         LR    R14,R2              GET NUMBER TO FORMAT
         LA    R1,OUTMSG+39        AND PLACE TO PUT IT
         BAL   R15,FORMNUM         FORMAT TOTAL LSQA FRAMES
         LR    R14,R8              GET NUMBER TO FORMAT
         LA    R1,OUTMSG+52        AND PLACE TO PUT IT
         BAL   R15,FORMNUM         FORMAT TOTAL FIXED LSQA FRAMES
         SPACE 3
PRINT    LA    R1,OUTMSG
         SR    R0,R0
         L     R2,XSASAVE
         IC    R0,XAU
         SVC   35
         BR    R11
         SPACE 3
FORMNUM  MVC   0(13,R1),=XL13'402020202120402020202120D2'
         CVD   R14,DOUBLE          MAKE FRAME COUNT DECIMAL
         ED    0(6,R1),DOUBLE+5    AND PUT IN MESSAGE
         SLL   R14,2               GET K FROM FRAMES
         CVD   R14,DOUBLE2         MAKE K COUNT DECIMAL
         ED    6(6,R1),DOUBLE2+5   AND PUT IN MESSAGE
         MVI   6(R1),C'/'          SET PROPER CHAR
         BR    R15
         SPACE 3
AVAILCNT LA    R9,1(0,R9)          ADD 1 TO COUNT
         B     PAGEPR2
         SPACE 3
ASIDMSTR MVC   OUTMSG+4(12),=CL12'MASTER'
         B     PAGEPR4
         SPACE 2
JOBFIND  EQU   *
         L     R15,0(0,R6)         LOAD ASCB ADDR
         L     R15,56(0,R15)       CSCB ADDR
         CLI   28(R15),X'03'       INIT
         BE    JOBFIND1            YES, GO SEARCH
         SPACE
JOBFIND0 MVC   OUTMSG+4(8),8(R15)  JOBNAME
         MVI   OUTMSG+12,C' '
         B     PGPRINT
         SPACE
JOBFIND1 LA    R1,0(0,R15)         SAVE ADDR
         SR    R14,R14             LOAD
         ICM   R14,3,30(R15)       ASID
         SPACE
JOBFIND2 L     R15,0(0,R15)        NEXT CSCB
         LA    R15,0(0,R15)
         LTR   R15,R15             END OF CHAIN
         BNZ   JOBFIND3            NO, CONTINUE
         LR    R15,R1              USE ORIG CSCB
         B     JOBFIND0
         SPACE
JOBFIND3 CR    R15,R1              END OF CHAIN
         BE    JOBFIND0            YES, USE ORIG CSCB
         CH    R14,30(0,R15)       ASID EQUAL
         BE    JOBFIND0            YES, USE THIS CSCB
         B     JOBFIND2
VONONE   LA    R1,VOMSG            NO OFFLINE INTERCEPT MSG
         LA    R11,RETURN
         B     PRINT
         SPACE 3
VBNONE   LA    R1,VBMSG            NO BAD FRAMES MSG
         LA    R11,RETURN
         B     PRINT
         SPACE 3
VRDISP   MVI   VRSWIT,X'F0'        SET HDR SWITCH
         MVC   OUTMSG(20),VRHDR1   SET 1ST HDR
         BAL   R11,VRDISP5D        GO WTO IT
         MVC   OUTMSG(20),VRHDR2   SET 2ND HDR
         BAL   R11,VRDISP5D        GO WTO IT
         MVI   VRSWIT,X'00'        CLEAR HDR SWITCH
         L     R14,16              CVT ADDR
         L     R3,356(0,R14)       PVT ADDR
         L     R14,560(0,R14)      GDA ADDRESS
         L     R4,8(0,R3)          GET ADDR OF AREA IN RIT
         L     R4,0(R4)            GET PFT ORIGIN
         L     R15,192(0,R14)      V=R START ADDRESS FROM GDA
         SRL   R15,12-5            GET PAGE NUMBER * 32
         AR    R4,R15              GET PFTE ADDRESS
         L     R5,196(0,R14)       V=R SIZE FROM GDA
         SRL   R5,12               GET NUMBER OF PAGES
         MVI   VRSWIT,X'00'        CLEAR V=R END SWITCH
         MVC   OUTMSG(20),VRMSG    SET UP V=R MSG BASE
         B     VRDISP3             GO PROCESS
         SPACE 3
VRDISP1  CLI   VOSWIT,X'00'        OFFLINE INTERCEPT REQUEST
         BE    VRDISP1A            NO
         TM    11(R4),X'08'        OFFLINE INTERCEPT FLAG BIT ON
         BNO   VRDISP2O            NO, NEXT PFTE
         SPACE 3
VRDISP1A CLI   VBSWIT,X'00'        BAD FRAME REQUEST
         BE    VRDISP1O            NO
         TM    9(R4),X'01'         BAD FRAME FLAG BIT ON
         BNO   VRDISP2O            NO, NEXT PFTE
         SPACE 3
VRDISP1O CLC   18(2,R4),VRASID     ASID MATCH
         BNE   VRDISP4             NO, GO FORMAT AND PRINT
         CLC   8(4,R4),VRFLAGS     FLAGS MATCH
         BNE   VRDISP4             NO, GO FORMAT AND PRINT
         SPACE 3
VRDISP2  L     R14,VRNUM           ADD 1
         LA    R14,1(0,R14)        TO EQUAL
         ST    R14,VRNUM           ENTRY COUNT
         SPACE 3
VRDISP2O LA    R4,32(0,R4)         NEXT PFTE
         BCT   R5,VRDISP1
         MVI   VRSWIT,X'FF'        SET END OF V=R SWITCH
         B     VRDISP4             GO FORMAT AND PRINT LAST
         SPACE 3
VRDISP3  XC    VRNUM(4),VRNUM      CLEAR COUNT
         MVC   VRASID(2),18(R4)    SET ASID
         MVC   VRFLAGS(4),8(R4)    SET FLAGS
         B     VRDISP2
VRDISP4  L     R14,VRNUM           NO. OF FRAMES
         CVD   R14,DOUBLE          DECIMAL
         UNPK  OUTMSG+4(3),DOUBLE+6(2)
         OI    OUTMSG+6,X'F0'
         UNPK  DOUBLE(5),VRASID(3)  TRANSLATE ASID
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   OUTMSG+10(4),DOUBLE  PUT ASID IN MSG
         SPACE 3
VRDISP5A MVI   OUTMSG+17,C'O'      OFFLINE
         TM    VRFLAGS+2,X'20'
         BO    VRDISP5B
         MVI   OUTMSG+17,C'C'      OFFLINE INTERCEPT
         TM    VRFLAGS+3,X'08'
         BO    VRDISP5B
         MVI   OUTMSG+17,C'R'      V=R ALLOCATED
         TM    VRFLAGS+2,X'04'
         BO    VRDISP5B
         MVI   OUTMSG+17,C'I'      V=R INTERCEPT
         TM    VRFLAGS+3,X'10'
         BO    VRDISP5B
         MVI   OUTMSG+17,C'A'      AVAILABLE
         TM    VRFLAGS+2,X'80'
         BO    VRDISP5B
         MVI   OUTMSG+17,C'-'      NO STATUS
         SPACE 3
VRDISP5B MVI   OUTMSG+18,C'B'      BAD PAGE
         TM    VRFLAGS+1,X'01'
         BO    VRDISP5C
         MVI   OUTMSG+18,C'F'      LONG TERM FIXED
         TM    VRFLAGS+3,X'40'
         BO    VRDISP5C
         MVI   OUTMSG+18,C'S'      LSQA/SQA PAGE
         TM    VRFLAGS+2,X'10'
         BO    VRDISP5C
         MVI   OUTMSG+18,C'V'      VIO PAGE
         TM    VRFLAGS+3,X'20'
         BO    VRDISP5C
         MVI   OUTMSG+18,C'-'      NO STATUS
VRDISP5C MVI   OUTMSG+19,C'A'      AVAILABLE
         TM    VRFLAGS,X'FF'
         BZ    VRDISP5D
         MVI   OUTMSG+19,C'N'      NOT QUEUED
         TM    VRFLAGS,X'F0'
         BO    VRDISP5D
         MVI   OUTMSG+19,C'S'      SQA
         CLI   VRFLAGS,X'21'
         BO    VRDISP5D
         MVI   OUTMSG+19,C'R'      SQA RESERVED
         CLI   VRFLAGS,X'22'
         BO    VRDISP5D
         MVI   OUTMSG+19,C'-'      NO STATUS
         SPACE 3
VRDISP5D LA    R1,OUTMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         TM    VRSWIT,X'FF'        TEST HDR/END SWITCH
         BO    RETURN              END
         BCR   4,R11               HDR
         B     VRDISP3
VBDISP   MVI   VBSWIT,X'FF'        SET BAD FRAME ONLY SW
         B     VVDISP
         SPACE 3
VODISP   MVI   VOSWIT,X'FF'        SET OFFLINE INTERCEPT ONLY SW
         SPACE 3
VVDISP   MVI   VRSWIT,X'F0'        SET HDR SWITCH
         MVI   DOUBLE,X'F0'        TEST
         MVZ   DOUBLE(1),1(R3)     NUMERIC
         CLI   DOUBLE,X'F0'        MEGABYTE NUMBER
         BNE   VVDISP1             NOT NUMERIC, ERROR
         MVC   OUTMSG(20),VRHDR1   1ST HDR
         BAL   R11,VRDISP5D
         MVC   OUTMSG(20),VRHDR2   2ND HDR
         BAL   R11,VRDISP5D
         MVI   VRSWIT,X'00'        CLEAR HDR SWITCH
         MVC   OUTMSG(20),VRMSG    BASE MSG
         B     VVDISP2
VVDISP1  LA    R11,RETURN          PARM
         LA    R1,ERRMSG           ERROR
         B     PRINT
         SPACE 3
VVDISP2  IC    R5,1(0,R3)          CALCULATE
         SLL   R5,28               PFTE INDEX
         SRL   R5,15               TO THIS MEG
         LTR   R5,R5               ZERO MEG
         BZ    VVDISP1             YES, ERROR
         L     R14,16              CVT ADDR
         L     R3,356(0,R14)       PVT ADDR
         L     R14,8(0,R3)         GET ADDR OF AREA IN RIT
         L     R4,0(R14)           GET PFT ORIGIN
         L     R14,4(R14)          GET LAST PTFE ADDRESS
         AR    R4,R5               PFT MEG START ADDR
         CR    R4,R14              Q. PAST END OF PFT
         BH    VVDISP1             YES, ERROR
         LA    R5,256              NO. OF FRAMES IN | MEG
         CLI   VOSWIT,X'00'        OFFLINE INTERCEPT REQUEST
         BNE   VODISP1             YES, CONTINUE PROCESS
         CLI   VBSWIT,X'00'        BAD FRAME REQUEST
         BNE   VBDISP1             YES, CONTINUE PROCESS
         B     VRDISP3             GO PROCESS
         SPACE 3
VODISP1  TM    11(R4),X'08'        OFFLINE INTERCEPT FLAG BIT ON
         BO    VRDISP3             YES, GO CONTINUE PROCESS
         LA    R4,32(0,R4)         NEXT PFTE
         BCT   R5,VODISP1          GO CHECK NEXT
         B     VONONE              NO INTERCEPT OFFLINE, GO MSG
         SPACE 3
VBDISP1  TM    9(R4),X'01'         BAD FRAME BIT ON
         BO    VRDISP3             YES, GO CONTINUE PROCESS
         LA    R4,32(0,R4)         NEXT PFTE
         BCT   R5,VBDISP1          GO CHECK NEXT
         B     VBNONE              NO INTERCEPT OFFLINE, GO MSG
*
**       DISPLAY THE CURRENT CSA STATUS AND ALLOCATED/FREED PARTS
*
VCDISP   L     R1,16               CVT
         L     R3,356(0,R1)        LOAD PVT ADDR
         L     R6,560(0,R1)        GDA
         L     R4,104(0,R6)        LAST FBQE FOR CSA
         L     R5,100(0,R6)        1ST FBQE FOR CSA
         SR    R7,R7
         CR    R4,R5               LAST IN CHAIN
         BE    VCDISPB             YES
         SPACE 1
VCDISPA  A     R7,8(0,R5)          ADD FREE AREA
         L     R5,0(0,R5)          NEXT FBQE
         CR    R4,R5               END OF CHAIN
         BNE   VCDISPA             NO
VCDISPB  A     R7,8(0,R4)          ADD FREE AREA OF LAST
         SPACE 1
         MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(14),=CL14'CSA SIZE ='
         L     R1,112(0,R6)        CSA SIZE
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+18(8),=X'402020212020D240'
         ED    CSADISP+18(6),DOUBLE+5
         MVC   CSADISP+25(17),=CL17'     CSA ADDR ='
         UNPK  CSADISP+42(9),108(5,R6)
         NC    CSADISP+42(8),=8X'0F'
         TR    CSADISP+42(8),=C'0123456789ABCDEF'
         MVC   CSADISP+50(2),=CL2' '
         LA    R1,CSADISP
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         SPACE 1
         MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(14),=CL14'ECSA SIZE ='
         L     R1,128(0,R6)        ECSA SIZE
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+18(8),=X'402020212020D240'
         ED    CSADISP+18(6),DOUBLE+5
         MVC   CSADISP+25(17),=CL17'    ECSA ADDR ='
         UNPK  CSADISP+42(9),124(5,R6)
         NC    CSADISP+42(8),=8X'0F'
         TR    CSADISP+42(8),=C'0123456789ABCDEF'
         MVC   CSADISP+50(2),=CL2' '
         LA    R1,CSADISP
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(14),=CL14'SQA FREE ='
         L     R1,132(0,R6)        SQA+CSA AVAIL
         SR    R1,R7               SUBTRACT CSA
         BP    *+6                 IF NOT NEGATIVE, BYPASS
         SR    R1,R1
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+18(8),=X'402020212020D240'
         ED    CSADISP+18(6),DOUBLE+5
         MVC   CSADISP+25(17),=CL17'    SQA AVAIL ='
         L     R1,148(0,R6)        SQA AVAIL
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+41(8),=X'402020212020D240'
         ED    CSADISP+41(6),DOUBLE+5
         MVC   CSADISP+49(3),=CL4' '
         LA    R1,CSADISP
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         STM   R4,R5,VCSASAV
         SPACE 1
VCDISPD  MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(14),=CL14'V=R SIZE ='
         L     R1,196(0,R6)        V=R SIZE
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+18(8),=X'402020212020D240'
         ED    CSADISP+18(6),DOUBLE+5
         MVC   CSADISP+25(17),=CL17'     V=R ADDR ='
         UNPK  CSADISP+42(9),192(5,R6)
         NC    CSADISP+42(8),=8X'0F'
         TR    CSADISP+42(8),=C'0123456789ABCDEF'
         MVC   CSADISP+50(2),=CL2' '
         LA    R1,CSADISP
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(14),=CL14'PRV SIZE ='
         L     R1,164(0,R6)        PRIVATE AREA SIZE
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+18(8),=X'402020212020D240'
         ED    CSADISP+18(6),DOUBLE+5
         MVC   CSADISP+25(17),=CL17'     PRV ADDR ='
         UNPK  CSADISP+42(9),160(5,R6)
         NC    CSADISP+42(8),=8X'0F'
         TR    CSADISP+42(8),=C'0123456789ABCDEF'
         MVC   CSADISP+50(2),=CL2' '
         LA    R1,CSADISP
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         SPACE 1
*
**       SAVE INFOR FOR CSA ALLOCATED/FREED BLOCKS
*
         LA    R8,100(0,R6)        POINT AT CSA DESCRIPTOR
*                             (1ST FBQE,LASTFBQE,ADDR,SIZE)
         BAL   R3,VCDISP0          DISPLAY CSA BLOCKS
         LA    R8,116(0,R6)        POINT AT ECSA DESCRIPTOR
*                             (1ST FBQE,LASTFBQE,ADDR,SIZE)
         BAL   R3,VCDISP0          DISPLAY CSA BLOCKS
         B     RETURN
*
**       PRINT ALLOCATED/FREED SEGMENT ADDRESSES
**       ON ENTRY R8 ->  +0 ADDR OF FIRST FBQE
**                       +4 ADDR OF LAST FBQE
**                       +8 LOWEST ADDRESS OF AREA
**                       +12 SIZE OF AREA
*
VCDISP0  L     R5,0(0,R8)          GET FIRST AND LAST FBQE
         LA    R4,0(0,R8)          GET VALUE OF LAST POINTER
         L     R1,8(R8)            GET LOWEST ADDR
         C     R1,12(0,R5)         1ST CHUNK FREE
         BE    VCDISP1             YES
         L     R14,12(0,R5)        1ST FREE AREA ADDR
         B     VCDISP3             GO PROCESS ALLOCATED CHUNK
         SPACE 1
VCDISP1  CR    R4,R5               END OF FBQES
         BER   R3                  YES
         MVC   CSADISP(4),=X'00340100'
         L     R1,8(0,R5)          FREE AREA SIZE
         SRL   R1,10               DIVIDE BY 1K
         CVD   R1,DOUBLE
         MVC   CSADISP+4(30),=CL30'FREE        SIZE='
         MVC   CSADISP+34(9),=CL9'ADDR ='
         MVC   CSADISP+22(8),=X'402020202120D240'
         ED    CSADISP+22(6),DOUBLE+5
         UNPK  CSADISP+42(9),12(5,R5)
         NC    CSADISP+42(8),=8X'0F'
         TR    CSADISP+42(8),=C'0123456789ABCDEF'
         MVC   CSADISP+50(2),=CL2' '
         LA    R1,CSADISP
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         L     R1,OUTMSLIM
         LA    R1,1(0,R1)
         ST    R1,OUTMSLIM
         C     R1,=F'100'          200 +  LINES OF OUTPUT
         BH    RETURN              YES, THATS ALL.  AVOID SQA FILL
VCDISP2  L     R1,12(0,R5)         FREE AREA ADDR
         A     R1,8(0,R5)          ADD FREE AREA LENGTH
         L     R5,0(0,R5)          NEXT FBQE
         CR    R4,R5               END OF FBQES
         BE    VCDISP4             YES
         L     R14,12(0,R5)        NEXT FREE AREA ADDR
         SPACE 3
VCDISP3  SR    R14,R1
         SRL   R14,10              USED AREA LENGTH
         CVD   R14,DOUBLE
         ST    R1,DOUBLE           USED AREA ADDR
         MVC   CSADISP(4),=X'00340100'
         MVC   CSADISP+4(30),=CL30'ALLOCATED   SIZE='
         MVC   CSADISP+34(9),=CL9'ADDR ='
         MVC   CSADISP+22(8),=X'402020202120D240'
         ED    CSADISP+22(6),DOUBLE+5
         UNPK  CSADISP+42(9),DOUBLE(5)
         NC    CSADISP+42(8),=8X'0F'
         TR    CSADISP+42(8),=C'0123456789ABCDEF'
         MVC   CSADISP+50(2),=CL2' '
         LA    R1,CSADISP
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     VCDISP1
         SPACE  3
VCDISP4  L     R14,8(0,R8)         START ADDRESS
         A     R14,12(0,R8)        ADD LENGTH OF BLOCK
         B     VCDISP3
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC  SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX  MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2)  MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19  SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                 GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8)  GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,  GLA-BFG          X
               RECORD=YES,RECPARM=(3),REGS=(14,12)  GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESF03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     RETURN
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
ERRMSG   DC    X'001C0100'
         DC    CL24'PARAMETER ERROR'
         SPACE 3
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
         DS    0F
VRHDR1   DC    X'00140100'
         DC    CL16'PAGES.ASID.FLAGS'
         SPACE 3
         DS    0F
VRHDR2   DC    X'00140100'
         DC    16C'-'
         SPACE 3
         DS    0F
VRMSG    DC    X'00140100'
         DC    CL16'   ...    ...   '
         SPACE 3
         DS    0F
VBMSG    DC    X'00220100'
         DC    CL30'NO BAD FRAMES'
         SPACE 3
         DS    0F
VOMSG    DC    X'00220100'
         DC    CL30'NO FRAMES INTERCEPTED OFFLINE'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
DOUBLE2  DS    2F
VCSASAV  DS    2F
XSASAVE  DS    F
PFTREGS  DS    2F
VRNUM    DS    F
VRASID   DS    H
VRFLAGS  DS    CL4
VRSWIT   DS    C
VOSWIT   DS    C
VBSWIT   DS    C
         DS    0F
OUTMSG   DS    74C
         SPACE 1
         DS    0F
CSADISP  DS    CL52
OUTMSLIM DS    F
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSG03D
         TITLE 'XA1SG03D -   #R  DISPLAY DEVICE INTERVENTION REQUIRED'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESG03D -       #R  DISPLAY DEVICE INTERVENTION REQUIRED ***
***                                                                 ***
***       VERSION -        3.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/XA 2.1.1                             ***
***                                                                 ***
***       UPDATED -        07/21/81   AXC-CBT HANDLE ESTAE          ***
***                        11/09/82   CBT: ENHANCED WITH SP3        ***
***                                     SUPPORT VIA GQSCAN          ***
***                        02/07/84   JAL-SNET UCB SCAN ROUTINE     ***
***                                       MODIFIED FOR XA.          ***
***                        04/26/86   GLA-BFG FIX REENTRANCY        ***
***                                       AND ESTAE                 ***
***********************************************************************
***********************************************************************
*    R1
*    R2   -  BASE REG FOR XSA AREA
*    R3
*    R4   -  UCB + CVT CNTL BLKS
*    R5   -  UCB SEARCHING
*    R6   -  UCB WORK REG + PRINTING
*    R7
*    R8   -  A TEMPORARY WORK AREA
*    R9   -  FOR RIB DSECT
*    R10  -  ESTAE
*    R11
*    R12  -  BASE REG
*    R13  -  GETMAIN AREA
*    R14  -  JOBFIND CODE + WORK2 ADDRESSING, WTO
*    R15  -  JOBFIND CODE
*****************************************************************
IEESG03D CSECT
         LR    R12,R15
         USING IEESG03D,R12
         L     R0,WORK1SIZ   SIZE OF WORK AREA 1
         LA    R13,WORK2SIZ  SIZE OF WORK AREA 2
         AR    R0,R13          GET TOTAL WORK AREA SIZE
         O     R0,SUB241     SUBPOOL MASK
         A     R0,=F'00102400'   ADD IN SCANAREA SIZE
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK1,R13
         ST    R14,SAVRET          SAVE RETURN ADDRESS
         ST    R2,XSASAVE
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         LA    R4,UCBTAB
         LA    R5,4000
         LA    R6,=CL8' '
         L     R7,CLEAR
         MVCL  R4,R6               CLEAR UCBTAB TO BLANKS
         L     R4,16               CVT
         SR    R5,R5
         MVI   TYPE,C'M'           SET DEFAULT OF TAPE MOUNTS
         MVI   DEVCLASS,X'80'      SET DEFAULT OF TAPE UCBS    -JAL/XA-
         L     R3,XAL              LOAD PARM ADDRESS
         LTR   R3,R3               ANY PARM SPECIFIED
         BZ    UCBLOOP             NO, USE DEFAULT
         MVC   TYPE(10),0(R3)      SET TYPE FROM PARM
         CLI   TYPE,C'T'           TAPE
         BE    UCBLOOP              YES, GO DO UCB SCAN        -JAL/XA-
         CLI   TYPE,C'D'           DISK
         BNE   URCHK                NO, KEEP ON CHECKING       -JAL/XA-
         MVI   DEVCLASS,X'20'       YES, SET FOR DISK UCBS ONLY-JAL/XA-
         B     UCBLOOP             GO DO UCB SCAN              -JAL/XA-
URCHK    DS    0H                                              -JAL/XA-
         CLI   TYPE,C'P'           UNIT RECORD
         BNE   UNITCHK              NO, KEEP ON CHECKING       -JAL/XA-
         MVI   DEVCLASS,X'08'       YES, SET FOR UR UCBS ONLY  -JAL/XA-
         B     UCBLOOP             GO DO UCB SCAN              -JAL/XA-
UNITCHK  DS    0H                                              -JAL/XA-
         MVI   DEVCLASS,X'00'      SET DEFAULT TO ALL UCBS     -JAL/XA-
         CLI   TYPE,C'U'           UNIT=
         BE    UCBLOOP
         CLI   TYPE,C'S'           VOLSER=
         BE    UCBLOOP
         CLI   TYPE,C'B'           BOTH
         BE    UCBLOOP             GO DO UCB SCAN              -JAL/XA-
         CLI   TYPE,C'V'           VARIED
         BE    UCBLOOP
         CLI   TYPE,C'R'           RESERVE SEARCH
         BE    RESERVE
         MVI   TYPE,C'M'           TAPE MOUNTS
         MVI   DEVCLASS,X'80'      SET DEFAULT OF TAPE UCBS    -JAL/XA-
UCBLOOP  DS    0H                                              -JAL/XA-
         XC    UCBWORK,UCBWORK     CLEAR UCB WORK AREA         -JAL/XA-
         LA    R1,UCBWORK          LOAD ADDRESS OF UCB WORKAREA-JAL/XA-
         ST    R1,PARMWA           STORE IT IN PARMLIST        -JAL/XA-
         LA    R1,DEVCLASS         LOAD ADDRESS OF DEVICE CLASS-JAL/XA-
         ST    R1,PARMDEVT         STORE IT IN PARMLIST        -JAL/XA-
         LA    R1,ADDRUCB          LOAD ADDRESS OF UCB POINTER -JAL/XA-
         ST    R1,PARMUCB          STORE IT IN PARMLIST        -JAL/XA-
         MVI   PARMUCB,X'80'       INDICATE END OF PARM LIST   -JAL/XA-
UCBLOOP1 DS    0H                                              -JAL/XA-
         L     R15,1076(0,R4)      GET ADDRESS OF UCB SCAN RTN -JAL/XA-
         LA    R1,PARMLIST         LOAD ADDR OF PARMLIST       -JAL/XA-
         BALR  R14,R15             GO GET A UCB                -JAL/XA-
         LTR   R15,R15             UCB RETURNED                -JAL/XA-
         BNZ   PRINT                NO, GO PRINT RESULTS       -JAL/XA-
UCBLOOP2 DS    0H                                              -JAL/XA-
         L     R5,ADDRUCB          LOAD ADDR OF UCB            -JAL/XA-
         MVI   ASIDSW,X'00'        CLEAR ASID SEARCH SW
         CLI   TYPE,C'V'
         BE    UCBLOOPV
         TM    3(R5),X'88'         ONLINE AND ALLOCATED
         BNO   UCBLOOP1            NO, GET NEXT
         CLI   TYPE,C'D'           DISK
         BE    UCBLOOPD
         CLI   TYPE,C'T'           TAPE
         BE    UCBLOOPT
         CLI   TYPE,C'P'           UNIT RECORD
         BE    UCBLOOPP
         CLI   TYPE,C'U'           UNIT=
         BE    UCBLOOPU
         CLI   TYPE,C'S'           VOLSER=
         BE    UCBLOOPS
         CLI   TYPE,C'M'           MOUNTS
         BE    UCBLOOPM
         B     UCBLOOP3            ASSUME BOTH
UCBLOOPD TM    18(R5),X'20'        DISK
         BZ    UCBLOOP1            NO, GET NEXT
         B     UCBLOOP3
         SPACE 3
UCBLOOPT TM    18(R5),X'80'        TAPE
         BZ    UCBLOOP1            NO, GET NEXT
         B     UCBLOOP3
         SPACE 3
UCBLOOPP TM    18(R5),X'08'        UNIT RECORD
         BZ    UCBLOOP1
         B     UCBLOOP3
         SPACE 3
UCBLOOPU MVI   ASIDSW,X'F0'        FORCE PRINT
         CLC   TYPE+2(3),13(R5)    UNIT MATCH
         BE    UCBLOOP4
         CLI   TYPE+4,C' '         UNIT COMPARE
         BNE   UCBLOOP1            YES, NO MATCH
         CLC   TYPE+2(2),13(R5)    CONTROL UNIT MATCH
         BE    UCBLOOP4
         CLI   TYPE+3,C' '         CONTROL UNIT COMPARE
         BNE   UCBLOOP1            YES, NO MATCH
         CLC   TYPE+2(1),13(R5)    CHANNEL MATCH
         BE    UCBLOOP4
         B     UCBLOOP1
         SPACE 3
UCBLOOPS MVI   ASIDSW,X'F0'        FORCE PRINT
         CLC   TYPE+2(6),28(R5)    VOLSER MATCH
         BNE   UCBLOOP1
         B     UCBLOOP4
         SPACE 3
UCBLOOPM TM    18(R5),X'80'        TAPE
         BZ    UCBLOOP1
         TM    6(R5),X'40'         NOT READY
         BZ    UCBLOOP1
         TM    34(R5),X'01'        MOUNT MSG ISSUED
         BZ    UCBLOOP1
UCBLOOPV TM    3(R5),X'50'         VARIED OR UNLOADED
         BZ    UCBLOOP1            NO, GO GET NEXT
         MVI   ASIDSW,X'F0'        FORCE PRINT
         B     UCBLOOP4
         SPACE 3
UCBLOOP3 MVI   ASIDSW,X'FF'        SET ASID SEARCH SW
         CLI   TYPE+1,C'='         ASID DELIMITED SEARCH
         BE    UCBLOOP4
         MVI   ASIDSW,X'00'        CLEAR ASID SEARCH SW
         CLI   6(R5),X'00'         FLAGS ZERO
         BNE   UCBLOOP4            NO, GOT ONE
         TM    18(R5),X'20'        DISK
         BZ    UCBLOOP1            NO, NO RESERVE CHECK
         CLI   40(R5),X'00'        RESERVE
         BZ    UCBLOOP1            NO, GET NEXT
         SPACE 3
UCBLOOP4 LA    R6,UCBTAB           UCB TABLE
         LA    R7,100              MAX ENTRIES
         SPACE 3
UCBLOOP5 CLI   0(R6),X'40'         EMPTY SLOT
         BE    UCBLOOP7            YES, GO FILL IT
         CLC   0(3,R6),13(R5)      UCB ALREADY IN LIST
         BE    UCBLOOP1            YES, GET NEXT
         SPACE 3
UCBLOOP6 LA    R6,40(0,R6)         NEXT SLOT
         BCT   R7,UCBLOOP5
         B     PRINT
UCBLOOP7 L     R1,20(0,R5)         UCB EXTENSION ADDR
         UNPK  25(5,R6),14(3,R1)   ASID
         NC    25(4,R6),=8X'0F'
         TR    25(4,R6),=C'0123456789ABCDEF'
         MVI   29(R6),C' '
         MVC   22(3,R6),=C'AS='
         BAL   R11,JOBFIND         GO GET JOBNAME
         MVC   0(3,R6),13(R5)      UNIT NAME
         TM    18(R5),X'A0'        TAPE OR DISK
         BZ    *+10
         MVC   5(6,R6),28(R5)      VOLSER
         CLI   5(R6),X'FF'         PRIVAT MOUNT
         BNE   *+10                NO, BYPASS MOVE
         MVC   5(6,R6),=C'PRIVAT'  SET PRIVAT IN MSG
         CLI   5(R6),X'00'         ZERO VOLSER
         BNE   *+10                NO
         MVC   5(6,R6),=CL6'*MTP*'
         MVC   13(7,R6),=CL7'INT REQ'
         TM    6(R5),X'40'         NOT READY
         BO    UCBLOOP1            YES, GET NEXT
         MVC   13(7,R6),=CL7'BUSY'
         TM    6(R5),X'80'         BUSY
         BO    UCBLOOP1
         MVC   13(7,R6),=CL7'CU BUSY'
         TM    6(R5),X'08'         CONTROL UNIT BUSY
         BO    UCBLOOP1
         TM    18(R5),X'20'        DISK
         BZ    *+12
         CLI   36(R5),X'00'        RESERVE COUNT EQUAL ZERO
         BNE   UCBLOOP8
         MVC   13(7,R6),=CL7'ALLOC'
         TM    ASIDSW,X'F0'        PRINT FORCED
         BO    UCBLOOP1            YES
         MVI   0(R6),C' '          FORCE NO PRINT
         B     UCBLOOP1
         SPACE 3
UCBLOOP8 MVC   13(7,R6),=CL7'RSVD-'
         SR    R8,R8
         IC    R8,36(0,R5)         RESERVE COUNT
         CVD   R8,DOUBLE           SAVE RESERVE COUNT
         UNPK  18(2,R6),DOUBLE+6(2)
         OI    19(R6),X'F0'
         B     UCBLOOP1
********************************************************************
* THE FOLLOWING RESERVE CODE HAS BEEN CHANGED TO SUPPORT SP3
* VIA GRS AND CROSS MEMORY SERVICES
* GQSCAN IS UTILIZED TO RETRIEVE THE APPROPRIATE RIBS TO SCAN
* FOR RESERVE SETTINGS
********************************************************************
RESERVE  SR    R14,R14
         L     R14,WORK1SIZ  THE SIZE OF WORK AREA 1
         AR    R14,R13       ADD IN WORK AREA 1 ENTRY POINT
         USING WORK2,R14     TO ADDRESS TO WORK AREA 2
         MVC   TKN,=F'0'     ZERO OUT TOKEN
         MVC   RESVMSG(4),=X'00520100' WTO CONTROL CHARS
         MVI   RESVMSG+4,C' '
         MVC   RESVMSG+5(77),RESVMSG+4  CLEAR OUT THE OUTPUT AREA
         MVI   SWRES,X'00'   INITIALIZE THE RESERVE SWITCH
START    MVI   TKNSW,X'00'   INITIALIZE TOKEN SWITCH
         LA    R8,SCANAREA   ADDR OF RETURNED DATA
SCAN     GQSCAN AREA=((R8),102400),    ADDR + LEN OF INFO RETURNED     X
               REQLIM=MAX,   MAX NUM OF OWNERS TO BE RETURNED          X
               SCOPE=ALL,    ALL SYSTEMS IN GRS RING                   X
               RESERVE=YES,  ALL RESERVES                              X
               TOKEN=TKN,    TOKEN FUNCTION                            X
               MF=(E,GQSCANL)
         LA    R8,BRTABLE    ADDR OF BRANCH TABLE
         B     0(R15,R8)     BRANCH TO APPROPRIATE ROUTINE
BRTABLE  B     CODE00        LOOKS GOOD
         B     CODE04        NO RESOURCES MATCHED REQUEST
         B     CODE08        GQSCAN AREA TOO SMALL
         B     CODE0C        ENCOUNTERED ERROR DATA AREA NG
         B     CODE10        INVALID SYSNAME
CODE00   MVI   TKNSW,X'00'   INITIALIZE TOKEN SWITCH
RIBWORK  ST    R0,RIBLNGTH   STORE RIB + RIBE LENGTH
         LR    R8,R1         SAVE NUMBER OF RIBS
         MVI   SWRES,X'00'   ZERO OUT RESERVE SWITCH
         LA    R9,SCANAREA   ADDRESS OF GQSCAN AREA (1ST RIB)
         USING RIB,R9        RESOURCE INFORMATION BLOCK
RIBLOOP  L     R4,RIBNRIBE   # OF RIBE'S
*************NOW LOOK AT THE RIBVAR + RIBE FOR THE RESERVES
LOOKRIB  LR    R5,R9         RESOURCE INFO BLOCK
         AH    R5,RIBLNGTH   POINT TO RIB VARIABLE SECTION
         USING RIBVAR,R5     POINT TO RIB VAR SECTION
         SR    R6,R6         ZERO OUT REG
         IC    R6,RIBRNMLN   LENGTH OF MINOR NAME
         CH    R6,=H'20'     GTR 20 BYTES
         BNH   MOVEIT        NO, USE THE POSTED LENGTH
         LA    R6,20         YES, RESET THE LENGTH TO 20
MOVEIT   BCTR  R6,0          REDUCE LENGTH BY ONE
         EX    R6,MOVEMIN    MOVE IN THE MINOR NAME
LOOKRIBE EQU   *
         DROP  R5
         LR    R5,R9         RESOURCE INFORMATION BLOCK
         AH    R5,RIBLNGTH   POINT TO RIB VARIABLE SECTION
         AH    R5,RIBVLEN    ADD IN VAR SECTION LENGTH-GET TO EXTENT
NEXTRIBE EQU   *
         USING RIBE,R5       RESOURCE INFORMATION BLOCK
         TM    RIBERFLG,RIBERESV  IS THIS RESERVE REQUEST
         BC    1,RESMV       YES, MOVE IT TO OUTPUT AREA
         B     BUMPRIB       NO GO GET NEXT RIB
*******************************************************************
* THE FIRST RIBE WAS A RESERVE, SO PRINT IT OUT WITH ALL THE QUEUED
* RESOURCES WAITING
*******************************************************************
RESMV    MVC   RESVMSG+24(8),RIBQNAME  MOVE OUT MAJOR NAME
         MVI   SWRES,X'01'   TURN RESERVE SWITCH FOR THIS RIB
         MVC   RESVMSG+15(8),RIBEJBNM  JOBNAME OF REQUESTOR
******************************************************************
* GET UCB CONTROL BLOCK ADDRESS AND SEARCH THE CONTROL BLOCK
* FOR THE UCB (UNIT ADDRESS) AND VOL-SER ID NAME
******************************************************************
         L     R6,RIBEUCB    LOAD UCB ADDRESS
         LTR   R6,R6         SEE IF IT IS ZERO
         BC    8,BUMPRIB     NO ADDRESS MEANS NO RESERVE
         USING UCBCMSEG,R6   UCB CNTL BLK
         MVC   RESVMSG+4(3),UCBNAME    MOVE UCB ADDRESS
         MVC   RESVMSG+8(6),UCBVOLI    MOVE IN VOL SER
         MVC   RESVMSG+68(8),RIBESYSN REQUESTORS SYSTEM NAME
TESTSHR  TM    RIBERFLG,RIBETYPE  IS THIS EXCL OR SHARED
         BC    1,SHARED        YES
         MVC   RESVMSG+63(4),=C'EXCL'  EXCLUSIVE
         B     TESTCOM       TELL USER
SHARED   MVC   RESVMSG+63(4),=C'SHR '  SHR
TESTCOM  EQU   *
***********************************************************************
*   THE MUST COMPLETE IS CURRENTLY NOT BEING PRINTED OUT
***********************************************************************
*TESTCOM TM    RIBERFLG,RIBEMC    IS MUST COMPLETE                   **
*        BC    1,MUSTCOM       YES                                   **
*        MVI   RESVMSG+?,C' '   NO - LEAVE IT BLANK                  **
*        B     TESTGLOB      NEXT TEST                               **
*MUSTCOM EQU   *                                                     **
*        MVI   RESVMSG+?(5),C'MCOMP'  MOVE IT OUT                    **
***********************************************************************
***********************************************************************
TESTGLOB TM    RIBERFLG,RIBERESC  IS THIS RESERVE REQUEST GLOBAL
         BC    1,GLOBAL        YES
         MVC   RESVMSG+77(2),=C'NG' NO RESVE NOT CONVTED TO GLOBL ENTRY
         B     TESTOWN       NEXT TEST
GLOBAL   EQU   *
         MVC   RESVMSG+77(2),=C'GE' YES RESVE CONVERTED TO GLOBAL ENTRY
TESTOWN  TM    RIBESFLG,RIBESTAT  IS THIS THE OWNER
         BC    1,OWNER       YES
         MVC   RESVMSG+55(7),=C'WAITING'    NO, IT IS WAITING
         BAL   R6,RESVPRT    PUT IT OUT
         B     BUMPRIBE      GO TO NEXT RIBE
OWNER    EQU   *
         MVC   RESVMSG+56(5),=C'OWNER'      YES, FIRST ON CHAIN
         BAL   R6,RESVPRT    PUT IT OUT
         B     BUMPRIBE      GO TO NEXT RIBE
******************************************************************
* THIS SECTION IS USED TO BUMP TO THE NEXT RIB ON THE CHAIN
* THIS IS REQUESTED IF (1) THE FIXED PORTION OF RIB SHOWS
* NOTHING IS WAITING (EITHER EXCLUSIVE OR SHR) OR (2) THE 'FIRST'
* RIB EXTENSION DOES NOT SHOW A RESERVE
******************************************************************
BUMPRIB  SR    R3,R3         CLEAR THE REG
BUMPLOOP AH    R3,RIBELENG   ADD RIBE LENGTH
         BCT   R4,BUMPLOOP   AND ADD TIMESNUMBER OF RIBE'S
         AH    R3,RIBLNGTH   ADD LENGTH OF RIB
         AH    R3,RIBVLEN    ADD LENGTH OF VARIABLE SECTION
         AR    R9,R3         POINT TO NEXT RIB
         BCT   R8,RIBLOOP    AND LOOP UNTIL NO MORE RIBS
         B     RESEXIT       PREPARE FOR EOJ
******************************************************************
*  THIS SECTION IS USED TO BUMP TO THE NEXT RIBE ON THE CHAIN
*  IF THERE ARE NOR MORE RIBE'S, THEN GO TO NEXT RIB AND START
*  SEARCH FOR A RESERVE ALL OVER
*  IF NO MORE RIB'S GO TO EOJ
******************************************************************
BUMPRIBE AH    R5,RIBELENG   RIBE LENGTH
         BCT   R4,NEXTRIBE   IF ANOTHER RIBE GO LOOK AT IT
         LR    R9,R5         IF NOT GO TO NEXT RIB
         BCT   R8,RIBLOOP    LOOP TILL NOR MORE RIB'S
         B     RESEXIT       CLEAN UP
*****************************************************************
* TEST TO SEE IF ANY RESERVES HAVE BEEN FOUND
*      IF NOT - PUT OUT MESSAGE
*****************************************************************
CODE04   EQU   *
         MVI   TKNSW,X'00'   INITIALIZE TOKEN SWITCH
RESEXIT  TM    TKNSW,X'01'   WAS A TOKEN SENT
         BC    8,RESEOJ      NO, GO TO EOJ PROCESSING
         BC    15,START      YES, GO RE-EXECUTE GQSCAN FOR MORE INFO
RESEOJ   TM    SWRES,X'01'   ANY RESERVES FOUND
         BC    1,EXIT        YES, GO TO EOJ
         MVC   RESVMSG+4(27),=CL30'****** NO RESERVES FOUND *****'
         BAL   R6,RESVPRT    WRITE OUT MSG
         B     EXIT          GO TO EOJ
******************************************************************
*  PRINT ROUTINE FOR RESERVE INFO
*
*  SINCE CMDTSO + CMDSBTSO CONVERT THE SVC 35 TO A BALR 14,15
*  I MUST SAVE REG 14 SO IT DOESN'T GET PERMANENTLY DESTROYED
*
******************************************************************
RESVPRT  MVC   RESVMSG(4),=X'00520100'  MOVE IN CONTROL CHARS
         ST    R14,SAVREG14    HOLD UNTIL AFTER THE WTO
         LA    R1,RESVMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         L     R14,SAVREG14
         MVI   RESVMSG+4,C' '
         MVC   RESVMSG+5(77),RESVMSG+4 CLEAR OUT THE OUTPUT AREA
         BR    R6            RETURN TO THE SEARCH LOOP
***************************************************************
* TOKEN RETURNED AFTER PROCESSING RE-EXEC THE GQSCAN
***************************************************************
CODE08   EQU   *
         OI    TKNSW,X'01'    TURN ON TOKEN SWITCH
         BC    15,RIBWORK     GO AND PROCESS THE RIB
***************************************************************
*  PROBLEM WITH GQSCAN.  PUT OUT MSG + GO TO EOJ
***************************************************************
CODE0C   EQU   *
CODE10   EQU   *
         MVC   RESVMSG+4(27),=CL27'INVALID INFO IN QUEUE SCAN AREA'
         BAL   R6,RESVPRT    WRITE OUT MSG
         BC    15,EXIT
**********************************************************************
*  END OF SP3 - GQSCAN AREA FOR RESERVE SEARCH
**********************************************************************
JOBFIND  SR    R14,R14
         ICM   R14,3,14(R1)        ASID
         SLL   R14,2               MULTIPLY ASID BY 4 FOR ASVT ADDR INC
         L     R15,16              CVT
         L     R15,556(0,R15)      ASVT
         LA    R15,524(R14,R15)    ASVT ENTRY FOR ASID SPECIFIED
         TM    0(R15),X'80'        AVAILABLE SLOT
         BO    JOBFIND3            YES, JUST USE ASID
         L     R15,0(0,R15)        ASCB
         L     R14,56(0,R15)       CSCB
         CLI   28(R14),X'03'       INIT/JOB
         BNE   JOBFIND2            NO, GO USE THIS CSCB
         LR    R15,R14             SAVE CSCB
         LA    R15,0(0,R15)
         SPACE 3
JOBFIND1 L     R14,0(0,R14)        NEXT CSCB
         LA    R14,0(0,R14)
         LTR   R14,R14             END OF CSCBS
         BNZ   *+10                NO, CONTINUE
         LR    R14,R15             LOAD ORIG CSCB ADDR
         B     JOBFIND2
         CR    R14,R15             SAME CSCB
         BE    JOBFIND2            YES, INIT
         CLC   14(2,R1),30(R14)    ASID MATCH
         BNE   JOBFIND1            NO, GET NEXT
         SPACE 3
JOBFIND2 MVC   32(8,R6),=CL8' '
         LTR   R14,R14             CSCB ZERO
         BZ    JOBFIND3
         MVC   32(8,R6),8(R14)     JOBNAME
         SPACE 3
JOBFIND3 CLI   ASIDSW,X'FF'        ASID SEARCH
         BCR   7,R11               NO, CONTINUE
         CLC   32(8,R6),TYPE+2     JOBNAME MATCH
         BCR   8,R11               YES, CONTINUE
         CLC   25(4,R6),TYPE+2     ASID MATCH
         BCR   8,R11               YES, EXIT
         B     UCBLOOP1
PRINT    MVC   WTOLIST(4),=X'002C0100' SET MSG LEN AND UCM FLAGS
         LA    R6,UCBTAB           UCB TABLE ADDR
         LA    R7,100              MAX ENTRIES
         CLI   0(R6),C' '          ANY TO PRINT
         BE    NOPRINT             NO, GO TELL OPERATOR
         SPACE 3
PRINT1   CLI   0(R6),C' '          END OF PRINT
         BE    EXIT                YES, EXIT
         MVC   WTOLIST+4(40),0(R6)  SET MSG IN AREA
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              MCS ID OF REQUESTING CONSOLE
         SVC   35
         LA    R6,40(0,R6)         NEXT TABLE ENTRY
         BCT   R7,PRINT1           GET NEXT
         B     EXIT
         SPACE 3
NOPRINT  MVC   WTOLIST(4),=X'00200100'  SET LENGTH AND UCM FLAGS
         MVC   WTOLIST+4(28),=CL28'NO SELECTED DEVICES FOUND'
         CLI   TYPE,C'M'
         BNE   NOPRINT1
         MVC   WTOLIST+4(28),=CL28'NO MOUNTS PENDING'
         SPACE 3
NOPRINT1 LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              MCS ID OF REQUESTING CONSOLE
         SVC   35
         SPACE 3
EXIT     EQU   *
         ESTAE 0
         L     R0,WORK1SIZ
         LA    R1,WORK2SIZ
         AR    R0,R1
         O     R0,SUB241
         A     R0,=F'00102400'     ADD IN SCANAREA SIZE
         LR    R1,R13              AREA ADDRESS
         L     R14,SAVRET          LOAD RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESG03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     EXIT
         LTORG
         SPACE 3
         DS    0F
SUB241   DC    X'F1000000'   SUBPOOL 241
         DS    0F
CLEAR    DC    X'40000001'
         DS    0F
NORESMSG DC    X'00200100',CL28'NO RESERVES OUTSTANDING'
RESERMSG DC    X'00200100',CL28'ERROR -  INVALID QCB CHAIN'
         SPACE 3
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
MOVEMIN  MVC   RESVMSG+33(0),0(R5)     MOVE IN MINOR NAME
WORK1SIZ DC    AL4(WORK1END-WORK1)
WORK1    DSECT
SCANSAVE DS    18F           18 WORD SAVEAREA REQ FOR GQSCAN + UCBSCAN
WORKSTRT DS    0D
DOUBLE   DS    D
SAVRET   DS    F
XSASAVE  DS    F
WTOLIST  DS    CL44
RESVMSG  DS    CL78
TYPE     DS    CL10
ASIDSW   DS    C
RESVFLAG DS    X
ESTAELST DS    0F,(ESTAEOVX)X
SAVREG14 DS    F             SAVE REG14 SO WTO DOESN'T DESTROY
         DS    0D                                              -JAL/XA-
UCBWORK  DS    CL100                                           -JAL/XA-
DEVCLASS DS    CL1                                             -JAL/XA-
ADDRUCB  DS    F                                               -JAL/XA-
TKN      DS    F            GQSCAN CONTINUATION ADDR            GLA-BFG
GQSCANL  GQSCAN MF=L        FOR REENTRANCY                      GLA-BFG
         DS    0D                                              -JAL/XA-
PARMLIST DS    3F                                              -JAL/XA-
         ORG   PARMLIST                                        -JAL/XA-
PARMWA   DS    F                                               -JAL/XA-
PARMDEVT DS    F                                               -JAL/XA-
PARMUCB  DS    F                                               -JAL/XA-
UCBTAB   DS    100CL40
WORK1END DS    0D
*******************FOR RESERVE USE #R R***********************
WORK2    DSECT
         DS    0D
TKNSW    DS    X
SWRES    DS    X
         DS    0F
         DS    0F
RIBLNGTH DS    H             RIB LENGTH
RIBELENG DS    H             RIBE LENGTH
WORK2SIZ EQU   *-WORK2
SCANAREA DS    102400X       IF SIZE CHGS, AHANGE 'ALL' 102400 LINES
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         PRINT NOGEN
         ISGRIB
         IEFUCBOB
         END   IEESG03D
./       ADD   NAME=CSCSH03D
         TITLE 'XA1SH03D -   #S  DISPLAY LPA MODULES'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESH03D -       #S  DISPLAY LPA MODULES                  ***
***                                                                 ***
***       VERSION -        1.3                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/XA  2.1                              ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        01/26/83  AXC-CBT CHANGE ESTAE PARM LEN  ***
***                        05/10/86  GLA-BFG FIX FOR 31 BIT XA      ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESH03D CSECT
         LR    R12,R15
         USING IEESH03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         L     R3,XAL              LOAD LIST POINTER
         LA    R3,0(0,R3)          CLEAR HIGH ORDER
         LTR   R3,R3               PARM EXIST
         BZ    NOPARM              NO, CHECK RETURN
         MVC   WTOLIST+4(9),0(R3)  SAVE MODULE NAME
         CLI   0(R3),C'*'          ADDRESS
         BE    ADDRESS             YES, GO SEARCH
         L     R4,16               CVT ADDR
         L     R4,188(0,R4)        LPA CDE
         L     R4,0(0,R4)          1ST CDE
         LA    R5,WTOLIST+4        MODULE NAME
         SR    R9,R9               CDE INDICATOR
         SPACE
CDECHK   CLC   8(8,R4),0(R5)       MATCH
         BE    PRINT               YES, GO PRINT
         L     R4,0(0,R4)          NEXT CDE
         LA    R4,0(0,R4)          CLEAR HIGH ORDER
         LTR   R4,R4               END OF CHAIN
         BNZ   CDECHK              NO, GO CHECK NEXT
         L     R4,16               CVT
         L     R4,360(0,R4)        LPDE CHAIN
         LA    R9,4                LPDE INDICATOR
         SPACE
LPDECHK  CLC   8(8,R4),=8X'FF'     END OF CHAIN
         BE    NOTFOUND            YES, MODULE NOT FOUND
         CLC   8(8,R4),0(R5)       MATCH
         BE    PRINT               YES, GO PRINT
         LA    R4,40(0,R4)         NEXT LPDE
         B     LPDECHK             GO CHECK NEXT
ADDRESS  LA    R7,WTOLIST+5        ADDRESS
         SR    R4,R4               CLEAR RESULT
         LA    R6,8                SET FOR FULL XA ADDRESS     GLA-BFG
PARMCNV0 CLI   0(R7),C'0'          VALID CHAR
         BL    PARMCNV1            NO
         CLI   0(R7),C'9'          VALID CHAR
         BH    ERROR               NO, PARM ERROR
         B     PARMCNV2            O.K., VALID PARM
         SPACE
PARMCNV1 CLI   0(R7),C'A'          VALID CHAR
         BL    ERROR               NO, PARM ERROR
         CLI   0(R7),C'F'          VALID CHAR
         BH    ERROR               NO, PARM ERROR
         SPACE
PARMCNV2 SR    R8,R8               INSERT
         IC    R8,0(0,R7)             DIGIT
         SRDL  R8,4                SHIFT OUT NUMERIC
         SRL   R9,28               ADJUST NUMERIC
         AH    R9,=H'9'               VALUE
         SH    R8,=H'12'           MAKE SIGN 0 OR 3
         MH    R8,=H'3'            MAKE SIGN 0 OR 9
         SR    R9,R8               CALCULATE HEX VALUE
         LR    R5,R9               LOAD HEX VALUE AND
         SLL   R5,28                  SHIFT INTO
         SLDL  R4,4                      RESULT
         LA    R7,1(0,R7)          NEXT BYTE
         BCT   R6,PARMCNV0
         LR    R5,R4               SAVE ADDRESS
         L     R4,16               CVT ADDR
         L     R4,188(0,R4)        LPA CDE
         L     R4,0(0,R4)          1ST CDE
         SR    R9,R9               CDE INDICATOR
ACDECH1  TM    28(R4),X'04'        MINOR CDE
         BO    ACDECH2             YES, GO TRY NEXT
         L     R6,20(0,R4)         EXTENT LIST
         L     R7,8(0,R6)          LOAD MODULE LENGTH
         LA    R7,0(0,R7)          CLEAR HIGH ORDER
         L     R6,12(0,R6)         LOAD MODULE ADDR
         CR    R5,R6               MATCH
         BL    ACDECH2             NO, TRY NEXT
         AR    R6,R7               MODULE END
         CR    R5,R6               MATCH
         BL    APRINT              YES, GO PRINT
         SPACE
ACDECH2  L     R4,0(0,R4)          NEXT CDE
         LA    R4,0(0,R4)          CLEAR HIGH ORDER
         LTR   R4,R4               END OF CHAIN
         BNZ   ACDECH1             NO, GO CHECK NEXT
         L     R4,16               CVT
         L     R4,360(0,R4)        LPDE CHAIN
         LA    R9,4                LPDE INDICATOR
         SPACE
ALPDECH1 CLC   8(8,R4),=8X'FF'     END OF CHAIN
         BE    NOTADDR             YES, ADDR NOT FOUND
         TM    28(R4),X'04'        MINOR LPDE
         BO    ALPDECH2            YES, TRY NEXT
         L     R6,36(0,R4)         LOAD MODULE ADDR
         L     R7,32(0,R4)         LOAD MODULE LEN
         LA    R7,0(0,R7)          CLEAR HIGH ORDER
         CR    R5,R6               MATCH
         BL    ALPDECH2            NO, TRY NEXT
         AR    R6,R7               MODULE END
         CR    R5,R6               MATCH
         BL    APRINT              YES, GO PRINT
         SPACE
ALPDECH2 LA    R4,40(0,R4)         NEXT LPDE
         B     ALPDECH1            GO CHECK NEXT
APRINT   MVC   WTOLIST+4(8),8(R4)  MODULE NAME
         SPACE
PRINT    MVI   WTOLIST+14,C' '     CLEAR
         MVC   WTOLIST+15(37),WTOLIST+14
         MVC   WTOLIST+14(8),WTOLIST+4
         ST    R4,DOUBLE
         UNPK  WTOLIST+4(9),DOUBLE(5)
         NC    WTOLIST+4(8),=8X'0F'
         TR    WTOLIST+4(8),=C'0123456789ABCDEF'
         MVI   WTOLIST+12,C' '
         MVI   WTOLIST+13,C' '
         LTR   R9,R9
         BNZ   PRINTXL             LPDE
         L     R6,20(0,R4)         LOAD XTNT LIST ADDR
         TM    28(R4),X'04'        MINOR CDE
         BNO   PRINTCD             NO, USE THIS ONE
         L     R6,20(0,R6)         LOAD MAJOR XTNT LIST ADDR
PRINTCD  UNPK  WTOLIST+24(9),12(5,R6) TRANSLATE
         B     PRINTXC
PRINTXL  UNPK  WTOLIST+24(9),36(5,R4) TRANSLATE
PRINTXC  NC    WTOLIST+24(8),=8X'0F'   MODULE ADDR
         TR    WTOLIST+24(8),=C'0123456789ABCDEF'
         MVI   WTOLIST+32,C' '
         B     *+4(R9)             BR BY TYPE
         B     PRTCDE              CDE
         TM    28(R4),X'04'        MINOR LPDE
         BNO   PRTLSIZ             NO, GO PRINT MODULE SIZE
         MVC   WTOLIST+34(8),32(R4) PRINT MAJOR NAME
         MVC   WTOLIST+24(7),=C'*MAJOR='
         B     WTO
         SPACE
PRTLSIZ  UNPK  WTOLIST+34(7),33(4,R4)
         NC    WTOLIST+34(6),=6X'0F'
         TR    WTOLIST+34(6),=C'0123456789ABCDEF'
         MVI   WTOLIST+40,C' '
         B     WTO
         SPACE
PRTCDE   UNPK  WTOLIST+34(7),9(4,R6) TRANSLATE
         NC    WTOLIST+34(6),=6X'0F'
         TR    WTOLIST+34(6),=C'0123456789ABCDEF'
         MVI   WTOLIST+40,C' '
         MVC   WTOLIST+42(4),=C'USE='
         UNPK  WTOLIST+47(5),24(3,R4)  USE COUNT
         NC    WTOLIST+47(4),=6X'0F'
         TR    WTOLIST+47(4),=C'0123456789ABCDEF'
         MVI   WTOLIST+51,C' '
         SPACE 3
WTO      LA    R1,WTOLIST
         MVC   WTOLIST(4),=X'00340100'
         SR    R0,R0
         IC    R0,XAU              MCSID
         SVC   35
         B     RETURN
NOTFOUND LA    R1,NFNDMSG          NOT FOUND
         B     MSGRTN
         SPACE 3
NOTADDR  LA    R1,NFNDADR          NOT FOUND
         B     MSGRTN
         SPACE 3
ERROR    LA    R1,BADADR           INVALID ADDR
         B     MSGRTN
         SPACE 3
NOPARM   LA    R1,ERRMSG           PARM ERROR
         SPACE 3
MSGRTN   SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         SPACE 3
RETURN   EQU   *
         ESTAE 0
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESH03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     RETURN
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
NFNDMSG  DC    X'00360100'
         DC    CL50'MODULE NOT FOUND'
         SPACE 3
         DS    0F
NFNDADR  DC    X'00360100'
         DC    CL50'ADDRESS NOT FOUND'
         SPACE 3
         DS    0F
BADADR   DC    X'00360100'
         DC    CL50'ADDRESS INVALID'
         SPACE 3
         DS    0F
ERRMSG   DC    X'00360100'
         DC    CL50'PARAMETER MISSING'
         SPACE 3
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
WORK     DSECT
WORKSTRT DS    0D
DOUBLE   DS    2F
SAVRET   DS    18F
XSASAVE  DS    F
WTOLIST  DS    52C
ESTAELST DS    0F,(ESTAEOVX)X AXC-CBT
WORKEND  DS    0D
         SPACE 5
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSI03D
         PRINT NOGEN                                               @TEC
         TITLE 'ESASI03D -   #V  EXTENDED DISPLAY UNITS'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESI03D -       #V  EXTENDED DISPLAY UNITS               ***
***                                                                 ***
***       VERSION -        2.1                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        01/11/82  RLL-CHANGE ESTAE PARM LENGTH   ***
***                        09/27/82  AXC-CBT ADD 3375 AND 3380      ***
***                                  SUPPORT                        ***
***                        02/07/84  DEM-SNET UCB SCAN ROUTINE      ***
***                                      MODIFIED FOR XA.           ***
***                        04/26/86  GLA-BFG FIX XA CODING FOR      ***
***                                      REENTRANCY AND ESTAE       ***
***                        05/03/86  GLA-BFG FIX CODING FOR         ***
***                                      UCB LOOKUP                 ***
***                        09/17/91  JCL-TEC FIX CHANNEL PATH       ***
***                                      DISPLAY                    ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESI03D CSECT
         LR    R12,R15             ESTABLISH BASE
         USING IEESI03D,R12
         USING XSA,R2              'USE' XSA BASE
         USING WTO,R13             'USE' WTO AREA BASE
         L     R0,SIZE
         GETMAIN R,LV=(0)          GET WTO AREA
         LR    R13,R1              PUT WTO ADDR IN WTO BASE
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         MVC   WTOCTL1(52),WOVL1
         MVC   WTOCTL2(52),WOVL2
         MVC   WTOCTL3(52),WOVL3
         MVC   ERRMSG(4),=X'00240100'
         LA    R1,WORKAREA         *XA
         ST    R1,PARMWA           *XA
         LA    R1,=X'00'           *XA DEVICE CLASS            GLA-BFG
         ST    R1,PARMDEVT         *XA                         GLA-BFG
         LA    R1,ADDRUCB          *XA
         ST    R1,PARMUCB          *XA
         MVI   PARMUCB,X'80'       *XA END PARAMETER LIST
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                          @TEC
         BSM   0,R9                                                @TEC
AMODE31  DC    A(CONT31+X'80000000')                               @TEC
CONT31   DS    0H                                                  @TEC
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         L     R7,XAL              GET PTR TO INPUT PARM
         LA    R7,0(R7)            CLEAR HI BYTE
         LTR   R7,R7               IS THERE A PARM ?
         BZ    NOTHING             NO
         CLI   2(R7),C' '          COULD THIS BE A MATRIX REQUEST
         BNE   PARMNMTR            NO
         CLC   0(2,R7),=C'D1'      IS REQUEST 3330-1 MATRIX
         BE    MATRIXA             YES
         CLC   0(2,R7),=C'D3'      IS REQUEST 3330 MATRIX
         BE    MATRIXB             YES
         CLC   0(2,R7),=C'D5'      IS REQUEST 3350 MATRIX
         BE    MATRIXC             YES
         CLC   0(2,R7),=C'D7'      IS REQUEST 3375 MATRIX   AXC-CBT
         BE    MATRIXF             YES                      AXC-CBT
         CLC   0(2,R7),=C'D8'      IS REQUEST 3380 MATRIX   AXC-CBT
         BE    MATRIXG             YES                      AXC-CBT
         CLI   0(R7),C'D'          IS REQUEST DASD MATRIX
         BE    MATRIXD             YES
         CLI   0(R7),C'T'          IS REQUEST TAPE MATRIX
         BE    MATRIXE             YES
PARMNMTR CLI   1(R7),C'='          IS OUT BOY USING KEYWORDS ?
         BNE   UNIT                NO, ASSUME HE WANTS UNITS
         CLI   0(R7),C'U'          IS REQUEST BY UNIT ?
         BE    SETUNIT             YES
         CLI   0(R7),C'S'          IS REQUEST BY SERIAL ?
         BE    SERIAL              YES
         B     GOOF                ERROR
SERIAL   LA    R5,EXSER            SET FOR SERIAL SEARCH
         LA    R1,1(0,R7)          SCAN VOLSER
SERIAL1  LA    R1,1(0,R1)          NEXT BYTE
         CLI   0(R1),C' '          END OF VOLSER
         BNE   SERIAL1             NO
         SR    R1,R7               VOLSER LENGTH +2
         SH    R1,=H'3'            VOLSER LENGTH -1
         CH    R1,=H'5'            VOLSER MAX
         BH    GOOF                OVER MAX
         ST    R1,VLSERLEN         VOLSER LENGTH -1
         BAL   R10,UCBSRCH         GO TRY TO FIND THE SERIAL NO.
         L     R15,RETCODE
         LTR   R15,R15             DID WE FIND IT ?
         BZ    EXIT                YEP
         B     GOOF                NOPE
SETUNIT  LA    R7,2(R7)            SKIP THE 'U='
UNIT     MVI   WCU,X'00'           INITIALIZE GHOST SUPPRESSOR
         LA    R5,EXUCB            SET FOR SEARCH FOR SPECIFIC UCB
         CLI   2(R7),C'X'          IS THIS REQ. FOR 'ALL' UCB'S
         BNE   DOIT                NO
         LA    R5,EXUCBX           SET SEARCH FOR 'ALL' UCB'S
DOIT     BAL   R10,UCBSRCH         GO TRY TO FIND THE UCB
         L     R15,RETCODE
         LTR   R15,R15             DID WE SUCCEED ?
         BNZ   GOOF                ERROR IN REQUEST
         CLI   3(R7),C','          ARE THERE MORE UNITS ?
         BNE   EXIT                NO
         LA    R7,4(R7)            BUMP TO NEXT UNIT
         B     UNIT                PROCESS NEW UNIT
GOOF     MVC   EUNIT(9),0(R7)      SEARCH FAILED
NOTHING  MVC   EUNIT+9(23),ERRTEXT               SET
         SR    R0,R0                              UP
         LA    R1,ERRMSG                              MESSAGE
         IC    R0,XAU                                 ERROR
         SVC   35
EXIT     EQU   *
         ESTAE 0                                      ****(RLL)****
         LA    R8,AMODE24                                          @TEC
         BSM   0,R8                                                @TEC
AMODE24  DS    0H                                                  @TEC
         LR    R1,R13
         L     R14,SAVRET          RELOAD RETURN ADDR
         L     R0,SIZE
         FREEMAIN R,LV=(0),A=(1)          FREE WTO AREA
         SR    R15,R15             CLEAR RETURN CODE
         BR    R14                 EXIT
UCBSRCH  MVI   RETCODE+3,X'04'     ASSUME BAD RETURN
         XC    RETCODE(3),RETCODE
         XC    WCU(1),WCU
         XC    UCBDMCUR(4),UCBDMCUR
         XC    UCBDMLOW(4),UCBDMLOW
         XC    WORKAREA,WORKAREA
UCBLOOP  BAL   R6,MATRXUCB
         LTR   R3,R1               END OF UCBS
         BCR   8,R10               YES
         CLI   0(R7),C'S'          IS IT A SEARCH BY SERIAL ?
         BE    UCBLOOP1            YES
         EX    0,0(R5)             COMPARE SOMETHING IN THE UCB
         BE    AHIT                BRANCH IF WE LIKED IT
         B     UCBLOOP
UCBLOOP1 L     R1,VLSERLEN         VOLSER LENGTH -1
         EX    R1,0(0,R5)          COMPARE VOLSERS
         BNE   UCBLOOP             NOT EQUAL
         B     AHIT                BRANCH IF WE LIKED IT
AHIT     CLC   WUNIT,13(R3)        IS THIS AN OPCHAN GHOST ?
         BE    UCBLOOP             YES, EXORCISE IT AND CONTINUE
         CLI   0(R7),C'S'          IS IT A SEARCH BY SERIAL ?
         BE    MVUNAME             YES
         CLC   WCU,5(R3)           IS THIS AN OPCHAN GHOST ?
         BCR   2,R10               YES, EXORCISE IT AND QUIT
         MVC   WCU,5(R3)           SAVE LAST UNIT ADDR FOR COMPARE
MVUNAME  MVC   WUNIT,13(R3)        MOVE UNIT ADDR TO WTO AREA
         TM    18(R3),X'A0'        IS IT TAPE OR DISK ?
         BZ    MVSTAT              NEITHER
         MVC   WSER,28(R3)         MOVE VOLSER
         CLI   WSER,X'00'          IS THERE A VOLSER
         BNE   MVSTAT              YES
         MVC   WSER(6),=6C'*'      INSERT 'NO VOLSER' INDICATOR
MVSTAT   MVC   WONOFF(3),=CL3'OFF'
         TM    3(R3),X'C0'         ON/OFF/CHG FLAGS
         BZ    MVSTAT1             OFFLINE
         MVC   WONOFF(3),=CL3'CHG'
         BO    MVSTAT1             CHANGING STATUS
         TM    3(R3),X'40'         CHG FLAG
         BO    MVSTAT1             CHANGING STATUS
         MVC   WONOFF(3),=CL3'ON'
MVSTAT1  L     R1,20(0,R3)         UCB EXTENTION ADDR
         UNPK  WASID(5),14(3,R1)   ASID
         TR    WASID(4),TABLE
         MVI   WASID+4,C' '
         UNPK  WDMCT(3),35(2,R3)   NO. OF OPEN DCBS
         TR    WDMCT(2),TABLE
         MVI   WDMCT+2,C' '
         UNPK  WUSCT(3),38(2,R3)   NO. OF USERS
         TR    WUSCT(2),TABLE
         MVI   WUSCT+2,C' '
         UNPK  WRSCT(3),36(2,R3)   NO. OF RESERVES
         TR    WRSCT(2),TABLE
         MVI   WRSCT+2,C' '
         UNPK  WFLG1(9),0(5,R3)    1ST 4 BYTES OF UCB
         TR    WFLG1(8),TABLE
         MVI   WFLG1+8,C'/'
         UNPK  WFLG2(9),4(5,R3)    2ND 4 BYTES OF UCB
         TR    WFLG2(8),TABLE
         MVI   WFLG2+8,C' '
DEVTYPE  SR    R0,R0
         CL    R0,16(0,R3)         SEE IF NULL UCBTYPE FIELD
         BNE   DEVT1               NO
         MVC   WDEVT(6),=CL6'DUMMY'  DUMMY UCB
         B     WRITEIT
DEVT1    DS    0H
         LA    R1,DEVCNUM          NUM. OF DEV. CLASSWS
         LA    R6,DEVCLASS         ADDR. OF TABLE
DEVT2    CLC   18(1,R3),0(R6)      SEE IF EQ TO THIS ENTRY
         BE    DEVT3               YES,GO PROCESS
         LA    R6,1(0,R6)          TRY NEXT ENTRY
         BCT   R1,DEVT2
         MVC   WDEVT(6),=CL6'*UNK*'
         B     WRITEIT
DEVT3    LA    R6,DEVCNUM          NUM. OF ENTRIES
         SR    R6,R1
         SLL   R6,2                INDEX * 4 FOR OTHER TABLES
         LA    R1,DEVCTAB          ADDR. OF BRANCH TABLE
         ALR   R1,R6               THIS CLASS ENTRY
         L     R1,0(0,R1)
         BR    R1
DEVTS    CLC   19(1,R3),0(R14)     THIS ENTRY?
         BE    DEVTS1              YES
         LA    R14,1(0,R14)        NEXT ENTRY
         BCT   R1,DEVTS
         MVC   WDEVT(6),=CL6'*UNK*'
         BR    R11
DEVTS1   SR    R8,R1               INDEX
         MH    R8,=H'6'            TIMES 6 FOR BYTE OFFSET
         ALR   R15,R8              ADDR. EBCDIC
         MVC   WDEVT(6),0(R15)
         BR    R11
TAPEUCB  LA    R1,TAPENUM          NUM. TABLE ENTRIES
         LA    R14,TAPETAB         TABLE ADDR.
         LA    R15,TAPENAME        EBCDIC NAME
         LR    R8,R1
         BAL   R11,DEVTS
         B     DEVTDSP
COMMUCB  MVC   WDEVT(6),=CL6'COMM'
         MVC   WSER(6),=CL6'COMM'
         B     DEVTDSP
DASDUCB  DS    0H
         LA    R1,DASDNUM          NUM. TABLE ENTRIES
         LA    R14,DASDTAB         TABLE ADDR.
         LA    R15,DASDNAME        EBCDIC NAME
         LR    R8,R1
         BAL   R11,DEVTS
         MVC   WTOCTL3M+3(8),=CL8'PRIVATE'
         TM    34(R3),X'10'        PRIVATE
         BO    DASDUCB1            YES
         MVC   WTOCTL3M+3(8),=CL8'STORAGE'
         TM    34(R3),X'04'        STORAGE
         BO    DASDUCB1            YES
         MVC   WTOCTL3M+3(8),=CL8'PUBLIC'
         TM    34(R3),X'08'        PUBLIC
         BO    DASDUCB1            YES
         MVC   WTOCTL3M+3(8),=CL8' '
DASDUCB1 MVC   WTOCTL3M+11(8),=CL8'RESERVED'
         TM    3(R3),X'20'         RESERVED
         BO    DASDUCB2            YES
         MVC   WTOCTL3M+11(8),=CL8'RESIDENT'
         TM    3(R3),X'04'         RESIDENT
         BO    DASDUCB2            YES
         MVC   WTOCTL3M+11(8),=CL8'REMOVE'
DASDUCB2 MVC   WTOCTL3M+20(8),=CL8'PAGING'
         TM    34(R3),X'40'        PAGING
         BO    DASDUCB3            YES
         MVC   WTOCTL3M+20(8),=CL8'SYSRES'
         TM    3(R3),X'02'         SYSRES
         BO    DASDUCB3            YES
         MVC   WTOCTL3M+20(8),=CL8'CATALOG'
         TM    34(R3),X'01'        CATALOG
         BO    DASDUCB3            YES
         MVC   WTOCTL3M+20(8),=CL8' '
DASDUCB3 MVC   WTOCTL3M+29(19),=CL19'DAVV MOUNT PENDING '
         TM    37(R3),X'40'        DAVV MOUNT PENDING
         BO    DASDUCB4            YES
         MVC   WTOCTL3M+29(19),=CL19'DAVV IN CONTROL    '
         TM    37(R3),X'80'        DAVV IN CONTROL
         BO    DASDUCB4            YES
         MVC   WTOCTL3M+29(19),=CL19'RESERVE PENDING    '
         TM    37(R3),X'20'        RESERVE PENDING
         BO    DASDUCB4            YES
         MVC   WTOCTL3M+29(19),=CL19'3330V ATTN RECEIVED'
         TM    37(R3),X'08'        3330V ATTENTION RECEIVED
         BO    DASDUCB4            YES
         MVC   WTOCTL3M+29(19),=CL19'3330V ATTN OVERDUE '
         TM    37(R3),X'02'        3330V ATTENTION PENDING
         BO    DASDUCB4            YES
         MVC   WTOCTL3M+29(19),=CL19'CYL FAULT PENDING  '
         TM    37(R3),X'04'        3330V CYLINDER FAULT PENDING
         BO    DASDUCB4            YES
         MVC   WTOCTL3M+29(19),=CL19' '
DASDUCB4 TM    34(R3),X'01'        CATALOG
         BO    DASDUCB3            YES
         CLI   19(R3),X'09'        3330
         BNE   WRITEIT             NO
         TM    17(R3),X'08'        VIRTUAL VOLUME
         BNO   WRITEIT             NO
         MVC   WDEVT(6),=CL6'3330V'
         B     WRITEIT
DISPUCB  DS    0H
         TM    3(R3),X'02'         SEE IF CONSOLE
         BNO   DISPUCB1            NO
         MVC   WSER(6),=CL6'CONS'
         B     DISPUCB2
DISPUCB1 MVC   WSER(6),=CL6'DISP'
DISPUCB2 LA    R1,DISPNUM          MUN. OF ENTRIES
         LA    R14,DISPTAB         TABLE ADDR.
         LA    R15,DISPNAME        EBCDIC
         LR    R8,R1
         BAL   R11,DEVTS
         TM    16(R3),X'01'        TEST FOR MODEL
         BNO   DISPUCB3
         MVC   WDEVT+4(2),=C'-1'      MODEL 1
DISPUCB3 TM    16(R3),X'02'
         BNO   DEVTDSP
         MVC   WDEVT+4(2),=C'-2'      MODEL 2
         B     DEVTDSP
URUCB    LA    R1,URNUM          NUM. TABLE ENTRIES
         LA    R14,URTAB         TABLE ADDR.
         LA    R15,URNAME        EBCDIC NAME
         LR    R8,R1
         MVC   WSER(6),=CL6'U.R.'
         BAL   R11,DEVTS
         B     DEVTDSP
WRITEIT  SR    R0,R0               CLEAR R0
         LA    R1,WTOCTL1
         IC    R0,XAU              GET UCMID IF REQUESTING CONSOLE
         SVC   35
         SR    R0,R0
         LA    R1,WTOCTL2
         IC    R0,XAU
         SVC   35
         CLC   WTOCTL3(52),WOVL3
         BE    WRITEIT1
         SR    R0,R0
         LA    R1,WTOCTL3
         IC    R0,XAU
         SVC   35
WRITEIT1 MVC   WTOCTL2(52),WOVL2
         MVC   WTOCTL3(52),WOVL3
         MVI   RETCODE+3,X'00'     SET ZERO RET CODE
         CLI   0(R7),C'S'          IS IT A REQ. BY SERIAL ?
         BE    UCBLOOP       YES, CONTINUE SEARCH IN CASE OF DUPLICATES
         CLI   2(R7),C'X'          IS IT A REQ FOR ALL UNITS
         BE    UCBLOOP             YES, GET THE REST OF THE UCB'S
         BR    R10                 RETURN
DEVTDSP  MVC   WTODISP+3(22),=CL22'DEVTYPE='
         UNPK  WDMCT+4(9),16(5,R3) HEX DEVICE TYPE
         TR    WDMCT+4(8),TABLE
         MVI   WDMCT+12,C' '
         B     WRITEIT
EXUCB    CLC   13(3,R3),0(R7)      FIND SPECIFIC UCB
EXUCBX   CLC   13(2,R3),0(R7)      FIND ALL UCB'S FOR A GIVEN CTL UNIT
EXSER    CLC   28(0,R3),2(R7)      FIND UCB BY SERIAL NO.
MATRIXA  LA    R5,MATRXD1
         B     MATRIX
MATRIXB  LA    R5,MATRXD3
         B     MATRIX
MATRIXC  LA    R5,MATRXD5
         B     MATRIX
MATRIXD  LA    R5,MATRXD
         B     MATRIX
MATRIXE  LA    R5,MATRXT
         B     MATRIX
MATRIXF  LA    R5,MATRXD7                                   AXC-CBT
         B     MATRIX                                       AXC-CBT
MATRIXG  LA    R5,MATRXD8                                   AXC-CBT
         B     MATRIX                                       AXC-CBT
MATRXD1  CLC   18(2,R3),=X'200D'   3330-1
MATRXD3  CLC   18(2,R3),=X'2009'   3330
MATRXD5  CLC   18(2,R3),=X'200B'   3350
MATRXD7  CLC   18(2,R3),=X'200C'   3375                     AXC-CBT
MATRXD8  CLC   18(2,R3),=X'200E'   3380                     AXC-CBT
MATRXD   CLC   18(1,R3),=X'20'     DASD
MATRXT   CLC   18(1,R3),=X'80'     TAPE
MATRIX   BAL   R6,MATRXHD
         LA    R7,MATRXLN          MATRIX OUTPUT LINE
         MVC   MATRXCU(6),=CL6' '
         MVC   MATRXPTH(6),=CL6' '
         MVC   MATRXLN(32),=16C'. '
         MVC   MATRXWTO(4),=X'00330100'
         XC    WCU(1),WCU
         XC    UCBDMCUR(4),UCBDMCUR
         XC    UCBDMLOW(4),UCBDMLOW
MATRIX1  BAL   R6,MATRXUCB
         LTR   R3,R1               END OF UCBS
         BZ    MATRIX4             YES
         EX    0,0(0,R5)           CHECK UCB
         BNE   MATRIX1             WRONG TYPE
         CLI   WCU,X'00'           1ST TIME
         BNE   MATRIX2             NO
         BAL   R6,MATRXCHN
         MVC   MATRXCU(2),13(R3)   CU ADDR
         MVI   MATRXCU+2,C'X'
         MVC   WCU(1),14(R3)       SAVE CU ADDR
MATRIX2  CLC   WCU(1),14(R3)       CU MATCH
         BE    MATRIX3             YES
         BAL   R6,MATRXPRT         PRINT A LINE
         MVC   WCU(1),14(R3)
         MVC   MATRXLN(32),=16C'. '
         MVC   MATRXCU(2),13(R3)   CU ADDR
         MVI   MATRXCU+2,C'X'
         BAL   R6,MATRXCHN
MATRIX3  SR    R1,R1
         IC    R1,5(0,R3)          CU ADDR
         SLL   R1,28               SHIFT OUT CONTROL UNIT ADDR
         SRL   R1,27               SHIFT BACK  X 2
         LA    R1,MATRXLN(R1)      MATRIX PRINT POSITION
         MVI   0(R1),C'*'          MARK OFFLINE
         TM    3(R3),X'80'         ONLINE?
         BZ    *+8                 NO
         MVI   0(R1),C'0'          MARK ONLINE
         B     MATRIX1
MATRIX4  BAL   R6,MATRXPRT
         B     EXIT
MATRXHD  LA    R1,MATRXTIT
         B     MATRXPRX
MATRXPRT LA    R1,MATRXWTO
MATRXPRX SR    R0,R0
         IC    R0,XAU
         SVC   35
         BR    R6
MATRXCHN DS    0H
         LH    R15,=H'-24'             UCBCHPS (8CHIPIDS)          @TEC
         AR    R15,R3                  GET ADDR OF UCBSHPS         @TEC
         UNPK  MATRXPTH(9),0(5,R15)    HANDLE 1ST 4 PATHS          @TEC
         MVI   MATRXPTH+8,C' '         FIX UNPK DAMAGE             @TEC
         TR    MATRXPTH(8),HEXTR-X'F0' MAKE DISPLAY ABLE           @TEC
         BR    R6
MATRXUCB ST    R10,UCBDMSAV+8
         ST    R8,UCBDMSAV
         ST    R11,UCBDMSAV+12
         L     R8,UCBDMLOW
UCBDML#1 L     R10,=X'0000FFFF'    .SET MAX NEXT LEAST HIGH
         LA    R8,1(0,R8)
         L     R9,16               .CVT                        GLA-BFG
UCBDML#2 L     R15,1076(0,R9)      *XA
         LA    R1,PARMLST          *XA
         BALR  R14,R15             *XA
         LTR   R15,R15             *XA
         BNZ   UCBDMOUT            *XA
         L     R1,ADDRUCB          *XA
         LTR   R1,R1               .ZERO ADDR
         BZ    UCBDML#2            *XA                         GLA-BFG
UCBDML#4 BAL   R11,UCBDMCNV        .CONVERT UNIT ADDR TO HEX
         CR    R1,R8               .UNIT EQUAL
         BL    UCBDML#2            .LOW NOT EQUAL, NEXT UCB
         LR    R10,R1              .SET NEXT LEAST HIGH UNIT ADDR
         B     UCBDMOUT            .GO PROCESS
UCBDMCNV SR    R14,R14
         SR    R15,R15
         IC    R15,13(0,R1)        .UNIT ADDR DIGIT
         TM    13(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,14(0,R1)        .UNIT ADDR DIGIT
         TM    14(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,15(0,R1)        .UNIT ADDR DIGIT
         TM    15(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         LR    R1,R14              .SET RESULTS REG
         BR    R11
UCBDMOUT C     R10,=X'0000FFFF'    .ALL DONE
         BE    UCBDMEX             .YES
         L     R1,ADDRUCB
         B     UCBDMRET            .CONTINUE
UCBDMEX  SR    R1,R1               .CLEAR UCB ADDR REGISTER
UCBDMRET DS    0H
         L     R8,UCBDMSAV
         L     R10,UCBDMSAV+8
         L     R11,UCBDMSAV+12
         BR    R6
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         USING *,R15
STAERTRY L     R12,=A(IEESI03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     EXIT
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WTOEND-WTO)
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
MATRXTIT DC    X'00330100'                                         @TEC
         DC    CL15'CUU         '                                  @TEC
         DC    CL32'0 1 2 3 4 5 6 7 8 9 A B C D E F'
WOVL1    DC    X'00340100'
         DC    CL18' ',CL13'UNIT=',CL9'AS=',CL8' '
WOVL2    DC    X'00340100'
         DC    CL11'   DCB=',CL8'USR=',CL8'RSV=',CL21'FLG='
WOVL3    DC    X'00340100'
         DC    CL48' '
TABLE    EQU   *-X'F0'
CHANNELS DC    C'0123456789ABCDEF'
ERRTEXT  DC    CL23'  UNIT OR VOL NOT FOUND'
DEVCLASS DS    0F
         DC    X'80'               TAPE
         DC    X'40'               COMM.
         DC    X'20'               DASD
         DC    X'10'               DISP
         DC    X'08'               UR
DEVCNUM  EQU   *-DEVCLASS
DEVCTAB  DS    0F
*
*        BRANCH TABLE FOR DEVICE CLASS PROCESSING
*
         DC    A(TAPEUCB)
         DC    A(COMMUCB)
         DC    A(DASDUCB)
         DC    A(DISPUCB)
         DC    A(URUCB)
URTAB    DS    0F
         DC    X'06'               3505
         DC    X'08'               1403
         DC    X'09'               3211
         DC    X'0E'               3800
         DC    X'0C'               3525
         DC    X'0A'               1443
         DC    X'04'               2501
         DC    X'10'               2671
URNUM    EQU   *-URTAB
URNAME   DS    0F
         DC    CL6'3505'
         DC    CL6'1403'
         DC    CL6'3211'
         DC    CL6'3800'
         DC    CL6'3525'
         DC    CL6'1443'
         DC    CL6'2501'
         DC    CL6'2671'
TAPETAB  DS    0F
         DC    X'01'               2400
         DC    X'03'               3400
TAPENUM  EQU   *-TAPETAB
TAPENAME DS    0F
         DC    CL6'2400'
         DC    CL6'3400'
DASDTAB  DS    0F
         DC    X'07'               2305-2
         DC    X'09'               3330
         DC    X'0A'               3340
         DC    X'0D'               3330-11
         DC    X'0B'               3350
         DC    X'0C'               3375                     AXC-CBT
         DC    X'0E'               3380                     AXC-CBT
DASDNUM  EQU   *-DASDTAB
DASDNAME DS    0F
         DC    CL6'2305-2'
         DC    CL6'3330  '
         DC    CL6'3340  '
         DC    CL6'3330-1'
         DC    CL6'3350  '
         DC    CL6'3375  '                                  AXC-CBT
         DC    CL6'3380  '                                  AXC-CBT
DISPTAB  DS    0F
         DC    X'09'               3277
         DC    X'0A'               3284
         DC    X'0B'               3286
         DC    X'08'               3066
DISPNUM  EQU   *-DISPTAB
DISPNAME DS    0H
         DC    CL6'3277'
         DC    CL6'3284'
         DC    CL6'3286'
         DC    CL6'3066'
HEXTR    DC    C'0123456789ABCDEF'
WTO      DSECT
USAVAREA DS    18F                 *XA SAVEAREA USED BY UCB SCAN RTN
PARMLST  DS    0D                  *XA                          GLA-BFG
PARMWA   DS    AL4                 *XA                          GLA-BFG
PARMDEVT DS    A                   *XA                          GLA-BFG
PARMUCB  DS    A                   *XA                          GLA-BFG
ERRMSG   DS    CL4
EUNIT    DS    CL32
         DS    0F
WTOCTL1  DS    CL4
WUNIT    DS    CL3
         DS    CL2
WSER     DS    CL6
         DS    CL2
WONOFF   DS    CL3
         DS    CL7
WDEVT    DS    CL6
         DS    CL5
WASID    DS    CL4
         DS    CL7
WPATH    DS    CL3
         DS    0F
WTOCTL2  DS    CL4
WTODISP  DS    CL7
WDMCT    DS    CL2
         DS    CL6
WUSCT    DS    CL2
         DS    CL6
WRSCT    DS    CL2
         DS    CL6
WFLG1    DS    CL8
         DS    CL1
WFLG2    DS    CL8
         DS    CL1
         DS    0F
WTOCTL3  DS    CL4
WTOCTL3M DS    CL48
         DS    0F
MATRXWTO DS    CL4
MATRXCU  DS    CL6
MATRXPTH DS    CL9
MATRXLN  DS    CL32
WCU      DS    CL1
SAVRET   DS    F
XSASAVE  DS    F
RETCODE  DS    F
VLSERLEN DS    F
UCBDMLOW DS    F
UCBDMCUR DS    F
UCBDMSAV DS    4F
ESTAELST DS    0F,(ESTAEOVX)X                         ****(RLL)****
ADDRUCB  DS    F                   *XA
         DS    0D                  *XA
WORKAREA DS    CL100               *XA
WTOEND   DS    0D
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSJ03D
         TITLE 'XA1SJ03D -   #I  DISPLAY SYSTEM INDICATORS'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SE2SJ03D -       #I  DISPLAY SYSTEM INDICATORS            ***
***                                                                 ***
***       VERSION -        2.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.0                            ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                                  ADD #IC SUBCOMMAND             ***
***                        08/10/81  JGS - #IR SUBCOMMAND ADDED   NERDC
***                        11/14/82  LMB-CBT FIX #IC FOR 1.3        ***
***                        05/26/83  JAL-SNET FIX CONTROL BLOCK     ***
***                                      CHAINING                   ***
***                        02/07/84  JAL-SNET FIX CONTROL BLOCK     ***
***                                      CHAINING, ADD 31-B1T CODING***
***                                      FOR XA.                    ***
***                        04/22/86  GLA-BFG FIX CVT CALL FOR LKED  ***
***                                      UNRESOLVED EXTRNS          ***
***                        04/26/86  GLA-BFG FIX ESTAE FOR BUG      ***
***                                      FIX #IA FOR ASMVT CHANGE   ***
***                        05/31/86  GLA-BFG IX AND IA FOR XA       ***
***                                      CONTROL BLOCKS             ***
***                        01/22/90  GLA-BFG CORRECT SIZE FOR ESA   ***
***                                      CONTROL BLOCKS             ***
***                        08/19/91  JCL-TEC FIXED RCT OFFSETS      ***
***                                      REMOVED ASMQ AND DEMAND    ***
***                                      PAGING RATE.               ***
***                                      FIXED WAMT OFFSETS.        ***
***                                      EXPANDED SWAP COUNT FIELDS ***
***********************************************************************
***********************************************************************
*-------------------------------------------------------------*    @TEC
*                                                             *    @TEC
* PROGRAMMING NOTE: THE LOGIC FOR #IX USES A CONTROL BLOCK    *    @TEC
*  CALLED "WAMT". THIS IS AN 88-BYTE HEADER, FOLLOWED BY A    *    @TEC
*  LIST OF FULLWORD OFFSETS (FROM THE START OF THE WAMT),     *    @TEC
*  FOLLOWED BY AN ARRAY OF 76-BYTE WAMP'S ONE FOR EACH PERF   *    @TEC
*  GROUP PERIOD. EACH OFFSET (IF DIFFERENT FROM THE PRIOR)    *    @TEC
*  POINTS TO THE WAMP FOR THE 1ST PERIOD OF A NEW PERFGRP.    *    @TEC
*  IF NOT DIFFERENT FROM THE PRIOR, IT IS A PLACEHOLDER FOR   *    @TEC
*  A PERFORMANCE GROUP NOT IN USE. THE FUNCTION OF THE TABLE  *    @TEC
*  OF OFFSETS ISN'T CLEARLY DOCUMENT IN THE DATA AREAS BOOK!  *    @TEC
*                                                             *    @TEC
*-------------------------------------------------------------*    @TEC
IEESJ03D CSECT
IEESJ03D AMODE 24
IEESJ03D RMODE 24
         SPLEVEL SET=2
         LR    R12,R15
         USING IEESJ03D,R12
         L     R0,SIZE             GETMAIN SIZE
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDRESS
         ST    R2,XSASAVE
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                     -JAL/XA-
         BSM   0,R9                                           -JAL/XA-
AMODE31  DC    A(CONT31+X'80000000')                          -JAL/XA-
CONT31   DS    0H                                             -JAL/XA-
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         L     R3,XAL              LOAD PARM
         LA    R3,0(0,R3)
         LTR   R3,R3               ANY SUB-PARMS
         BNZ   PARM                YES, GO PROCESS
         MVC   WTOLIST(4),=X'00280100'                             WJB
         MVC   WTOLIST+4(36),LINE1
         L     R4,16               CVT
         L     R4,604(0,R4)        RMCT
         L     R5,20(0,R4)         RMCA
         L     R4,24(0,R4)         WMST
         LA    R6,LINES            LINE FORMATS
         LA    R5,244(0,R5)        SWAP COUNTS IN RMCA         -JAL/XA-
         LA    R7,14               NUMBER OF LINES                 WJB
         MVC   WTOLIST+26(2),4(R4) IPS ID                          WJB
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              MCS ID OF REQUESTING CONSOLE
         SVC   35
PRINT0   L     R4,16               CVT ADDRESS
         L     R4,604(0,R4)        RMCT ADDRESS
         L     R8,4(R4)            CCT ADDRESS
         L     R4,228(R4)          RCT ADDRESS
         MVC   WTOLIST(54),SRMOVLY
         SR    R1,R1
         LH    R1,104(R8)          LONG TERM CPU AVG
         SLR   R0,R0               CLEAR REG. 0 FOR DIVIDE
         D     R0,=F'256'          NORMALIZE THE VALUE
         CVD   R1,DOUBLE
         MVC   WTOLIST+8(4),=X'40212020'
         ED    WTOLIST+8(4),DOUBLE+6
         LH    R1,102(0,R8)        AVERAGE CPU
         CVD   R1,DOUBLE
         MVC   WTOLIST+18(4),=X'40212020'
         ED    WTOLIST+18(4),DOUBLE+6
         LH    R1,72(0,R4)         AVERAGE PAGING
         CVD   R1,DOUBLE
         MVC   WTOLIST+28(4),=X'40212020'
         ED    WTOLIST+28(4),DOUBLE+6
         LH    R1,62(0,R4)         AVERAGE UIC
         CVD   R1,DOUBLE
         MVC   WTOLIST+38(4),=X'40212020'
         ED    WTOLIST+38(4),DOUBLE+6
         LH    R1,70(0,R4)         AVERAGE ASMQ
         CVD   R1,DOUBLE
         MVC   WTOLIST+48(4),=X'40212020'
         ED    WTOLIST+48(4),DOUBLE+6
PRINT    LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              MCS ID OF REQUESTING CONSOLE
         SVC   35
         MVI   WTOLIST+4,C' '
         MVC   WTOLIST+5(49),WTOLIST+4
         BCT   R7,PRINT1
         B     EXIT
         SPACE 3
PRINT1   MVC   WTOLIST+4(36),0(R6) SET A LINE
         L     R1,0(0,R5)          LOAD SWAP COUNT
         CVD   R1,DOUBLE
         MVC   WTOLIST+32(10),=X'40206B2020206B202120'             @TEC
         ED    WTOLIST+32(10),DOUBLE+4                             @TEC
         LA    R5,4(0,R5)          NEXT COUNT
         LA    R6,36(0,R6)         NEXT LINE
         B     PRINT
         SPACE 3
EXIT     EQU   *
         ESTAE 0
         L     R0,SIZE             GETMAIN SIZE
         LR    R1,R13              AREA ADDRESS
         L     R14,SAVRET          LOAD RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         LA    R8,AMODE24                                  -JAL/XA-
         BSM   0,R8                                        -JAL/XA-
AMODE24  DS    0H                                          -JAL/XA-
         SR    R15,R15
         BR    R14
         SPACE 3
PARM     CLI   0(R3),C'P'          PAGE DS DISPLAY
         BE    PART                YES, GO PROCESS
         CLI   0(R3),C'C'          PAGE DS DISPLAY
         BE    PCCW                YES, GO PROCESS
         CLI   0(R3),C'A'          ASM DISPLAY
         BE    ASM                 YES, GO PROCESS
         CLI   0(R3),C'S'          SWAP DS DISPLAY
         BE    SART                YES, GO PROCESS
         CLI   0(R3),C'X'          PERFORMANCE GROUP DISPLAY
         BE    PERF                YES, GO PROCESS
         CLI   0(R3),C'R'          RCT DISPLAY                    NERDC
         BE    RCT                 YES, GO PROCESS                NERDC
         LA    R1,PARMERR
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT
PCCW     SR    R5,R5               CLEAR REG 5
         L     R3,16               CVT
         L     R3,704(0,R3)        ASMVT
         L     R4,72(0,R3)         NUMBER OF PCCWS CREATED BY RIM
         L     R3,64(0,R3)         POINTER TO FIRST AVAILABLE PCCW
         LTR   R3,R3               ARE THERE ANY AVAILABLE PCCWS
         BZ    ALLDONE             IF NOT THEN PRINT 0000'S IN MSG
         A     R5,=F'1'            ADD ONE TO COUNTER PCCW IS AVAIL
DOITTOIT L     R3,12(0,R3)         GET POINTER TO NEXT PCCW LMB-CBT
         LTR   R3,R3               IS IT THE LAST ONE
         BZ    ALLDONE             IF SO THEN ALL DONE
         A     R5,=F'1'            ADD ONE TO COUNTER
         B     DOITTOIT            GO GET THE NEXT ONE
ALLDONE  CVD   R4,DOUBLE           CONVERT TOTAL NUM OF PCCWS
         MVC   WTOLIST(34),PCCWMSG1  SET UP WTO
         UNPK  WTOLIST+34(8),DOUBLE  UNPK TOTAL NUMBER OF PCCWS
         OI    WTOLIST+41,X'F0'      MAKE IT PRINTABLE
         LA    R1,WTOLIST            SET UP SVC 35
         SR    R0,R0                 SET UP SVC 35
         IC    R0,XAU
         SVC   35
         CVD   R5,DOUBLE           CONVERT TOTAL NUM OF PCCWS
         MVC   WTOLIST(34),PCCWMSG2  SET UP WTO
         UNPK  WTOLIST+34(8),DOUBLE  UNPK AVAILABLE PCCWS
         OI    WTOLIST+41,X'F0'      MAKE IT PRINTABLE
         LA    R1,WTOLIST            SET UP SVC 35
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT                GET OUT BOZO
PART     L     R3,16               CVT
         L     R3,704(0,R3)        ASMVT
         L     R3,8(0,R3)          PART
         L     R4,24(0,R3)         DSNAME TABLE
         LA    R3,80(0,R3)         PART ENTRIES
         SPACE 3
PART1    MVI   PARTDSP1,C' '
         MVC   PARTDSP1+1(47),PARTDSP1
         MVC   PARTDSP2(44),PARTOVLY
         MVC   PARTNAME(18),0(R4)  DSNAME
         MVC   PARTTYPE(4),=C'PLPA'
         TM    8(R3),X'80'
         BO    PART2
         MVC   PARTTYPE(4),=C'COMN'
         TM    8(R3),X'40'
         BO    PART2
         MVC   PARTTYPE(4),=C'DPLX'
         TM    8(R3),X'20'
         BO    PART2
         MVC   PARTTYPE(4),=C'LOCL'
PART2    L     R1,44(0,R3)         UCB ADDR
         MVC   PARTUNIT(3),13(R1)  UNIT ADDR
         MVC   PARTVOL(6),28(R1)   VOLSER
         L     R15,16(0,R3)        SIZE IN SLOTS
         CVD   R15,DOUBLE
         UNPK  PARTSIZE(5),DOUBLE+5(3)
         OI    PARTSIZE+4,X'F0'
         L     R9,20(0,R3)         AVAILABLE SLOTS
         CVD   R9,DOUBLE
         UNPK  PARTAVAL(5),DOUBLE+5(3)
         OI    PARTAVAL+4,X'F0'
         SR    R8,R8
         M     R8,=F'100'
         DR    R8,R15              CALCULATE PERCENT AVAILABLE
         L     R8,=F'100'
         SR    R8,R9               PERCENT USED
         CVD   R8,DOUBLE
         OI    DOUBLE+7,X'0F'      FORCE + SIGN
         UNPK  PARTPCNT(2),DOUBLE+6(2)
         CLC   DOUBLE+6(2),=X'100F'   100 PERCENT
         BNE   *+10                NO, LEAVE ALONE
         MVC   PARTPCNT(2),=C'99'  MAKE IT 99 PERCENT
         L     R1,56(0,R3)         PARERQTM -   BURST COMPUTATION VALUE
         SRL   R1,8                DIVIDE BY 256
         CVD   R1,DOUBLE
         UNPK  PARTBRST(3),DOUBLE+6(2)
         OI    PARTBRST+2,X'F0'
         MVC   PARTERR(8),=CL8'ERR(000)'
         L     R1,24(0,R3)         LOAD PART ENTRY ERROR COUNT
         CVD   R1,DOUBLE
         UNPK  PARTERR+4(3),DOUBLE+6(2)
         OI    PARTERR+6,X'F0'
         MVC   PARTLST1(4),=X'00340100'
         LA    R1,PARTLST1
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         MVC   PARTLST2(4),=X'00300100'
         LA    R1,PARTLST2
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         SPACE 3
PART3    LA    R4,44(0,R4)         NEXT DSNAME
         LA    R3,X'60'(0,R3)      NEXT PART ENTRY             ESA
         CLI   8(R3),X'00'         END OF PART
         BE    EXIT                YES, EXIT
         TM    9(R3),X'80'         NOT IN USE
         BO    PART3               YES, GET NEXT
         B     PART1
SART     L     R3,16               CVT
         L     R3,704(0,R3)        ASMVT
         L     R3,4(0,R3)          SART
         L     R4,24(0,R3)         DSNAME TABLE
         SPACE 3
SART0    MVC   SARTDSP0(42),SARTOVL0
         MVC   SARTNO(4),=XL4'40202120'
         MVC   SARTTAVL(6),=XL6'402020202120'
         MVC   SARTPGST(6),=XL6'402020202120'
         MVC   SARTLST0(4),=X'002E0100'
         LH    R1,8(0,R3)          NO. OF SWAP DS IN USE          ESA
         CVD   R1,DOUBLE
         ED    SARTNO(4),DOUBLE+6
         LR    R10,R1              SAVE NO. OF SWAP DS
         L     R1,36(0,R3)         AVAILABLE SWAP SETS TOTAL
         CVD   R1,DOUBLE
         ED    SARTTAVL(6),DOUBLE+5
         L     R1,56(0,R3)         PAGES/SWAPSET
         CVD   R1,DOUBLE
         ED    SARTPGST(6),DOUBLE+5
         LA    R1,SARTLST0
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         LA    R3,80(0,R3)         SART ENTRIES
         LTR   R10,R10             ANY SWAP DS IN USE
         BZ    SARTNMSG            NO, ISSUE MSG
         SPACE 3
SART1    MVI   SARTDSP1,C' '
         MVC   SARTDSP1+1(47),SARTDSP1
         MVC   SARTDSP2(42),SARTOVL2
         MVC   SARTNAME(18),0(R4)  DSNAME
         MVC   SARTLST1(4),=X'00340100'
         MVC   SARTLST2(4),=X'002E0100'
         L     R1,44(0,R3)         UCB ADDR
         MVC   SARTUNIT(3),13(R1)  UNIT ADDR
         MVC   SARTVOL(6),28(R1)   VOLSER
SART2    L     R15,16(0,R3)        SIZE IN SWAP SETS
         CVD   R15,DOUBLE
         UNPK  SARTSIZE(4),DOUBLE+5(3)
         OI    SARTSIZE+3,X'F0'
         L     R9,20(0,R3)         AVAILABLE SWAP SETS
         CVD   R9,DOUBLE
         UNPK  SARTAVAL(4),DOUBLE+5(3)
         OI    SARTAVAL+3,X'F0'
         SR    R8,R8
         M     R8,=F'100'
         DR    R8,R15              CALCULATE PERCENT AVAILABLE
         L     R8,=F'100'
         SR    R8,R9               PERCENT USED
         CVD   R8,DOUBLE
         OI    DOUBLE+7,X'0F'      FORCE + SIGN
         UNPK  SARTPCNT(2),DOUBLE+6(2)
         CLC   DOUBLE+6(2),=X'100F'   100 PERCENT
         BNE   *+10                NO, LEAVE ALONE
         MVC   SARTPCNT(2),=C'99'  MAKE IT 99 PERCENT
         L     R1,24(0,R3)         SWAP SETS IN ERROR
         CVD   R1,DOUBLE
         UNPK  SARTERR(4),DOUBLE+5(3)
         OI    SARTERR+3,X'F0'
         LA    R1,SARTLST1
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         LA    R1,SARTLST2
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         SPACE 3
SART3    BCT   R10,*+8             PROCESS NEXT ENTRY
         B     EXIT                END
         LA    R4,44(0,R4)         NEXT DSNAME
         LA    R3,X'50'(0,R3)      NEXT SART ENTRY            ESA
         TM    9(R3),X'80'         NOT IN USE
         BO    SART3               YES, GET NEXT
         B     SART1
         SPACE 3
SARTNMSG LA    R1,SARTMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT
ASM      MVC   WTOLIST(4),=X'001A0100'
         L     R4,16               CVT
         L     R4,704(0,R4)        ASMVT
         MVC   WTOLIST+4(12),=CL12'ILRSLOTC'
         MVC   WTOLIST+16(10),=C'NO BACKING'                    GLA-BFG
         L     R1,104(0,R4)        LOAD
         C     R1,=X'7FFFFFFF'       SLOTC                      GLA-BFG
         BE    ASM1A                    AND SKIP IF DEFAULT     GLA-BFG
         CVD   R1,DOUBLE                       CONVERT
         MVC   WTOLIST+16(10),=X'40206B2020206B202120'
         ED    WTOLIST+16(10),DOUBLE+4
ASM1A    BAL   R5,APRINT           GO PRINT RESULTS             GLA-BFG
         MVC   WTOLIST+4(12),=CL12'ILRSLOTV'
         MVC   WTOLIST+16(10),=C'NO BACKING'                    GLA-BFG
         L     R1,128(0,R4)        LOAD
         C     R1,=X'7FFFFFFF'       SLOTV                      GLA-BFG
         BE    ASM2A                    AND SKIP IF DEFAULT     GLA-BFG
         CVD   R1,DOUBLE                 AND CONVERT
         MVC   WTOLIST+16(10),=X'40206B2020206B202120'
         ED    WTOLIST+16(10),DOUBLE+4
ASM2A    BAL   R5,APRINT           GO PRINT RESULTS
         LA    R4,108(0,R4)        ASM COUNTS
         MVC   WTOLIST+4(12),=CL12'AVAIL SLOTS'
         BAL   R5,AFORM            GO FORMAT
         MVC   WTOLIST+4(12),=CL12'TOTAL SLOTS'
         BAL   R5,AFORM            GO FORMAT
         MVC   WTOLIST+4(12),=CL12'VIO SLOTS'
         BAL   R5,AFORM            GO FORMAT
         MVC   WTOLIST+4(12),=CL12'ADSPC SLOTS'
         BAL   R5,AFORM            GO FORMAT
         MVC   WTOLIST+4(12),=CL12'BAD SLOTS'
         BAL   R5,AFORM            GO FORMAT
         B     EXIT                EXIT
         SPACE 3
AFORM    L     R1,0(0,R4)          LOAD COUNT
         CVD   R1,DOUBLE              AND CONVERT
         MVC   WTOLIST+16(10),=X'40206B2020206B202120'
         ED    WTOLIST+16(10),DOUBLE+4
         LA    R4,4(0,R4)          NEXT COUNT
         SPACE 3
APRINT   LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              UCM ID
         SVC   35                  ISSUE WTO
         MVI   WTOLIST+4,C' '                                   -JAL-
         MVC   WTOLIST+5(36),WTOLIST+4                          -JAL-
         BR    R5                  RETURN
PERF     L     R4,16               CVT
         L     R4,604(0,R4)        RMCT
         L     R5,88(0,R4)         WAMT
         LH    R7,34(0,R5)         MAX PERFORM GROUP NUMBER        @TEC
         SR    R8,R8
         LA    R9,88(0,R5)         WAMP OFFSET TABLE               @TEC
         SR    R10,R10
         SR    R11,R11
         XC    WAMPTOTL(80),WAMPTOTL
         MVC   WTOLIST(54),PERFOVLY
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              MCS ID OF REQUESTING CONSOLE
         SVC   35
         SPACE 1
PERF1    DS    0H
         CLC   0(4,R9),4(R9)       NEXT SAME AS PREVIOUS
         BE    PERF3               YES, GET NEXT OFFSET
         L     R6,0(0,R9)          WAMP OFFSET
         L     R15,4(0,R9)         NEXT OFFSET
         SR    R15,R6
         SR    R14,R14
         LA    R1,76               WAMP LENGTH                     @TEC
         DR    R14,R1
         CH    R15,=H'1'           ONLY ONE
         BE    *+10                YES
         LR    R11,R15             SAVE NUMBER OF PERIODS
         LA    R10,1               1ST PERIOD
         AR    R6,R5               WAMP ADDRESS
         SPACE 1
PERF2    CVD   R8,DOUBLE
         TM    46(R6),X'80'   IS THIS A RPT PGN                 GLA-BFG
         BO    PERF3          IF SO SKIP                        GLA-BFG
         MVI   WTOLIST+4,C' '
         MVC   WTOLIST+5(49),WTOLIST+4
         UNPK  WTOLIST+4(3),DOUBLE+6(2)
         OI    WTOLIST+6,X'F0'
         CVD   R10,DOUBLE
         UNPK  WTOLIST+9(1),DOUBLE+7(1)
         OI    WTOLIST+9,X'F0'
         CLI   WTOLIST+9,C'0'      ONE PERIOD IN PGN
         BNE   *+10                NO
         MVC   WTOLIST+8(3),=C'ALL'
         L     R15,0(0,R6)         NUMBER OF TRANSACTIONS
         LR    R3,R15              SAVE NO. OF TRANS
         L     R1,0(0,R6)          NUMBER OF TRANSACTIONS
         A     R1,WAMPTOTL
         ST    R1,WAMPTOTL         SAVE TOTAL FOR ALL PERIODS
         LTR   R15,R15             ZERO
         BZ    PERF3               YES, NO PRINT
         CVD   R15,DOUBLE
         MVC   WTOLIST+12(7),=X'4020206B202120'
         ED    WTOLIST+12(7),DOUBLE+5
         SR    R14,R14
         L     R15,40(0,R6)        TOTAL SWAPS
         L     R1,40(0,R6)         NUMBER OF SWAPS
         A     R1,WAMPTOTL+40
         ST    R1,WAMPTOTL+40      SAVE TOTAL FOR ALL PERIODS
         DR    R14,R3              DIVIDE BY ENDED TRANSACTIONS
         CVD   R15,DOUBLE          AVG SWAPS
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R3              AVG HUNDREDTHS SWAPS
         CVD   R15,DOUBLEX
         MVC   WTOLIST+38(7),=X'402021204B2020'
         ED    WTOLIST+38(4),DOUBLE+6
         UNPK  WTOLIST+43(2),DOUBLEX+6(2)
         OI    WTOLIST+44,X'F0'
         SR    R14,R14
         L     R15,12(0,R6)        TOTAL ELAPSED TIME FOR ENDED TRANS
         L     R1,12(0,R6)         TOTAL TIME
         A     R1,WAMPTOTL+12
         ST    R1,WAMPTOTL+12      SAVE TOTAL FOR ALL PERIODS
         DR    R14,R3              DIVIDE BY ENDED TRANSACTIONS
         SR    R14,R14
         D     R14,=F'1000'
         CVD   R15,DOUBLE          AVG SECONDS RESPONSE TIME
         SRDL  R14,32
         D     R14,=F'10'
         CVD   R15,DOUBLEX         AVG HUNDREDTHS RESPONSE TIME
         MVC   WTOLIST+45(9),=X'4020202021204B2020'
         ED    WTOLIST+45(6),DOUBLE+5
         UNPK  WTOLIST+52(2),DOUBLEX+6(2)
         OI    WTOLIST+53,X'F0'
         L     R3,8(0,R6)          TOTAL SERVICE
         L     R1,8(0,R6)          TOTAL SERVICE
         A     R1,WAMPTOTL+8
         ST    R1,WAMPTOTL+8       SAVE TOTAL FOR ALL PERIODS
         SR    R14,R14
         LR    R15,R3
         M     R14,=F'1000'
         LR    R3,R15              SERVICE TIMES 1000
         L     R15,4(0,R6)         TOTAL TRANS TIME
         L     R1,4(0,R6)          TOTAL TRANS TIME
         A     R1,WAMPTOTL+4
         ST    R1,WAMPTOTL+4       SAVE TOTAL FOR ALL PERIODS
         SR    R14,R14
         LR    R1,R15
         LR    R15,R3
         DR    R14,R1              DIVIDE SERVICE
         CVD   R15,DOUBLE          AVG TR SERVICE
         MVC   WTOLIST+20(7),=X'4020206B202120'
         ED    WTOLIST+20(7),DOUBLE+5
         SR    R14,R14
         L     R15,36(0,R6)        TOTAL RES TIME
         L     R1,36(0,R6)         TOTAL RES TIME
         A     R1,WAMPTOTL+36
         ST    R1,WAMPTOTL+36      SAVE TOTAL FOR ALL PERIODS
         SR    R14,R14
         LR    R1,R15
         LR    R15,R3
         DR    R14,R1              DIVIDE SERVICE
         CVD   R15,DOUBLE          AVG ABS RATE
         MVC   WTOLIST+29(7),=X'4020206B202120'
         ED    WTOLIST+29(7),DOUBLE+5
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              MCS ID OF REQUESTING CONSOLE
         SVC   35
PERF3    LTR   R11,R11             MULTIPLE PERIODS OR 'ALL'
         BZ    PERF5               NO
         LA    R1,76               WAMP SIZE                       @TEC
         AR    R6,R1               NEXT PERIOD WAMP
         LA    R10,1(0,R10)        BUMP PERIOD NUMBER
         CR    R11,R10             END OF PERIODS
         BNL   PERF2               NO
         SPACE 1
PERF4    SR    R10,R10
         SR    R11,R11
         LA    R6,WAMPTOTL
         B     PERF2               PRINT TOTALS
         SPACE 1
PERF5    LA    R9,4(0,R9)          INCR INTO TABLE
         XC    WAMPTOTL(80),WAMPTOTL
         LA    R8,1(0,R8)          INCR PGN NUMBER                 @TEC
         BCT   R7,PERF1
         B     EXIT
RCT      DS    0H                                                 NERDC
         MVC   WTOLIST(4),=X'00290100'  LENGTH AND FLAGS          NERDC
         MVC   WTOLIST+4(37),RCTLINE0   TITLE LINE                NERDC
         BAL   R5,APRINT           PRINT IT                       NERDC
         L     R4,16               CVT                            NERDC
         USING CVTDSECT,R4         ADDRESSING                     NERDC
         L     R4,CVTOPCTP         POINT TO SRM CNTL BLKS         NERDC
         USING RMCT,R4             ADDRESSING                     NERDC
         L     R4,RMCTRCT          POINT TO SRM RCT               NERDC
         USING RCTDSECT,R4         ADDRESSING FOR RCT (FINALLY)   NERDC
         CLC   =C'RCT ',RCTRCT     FOUND IT?                      NERDC
         BNE   RCTBAD              NOPE - GIVE UP                 NERDC
         SPACE 1                                                  NERDC
         MVI   WTOLIST+4,C' '           SECOND TITLE LINE         NERDC
         MVC   WTOLIST+5(36),WTOLIST+4  SECOND TITLE LINE         NERDC
         MVC   WTOLIST+28(9),RCTLINE1   SECOND TITLE LINE         NERDC
         BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
         MVC   WTOLIST+4(15),=C'CPU UTILIZATION'               -JAL-
         LH    R1,RCVCPUA                                         NERDC
         LA    R1,7(,R1)           BUMP FOR AVERAGE               NERDC
         SRL   R1,4                DIVIDE BY 16                   NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+20(5),DOUBLE                             NERDC
         LH    R1,RCCCPUTL                                        NERDC
         LA    R1,7(,R1)           BUMP FOR AVERAGE               NERDC
         SRL   R1,4                DIVIDE BY 16                   NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+27(5),DOUBLE                             NERDC
         LH    R1,RCCCPUTH                                        NERDC
         LA    R1,7(,R1)           BUMP FOR AVERAGE               NERDC
         SRL   R1,4                DIVIDE BY 16                   NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+32(5),DOUBLE                             NERDC
         BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
         MVC   WTOLIST+4(19),=C'CPU UTIL W/ DEM PAG'           -JAL-
         LH    R1,RCCCPUPL                                        NERDC
         LA    R1,7(,R1)           BUMP FOR AVERAGE               NERDC
         SRL   R1,4                DIVIDE BY 16                   NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+27(5),DOUBLE                             NERDC
         LH    R1,RCCCPUPH                                        NERDC
         LA    R1,7(,R1)           BUMP FOR AVERAGE               NERDC
         SRL   R1,4                DIVIDE BY 16                   NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+32(5),DOUBLE                             NERDC
         BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
         MVC   WTOLIST+4(11),=C'PAGING RATE'                   -JAL-
         LH    R1,RCVPTR                                          NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+20(5),DOUBLE                             NERDC
         LH    R1,RCCPTRTL                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+27(5),DOUBLE                             NERDC
         LH    R1,RCCPTRTH                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+32(5),DOUBLE                             NERDC
         BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
*        MVC   WTOLIST+4(18),=C'DEMAND PAGING RATE'            -JAL-
*        LH    R1,RCVDPR                                          NERDC
*        BAL   R5,RCTBIN                                          NERDC
*        MVC   WTOLIST+4+20(5),DOUBLE                             NERDC
*        LH    R1,RCCDPRTL                                        NERDC
*        BAL   R5,RCTBIN                                          NERDC
*        MVC   WTOLIST+4+27(5),DOUBLE                             NERDC
*        LH    R1,RCCDPRTH                                        NERDC
*        BAL   R5,RCTBIN                                          NERDC
*        MVC   WTOLIST+4+32(5),DOUBLE                             NERDC
*        BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
         MVC   WTOLIST+4(17),=C'TOTAL PAGING RATE'             -JAL-
         LH    R1,RCVPAGRT                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+20(5),DOUBLE                             NERDC
         BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
         MVC   WTOLIST+4(20),=C'PAGE DELAY TIME (MS)'          -JAL-
         LH    R1,RCVMSPP                                         NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+20(5),DOUBLE                             NERDC
         LH    R1,RCCPDLTL                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+27(5),DOUBLE                             NERDC
         LH    R1,RCCPDLTH                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+32(5),DOUBLE                             NERDC
         BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
         MVC   WTOLIST+4(21),=C'PAGE DELAY W/ DEM PAG'         -JAL-
         LH    R1,RCCMSPTL                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+27(5),DOUBLE                             NERDC
         LH    R1,RCCMSPTH                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+32(5),DOUBLE                             NERDC
         BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
*        MVC   WTOLIST+4(13),=C'AVG ASM QUEUE'                 -JAL-
*        LH    R1,RCVASMQA                                        NERDC
*        BAL   R5,RCTBIN                                          NERDC
*        MVC   WTOLIST+4+20(5),DOUBLE                             NERDC
*        LH    R1,RCCASMTL                                        NERDC
*        BAL   R5,RCTBIN                                          NERDC
*        MVC   WTOLIST+4+27(5),DOUBLE                             NERDC
*        LH    R1,RCCASMTH                                        NERDC
*        BAL   R5,RCTBIN                                          NERDC
*        MVC   WTOLIST+4+32(5),DOUBLE                             NERDC
*        BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
         MVC   WTOLIST+4(7),=C'AVG UIC'                        -JAL-
         LH    R1,RCVUICA                                         NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+20(5),DOUBLE                             NERDC
         LH    R1,RCCUICTL                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+27(5),DOUBLE                             NERDC
         LH    R1,RCCUICTH                                        NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+32(5),DOUBLE                             NERDC
         BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
         MVC   WTOLIST+4(16),=C'AVG AVAIL FRAMES'              -JAL-
         LH    R1,RCVAFQA                                         NERDC
         BAL   R5,RCTBIN                                          NERDC
         MVC   WTOLIST+4+20(5),DOUBLE                             NERDC
         BAL   R5,APRINT           PRINT IT                       NERDC
         SPACE 1                                                  NERDC
         B     EXIT                DONE                           NERDC
         SPACE 3                                                  NERDC
RCTBIN   DS    0H                  CONVERT VALUE TO BIN           NERDC
         CVD   R1,DOUBLE           TO DECIMAL                     NERDC
         MVC   DOUBLE-1(6),=X'402020202120'                       NERDC
         ED    DOUBLE-1(6),DOUBLE+5                               NERDC
         BR    R5                  RETURN TO CALLER               NERDC
         SPACE 3                                                  NERDC
RCTBAD   DS    0H                                                 NERDC
         MVC   WTOLIST+4(17),=C'RCT NOT LOCATABLE'             -JAL-
         BAL   R5,APRINT           SEND MESSAGE                   NERDC
         B     EXIT                RETURN TO CALLER               NERDC
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESJ03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     EXIT
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
PARMERR  DC    X'001A0100',C'SUB-PARM NOT SUPPORTED'
         SPACE 3
SARTMSG  DC    X'001C0100',CL24'NO SWAP DATA SETS IN USE'
         SPACE 3
PCCWMSG1 DC    X'002A0100',CL30'NUMBER OF PCCWS BUILT BY RIM'
         SPACE 3
PCCWMSG2 DC    X'002A0100',CL30'NUMBER OF AVAILABLE PCCWS   '
         SPACE 3
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
LINE1    DC    CL22'CURRENT IPS -   IEAIPS'
         DC    CL2' ',CL12' '
         SPACE 3
LINES    DC    CL20'TERM WAIT - OUT',C'(01)',CL12' '
         DC    CL20'TERM WAIT - IN',C'(02)',CL12' '
         DC    CL20'LONG WAIT',C'(03)',CL12' '
         DC    CL20'AUX STOR SHORTAGE',C'(04)',CL12' '
         DC    CL20'REAL STOR SHORTAGE',C'(05)',CL12' '
         DC    CL20'DETECTED WAIT',C'(06)',CL12' '
         DC    CL20'REQUEST SWAP',C'(07)',CL12' '
         DC    CL20'ENQ EXCHANGE',C'(08)',CL12' '
         DC    CL20'WORKLOAD EXCHANGE',C'(09)',CL12' '
         DC    CL20'UNILATERAL SWAP',C'(0A)',CL12' '
         DC    CL20'TRANSITION SWAP',C'(0B)',CL12' '
         DC    CL20'LOGICAL SWAPS',C'(0C)',CL12' '
         DC    CL20'LOGICAL SWAPS FAIL',C'(0D)',CL12' '
PERFOVLY DS    0CL54
         DC    XL4'00360100'
         DC    CL50'PGN PER  TR CNT  TR RATE  AB RATE  SW RATE  AVGRSP'
*                   NN   N   NN,NNN  NNN.NN   NNN.NN   NNN.NN NNNNN.NN
         SPACE 3
SRMOVLY  DS    0CL54
         DC    XL4'00360100'
         DC    CL4'LGCP',CL6' '
         DC    CL4'AVCP',CL6' '
         DC    CL4'AVPG',CL6' '
         DC    CL4'AUIC',CL6' '
         DC    CL4'ASMQ',CL6' '
         SPACE 3
PARTOVLY DS    0CL44
         DC    CL5'SIZE(',CL5' '
         DC    CL8') AVAIL(',CL5' '
         DC    CL7') USED(',CL2' '
         DC    CL8'%) BRST(',CL3' ',C')'
         SPACE 3
SARTOVL0 DS    0CL42
         DC    CL9'SWAP  DS-'
         DC    CL4' '
         DC    CL7'  SETS-'
         DC    CL6' '
         DC    CL10'  PGS/SET-'
         DC    CL6' '
         SPACE 3
SARTOVL2 DS    0CL42
         DC    CL5'SIZE(',CL4' '
         DC    CL8') AVAIL(',CL4' '
         DC    CL7') USED(',CL2' '
         DC    CL7'%) ERR(',CL4' ',C')'
         SPACE 3                                                  NERDC
RCTLINE0 DC    CL37'SRM RESOURCE CONTROL TABLE'                   NERDC
RCTLINE1 DC    CL9'THRESHOLD'                                     NERDC
         SPACE 3                                                  NERDC
         LTORG ,                                                  NERDC
WORK     DSECT
WORKSTRT DS    0D
         DS    D                   SCRATCH BEFORE DOUBLE          NERDC
DOUBLE   DS    D
DL4      EQU   DOUBLE+4,4
DOUBLEX  DS    D
SAVRET   DS    F
XSASAVE  DS    F
WTOLIST  DS    CL54
WSC      EQU   WTOLIST+32,7
         SPACE 3
         DS    0F
PARTLST1 DS    CL4
PARTDSP1 DS    0CL48
PARTTYPE DS    CL4
         DS    CL2
PARTUNIT DS    CL4
         DS    CL2
PARTVOL  DS    CL6
         DS    CL2
PARTNAME DS    CL18
         DS    CL2
PARTERR  DS    CL8
         SPACE 3
         DS    0F
PARTLST2 DS    CL4
PARTDSP2 DS    0CL44
         DS    CL5
PARTSIZE DS    CL5
         DS    CL8
PARTAVAL DS    CL5
         DS    CL7
PARTPCNT DS    CL2
         DS    CL8
PARTBRST DS    CL3
         DS    C
         DS    0F
SARTLST0 DS    CL4
SARTDSP0 DS    0CL42
         DS    CL9
SARTNO   DS    CL4
         DS    CL7
SARTTAVL DS    CL6
         DS    CL10
SARTPGST DS    CL6
         SPACE 3
         DS    0F
SARTLST1 DS    CL4
SARTDSP1 DS    0CL48
SARTUNIT DS    CL4
         DS    CL2
SARTVOL  DS    CL6
         DS    CL4
SARTNAME DS    CL32
         SPACE 3
         DS    0F
SARTLST2 DS    CL4
SARTDSP2 DS    0CL42
         DS    CL5
SARTSIZE DS    CL4
         DS    CL8
SARTAVAL DS    CL4
         DS    CL7
SARTPCNT DS    CL2
         DS    CL7
SARTERR  DS    CL4
         DS    C
         DS    F
WAMPTOTL DS    CL80
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0D
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
RMCT     DSECT ,                                                  NERDC
         ORG   RMCT+228                                           NERDC
RMCTRCT  DS    F                   POINTER TO RCT                 NERDC
         ORG   ,                                                  NERDC
         SPACE 3                                                  NERDC
RCTDSECT DSECT ,                   SRM RES CNTL TABLE             NERDC
RCTRCT   DS    CL4                 'RCT'                          NERDC
RCCUICTL DS    H                   UIC THRESHOLD LOW              NERDC
RCCUICTH DS    H                   UIC THRESHOLD HIGH             NERDC
RCCCPUTL DS    H                   CPU THRESHOLD LOW              NERDC
RCCCPUTH DS    H                   CPU THRESHOLD HIGH             NERDC
RCCPTRTL DS    H                   PAGING THRESHOLD LOW           NERDC
RCCPTRTH DS    H                   PAGING THRESHOLD HIGH          NERDC
RCCASMTL DS    H                   ASM Q REQUEST THRESHOLD LOW    NERDC
RCCASMTH DS    H                   ASM Q REQUEST THRESHOLD HIGH   NERDC
RCCDPRTL DS    H                   DEMAND PAGE RATE LOW THRESH    NERDC
RCCDPRTH DS    H                   DEMAND PAGE RATE HIGH THRESH   NERDC
RCCCPUPL DS    H                   CPU UTIL W/ DEMAND PAGING LOW  NERDC
RCCCPUPH DS    H                   CPU UTIL W/ DEMAND PAGING HI   NERDC
RCCMSPTL DS    H                   PAGE DELAY W/ DEMAND PAGING LO NERDC
RCCMSPTH DS    H                   PAGE DELAY W/ DEMAND PAGING HI NERDC
RCCPDLTL DS    H                   PAGE DELAY TIME (MS) LOW       NERDC
RCCPDLTH DS    H                   PAGE DELAY TIME (MS) HIGH      NERDC
         ORG   RCTDSECT+52                                         @TEC
RCVCTMC  DS    H                   SAMPLE INTERVALS COUNT         NERDC
RCVUICA  DS    H                   UIC AVERAGE                    NERDC
RCVCPUA  DS    H                   CPU USAGE AVERAGE              NERDC
RCVAVQC  DS    H                   AVQ LOWW COUNT                 NERDC
RCVAFQA  DS    H                   AVG AVAIL FRAMES               NERDC
RCVRSVF6 DS    H                   WAS ASMQ                        @TEC
RCVPTR   DS    H                   PAGING RATE                    NERDC
RCVRSVF7 DS    H                   WAS DPR                         @TEC
RCVPAGRT DS    H                   TOTAL PAGING RATE              NERDC
RCVMSPP  DS    H                   PAGE DELAY TIME (MS)           NERDC
         ORG   ,                                                  NERDC
         PRINT NOGEN                                              NERDC
CVTDSECT CVT   DSECT=YES                                        GLA-BFG
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSK03D
         TITLE 'SE2SK03D -   #C  CALCULATOR/CONSOLE'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SE2SK03D -       #C  CALCULATOR/CONSOLE                   ***
***                                                                 ***
***       VERSION -        1.2                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   TO MVS/SP1.3 LEVEL        ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        01/26/83  AXC-CBT CHANGE ESTAE PARM LEN  ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESK03D CSECT
         LR    R12,R15
         USING IEESK03D,R12
         L     R0,SIZE
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         MVC   WTOLIST(4),=X'00300100'
         MVI   ANSWER,C' '         CLEAR
         MVC   ANSWER+1(43),ANSWER    WTO AREA
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         L     R3,XAL              LOAD SUB-PARM ADDR
         LTR   R3,R3               SUB-PARM PRESENT
         BNZ   CALC                YES, CONTINUE
         STCK  DOUBLE              STORE CLOCK
         UNPK  ANSWER(9),DOUBLE(5)
         NC    ANSWER(8),=8X'0F'
         TR    ANSWER(8),=C'0123456789ABCDEF'
         MVI   ANSWER+8,C' '
         SPACE 3
EXIT     LA    R1,WTOLIST          WTO PARM LIST ADDR
         SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         SVC   35                  WTO
EXIT1    EQU   *
         ESTAE 0
         L     R0,SIZE             LOAD FREEMAIN SIZE
         LR    R1,R13              LOAD FREEMAIN ADDR
         L     R14,SAVRET          LOAD RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14                 EXIT
SMFIDISP L     R4,16               CVT
         L     R4,196(0,R4)        SMCA
         L     R5,244(0,R4)        1ST RDS
         LA    R5,0(0,R5)
         L     R6,248(0,R4)        LAST RDS (DUMMY)
         LA    R6,0(0,R6)
         L     R7,252(0,R4)        CURRENT RDS
         LA    R7,0(0,R7)
         MVC   SMFLIST(4),=X'00340100'
         SPACE 1
SMFIDSP1 CR    R5,R6               LAST
         BE    EXIT1               YES
         MVI   SMFANS,C' '
         MVC   SMFANS+1(47),SMFANS
         MVC   SMFANS(16),16(R5)   SMF DSNAME
         CR    R5,R7               CURRENT
         BNE   SMFIDSP2            NO
         MVC   SMFANS+18(10),=CL10'CURRENT'
         B     SMFIDSP3
         SPACE 1
SMFIDSP2 TM    12(R5),X'04'        DS READY
         BZ    SMFIDSP3            NO
         MVC   SMFANS+18(10),=CL10'READY  '
         SPACE 1
SMFIDSP3 TM    12(R5),X'08'        DS WAITING FOR DUMP
         BZ    SMFIDSP4            NO
         MVC   SMFANS+18(10),=CL10'DUMP REQ'
         SPACE 1
SMFIDSP4 TM    13(R5),X'60'        I/O ERROR
         BZ    SMFIDSP5            NO
         MVC   SMFANS+28(10),=CL10'I/O ERROR'
         SPACE 1
SMFIDSP5 LA    R1,SMFLIST          WTO PARM LIST ADDR
         SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         SVC   35                  WTO
         SR    R14,R14
         L     R15,44(0,R5)        SMF DS NEXT BLOCK
         BCTR  R15,0
         CVD   R15,DOUBLEB
         M     R14,=F'100'
         L     R1,40(0,R5)         SMF DS CAPACITY
         CVD   R1,DOUBLEA
         DR    R14,R1              PERCENT FULL
         CVD   R15,DOUBLEC
         MVC   SMFANS(48),SMFANSOA
         MVC   SMFANS(10),=X'40206B2020206B202120'
         ED    SMFANS(10),DOUBLEA+4
         LA    R1,SMFLIST          WTO PARM LIST ADDR
         SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         SVC   35                  WTO
         MVC   SMFANS(48),SMFANSOB
         MVC   SMFANS(10),=X'40206B2020206B202120'
         ED    SMFANS(10),DOUBLEB+4
         MVC   SMFANS+29(4),=X'40202120'
         ED    SMFANS+29(4),DOUBLEC+6
         LA    R1,SMFLIST          WTO PARM LIST ADDR
         SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         SVC   35                  WTO
         L     R5,4(0,R5)          NEXT RDS
         LA    R5,0(0,R5)
         B     SMFIDSP1
         SPACE 3
SMFANSOA DC    CL48' X,XXX,XXX BLOCKS ALLOCATED'
         SPACE 3
SMFANSOB DC    CL48' X,XXX,XXX BLOCKS USED        XXX % FULL'
CALC     CLI   0(R3),C'M'          MSG REQUEST
         BE    MSGREQ              YES
         CLI   0(R3),C'B'          BROADCAST REQUEST
         BE    BRODCST             YES
         CLI   0(R3),C'S'          SMF ID DISPLAY REQUEST
         BE    SMFIDISP            YES
         CLI   0(R3),C'X'          LXYZ TRANSLATE REQUEST
         BE    LXYZREQ             YES
         CLI   0(R3),C'Z'          MSTCONS SWITCH REQUEST
         BE    MSTCONS             YES
         SPACE 1
CALC0    LA    R10,FIELDA          LOAD 1ST FIELD ADDR
         LA    R11,CALC2           RETURN POINT
         SPACE 3
CALC1    CLI   0(R3),C','          DECIMAL VALUE
         BE    DECCONV
         B     HEXCONV             HEX VALUE
         SPACE 3
CALC2    MVC   FUNCTION(1),0(R3)   SAVE FUNCTION CODE
         MVC   RESULT(4),FIELDA    SAVE 1ST FIELD IF JUST CONVERT
         CLI   FUNCTION,C' '       CONVERT FUNCTION
         BE    CONVERT             YES, CONTINUE
         LA    R3,1(0,R3)          NEXT VALUE START
         LA    R10,FIELDB          2ND FIELD ADDR
         LA    R11,CALC3           RETURN POINT
         B     CALC1
         SPACE 3
CALC3    CLI   0(R3),C' '          BLANK DELIMETER
         BNE   PARMERR             NO, ERROR
         SR    R4,R4               INIT FUNCTION WORK REGS
         L     R5,FIELDA
         L     R6,FIELDB
         CLI   FUNCTION,C'+'       ADD
         BE    ADD
         CLI   FUNCTION,C'-'       SUBTRACT
         BE    SUB
         CLI   FUNCTION,C'.'       MULTIPLY
         BE    MLT
         CLI   FUNCTION,C'/'       DIVIDE
         BE    DIV
         B     PARMERR             ERROR, INVALID FUNCTION
DECCONV  LA    R5,9                MAX LENGTH
         LA    R3,1(0,R3)          1ST BYTE OF FIELD
         CLI   0(R3),C'0'          VALID
         BL    PARMERR             NO, ERROR
         CLI   0(R3),C'9'          VALID
         BH    PARMERR             NO, ERROR
         LR    R6,R3               SAVE FIELD ADDR
         SPACE 3
DECCONV1 CLI   0(R3),C'0'          VALID
         BL    DECCONV2            NO
         CLI   0(R3),C'9'          VALID
         BH    DECCONV2            NO
         LA    R3,1(0,R3)          NEXT BYTE
         BCT   R5,DECCONV1
         B     PARMERR             ERROR, FIELD TOO LONG
         SPACE 3
DECCONV2 LR    R1,R3               CALCULATE
         BCTR  R1,0                   LENGTH
         SR    R1,R6
         EX    R1,PACK             PACK,
         CVB   R1,DOUBLE              CONVERT AND
         ST    R1,0(0,R10)               SAVE RESULT
         BR    R11                 EXIT
         SPACE 3
PACK     PACK  DOUBLE(8),0(1,R6)
HEXCONV  LA    R5,9                MAX LENGTH
         LR    R6,R3               SAVE FIELD ADDR
         SPACE 3
HEXCONV1 CLI   0(R3),C'A'          VALID
         BL    HEXCONV4            NO
         CLI   0(R3),C'F'          VALID
         BNH   HEXCONV2            YES
         CLI   0(R3),C'0'          VALID
         BL    HEXCONV4            NO
         CLI   0(R3),C'9'          VALID
         BH    HEXCONV4            NO
         NI    0(R3),X'0F'         SET UP FOR TRANSLATE LATER
         B     HEXCONV3
         SPACE 3
HEXCONV2 NI    0(R3),X'0F'         SET
         SR    R1,R1                  UP
         IC    R1,0(0,R3)                FOR
         LA    R1,9(0,R1)                   TRANSLATE
         STC   R1,0(0,R3)                      LATER
         SPACE 3
HEXCONV3 LA    R3,1(0,R3)          NEXT BYTE
         BCT   R5,HEXCONV1
         B     PARMERR             ERROR, FIELD TOO LONG
         SPACE 3
HEXCONV4 LR    R1,R3               CALCULATE
         SR    R1,R6                  LENGTH
         EX    R1,PACK             CREATE HEX
         MVC   0(4,R10),DOUBLE+3      AND SAVE RESULT
         BR    R11                 EXIT
ADD      AR    R5,R6               ADD FUNCTION
         ST    R5,RESULT           SAVE RESULT
         B     CONVERT             GO CONVERT AND PRINT
         SPACE 3
SUB      SR    R5,R6               SUBTRACT FUNCTION
         ST    R5,RESULT           SAVE RESULT
         B     CONVERT             GO CONVERT AND PRINT
         SPACE 3
MLT      LR    R4,R5               LOAD MULTIPLICAND
         MR    R4,R6               MULTIPLY FUNCTION
         ST    R5,RESULT           SAVE RESULT
         B     CONVERT             GO CONVERT AND PRINT
         SPACE 3
DIV      LTR   R6,R6               ZERO DIVISOR
         BZ    BADDIV              YES, ERROR
         DR    R4,R6               DIVIDE FUNCTION
         ST    R5,RESULT           SAVE RESULT,  QUOTIENT ONLY
         SPACE 3
CONVERT  UNPK  ANSWER(9),RESULT(5)
         NC    ANSWER(8),=8X'0F'
         TR    ANSWER(8),=C'0123456789ABCDEF'
         MVI   ANSWER+8,C' '
         L     R1,RESULT           LOAD RESULT
         CVD   R1,DOUBLE
         MVC   ANSWER2(15),MASK    EDIT MASK
         ED    ANSWER2(15),DOUBLE+2
         B     EXIT                GO PRINT
         SPACE 3
LXYZERR  MVC   ANSWER(44),LXYZMSG
         B     EXIT                GO PRINT ERROR MSG
         SPACE 3
PARMERR  MVC   ANSWER(44),ERRMSG
         B     EXIT                GO PRINT ERROR MSG
         SPACE 3
BADDIV   MVC   ANSWER(44),DIVMSG
         B     EXIT                GO PRINT ERROR MSG
MSGREQ   MVC   MSGTEXT(70),4(R3)
         MVC   MSGLIST(4),=X'004A0100'
         LA    R4,1                DEFAULT NO. OF MSGS
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),1(R3)
         CLC   DOUBLE(2),=C'00'
         BNE   MSGREQ1
         PACK  DOUBLE(8),1(2,R3)
         CVB   R4,DOUBLE
         LTR   R4,R4               FORCE AT LEAST 1
         BNZ   *+8
         LA    R4,1
         CH    R4,=H'30'           MAX
         BNH   MSGREQ1
         LA    R4,30
         SPACE 1
MSGREQ1  SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         LA    R1,MSGLIST          WTO PARM LIST ADDR
         SVC   35                  WTO
         BCT   4,MSGREQ1
         CLC   TESTWTO(2),=X'0A23' WTO REPLACED
         BE    EXIT1               NO
         LA    R1,MSGLIST          WTO PARM LIST ADDR
         SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         SVC   35                  WTO
         B     EXIT1
LXYZREQ  MVC   MSGTEXT(24),=CL24'LXYZ= L-XXX-YY-Z (NNNN)'
         MVC   MSGLIST(4),=X'001C0100'
         CLI   2(R3),C'-'          DECIMAL INPUT
         BE    LXYZREQ1            YES
         MVC   MSGTEXT+18(4),1(R3)
         LA    R10,FIELDA
         LA    R3,1(0,R3)
         BAL   R11,HEXCONV
         SR    R14,R14
         L     R15,FIELDA
         SLL   R15,16
         SLDL  R14,2               SHIFT IN 'L'
         CVD   R14,DOUBLE
         UNPK  MSGTEXT+6(1),DOUBLE+7(1)
         OI    MSGTEXT+6,X'F0'
         MVI   MSGTEXT+7,C'-'
         SR    R14,R14
         SLDL  R14,1               SHIFT IN 'Z'
         CVD   R14,DOUBLE
         UNPK  MSGTEXT+15(1),DOUBLE+7(1)
         OI    MSGTEXT+15,X'F0'
         SR    R14,R14
         SLDL  R14,5               SHIFT IN 'Y'
         CVD   R14,DOUBLE
         UNPK  MSGTEXT+12(2),DOUBLE+6(2)
         OI    MSGTEXT+13,X'F0'
         MVI   MSGTEXT+14,C'-'
         SR    R14,R14
         SLDL  R14,8               SHIFT IN 'X'
         CVD   R14,DOUBLE
         UNPK  MSGTEXT+8(3),DOUBLE+6(2)
         OI    MSGTEXT+10,X'F0'
         MVI   MSGTEXT+11,C'-'
         B     LXYZREQ2
         SPACE 1
LXYZREQ1 MVC   MSGTEXT+6(10),1(R3)
         LR    R7,R3
         CLI   6(R7),C'-'          DECIMAL INPUT
         BNE   LXYZERR             NO, ERROR
         CLI   9(R7),C'-'          DECIMAL INPUT
         BNE   LXYZERR             NO, ERROR
         LA    R10,FIELDA
         BAL   R11,DECCONV
         SR    R14,R14
         L     R15,FIELDA
         SLL   R15,30
         SLDL  R14,2               SHIFT IN 'L'
         LA    R3,9(0,R7)
         BAL   R11,DECCONV
         L     R15,FIELDA
         SLL   R15,31
         SLDL  R14,1               SHIFT IN 'Z'
         LA    R3,6(0,R7)
         BAL   R11,DECCONV
         L     R15,FIELDA
         SLL   R15,27
         SLDL  R14,5               SHIFT IN 'Y'
         LA    R3,2(0,R7)
         BAL   R11,DECCONV
         L     R15,FIELDA
         SLL   R15,24
         SLDL  R14,8               SHIFT IN 'X'
         ST    R14,FIELDA
         UNPK  DOUBLE(5),FIELDA+2(3)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   MSGTEXT+18(4),DOUBLE
         SPACE 1
LXYZREQ2 LA    R1,MSGLIST          WTO PARM LIST ADDR
         SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         SVC   35                  WTO
         B     EXIT1
MSTCONS  CLC   XAS(8),2(R3)        PASSWORD PROVIDED
         BNE   NOAUTH              NO
         L     R15,16              CVT
         L     R15,100(0,R15)      UCM BASE
         LA    R6,0(0,R15)         UCM
         S     R6,=F'4'               MCS
         L     R6,0(0,R6)                PREFIX ADDR
         L     R7,0(0,R6)          MSTCONS UCM ENTRY ADDR
         L     R9,72(0,R15)        UCM 1ST ENTRY ADDR
         LM    R4,R5,76(R15)       UCM ENTRY LENGTH AND LAST ENTRY ADDR
         SR    R14,R14
         IC    R14,XAU             CONSOLE ID TO SWITCH MSTCONS TO
         SPACE 1
MSTCONS1 CLM   R14,1,26(R9)        UCM ID MATCH
         BNE   MSTCONS2            NO, CHECK NEXT
         TM    25(R9),X'10'        IS CONSOLE ACTIVE
         BZ    MSTCONS3            NO, ERROR
         TM    42(R9),X'50'        IS CONSOLE DISPLAY TYPE
         BNZ   MSTCONS3            NO, ERROR
         B     MSTCONS4            YES, CONTINUE
         SPACE 1
MSTCONS2 BXLE  R9,R4,MSTCONS1      NEXT UCM ENTRY
         SPACE 1
MSTCONS3 LA    R1,UCMMSG           UCM ID ERROR MSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT1
         SPACE 1
MSTCONS4 ST    R9,0(0,R6)          SAVE NEW MSTCONS UCM ENTRY
         OI    42(R9),X'80'        SET MSTCONS BIT ON NEW MSTCONS
         NI    42(R7),X'7F'        SET MSTCONS BIT OFF OLD MSTCONS
         LA    R1,MSTCMSG          MSTCONS SWITCH MSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT1
         SPACE 1
NOAUTH   LA    R1,AUTHMSG          NO AUTHORITY
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT1
BRODCST  L     R15,16              CVT
         L     R15,100(0,R15)      UCM BASE
         L     R9,72(0,R15)        UCM 1ST ENTRY ADDR
         LM    R4,R5,76(R15)       UCM ENTRY LENGTH AND LAST ENTRY ADDR
         SR    R14,R14
         SPACE 1
BRODCST1 ICM   R14,1,26(R9)        LOAD UCMID
         TM    25(R9),X'10'        IS CONSOLE ACTIVE
         BZ    BRODCST2            NO, NEXT
         TM    42(R9),X'50'        IS CONSOLE DISPLAY TYPE
         BNZ   BRODCST2            NO, NEXT
         B     BRODCST3
         SPACE 1
BRODCST2 BXLE  R9,R4,BRODCST1      NEXT UCM ENTRY
         CLC   TESTWTO(2),=X'0A23' WTO REPLACED
         BE    EXIT1               NO
         LA    R1,MSGLIST          WTO PARM LIST ADDR
         SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         SVC   35                  WTO
         B     EXIT1
         SPACE 1
BRODCST3 STC   R14,XAU             SAVE UCMID
         MVC   MSGTEXT(70),4(R3)
         MVC   MSGLIST(4),=X'004A0100'
         LA    R8,1                DEFAULT NO. OF MSGS
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),1(R3)
         CLC   DOUBLE(2),=C'00'
         BNE   BRODCST4
         PACK  DOUBLE(8),1(2,R3)
         CVB   R8,DOUBLE
         LTR   R8,R8               FORCE AT LEAST 1
         BNZ   *+8
         LA    R8,1
         CH    R8,=H'30'           MAX
         BNH   BRODCST4
         LA    R8,30
         SPACE 1
BRODCST4 SR    R0,R0               LOAD
         IC    R0,XAU                 UCM ID
         LA    R1,MSGLIST          WTO PARM LIST ADDR
         SVC   35                  WTO
         BCT   R8,BRODCST4
         B     BRODCST2
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESK03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     EXIT1
         LTORG
         SPACE 5
TESTSEQ  IC    R0,XAU              UCM ID
TESTWTO  SVC   35                  WTO
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
MASK     DC    X'4020206B2020206B2020206B202120'
         SPACE 3
ERRMSG   DC    CL44'CALCULATOR PARAMETER ERROR'
         SPACE 3
LXYZMSG  DC    CL44'LXYZ TRANSLATE PARM ERROR'
         SPACE 3
UCMMSG   DC    X'00300100'
         DC    CL44'CONSOLE NOT ACTIVE, MSTCONS NOT SWITCHED'
         SPACE 3
AUTHMSG  DC    X'00300100'
         DC    CL44'AUTHORITY INVALID, MSTCONS NOT SWITCHED'
         SPACE 3
MSTCMSG  DC    X'00300100'
         DC    CL44'MSTCONS SWITCHED TO THIS CONSOLE'
         SPACE 3
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
DIVMSG   DC    CL44'ANY IDIOT KNOWS YOU CANNOT DIVIDE BY ZERO'
WORK     DSECT
WORKSTRT DS    0D
DOUBLE   DS    D
DOUBLEA  DS    D
DOUBLEB  DS    D
DOUBLEC  DS    D
FIELDA   DS    F
FIELDB   DS    F
RESULT   DS    F
SAVRET   DS    F
XSASAVE  DS    F
FUNCTION DS    C
         SPACE 3
         DS    0F
SMFLIST  DS    0CL52
         DS    F
SMFANS   DS    CL48
         DS    0F
WTOLIST  DS    0CL48
         DS    F
ANSWER   DS    CL8
         DS    CL4
ANSWER2  DS    CL32
         SPACE 3
         DS    0F
MSGLIST  DS    0CL74
         DS    F
MSGTEXT  DS    CL70
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0D
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSL03D
         PRINT NOGEN                                               @TEC
         TITLE 'IEESL03D -   #J  DISPLAY ACTIVE REPLACEMENT'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESL03D -       #J  DISPLAY ACTIVE REPLACEMENT           ***
***                                                                 ***
***       VERSION -        3.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        05/27/81                                 ***
***                        RICK LEOPOLDI RLL-CHANGE ESTAE PARM LEN. ***
***                                      RLL-HAVE IN & OUT DISPLAYSQQ**
***                        02/22/82 --BCB TEST FOR END OF ASCBS     ***
***                        05/25/83 - OUR VERSION OF #J             ***
***                        02/07/84 -JAL-SNET ADD 31-BIT CODING     ***
***                                      FOR XA.                    ***
***                        06/07/83 - FIX NUMBER OF ASCB ON         ***
***                                      #JC SO NO OVERLAY OF CSA   ***
***                        11/12/89 - FIX FOR ESA -                 ***
***                                      NO ASCBSEQN                ***
***                        20/08/91 -JCL-TEC CHANGE ELAPSED TIME    ***
***                                      FORMAT TO HHH:MM:SS        ***
***                                 -    DROPPED SEQN & RT          ***
***                                 -    FORMAT DEVICE CONNECT TIME ***
***                                 -    SHOW SWAP REASON CODE IN   ***
***                                      CLEAR TEXT, NOT HEX        ***
***                                 -    SHOW ON #JC ONLY IF CPU    ***
***                                      TIME ACCUMULATED           ***
***                                 -    USE AUTH SVC232/MODESET TO ***
***                                      DISPLAY VTAM TERMID        ***
***********************************************************************
***********************************************************************
IEESL03D CSECT
         LR    R12,R15
         USING IEESL03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         MVI   CPUSW,0             SET FOR PASS 1
**       GET SPACE FOR #JC TABLE
         L     R4,CVTPTR           CVT ADDR
         USING CVT,R4
         L     R4,CVTASVT          ASVT ADDR
         USING ASVT,R4
         L     R4,ASVTMAXU         GET NUMBER OF ASCBS
         DROP  R4
         MH    R4,=H'6'            6 BYTES PER ENTRY
         ST    R4,CPUSSIZ
         GETMAIN R,LV=(R4),SP=0    GET PRIVATE AREA
         ST    R1,CPUSAVE
         LR    R0,R1               GET ADDRESS
         LR    R1,R4               GET LENGTH
         SR    R2,R2
         SR    R3,R3
         MVCL  R0,R2
         L     R2,XSASAVE          GET XSA ADDR
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31
         BSM   0,R9
AMODE31  DC    A(CONT31+X'80000000')
CONT31   DS    0H
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L     * ESTAE PARM FIX *
ESTAEOVX EQU   *-ESTAEOVL          * ESTAE PARM FIX *
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL  * ESTAE PARM FIX *
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         MVI   TSOSW,C' '
         L     R3,XAL              PARM LIST ADDR
         LA    R3,0(0,R3)
         LTR   R3,R3               ANY PARM
         BZ    PARM2               NO
         MVC   TSOSW(2),0(R3)      SAVE PARM
         CLI   TSOSW,C'T'          TSO DISPLAY
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'I'          *** DISPLAY IN-QUEUE ONLY ***
         BE    PARM2               *** YES, CONTINUE ***
         CLI   TSOSW,C'O'          *** DISPLAY OUT-QUEUE ONLY **
         BE    PARM2               *** YES, CONTINUE ***
         CLI   TSOSW,C'C'          IS THIS CPU PERCENTAGE
         BE    PARM2               YES CONTINUE
         CLI   TSOSW,C' '          TEST FOR A BLANK
         BE    PARM1               YES CONTINUE
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),TSOSW
         CLC   DOUBLE(2),=C'00'    DOMAIN DISPLAY
         BNE   PARM1
         PACK  DOUBLE(8),TSOSW(2)
         CVB   R1,DOUBLE
         STC   R1,DOMAIN           SAVE DOMAIN
         MVI   TSOSW,C'D'
         B     PARM2
PARM1    MVI   TSOSW,C' '
PARM2    MVC   WTOLIST(4),=X'004A0100'                             @TEC
         MVI   SCANRET,C' '        SET FOUND
         SR    R8,R8               CLEAR ASID
         MVI   SCANTYPE,C'I'       SET IN QUEUE SCAN
         L     R11,CPUSAVE         POINT AT FIRST ENTRY IN TAB
         ST    R11,ACPUSAVE        SAE IT
         CLI   TSOSW,C'O'          *** IS THIS OUT-Q DISPLAY ***
         BE    JOBOUT5             *** YES - THEN GET OUT    ***
         MVC   HDRTMP,HDRI         SAVE IN HDR
         MVC   DOUBLE(1),TSOSW     SAVE PARM VALUE
         CLI   TSOSW,C'C'          CPU REQUEST
         BNE   BK50
         MVI   TSOSW,0             CLEAR FOR HEADER WTO TO APPEAR
         MVC   HDRTMP+56(8),=CL8'CPU-PCT'
BK50     LA    R1,HDRTMP
         BAL   R11,MSGRTN1
         MVC   TSOSW(1),DOUBLE     RESTORE PARM
JOBOUT   MVI   JOBMSG,C' '
         MVC   JOBMSG+1(77),JOBMSG
         LR    R5,R8               LOAD ASID
         LTR   R5,R5               ZERO ASID
         BZ    *+6                 YES, BYPASS ADJUST
         BCTR  R5,0                ADJUST ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,CVTPTR           CVT ADDR
         USING CVT,R4
         L     R4,CVTASVT          ASVT ADDR
         USING ASVT,R4
         L     R6,ASVTMAXU         GET NUMBER OF ASCBS
         MH    R6,=H'4'            GET OFFSET TO END OF TABLE
         LA    R6,ASVTENTY(R6)     POINT AT END OF TABLE
         ST    R6,JASVTEND         SAVE ADDR OF END OF TABLE
         LA    R4,ASVTFRST(R5)     ASCB SLOT ADDR
         USING ASVTFRST,R4
         B     JOBOUT4
JOBOUT1  L     R5,ASVTFRST         ASCB ADDR
         USING ASCB,R5
         L     R6,ASCBCSCB         CSCB ADDR
         L     R7,ASCBOUCB         LOAD OUCB ADDR
         USING OUCB,R7
         CLI   SCANTYPE,C'I'       IN QUEUE SCAN
         BNE   JOBOUT2             NO
         CLI   OUCBSRC,0           DOES IT HAVE A SWAP REASON CODE
         BNE   JOBOUT6             YES, CHECK SRC
         B     JOBOUT3             CONTINUE
JOBOUT2  CLI   OUCBSRC,0           THIS HAVE A SWAP REASON CODE?
         BE    JOBOUT4             NO, IT'S IN THE IN QUEUE
         CLI   OUCBSRC,X'06'       DETECTED WAIT
         BNE   JOBOUT3             NO, OUT QUEUE
         TM    OUCBEFL,OUCBMWT     MSO DETECTED WAIT BIT ON
         BZ    JOBOUT4             NO, SRC IS NO GOOD
JOBOUT3  CLI   TSOSW,C'I'          *** IN-QUEUE ONLY ***
         BE    JOBOUTIO            *** YES, DO IT    ***
         CLI   TSOSW,C'O'          *** OUT-QUEUE ONLY***
         BNE   JOBOUTCN            *** NO ,CONTINUE  ***
JOBOUTIO EQU   *                   *** WRITE IN/OUT  ***
         CLC   SCANTYPE(1),TSOSW   *** IN/OUT=OPTION?***
         BNE   JOBOUT4             *** NO, DONT WRITE***
JOBOUTCN EQU   *                   *** YES, DO IT    ***
         L     R6,ASCBOUCB         OUCB ADDR
         BAL   R11,ASCBFORM        GO FORMAT ASCB INFO
         L     R3,ASCBTSB          TSB ADDR
         ST    R5,ASCBADDR         SAVE ASCBADDR
         L     R5,ASCBCSCB         CSCB ADDR
         BAL   R11,CSCBFORM        GO FORMAT CSCB INFO
         BAL   R11,OUCBFORM        GO FORMAT OUCB INFO
         BAL   R11,DCTIFORM        FORMAT DEVICE CONNECT           @TEC
         LA    R1,WTOLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
         BAL   R11,CPURTN          GO SEE IF CPU RTN NEEDED
JOBOUT4  LA    R4,ASVTFRST+4       INCR INTO ASVT
         C     R4,JASVTEND         END OF ASVT
         BNL   JOBOUT5             YES, RETURN
         TM    0(R4),X'80'         AVAILABLE ENTRY
         BO    JOBOUT4             YES, CHECK NEXT
         B     JOBOUT1             GO USE IT
JOBOUT5  CLI   SCANTYPE,C'O'       OUT QUEUE SCAN
         BE    RETURN              YES, EXIT
         CLI   TSOSW,C'I'          *** IS THIS IN-Q DISPLAY ***
         BE    RETURN              *** YES - THEN GET OUT   ***
         MVI   SCANRET,C' '        INIT OUTPUT SWITCH
         MVI   SCANTYPE,C'O'       SET OUT QUEUE SCAN NEXT
         CLI   TSOSW,C'C'          CPU REQUEST
         BNE   JOBOUT5A
         CLI   CPUSW,0             PASS 0
         BE    JOBOUT              YES NO WTO NOW
JOBOUT5A DS    0H
         MVC   DOUBLE(1),TSOSW     SAVE SCAN TYPE
         MVC   HDRTMP,HDRO         SAVE OUT HDR
         CLI   TSOSW,C'C'          IS IT CPU REQUEST
         BNE   JOBOUT5B
         MVI   TSOSW,C' '          CLEAR FOR WTO
         MVC   HDRTMP+56(8),=CL8'CPU-PCT'
JOBOUT5B DS    0H
         LA    R1,HDRTMP
         BAL   R11,MSGRTN1
         MVC   TSOSW,DOUBLE        RESTORE REQUEST TYPE
         B     JOBOUT              NEXT PASS
JOBOUT6  CLI   OUCBSRC,X'06'       DETECTED WAIT
         BNE   JOBOUT4             NO, OUT QUEUE
         TM    OUCBEFL,OUCBMWT     MSO DETECTED WAIT BIT ON
         BZ    JOBOUT3             NO, SRC IS NO GOOD
         B     JOBOUT4             OUT QUEUE
         DROP  R5,R7
         USING ASCB,R5
         USING OUCB,R6
ASCBFORM UNPK  DOUBLE(5),ASCBASID(3)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   ASID(2),DOUBLE+2    SET ASID IN MSG
         SR    R9,R9
         UNPK  HEXWORK,ASCBDP(5)   CONVERT
         TR    HEXWORK(8),TRBINHEX-X'F0'  DISP PRIORITY
         MVC   DPRTY(2),HEXWORK    TO EBCDIC
         MVC   EXECTIME(11),=XL11'402021207A40404B404040'          @TEC
         LM    R14,R15,ASCBEJST    CPU TIME
         SRDL  R14,12              GET INTO MICROSECONDS
         D     R14,=F'1000'        GET INTO MILLISECONDS
         SR    R14,R14
         D     R14,=F'10'          HUNDREDTHS
         SR    R14,R14
         D     R14,=F'100'         SECONDS
         CVD   R14,DOUBLE          HUNDREDTHS TO PRINT
         UNPK  EXECTIME+8(2),DOUBLE+6(2)
         OI    EXECTIME+9,X'F0'
         SR    R14,R14
         D     R14,=F'60'          MINUTES
         CVD   R14,DOUBLE          SECONDS TO PRINT
         UNPK  EXECTIME+5(2),DOUBLE+6(2)
         OI    EXECTIME+6,X'F0'
         CVD   R15,DOUBLE          MINUTES TO PRINT
         ED    EXECTIME(4),DOUBLE+6
         USING CVT,R1              CVT BASE
         L     R1,CVTPTR           A(CVT)
         L     R1,CVTOPCTP         A(RMCT)
         DROP  R1
         L     R15,124(R1)         CURRENT TIME        ***NO DSECT
         SL    R15,OUCBTMO         ELAPSED TIME IN 1.024 MILL UNITS
         SR    R14,R14
         D     R14,=A(1024)        ELAPSED TIME IN SECONDS
         LR    R14,R15             SECONDS -> R14                  @TEC
         SRDA  R14,32              SET UP TO DIVIDE                @TEC
         D     R14,=A(60)          DIVIDE BY 60                    @TEC
         CVD   R14,DOUBLE          SECONDS TO PACKED               @TEC
         MVC   ETSS-2(4),=X'40212020'                              @TEC
         ED    ETSS-2(4),DOUBLE+6                                  @TEC
         LR    R14,R15             MINUTES -> R14                  @TEC
         SRDA  R14,32              SET UP TO DIVIDE                @TEC
         D     R14,=A(60)          DIVIDE BY 60                    @TEC
         CVD   R14,DOUBLE          MINUTES TO PACKED               @TEC
         MVC   ETMM-2(4),=X'40212020'                              @TEC
         ED    ETMM-2(4),DOUBLE+6                                  @TEC
         CVD   R15,DOUBLE          HOURS TO PACKED                 @TEC
         MVC   ETHH-1(4),=X'40212020'                              @TEC
         ED    ETHH-1(4),DOUBLE+6                                  @TEC
         MVI   ETMM+2,C':'                                         @TEC
         MVI   ETHH+3,C':'                                         @TEC
         BR    R11
         DROP  R5,R6
DCTIFORM DS    0H
         L     R5,ASCBADDR         RESTORE ASCB ADDRESS            @TEC
         L     R6,144(0,R5)        OUCB ADDR                       @TEC
         CLI   41(R6),X'00'        SWAP REASON CODE?               @TEC
         BNER  R11                 YES. SKIP SWAPPED OUT           @TEC
         L     R6,380(0,R5)        ASCBDCTI                        @TEC
         SRDA  R6,32                                               @TEC
         M     R6,=F'83'                                           @TEC
         LR    R6,R7                                               @TEC
         SRDA  R6,32                                               @TEC
         D     R6,=F'10000'        ASCBDCTI*8.3 MSEC               @TEC
         LR    R6,R7                                               @TEC
         SRDA  R6,32                                               @TEC
         D     R6,=F'64'           DEDUCED EMPIRICALLY (?)         @TEC
         CVD   R7,DOUBLE           PACK DEVICE CONNECT TIME        @TEC
         MVC   DCTI-2(6),=X'402020202120'                          @TEC
         ED    DCTI-2(6),DOUBLE+5                                  @TEC
         BR    R11                                                 @TEC
         USING CHAIN,R5
         USING OUCB,R6
         USING TSB,R3
CSCBFORM CLI   TSOSW,C'T'          TSO USER DISPLAY
         BNE   CSCBFRM0            NO
         CLI   CHTRKID,CHTSID      TSO USER
         BNE   JOBOUT4             NO, BYPASS
         B     CSCBFRM6
CSCBFRM0 CLI   CHTRKID,CHTSID      TSO USER
         BE    JOBOUT4             YES, DONT PROCESS
         CLI   CHTRKID,CHINITID    INIT
         BNE   CSCBFRM3            NO, GO HANDLE
         LA    R9,CHAIN            SAVE CSCB ADDR
         SR    R10,R10             INSERT
         IC    R10,CHASID
         SLL   R10,8               ASID
         IC    R10,CHASID+1
CSCBFRM1 L     R5,CHAIN            NEXT CSCB
         LA    R5,CHAIN            CLEAR HIGH ORDER
         LTR   R5,R5               END OF CSCBS
         BNZ   *+10                NO, CONTINUE
         LR    R5,R9               LOAD CSCB ADDR
         B     JOBOUT4             NO GOOD
         CR    R5,R9               SAME CSCB
         BE    JOBOUT4             YES, NO GOOD
         CH    R10,CHASID          SAME ASID
         BNE   CSCBFRM1            NO, CHECK NEXT
CSCBFRM2 MVC   JOBNAME(8),CHKEY
         MVC   STEPNAME(8),CHSTEP
         MVC   PROCNAME(8),CHPROCSN
         B     CSCBFRM4
CSCBFRM3 MVC   JOBNAME(8),CHCLS
         MVC   STEPNAME(8),CHKEY
         MVC   PROCNAME(8),CHPROCSN
CSCBFRM4 CLI   TSOSW,C'D'          DOMAIN DISPLAY
         BNE   CSCBFRM5            NO
         CLC   DOMAIN(1),OUCBDMN   DOMAIN MATCH
         BNE   JOBOUT4
CSCBFRM5 CLC   ASID(2),=C'01'
         BCR   7,R11
         MVC   JOBNAME(26),=CL26'MASTER'
         BR    R11
CSCBFRM6 MVC   JOBNAME(8),CHKEY
         MVC   STEPNAME(8),CHCLS
         CLC   TSTSVC35(2),=X'0A23'  IS THIS TSO EXECUTION OF #J
         BE    CSCBFRM7            NO. SKIP AUTH.
         LA    R0,1                                                @TEC
         SVC   232                                                 @TEC
         MODESET KEY=ZERO                                          @TEC
         MVC   PROCNAME(8),TSBTRMID  GET VTAM TERM NAME
         MODESET KEY=NZERO                                         @TEC
         SR    R0,R0                                               @TEC
         SVC   232                                                 @TEC
         B     CSCBFRM5
CSCBFRM7 MVC   PROCNAME(8),TSBTRMID  GET VTAM TERM NAME
         B     CSCBFRM5
         DROP  R3,R5,R6
         USING OUCB,R6
         USING ASCB,R5
OUCBFORM DS    0H
         CLI   OUCBSRC,X'00'       JOB ON IN QUEUE
         BE    OUCBFRM0            YES, NO SWAP REASON
         SR    R15,R15                                             @TEC
         IC    R15,OUCBSRC                                         @TEC
         SLL   R15,1               SRC TIMES 2                     @TEC
         LA    R15,SRCTAB(R15)     GET TEXT VERSION                @TEC
         MVC   SRC(2),0(R15)       FORMAT SRC                      @TEC
OUCBLOG1 DS    0H
OUCBFRM0 MVC   FLAGS(2),=CL2'NS'
         UNPK  HEXWORK,OUCBSWC(5)  SWAP COUNT
         TR    HEXWORK(8),TRBINHEX-X'F0'
         MVC   SC(2),HEXWORK+2
         LH    R1,OUCBNPG
         CVD   R1,DOUBLE
         UNPK  PG-1(3),DOUBLE+6(2)
         OI    PG+1,X'F0'
         MVI   PG-1,C' '
         TM    OUCBSFL,OUCBNSW     NON-SWAPPABLE
         BO    OUCBFRM1
         MVC   FLAGS(2),=CL2'IN'
         CLI   SCANTYPE,C'I'       IN QUEUE SCAN
         BE    OUCBFRM1
         MVC   FLAGS(2),=CL2'OU'
         TM    OUCBQFL,OUCBLSW     ARE WE LOGICAL
         BZ    *+10                IF NOT SKIP
         MVC   SRC(2),=CL3'LG'     MARK AS LOGICAL SWAP
         TM    OUCBQFL,OUCBGOO+OUCBGOI+OUCBGOB
         BZ    OUCBFRM1            NO, JUST OUT
         MVC   FLAGS(2),=CL2'GO'
         TM    OUCBQFL,OUCBGOO     GOING OUT
         BO    OUCBFRM1
         MVC   FLAGS(2),=CL2'GB'
         TM    16(R6),X'20'        TRANSITIONING
         BO    OUCBFRM1
         MVC   FLAGS(2),=CL2'GI'
OUCBFRM1 MVC   FLAGS+2(2),=CL2'A'
         TM    OUCBYFL,OUCBAXS     AUX STORAGE SHORTAGE
         BCR   1,R11
         MVC   FLAGS+2(2),=CL2'S'
         TM    OUCBYFL,OUCBFXS     REAL STORAGE SHORTAGE
         BCR   1,R11
         MVC   FLAGS+2(2),=CL2'LW'
         TM    OUCBEFL,OUCBLWT     LONG WAIT
         BCR   1,R11
         MVC   FLAGS+2(2),=CL2'MW'
         TM    OUCBEFL,OUCBMWT     DETECTED WAIT
         BCR   1,R11
         MVC   FLAGS+2(2),=CL2'CP'
         TM    OUCBAFL,OUCBCPL     CPU USER
         BCR   1,R11
         MVC   FLAGS+2(2),=CL2' '
         BR    R11
         DROP  R5,R6
****     PROCESS #JC TO ACCUMULATE JOB CPU %
CPURTN   DS    0H
         CLI   TSOSW,C'C'          CPU % REQUEST ?
         BNER  R11                 NO, JUST EXIT
         L     R5,ASCBADDR         RESTORE ASCB ADDRESS
         USING ASCB,R5             RESET BASE
         LM    R14,R15,ASCBEJST    TCB TOD CPU SECONDS
         SRDL  R14,12              MICS
         D     R14,=F'1000'        MILLS
         LR    R9,R15              SAVE TCB MILLS
         LM    R14,R15,ASCBSRBT    SRB TOD CPU MILLS
         SRDL  R14,12              MICS
         D     R14,=F'1000'        MILLS
         ALR   R15,R9              TCB+SRB MILLS
         CLI   CPUSW,0             PASS 0 ?
         BNE   CPURTN11            NO, DO PASS 1 PROCESSING
         L     R10,ACPUSAVE        CURRENT CPU TABLE ADDRESS
         MVC   0(2,R10),ASCBASID
         ST    R15,2(,R10)         SAVE CPU MILLS
         LA    R10,6(,R10)         BUMP TABLE POINTER
         ST    R10,ACPUSAVE        SAVE UPDATED ADDRESS
         BR    R11                 AND RETURN
CPURTN11 DS    0H
         L     R10,CPUSAVE         BEGIN OF CPU TABLE
CPURTN12 CLC   ASCBASID,0(R10)     ASID FOUND?
         BE    CPURTN22            YES, CONTINUE PROCESSING
         CLC   =XL2'00',0(R10)     END OF ENTRIES?
         BER   R11                 YES, THIS AS NOT FOUND JUST RETURN
         LA    R10,6(,R10)         NEXT ENTRY
         B     CPURTN12            CONTINUE SCAN
CPURTN22 DS    0H
         S     R15,2(,R10)         GET CPU TIME USED
         BNM   CPURTN44            AND FORMAT IF NOT MINUS
         MVC   EXECTIME(11),=CL11' '  CLEAR FIELD
         MVC   EXECTIME+5(4),=C'****'  SHOW CANT FORMAT IT
         B     CPURTN55            AND GO PRINT IT
CPURTN44 EQU   *
         MH    R15,=H'100'         X 100
         SR    R14,R14
         D     R14,=A(2*1000)      MILLS IN 2 SECONDS
         MVC   EXECTIME(11),=X'4040402020204B21204040'  BFG
         CVD   R15,DOUBLE
         ED    EXECTIME(06),DOUBLE+6  PRINTABEL FORMAT
         LR    R15,R14             SAVE REMAINDER
         MH    R15,=H'100'         X 100
         SR    R14,R14
         D     R14,=A(2*1000)      GET % OF A SEC
         LTR   R15,R15                                             @TEC
         BZR   R11                 SKIP IF ZERO PERCENT            @TEC
         CVD   R15,DOUBLE
         UNPK  EXECTIME+7(2),DOUBLE+6(2)
         OI    EXECTIME+8,X'F0'
CPURTN55 EQU   *
         MVI   TSOSW,C'N'          SAY CPU REQ NOT ACTIVE
         LA    R1,WTOLIST          A(MSG)
         ST    R11,DOUBLE          SAVE OUR RETURN
         BAL   R11,MSGRTN          GO DO WTO NOW
         MVI   TSOSW,C'C'          SAY CPU REQ ACTIVE NOW
         L     R11,DOUBLE          RESTORE RETURN ADDRESS
         BR    R11                 RETURN
         DROP  R5
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
**************************************************************
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE
*  OPERANDS, REGISTERS, AND PSW IN IT.
**************************************************************
         STM   R14,R12,12(R13)     SAVE REGISTER
         LR    R14,R13             SAVE ORIG R13
         L     R13,0(R1)           GET ESTAE PARM
         L     R2,XSASAVE          GET XSA ADDRESS
         LR    R13,R14             RESTORE R13
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC  SET TO VRA
*                                  AND EBCDIC
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX  MOVE HEADER
         MVC   SDWAVRA+11-SDWA(8,1),0(R2)  MOVE IN DATA
         MVI   SDWAURAL-SDWA(1),19  SET LENGTH OF DATA
         B     ESTNOP              SKIP CONSTANTS
         ESTMODS ,
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8)
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS
         LA    R3,ESTMODS          POINT AT NAMES
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,                   X
               RECORD=YES,RECPARM=(3),REGS=(14,12)
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         USING *,R15
STAERTRY L     R12,=A(IEESL03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         LA    R11,RETURN          LOAD RET ADDR
MSGRTN   MVI   SCANRET,C'P'
MSGRTN1  CLI   TSOSW,C'C'          CPU REQUEST ACTIVE
         BER   R11
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
TSTSVC35 EQU   *
         SVC   35                  ISSUE WTO
         BR    R11
RETURN   EQU   *
         CLI   TSOSW,C'I'          *** IS THIS IN-Q DISPLAY ***
         BE    GOBACK              *** YES - THEN GET OUT   ***
         CLI   TSOSW,C'C'          CPU REQUEST?
         BNE   RETURN1             NO SO EXIT
         CLI   CPUSW,0             PASS 0?
         BNE   RETURN1
         MVI   CPUSW,1             SAY PASS 1 NOW IN EFFECT
         MVI   SCANTYPE,C'I'       RESET FOR FULL SCAN
         STIMER  WAIT,BINTVL=WAITINTV  WAIT FOR A WHILE
         B     JOBOUT              AND DO PASS 1
RETURN1  EQU   *
         CLI   SCANRET,C' '        ANY FOUND
         BE    NOTFOUND            NO, TELL OPERATOR
GOBACK   EQU   *                   *** THIS BYPASS NOTFOUND ***
         ESTAE 0                   ********
         L     R1,CPUSAVE          GET ADDRESS
         LTR   R1,R1               ANY AREA
         BZ    GOBACK1
         L     R0,CPUSSIZ          GET SIZE
         FREEMAIN  R,LV=(0),A=(1)
GOBACK1  EQU   *
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN  R,LV=(0),A=(1)
         LA    R8,AMODE24
         BSM   0,R8
AMODE24  DS    0H
         SR    R15,R15
         BR    R14
NOTFOUND LA    R11,RETURN
         LA    R1,NFNDMSG
         B     MSGRTN
         LTORG
SRCTAB   DC    CL2'  '             00=??                           @TEC
         DC    CL2'TO'             01=TERMINAL OUTPUT WAIT         @TEC
         DC    CL2'TI'             02=TERMINAL INPUT WAIT
         DC    CL2'LW'             03=LONG WAIT                    @TEC
         DC    CL2'AU'             04=AUX STORAGE SHORTAGE         @TEC
         DC    CL2'RS'             05=REAL STORAGE SHORTAGE        @TEC
         DC    CL2'DW'             06=DETECTED WAIT                @TEC
         DC    CL2'RQ'             07=REQUESTED                    @TEC
         DC    CL2'NQ'             08=ENQUEUE EXCHANGE             @TEC
         DC    CL2'EX'             09=WORKLOAD EXCHANGE            @TEC
         DC    CL2'UN'             0A=UNILATERAL                   @TEC
         DC    CL2'TR'             0B=TRANSITION                   @TEC
         DC    CL2'LG'             0C=LOGICAL                      @TEC
         DC    CL2'LF'             0D=LOGICAL FAILED               @TEC
         DC    CL2'  '             0E=??                           @TEC
         DC    CL2'  '             0F=??                           @TEC
WAITINTV DC    A(100*2)            WAIT 2 SECONDS
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
TRBINHEX DC    C'0123456789ABCDEF'
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         DS    0F
NFNDMSG  DC    X'00360100'
         DC    CL50'NO JOBS ON OUT QUEUE'
HDRI     DC    Y(HDRIEND-HDRI),X'0100'
         DC    CL27'*****   IN  QUEUE   *****'
         DC    CL3'ID'
         DC    CL3'DP'
         DC    CL3'PG'
         DC    CL3'SC'
         DC    CL5'FLGS'
         DC    CL5'DCTI'                                           @TEC
         DC    CL1'  '                                             @TEC
         DC    CL11'  TCB TIME'
         DC    CL3' ET'
HDRIEND  EQU   *
HDRO     DC    Y(HDROEND-HDRO),X'0100'
         DC    CL27'*****   OUT  QUEUE   *****'
         DC    CL3'ID'
         DC    CL3'DP'
         DC    CL3'PG'
         DC    CL3'SC'
         DC    CL5'FLGS'
         DC    CL3'SR'
         DC    CL3'  '
         DC    CL11'  TCB TIME'
         DC    CL3' ET'
HDROEND  EQU   *
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
DL3      EQU   DOUBLE+5,3
DL2      EQU   DOUBLE+6,2
ASCBADDR DS    F
XSASAVE  DS    F
JASVTEND DS    F
SCANRET  DS    C
SCANTYPE DS    C
TSOSW    DS    2C
CPUSW    DS    X
DOMAIN   DS    C
HEXWORK  DS    XL9
         DS    0F
WTOLIST  DS    F
JOBMSG   DS    0CL78
JOBNAME  DS    CL9
STEPNAME DS    CL9
PROCNAME DS    CL09
ASID     DS    CL3
DPRTY    DS    CL3
PG       DS    CL3
SC       DS    CL3
FLAGS    DS    CL5
SRC      DS    CL3
         ORG   SRC                                                 @TEC
DCTI     DS    CL4                                                 @TEC
         ORG   SRC+3                                               @TEC
RT       DS    CL3
EXECTIME DS    CL11
ETHH     DS    CL3,C                                               @TEC
ETMM     DS    CL2,C                                               @TEC
ETSS     DS    CL2                                                 @TEC
         ORG   JOBMSG+78                                           @TEC
ACPUSAVE DS    F                   ADDR OF CURRENT CPUSAVE ENTRY
CPUSAVE  DS    F                   BEGINNING OF CPU TABLE
CPUSSIZ  DS    F                   SIZE OF CPU TABLE
HDRTMP   DS    CL68
ESTAELST DS    5F                  ********
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
         IRAOUCB
IEECSCB  DSECT
         IEECHAIN
         IKJTSB
         IHAASVT
         CVT   DSECT=YES
         IHAASCB
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSM03D
         TITLE 'IEESM03D -   #H  DISPLAY HELP'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESM03D -       #H  DISPLAY HELP                         ***
***                                                                 ***
***       VERSION -        2.5                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        08/10/81  JSG - NERDC CHANGES          NERDC
***                        12/28/81  AXC-CBT HANDLE #Z ADDITION     ***
***                                          ADD #IR DESCRIPTION    ***
***                        09/27/82  AXC-CBT UPDATE #V FOR 3375 AND ***
***                                          3380 MATRIX            ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESM03D CSECT
         LR    R12,R15
         USING IEESM03D,R12
         L     R0,SIZE
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         L     R3,XAL              LOAD SUB-PARM ADDR
         MVC   WTOLIST(4),=X'00340100'
         LA    R4,CMDTAB           LOAD COMMAND HELP TABLE ADDR
         LTR   R3,R3               ANY PARMS
         BZ    PRINT               NO, LEVEL 1 HELP
         CLI   0(R3),C'#'          ## COMMAND HELP
         BNE   PARM                NO
         LA    R3,1(0,R3)          INCR 1
         LA    R4,CMD#TAB          ## COMMAND HELP TABLE ADDR
         SPACE 3
PARM     CLC   0(1,R3),0(R4)       TABLE MATCH
         BE    PRINT               YES, USE IT
         LA    R4,4(0,R4)          NEXT ENTRY
         CLI   0(R4),X'00'         END OF TABLE
         BNE   PARM                NO, CONTINUE
         LA    R1,ERRMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     RETURN
PRINT    L     R5,0(0,R4)          LEVEL 2 HELP LIST
         SPACE 3
PRINT1   MVC   WTOLIST+4(48),0(R5)
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         LA    R5,48(0,R5)         NEXT MSG
         CLI   0(R5),X'00'         END OF MSGS
         BNE   PRINT1              NO, CONTINUE
RETURN   EQU   *
         ESTAE 0
         L     R0,SIZE             LOAD FREEMAIN SIZE
         LR    R1,R13              LOAD FREEMAIN ADDR
         L     R14,SAVRET          LOAD RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14                 EXIT
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESM03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     RETURN
         LTORG
         SPACE 5
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
ERRMSG   DC    X'00340100'
         DC    CL48'HELP NOT AVAILABLE FOR THIS COMMAND, ENTER #H'
         SPACE 3
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
CMDTAB   DS    0F
         DC    C'H',AL3(HDRTAB)
         DC    C'A',AL3(ATAB)
         DC    C'C',AL3(CTAB)
         DC    C'D',AL3(DTAB)
         DC    C'E',AL3(ETAB)
         DC    C'F',AL3(FTAB)
         DC    C'I',AL3(ITAB)
         DC    C'J',AL3(JTAB)
         DC    C'L',AL3(LTAB)
         DC    C'M',AL3(MTAB)
         DC    C'N',AL3(NTAB)
         DC    C'O',AL3(OTAB)
         DC    C'P',AL3(PTAB)
         DC    C'Q',AL3(QTAB)
         DC    C'R',AL3(RTAB)
         DC    C'S',AL3(STAB)
         DC    C'T',AL3(TTAB)
         DC    C'V',AL3(VTAB)
         DC    C'Z',AL3(ZTAB)                                   AXC-CBT
         DC    C'1',AL3(A1TAB)
         DC    F'0'
         SPACE 3
CMD#TAB  DS    0F
         DC    C'A',AL3(A#TAB)
         DC    C'B',AL3(B#TAB)
         DC    C'C',AL3(C#TAB)
         DC    C'J',AL3(J#TAB)
         DC    C'P',AL3(P#TAB)
         DC    C'S',AL3(S#TAB)
         DC    F'0'
HDRTAB   DS    0F
         DC    CL48'ENTER  #H X  FOR HELP WITH COMMAND  X'
         DC    CL48'       L= NN    DIRECTS COMMAND OUTPUT TO       '
         DC    CL48'                CONSOLE WITH ID =  NN           '
         DC    CL48'       T= NNN   SETS TIME LIMIT IN SECONDS FOR  '
         DC    CL48'                MONITOR COMMANDS   1 - 999      '
         DC    CL48'       S= XXXX  DIRECTS THE COMMAND TO SYSTEM   '
         DC    CL48'                XXXX AND THE OUTPUT BACK TO     '
         DC    CL48'                THE ORIGINATOR.                 '
         DC    CL48'#A -   (SE)  DISPLAY JOB STATUS -  EXPANDED  D A'
         DC    CL48'#C -   (SK)  CALCULATOR, TOD, AND MSTCONS SWITCH'
         DC    CL48'#D -   (SD)  DISPLAY AND ZAP CORE               '
         DC    CL48'#E -   (SS)  EXECUTE AN OPERATOR COMMAND        '
         DC    CL48'#F -   (SF)  DISPLAY PAGE FRAME ASSIGNMENTS     '
         DC    CL48'#H -   (SM)  DISPLAY HELP                       '
         DC    CL48'#I -   (SJ)  DISPLAY IPS AND SWAP COUNTS        '
         DC    CL48'#J -   (SL)  MODIFIED DISPLAY ACTIVE REPLACEMENT'
         DC    CL48'#L -   (SC)  DISPLAY LINES FOR TSO              '
         DC    CL48'#M -   (SO)  TSO MULTIPLE SEND                  '
         DC    CL48'#N -   (SA)  DISPLAY ENQUEUE                    '
         DC    CL48'#O -   (SR)  DISPLAY PENDING I/O AND ALLOCATION '
         DC    CL48'#P -   (SP)  DISPLAY SU CONFIGURATION           '
         DC    CL48'#Q -   (SQ)  ANALYZE ENQUEUE CONFLICTS          '
         DC    CL48'#R -   (SG)  DISPLAY DEVICE STATUS              '
         DC    CL48'#S -   (SH)  DISPLAY LPA MODULES                '
         DC    CL48'#T -   (SN)  DISPLAY TIOT AND EXCP COUNTS BY DD '
         DC    CL48'#V -   (SI)  DISPLAY UNIT                       '
         DC    CL48'#Z -   (SZ)  MODIFIED DISPLAY ACTIVE REPLACEMENT' A
         DC    CL48'##A -  (ZA)  MONITOR JOB ACTIVITY               '
         DC    CL48'##B -  (ZB)  MONITOR DEVICE BUSY                '
         DC    CL48'##C -  (ZC)  MONITOR CHANNEL BUSY               '
         DC    CL48'##J -  (ZJ)  MONITOR JOBS                       '
         DC    CL48'##P -  (ZP)  MONITOR PAGING                     '
         DC    CL48'##S -  (ZS)  MONITOR SYSTEM INDICATORS          '
         DC    F'0'
ATAB     DS    0F
         DC    CL48'ENTER  #H 1  FOR #A OUTPUT FORMAT HELP          '
         DC    CL48'#A ASID      4 LINES OF OUTPUT FOR AN ASID      '
         DC    CL48'#A .JOBNM    4 LINES OF OUTPUT FOR AN JOBNAME   '
         DC    CL48'#A           2 LINES FOR ALL ACTIVE TASKS       '
         DC    CL48'#A 0000      4 LINES FOR ALL ACTIVE TASKS       '
         DC    CL48'#A XX        2 LINES OF OUTPUT FOR SELECTED TYPE'
         DC    CL48'#A XX,D      1 LINE OF DISPATCHABILITY OUTPUT   '
         DC    CL48'#A XX,S      1 LINE OF OUTPUT FOR SELECTED TYPE '
         DC    CL48'#A XX,L      4 LINES OF OUTPUT FOR SELECTED TYPE'
         DC    CL48'  WHERE  XX  IS    -                            '
         DC    CL48'       NN        SELECT ALL JOBS IN DOMAIN 00   '
         DC    CL48'       $A        SELECT ALL JOB, TSU, AND STC   '
         DC    CL48'       $J        SELECT ALL JOBS                '
         DC    CL48'       $T        SELECT ALL TSO USERS           '
         DC    CL48'       $S        SELECT ALL STARTED TASKS       '
         DC    CL48'       $I        SELECT ALL IDLE INITIATORS     '
         DC    F'0'
A1TAB    DS    0F
         DC    CL48'LINE1 -   TEST00              JOBNAME           '
         DC    CL48'          (000B)              ASID              '
         DC    CL48'          DP(112)             ASCB DISP PRIORITY'
         DC    CL48'          SWL(010/016)        SWAP LOAD (IN/OUT)'
         DC    CL48'          SWC(0001)           SWAP COUNT        '
         DC    CL48'LINE2 -   PERF-NRS(0B/07/0B)  PERFORMANCE GROUP '
         DC    CL48'          DPRTY-NR(70/76)     OUCB DISP PRIORITY'
         DC    CL48'          DMN(01)             DOMAIN NUMBER     '
         DC    CL48'LINE3 -   OUCB FLAGS  (SEE FE HANDBOOK)         '
         DC    CL48'LINE4 -   AS(FE2578)          ASCB ADDRESS      '
         DC    CL48'          SR(06)              SWAP REASON CODE  '
         DC    CL48'          QP(01)              DISP QUEUE POSITN '
         DC    CL48'          OU(FE1080)          OUCB ADDRESS      '
         DC    CL48'          A(0063/00000)       ADDRSPC/VIO SLOTS '
         DC    CL48'** NOTE -  IF SWAP REASON CODE IS 00,  QUEUE    '
         DC    CL48'           POSITION PRINTS INSTEAD              '
         DC     F'0'
CTAB     DS    0F
         DC    CL48'#C           DISPLAY TOD CLOCK HIGH-ORDER WORD  '
         DC    CL48'#CS          DISPLAY SMF DATASET STATUS         '
         DC    CL48'#CMNN,XX..X  SEND A MESSAGE  NN  NUMBER OF TIMES'
         DC    CL48'             TO THE CONSOLE INDICATED BY L=XX   '
         DC    CL48'#CBNN,XX..X  BROADCAST A MESSAGE  NN  NUMBER OF '
         DC    CL48'             TIMES TO ALL ACTIVE CONSOLES       '
         DC    CL48'#CXNNNN      CONVERT 4 DIGIT HEX MSS LXYZ TO    '
         DC    CL48'             FORM  L-XXX-YY-Z                   '
         DC    CL48'#CXL-XXX-YY-Z  CONVERT 7 DIGIT L-XXX-YY-Z TO    '
         DC    CL48'             4 DIGIT HEX MSS LXYZ               '
         DC    CL48'#CZ,PASSWRD  SWITCH MASTER CONSOLE DESIGNATION  '
         DC    CL48'             TO THE CONSOLE INDICATED BY L=XX   '
         DC    CL48'#C XXXX      CONVERT 1-8 DIGIT HEX VALUE TO DEC '
         DC    CL48'#C ,DDDD     CONVERT 1-8 DIGIT DEC VALUE TO HEX '
         DC    CL48'#C AAAOBBB   CALCULATOR MODE                    '
         DC    CL48'      AAA    IS 1-8 DIGIT HEX OR ,DEC VALUE     '
         DC    CL48'      BBB    IS 1-8 DIGIT HEX OR ,DEC VALUE     '
         DC    CL48'      O      IS ARITHMETIC OPERATOR             '
         DC    CL48'             +   ADD                            '
         DC    CL48'             -   SUBTRACT                       '
         DC    CL48'             .   MULTIPLY                       '
         DC    CL48'             /   DIVIDE                         '
         DC    F'0'
DTAB     DS    0F
         DC    CL48'#D CHAP,AAAA,DDD  CHAP  ASID=AAAA  TO  DPRTY=DDD'
         DC    CL48'          NOTE THAT IN ORDER FOR THE CHAP TO    '
         DC    CL48'          TAKE EFFECT THE JOB MUST PASS FROM    '
         DC    CL48'          SWAPPED OUT TO SWAPPED IN STATE.      '
         DC    CL48'#D NOSWAP,AAAA    SET  ASID=AAAA  NON-SWAPPABLE '
         DC    CL48'#D OKSWAP,AAAA    SET  ASID=AAAA  SWAPPABLE     '
         DC    CL48'#D NOCANC,AAAA    SET  ASID=AAAA  NON-CANCELABLE'
         DC    CL48'#D OKCANC,AAAA    SET  ASID=AAAA  CANCELABLE    '
         DC    CL48'#D DOSWAP,AAAA    SWAP ASID=AAAA  IN/OUT        '
         DC    CL48'#D UXXX   TO DUMP CORE FOR THE SPECIFIED UCB    '
         DC    CL48'#D XXXX   OR   #D >AAAA,XXXX   AAAA IS ASID     '
         DC    CL48'          TO DUMP CORE AT VIRTUAL ADDR XXXX     '
         DC    CL48'#D XXXX   OR   #D >AAAA,XXXX   AAAA IS ASID     '
         DC    CL48'          TO DUMP CORE AT VIRTUAL ADDR XXXX     '
         DC    CL48'          FOR  NN  NUMBER OF LINES.  MAX=64.    '
         DC    CL48'#D XXXX/YYYYYYYY/ZZZZZZZZ   OR                  '
         DC    CL48'#D >AAAA,XXXX/YYYYYYYY/ZZZZZZZZ    AAAA IS ASID '
         DC    CL48'          TO ZAP CORE AT VIRTUAL ADDR XXXX,     '
         DC    CL48'          VER  YYYYYYYY,  AND REP  ZZZZZZZZ     '
         DC    F'0'
ETAB     DS    0F
         DC    CL48'#E XXXX      TO EXECUTE OPERATOR COMMAND  XXXX. '
         DC    CL48'             COMMAND IS USED IN CONJUNCTION WITH'
         DC    CL48'             CROSS-SYSTEM FACILITY TO SEND A    '
         DC    CL48'             COMMAND TO ANOTHER SYSTEM.         '
         DC    CL48'#E V PATH(UUU-UUU,S),XXXXXX                     '
         DC    CL48'             TO EXECUTE A STRING OF VARY PATH   '
         DC    CL48'             COMMANDS WHERE  UUU-UUU  IS THE    '
         DC    CL48'             DEVICE STRING,  C  IS THE CPUID 0/1'
         DC    CL48'             AND  XXXXXX  IS ONLINE OR OFFLINE. '
         DC    F'0'
FTAB     DS    0F
         DC    CL48'#F           DISPLAY PAGE FRAME ASSIGNMENTS     '
         DC    CL48'#F C         DISPLAY CSA VIRT ADDR ASSIGNMENTS  '
         DC    CL48'#F MX        DISPLAY MEGABYTE  X  OF            '
         DC    CL48'             REAL STORAGE SHOWING FRAME USAGE   '
         DC    CL48'#F OX        DISPLAY MEGABYTE  X  OF            '
         DC    CL48'             REAL STORAGE SHOWING FRAME USAGE OF'
         DC    CL48'             OFFLINE INTERCEPTED FRAMES         '
         DC    CL48'#F BX        DISPLAY MEGABYTE  X  OF            '
         DC    CL48'             REAL STORAGE SHOWING FRAME USAGE OF'
         DC    CL48'             BAD FRAMES                         '
         DC    CL48'#F R         DISPLAY THE V=R AREA FRAME USAGE   '
         DC    CL48'FLAGS -   A DASH IN ANY COLUMN MEANS NO STATUS  '
         DC    CL48'          1ST DIGIT -    O     OFFLINE          '
         DC    CL48'                         C     OFFLINE INTERCEPT'
         DC    CL48'                         R     V=R ALLOCATE     '
         DC    CL48'                         I     V=R INTERCEPT    '
         DC    CL48'                         A     AVAILABLE        '
         DC    CL48'          2ND DIGIT -    B     BAD FRAME        '
         DC    CL48'                         F     LONG TERM FIXED  '
         DC    CL48'                         S     SQA/LSQA FRAME   '
         DC    CL48'                         V     VIO FRAME        '
         DC    CL48'          3RD DIGIT -    A     AVAILABLE QUEUE  '
         DC    CL48'                         R     SQA RSVRD QUEUE  '
         DC    CL48'                         C     COMMON QUEUE     '
         DC    CL48'                         S     SQA QUEUE        '
         DC    CL48'                         U     LOCAL QUEUE      '
         DC    CL48'                         L     LSQA QUEUE       '
         DC    CL48'                         N     NOT QUEUED       '
         DC    F'0'
ITAB     DS    0F
         DC    CL48'#I           DISPLAY CURRENT IPS MEMBER AND SWAP'
         DC    CL48'             COUNTS BY REASON SINCE LAST IPL,   '
         DC    CL48'             CPU BUSY, PAGING, UIC, AND ASMQ.   '
         DC    CL48'#I A         DISPLAY ASM COUNTS                 '
         DC    CL48'             AVAIL VALUE IS THE TOTAL NUMBER    '
         DC    CL48'             OF LOCAL PAGE D.S. UNRESERVED SLOTS'
         DC    CL48'#I C         DISPLAY AVAILABLE PCCWS            '
         DC    CL48'             VALUES ARE THE NUMBER OF PCCWS THAT'
         DC    CL48'             ARE ALLOCATED BY RIM AND ALSO THE  '
         DC    CL48'             NUMBER OF AVAILABLE PCCWS          '
         DC    CL48'#I P         DISPLAY PAGE DATA SET USAGE        '
         DC    CL48'             SIZE AND AVAIL VALUES ARE DECIMAL  '
         DC    CL48'             NUMBER OF SLOTS,  BRST VALUE IS    '
         DC    CL48'             RELATIVE SERVICE RATE,  THE HIGHER '
         DC    CL48'             THE VALUE THE POORER THE RESPONSE  '
         DC    CL48'#I R         DISPLAY SRM RCT VALUES             '
         DC    CL48'#I S         DISPLAY SWAP DATA SET USAGE        '
         DC    CL48'             SIZE AND AVAIL VALUES ARE DECIMAL  '
         DC    CL48'             NUMBER OF SWAP SETS.               '
         DC    CL48'#I X         DISPLAY PERFORMANCE GROUP ACTIVITY '
         DC    CL48'             INCLUDING NUMBER OF TRANSACTIONS,  '
         DC    CL48'             TRANSACTION SERVICE RATE,          '
         DC    CL48'             ABSORPTION RATE,                   '
         DC    CL48'             SWAP RATIO, AND AVERAGE RESPONSE   '
         DC    CL48'             TIME IN SECONDS.                   '
         DC    F'0'
JTAB     DS    0F
         DC    CL48'#J           DISPLAY JOB STATUS                 '
         DC    CL48'#J T         DISPLAY TSO USER STATUS            '
         DC    CL48'#J NN        DISPLAY JOB STATUS FOR DOMAIN -  NN'
         DC    CL48'    ASID     ADDRESS SPACE ID                   '
         DC    CL48'    DPRTY    DISPATCHING PRIORITY               '
         DC    CL48'    QP       ASCB QUEUE POSITION, WHICH IS      '
         DC    CL48'             A RELATIVE DISPATCHING PRIORITY    '
         DC    CL48'    SR       SWAP REASON CODE AS IN THE OUTPUT  '
         DC    CL48'             OF THE #I COMMAND                  '
         DC    CL48'    FLAGS    JOB STATUS DESCRIBED BELOW = RXXXYY'
         DC    CL48'    CPUTIME  CPU/SRB ACCUMULATED JOB STEP TIME  '
         DC    CL48'    R -                                         '
         DC    CL48'        R   -   V=R REGION                      '
         DC    CL48'        -   -   V=V REGION                      '
         DC    CL48'    XXX -                                       '
         DC    CL48'        IN  -   IN CORE - SWAPPED IN            '
         DC    CL48'        NSW -   NON-SWAPPABLE                   '
         DC    CL48'        OUT -   SWAPPED OUT                     '
         DC    CL48'        GOO -   IN PROCESS OF BEING SWAPPED OUT '
         DC    CL48'        GOI -   IN PROCESS OF BEING SWAPPED IN  '
         DC    CL48'        GOB -   CURRENTLY CHANGING STATUS       '
         DC    CL48'    YY -                                        '
         DC    CL48'        LW  -   LONG WAIT STATUS                '
         DC    CL48'        MW  -   DETECTED WAIT                   '
         DC    CL48'        CP  -   SIGNIFICANT CPU USER            '
         DC    CL48'        A   -   AUXILLARY STORAGE SHORTAGE      '
         DC    CL48'        S   -   REAL STORAGE SHORTAGE           '
         DC    F'0'
LTAB     DS    0F
         DC    CL48'#L           DISPLAY USERID, ASID AND TP LINE   '
         DC    F'0'
MTAB     DS    0F
         DC    CL48'#M XXXXXX    TSO MULTIPLE SEND                  '
         DC    CL48'    WHERE   XXXXXX IS -                         '
         DC    CL48'            1 - 68 CHARACTER MESSAGE TO         '
         DC    CL48'            SEND TEN TIMES TO ALL TSO           '
         DC    CL48'            USERS THAT ARE LOGGED ON            '
         DC    F'0'
NTAB     DS    0F
         DC    CL48'#N           DISPLAY OUTSTANDING ENQUEUES       '
         DC    CL48'    #N (ZZZZZZ)XXXXXXXX/YYYYYYYY                '
         DC    CL48'      XXXXXXXX     8 DIGIT MAJOR NAME OR  *     '
         DC    CL48'      YYYYYYYY     1 - 44 DIGIT MINOR NAME OR  *'
         DC    CL48'      (ZZZZZZ)     1 - 8 DIGIT JOBNAME TO LIMIT '
         DC    CL48'                   THE SEARCH  (OPTIONAL) .     '
         DC    CL48'    IN RESPONSE TO THE #N COMMAND               '
         DC    CL48'    THE CURRENT STATUS TYPES ARE -              '
         DC    CL48'      SHR  -       SHARED USE ENQ               '
         DC    CL48'      EXCL  -      EXCLUSIVE USE ENQ            '
         DC    CL48'      RSVS  -      SHARED USE WITH A RESERVE    '
         DC    CL48'      RSVX  -      EXCLUSIVE USE WITH A RESERVE '
         DC    F'0'
OTAB     DS    0F
         DC    CL48'#O           DISPLAY I/O PENDING, AND           '
         DC    CL48'             ALLOCATION PENDING                 '
         DC    CL48'    #O       ALL I/O PENDING                    '
         DC    CL48'    #OA      ACTIVE I/O PENDING                 '
         DC    CL48'    #OQ      QUEUED I/O PENDING                 '
         DC    CL48'    #OX      ALLOCATION PENDING                 '
         DC    CL48'    I/O PENDING REQUESTS DISPLAY UNIT, VOLSER,  '
         DC    CL48'    JOBNAME/ASID, IOQ ADDR, DRIVER, AND STATUS. '
         DC    CL48'    ALLOCATION PENDING REQUESTS DISPLAY         '
         DC    CL48'    SYSTEM MASK, JOBNAME, QUEUE STATUS, AND     '
         DC    CL48'    JOB MASKS.                                  '
         DC    F'0'
PTAB     DS    0F
         DC    CL48'#P           DISPLAY SU CONFIGURATION           '
         DC    CL48'    #P       DISPLAY NON-OBSOLETE INSTALLED SU.S'
         DC    CL48'    #PI      DISPLAY ALL INSTALLED SU.S         '
         DC    CL48'    #PC      DISPLAY ALL NON-OBSOLETE SU.S      '
         DC    CL48'    #PA      DISPLAY ALL SU.S                   '
         DC    F'0'
QTAB     DS    0F
         DC    CL48'#Q           ANALYZE OUTSTANDING ENQUEUES       '
         DC    CL48'    #Q                                          '
         DC    CL48'    IN RESPONSE TO THE #Q COMMAND               '
         DC    CL48'    THE CURRENT STATUS TYPES ARE -              '
         DC    CL48'      SHR  -       SHARED USE ENQ               '
         DC    CL48'      EXCL  -      EXCLUSIVE USE ENQ            '
         DC    CL48'      RESERVE -    RESERVE INDICATOR            '
         DC    F'0'
RTAB     DS    0F
         DC    CL48'#R M         PENDING MOUNTS FOR TAPE            '
         DC    CL48'#R T         TAPE BUSY AND PENDING MOUNTS       '
         DC    CL48'#R D         DISK BUSY AND PENDING MOUNTS       '
         DC    CL48'#R P         UNIT RECORD BUSY                   '
         DC    CL48'#R B         ALL DEVICE BUSY AND PENDING MOUNTS '
         DC    CL48'#R V         ALL PENDING VARIED/UNLOADED DEVICES'
         DC    CL48'#R R         ALL OUTSTANDING RESERVES           '
         DC    CL48'#R M=XXXX    PENDING MOUNTS FOR A JOB           '
         DC    CL48'#R T=XXXX    ALLOCATED TAPE DEVICES FOR A JOB   '
         DC    CL48'#R D=XXXX    ALLOCATED DISK DEVICES FOR A JOB   '
         DC    CL48'#R P=XXXX    ALLOCATED UNITREC DEVICES FOR A JOB'
         DC    CL48'#R B=XXXX    ALL ALLOCATED DEVICES FOR A JOB    '
         DC    CL48'    =XXXX         IS EITHER A 4 DIGIT ASID      '
         DC    CL48'                  OR 1-8 DIGIT JOBNAME          '
         DC    CL48'#R S=VVVVVV       DEVICE WITH VOLUME  VVVVVV    '
         DC    CL48'#R U=NNN          DISPLAY SPECIFIED -           '
         DC    CL48'                      DEVICE          (NNN)     '
         DC    CL48'                      CONTROL UNIT    (NN)      '
         DC    CL48'                      CHANNEL         (N)       '
         DC    F'0'
STAB     DS    0F
         DC    CL48'#S PGMNAME   DISPLAY LOAD MODULES IN LPA        '
         DC    CL48'             THE ADDRESS AND SIZE ARE DISPLAYED '
         DC    CL48'             UNLESS THE SPECIFIED MODULE IS     '
         DC    CL48'             REPRESENTED BY A MINOR CDE OR LPDE '
         DC    CL48'             IN WHICH CASE THE ADDRESS AND      '
         DC    CL48'             MAJOR NAME ARE DISPLAYED           '
         DC    CL48'#S *ADDR     DISPLAY THE NAME, STARTING ADDRESS '
         DC    CL48'             AND LENGTH OF THE MODULE AT THE    '
         DC    CL48'             SPECIFIED ADDRESS                  '
         DC    F'0'
TTAB     DS    0F
         DC    CL48'#T NNNN      DISPLAY TIOT FOR  ASID NNNN        '
         DC    CL48'             OUTPUT INCLUDES JOB ACCT INFO,     '
         DC    CL48'             PROGRAMMER NAME.   DDNAME, UNIT,   '
         DC    CL48'             DEVTYPE, VOLSER, AND EXCP COUNT    '
         DC    CL48'             ARE PRINTED FOR EACH DD ENTRY.     '
         DC    CL48'#T NNNN,L    OPTIONAL DSNAME AND DCB INFO       '
         DC    CL48'             DISPLAY FOR EACH DD.               '
         DC    F'0'
VTAB     DS    0F
         DC    CL48'#V T           DISPLAY MATRIX FOR TAPE          '
         DC    CL48'#V D           DISPLAY MATRIX FOR DASD          '
         DC    CL48'#V D1          DISPLAY MATRIX FOR 3330-1        '
         DC    CL48'#V D3          DISPLAY MATRIX FOR 3330          '
         DC    CL48'#V D5          DISPLAY MATRIX FOR 3350          '
         DC    CL48'#V D7          DISPLAY MATRIX FOR 3375          '
         DC    CL48'#V D8          DISPLAY MATRIX FOR 3380          '
         DC    CL48'#V CUU         DISPLAY SINGLE UNIT              '
         DC    CL48'#V CUX         DISPLAY ALL UNITS BY CONTROL UNIT'
         DC    CL48'#V CUU,CUU..   DISPLAY ALL UNITS IN LIST        '
         DC    CL48'#V CUX,CUX..   DISPLAY ALL UNITS IN LIST BY CU  '
         DC    CL48'#V S=VOLSER    DISPLAY UNIT FOR THIS VOLSER     '
         DC    CL48'--- TWO LINES OF OUTPUT ARE PRODUCED ---        '
         DC    CL48'UUU  SSSSSS  FFF  UNIT=DDDDDD  AS=AAAA  PATH=X,Y'
         DC    CL48'   DCB=MM  USR=UU  RSV=RR  FLG=11111111/22222222'
         DC    CL48'                  - OR -                        '
         DC    CL48'   DEVTYPE=ZZZZZZZZ        FLG=11111111/22222222'
         DC    CL48'UUU          IS THE UNIT ADDRESS                '
         DC    CL48'SSSSSS       THE VOLUME SERIAL OR DEVICE CLASS  '
         DC    CL48'FFF          ON, OFF, OF CHG                    '
         DC    CL48'DDDDDD       THE DEVICE TYPE                    '
         DC    CL48'AAAA         THE ADDRESS SPACE ID               '
         DC    CL48'X,Y          THE PRIMARY,SECONDARY DEVICE PATH  '
         DC    CL48'MM           THE NO. OF OPEN DCBS TO THE DEVICE '
         DC    CL48'UU           THE NO. OF USERS                   '
         DC    CL48'RR           THE DEVICE RESERVE COUNT           '
         DC    CL48'ZZZZZZZZ     THE 4 BYTE HEX DEVICE TYPE FIELD   '
         DC    CL48'1111/2222    THE FIRST 8 BYTES OF THE UCB IN HEX'
         DC    F'0'
ZTAB     DS    0F
         DC    CL48'#Z           DISPLAY JOB STATUS                 '
         DC    CL48'#Z T         DISPLAY TSO USER STATUS            '
         DC    CL48'#Z NN        DISPLAY JOB STATUS FOR DOMAIN -  NN'
         DC    CL48'    ASID     ADDRESS SPACE ID                   '
         DC    CL48'    DP       DISPATCHING PRIORITY               ' N
         DC    CL48'    PG       PERFORMANCE GROUP                  ' N
         DC    CL48'    QP       ASCB QUEUE POSITION, WHICH IS      '
         DC    CL48'             A RELATIVE DISPATCHING PRIORITY    '
         DC    CL48'    SR       SWAP REASON CODE AS IN THE OUTPUT  '
         DC    CL48'             OF THE #I COMMAND                  '
         DC    CL48'    SC       SWAP COUNT                         ' N
         DC    CL48'    FLAGS    JOB STATUS DESCRIBED BELOW = XXXYY ' N
         DC    CL48'    CPU      CPU/SRB ACCUMULATED JOB STEP TIME  ' N
         DC    CL48'    CPUR     CPU STEP TIME REMAINING            ' N
         DC    CL48'    XXX -                                       '
         DC    CL48'        IN  -   IN CORE - SWAPPED IN            '
         DC    CL48'        NSW -   NON-SWAPPABLE                   '
         DC    CL48'        OUT -   SWAPPED OUT                     '
         DC    CL48'        GOO -   IN PROCESS OF BEING SWAPPED OUT '
         DC    CL48'        GOI -   IN PROCESS OF BEING SWAPPED IN  '
         DC    CL48'        GOB -   CURRENTLY CHANGING STATUS       '
         DC    CL48'    YY -                                        '
         DC    CL48'        LW  -   LONG WAIT STATUS                '
         DC    CL48'        MW  -   DETECTED WAIT                   '
         DC    CL48'        CP  -   SIGNIFICANT CPU USER            '
         DC    CL48'        A   -   AUXILLARY STORAGE SHORTAGE      '
         DC    CL48'        S   -   REAL STORAGE SHORTAGE           '
         DC    F'0'
A#TAB    DS    0F
         DC    CL48'##A        MONITOR JOB ACTIVITY                 '
         DC    CL48'##A D      MONITOR DOMAIN ACTIVITY              '
         DC    CL48'##A T      MONITOR TSO USER ACTIVITY            '
         DC    CL48'##A NN     MONITOR JOB ACTIVITY FOR DOMAIN -  NN'
         DC    CL48'           CPU PCT -   CURRENT CPU PERCENT BUSY '
         DC    CL48'           SIO/SEC -   CURRENT EXCPS PER SEC    '
         DC    CL48'           PAG/SEC -   CURRENT PAGING PER SEC   '
         DC    CL48'           WORKSET -   CURRENT REAL STORAGE USE '
         DC    CL48'           ASID -      ADDRESS SPACE ID         '
         DC    CL48'           DSP -       DISPATCHING PRTY         '
         DC    CL48'           DMN -       DOMAIN NUMBER            '
         DC    CL48'           PGN -       PERFORMANCE GROUP NUMBER '
         DC    CL48'           SWC -       SWAP COUNT               '
         DC    CL48'           FLAGS -     FLAGS -  XX-NN           '
         DC    CL48'                       XX -   IN-  IN QUEUE     '
         DC    CL48'                       XX -   NS-  NON-SWAPPABLE'
         DC    CL48'                       NN -   QUEUE POSITION    '
         DC    CL48'                       XX -   OU-  OUT QUEUE    '
         DC    CL48'                       NN -   SWAP REASON CODE  '
         DC    F'0'
B#TAB    DS    0F
         DC    CL48'##BXXX,Y     MONITOR DEVICE BUSY FOR ALL DASD   '
         DC    CL48'##BUUU,Y     MONITOR DEVICE BUSY FOR DEVICE  UUU'
         DC    CL48'##BUUX,Y     MONITOR DEVICE BUSY FOR DEVICES ON '
         DC    CL48'             CONTROL UNIT  UU                   '
         DC    CL48'             WHERE Y =  D -  DEVICE LIST        '
         DC    CL48'                        J -  DEVICE AND JOB LIST'
         DC    CL48'                        S -  SEEK ANALYSIS      '
         DC    CL48'        OUTPUT FORMAT AS FOLLOWS -              '
         DC    CL48'        UUU VVVVVV  BUSY  NN%  NN%              '
         DC    CL48'        -- JJJJJJJJ       NN%  NN%              '
         DC    CL48'                                                '
         DC    CL48'        NOTE -   TWO PERCENT BUSY VALUES ARE    '
         DC    CL48'                 DISPLAYED FOR DEVICE BUSY.     '
         DC    CL48'                 1ST -  DEVICE BUSY TOTAL       '
         DC    CL48'                 2ND -  DEVICE BUSY PRIMARY CHAN'
         DC    F'0'
C#TAB    DS    0F
         DC    CL48'##C          MONITOR CHANNEL BUSY               '
         DC    CL48'             DISPLAY CHANNEL BUSY IN BOTH       '
         DC    CL48'             NUMERIC AND BAR GRAPH FORM.        '
         DC    CL48'##CNN,Y      MONITOR CHANNEL AND DEVICE BUSY    '
         DC    CL48'             DISPLAY CHANNEL AND DEVICE BUSY    '
         DC    CL48'             FOR CHANNEL NN IN NUMERIC AND      '
         DC    CL48'             BAR GRAPH FORM.                    '
         DC    CL48'             WHERE Y =  D -  DEVICE LIST        '
         DC    CL48'                        J -  DEVICE AND JOB LIST'
         DC    CL48'        OUTPUT FORMAT AS FOLLOWS -              '
         DC    CL48'        CHANNEL NN  BUSY       NN%              '
         DC    CL48'        UUU VVVVVV  BUSY  NN%  NN%              '
         DC    CL48'        -- JJJJJJJJ       NN%  NN%              '
         DC    CL48'                                                '
         DC    CL48'        NOTE -   TWO PERCENT BUSY VALUES ARE    '
         DC    CL48'                 DISPLAYED FOR DEVICE BUSY.     '
         DC    CL48'                 1ST -  DEVICE BUSY TOTAL       '
         DC    CL48'                 2ND -  DEVICE BUSY THIS CHANNEL'
         DC    F'0'
J#TAB    DS    0F
         DC    CL48'##J          MONITOR JOB STATUS                 '
         DC    CL48'##J T        MONITOR TSO USER STATUS            '
         DC    CL48'##J NN       MONITOR JOB STATUS FOR DOMAIN -  NN'
         DC    CL48'    EXCPC    CURRENT SAMPLE EXCP COUNT          '
         DC    CL48'    EXCPT    TOTAL STEP EXCP COUNT              '
         DC    CL48'    CPUC     CURRENT SAMPLE CPU TIME            '
         DC    CL48'    CPUT     TOTAL STEP CPU TIME                '
         DC    F'0'
P#TAB    DS    0F
         DC    CL48'##P          MONITOR PAGING                     '
         DC    CL48'             MONITOR VIO, SWAP, COMMON (CSA),   '
         DC    CL48'             ADDRESS SPACE AND TOTAL PAGING FOR '
         DC    CL48'             THE INTERVAL REQUESTED.  ALL PAGING'
         DC    CL48'             RATES ARE PAGES/SEC AND RECLAIMS   '
         DC    CL48'             HAVE ALREADY BEEN SUBTRACTED.      '
         DC    F'0'
S#TAB    DS    0F
         DC    CL48'##S          MONITOR SYSTEM INDICATORS          '
         DC    CL48'##S D        MONITOR SYS IND AND DMN MIN/MAX/AVG'
         DC    CL48'##S DA       MONITOR SYS IND AND DMN AVG        '
         DC    CL48'             SYSTEM INDICATORS -  LONG TERM CPU,'
         DC    CL48'             AVERAGE CPU, AVERAGE PAGING,       '
         DC    CL48'             AVERAGE UIC, AND AVERAGE ASMQ.     '
         DC    CL48'             DOMAIN -  DISPLAY DOMAIN MONITORED '
         DC    CL48'             OVER TIME  AVERAGE/MINIMUM/MAXIMUM.'
         DC    F'0'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    F
XSASAVE  DS    F
         SPACE 3
         DS    0F
WTOLIST  DS    CL54
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0D
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSN03D
         TITLE 'XA1SN03D -   #T  DISPLAY TIOT INFORMATION'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESN03D -       #T  DISPLAY TIOT INFORMATION             ***
***                                                                 ***
***       VERSION -        1.3                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/XA 2.1                               ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        01/11/82  RLL-CHANGE ESTAE PARM LENGTH   ***
***                        10/05/82  AXC-CBT ADD 3380 AND 3375      ***
***                                  SUPPORT                        ***
***                        01/04/84  ECS-BFG CORRECTION TO GET THE  ***
***                                  RIGHT ASID/TCB FOR XM PROCESS  ***
***                                  DURING POST OF WAITING TASK.   ***
***                        04/22/86  GLA-BFG CORRECT CVT MACRO      ***
***                                  TO ELIMINATE ERRORS AT LINK    ***
***                        05/10/86  GLA-BFG FIX REFERENCES TO THE  ***
***                                  TCTTIO FOR XA CHANGES          ***
***                        05/10/86  GLA-BFG FORCE LAST LINE OUT    ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESN03D CSECT
         LR    R12,R15
         USING IEESN03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         STM   R14,R12,SAVRET      SAVE RETURN ADDR
         XC    TYPE,TYPE
         ST    R2,XSASAVE          SAVE XSA ADDR
         LA    R0,WTOLIST          POINT TO START OF CLEAR
         LA    R1,OUTAREA-WTOLIST   AND SET THE LENGTH
         SR    R15,R15        CLEAR LENGTH 2
         MVCL  R0,R14         CLEAR THE AREA
         LA    R15,500
         LA    R1,OUTAREA-48
INITOUT  LA    R1,48(0,R1)
         XC    0(4,R1),0(R1)
         BCT   R15,INITOUT
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         L     R3,XAL              LOAD LIST POINTER
         LA    R3,0(0,R3)          CLEAR HIGH ORDER
         LTR   R3,R3               PARM EXIST
         BZ    PARMERR             NO, ERROR
         CLC   4(2,R3),=C',L' IS THIS A LONG REQUEST
         BNE   *+12           NO
         MVI   TYPE,C'L'      SET LONG OUTPUT
         LA    R3,1(0,R3)     INCR TO ASID
         MVC   ASIDCH(4),0(R3)
         LA    R4,4           SET MAX LENGTH
         BAL   R11,PARMCVT    CONVERT HEX NUMBER
         STH   R1,ASID        SAVE THE TARGET ASID
         LH    R1,ASID        GET THE ASID
         LTR   R1,R1          IS IT ZERO
         BZ    PARMERR        YES, ERROR
         L     R3,CVTPTR      POINT TO CVT
         USING CVTMAP,R3
         L     R2,CVTTCBP     GO GET MY ASCB ADDR
*        MVC   MYASCB,8(R2)   ***REPLACED***
*        MVC   MYTCB,0(R2)    ***REPLACED***
         MVC   MYASCB,12(R2)  SAVE ADDR OF ASCB FOR POST         ECS
         MVC   MYTCB,4(R2)    SAVE THE TCB ADDRESS FOR STIMER    ECS
         L     R2,CVTASVT     POINT AT ASVT
         USING ASVT,R2
         C     R1,ASVTMAXU    IS ASID TOO BIG
         BH    ASNERR         YES
         SLL   R1,2           ASID*4
         LA    R1,ASVTENTY-4(R1)  POINT AT DESIRED ENTRY
         MVC   TOASCB,0(R1)   MOVE THE ASCB ADDR IF ANY
         TM    TOASCB,ASVTAVAL IS THIS ASCB ADDR OR AVAILABLE
         BO    ASNERR         ASID DOES NOT EXIST
         DROP  R2,R3
         L     R2,TOASCB      POINT AT ASCB
         USING ASCB,R2
         TM    ASCBRCTF,ASCBOUT   IS ASCB SWAPPED OUT
         BO    SWAPOUT
         CLC   MYASCB,TOASCB  IS THE ASCB THE MS
         BE    DOSUBR         IF SO THEN USE SUBROUTINE
*
*        NOW INITIALIZE THE SRB
*
         LA    R3,SRBAREA     POINT AT THE SRB
         USING SRBSECT,R3
         XC    SRBAREA,SRBAREA  CLEAR THE SRB
         MVC   SRBID,=C'SRB '  SET EBCDIC ID
         MVC   SRBASCB,TOASCB SET ASCB ADDR TO RUN IN
         LA    R1,D#SRBCD     POINT AT SRB CODE
         ST    R1,SRBEP       SAVE ENTRY POINT
         ST    R13,SRBPARM    SAVE PARM ADDR AS WORK AREA
         LA    R1,D#RMTR      SET ADDR OF RESOURCE MGR TERMINATION
         ST    R1,SRBRMTR     AND SAVE IT
         MVC   SRBPASID,ASID  SET ASID OF DESIRED ASCB
         DROP  R3
*
*        SCHEDULE SRB AND AWAIT COMPLETION
*
         XC    ECB,ECB        CLEAR DONE ECB
         XC    ECB2,ECB2      CLEAR STIMER ECB
         LA    R1,ECB         NOW SETUP THE ECBLIST
         ST    R1,ECBLIST
         LA    R1,ECB2
         ST    R1,ECBLIST+4
         MVI   ECBLIST+4,X'80'
         L     R2,MYTCB       POINT AT TCB
         L     R2,0(0,R2)     POINT AT RB
         USING RBBASIC,R2
         ST    R1,RBEXSAVE+16 SAVE ECB2 ADDR IN RBXSA
         DROP  R2
         STIMER  REAL,D#STX,BINTVL==A(60*100) WAIT 1 MINUTE
         SCHEDULE  SRB=(R3),SCOPE=GLOBAL
         WAIT  ECBLIST=ECBLIST
         TTIMER CANCEL        CANCEL THE TIMER IF STILL EXISTS
         B     GOTBACK        GO AND CHECK COMPLETION
         SPACE 5
*
*        USE THE SRB CODE AS A SUBROUTINE
*
DOSUBR   OI    FLAG1,FG1SUBR  SET FLAG FOR SUBROUTINE
         LA    R1,DMYPRMS     SETUP DUMMY FRR PARMS
         ST    R1,FRRPRMS
         XC    DMYPRMS,DMYPRMS
         LR    R1,R13         SET UP PARM REGISTER
         LA    R15,D#SRBCD    SET ENTRY POINT ADDR
         LA    R14,GOTBACK    SET RETURN ADDRESS
         BR    R15            GO DO IT
         SPACE 5
*
*        THIS IS THE STIMER EXIT.  ITS PURPOSE IS TO POST THE
*        ECB AT ECB2 AND WAKE UP COMM TASK IF THE SRB FAILS
*        TO DO THIS WE MUST FIND THE ADDRESS OF THE ECB WHICH IS
*        SAVED IN THE XSA AREA OF THE SVRB IN COMM TASK
*
         USING *,R12
D#STX    SAVE  (14,12)
         LR    R12,R15        SET BAE REGISTER
         L     R3,CVTPTR
         L     R3,0(R3)       POINT AT TCB WORDS
         L     R3,0(R3)       POINT AT MY TCB
         L     R3,0(R3)       POINT AT MY RB
         USING RBBASIC-4,R3
D#STX1   SL    R3,=F'4'       POINT BACK TO LOOK AT INTC
         CLI   3(R3),X'01'    LOOK FOR WAIT SVC
         BE    D#STX2         IF FOUND THEN EXIT
         TM    XSTAB2,RBTCBNXT     TEST TCB FLAG
         BO    D#STX3         IF NOT FOUND PROPER RB
         L     R3,RBLINK      POINT AT PREVIOUS RB
         B     D#STX1         TRY AGAIN
D#STX2   L     R2,RBEXSAVE+16 GET ADDR OF ECB
         POST  (R2)         POST THE TIMER ECB
         RETURN (14,12)
         DROP  R12,R3
*
*        IF WE CAN NOT FIND THE RB THEN DUMP
*
D#STX3   DC    H'0'
         USING IEESN03D,R12
         TITLE 'XA1SN03D  #T COMMAND  --  PERFORM THE DUMP FUNCTION'
*
*        WE HAVE RETURNED FOR THE SRB FUNCTION NOW CHECK THE RESULTS
*        AND IF GOOD THEN DUMP THE PROPER PART OF MEMORY
*
GOTBACK  TM    FLAG1,FG1SUBR  ARE WE IN SUBROUTINE MOVE
         BO    GOTBK2         IF SO THEN SKIP SOME TESTS
         TM    FLAG1,FG1SRDN  HAS THE SRB COMPLETED
         BZ    SRBFAIL        IF NOT THEN TIMER CAUGHT IT
         TM    FLAG2,FG2PSTR  DID XMPOST HAVE ERROR
         BO    XMPTERR        IF SO THEN MESSGAE
         TM    FLAG2,FG2PURG  WAS SRB PURGED
         BO    SRBPGERR       IF SO THEN TELL ABOUT IT
GOTBK2   EQU   *
         SPACE 5
*
*        TIO SEARCH CODE FOLLOWS
*
FORMAT   L     R2,XSASAVE     POINT AT XSA
         LA    R3,OUTAREA
         USING XSA,R2
         MVC   WTOLIST(4),=X'00340100'  FILL IN WTO LIST
         SPACE 1
FORMAT1  MVC   WTOLIST+4(48),0(R3)      FILL IN WTO LIST
         LA    R1,WTOLIST          LOAD WTOLIST ADDR
         SR    R0,R0
         IC    R0,XAU                 MCS ID
         SVC   35                  ISSUE WTO
         LA    R3,48(0,R3)
         CLI   0(R3),X'00'         END OF OUTPUT
         BNE   FORMAT1             NO
         B     RETURN
         TITLE 'XA1SN03D  #T COMMAND  --  CHARACTER TO HEX CONVERTOR'
PARMCVT  XR    R0,R0
         LR    R1,R0          CLEAR SOME REGISTERS
         LR    R5,R4          SAVE DESIRED LENGTH IN R5
         SPACE 2
PARMCVT0 CLI   0(R3),C','     CHECK FOR DELIMITERS
         BE    PARMCVTD       IF ANY DELIMITER IS FOUND
         CLI   0(R3),C' '     THEN WE AREA DONE
         BE    PARMCVTD
         CLI   0(R3),C'/'
         BE    PARMCVTD
         CLI   0(R3),C'A'     NOW CHECK FOR HEX CHARACTERS
         BL    ERROR          AND IF INVALID THEN FLAG AS ERROR
         CLI   0(R3),C'F'
         BH    PARMCVT1       NOW TRY NUMBERICS
         NI    0(R3),X'0F'    TURN OFF ZONE
         IC    R0,0(R3)       GET THE CHARACTER
         AH    R0,=H'9'       AND ADJUST TO PROPER VALUE
         B     PARMCVT2
PARMCVT1 CLI   0(R3),C'0'     NOW SEE IF NUMERIC
         BL    ERROR          IF NOT THEN ERROR
         CLI   0(R3),C'9'     AND TRY HIGH VALUE
         BH    ERROR
         NI    0(R3),X'0F'    TURN OFF ZONE
         IC    R0,0(R3)       GET DIGIT
PARMCVT2 SLL   R1,4           CLEAR AREA
         OR    R1,R0          PUT IN NEW DIGIT
         LA    R3,1(R3)       POINT PAST
         BCT   R4,PARMCVT0    TRY AGAIN TILL EMPTY
         BR    R11            ALL DONE AND HAD EXPECTED NUMBER OF CHARS
         SPACE 3
PARMCVTD DS    0H             THE HEX NUMBER TERMINATED BEFORE FULL
         CH    R5,=H'8'       WAS A FULL WORD DESIRED
         BNER  R11            OUT IF NOT
         B     ERROR          FORCE FULLWORD TO BE PRESENT
         TITLE 'XA1SN03D  #T COMMAND  --  ERROR ROUTINES'
         USING *,R15
         USING XSA,R2
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESN03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     RETURN
MSGRTN   L     R2,XSASAVE     RELOAD XSA ADDR
         USING XSA,R2
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         DROP  R2
         B     RETURN
         SPACE 3
ERROR    LA    R1,ERRMSG           PARM ERROR
         B     MSGRTN              GO ISSUE WTO
         SPACE 3
ASNERR   LA    R1,ASNFND           ASID NOT FOUND
         B     MSGRTN              GO ISSUE WTO
         SPACE 3
PARMERR  LA    R1,ERRMSG           MVS
         B     MSGRTN              GO ISSUE WTO
         SPACE 3
SWAPOUT  LA    R1,SWAPMSG     ADDRESS SPACE SWAPPED OUT
         B     MSGRTN
         SPACE 3
DISTERR  LA    R1,DISTMSG     ERROR OCCURRED IN SRB MODE
         B     MSGRTN
         SPACE 3
SRBFAIL  DS    0H             SRB FAILED TO POST SO DUMP
         L     R2,XSASAVE     RELOAD XSA ADDR
         USING XSA,R2
         LA    R1,SRBFMSG     POINT AT MSG
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         DC    H'0'
         SPACE 3
XMPTERR  LA    R1,XMPTMSG     POINT AT MSG
         B     MSGRTN
         SPACE 3
SRBPGERR LA    R1,PURGMSG     SRB WAS PURGED BEFORE PROCESS
         B     MSGRTN
RETURN   EQU   *
         ESTAE 0                                      ****(RLL)****
         L     R0,SIZE
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         LTORG
         DS    0F
SIZE     DC    AL1(241),AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS'
         SPACE 3
         DS    0F
SRBFMSG  DC    X'00280100'
         DC    CL36'SRB FAILED TO POST '
         SPACE 3
         DS    0F
ERRMSG   DC    X'00280100'
         DC    CL36'PARAMETER ERROR'
         SPACE 3
         DS    0F
ASNFND   DC    X'00280100'
         DC    CL36'ADDRESS SPACE SPECIFIED NOT FOUND'
         SPACE 3
         DS    0F
SWAPMSG  DC    X'00360100'
         DC    CL50'ADDRESS SPACE REQUESTED IS SWAPPED OUT'
         SPACE 3
         DS    0F
DISTMSG  DC    X'00360100'
         DC    CL50'DISASTEROUS ERROR OCCURED IN SRB MODE'
         SPACE 3
         DS    0F
XMPTMSG  DC    X'00360100'
         DC    CL50'CROSS-MEMORY POST FAILED'
         SPACE 3
         DS    0F
PURGMSG  DC    X'00360100'
         DC    CL50'ADDRESS SPACE PURGING SRBS'
         DROP  R12,R13
         TITLE 'XA1SN03D  #T COMMAND  --  SRB MODE CODE'
D#SRBCD  DS    0D
*
*        THIS CODE PERFORMS THE FOLLOWING FUNCTIONS
*              1 ESTABLISHES AN FRR FOR ERROR RECOVERY
*              2 PASSES BACK THE FORMATTED DATA FOR WTO
*              3 CROSS-MEMORY POST THE MAIN COMMAND PROCESSOR
*
         USING WORK,R8
         USING D#SRBCD,R7
         LR    R8,R1          SET THE MAIN PARM DSECT
         LR    R7,R15         SET THE BASE REGISTER
         ST    R14,ASRBRTN    SAVE RETURN ADDR
         TM    FLAG1,FG1SUBR  IS THIS A SUBROUTINE CALL
         BO    D#SRB1         YES SO SKIP FRR
         LA    R5,D#FRRCD     POINT AT FRR CODE
         SETFRR  A,FRRAD=(R5),WRKREGS=(2,3),PARMAD=(R4)
         ST    R4,FRRPRMS     SAVE ADDR OF FRRPRMS
*
*        NOW INIT THE FRR PARM AREA AND VALIDATE THE INPUT ADDR
*
D#SRB1   L     R9,FRRPRMS     ACCESS THE 6 WORK PARM AREA
         STM   R7,R8,0(R9)    SAVE BASE AND WORK REGS
         LA    R10,OUTAREA    OUTPUT AREA
         L     R4,16          CVT
         L     R4,0(0,R4)     TCB WORDS
         L     R4,12(0,R4)    CURRENT ASCB
         L     R4,108(0,R4)   ASXB
         L     R4,8(0,R4)     LAST TCB ON CHAIN
         L     R1,180(0,R4)   JSCB ADDR
         LA    R1,0(0,R1)
         L     R6,12(0,R4)    TIOT
         L     R4,164(0,R4)   TCT
         LA    R4,0(0,R4)
         LTR   R4,R4          TCT PRESENT
         BZ    *+12           NO
         L     R4,12(0,R4)    TCTTIO
         LA    R4,0(0,R4)
         MVC   0(48,R10),=CL48' '
         MVC   0(4,R10),ASIDCH ASID
         MVC   6(8,R10),0(R6) JOBNAME
         MVC   16(8,R10),8(R6) STEPNAME
         MVC   26(8,R10),16(R6) PROCNAME
         LTR   R1,R1          JSCB PRESENT
         BZ    D#SRB1B        NO
         L     R1,260(0,R1)   JCT ADDR
         LA    R1,0(0,R1)
         LTR   R1,R1          JCT PRESENT
         BZ    D#SRB1B        NO
         L     R1,56(0,R1)    ACT ADDR
         SRL   R1,8
         LTR   R1,R1          ACT PRESENT
         BZ    D#SRB1B        NO
         LA    R10,48(0,R10)
         MVC   0(20,R10),24(R1)  PROGRAMMER NAME
         LA    R10,48(0,R10)
         MVC   0(48,R10),48(R1)  ACCT FIELDS
         LA    R14,0(0,R10)   1ST FIELD
         SR    R1,R1
         IC    R1,0(0,R14)    FIELD LENGTH
         MVI   0(R14),C'('
D#SRB1A  LA    R14,1(R1,R14)  NEXT FIELD
         IC    R1,0(0,R14)    FIELD LENGTH
         MVI   0(R14),C','
         LTR   R1,R1          SKIPPED FIELD
         BNZ   D#SRB1A        NO
         CLC   1(4,R14),=F'0' END OF FIELDS
         BNE   D#SRB1A        NO
         MVI   0(R14),C')'
         SPACE 1
D#SRB1B  LTR   R4,R4          TCT PRESENT
         BZ    NOTCTIO        NO
         LA    R5,8(0,R4)     TCTTIO LOOKUP
         SPACE 1
D#SRB2   LA    R10,48(0,R10)  NEXT OUTAREA ADDR
         MVC   0(48,R10),=CL48' '
         MVI   0(R10),C'-'
         L     R14,0(0,R5)    DD ENTRY TIOT OFFSET             GLA-BFG
         L     R15,4(0,R5)    DD ENTRY TCTTIO COUNT ENTRY OFF  GLA-BFG
         LA    R14,0(R14,R6)  DD ENTRY ADDRESS
         LA    R15,0(R15,R4)  TCTTIO COUNT ENTRY ADDRESS
         MVC   2(8,R10),4(R14) DD NAME
         L     R1,16(0,R14)   UCB ADDR
         LA    R1,0(0,R1)
         LTR   R1,R1          ZERO UCB ADDR
         BZ    D#SRB2B        YES
         MVC   12(3,R10),13(R1) UNIT ADDR
         TM    18(R1),X'A0'   DASD OR TAPE
         BZ    D#SRB2A        NO, NO VOLSER
         MVC   24(6,R10),28(R1) VOLSER
         SPACE 1
D#SRB2A  LA    R9,DEVTAB
         SPACE 1
D#SRB3   CLC   0(2,R9),18(R1) DEVTYPE MATCH
         BE    D#SRB4         YES
         LA    R9,8(0,R9)
         CLI   0(R9),X'00'    END OF TABLE
         BNE   D#SRB3         NO
         SPACE 1
D#SRB2B  MVC   16(6,R10),=CL6'*JES*'
         TM    3(R14),X'82'   JES2 DATASET
         BNZ   D#SRB5         YES
         MVC   16(6,R10),=CL6'*TERM*'
         TM    3(R14),X'20'   TERMINAL DATASET
         BNZ   D#SRB5         YES
         MVC   16(6,R10),=CL6'DYNAM'
         TM    3(R14),X'10'   DD DYNAM DATASET
         BNZ   D#SRB5         YES
         MVC   16(6,R10),=CL6'*UNK*'
         B     D#SRB5
         SPACE 1
D#SRB4   MVC   16(6,R10),2(R9) DEVTYPE
         TM    18(R1),X'20'   DASD
         BZ    D#SRB5         NO
         TM    17(R1),X'08'   VIRTUAL VOLUME
         BZ    D#SRB5         NO
         MVI   20(R10),C'V'
D#SRB5   L     R1,8(0,R15)    EXCP COUNT                       GLA-BFG
         CVD   R1,DOUBLE
         MVC   32(12,R10),=X'402020206B2020206B202120'
         ED    32(12,R10),DOUBLE+3
         L     R1,12(0,R14)   JFCB ADDR
         SRL   R1,8           SHIFT OVER
         LTR   R1,R1          JFCB ADDR PRESENT
         BZ    D#SRBX         NO
         LA    R1,16(0,R1)         POINT TO REAL JFCB START
         CLI   TYPE,C'L'      LONG DISPLAY
         BNE   D#SRBX         NO, CONTINUE
         LA    R10,48(0,R10)
         BAL   R11,DDFORM     FORMAT DCB INFO
         SPACE 1
D#SRBX   LA    R5,8(0,R5)     NEXT TCTIO LOOKUP ENTRY          GLA-BFG
         CLC   0(4,R5),=F'0'  END OF ENTRIES
         BNE   D#SRB2         NO
         B     FRRRTY
NOTCTIO  LA    R10,48(0,R10)
         MVC   0(48,R10),=CL48'NO EXCP COUNTS AVAILABLE FOR THIS JOB'
         LA    R6,24(0,R6)    DD ENTRIES
         SPACE 1
NOTCT    LA    R10,48(0,R10)
         MVC   0(48,R10),=CL48' '
         MVI   0(R10),C'-'
         SR    R5,R5
         IC    R5,0(0,R6)     DD ENTRY LENGTH
         MVC   2(8,R10),4(R6) DD NAME
         SR    R1,R1
         L     R1,16(0,R6)    UCB ADDR
         LA    R1,0(0,R1)
         LTR   R1,R1          ZERO
         BZ    NOTCT2A        YES
         MVC   12(3,R10),13(R1) UNIT ADDR
         TM    18(R1),X'A0'   DASD OR TAPE
         BZ    NOTCT1         NO, NO VOLSER
         MVC   24(6,R10),28(R1) VOLSER
         B     NOTCT1
         SPACE 1
NOTCT1   LA    R9,DEVTAB
         SPACE 1
NOTCT2   CLC   0(2,R9),18(R1) DEVTYPE MATCH
         BE    NOTCT3         YES
         LA    R9,8(0,R9)
         CLI   0(R9),X'00'    END OF TABLE
         BNE   NOTCT2         NO
         SPACE 1
NOTCT2A  MVC   16(6,R10),=CL6'*JES*'
         TM    3(R6),X'82'   JES2 DATASET
         BNZ   NOTCT4         YES
         MVC   16(6,R10),=CL6'*TERM*'
         TM    3(R6),X'20'   TERMINAL DATASET
         BNZ   NOTCT4         YES
         MVC   16(6,R10),=CL6'DYNAM'
         TM    3(R6),X'10'   DD DYNAM DATASET
         BNZ   NOTCT4         YES
         MVC   16(6,R10),=CL6'*UNK*'
         B     NOTCT4
         SPACE 1
NOTCT3   MVC   16(6,R10),2(R9) DEVTYPE
         TM    18(R1),X'20'   DASD
         BZ    NOTCT4         NO
         TM    17(R1),X'08'   VIRTUAL VOLUME
         BZ    NOTCT4         NO
         MVI   20(R10),C'V'
         SPACE 1
NOTCT4   L     R1,12(0,R6)    JFCB ADDR
         SRL   R1,8           SHIFT OVER
         LTR   R1,R1          JFCB ADDR PRESENT
         BZ    NOTCTX         NO
         LA    R1,16(0,R1)         POINT TO REAL JFCB START
         CLI   TYPE,C'L'      LONG DISPLAY
         BNE   NOTCTX         NO, CONTINUE
         LA    R10,48(0,R10)
         BAL   R11,DDFORM     FORMAT DCB INFO
         SPACE 1
NOTCTX   LA    R6,0(R5,R6)    NEXT DD ENTRY
         CLC   0(4,R6),=F'0'  END OF ENTRIES
         BNE   NOTCT          NO
         B     FRRRTY
DDFORM   MVC   2(44,R10),0(R1)     MOVE DSNAME TO MSG
         MVC   0(2,R10),=CL2' '
         MVC   46(2,R10),=CL2' '
         LA    R10,48(0,R10)
         MVC   0(2,R10),=CL2' '
         MVC   2(46,R10),DCBMSG    DCB DUMMY MSG
         LH    R14,104(0,R1)       LRECL
         CVD   R14,DOUBLE
         UNPK  29(5,R10),DOUBLE+5(3)
         OI    33(R10),X'F0'
         LH    R14,102(0,R1)       BLKSIZE
         CVD   R14,DOUBLE
         UNPK  42(5,R10),DOUBLE+5(3)
         OI    46(R10),X'F0'
         SPACE 3
DDFORM2  MVC   7(2,R10),=C'PS'
         TM    98(R1),X'40'        PS
         BO    DDFORM3
         MVC   7(2,R10),=C'PO'
         TM    98(R1),X'02'        PO
         BO    DDFORM3
         MVC   7(2,R10),=C'IS'
         TM    98(R1),X'80'        IS
         BO    DDFORM3
         MVC   7(2,R10),=C'DA'
         TM    98(R1),X'20'        DA
         BO    DDFORM3
         MVC   7(2,R10),=C'CX'
         TM    98(R1),X'10'        CX
         BO    DDFORM3
         MVC   7(2,R10),=C'AM'
         TM    98(R1),X'08'        AMB
         BO    DDFORM3
         MVC   7(2,R10),=C'TX'
         TM    99(R1),X'40'        TX
         BO    DDFORM3
         MVC   7(2,R10),=C'TQ'
         TM    99(R1),X'20'        TQ
         BO    DDFORM3
         MVC   7(2,R10),=C'TR'
         TM    99(R1),X'04'        TR
         BO    DDFORM3
         MVC   7(2,R10),=C'AC'
         TM    99(R1),X'08'        ACB
         BO    DDFORM3
         XC    0(4,R10),0(R10)
         S     R10,=F'48'
         BR    R11
DDFORM3  MVC   17(2,R10),=C'**'    SET DEFAULT RECFM
         TM    100(R1),X'C0'
         BZ    DDFORM4             NO RECFM
         MVI   17(R10),C'U'        UNDEFINED
         BO    DDFORM4
         MVI   17(R10),C'F'        FIXED
         TM    100(R1),X'80'
         BO    DDFORM4
         MVI   17(R10),C'V'        VARIABLE
         SPACE 3
DDFORM4  LA    R14,18(0,R10)       POINT TO NEXT BYTE
         TM    100(R1),X'10'       BLOCKED
         BZ    DDFORM5             NO
         MVI   0(R14),C'B'
         LA    R14,1(0,R14)
         SPACE 3
DDFORM5  MVI   0(R14),C'S'
         TM    100(R1),X'08'       SPANNED
         BO    DDFORM9
         MVI   0(R14),C'A'
         TM    100(R1),X'04'       ASA
         BO    DDFORM9
         MVI   0(R14),C'M'
         TM    100(R1),X'02'       MACHINE
         BO    DDFORM9
         MVI   0(R14),C' '
         SPACE 1
DDFORM9  BR    R11
FRRRTY   LA    R10,48(R10)         POINT TO NEXT ENTRY         GLA-BFG
         XC    0(4,R10),0(R10)     END OF OUTPUT               GLA-BFG
         TM    FLAG1,FG1SUBR  IS THIS SUBROUTINE MODE
         BO    D#EXIT         IF SO THEN EXIT
         SETFRR  D,WRKREGS=(2,3)
FRRPOST  L     R10,=A(X'40000000') SET CODE FOR POST
         LR    R9,R8          SAVE WORK POINTER IN SAFE REG
         LA    R11,ECB        ADDR OF ECB TO POST
         ICM   R11,8,=X'80'   FLAG AS XMPOST
         LA    R12,D#POSTR    SET POST ERROR RETURN
         L     R13,MYASCB     ASCB TO POST
         L     R15,CVTPTR     POINT AT CVT
         L     R15,CVT0PT01-CVTMAP(R15)    GET POST ENTRY POINTR
         BALR  R14,R15        GO DO POST
         DROP  R7             KILL MAIN ADDRESS
         USING *,R14          SET TEMP BASE
D#PRTN   LR    R8,R9          RESET BASE OF WORK
         SL    R14,=A(D#PRTN-D#SRBCD)  NOW HAVE CORRECTED BASE
         LR    R7,R14         SET TO PROPER REG
         DROP  R14
         USING D#SRBCD,R7     RESET MAIN BASE
         OI    FLAG1,FG1SRDN  FLAG SRB AS COMPLETED
D#EXIT   L     R14,ASRBRTN    RESTORE RETURN ADDR
         BR    R14            EXIT
         SPACE 5
*
*        POST ERROR ROUTINE  .. FLAG ERROR AND LET TIMER
*        WAKE UP COMM TASK
*
D#POSTR  LR    R8,R9          RESET WORK BASE
         OI    FLAG2,FG2PSTR  FLAG POST ERROR
         BR    R14            RETURN TO D#PRTN
         TITLE 'XA1SN03D  #T COMMAND  --  FRR FOR THE SRB MODE'
D#FRRCD  DS    0D
         L     R2,0(R1)       POINT AT PARM AREA
         LM    R7,R8,0(R2)    SET BASE REGS
         TM    0(R2),X'80'    ARE WE IN VALIDATION
         BZ    D#FRR1         NOPE
*
*        VALIDATION ERROR
*
         OI    FLAG2,FG2IVLD  SET FLAG FOR MESSAGE
         SETRP RECORD=NO,RC=4,RETADDR=FRRRTY,REGS,DUMP=NO,             X
               RETREGS=YES,FRESDWA=YES
         BR    R14            EXIT
         SPACE 5
*
*        ALL OTHER ERRORS
*
D#FRR1   OI    FLAG2,FG2ERRR  SET FLAG FOR MESSAGES
         LA    R10,OUTAREA-48
         SPACE 1
D#FRR2   LA    R10,48(0,R10)
         CLC   0(4,R10),=F'0'        END OF OUTPUT
         BNE   D#FRR2
         MVC   0(48,R10),=CL48'ERROR ENCOUNTERED IN CONTROL BLOCKS'
         SETRP RECORD=YES,RC=4,RETADDR=FRRRTY,REGS,DUMP=YES,           X
               RETREGS=YES,FRESDWA=YES
         BR    R14            EXIT
         TITLE 'XA1SN03D  #T COMMAND  --  RESOURCE MANAGER CLEANUP'
*
*        THIS ROUTINE RECEIVES CONTROL IF THE SRB MUST BE
*        PURGED.
*
D#RMTR   DS    0H
         USING *,R15
         LR    R7,R15         SET BASE REGISTER
         SL    R7,=A(D#RMTR-D#SRBCD)   BY COMPUTATION
         DROP  R15
         USING D#SRBCD,R7
         LR    R8,R2          SET UP POINTER TO WORK
         ST    R14,ASRBRTN    SAVE RETURN ADDR
         OI    FLAG2,FG2PURG  SET PURGED
         B     FRRPOST        GO AND POST TO CLEAN UP
         LTORG
DCBMSG   DC    CL46'DSO=(  )  RFM=(   )  LRECL=       BLKSZ=     '
         DS    0F
DEVTAB   DC    X'0806',CL6'3505  '
         DC    X'0808',CL6'1403  '
         DC    X'0809',CL6'3211  '
         DC    X'080E',CL6'3800  '
         DC    X'080A',CL6'1443  '
         DC    X'0804',CL6'2501  '
         DC    X'1008',CL6'3066  '
         DC    X'1009',CL6'3277  '
         DC    X'100A',CL6'3284  '
         DC    X'100B',CL6'3286  '
         DC    X'8001',CL6'2400  '
         DC    X'8003',CL6'3400  '
         DC    X'2009',CL6'3330  '
         DC    X'200B',CL6'3350  '
         DC    X'200D',CL6'3330-1'
         DC    X'200A',CL6'3340  '
         DC    X'2007',CL6'2305-2'
         DC    X'200C',CL6'3375  '   AXC-CBT 10/05/82
         DC    X'200E',CL6'3380  '   AXC-CBT 10/05/82
         DC    X'0000',CL6'      '
         DC    X'0000',CL6'      '
         DC    X'0000',CL6'      '
         TITLE 'XA1SN03D  #T COMMAND  --  DSECTS'
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         PRINT NOGEN
         CVT   DSECT=YES                                        GLA-BFG
         IHAASVT
         IHAASCB
         IHAFRRS
         IHAPSA
         IHASDWA
         IHASRB
         IHARB
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
         DS    0D
DOUBLE   DS    2F
XSASAVE  DS    F
TYPE     DS    F
WTOLIST  DS    F
PRINT    DS    52C
PST      STAE  PST,CT,MF=L
DMYPRMS  DS    6F             DUMMY AREA FOR FRR PARMS FOR SUBR MODE
FRRPRMS  DS    F              ADDRESS OF 6 WORD FRR PARM
ASRBRTN  DS    F              RETURN ADDR FOR SRB CODE
MYASCB   DS    F              ASCB ADDR OF MAIN ROUTINE
MYTCB    DS    F              TCB ADDRESS FOR MAIN ROUTINE
TOASCB   DS    F              ASCB ADDR OF SRB ROUTINE
ECB      DS    F              ECB FOR MAIN ROUTINE TO WAIT ON
ECB2     DS    F              ECB FOR STIMER TO POST
ECBLIST  DS    2F
LENGTH   DS    F              LENGTH OF STORAGE TO DUMP
SRBAREA  DS    ((SRBSIZE+3)/4)F  THE SRB ITSELF
ASIDCH   DS    F              ASID OF TOASCB
ASID     DS    H              ASID OF TOASCB
FLAG1    DS    X
FG1DUMP  EQU   X'80'
FG1REP   EQU   X'40'
FG1SRDN  EQU   X'02'          IF ON SRB HAS TERMINATED
FG1SUBR  EQU   X'01'
FLAG2    DS    X
FG2NVER  EQU   X'01'          VERIFICATION FAILED
FG2IVLD  EQU   X'02'          VALIDATION FAILED
FG2ERRR  EQU   X'04'          DISASTER OCCURED IN SRB
FG2PURG  EQU   X'08'          SRB WAS PURGED
FG2PSTR  EQU   X'10'          IF ON THEN SRB POST HAD ERROR
ESTAELST DS    0F,(ESTAEOVX)X                         ****(RLL)****
OUTAREA  DS    500CL48
WORKEND  DS    0F
         END
./       ADD   NAME=CSCSO03D
         TITLE 'IEESO03D -   #M  TSO MULTIPLE SEND'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESO03D -       #M  TSO MULTIPLE SEND                    ***
***                                                                 ***
***       VERSION -        1.2                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   WITHOUT  SE2 OR SU64.     ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        01/26/83  AXC-CBT CHANGE ESTAE PARM LEN  ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESO03D CSECT
         LR    R12,R15
         USING IEESO03D,R12
         L     R0,SIZE
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         MVC   CMDLIST(88),CMDLSTOV
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         L     R3,XAL              LOAD SUB-PARM ADDR
         LTR   R3,R3               SUB-PARM PRESENT
         BNZ   COMMAND             YES, CONTINUE
         LA    R1,ERRMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         SPACE 3
EXIT     EQU   *
         ESTAE 0
         L     R0,SIZE             LOAD FREEMAIN SIZE
         LR    R1,R13              LOAD FREEMAIN ADDR
         L     R14,SAVRET          LOAD RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14                 EXIT
COMMAND  MVC   CMDLIST+12(68),0(R3) MESSAGE
         LA    R6,10
         SPACE 1
COMMAND1 LA    R1,CMDLIST          YES
         SR    R0,R0
         IC    R0,XAU
         SVC   34
         BCT   R6,COMMAND1
         LA    R1,ISSMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESO03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     EXIT
         LTORG
         SPACE 5
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
ERRMSG   DC    X'00300100'
         DC    CL44'PARAMETER ERROR'
         SPACE 3
ISSMSG   DC    X'00340100'
         DC    CL48'MESSAGE SENT TO ALL LOGGED ON USERS'
         SPACE 3
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
CMDLSTOV DC    X'00540000'
         DC    CL8'  SEND '''
         DC    CL68' ',C'''',CL7' '
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    F
XSASAVE  DS    F
         SPACE 3
         DS    0F
CMDLIST  DS    CL88
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X ACX-CBT
WORKEND  DS    0D
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSP03D
         TITLE 'IEESP03D -   #P  SU CONFIGURATION'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESP03D -       #P  SU CONFIGURATION                     ***
***                                                                 ***
***       VERSION -        1.2                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8. TO MVS/SP1.3                ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        01/26/83  AXC-CBT CHANGE ESTAE PARM LEN  ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESP03D CSECT
         LR    R12,R15            SET ADDRESSABILITY
         USING IEESP03D,R12
         L     R0,SIZE
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         USING XSA,R2
         ST    R14,SAVRET          PUT RETURN ADDRESS IN UNUSED SLOT
         ST    R2,XSASAVE          SAVE XSA ADDR
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         MVI   TYPE,C'S'          SET SU SELECT SCAN TYPE
         L     R3,XAL             LOAD SUB-PARM ADDR
         LTR   R3,R3              ANY SUB-PARM
         BZ    *+10               NO
         MVC   TYPE(1),0(R3)      SET SCAN TYPE
         L     R3,16              CVT
         L     R4,196(0,R3)       SMCA
         LA    R9,0(0,R3)
         S     R9,=F'8'
         MVC   WTOLIST(52),SYSOVLY
         MVC   WTOLIST+14(4),16(R4) SYSID
         UNPK  WTOLIST+29(5),2(3,R9) CPU MODEL
         OI    WTOLIST+32,X'F0'
         MVI   WTOLIST+33,C' '
         MVC   WTOLIST+48(4),4(R9)  OPER SYSTEM LEVEL
         MVC   WTOLIST+48(1),5(R9)  OPER SYSTEM LEVEL
         MVI   WTOLIST+49,C'.'
         LA    R1,WTOLIST          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         L     R3,1044(0,R3)      SU BITS
         LA    R4,SUTABLE-52
         LA    R8,4                NO. OF SUBIT WORDS
SUBIT1   L     R7,0(0,R3)          1ST WORD OF SU BITS
         SR    R6,R6
         LA    R5,32
         SPACE 1
SUBIT2   SLDL  R6,1
         LA    R4,52(0,R4)
         CLI   TYPE,C'C'           PRINT CURRENT
         BE    SUBIT5
         CLI   TYPE,C'A'           PRINT ALL
         BE    SUBIT6
         LTR   R6,R6               SU BIT ON
         BZ    SUBIT3              NO
         CLI   TYPE,C'I'           PRINT INSTALLED
         BE    SUBIT4              YES
         CLC   12(9,R4),=CL9'-OBSOLETE'
         BNE   SUBIT4
         SPACE 1
SUBIT3   BCT   R5,SUBIT2           NEXT BIT
         LA    R3,4(0,R3)          NEXT WORD
         BCT   R8,SUBIT1
         B     EXIT
         SPACE 1
SUBIT4   LA    R1,0(0,R4)          SU BIT TABLE MESSAGE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         SR    R6,R6
         B     SUBIT3
         SPACE 1
SUBIT5   CLC   12(9,R4),=CL9'-OBSOLETE'
         BE    SUBIT3
         SPACE 1
SUBIT6   CLI   12(R4),C' '         VALID SU
         BNE   SUBIT4              YES
         B     SUBIT3
         SPACE 3
EXIT     EQU   *
         ESTAE 0
         L     R0,SIZE
         L     R14,SAVRET
         LR    R1,R13
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESP03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     EXIT
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORK)
         SPACE 3
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
SYSOVLY  DC    X'00340100'
         DC    CL48'SYSTEM -  XXXX    CPU -  XXXX    VS2 REL -  XXXX'
SUTABLE  DC    X'00340100',CL48' '
 DC X'00340100',CL48'SU1     VTAM RELEASE 2            FMID(EVT0108)'
 DC X'00340100',CL48'SU2     -OBSOLETE-                             '
 DC X'00340100',CL48'SU3     -OBSOLETE-                             '
 DC X'00340100',CL48'SU4     SCHEDULER IMPROVEMENTS                 '
 DC X'00340100',CL48'SU5     SUPERVISOR PERF. # 1                   '
 DC X'00340100',CL48'SU6     -OBSOLETE-                             '
 DC X'00340100',CL48'SU7     SUPERVISOR PERF. # 2                   '
 DC X'00340100',CL48'SU8     DATA MANAGEMENT                        '
 DC X'00340100',CL48'SU9     SAM-E  5740-AM3    (PP)   FMID(JDM1112)'
 DC X'00340100',CL48'SU10    3800 SUPPORT                           '
 DC X'00340100',CL48'SU11    TSO CMD 5740-XT6   (PP)   FMID(JBB1112)'
 DC X'00340100',CL48'SU12    -OBSOLETE-                             '
 DC X'00340100',CL48'SU13    -OBSOLETE-                             '
 DC X'00340100',CL48'SU14    -OBSOLETE-                             '
 DC X'00340100',CL48'SU15    -OBSOLETE-                             '
 DC X'00340100',CL48'SU16    SCHEDULER/IOS SUPPORT                  '
 DC X'00340100',CL48'SU17    SERVICE DATA IMPROV.                   '
 DC X'00340100',CL48'SU18    -OBSOLETE-                             '
 DC X'00340100',CL48'SU19    -OBSOLETE-                             '
 DC X'00340100',CL48'SU20    -OBSOLETE-                             '
 DC X'00340100',CL48'SU21    -OBSOLETE-                             '
 DC X'00340100',CL48'SU22    -OBSOLETE-                             '
 DC X'00340100',CL48'SU23    JES2 NJE3 5740-XR8 (PP)   FMID(JJE1112)'
 DC X'00340100',CL48'SU24    3850 MSS R3 IMPROVMENTS   FMID(EMS1102)'
 DC X'00340100',CL48'SU25    JES2 R4.1                 FMID(EJE1102)'
 DC X'00340100',CL48'SU26    JES3 R3                   FMID(EJS1102)'
 DC X'00340100',CL48'SU27    EREP                                   '
 DC X'00340100',CL48'SU28                                           '
 DC X'00340100',CL48'SU29    3838 SUPPORT                           '
 DC X'00340100',CL48'SU30    3895 SUPPORT                           '
 DC X'00340100',CL48'SU31                                           '
 DC X'00340100',CL48'SU32    RACF                                   '
 DC X'00340100',CL48'SU33    DUMP IMPROVEMENTS                      '
 DC X'00340100',CL48'SU34    ACF/VTAM 5735-RC2  (PP)   FMID(JVT1122)'
 DC X'00340100',CL48'SU35    ACF/VTAM 5735-RC2  (PP)   FMID(JVT1112)'
 DC X'00340100',CL48'SU36    TCAM 10  NCP/VS DIRECT    FMID(ETC0108)'
 DC X'00340100',CL48'SU37    SSS R5                    FMID(ESS1102)'
 DC X'00340100',CL48'SU38                                           '
 DC X'00340100',CL48'SU39    CRYPT0   5740-XY5  (PP)   FMID(HCR1102)'
 DC X'00340100',CL48'SU40    ACF/VTAM SCP              FMID(EVT1102)'
 DC X'00340100',CL48'SU41    DASDR              (PP)   FMID(JDS1112)'
 DC X'00340100',CL48'SU42    3800 OFFL 5748-UT2 (PP)   FMID(JUT1112)'
 DC X'00340100',CL48'SU43    -OBSOLETE-                             '
 DC X'00340100',CL48'SU44    ACF/TCAM 5735-RC1  (PP)   FMID(JCT1122)'
 DC X'00340100',CL48'SU45    NOSP  5734-XX2     (PP)   FMID(HNO1102)'
 DC X'00340100',CL48'SU46    ACF/TCAM 5735-RC1  (PP)   FMID(JTC1112)'
 DC X'00340100',CL48'SU47    -OBSOLETE-                             '
 DC X'00340100',CL48'SU48    3800 12 LINES/INCH                     '
 DC X'00340100',CL48'SU49    -OBSOLETE-                             '
 DC X'00340100',CL48'SU50    MVS/SE R1 5740-XE1 (PP)   FMID(JBB1122)'
 DC X'00340100',CL48'SU51    PROCESSOR SUPPORT # 1                  '
 DC X'00340100',CL48'SU52    -OBSOLETE-                             '
 DC X'00340100',CL48'SU53    RMF2 R2.0 5740-XY4 (PP)   FMID(HRM2205)'
 DC X'00340100',CL48'SU54    ACF/VTAM CRYPTO    (PP)   FMID(JVT1132)'
 DC X'00340100',CL48'SU55    HARDWARE RECOVERY IMP.                 '
 DC X'00340100',CL48'SU56    VPSS   5744-CK1    (PP)   FMID(EVP1102)'
 DC X'00340100',CL48'SU57    IPCS                      FMID(EIP1102)'
 DC X'00340100',CL48'SU58    TSO/VTAM LEVEL 2          FMID(ETV0108)'
 DC X'00340100',CL48'SU59    ACF/TCAM SCP  TCAM11      FMID(ETC1102)'
 DC X'00340100',CL48'SU60    DATA MANAGEMENT SUPPORT                '
 DC X'00340100',CL48'SU61    RMF2 R2.2 5740-XY4 (PP)   FMID(HRM2204)'
 DC X'00340100',CL48'SU62    RACF V1 R3         (PP)   FMID(HRF1302)'
 DC X'00340100',CL48'SU63    -OBSOLETE-                             '
 DC X'00340100',CL48'SU64    PROCESSOR SUPPORT # 2                  '
 DC X'00340100',CL48'SU65    MVS/SE WITH SU64                       '
 DC X'00340100',CL48'SU66    HSM SUPPED BY SU99 (PP)   FMID(HHM1102)'
 DC X'00340100',CL48'SU67    SMP4                                   '
 DC X'00340100',CL48'SU68    DEMF                      FMID(EDE1102)'
 DC X'00340100',CL48'SU69                                           '
 DC X'00340100',CL48'SU70                                           '
 DC X'00340100',CL48'SU71                                           '
 DC X'00340100',CL48'SU72    AMS CRYPT 5740-AM8 (PP)   FMID(JDM1122)'
 DC X'00340100',CL48'SU73                                           '
 DC X'00340100',CL48'SU74                                           '
 DC X'00340100',CL48'SU75                                           '
 DC X'00340100',CL48'SU76                                           '
 DC X'00340100',CL48'SU77                                           '
 DC X'00340100',CL48'SU78    TSO SESION MANAGER (PP)   FMID(HTS1202)'
 DC X'00340100',CL48'SU79                                           '
 DC X'00340100',CL48'SU80                                           '
 DC X'00340100',CL48'SU81                                           '
 DC X'00340100',CL48'SU82                                           '
 DC X'00340100',CL48'SU83                                           '
 DC X'00340100',CL48'SU84    DEVICE SUPPORT FACILITY                '
 DC X'00340100',CL48'SU85                                           '
 DC X'00340100',CL48'SU86                                           '
 DC X'00340100',CL48'SU87                                           '
 DC X'00340100',CL48'SU88                                           '
 DC X'00340100',CL48'SU89                                           '
 DC X'00340100',CL48'SU90                                           '
 DC X'00340100',CL48'SU91                                           '
 DC X'00340100',CL48'SU92                                           '
 DC X'00340100',CL48'SU93                                           '
 DC X'00340100',CL48'SU94                                           '
 DC X'00340100',CL48'SU95    RMF SPPTZ (MVS/SE) (PP)                '
 DC X'00340100',CL48'SU96    RMF SPPTZ (NON/SE) (PP)                '
 DC X'00340100',CL48'SU97                                           '
 DC X'00340100',CL48'SU98                                           '
 DC X'00340100',CL48'SU99    HSM                (PP)   FMID(HHM1202)'
 DC X'00340100',CL48'SU100                                          '
 DC X'00340100',CL48'SU101                                          '
 DC X'00340100',CL48'SU102                                          '
 DC X'00340100',CL48'SU103                                          '
 DC X'00340100',CL48'SU104                                          '
 DC X'00340100',CL48'SU105                                          '
 DC X'00340100',CL48'SU106                                          '
 DC X'00340100',CL48'SU107                                          '
 DC X'00340100',CL48'SU108                                          '
 DC X'00340100',CL48'SU109                                          '
 DC X'00340100',CL48'SU110                                          '
 DC X'00340100',CL48'SU111                                          '
 DC X'00340100',CL48'SU112                                          '
 DC X'00340100',CL48'SU113                                          '
 DC X'00340100',CL48'SU114                                          '
 DC X'00340100',CL48'SU115                                          '
 DC X'00340100',CL48'SU116                                          '
 DC X'00340100',CL48'SU117                                          '
 DC X'00340100',CL48'SU118                                          '
 DC X'00340100',CL48'SU119                                          '
 DC X'00340100',CL48'SU120                                          '
 DC X'00340100',CL48'SU121                                          '
 DC X'00340100',CL48'SU122                                          '
 DC X'00340100',CL48'SU123                                          '
 DC X'00340100',CL48'SU124                                          '
 DC X'00340100',CL48'SU125                                          '
 DC X'00340100',CL48'SU126                                          '
 DC X'00340100',CL48'SU127                                          '
WORK     DSECT
SAVRET   DS    F
XSASAVE  DS    F
TYPE     DS    F
WTOLIST  DS    CL52
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X AXC-CBT
WORKEND  DS    0D
DSXSA    DSECT
XSA      DS    0D
XAP      DS    F                  PTR TO XCTL NAME
XAD      DS    F                  DCB PTR
XAX      DS    D                  XCTL NAME
XAE      DS    0C                 ERROR CODE
XAR      DS    F                  PTR TO PARM LIST (REG1)
XAN      DS    0C                 VERB INDEX
XAL      DS    F                  PTR TO LIST POSITION
XAV      DS    D                  VERB
XAS      DS    D                  TEMP SAVE-AREA
XAU      DS    C                  UCM ENTRY INDICATOR
         DS    C                  RESERVED
XAJ      DS    H                  TJID ENTRY INDICATOR
         DS    F                  RESERVED
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSQ03D
         TITLE 'IEESQ03D -   #Q  ENQUEUE ANALYZER'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESQ03D -       #Q  ENQUEUE ANALYZER                     ***
***                                                                 ***
***       VERSION -        1.3                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   MVS/SP1.2-MVS/SP1.3       ***
***                                                                 ***
***       UPDATED -  07/21/81  -AXC-CBT HANDLE ESTAE                ***
***       UPDATED -  11/13/81  -DED-HNB MVS/SP 1.3                  ***
***       UPDATED -   9/17/82  -ADDED TOKEN FOR INCREASED           ***
***                             PROCESSING SP1.3 --- CBT            ***
***                            -CHANGED SUBPOOL PROCESSING          ***
***       UPDATED -  10/01/82  -CHGD SO OUTPUT DOESN'T HAVE UNPRINT-***
***                             ABLE CHARS WHEN EXECUTING VIA #     ***
***       UPDATED -  01/26/83  -AXC-CBT CHANGE ESTAE PARM LEN       ***
***       UPDATED -  04/21/86  -GLA-BFG CHANGE GQSCAN TO USE        ***
***                             PARAMETER LIST IN WORK AREA         ***
***                             THIS WILL PRESERVE REENTRANCY       ***
***                  04/26/86  -GLA-BFG FIX ESTAE PARM LIST         ***
***                                                                 ***
***********************************************************************
*********************************************************************
*                                                                   *
*                      H N B  -  NOTES                              *
*                                                                   *
*                                                                   *
* NOTE - THIS CODE HAS NOT BEEN TESTED WITH A GRS RING              *
*        SCOPE=GLOBAL WILL HAVE TO BE SPECIFIED ON THE GQSCAN MACRO *
*        AND THE GQSCAN HAS TO RUN AUTHORIZED KEY ZERO.             *
*                                                                   *
* NOTE - THE 'SYSNAME=' IN IEASYS00 SHOULD SPECIFY YOUR SMFID TO    *
*        GET THE CORRECT SYSTEM NAME IN THE 'SYSTEM' FIELD,         *
*        OTHERWISE (NONA) "NONAME" WILL BE DISPLAYED.               *
*                                                                   *
* NOTE - THE "SCANAREA" MIGHT HAVE TO BE MADE LARGER FOR A SYSTEM   *
*        WITH MANY DATASETS IN USE.  IF IT IS CHANGED, THE 2ND      *
*        OPERAND ON THE "AREA" OPERAND OF THE "GQSCAN" MACRO MUST   *
*        ALSO BE CHANGED.                                           *
*                                                                   *
* NOTE - TOKEN ADDED TO GQSCAN TO ALLOW TO PROCESSING OF LONGER     *
*        ENQUE LISTS                                                *
*                                                                   *
*********************************************************************
***********************************************************************
IEESQ03D CSECT
         LR    R12,R15            SET ADDRESSABILITY
         USING IEESQ03D,R12
**********************************************************************
*  THE FOLLOWING O INSTRUCTION IS USED TO DETERMINE THE SUBPOOL NUMBER
*  IF RUNNING AS A SUBSYSTEM, THEN SUBPOOL 241 IS USED.
*  IF RUNNING UNDER TSO, THEN CMDSBTSO WILL MODIFY THE MASK BIT OF
*  'F1000000' TO A MASK BIT OF '00000000' AND THUS CAUSE SUBPOOL 0
*  TO BE USED. IN ORDER FOR THIS TO TAKE PLACE, THE EXACT CODING
*  CONVENTIONS USED HERE FOR THE GETMAIN MUST BE FOLLOWED:
**********************************************************************
         LA    R0,PARTWORK        SIZE OF SAVE AND WORK AREA
         A     R0,=F'00102400'    ADD IN THE SCANAREA SIZE
         O     R0,SUB241          SUBPOOL MASK
         GETMAIN R,LV=(0)
         LR    R10,R1
         USING WORK,R10
         USING XSA,R2
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         ST    R14,SAVRET          PUT RETURN ADDRESS IN UNUSED SLOT
         ST    R2,XSASAVE          SAVE XSA ADDR
         MVC   GQSCANL(GQSCANE-GQSCANP),GQSCANP SETUP LIST FORM GLA-BFG
         MVC   MAJLINE(4),=X'00360100'
         MVC   MINLINE(4),=X'00360100'
         MVC   JOBLINE(4),=X'00360100'
         MVC   MAJLINE+4(8),=CL8'MAJOR='
         MVC   MINLINE+4(8),=CL8'MINOR='
         MVC   MAJOR(44),=CL44' '
         MVC   MINOR(44),=CL44' '
         MVC   TKN,=F'0'               ZERO OUT TOKEN
START    MVI   TKNSW,X'00'             INITIALIZE TOKEN SWITCH
         LA    R8,SCANAREA             ADDR OF RETURNED DATA
         LA    R9,SYSDSN               ADDR OF SYSDSN MAJOR NAME
         LA    R6,SCANSAVE             ADDR GQSCAN SAVE AREA
SCAN     GQSCAN AREA=((R8),102400),  ADDR AND LENGTH OF INFO RETURNED  X
               REQLIM=MAX,             MAX NUM OF OWNERS TO BE RETURNEDX
               SCOPE=ALL,              ALL SYSTEMS IN GRS RING         X
               RESNAME=((R9)),         SCAN SYSDSN                     X
               TOKEN=TKN,              TOKEN FUNCTION           GLA-BFGX
               MF=(E,GQSCANL)          USE PARM LIST IN WORK AR GLA-BFG
         LA    R7,BRTABLE              ADDRESS OF BRANCH TABLE
         B     0(R15,R7)               BRANCH TO APPROPRIATE ROUTINE
BRTABLE  B     CODE00                  ALLS OK
         B     CODE04                  NO RESOURCES MATCHED REQUEST
         B     CODE08                  GQSCAN AREA TOO SMALL
         B     CODE0C                  ENCOUNTERED ERROR DATA AREA NG
         B     CODE10                  INVALID SYSNAME
         SPACE 2
CODE00   ST    R0,RIBLNGTH             STORE RIB AND RIBE LENGTH
         LR    R7,R1                   SAVE NUMBER OF RIBS
         LA    R5,SCANAREA             ADDRESS OF GQSCAN AREA (1ST RIB)
         USING RIB,R5                  RESOURCE INFORMATION BLOCK
RIBLOOP  LR    R11,R5                  SAVE RIB POINTER
         AH    R11,RIBLNGTH            POINT TO RIB VARIABLE SECTION
         USING RIBVAR,R11              RESOURCE INFORMATION BLOCK
         SR    R8,R8                   CLEAR REG
         LH    R8,RIBVLEN              LENGTH OF VARIABLE SECTION
         MVC   MINOR(44),=44C' '       CLEAR BEFORE USING
         BCTR  R8,0                    MINUS ONE FOR EX INSTUCTION
         EX    R8,MVCDSN               MOVE DSN TO PRINT LINE
         B     SKIP                    BYPASS NEXT INSTRUCTION
MVCDSN   MVC   MINOR(1),RIBRNAME       MOVE DSN TO PRINT LINE
         DROP  R11
SKIP     MVC   MAJOR(8),SYSDSN
         LR    R11,R5                  SAVE RIB POINTER
         AH    R11,RIBLNGTH            POINT TO RIB VARIABLE SECTION
         AH    R11,RIBVLEN             POINT TO FIRST RIBE
         USING RIBE,R11                RESOURCE INFORMATION BLOCK EXT
         L     R9,RIBNRIBE             LOAD THE # OF RIBE'S
         CLC   RIBNTWE,ANYENQ          ANY WAITING FOR EXCLUSIVE ?
         BNE   SKIP1                     YES...PROCESS
         CLC   RIBNTWS,ANYENQ          ANY WAITING FOR SHARE ?
         BE    BUMPRIB                   NO....BUMP TO NEXT RIB
SKIP1    LA    R1,MAJLINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         LA    R1,MINLINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
SEARCH   MVC   JOBLINE+4(52),=CL52' '  BLANK OUT THE OUTPUT AREA
         MVI   SWITCH,C'1'             SET SWITCH THAT THERE WAS ENQ
         MVC   JOBNAME(8),RIBEJBNM     JOBNAME OF REQUESTOR
         MVC   SYSTEM(4),RIBESYSN      SYSTEM NAME OF REQUESTOR
         SPACE
TEST1    TM    RIBERFLG,RIBETYPE       IS THIS EXCL OR SHARED?
         BO    SHARED                     YES..
         MVC   EXCLSHR(4),=C'EXCL'        NO...TELL USER
         B     TEST2                      NEXT TEST
SHARED   MVC   EXCLSHR(4),=C'SHR '        TELL USER
         SPACE
TEST2    TM    RIBESFLG,RIBESTAT       IS THIS GUY THE OWNER?
         BO    OWNER                      YES..
         MVC   WAIT(9),=C'*WAITING*'      TELL USER WAITING FOR DSET'S
         B     TPUTIT                     GO PRINT IT
OWNER    MVC   WAIT(9),=9C' '             TELL USER
         SPACE
TPUTIT   LA    R1,JOBLINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         SPACE 2
BUMPRIBE AH    R11,RIBELENG            POINT TO NEXT RIBE
         BCT   R9,SEARCH               AND DO IT FOR NEXT USER
BUMPRIB  SR    R3,R3                   CLEAR THE REG
         L     R4,RIBNRIBE             NUMBER OF RIBE'S
BUMPLOOP AH    R3,RIBELENG             ADD RIBE LENGTH
         BCT   R4,BUMPLOOP             AND ADD TIMES NUMBER OF RIBE'S
         AH    R3,RIBLNGTH             ADD LENGTH OF RIB
         AH    R3,RIBVLEN              ADD LENGTH OF VARIABLE SECTION
         AR    R5,R3                   POINT TO NEXT RIB
         BCT   R7,RIBLOOP              AND LOOP UNTIL NO MORE RIBS
         SPACE
         TM    TKNSW,X'01'             WAS THERE A TOKEN?
         BC    8,FINISH                NO, GO TO EOJ
         B     START                   YES, GO REPROCESS
FINISH   CLI   SWITCH,C'1'             WAS THERE AN ENQ ?
         BE    EXIT                       YES...EXIT
         B     NOTFOUND                         TELL USER
EXIT     EQU   *
         ESTAE 0
         LA    R0,PARTWORK
         A     R0,=F'00102400'      ADD IN SCANAREA WORKSIZE
         O     R0,SUB241
         L     R14,SAVRET
         LR    R1,R10
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
NOTFOUND LA    R1,NFNDMSG
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     EXIT
         SPACE 2
CODE04   LA    R1,CODE04M              DSNAME NOT FOUND
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         B     EXIT
         SPACE 2
CODE08   OI    TKNSW,X'01'             TURN TOKEN SW ON
         B     CODE00                  GO FINISH PROCESSING
         SPACE 2
CODE0C   LA    R1,CODE0CM              DSNAME NOT FOUND
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         B     EXIT
         SPACE
CODE10   LA    R1,CODE10M              DSNAME NOT FOUND
         SR    R0,R0
         IC    R0,XAU                  INSERT MCS ID
         SVC   35                      ISSUE WTO
         B     EXIT
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESQ03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     EXIT
         LTORG
         SPACE 3
         DS    0F
GQSCANP  GQSCAN MF=L                                            GLA-BFG
GQSCANE  EQU   *                                                GLA-BFG
SYSDSN   DC    CL8'SYSDSN  '           QNAME FOR GQSCAN
ANYENQ   DC    F'0'                    NO ENQ'S
SUB241   DC    X'F1000000'
* TKN    DC    F'0'                    MOVED FOR REENTRANCY     GLA-BFG
NFNDMSG  DC    X'00300100'
         DC    CL48'NO ENQ CONFLICTS EXIST'
         SPACE 3
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
CODE04M  DC    X'00360100'
         DC    CL50'INVALID DSNAME - RETRY COMMAND'
         SPACE 3
CODE08M  DC    X'00360100'             GQSCAN AREA TOO SMALL
         DC    CL50'GQSCAN AREA TOO SMALL - RETRY COMMAND'
         SPACE 3
CODE0CM  DC    X'00360100'             GQSCAN SCREWED UP
         DC    CL50'GQSCAN ERROR - RETRY COMMAND'
         SPACE 3
CODE10M  DC    X'00360100'             INVALID SYSNAME SPECIFIED
         DC    CL72'INVALID SYSNAME - RETRY COMMAND'
         SPACE
WORK     DSECT
SAVRET   DS    F
XSASAVE  DS    F
SWITCH   DS    C
TKNSW    DS    X
TKN      DC    F'0'                    MOVED FOR REENTRANCY     GLA-BFG
NUMCHK   DS    CL6
         SPACE 1
         DS    0F
MAJLINE  DS    0CL56
         DS    CL12
MAJOR    DS    CL44
         SPACE 1
         DS    0F
MINLINE  DS    0CL56
         DS    CL12
MINOR    DS    CL44
         SPACE 1
         DS    0F
JOBLINE  DS    0CL56
         DS    CL4
JOBNAME  DS    CL8
         DS    CL4
EXCLSHR  DS    CL4
         DS    CL4
WAIT     DS    CL9
         DS    CL4
SYSTEM   DS    CL4
         DS    CL15
         SPACE 3
RIBLNGTH DS    H                       RIB LENGTH
RIBELENG DS    H                       RIBE LENGTH
SCANSAVE DS    18F                     18 WORD SAVEAREA REQ FOR GQSCAN
ESTAELST DS    0F,(ESTAEOVX)X     AXC-CBT
GQSCANL  GQSCAN MF=L              NEEDED FOR REENTRANCY         GLA-BFG
PARTWORK EQU   *-WORK             SIZE OF WORKAREA MINUS SCANAREA
SCANAREA DS    102400X            IF SIZE CHGS, CHG 'ALL' 102400 LINES
WORKSIZE EQU   *-WORK
DSXSA    DSECT
XSA      DS    0D
XAP      DS    F                  PTR TO XCTL NAME
XAD      DS    F                  DCB PTR
XAX      DS    D                  XCTL NAME
XAE      DS    0C                 ERROR CODE
XAR      DS    F                  PTR TO PARM LIST (REG1)
XAN      DS    0C                 VERB INDEX
XAL      DS    F                  PTR TO LIST POSITION
XAV      DS    D                  VERB
XAS      DS    D                  TEMP SAVE-AREA
XAU      DS    C                  UCM ENTRY INDICATOR
         DS    C                  RESERVED
XAJ      DS    H                  TJID ENTRY INDICATOR
         DS    F                  RESERVED
         DS   0F
         PRINT NOGEN
         ISGRIB
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSR03D
         TITLE 'XA1SR03D -   #O  DISPLAY I/O PENDING/ALLOC QUEUE'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       XA1SR03D -       #O  DISPLAY I/O PENDING/ALLOC QUEUE      ***
***                                                                 ***
***       VERSION -        2.1.1                                    ***
***                                                                 ***
***       MVS LEVEL -      FROM MVS/XA  2.1.1                       ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        01/11/82  RLL-CHANGE ESTAE PARM LENGTH   ***
***                                  RLL-CHECK FOR UNIT RECORD UCB  ***
***                                  RLL-CHECK ALLOC BITS           ***
***                        10/19/82  INTEL UPDATE THE I/O DRIVER    ***
***                                  TABLE                          ***
***                        06/04/84  DED-CNB MVS/XA 2.1.1           ***
***                                  IF YOU HAVE A 3880-11          ***
***                                  DON'T BE SUPRISED IF IT        ***
***                                  SHOWS UP MORE THAN ONCE, IT    ***
***                                  HAS MULTIPLE EXPOSURES.        ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESR03D CSECT
IEESR03D AMODE 24
IEESR03D RMODE 24
         SPLEVEL SET=2
         LR    R12,R15            SET ADDRESSABILITY
         USING IEESR03D,R12
         L     R0,SIZE
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         USING XSA,R2
         ST    R14,SAVE           PUT RETURN ADDRESS IN UNUSED SLOT
         ST    R2,XSASAVE         SAVE XSA ADDR
         MVI   DEVCLASS,X'00'      DO ALL DEVICE CLASSES      *CNB/XA*
         XC    WORKAREA,WORKAREA   CLEAR WORK AREA            *CNB/XA*
         LA    R1,WORKAREA         GET ADDRESS OF WORKAREA    *CNB/XA*
         ST    R1,PARMWA           STORE ADDRESS OF WORK AREA *CNB/XA*
         LA    R1,DEVCLASS         START ADDRESS IN PARMLIST  *CNB/XA*
         ST    R1,PARMDEVT         START ADDRESS IN PARMLIST  *CNB/XA*
         LA    R1,ADDRUCB          ADDR TO STORE UCB ADDRESS  *CNB/XA*
         ST    R1,PARMUCB          STORE ADDRESS IN PARMLIST  *CNB/XA*
         MVI   PARMUCB,X'80'       INDICATE END OF PARM LIST  *CNB/XA*
         MVI   FOUND,X'00'
         MVI   IOLINE+4,C' '
         MVC   IOLINE+5(47),IOLINE+4
         MVC   IOLINE(4),=X'00350100'
         MVI   QUELINE+4,C' '
         MVC   QUELINE+5(50),QUELINE+4
         MVC   QUELINE(4),=X'00350100'
         MVI   TYPE,C' '
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         SR    R3,R3
         L     R3,XAL
         LA    R3,0(0,R3)
         LTR   R3,R3               ANY SUBPARMS
         BZ    UCBFIND             NO, I/O PENDING ACTIVE AND QUEUED
         MVI   TYPE,C'A'
         CLI   0(R3),C'A'          ACTIVE ONLY
         BE    UCBFIND             YES
         MVI   TYPE,C'Q'
         CLI   0(R3),C'Q'          QUEUED ONLY
         BE    PROCESS2            YES
         CLI   0(R3),C'X'          ALLOCATION QUEUE REQUEST
         BE    ALLOC               YES
         MVI   TYPE,C' '
UCBSCAN  CLI   TYPE,C' '          ALL I/O PENDING
         BE    UCBFIND            YES
         CLI   TYPE,C'A'          ACTIVE I/O PENDING ONLY
         BNE   PROCESS1           NO, EXIT
         SPACE 1
UCBFIND  L     R9,CVTPTR
         USING CVTMAP,R9
UCBNEXT  SR    R11,R11                                       *CNB/XA*
         SR    R0,R0                                         *CNB/XA*
         L     R11,AMODE24A                                  *CNB/XA*
         BSM   0,R11                                         *CNB/XA*
AMODE24A DC    A(CONT24A+X'00000000')                        *CNB/XA*
         DS    0H                                            *CNB/XA*
CONT24A  LA    R1,PARMLIST        UCBSCAN PARMLIST ADDR      *CNB/XA*
         L     R15,CVTUCBSC       GET SCAN SERVICE ROUTINE   *CNB/XA*
         BALR  R14,R15            GO TO SCAN SCERVICE RTN    *CNB/XA*
         LTR   R15,R15            END OF UCBS?               *CNB/XA*
         BNZ   UCBEND             YES, END                   *CNB/XA*
         SR    R11,R11                                       *CNB/XA*
         L     R11,ADDRUCB        ADDR TO UCB DSECT          *CNB/XA*
         USING UCBOB,R11
         CLC   UCBNAME(3),SAVEOLD SAME UCB?                  *CNB/XA*
         BE    UCBNEXT                                       *CNB/XA*
         MVC   SAVEOLD(3),UCBNAME                            *CNB/XA*
         SPACE
         CLI   UCBTBYT3,UCB3DISP  DISPLAY?
         BE    UCBNEXT
         CLI   UCBTBYT3,UCB3COMM  COMM
         BE    UCBNEXT
         CLI   UCBTBYT3,UCB3UREC  UNIT RECORD
         BE    UCBNEXT
         TM    UCBFLA,UCBSTRT+UCBHALT+UCBCLEAR ACT CHAN PROG *CNB/XA*
         BZ    UCBNEXT            NO, NEXT UCB               *CNB/XA*
         B     PROCESS                                       *CNB/XA*
         SPACE
UCBRET   B     UCBNEXT                                       *CNB/XA*
UCBEND   B     PROCESS1            YES, EXIT                 *CNB/XA*
PROCESS  SR    R3,R3                                         *CNB/XA*
         SR    R4,R4                                         *CNB/XA*
         SR    R0,R0                                         *CNB/XA*
         L     R4,AMODE31A                                   *CNB/XA*
         BSM   0,R4                                          *CNB/XA*
AMODE31A DC    A(CONT31A+X'80000000')                        *CNB/XA*
         DS    0H                                            *CNB/XA*
CONT31A  LR    R3,R11             UCB ADDR                   *CNB/XA*
         SR    R4,R4                                         *CNB/XA*
         LR    R4,R11             UCB ADDR                   *CNB/XA*
         S     R4,=F'4'           DECR ADDR -4
         L     R4,0(0,R4)         IOQ ADDR
         LA    R4,0(0,R4)
         LTR   R4,R4              ANY IOQ
         BZ    UCBNEXT            NO, NEXT UCB
         SR    R5,R5                                         *CNB/XA*
         L     R5,8(0,R4)         IOSB ADDR
         LA    R5,0(0,R5)
         LTR   R5,R5              EXIST
         BZ    UCBNEXT            NO, NEXT UCB
         BAL   R7,CHKASID
         BAL   R7,FORMAT
         B     UCBNEXT
PROCESS1 CLI   TYPE,C' '          ALL I/O PENDING
         BE    EXIT               YES
         CLI   TYPE,C'Q'          QUEUED I/O PENDING ONLY
         BNE   NOTFOUND           NO, EXIT
         SPACE 1
PROCESS2 MVC   IOLINE(52),QMSG1   * CNB/XA * NO LCH? UNDER XA
         LA    R1,IOLINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT
         DROP  R9,11
ALLOC    SR    R3,R3                                          *CNB/XA*
         SR    R0,R0                                          *CNB/XA*
         L     R3,AMODE31                                     *CNB/XA*
         BSM   0,R3                                           *CNB/XA*
AMODE31  DC    A(CONT31+X'80000000')                          *CNB/XA*
         DS    0H                                             *CNB/XA*
CONT31   SR    R0,R0                                          *CNB/XA*
         SR    R3,R3                                          *CNB/XA*
         L     R3,16              CVT
         L     R3,548(0,R3)       AQTOP
         UNPK  MASK1(13),32(7,R3)
         NC    MASK1(12),=12X'0F'
         TR    MASK1(12),=C'0123456789ABCDEF'
         MVI   MASK1+12,C' '
*        UNPK  MASK2(13),39(7,R3)                     ****(RLL)****
         UNPK  MASK2(13),38(7,R3)                     ****(RLL)****
         NC    MASK2(12),=12X'0F'
         TR    MASK2(12),=C'0123456789ABCDEF'
         MVI   MASK2+12,C' '
         MVC   QJOB(8),=CL8'*SYSTEM*'
         MVC   QSTAT(7),=CL7'*AQTOP*'
         SR    R1,R1                                         *CNB/XA*
         LA    R1,QUELINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         L     R4,0(0,R3)         1ST QUEUE ELEMENT
         SPACE 1
ALLOC1   CR    R3,R4              END OF CHAIN
         BE    NOALLOC            YES
*        L     R1,24(0,R4)        MASK ADDR           ****(RLL)****
         SR    R1,R1                                         *CNB/XA*
         LA    R1,29(0,R4)        MASK ADDR           ****(RLL)****
         UNPK  MASK1(13),0(7,R1)
         NC    MASK1(12),=12X'0F'
         TR    MASK1(12),=C'0123456789ABCDEF'
         MVI   MASK1+12,C' '
*        UNPK  MASK2(13),7(7,R1)                      ****(RLL)****
         UNPK  MASK2(13),6(7,R1)                      ****(RLL)****
         NC    MASK2(12),=12X'0F'
         TR    MASK2(12),=C'0123456789ABCDEF'
         MVI   MASK2+12,C' '
         MVC   QSTAT(7),=CL7'WAITING'
         CLI   28(R4),C'W'        OPERATOR WAIT
         BE    ALLOC2             YES
         MVC   QSTAT(7),=CL7'PENDING'
         CLI   28(R4),C'P'        OPER REPLY PENDING
         BE    ALLOC2             YES
         MVC   QSTAT(7),=CL7'AQUEUE'
         CLI   28(R4),C'A'        A QUEUE WAIT
         BE    ALLOC2             YES
         MVC   QSTAT(7),=CL7'BQUEUE'
         CLI   28(R4),C'B'        B QUEUE WAIT
         BE    ALLOC2             YES
         MVC   QSTAT(7),=CL7'OWNING'
         CLI   28(R4),C'E'        OWNING
         BE    ALLOC2             YES
         MVC   QSTAT(7),=CL7'UNK-   '
         MVC   QSTAT+6(1),28(R4)
         SPACE 1
ALLOC2   SR    R5,R5                                         *CNB/XA*
         LA    R5,16(0,R4)        ASID -6 ADDR
         BAL   R7,CHKASID         FIND JOBNAME
         MVC   QJOB(8),JOBNAME
         SR    R1,R1                                         *CNB/XA*
         LA    R1,QUELINE
         SR    R0,R0                                         *CNB/XA*
         IC    R0,XAU
         SVC   35
         MVI   FOUND,X'FF'        ANY OUTPUT
         L     R4,0(0,R4)         NEXT QUEUE ELEMENT
         B     ALLOC1
         SPACE 3
NOALLOC  SR    R5,R5
         SR    R0,R0
         L     R5,AMODE24                                    *CNB/XA*
         BSM   0,R5                                          *CNB/XA*
AMODE24  DC    A(CONT24+X'00000000')                         *CNB/XA*
         DS    0H                                            *CNB/XA*
CONT24   CLI   FOUND,X'00'        ANY OUTPUT
         BNE   EXIT
         SR    R1,R1                                         *CNB/XA*
         LA    R1,NALOCMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT
FORMAT   MVC   UNIT(3),13(R3)     UNIT NAME
         MVC   VOLSER(6),=CL6' '  NO VOLSER
         TM    18(R3),X'A0'       DASD OR TAPE
         BZ    *+10               NO
         MVC   VOLSER(6),28(R3)   VOLSER
         ST    R4,TEMP
         UNPK  DOUBLE(7),TEMP+1(4)
         NC    DOUBLE(6),=8X'0F'
         TR    DOUBLE(6),=C'0123456789ABCDEF'
         MVC   IOQADDR(6),DOUBLE
         SR    R1,R1                                         *CNB/XA*
         IC    R1,4(0,R5)         DRIVER ID
         SLL   R1,3
         LA    R1,DRIVRTAB(R1)    DRIVER NAME
         MVC   DRIVER(8),0(R1)
         MVC   STATUS(6),=CL6'ACTIVE'
         MVC   BL1(2),=2C' '                                 *CNB/XA*
         MVC   BL2(2),=2C' '                                 *CNB/XA*
         MVC   BL3(2),=2C' '                                 *CNB/XA*
         MVC   BL4(2),=2C' '                                 *CNB/XA*
         MVC   BL5(2),=2C' '                                 *CNB/XA*
         MVC   BL6(20),=20C' '                               *CNB/XA*
         MVC   IOLINE+0(4),=X'00350100'                      *CNB/XA*
         SR    R1,R1                                         *CNB/XA*
         LA    R1,IOLINE
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         MVI   FOUND,X'FF'
         BR    R7
CHKASID  SR    R8,R8                                         *CNB/XA*
         ICM   R8,3,6(R5)        ASID
         CH    R8,=H'1'          MASTER
         BNH   CHKASID6           YES
         SLL   R8,2              X 4
         SR    R15,R15                                       *CNB/XA*
         L     R15,16             CVT
         L     R15,556(0,R15)     ASVT
         L     R15,524(R8,R15)   ASCB
         L     R8,56(0,R15)      CSCB
         CLI   28(R8),X'03'      INIT CSCB
         BE    CHKASID2           GET JOBNAME
         SPACE 1
CHKASID1 LA    R8,0(0,R8)
         LTR   R8,R8            CSCB EXIST
         BZ    CHKASID5           NO, PRINT ASID
         MVC   JOBNAME(8),8(R8)
         BR    R7
         SPACE 1
CHKASID2 LR    R15,R8            CSCB
         SR    R1,R1                                         *CNB/XA*
         ICM   R1,3,30(R15)       ASID
         SPACE 1
CHKASID3 L     R8,0(0,R8)       NEXT CSCB
         LTR   R8,R8            END OF CSCBS
         BNZ   CHKASID4           NO
         LR    R8,R15            ORIG CSCB
         B     CHKASID1
         SPACE 1
CHKASID4 CR    R8,R15            SAME CSCB
         BE    CHKASID1           YES
         CH    R1,30(0,R8)       ASID MATCH
         BNE   CHKASID3           NO, CHECK NEXT CSCB
         B     CHKASID1
         SPACE 1
CHKASID5 MVC   JOBNAME(4),=CL4'AS='
         UNPK  JOBNAME+4(5),6(3,R5)
         NC    JOBNAME+4(4),=4X'0F'
         TR    JOBNAME+4(4),=X'0123456789ABCDEF'
         MVI   JOBNAME+5,C' '
         BR    R7
         SPACE 1
CHKASID6 MVC   JOBNAME(8),=CL8'*MASTER*'
         BR    R7
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         SR    R5,R5
         SR    R0,R0                                         *CNB/XA*
         L     R5,AMODE24X                                   *CNB/XA*
         BSM   0,R5                                          *CNB/XA*
AMODE24X DC    A(CONT24X+X'00000000')                        *CNB/XA*
         DS    0H                                            *CNB/XA*
CONT24X  SR    R15,R15
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESR03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
MSGRTN1  SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     EXIT
NOTFOUND CLI   FOUND,X'00'        ANY OUTPUT
         BNE   EXIT
         SR    R1,R1                                         *CNB/XA*
         LA    R1,NFNDMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         SPACE 3
EXIT     EQU   *
         ESTAE 0                                      ****(RLL)****
         SR    R0,R0                                         *CNB/XA*
         L     R0,SIZE
         SR    R14,R14                                       *CNB/XA*
         L     R14,SAVE
         SR    R1,R1                                         *CNB/XA*
         LR    R1,R13
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORK)
NFNDMSG  DC    X'00350100'
         DC    CL50'NO SUBCHANNEL I/O REQUESTS OUTSTANDING            '
NALOCMSG DC    X'00350100'
         DC    CL50'NO ALLOCATION REQUESTS OUTSTANDING                '
QMSG1    DC    X'00350100'
         DC    CL50'QUEUED I/O NOT SUPPORTED IN XA MODE               '
STAEMSG  DC    X'00350100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 3
DRIVRTAB DC    CL8'IOSRESV '
         DC    CL8'IOSMISC '
         DC    CL8'EXCP    '
         DC    CL8'VSAM    '
         DC    CL8'VTAM    '
         DC    CL8'TCAM    '
         DC    CL8'OLTEP   '
         DC    CL8'PCIFETCH'
         DC    CL8'JES3    '
         DC    CL8'MSC/MSS '
         DC    CL8'PURGE   '
         DC    CL8'VPSS    '
         DC    CL8'CRYPTO  '
         DC    CL8'ASM     '
         DC    CL8'SUSP/RES'
         DC    CL8'DYN/PATH'                                 *CNB/XA*
         DC    CL8'DAVV    '                                 *CNB/XA*
         DC    CL8'SVC33   '                                 *CNB/XA*
         DC    CL8'CLR RECV'                                 *CNB/XA*
         DC    CL8'SVC16PRG'                                 *CNB/XA*
         DC    CL8'ALT PATH'                                 *CNB/XA*
         DC    CL8'MIH     '                                 *CNB/XA*
WORK     DSECT
SAVE     DS    F
XSASAVE  DS    F
TEMP     DS    F
         DS    0D
DOUBLE   DS    2F
         SPACE 3
         DS    0F
IOLINE   DS    0CL50
         DS    F
UNIT     DS    CL3
BL1      DS    CL2                                           *CNB/XA*
VOLSER   DS    CL6
BL2      DS    CL2                                           *CNB/XA*
JOBNAME  DS    CL8
BL3      DS    CL2                                           *CNB/XA*
IOQADDR  DS    CL6
BL4      DS    CL2                                           *CNB/XA*
DRIVER   DS    CL8
BL5      DS    CL2                                           *CNB/XA*
STATUS   DS    CL6
BL6      DS    CL20                                          *CNB/XA*
         SPACE 3
         DS    0F
QUELINE  DS    0CL50
         DS    F
QJOB     DS    CL8
         DS    CL2
QSTAT    DS    CL7
         DS    CL2
MASK1    DS    CL12
         DS    CL2
MASK2    DS    CL12
         DS    CL20
         SPACE 1
SAVEOLD  DS    CL3                                           *CNB/XA*
FOUND    DS    C
TYPE     DS    C
ENDUCBX  DS    C                                             *CNB/XA*
         DS    0D
PARMLIST DS    3F                                            *CNB/XA*
         ORG   PARMLIST
PARMWA   DS    F                                             *CNB/XA*
PARMDEVT DS    F                                             *CNB/XA*
PARMUCB  DS    F                                             *CNB/XA*
         ORG
DEVCLASS DS    CL1                                           *CNB/XA*
ADDRUCB  DS    F                                             *CNB/XA*
         DS    0D
WORKAREA DS    CL100                                         *CNB/XA*
         DS    0F
ESTAELST DS    0F,(ESTAEOVX)X                         ****(RLL)****
WORKEND  DS    0D
DSXSA    DSECT
XSA      DS    0D
XAP      DS    F                  PTR TO XCTL NAME
XAD      DS    F                  DCB PTR
XAX      DS    D                  XCTL NAME
XAE      DS    0C                 ERROR CODE
XAR      DS    F                  PTR TO PARM LIST (REG1)
XAN      DS    0C                 VERB INDEX
XAL      DS    F                  PTR TO LIST POSITION
XAV      DS    D                  VERB
XAS      DS    D                  TEMP SAVE-AREA
XAU      DS    C                  UCM ENTRY INDICATOR
         DS    C                  RESERVED
XAJ      DS    H                  TJID ENTRY INDICATOR
         DS    F                  RESERVED
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         PRINT NOGEN
         IHASDWA
         CVT   DSECT=YES                                     *CNB/XA*
         IEFUCBOB PREFIX=YES                                 *CNB/XA*
         END
./       ADD   NAME=CSCSS03D
         TITLE 'IEESS03D -   #E  EXECUTE MVS COMMAND'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESS03D -       #E  EXECUTE MVS COMMAND                  ***
***                                                                 ***
***       VERSION -        1.2                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   TO MVS/SP1.3              ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        01/26/83  AXC-CBT CHANGE ESTAE PARM LEN  ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESS03D CSECT
         LR    R12,R15
         USING IEESS03D,R12
         L     R0,SIZE
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         XC    CMDLIST(4),CMDLIST
         MVI   CMDLIST+4,C' '
         MVC   CMDLIST+82(4),=CL4' '
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         L     R3,XAL              LOAD SUB-PARM ADDR
         LTR   R3,R3               SUB-PARM PRESENT
         BZ    CMDERR              NO, ERROR
         SPACE 1
         CLC   0(6,R3),=CL6'V PATH'  VARY PATH COMMAND
         BE    VARY                YES
         B     COMMAND
         SPACE 1
CMDERR   LA    R1,ERRMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         SPACE 3
EXIT     EQU   *
         ESTAE 0
         L     R0,SIZE             LOAD FREEMAIN SIZE
         LR    R1,R13              LOAD FREEMAIN ADDR
         L     R14,SAVRET          LOAD RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14                 EXIT
VARY     MVC   VPTHLIM(1),13(R3)   SET UPPER LIMIT
         CLI   9(R3),C'9'
         BH    CMDERR
         CLI   9(R3),C'0'
         BNL   *+20
         CLI   9(R3),C'A'
         BL    CMDERR
         CLI   9(R3),C'F'
         BH    CMDERR
         CLI   13(R3),C'9'
         BH    CMDERR
         CLI   13(R3),C'0'
         BNL   *+20
         CLI   13(R3),C'A'
         BL    CMDERR
         CLI   13(R3),C'F'
         BH    CMDERR
         CLI   6(R3),C'('
         BNE   CMDERR
         CLI   16(R3),C')'
         BNE   CMDERR
         CLI   10(R3),C'-'
         BNE   CMDERR
         CLI   14(R3),C','
         BNE   CMDERR
         MVC   CMDLIST+5(10),0(R3)
         MVC   CMDLIST+15(63),14(R3)
         MVC   CMDLIST+76(10),=CL10' '
         LA    R9,16               MAX POSSIBLE COMMANDS
         LA    R14,CMDLIST+5
         LA    R15,CMDLIST+85
VARY1    CLI   0(R15),C' '         END OF COMMAND
         BNE   VARY2               YES
         CR    R14,R15             BEGIN OF COMMAND
         BE    VARY2               YES
         BCT   R15,VARY1
         SPACE 1
VARY2    SR    R15,R14
         LA    R15,11(0,R15)
         SRL   R15,2
         SLL   R15,2
         STH   R15,CMDLIST
         SPACE 1
VARY3    MVC   ISSMSG(52),ISSMSGT
         MVC   ISSMSG+18(34),CMDLIST+5
         LA    R1,CMDLIST          YES
         SR    R0,R0
         IC    R0,XAU
         SVC   34
         LA    R1,ISSMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         CLI   CMDLIST+14,C'F'           LIMIT REACHED
         BE    EXIT                      YES
         CLC   CMDLIST+14(1),VPTHLIM     LIMIT REACHED
         BE    EXIT                      YES
         SR    R1,R1
         IC    R1,CMDLIST+14
         LA    R1,1(0,R1)
         STC   R1,CMDLIST+14             SAVE NEW DEVICE
         C     R1,=X'000000FA'           WAS PREVIOUS DEV XX9
         BE    VARY4                     YES
         BCT   R9,VARY3
         B     EXIT                      NEXT VARY
         SPACE 1
VARY4    MVI   CMDLIST+14,X'C1'          FORCE SWITCH FROM 9 TO A
         B     VARY3
COMMAND  MVC   CMDLIST+5(77),0(R3) COMMAND
         LA    R14,CMDLIST+5
         LA    R15,CMDLIST+85
         SPACE 1
COMMAND1 CLI   0(R15),C' '         END OF COMMAND
         BNE   COMMAND2            YES
         CR    R14,R15             BEGIN OF COMMAND
         BE    COMMAND2            YES
         BCT   R15,COMMAND1
         SPACE 1
COMMAND2 SR    R15,R14
         LA    R15,11(0,R15)
         SRL   R15,2
         SLL   R15,2
         STH   R15,CMDLIST
         MVC   ISSMSG(52),ISSMSGT
         MVC   ISSMSG+18(34),0(R3)   COMMAND
         LA    R1,CMDLIST          YES
         SR    R0,R0
         IC    R0,XAU
         SVC   34
         LA    R1,ISSMSG
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         B     EXIT
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEESS03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         B     EXIT
         LTORG
         SPACE 5
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
ERRMSG   DC    X'00300100'
         DC    CL44'EXECUTE COMMAND PARAMETER ERROR'
         SPACE 3
ISSMSGT  DC    X'00340100'
         DC    CL48'CMD ISSUED -  X'
         SPACE 3
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    F
XSASAVE  DS    F
VPTHLIM  DS    F
ISSMSG   DS    CL52
         SPACE 3
         DS    0F
CMDLIST  DS    CL86
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X     AXC-CBT
WORKEND  DS    0D
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCSZ03D
         PRINT NOGEN                                               @TEC
         TITLE 'IEESZ03D -   #Z  DISPLAY ACTIVE REPLACEMENT'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEESZ03D -       #Z  DISPLAY ACTIVE REPLACEMENT           ***
***                                                                 ***
***       VERSION -        1.2                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        07/19/81   AXC-CBT HANDLE ESTAE OKAY     ***
***                        08/10/81   JGS - #J CHANGES            NERDC
***                        08/10/81   JCC-BCB TEST FOR END OF ASCB JCC*
***                        01/26/83   AXC-CBT CHANGE ESTAE PARM LEN ***
***                        09/17/91   JCL-TEC ADDR FOR ESA/370      ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEESZ03D CSECT
         LR    R12,R15
         USING IEESZ03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                          @TEC
         BSM   0,R9                                                @TEC
AMODE31  DC    A(CONT31+X'80000000')                               @TEC
CONT31   DS    0H                                                  @TEC
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         MVI   TSOSW,C' '
         L     R3,XAL              PARM LIST ADDR
         LA    R3,0(0,R3)
         LTR   R3,R3               ANY PARM
         BZ    PARM2               NO
         MVC   TSOSW(2),0(R3)      SAVE PARM
         CLI   TSOSW,C'T'          TSO DISPLAY
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C' '          TEST FOR A BLANK                WJB
         BE    PARM1               YES CONTINUE                    WJB
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),TSOSW
         CLC   DOUBLE(2),=C'00'    DOMAIN DISPLAY
         BNE   PARM1
         PACK  DOUBLE(8),TSOSW(2)
         CVB   R1,DOUBLE
         STC   R1,DOMAIN           SAVE DOMAIN
         MVI   TSOSW,C'D'
         B     PARM2
PARM1    MVI   TSOSW,C' '
PARM2    MVC   WTOLIST(4),=X'00410100'                            NERDC
         MVI   SCANRET,C' '        SET FOUND
         SR    R8,R8               CLEAR ASID
         MVI   SCANTYPE,C'I'       SET IN QUEUE SCAN
         LA    R1,HDRI             IN QUEUE HDR
         BAL   R11,MSGRTN1
JOBOUT   MVI   JOBMSG,C' '
         MVC   JOBMSG+1(L'JOBMSG-1),JOBMSG                        NERDC
         LR    R5,R8               LOAD ASID
         LTR   R5,R5               ZERO ASID
         BZ    *+6                 YES, BYPASS ADJUST
         BCTR  R5,0                ADJUST ASID
         SLL   R5,2                MULTIPLY BY 4
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         L     R6,516(0,R4)        MAX # OF ASIDS                 JCC
         MH    R6,=H'4'            MULT BY LENGTH                 JCC
         LA    R6,528(R4,R6)       FIND END OF ASID LIST          JCC
         ST    R6,ASVTEND          STORE THAT ADDR                JCC
         LA    R4,524(R5,R4)       ASCB SLOT ADDR
         B     JOBOUT4
JOBOUT1  L     R5,0(0,R4)          ASCB ADDR
         L     R6,56(0,R5)         CSCB ADDR
         L     R7,144(0,R5)        LOAD OUCB ADDR
         CLI   SCANTYPE,C'I'       IN QUEUE SCAN
         BNE   JOBOUT2             NO
         CLI   41(R7),0            DOES IT HAVE A SWAP REASON CODE WJB
         BNE   JOBOUT6             YES, CHECK SRC                  WJB
         CLI   38(R5),X'7F'        MVS SE                          WJB
         BE    JOBOUT4                                             WJB
         B     JOBOUT3             CONTINUE
JOBOUT2  CLI   38(R5),X'7F'        MVS/SE                          WJB
         BE    JOBOUT3        YES GO PROCESS THIS AS ON OUTQUEUE   WJB
         CLI   41(R7),0            THIS HAVE A SWAP REASON CODE?   WJB
         BE    JOBOUT4             NO, IT'S IN THE IN QUEUE        WJB
         CLI   41(R7),X'06'        DETECTED WAIT
         BNE   JOBOUT3             NO, OUT QUEUE
         TM    21(R7),X'01'        MSO DETECTED WAIT BIT ON
         BZ    JOBOUT4             NO, SRC IS NO GOOD
JOBOUT3  BAL   R11,ASCBFORM        GO FORMAT ASCB INFO
         L     R6,144(0,R5)        OUCB ADDR
         L     R3,60(0,R5)         TSB ADDR
         L     R5,56(0,R5)         CSCB ADDR
         BAL   R11,CSCBFORM        GO FORMAT CSCB INFO
         BAL   R11,OUCBFORM        GO FORMAT OUCB INFO
         LA    R1,WTOLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
JOBOUT4  LA    R4,4(0,R4)          INCR INTO ASVT
         C     R4,ASVTEND          END OF ASVT                    JCC
         BNL   JOBOUT5             YES, RETURN                    JCC
         TM    0(R4),X'80'         AVAILABLE ENTRY
         BO    JOBOUT4             YES, CHECK NEXT
         B     JOBOUT1             GO USE IT
JOBOUT5  CLI   SCANTYPE,C'O'       OUT QUEUE SCAN
         BE    RETURN              YES, EXIT
         MVI   SCANRET,C' '        INIT OUTPUT SWITCH
         MVI   SCANTYPE,C'O'       SET OUT QUEUE SCAN NEXT
         LA    R1,HDRO             OUT QUEUE HDR
         BAL   R11,MSGRTN1
         B     JOBOUT              NEXT PASS
JOBOUT6  CLI   41(R7),X'06'        DETECTED WAIT
         BNE   JOBOUT4             NO, OUT QUEUE
         TM    21(R7),X'01'        MSO DETECTED WAIT BIT ON
         BZ    JOBOUT3             NO, SRC IS NO GOOD
         B     JOBOUT4             OUT QUEUE
ASCBFORM UNPK  DOUBLE(5),36(3,R5)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   ASID(4),DOUBLE      SET ASID IN MSG
         UNPK  DPRTY(3),43(2,R5)   DPRTY TO MSG                   NERDC
         NC    DPRTY(2),=4X'0F'                                   NERDC
         TR    DPRTY(2),=C'0123456789ABCDEF'                      NERDC
         MVI   DPRTY+2,C' '                                       NERDC
         LH    R1,38(0,R5)         DISP POSITION
         CVD   R1,DOUBLE
         UNPK  SRC(2),DOUBLE+6(2)
         OI    SRC+1,X'F0'
         L     R15,64(R5)          CPU TIME                       NERDC
         A     R15,200(R5)           + SRB TIME                   NERDC
         LTR   R15,R15             TEST FOR ZERO                  NERDC
         BP    *+6                 SKIP IF PLUS                   NERDC
         SR    R15,R15             ELSE SET TO ZERO               NERDC
         SR    R14,R14                                            NERDC
         SLDL  R14,20              CONVERT TO SECONDS             NERDC
         D     R14,=F'1000000'     SEC = TOD * 1.048576           NERDC
         CVD   R15,DOUBLE          TO DECIMAL                     NERDC
         MVC   CPUTIME-1(6),=X'402020202120'                      NERDC
         ED    CPUTIME-1(6),DOUBLE+5  TO PRINT                    NERDC
         L     R15,80(R5)          STEP TIME LIMIT                NERDC
         S     R15,64(R5)           - TIME USED = TIME REMAINING  NERDC
         LTR   R15,R15             TEST FOR ZERO                  NERDC
         BP    *+6                 SKIP IF OK                     NERDC
         SR    R15,R15             ELSE SET TO ZERO               NERDC
         SR    R14,R14                                            NERDC
         SLDA  R14,20              CONVERT TO                     NERDC
         D     R14,=F'1000000'       SECONDS                      NERDC
         CVD   R15,DOUBLE          TO PRINTABLE                   NERDC
         MVC   CPUREM-1(6),=X'402020202120'                       NERDC
         ED    CPUREM-1(6),DOUBLE+5  TO PRINT LINE                NERDC
         MVC   SC(2),=C'  '        CLEAR FOR LATER TEST           NERDC
         TM    52(R5),X'10'        V=R
         BCR   8,R11               NO
         MVC   SC(2),=C' R'        SET IN SWAP COUNT FIELD        NERDC
         BR    R11
CSCBFORM CLI   TSOSW,C'T'          TSO USER DISPLAY
         BNE   CSCBFRM0            NO
         CLI   28(R5),X'01'        TSO USER
         BNE   JOBOUT4             NO, BYPASS
         B     CSCBFRM6
CSCBFRM0 CLI   28(R5),X'01'        TSO USER
         BE    JOBOUT4             YES, DONT PROCESS
         CLI   28(R5),X'03'        INIT
         BNE   CSCBFRM3            NO, GO HANDLE
         LA    R9,0(0,R5)          SAVE CSCB ADDR
         SR    R10,R10             INSERT
         IC    R10,30(0,R5)
         SLL   R10,8               ASID
         IC    R10,31(0,R5)
CSCBFRM1 L     R5,0(0,R5)          NEXT CSCB
         LA    R5,0(0,R5)          CLEAR HIGH ORDER
         LTR   R5,R5               END OF CSCBS
         BNZ   *+10                NO, CONTINUE
         LR    R5,R9               LOAD CSCB ADDR
         B     JOBOUT4             NO GOOD
         CR    R5,R9               SAME CSCB
         BE    JOBOUT4             YES, NO GOOD
         CH    R10,30(0,R5)        SAME ASID
         BNE   CSCBFRM1            NO, CHECK NEXT
CSCBFRM2 MVC   JOBNAME(8),8(R5)
         MVC   STEPNAME(8),64(R5)
         MVC   PROCNAME(8),32(R5)
         B     CSCBFRM4
CSCBFRM3 MVC   JOBNAME(8),16(R5)
         MVC   STEPNAME(8),8(R5)
         MVC   PROCNAME(8),32(R5)
CSCBFRM4 CLI   TSOSW,C'D'          DOMAIN DISPLAY
         BNE   CSCBFRM5            NO
         CLC   DOMAIN(1),40(R6)    DOMAIN MATCH    MVS/SE         WJB
         BNE   JOBOUT4
CSCBFRM5 CLC   ASID(4),=C'0001'
         BCR   7,R11
         MVC   JOBNAME(26),=CL26'MASTER'
         BR    R11
CSCBFRM6 MVC   JOBNAME(8),8(R5)
         MVC   STEPNAME(8),16(R5)
         CLC   TSTSVC35(2),=X'0A23'  IS THIS TSO EXECUTION OF #J
         BNE   CSCBFRM5              YES, BYPASS 0C4
*   IF YOU HAVE VTAM NO - OP NEXT THREE INSTRUCTIONS               WJB
*        UNPK  PROCNAME(5),82(3,R3)  LINE NUMBER
*        NC    PROCNAME(4),=8X'0F'
*        TR    PROCNAME(4),=C'0123456789ABCDEF'
         MVC   PROCNAME+4(4),=CL4' '
         B     CSCBFRM5
OUCBFORM DS    0H                                                  WJB
         CLI   41(R6),X'00'        JOB ON IN QUEUE                 WJB
         BE    OUCBFRM0            YES, NO SWAP REASON
         UNPK  SRC(3),41(2,R6)     SWAP REASON             MVS/SE WJB
         NC    SRC(2),=8X'0F'
         TR    SRC(2),=C'0123456789ABCDEF'
         MVI   SRC+2,C' '
         CLI   38(R5),X'7F'        MVS SE                          WJB
         BNE   OUCBLOG1                                            WJB
         MVC   SRC(2),=CL3'LG'     FAKE UP LOGICAL SWAP CODE       WJB
         B     OUCBFRM0            AND CONTINUE                    WJB
OUCBLOG1 DS    0H                                                  WJB
OUCBFRM0 MVC   FLAGS(3),=CL3'NSW'
         TM    17(R6),X'80'        NON-SWAPPABLE
         BO    OUCBFRM1
         MVC   FLAGS(3),=CL3'IN'
         CLI   SCANTYPE,C'I'       IN QUEUE SCAN
         BE    OUCBFRM1
         MVC   FLAGS(3),=CL3'OUT'
         TM    16(R6),X'E0'        GOING IN/OUT
         BZ    OUCBFRM1            NO, JUST OUT
         MVC   FLAGS(3),=CL3'GOO'
         TM    16(R6),X'80'        GOING OUT
         BO    OUCBFRM1
         MVC   FLAGS(3),=CL3'GOB'
         TM    16(R6),X'20'        TRANSITIONING
         BO    OUCBFRM1
         MVC   FLAGS(3),=CL3'GOI'
OUCBFRM1 MVC   FLAGS+3(2),=CL2'A'
         TM    18(R6),X'04'        AUX STORAGE SHORTAGE
         BC    1,OUCBFRM2                                         NERDC
         MVC   FLAGS+3(2),=CL2'S'
         TM    18(R6),X'01'        REAL STORAGE SHORTAGE
         BC    1,OUCBFRM2                                         NERDC
         MVC   FLAGS+3(2),=CL2'LW'
         TM    21(R6),X'80'        LONG WAIT
         BC    1,OUCBFRM2                                         NERDC
         MVC   FLAGS+3(2),=CL2'MW'
         TM    21(R6),X'01'        DETECTED WAIT
         BC    1,OUCBFRM2                                         NERDC
         MVC   FLAGS+3(2),=CL2'CP'
         TM    19(R6),X'10'        CPU USER
         BC    1,OUCBFRM2                                         NERDC
         MVC   FLAGS+3(2),=CL2' '
OUCBFRM2 LH    R1,184(R6)          OUCBNPG (PERFORM GRP NO)       NERDC
         CVD   R1,DOUBLE                                          NERDC
         UNPK  PG(2),DOUBLE+6(2)                                  NERDC
         OI    PG+1,X'F0'                                         NERDC
         CLI   SC+1,C'R'           V=R SET?                       NERDC
         BER   R11                 YES, SKIP SETTING SWAP COUNT   NERDC
         LH    R1,42(R6)           SWAP COUNT                     NERDC
         CVD   R1,DOUBLE                                          NERDC
         UNPK  SC(2),DOUBLE+6(2)                                  NERDC
         OI    SC+1,X'F0'                                         NERDC
         CH    R1,=H'100'                                         NERDC
         BL    *+4+6                                              NERDC
         MVC   SC(2),=C'**'        SET OVERFLOW                   NERDC
         BR    R11
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         USING *,R15
STAERTRY L     R12,=A(IEESZ03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         LA    R11,RETURN          LOAD RET ADDR
MSGRTN   MVI   SCANRET,C'P'
MSGRTN1  SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
TSTSVC35 EQU   *
         SVC   35                  ISSUE WTO
         BR    R11
RETURN   EQU   *
         CLI   SCANRET,C' '        ANY FOUND
         BE    NOTFOUND            NO, TELL OPERATOR
         ESTAE  0
         LA    R8,AMODE24                                          @TEC
         BSM   0,R8                                                @TEC
AMODE24  DS    0H                                                  @TEC
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
NOTFOUND LA    R11,RETURN
         LA    R1,NFNDMSG
         B     MSGRTN
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         DS    0F
NFNDMSG  DC    X'00360100'
         DC    CL50'NO JOBS ON OUT QUEUE'
HDRI     DC    X'00410100'                                        NERDC
         DC    CL26'*****   IN   QUEUE   *****'                   NERDC
         DC    CL35' ASID DP PG QP SC FLAGS   CPU  CPUR'          NERDC
HDRO     DC    X'00410100'                                        NERDC
         DC    CL26'*****   OUT  QUEUE   *****'
         DC    CL35' ASID DP PG SR SC FLAGS   CPU  CPUR'          NERDC
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
XSASAVE  DS    F
ASVTEND  DS    F                                                  JCC
SCANRET  DS    C
SCANTYPE DS    C
TSOSW    DS    C
DOMAIN   DS    C
         DS    0F
WTOLIST  DS    F
JOBMSG   DS    0CL61                                              NERDC
JOBNAME  DS    CL9
STEPNAME DS    CL9
PROCNAME DS    CL9                                                NERDC
ASID     DS    CL5                                                NERDC
DPRTY    DS    CL3                                                NERDC
PG       DS    CL3                                                NERDC
SRC      DS    CL3                                                NERDC
SC       DS    CL3                                                NERDC
FLAGS    DS    CL6
CPUTIME  DS    CL6                                                NERDC
CPUREM   DS    CL5                                                NERDC
ESTAELST DS    0F,(ESTAEOVX)X     AXC-CBT
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAV      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCZA03D
         TITLE 'ESAZA03D -   ##A  ACTIVITY MONITOR'
         PRINT NOGEN                                               @TEC
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SE2ZA03D -       ##A  ACTIVITY MONITOR                    ***
***                                                                 ***
***       VERSION -        3.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        04/01/80                                 ***
***                        08/10/81  JCC-BCB TEST FOR END OF ASCBS  ***
***                        02/07/84  JCC-SNET ADD 31-BIT CODING     ***
***                                      FOR XA.                    ***
***                        09/05/91  TEC-JCL FIX FRAME COUNTS       ***
***                                      AND EXCP COUNTS            ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
*-------------------------------------------------------------*    @TEC
* REGISTER USAGE:                                             *    @TEC
*                                                             *    @TEC
*  R0  - WORK REGISTER                                        *    @TEC
*  R1  - WORK REGISTER                                        *    @TEC
*      - CONTROL BLOCK BASE. OUXB                             *    @TEC
*  R2  - BASE ADDR OF XSA (PLIST FROM CONTROLLER)             *    @TEC
*  R3  - WORK REGISTER                                        *    @TEC
*  R4  - CONTROL BLOCK BASE. CVT,ASVT                         *    @TEC
*      - OFFSET WITHIN DOMAIN TABLE                           *    @TEC
*  R5  - CONTROL BLOCK BASE. ASCB                             *    @TEC
*  R6  - CONTROL BLOCK BASE. CSCB, OUCB (RARELY)              *    @TEC
*  R7  - CONTROL BLOCK BASE. OUCB (USUALLY)                   *    @TEC
*  R8  - CURRENT ENTRY WITHIN JOBTABLE                        *    @TEC
*  R9  - WORK REGISTER                                        *    @TEC
*  R10 - SUBROUTINE LINKAGE (2ND LEVEL)                       *    @TEC
*  R11 - SUBROUTINE LINKAGE (1ST LEVEL)                       *    @TEC
*  R12 - PROGRAM BASE ADDRESS                                 *    @TEC
*  R13 - WORKING STORAGE BASE (DSECT WORK)                    *    @TEC
*  R14 - WORK REGISTER                                        *    @TEC
*  R15 - WORK REGISTER                                        *    @TEC
*-------------------------------------------------------------*    @TEC
IEEZA03D CSECT
IEEZA03D AMODE 24
IEEZA03D RMODE 24
         SPLEVEL SET=2
         LR    R12,R15
         USING IEEZA03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31          -JAL/XA-
         BSM   0,R9                -JAL/XA-
AMODE31  DC    A(CONT31+X'80000000')  -JAL/XA-
CONT31   DS    0H                  -JAL/XA-
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L     * ESTAE PARM FIX        *
ESTAEOVX EQU   *-ESTAEOVL          * ESTAE PARM FIX        *
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL  * ESTAE PARM FIX        *
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         MVI   TSOSW,C' '
         XC    JOBTOT2(8),JOBTOT2
         XC    DMNTAB(200),DMNTAB
         MVC   DMNTAB+200(200),DMNTAB
         MVC   DMNTAB+400(200),DMNTAB
         MVC   DMNTAB+600(200),DMNTAB
         MVC   DMNTAB+800(200),DMNTAB
         MVC   DMNTAB+1000(200),DMNTAB
         MVC   DMNTAB+1200(200),DMNTAB
         MVC   DMNTAB+1400(200),DMNTAB
         MVC   DMNTAB+1600(200),DMNTAB
         MVC   DMNTAB+1800(200),DMNTAB
         MVC   DMNTAB+2000(200),DMNTAB
         MVC   DMNTAB+2200(200),DMNTAB
         CLC   TSTSVC35(2),=X'0A23'  TSO OR STANDALONE EXEC
         BE    *+16                NO
         MVC   HDRIA(26),=CL26'ASID DSP DMN PGN SWC FLAGS'
         MVC   HDROA(26),=CL26'ASID DSP DMN PGN SWC FLAGS'
*-------------------------------------------------------------*    @TEC
* DECODE COMMAND PARAMETER                                    *    @TEC
*-------------------------------------------------------------*    @TEC
         L     R1,XAT              LOAD WAITTIME ADDR
         L     R15,8(0,R1)         LOAD HEX WAITTIME
         LTR   R15,R15             TIME NOT SPECIFIED
         BNZ   *+10                NO
         MVC   0(8,R1),=CL8'00003000'  30 SECONDS DEFAULT
         L     R3,XAL              PARM LIST ADDR
         LA    R3,0(0,R3)
         LTR   R3,R3               ANY PARM
         BZ    PARM2               NO
         MVC   TSOSW(2),0(R3)      SAVE PARM
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'T'          TSO DISPLAY
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'J'          JOB DISPLAY
         BE    PARM1               YES, CONTINUE
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),TSOSW
         CLC   DOUBLE(2),=C'00'    DOMAIN DISPLAY
         BNE   PARM1
         PACK  DOUBLE(8),TSOSW(2)
         CVB   R1,DOUBLE
         STC   R1,DOMAIN           SAVE DOMAIN
         MVI   TSOSW,C'X'
         B     PARM2
PARM1    MVI   TSOSW,C' '
PARM2    MVC   WTOLIST(4),=X'00540100'
         MVI   SCANRET,C' '        SET FOUND
         MVI   SCANTYPE,C'I'       SET IN QUEUE SCAN
*-------------------------------------------------------------*    @TEC
* LOOP OVER ASVT TO SCAN ALL ASCB'S                           *    @TEC
*-------------------------------------------------------------*    @TEC
SETINIT  L     R4,16               CVT
         L     R4,556(0,R4)        ASVT
         L     R8,516(0,R4)        MAX # OF ASIDS                JCC
         MH    R8,=H'4'            MULT BY LENGTH                JCC
         LA    R8,528(R4,R8)       FIND END OF ASID LIST         JCC
         ST    R8,ASVTEND          STORE THAT ADDR               JCC
         LA    R4,524(0,R4)        ASCB SLOT ADDR
         LA    R8,JOBTABLE         ASCB/OUCB INFO STORAGE
SETINIT1 XC    0(60,R8),0(R8)
SETINIT2 LA    R4,4(0,R4)          INCR INTO ASVT
         C     R4,ASVTEND          END OF ASVT                   JCC
         BNL   SETINIT4            YES, EXIT                     JCC
         TM    0(R4),X'80'         AVAILABLE SLOT
         BO    SETINIT2            YES
         L     R5,0(0,R4)          ASCB ADDR
         LA    R5,0(0,R5)
         L     R7,144(0,R5)        OUCB ADDR
         ST    R5,0(0,R8)          ENTRY ID
         LM    R14,R15,64(R5)      TCB TIME
         SRDL  R14,22
         LR    R1,R15
         LM    R14,R15,200(R5)     SRB TIME
         SRDL  R14,22
         AR    R15,R1
         ST    R15,4(0,R8)         SAVE PREVIOUS CPU TIME
         SR    R15,R15
         L     R15,320(0,R5)       EXCP COUNT                      @TEC
         A     R15,64(0,R7)        OUCB EXCP COUNT                 @TEC
         ST    R15,16(0,R8)        SAVE TOTAL EXCPS
         L     R1,148(0,R5)        OUXB ADDR
         LA    R1,0(0,R1)
         LTR   R1,R1               VALID ADDR
         BZ    SETINIT3            NO
         L     R14,16(0,R1)        CURR PAGEIN
         ST    R14,28(0,R8)        SAVE CURR PAGEIN
         L     R14,20(0,R1)        CURR PAGEOUT
         ST    R14,32(0,R8)        SAVE CURR PAGEOUT
         L     R14,24(0,R1)        CURR PAGE RECLAIM
         ST    R14,36(0,R8)        SAVE CURR PAGE RECLAIM
         L     R14,28(0,R1)        CURR VIO PAGEIN
         ST    R14,40(0,R8)        SAVE CURR VIO PAGEIN
         L     R14,32(0,R1)        CURR VIO PAGEOUT
         ST    R14,44(0,R8)        SAVE CURR VIO PAGEOUT
         L     R14,36(0,R1)        CURR VIO RECLAIM
         ST    R14,48(0,R8)        SAVE CURR VIO RECLAIM
SETINIT3 TIME  BIN
         ST    R0,52(0,R8)
         LA    R8,56(0,R8)         NEXT ENTRY
         B     SETINIT1
*-------------------------------------------------------------*    @TEC
* AFTER INITIAL SCAN WAIT FOR USER-SPECIFIED INTERVAL         *    @TEC
*-------------------------------------------------------------*    @TEC
SETINIT4 L     R3,XAT              LOAD WAITTIME ADDR
         STIMER  WAIT,DINTVL=(R3)
         LA    R1,HDRI             IN QUEUE HDR
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    JOBOUT              YES, CONTINUE
         BAL   R11,MSGRTN1
*-------------------------------------------------------------*    @TEC
* RE-SCAN ALL ASCB'S AND CALCULATE OUTPUT.                    *    @TEC
* NB: ASVT IS SCANNED ONCE FOR IN-QUEUE AND AGAIN FOR         *    @TEC
* SWAPPED OUT USERS, IF REQUIRED.                             *    @TEC
*-------------------------------------------------------------*    @TEC
JOBOUT   L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         L     R5,516(0,R4)        MAX # OF ASIDS                JCC
         MH    R5,=H'4'            MULT BY LENGTH                JCC
         LA    R5,528(R4,R5)       FIND END OF ASID LIST         JCC
         ST    R5,ASVTEND          STORE THAT ADDR               JCC
         LA    R4,524(0,R4)        ASCB SLOT ADDR
         B     JOBOUT4
JOBOUT1  L     R5,0(0,R4)          ASCB ADDR
         LA    R5,0(0,R5)
         L     R6,56(0,R5)         CSCB ADDR
         L     R7,144(0,R5)        LOAD OUCB ADDR
         CLI   SCANTYPE,C'I'       IN QUEUE SCAN
         BNE   JOBOUT2             NO
         CLI   41(R7),X'00'        SRC PRESENT
         BNE   JOBOUT6             YES, GO CHECK DET WAIT
         CLI   38(R5),X'7F'        LOGICAL SWAP
         BE    JOBOUT4             YES, OUT
         B     JOBOUT3             CONTINUE
JOBOUT2  CLI   38(R5),X'7F'        LOGICAL SWAP
         BE    JOBOUT3             YES, OUT QUEUE
         CLI   41(R7),X'00'        SWAP REASON
         BE    JOBOUT4             NO, IN QUEUE
         CLI   41(R7),X'06'        DETECTED WAIT
         BNE   JOBOUT3             NO
         TM    21(R7),X'01'        MSO DET WAIT BIT ON
         BZ    JOBOUT4             NO, IGNORE SRC
JOBOUT3  MVI   JOBMSG,C' '
         MVC   JOBMSG+1(79),JOBMSG
         BAL   R11,ASCBFORM        GO FORMAT ASCB INFO
         L     R6,144(0,R5)        OUCB ADDR
         L     R3,60(0,R5)         TSB ADDR
         L     R5,56(0,R5)         CSCB ADDR
         BAL   R11,CSCBFORM        GO FORMAT CSCB INFO
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    JOBOUT4             YES, CONTINUE
         LA    R1,WTOLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
JOBOUT4  LA    R4,4(0,R4)          INCR INTO ASVT
         C     R4,ASVTEND          END OF ASVT                   JCC
         BNL   JOBOUT5             YES, RETURN                   JCC
         TM    0(R4),X'80'         AVAILABLE ENTRY
         BO    JOBOUT4             YES, CHECK NEXT
         B     JOBOUT1             GO USE IT
JOBOUT5  CLI   SCANTYPE,C'O'       OUT QUEUE SCAN
         BE    DMNCHK              YES, EXIT
         MVI   SCANRET,C' '        INIT OUTPUT SWITCH
         MVI   SCANTYPE,C'O'       SET OUT QUEUE SCAN NEXT
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    JOBOUT              YES, CONTINUE
         BAL   R11,JOBTOTL         TOTAL INPUT QUEUE
         LA    R1,WTOLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
         LA    R1,HDRO             OUT QUEUE HDR
         BAL   R11,MSGRTN1
         B     JOBOUT              NEXT PASS
JOBOUT6  CLI   41(R7),X'06'        DETECTED WAIT
         BNE   JOBOUT4             NO
         TM    21(R7),X'01'        MSO DET WAIT BIT ON
         BZ    JOBOUT3             NO, IGNORE SRC
         B     JOBOUT4
*-------------------------------------------------------------*    @TEC
* FORMAT ASCB/OUCB INFORMATION.                               *    @TEC
*-------------------------------------------------------------*    @TEC
ASCBFORM LA    R8,JOBTABLE         JOBTABLE ADDR
         UNPK  DOUBLE(5),36(3,R5)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   ASID(4),DOUBLE      SAVE ASID
         CLI   HDRIA,C' '          TSO OR STANDALONE EXEC
         BE    ASCBFRM1            NO, SHORTEN CONSOLE MESSAGE
         L     R7,144(0,R5)        OUCB ADDR
         UNPK  DOUBLE(5),36(3,R5)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   ASIDOUT(4),DOUBLE   ASID
         SR    R1,R1
         IC    R1,43(0,R5)         DPRTY TO MSG
         CVD   R1,DOUBLE
         UNPK  DSP(3),DOUBLE+6(2)
         OI    DSP+2,X'F0'
         LH    R1,42(0,R7)         SWAP COUNT          MVS/SE      WJB
         CVD   R1,DOUBLE
         MVC   SWC-1(4),=X'40202120'
         ED    SWC-1(4),DOUBLE+6
         SR    R1,R1
         IC    R1,40(0,R7)         DOMAIN NUMBER       MVS/SE      WJB
         CVD   R1,DOUBLE
         MVC   DMN-1(4),=X'40202120'
         ED    DMN-1(4),DOUBLE+6
         SR    R1,R1
         IC    R1,185(0,R7)        PERF GROUP NUMBER   MVS/SE2
         CVD   R1,DOUBLE
         MVC   PGN-1(4),=X'40202120'
         ED    PGN-1(4),DOUBLE+6
         CLI   SCANTYPE,C'I'       IN QUEUE PASS
         BNE   ASCBFRM0            NO
         LH    R1,38(0,R5)         DISP POSITION
         CVD   R1,DOUBLE
         MVC   FLAGS(5),=CL5'NS-'
         TM    17(R7),X'80'        NON-SWAPPABLE
         BO    *+10                YES
         MVC   FLAGS(5),=CL5'IN-'
         UNPK  FLAGS+3(2),DOUBLE+6(2)
         OI    FLAGS+4,X'F0'
         B     ASCBFRM1
ASCBFRM0 MVC   FLAGS(5),=CL5'OU-'
         UNPK  FLAGS+3(3),41(2,R7)
         NC    FLAGS+3(2),=2X'0F'
         TR    FLAGS+3(2),=C'0123456789ABCDEF'
         MVI   FLAGS+5,C' '
         CLI   41(R7),X'00'        SRC = 0
         BNE   ASCBFRM1            NO
         CLI   38(R5),X'7F'        LOGICAL SWAP
         BNE   ASCBFRM1            NO
         MVC   FLAGS+3(2),=C'LG'
ASCBFRM1 CLC   0(4,R8),=F'0'       JOBTABLE END
         BE    ASCBFRM2            YES
         C     R5,0(0,R8)          ASCB MATCH
         BE    ASCBFRM2            YES
         LA    R8,56(0,R8)         NEXT ENTRY
         B     ASCBFRM1
ASCBFRM2 LM    R14,R15,64(R5)      TCB TIME
         SRDL  R14,22
         LR    R1,R15
         LM    R14,R15,200(R5)     SRB TIME
         L     R7,144(0,R5)        OUCB ADDR
         SRDL  R14,22
         AR    R1,R15
         L     R15,4(0,R8)         LOAD PREVIOUS CPU TIME
         LTR   R15,R15             ANY PREVIOUS
         BNZ   *+6                 NO
         LR    R15,R1              PREVIOUS = CURRENT
         ST    R15,8(0,R8)         SAVE PREVIOUS CPU TIME
         ST    R1,4(0,R8)          SAVE TOTAL CPU TIME
         S     R1,8(0,R8)          SUB PREVIOUS CPU TIME
         ST    R1,12(0,R8)         SAVE DIFFERENCE
         SR    R1,R1
         L     R1,320(0,R5)        EXCP COUNT                      @TEC
         A     R1,64(0,R7)         OUCB EXCP COUNT                 @TEC
         L     R15,16(0,R8)        LOAD PREVIOUS EXCP COUNT
         LTR   R15,R15             ANY PREVIOUS
         BNZ   *+6                 NO
         LR    R15,R1              PREVIOUS = CURRENT
         ST    R15,20(0,R8)        SAVE PREVIOUS CPU TIME
         ST    R1,16(0,R8)         SAVE TOTAL CPU TIME
         S     R1,20(0,R8)         SUB PREVIOUS CPU TIME
         ST    R1,24(0,R8)         SAVE DIFFERENCE
         TIME  BIN
         L     R1,52(0,R8)         OLD TIME
         LTR   R1,R1               ANY OLD TIME
         BNZ   *+8                 YES
         ST    R0,52(0,R8)         OLD TIME = NEW TIME
         LR    R1,R0               BINARY TIME
         S     R1,52(0,R8)         INTERVAL TIME
         ST    R0,52(0,R8)         NEW TIME BEGIN
         ST    R1,TIMEDIFF
         LTR   R1,R1               TIME EQUAL 0
         BZ    ASCBFRMY            YES, NO DIVIDE
         L     R15,24(0,R8)        LOAD EXCP DIFFERENCE
         LTR   R15,R15             NEGATIVE
         BM    ASCBFRMX            YES
         L     R15,12(0,R8)        LOAD CPU DIFFERENCE
         LTR   R15,R15             NEGATIVE
         BM    ASCBFRMX            YES
         SR    R14,R14
         M     R14,=F'10'          PERCENT
         SR    R14,R14
         DR    R14,R1              PERCENT UTIL
         ST    R15,JOBTOT1+4       SAVE JOB TOTAL PCT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   PCT(7),=X'402020204B2020'
         ED    PCT(4),DOUBLE+6
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R1              PERCENT UTIL  (HUNDREDTHS)
         ST    R15,JOBTOT1         SAVE JOB TOTAL HUNDREDTHS
         CVD   R15,DOUBLE          PERCENT TO PRINT  (HUNDREDTHS)
         UNPK  PCT+5(2),DOUBLE+6(2)
         OI    PCT+6,X'F0'
         L     R15,24(0,R8)        LOAD EXCP DIFFERENCE
         SR    R14,R14
         M     R14,=F'100'         SET FOR DIVIDE
         SR    R14,R14
         DR    R14,R1              EXCP PER SEC
         ST    R15,JOBTOT1+12      SAVE JOB TOTAL EXCP
         CVD   R15,DOUBLE
         MVC   SIO(9),=X'4020202020204B2020'
         ED    SIO(6),DOUBLE+5
         SRDL  R14,32
         M     R14,=F'100'
         DR    R14,R1              SIO PER SEC  (HUNDREDTHS)
         ST    R15,JOBTOT1+8       SAVE JOB TOTAL HUNDREDTHS
         CVD   R15,DOUBLE
         UNPK  SIO+7(2),DOUBLE+6(2)
         OI    SIO+8,X'F0'
         L     R1,148(0,R5)        OUXB ADDR
         LA    R1,0(0,R1)
         LTR   R1,R1               VALID ADDR
         BCR   8,R11               NO
         L     R14,16(0,R1)        CURR PAGEIN
         S     R14,28(0,R8)        SUB PREV PAGEIN
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         LR    R15,R14             ACCUMULATE
         L     R14,20(0,R1)        CURR PAGEOUT
         S     R14,32(0,R8)        SUB PREV PAGEOUT
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         AR    R15,R14             ACCUMULATE
         L     R14,24(0,R1)        CURR PAGE RECLAIM
         S     R14,36(0,R8)        SUB PREV PAGE RECLAIM
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         SR    R15,R14             ACCUMULATE
         L     R14,28(0,R1)        CURR VIO PAGEIN
         S     R14,40(0,R8)        SUB PREV VIO PAGEIN
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         AR    R15,R14             ACCUMULATE
         L     R14,32(0,R1)        CURR VIO PAGEOUT
         S     R14,44(0,R8)        SUB PREV VIO PAGEOUT
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         AR    R15,R14             ACCUMULATE
         L     R14,36(0,R1)        CURR VIO RECLAIM
         S     R14,48(0,R8)        SUB PREV VIO RECLAIM
         LTR   R14,R14             OVERFLOW
         BM    ASCBFRM3            YES
         SR    R15,R14             ACCUMULATE
         SR    R14,R14
         M     R14,=F'100'
         D     R14,TIMEDIFF        PAGES PER SEC
         ST    R15,JOBTOT1+20
         CVD   R15,DOUBLE
         LR    R1,R15
         MVC   PAG(7),=X'402020214B2020'
         ED    PAG(4),DOUBLE+6
         SRDL  R14,32
         M     R14,=F'100'
         D     R14,TIMEDIFF        HUNDREDTHS
         ST    R15,JOBTOT1+16
         CVD   R15,DOUBLE
         UNPK  PAG+5(2),DOUBLE+6(2)
         OI    PAG+6,X'F0'
         BAL   R10,CHKFRM
         BR    R11
ASCBFRM3 MVC   PAG(7),=CL7'**OVF**'
         BAL   R10,CHKFRM
         BR    R11
ASCBFRMX MVC   PCT(7),=C'**CHG**'
         BAL   R10,CHKFRM
         BR    R11
ASCBFRMY MVC   PCT(7),=C'**ERR**'
         BAL   R10,CHKFRM
         BR    R11
*-------------------------------------------------------------*    @TEC
* SCAN PFT TO CALCULATE WORKING SET SIZE                      *    @TEC
*-------------------------------------------------------------*    @TEC
CHKFRM   L     R1,16               LOAD CVT ADDR
         L     R1,356(0,R1)        LOAD PVT ADDR
         L     R14,8(R1)           GET ADDR OR AREA IN RIT         @TEC
         L     R0,0(0,R14)         GET ADDR OF FIRST REAL PFTE     @TEC
         L     R1,4(0,R14)         GET ADDR OF LAST REAL PFTE      @TEC
         SR    R1,R0               GET DIFFERENCE                  @TEC
         SRL   R1,5                GET # ENTRIES                   @TEC
         LA    R1,1(0,R1)          ADD IN LAST ONE                 @TEC
         LR    R14,R1              PUT IN PROPER AREA              @TEC
         SR    R1,R1               CLEAR FRAME COUNT
         LR    R15,R0              FIRST PFTE                      @TEC
CHKFRM1  CLC   18(2,R15),36(R5)    ASID MATCH                      @TEC
         BNE   CHKFRM2             NO
         LA    R1,1(0,R1)          ADD 1 TO FRAME COUNT
CHKFRM2  LA    R15,32(0,R15)       NEXT PFT                        @TEC
         BCT   R14,CHKFRM1         PROCESS NEXT
         SLL   R1,2                CALC  'K'
         CVD   R1,DOUBLE
         MVC   FRAME(7),=X'402020202120D2'
         ED    FRAME(6),DOUBLE+5
         BR    R10
JOBTOTL  MVC   WTOLIST+4(18),=CL18'## IN Q TOTL ##'
         SR    R14,R14
         L     R15,JOBTOT2
         D     R14,=F'100'
         A     R15,JOBTOT2+4       TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   PCT(7),=X'402020204B2020'
         ED    PCT(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  PCT+5(2),DOUBLE+6(2)
         OI    PCT+6,X'F0'
         SR    R14,R14
         L     R15,JOBTOT2+8
         D     R14,=F'100'
         A     R15,JOBTOT2+12      TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   SIO(9),=X'4020202020204B2020'
         ED    SIO(6),DOUBLE+5
         CVD   R14,DOUBLE
         UNPK  SIO+7(2),DOUBLE+6(2)
         OI    SIO+8,X'F0'
         SR    R14,R14
         L     R15,JOBTOT2+16
         D     R14,=F'100'
         A     R15,JOBTOT2+20      TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   PAG(7),=X'402020204B2020'
         ED    PAG(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  PAG+5(2),DOUBLE+6(2)
         OI    PAG+6,X'F0'
         MVC   FRAME(35),=CL35' '
         BR    R11
*-------------------------------------------------------------*    @TEC
* COME HERE AFTER ALL ASCB'S SCANNED                          *    @TEC
*-------------------------------------------------------------*    @TEC
DMNCHK   MVC   DMNLIST(4),=X'00540100'
         CLI   TSOSW,C'D'          DOMAIN LIST
         BNE   RETURN              NO
         LA    R1,HDRD             OUT QUEUE HDR
         BAL   R11,MSGRTN1
         LA    R4,DMNTAB-24
         SR    R5,R5
DMNCHK1  CVD   R5,DOUBLE           DOMAIN NUMBER
         MVC   DMNLIST+4(80),=CL80'DOMAIN XX'
         UNPK  DMNNBR(2),DOUBLE+6(2)
         OI    DMNNBR+1,X'F0'
         LA    R5,1(0,R5)          NEXT DOMAIN
         LA    R4,24(0,R4)         NEXT TABLE ENTRY
         C     R5,=F'51'           END OF DOMAINS
         BE    DMNCHK2             YES, TOTAL
         CLC   0(24,R4),=6F'0'     ANY TIME IN THIS DOMAIN
         BE    DMNCHK1             NO
         SR    R14,R14
         L     R15,0(0,R4)
         D     R14,=F'100'
         A     R15,4(0,R4)         TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNPCT(7),=X'402020204B2020'
         ED    DMNPCT(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  DMNPCT+5(2),DOUBLE+6(2)
         OI    DMNPCT+6,X'F0'
         SR    R14,R14
         L     R15,8(0,R4)
         D     R14,=F'100'
         A     R15,12(0,R4)        TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNSIO(9),=X'4020202020204B2020'
         ED    DMNSIO(6),DOUBLE+5
         CVD   R14,DOUBLE
         UNPK  DMNSIO+7(2),DOUBLE+6(2)
         OI    DMNSIO+8,X'F0'
         SR    R14,R14
         L     R15,16(0,R4)
         D     R14,=F'100'
         A     R15,20(0,R4)        TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNPAG(7),=X'402020204B2020'
         ED    DMNPAG(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  DMNPAG+5(2),DOUBLE+6(2)
         OI    DMNPAG+6,X'F0'
         LA    R1,DMNLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
         B     DMNCHK1
DMNCHK2  MVC   DMNLIST+4(80),=CL80'TOTAL PCT'
         SR    R14,R14
         L     R15,JOBTOT2
         D     R14,=F'100'
         A     R15,JOBTOT2+4       TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNPCT(7),=X'402020204B2020'
         ED    DMNPCT(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  DMNPCT+5(2),DOUBLE+6(2)
         OI    DMNPCT+6,X'F0'
         SR    R14,R14
         L     R15,JOBTOT2+8
         D     R14,=F'100'
         A     R15,JOBTOT2+12      TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNSIO(9),=X'4020202020204B2020'
         ED    DMNSIO(6),DOUBLE+5
         CVD   R14,DOUBLE
         UNPK  DMNSIO+7(2),DOUBLE+6(2)
         OI    DMNSIO+8,X'F0'
         SR    R14,R14
         L     R15,JOBTOT2+16
         D     R14,=F'100'
         A     R15,JOBTOT2+20      TOTAL PERCENT
         CVD   R15,DOUBLE          PERCENT TO PRINT
         MVC   DMNPAG(7),=X'402020204B2020'
         ED    DMNPAG(4),DOUBLE+6
         CVD   R14,DOUBLE
         UNPK  DMNPAG+5(2),DOUBLE+6(2)
         OI    DMNPAG+6,X'F0'
         LA    R1,DMNLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
         B     RETURN
CSCBFORM CLI   TSOSW,C'T'          TSO USER DISPLAY
         BNE   CSCBFRM0            NO
         CLI   28(R5),X'01'        TSO USER
         BNE   JOBOUT4             NO, BYPASS
         B     CSCBFRM6
CSCBFRM0 CLI   TSOSW,C'D'          DOMAIN LIST
         BE    *+12                YES, CONTINUE
         CLI   28(R5),X'01'        TSO USER
         BE    JOBOUT4             YES, DONT PROCESS
         CLI   28(R5),X'03'        INIT
         BNE   CSCBFRM3            NO, GO HANDLE
         LA    R9,0(0,R5)          SAVE CSCB ADDR
         SR    R10,R10             INSERT
         IC    R10,30(0,R5)
         SLL   R10,8               ASID
         IC    R10,31(0,R5)
CSCBFRM1 L     R5,0(0,R5)          NEXT CSCB
         LA    R5,0(0,R5)          CLEAR HIGH ORDER
         LTR   R5,R5               END OF CSCBS
         BNZ   *+10                NO, CONTINUE
         LR    R5,R9               LOAD CSCB ADDR
         B     JOBOUT4             NO GOOD
         CR    R5,R9               SAME CSCB
         BE    JOBOUT4             YES, NO GOOD
         CH    R10,30(0,R5)        SAME ASID
         BNE   CSCBFRM1            NO, CHECK NEXT
CSCBFRM2 MVC   JOBNAME(8),8(R5)
         MVC   STEPNAME(8),64(R5)
         B     CSCBFRM4
CSCBFRM3 MVC   JOBNAME(8),16(R5)
         MVC   STEPNAME(8),8(R5)
CSCBFRM4 CLI   TSOSW,C'X'          DOMAIN DISPLAY
         BNE   CSCBFRM5            NO
         CLC   DOMAIN(1),40(R6)    DOMAIN MATCH
         BNE   JOBOUT4
CSCBFRM5 LM    R14,R15,JOBTOT1
         A     R14,JOBTOT2
         A     R15,JOBTOT2+4
         STM   R14,R15,JOBTOT2
         LM    R14,R15,JOBTOT1+8
         A     R14,JOBTOT2+8
         A     R15,JOBTOT2+12
         STM   R14,R15,JOBTOT2+8
         LM    R14,R15,JOBTOT1+16
         A     R14,JOBTOT2+16
         A     R15,JOBTOT2+20
         STM   R14,R15,JOBTOT2+16
         CLI   TSOSW,C'D'          DOMAIN LIST
         BE    CSCBFRM7            YES
         CLC   ASID(4),=C'0001'
         BCR   7,R11
         MVC   JOBNAME(20),=CL20'MASTER'
         BR    R11
CSCBFRM6 MVC   JOBNAME(8),8(R5)
         MVC   STEPNAME(8),16(R5)
         B     CSCBFRM5
CSCBFRM7 SR    R1,R1
         IC    R1,40(0,R6)         DOMAIN NUMBER
         MH    R1,=H'24'
         LA    R1,DMNTAB(R1)       DOMAIN TABLE SLOT
         LM    R14,R15,JOBTOT1
         A     R14,0(0,R1)
         A     R15,4(0,R1)
         STM   R14,R15,0(R1)       SAVE DOMAIN TOTALS
         LM    R14,R15,JOBTOT1+8
         A     R14,8(0,R1)
         A     R15,12(0,R1)
         STM   R14,R15,8(R1)       SAVE DOMAIN TOTALS
         LM    R14,R15,JOBTOT1+16
         A     R14,16(0,R1)
         A     R15,20(0,R1)
         STM   R14,R15,16(R1)      SAVE DOMAIN TOTALS
         B     JOBOUT4
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
**************************************************************
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE
*  OPERANDS, REGISTERS, AND PSW IN IT.
**************************************************************
         STM   R14,R12,12(R13)     SAVE REGISTER
         LR    R14,R13             SAVE ORIG R13
         L     R13,0(R1)           GET ESTAE PARM
         L     R2,XSASAVE          GET XSA ADDRESS
         LR    R13,R14             RESTORE R13
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC  SET TO VRA
*                                  AND EBCDIC
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX  MOVE HEADER
         MVC   SDWAVRA+11-SDWA(8,1),0(R2)  MOVE IN DATA
         MVI   SDWAURAL-SDWA(1),19  SET LENGTH OF DATA
         B     ESTNOP              SKIP CONSTANTS
         ESTMODS ,
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8)
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS
         LA    R3,ESTMODS          POINT AT NAMES
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,                   X
               RECORD=YES,RECPARM=(3),REGS=(14,12)
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         USING *,R15
STAERTRY L     R12,=A(IEEZA03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         LA    R11,RETURN          LOAD RET ADDR
MSGRTN   MVI   SCANRET,C'P'
MSGRTN1  SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
TSTSVC35 SVC   35                  ISSUE WTO
         BR    R11
RETURN   ESTAE 0
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN  R,LV=(0),A=(1)
         LA    R8,AMODE24          -JAL/XA-
         BSM   0,R8                -JAL/XA-
AMODE24  DS    0H                  -JAL/XA-
         SR    R15,R15
         BR    R14
         LTORG
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         DS    0F
STAEMSG  DC    X'00540100'
         DC    CL80'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         DS    0F
NFNDMSG  DC    X'00540100'
         DC    CL80'NO JOBS ON OUT QUEUE'
HDRD     DC    X'00540100'
         DC    CL18'**  DOMAINS  **'
         DC    CL62'CPU PCT  SIO/SEC  PAG/SEC'
HDRI     DC    X'00540100'
         DC    CL18'** IN  QUEUE **'
         DC    CL36'CPU PCT  SIO/SEC  PAG/SEC  WORKSET'
HDRIA    DC    CL26' '
HDRO     DC    X'00540100'
         DC    CL18'** OUT QUEUE **'
         DC    CL36'CPU PCT  SIO/SEC  PAG/SEC  WORKSET'
HDROA    DC    CL26' '
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
JOBTOT1  DS    6F
JOBTOT2  DS    6F
XSASAVE  DS    F
ASID     DS    F
TIMEDIFF DS    F
ASVTEND  DS    F                   JCC
SCANRET  DS    C
SCANTYPE DS    C
TSOSW    DS    C
DOMAIN   DS    C
         DS    0F
WTOLIST  DS    F
JOBMSG   DS    0CL80
JOBNAME  DS    CL8
         DS    CL1
STEPNAME DS    CL8
         DS    CL1
PCT      DS    CL7
SIO      DS    CL9
         DS    CL2
PAG      DS    CL7
         DS    CL2
FRAME    DS    CL7
         DS    CL2
ASIDOUT  DS    CL4
         DS    CL1
DSP      DS    CL3
         DS    CL1
DMN      DS    CL3
         DS    CL1
PGN      DS    CL3
         DS    CL1
SWC      DS    CL3
         DS    CL1
FLAGS    DS    CL5
         DS    CL1
         DS    0F
DMNLIST  DS    F
DMNMSG   DS    0CL80
         DS    CL7
DMNNBR   DS    CL2
         DS    CL9
DMNPCT   DS    CL7
DMNSIO   DS    CL9
         DS    CL2
DMNPAG   DS    CL7
         DS    CL37
ESTAELST DS    0F,(ESTAEOVX)X
DMNTAB   DS    100CL24
JOBTABLE DS    0D
JOBTAB   DS    200CL48
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
XAA      DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCZB03D
         TITLE 'IEEZB03D -   ##B  DEVICE BUSY MONITOR'
         PRINT NOGEN                                               @TEC
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEEZB03D -       ##B  DEVICE BUSY MONITOR                 ***
***                                                                 ***
***       VERSION -        2.3                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.   TO MVS/SP1.3 LEVEL        ***
***                                                                 ***
***       UPDATED -        07/21/81  AXC-CBT HANDLE ESTAE           ***
***                        01/26/83  AXC-CBT CHANGE ESTAE PARM LEN  ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEEZB03D CSECT
         LR    R12,R15
         USING IEEZB03D,R12
         LR    R4,R14              SAVE RETURN ADDR
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R4,SAVRET           SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                          @TEC
         BSM   0,R9                                                @TEC
AMODE31  DC    A(CONT31+X'80000000')                               @TEC
CONT31   DS    0H                                                  @TEC
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L     * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL          * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL  * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         LR    R1,R13
         A     R1,=A(SEEKTAB-WORKSTRT)
         ST    R1,SEEKTABA
         XC    SEEKTOT(4),SEEKTOT
         L     R3,XAL              PARM LIST ADDR
         LA    R3,0(0,R3)
         MVI   NFNDSW,X'00'        SET NOTHING FOUND
         LTR   R3,R3               ANY PARM
         BZ    RETURN              NO
         MVC   PARM(3),0(R3)       SAVE PARM
         SR    R1,R1
         IC    R1,0(0,R3)          CHANNEL
         SLL   R1,28
         SRL   R1,28
         TM    0(R3),X'F0'         NUMERIC CHANNEL
         BO    *+8                 YES
         LA    R1,9(0,R1)
         STC   R1,CHANNEL          SAVE CHANNEL ID
         CLI   0(R3),C'X'          ALL DASD REQ
         BNE   *+8                 NO
         MVI   CHANNEL,C'X'
         MVC   DSPSW(1),4(R3)      SAVE LIST PARM
         CLI   DSPSW,C'J'          JOB LIST
         BE    PARM1               YES
         CLI   DSPSW,C'S'          SEEK ANALYSIS
         BNE   PARM0               NO
         CLI   PARM+2,C'X'         SINGLE DEVICE
         BNE   PARM1               YES
PARM0    MVI   DSPSW,C'D'          DEVICE LIST
PARM1    MVC   WTOLIST(4),=X'00540100'
         L     R1,XAT              WAITTIME ADDR
         L     R15,8(0,R1)         LOAD HEX TIME
         LTR   R15,R15             TIME NOT SPECIFIED
         BNZ   BYPASS              NO
         MVC   0(8,R1),=CL8'00003000'  30 SECONDS DEFAULT
         MVC   8(4,R1),=F'30'      30 SECONDS DEFAULT
BYPASS   L     R3,8(0,R1)          LOAD MONITOR TIME
         MH    R3,=H'5'            TIMES 5
         LR    R5,R3
         B     UCBTIME1
UCBTIME  STIMER  WAIT,DINTVL=INTERVL
UCBTIME1 BAL   R7,UCBLOOP
         BCT   R3,UCBTIME
         B     UCBBUSY
UCBLOOP  STM   R0,R15,SAVEREGS
         XC    UCBDMSAV(24),UCBDMSAV
         L     R9,CVTPTR           CVT ADDR                        @TEC
         L     R9,CVTUCBSC-CVTMAP(R9)  LOOKUP ROUTINE ADDRESS      @TEC
         XC    WKAREA(100),WKAREA  CLEAR WORK AREA                 @TEC
         LA    R1,WKAREA           SETUP PARAMETER LIST            @TEC
         ST    R1,PLIST                                            @TEC
         LA    R1,=X'20'           SPECIFY DASD                    @TEC
         ST    R1,PLIST+4                                          @TEC
         LA    R1,ADDR             WORD TO PUT ADDRESS OF UCB      @TEC
         ST    R1,PLIST+8                                          @TEC
         OI    PLIST+8,X'80'       31 BIT PARM END SET             @TEC
CHKUCB1A BAL   R10,UCBDML#0        GET NEXT UCB ADDR
         LTR   R1,R1               END OF UCBS
         BZ    CHKUCB5             YES, EXIT
         CLI   CHANNEL,C'X'        ALL DASD REQ
         BE    CHKUCB1X            YES, ALL MATCH
         CLC   13(3,R1),PARM       UNIT MATCH
         BE    CHKUCB1B            YES
         CLI   PARM+2,C'X'         CONTROL UNIT REQ
         BNE   CHKUCB1A            NO, NEXT UCB
         CLC   13(2,R1),PARM       UNIT MATCH
         BNE   CHKUCB1A            NO
         B     CHKUCB1B
CHKUCB1X CLI   18(R1),X'20'        DASD
         BNE   CHKUCB1A            NO, NEXT
CHKUCB1B MVI   NFNDSW,X'FF'
         TM    3(R1),X'88'         ONLINE/ALLOCATED
         BNO   CHKUCB1C            NO
         LA    R6,UCBTAB-22
         LR    R14,R1              UCB ADDR
         S     R14,=F'4'           DECR ADDR -4
         L     R14,0(0,R14)        IOQ ADDR
         LA    R14,0(0,R14)
         LTR   R14,R14             ANY IOQ
         BZ    CHKUCB1D            NO
         L     R14,8(0,R14)        IOSB ADDR
         LA    R14,0(0,R14)
         LTR   R14,R14             EXIST
         BZ    CHKUCB1D            NO
         CLI   DSPSW,C'S'          SEEK ANALYSIS
         BNE   CHKUCB1C            NO
         SR    R15,R15
         ICM   R15,3,103(R14)      SEEK ADDR
         SLL   R15,2
         A     R15,SEEKTABA
         L     R0,0(0,R15)
         A     R0,=F'1'
         ST    R0,0(0,R15)
         L     R0,SEEKTOT
         A     R0,=F'1'
         ST    R0,SEEKTOT
CHKUCB1C SR    R15,R15
         ICM   R15,3,6(R14)        ASID
         LA    R14,=CL8'*MASTER*'
         CH    R15,=H'1'           MASTER
         BE    CHKUCB2
         SLL   R15,2               X 4
         L     R14,16              CVT
         L     R14,556(0,R14)      ASVT
         L     R15,524(R15,R14)    ASCB
         L     R14,56(0,R15)       CSCB                            @TEC
         LA    R14,8(0,R14)        JOBNAME                         @TEC
         CLI   0(R14),C'A'         LEGIT?                          @TEC
         BNL   CHKUCB2             YES.                            @TEC
         LA    R14,=CL8'*UNKNWN*'                                  @TEC
         B     CHKUCB2                                             @TEC
CHKUCB1D SR    R14,R14
CHKUCB2  LA    R6,22(0,R6)         NEXT UCB ENTRY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    CHKUCB3             YES
         CLI   0(R6),X'FF'         EMPTY SLOT
         BE    CHKUCB3             YES
         CLC   0(3,R6),13(R1)      UCB ADDR MATCH
         BNE   CHKUCB2             NO
         LTR   R14,R14             DEVICE NOT BUSY
         BZ    CHKUCB1A            YES
         CLI   DSPSW,C'D'          DEVICE ONLY
         BE    CHKUCB4             YES
         CLC   10(8,R6),0(R14)     JOBNAME MATCH
         BNE   CHKUCB2             NO
         B     CHKUCB4
CHKUCB3  XC    18(4,R6),18(R6)
         MVC   0(3,R6),13(R1)      UNIT ADDR
         MVC   4(6,R6),=CL6' '
         MVC   10(8,R6),0(R14)     JOBNAME
         TM    18(R1),X'A0'        DASD OR TAPE
         BZ    CHKUCB3A            NO
         MVC   4(6,R6),28(R1)      VOLSER
CHKUCB3A LTR   R14,R14             DEVICE NOT BUSY
         BZ    CHKUCB1A            YES
CHKUCB4  LH    R14,18(0,R6)        BUSY COUNT
         LA    R14,1(0,R14)
         STH   R14,18(0,R6)
         CLC   4(1,R1),CHANNEL     CHANNEL MATCH
         BNE   CHKUCB1A            NO
         LH    R14,20(0,R6)        BUSY COUNT
         LA    R14,1(0,R14)
         STH   R14,20(0,R6)
         B     CHKUCB1A
CHKUCB5  LA    R6,UCBTAB-22
CHKUCB5A LA    R6,22(0,R6)         NEXT UCB ENTRY
         CLI   0(R6),X'00'         EMPTY SLOT
         BNE   CHKUCB5A            NO
         MVI   0(R6),X'FF'         SET END OF TABLE
CHKUCB5B LM    R0,R15,SAVEREGS
         BR    R7
UCBDML#0 ST    R8,UCBDMSAV         SAVE WORK REG 1
         ST    R10,UCBDMSAV+8      SAVE WORK REG 3
         ST    R11,UCBDMSAV+12     SAVE WORK REG 4
UCBLOOP1 L     R9,CVTPTR           CVT ADDR                        @TEC
         L     R9,CVTUCBSC-CVTMAP(R9)  LOOKUP ROUTINE ADDRESS      @TEC
         LA    R1,PLIST            POINT AT PARM LIST              @TEC
         LR    R15,R9              GET MODULE ADDRESS              @TEC
         BALR  R14,R15             CALL MVS                        @TEC
         LTR   R15,R15             UCB FOUND?                      @TEC
         BZ    UCBFND              YES.                            @TEC
         SR    R1,R1               SAY THAT'S ALL.                 @TEC
         B     UCBDMCON            AND GO HOME.                    @TEC
UCBFND   DS    0H
         L     R1,ADDR             GET ADDR OF UCB                 @TEC
         L     R8,UCBDMLOW         SET SEARCH ARGUMENT
UCBDML#1 LA    R8,1(0,R8)          NEXT UNIT ADDR POSSIBLE
         L     R10,=X'0000FFFF'    SET MAX NEXT LEAST HIGH
UCBDML#2 LTR   R1,R1               MORE UCBS?                      @TEC
         BZ    UCBDMOUT            YES, GO PROCESS
UCBDML#4 CLI   18(R1),X'10'        GRAPHICS
         BE    UCBLOOP1            YES, NEXT UCB                   @TEC
         CLI   18(R1),X'40'        COMM
         BE    UCBLOOP1            YES, NEXT UCB                   @TEC
         TM    6(R1),X'08'         SSCH ISSUED?                    @TEC
         BZ    UCBLOOP1            NO, NEXT UCB                    @TEC
         BAL   R11,UCBDMCNV        CONVERT UNIT ADDR TO HEX
         CR    R0,R8               UNIT EQUAL                      @TEC
         BL    UCBLOOP1            LOW NOT EQUAL, NEXT UCB         @TEC
         LR    R10,R0              SET NEXT LEAST HIGH UNIT AD     @TEC
         ST    R1,UCBDMCUR         SET NEXT LEAST HIGH UCB ADD     @TEC
         B     UCBDMOUT            GO PROCESS
UCBDMCNV SR    R14,R14
         SR    R15,R15
         IC    R15,13(0,R1)        UNIT ADDR DIGIT
         TM    13(R1),X'F0'        NUMERIC
         BO    *+8                 YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        SET VALUE TO COVER A-F
         SLL   R15,28              SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               INSERT INTO RESULTS REGISTER
         IC    R15,14(0,R1)        UNIT ADDR DIGIT
         TM    14(R1),X'F0'        NUMERIC
         BO    *+8                 YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        SET VALUE TO COVER A-F
         SLL   R15,28              SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               INSERT INTO RESULTS REGISTER
         IC    R15,15(0,R1)        UNIT ADDR DIGIT
         TM    15(R1),X'F0'        NUMERIC
         BO    *+8                 YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        SET VALUE TO COVER A-F
         SLL   R15,28              SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               INSERT INTO RESULTS REGISTER
         LR    R0,R14              SET RESULTS REG                 @TEC
         BR    R11
UCBDMOUT C     R10,=X'0000FFFF'    ALL DONE
         BE    UCBDMEX             YES
         ST    R10,UCBDMLOW        NEXT LOW UNIT ADDR
         L     R1,UCBDMCUR         LOAD UCB ADDR FOR FOUND UNIT
         B     UCBDMCON            CONTINUE
UCBDMEX  SR    R1,R1               CLEAR UCB ADDR REGISTER
         L     R8,UCBDMSAV         RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     RELOAD WORK REG 4
         B     UCBDMRET            END OF UCBS
UCBDMCON L     R8,UCBDMSAV         RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     RELOAD WORK REG 4
UCBDMRET EQU   *
         BR    R10
UCBBUSY  LA    R6,UCBTAB-22
         MVC   CURRUNIT(3),=X'FFFFFF'
         XC    CURRCNT(4),CURRCNT
UCBBUSY1 LA    R6,22(0,R6)
         MVC   WTOLIST+4(80),DEVOVLY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    UCBBUSY1            YES
         CLI   0(R6),X'FF'         END OF UCB TABLE
         BE    UCBBUSY3            YES
         CLC   CURRUNIT(2),0(R6)   CURRENT UNIT CHECK
         BL    UCBBUSY1            CURRENT LOW, CONTINUE
         BH    UCBBUSY2            CURRENT HIGH, REPLACE
         SR    R14,R14
         IC    R14,CURRUNIT+2
         SR    R15,R15
         IC    R15,2(0,R6)
         SLL   R14,28
         SRL   R14,28
         SLL   R15,28
         SRL   R15,28
         TM    CURRUNIT+2,X'F0'    NUMERIC
         BO    *+8                 NO
         LA    R14,9(0,R14)
         TM    2(R6),X'F0'         NUMERIC
         BO    *+8                 NO
         LA    R15,9(0,R15)
         CR    R14,R15             CURRENT UNIT CHECK
         BL    UCBBUSY1            CURRENT LOW, CONTINUE
         BH    UCBBUSY2            CURRENT HIGH, REPLACE
         LH    R1,CURRCNT
         AH    R1,18(0,R6)
         STH   R1,CURRCNT
         LH    R1,CURRCNT+2
         AH    R1,20(0,R6)
         STH   R1,CURRCNT+2
         B     UCBBUSY1
UCBBUSY2 MVC   CURRUNIT(3),0(R6)
         MVC   CURRVOL(6),4(R6)
         MVC   CURRCNT(4),18(R6)
         B     UCBBUSY1
UCBBUSY3 CLC   CURRUNIT(3),=X'FFFFFF'  END OF LIST
         BE    RETURN
         MVC   DEVSTRT(3),CURRUNIT  UNIT ADDR
         MVI   DEVSTRT+3,C' '
         MVC   DEVSTRT+4(6),CURRVOL  VOLSER
         SR    R14,R14
         LH    R15,CURRCNT         UCB BUSY COUNT
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         LR    R1,R15
         MVC   BUSY(4),=X'40202120'
         ED    BUSY(4),DOUBLE+6
         SR    R14,R14
         LH    R15,CURRCNT+2       UCB BUSY COUNT THIS CHANNEL
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY+4(4),=X'40202120'
         ED    BUSY+4(4),DOUBLE+6
         MVI   BUSY+4,C'%'
         LR    R15,R1
         SRL   R15,1
         CH    R15,=H'50'
         BNH   *+8
         LH    R15,=H'50'
         EX    R15,PCTMVE
         LA    R15,PCTGRAPH(R15)
         MVI   0(R15),C'>'
         LA    R1,WTOLIST
         BAL   R11,MSGRTN
         CLI   DSPSW,C'S'          SEEK ANALYSIS
         BE    UCBSEEK             YES
         LA    R6,UCBTAB-22
UCBBUSY4 LA    R6,22(0,R6)
         MVC   WTOLIST+4(80),DEVOVLY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    UCBBUSY4            YES
         CLI   0(R6),X'FF'         END OF UCB TABLE
         BE    UCBBUSY             YES
         CLC   CURRUNIT(3),0(R6)   CURRENT UNIT CHECK
         BNE   UCBBUSY4            NO MATCH
         CLI   DSPSW,C'J'          JOB DISPLAY
         BNE   UCBBUSY5            NO
         MVC   DEVSTRT+3(8),10(R6)  JOBNAME
         MVC   DEVSTRT(3),=C'-- '
         MVC   DEVSTRT+11(4),=CL4' '
         SR    R14,R14
         LH    R15,18(0,R6)        UCB BUSY COUNT
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY(4),=X'40202120'
         ED    BUSY(4),DOUBLE+6
         SR    R14,R14
         LH    R15,20(0,R6)        UCB BUSY COUNT THIS CHANNEL
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY+4(4),=X'40202120'
         ED    BUSY+4(4),DOUBLE+6
         MVI   BUSY+4,C'%'
         LA    R1,WTOLIST
         BAL   R11,MSGRTN
         MVI   0(R6),X'00'         CLEAR ENTRY
         B     UCBBUSY4
UCBBUSY5 MVI   0(R6),X'00'         CLEAR ENTRY
         B     UCBBUSY
PCTMVE   MVC   PCTGRAPH(0),PCTLINE
UCBSEEK  MVC   WTOLIST+4(80),SEEKHDR
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         L     R4,SEEKTABA         SEEK TABLE ADDR
         SR    R5,R5
         LA    R6,300                                              @TEC
UCBSEEK0 LA    R7,10               CYL PER LINE
         LA    R8,WTOLIST+16
         SR    R9,R9               TOTAL
         CVD   R5,DOUBLE           CYL ADDR
         MVI   WTOLIST+4,C' '
         MVC   WTOLIST+5(79),WTOLIST+4
         UNPK  WTOLIST+4(3),DOUBLE+6(2)
         OI    WTOLIST+6,X'F0'
UCBSEEK1 SR    R14,R14
         L     R15,0(0,R4)         CYLINDER ACCESS COUNT
         A     R9,0(0,R4)          TOTAL CYLINDER ACCESS COUNT
         LTR   R15,R15             ANY ACCESS
         BNZ   UCBSEEK4            YES
UCBSEEK2 LA    R5,1(0,R5)          ADD TO CYL COUNT
         LA    R4,4(0,R4)          NEXT CYL
         LA    R8,7(0,R8)          NEXT PRINT ADDR
         BCT   R7,UCBSEEK1
         LTR   R15,R9              TOTAL FOR CYL RANGE
         BZ    UCBSEEK3
         M     R14,=F'100'
         D     R14,SEEKTOT
         CVD   R15,DOUBLE
         MVC   WTOLIST+9(5),=X'402021206C'
         ED    WTOLIST+9(4),DOUBLE+6
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
UCBSEEK3 BCT   R6,UCBSEEK0
         B     RETURN
UCBSEEK4 M     R14,=F'100'
         D     R14,SEEKTOT
         CVD   R15,DOUBLE
         MVC   0(5,R8),=X'402021206C'
         ED    0(4,R8),DOUBLE+6
         B     UCBSEEK2
MSGRTN   SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
TSTTSSVC SVC   35                  ISSUE WTO
         BR    R11
RETURN   CLI   NFNDSW,X'00'        ANY OUTPUT
         BNE   RETURN1             YES
         LA    R1,NFNDMSG
         BAL   R11,MSGRTN
RETURN1  EQU   *
         LA    R8,AMODE24                                          @TEC
         BSM   0,R8                                                @TEC
AMODE24  DS    0H                                                  @TEC
         ESTAE 0
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R5,SAVRET           RETURN ADDR
         FREEMAIN  R,LV=(0),A=(1)
         SR    R15,R15
         LR    R14,R5
         BR    R14
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC  SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX  MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2)  MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19  SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                 GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8)  GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,  GLA-BFG          X
               RECORD=YES,RECPARM=(3),REGS=(14,12)  GLA-BFG
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         USING *,R15
STAERTRY L     R12,=A(IEEZB03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         LA    R11,RETURN          LOAD RET ADDR
         B     MSGRTN
         LTORG
         DS    0D
INTERVL  DC    CL8'00000020'
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
DEVOVLY  DC    CL80'UUU VVVVVV BUSY NNN/NNN%'
SEEKHDR  DC    CL80'CYL    ALL    --0    --1    --2    --3    --4    --X
               5    --6    --7    --8    --9'
PCTLINE  DC    CL51'0====1====2====3====4====5====6====7====8====9===='
         DS    0F
NFNDMSG  DC    X'00300100'
         DC    CL44'UNIT SPECIFIED NOT FOUND OR 00% BUSY'
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
XSASAVE  DS    F
SEEKTABA DS    F
SEEKTOT  DS    F
DSPSW    DS    C
NFNDSW   DS    C
CHANNEL  DS    C
CURRUNIT DS    CL3
CURRVOL  DS    CL6
CURRCNT  DS    F
PARM     DS    F
ESTAELST DS    0F,(ESTAEOVX)X      AXC-CBT
PLIST    DS    3F                                                  @TEC
ADDR     DS    F                                                   @TEC
WKAREA   DS    0D,XL100                                            @TEC
UCBDMSAV DS    4F
UCBDMLOW DS    F
UCBDMCUR DS    F
         DS    0F
WTOLIST  DS    F
DEVSTRT  DS    CL8
         DS    CL2
         DS    CL5
BUSY     DS    CL8
         DS    CL2
PCTGRAPH DS    CL51
         DS    CL4
         DS    0F
UCBTAB   DS    2000CL22
SEEKTAB  DS    3000F                                               @TEC
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
         CVT   DSECT=YES                                           @TEC
CHAN1    EQU   256
CHAN2    EQU   512
CHAN3    EQU   768
CHAN4    EQU   1024
CHAN5    EQU   1280
CHAN6    EQU   1536
CHAN7    EQU   1792
CHAN8    EQU   2048
CHAN9    EQU   2304
CHAN10   EQU   2560
CHAN11   EQU   2816
CHAN12   EQU   3072
CHAN13   EQU   3328
CHAN14   EQU   3584
CHAN15   EQU   3840
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCZC03D
         TITLE 'IEEZC03D -   ##C  CHANNEL BUSY MONITOR'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEEZC03D -       ##C  CHANNEL BUSY MONITOR                ***
***                                                                 ***
***       VERSION -        2.2                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SE  3.8.  TO MVS/SP1.3               ***
***                                                                 ***
***       UPDATED -        11/01/79                                 ***
***                        01/26/83  AXC-CBT CHANGE ESTAE PARM LEN  ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEEZC03D CSECT
         LR    R12,R15
         USING IEEZC03D,R12
         LR    R4,R14              SAVE RETURN ADDR
         MODESET KEY=ZERO,MODE=SUP
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R4,SAVRET           SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         XC    CHNTAB(64),CHNTAB
         MVI   CHANNEL,X'00'
         L     R3,XAL              PARM LIST ADDR
         LA    R3,0(0,R3)
         LTR   R3,R3               ANY PARM
         BZ    PARM1               NO
         MVC   DSPSW(1),3(R3)      SAVE PARM
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),0(R3)
         CLC   DOUBLE(2),=C'00'    DOMAIN DISPLAY
         BNE   PARM1
         PACK  DOUBLE(8),0(2,R3)
         CVB   R1,DOUBLE
         STC   R1,CHANNEL          SAVE CHANNEL
         CLI   DSPSW,C'D'          DEVICE BUSY
         BE    PARM2               YES, CONTINUE
         CLI   DSPSW,C'J'          DEVICE BUSY BY JOB
         BE    PARM2               YES, CONTINUE
         SPACE 1
PARM1    MVI   DSPSW,C' '
         SPACE 1
PARM2    MVC   WTOLIST(4),=X'00540100'
         L     R1,XAT              WAITTIME ADDR
         L     R15,8(0,R1)         LOAD HEX TIME
         LTR   R15,R15             TIME NOT SPECIFIED
         BNZ   BYPASS              NO
         MVC   0(8,R1),=CL8'00003000'  30 SECONDS DEFAULT
         MVC   8(4,R1),=F'30'          30 SECONDS DEFAULT
         SPACE 1
BYPASS   L     R3,8(0,R1)          LOAD MONITOR TIME
         MH    R3,=H'5'            TIMES 5
         LR    R5,R3
         B     CHNLOOP1
CHNLOOP  STIMER WAIT,DINTVL=INTERVL
         SPACE 1
CHNLOOP1 SR    R4,R4
         LA    R10,CHNTAB
         TCH   CHAN1               TEST CHANNEL 01 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN2               TEST CHANNEL 02 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN3               TEST CHANNEL 03 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN4               TEST CHANNEL 04 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN5               TEST CHANNEL 05 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN6               TEST CHANNEL 06 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN7               TEST CHANNEL 07 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN8               TEST CHANNEL 08 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN9               TEST CHANNEL 09 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN10              TEST CHANNEL 10 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN11              TEST CHANNEL 11 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN12              TEST CHANNEL 12 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN13              TEST CHANNEL 13 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN14              TEST CHANNEL 14 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         LA    R10,4(0,R10)        NEXT COUNT
         TCH   CHAN15              TEST CHANNEL 15 BUSY
         L     R1,0(0,R10)         LOAD CURRENT BUSY COUNT
         BC    1,CHNEND            END OF CHANNELS
         BC    13,*+8              NOT BUSY
         LA    R1,1(0,R1)          ADD 1 TO BUSY COUNT
         ST    R1,0(0,R10)         SAVE BUSY COUNT
         SPACE 1
CHNEND   CLI   DSPSW,C' '          DEVICE DISPLAY
         BE    CHNEND1             NO
         BAL   R7,UCBLOOP
         SPACE 1
CHNEND1  BCT   R3,CHNLOOP
         B     BUSYCHK
UCBLOOP  STM   R0,R15,SAVEREGS
         XC    UCBDMSAV(24),UCBDMSAV
         L     R9,16               .CVT
         L     R9,40(0,R9)         .UCB LOOKUP TABLE
         SPACE 1
CHKUCB1A BAL   R10,UCBDML#0        GET NEXT UCB ADDR
         LTR   R1,R1               END OF UCBS
         BZ    CHKUCB5             YES, EXIT
         TM    18(R1),X'A0'        DASD OR TAPE
         BZ    CHKUCB1A            NO
         TM    3(R1),X'88'         ONLINE/ALLOCATED
         BNO   CHKUCB1A            NO
         MVI   CHANTEST,X'00'
         SR    R0,R0
         IC    R0,13(0,R1)
         SLL   R0,28
         SRL   R0,28
         TM    13(R1),X'F0'        CHAN 0 - 9
         BO    *+8                 YES
         A     R0,=F'9'
         STC   R0,CHANTEST         SAVE PRIMARY CHANNEL
         CLC   CHANTEST(1),CHANNEL CHANNEL MATCH
         BE    *+14                YES
         CLC   4(1,R1),CHANNEL     CHANNEL MATCH
         BNE   CHKUCB1A            NO
         LA    R6,UCBTAB-22
         LR    R14,R1             UCB ADDR
         S     R14,=F'4'          DECR ADDR -4
         L     R14,0(0,R14)       IOQ ADDR
         LA    R14,0(0,R14)
         LTR   R14,R14            ANY IOQ
         BZ    CHKUCB1A           NO
         L     R14,8(0,R14)       IOSB ADDR
         LA    R14,0(0,R14)
         LTR   R14,R14            EXIST
         BZ    CHKUCB1A           NO
         SR    R15,R15
         ICM   R15,3,6(R14)       ASID
         LA    R14,=CL8'*MASTER*'
         CH    R15,=H'1'          MASTER
         BE    CHKUCB2
         SLL   R15,2              X 4
         L     R14,16             CVT
         L     R14,556(0,R14)     ASVT
         L     R15,524(R15,R14)   ASCB
         L     R14,172(0,R15)      JOBNAME POINTER
         LTR   R14,R14             ZERO
         BNZ   CHKUCB2             NO
         L     R14,176(0,R15)      STC/TSU NAME POINTER
         LTR   R14,R14             ZERO
         BNZ   CHKUCB2             NO
         LA    R14,=CL8'*UNKNWN*'
CHKUCB2  LA    R6,22(0,R6)         NEXT UCB ENTRY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    CHKUCB3             YES
         CLI   0(R6),X'FF'         EMPTY SLOT
         BE    CHKUCB3             YES
         CLC   0(3,R6),13(R1)      UCB ADDR MATCH
         BNE   CHKUCB2             NO
         CLI   DSPSW,C'D'          DEVICE ONLY
         BE    CHKUCB4             YES
         CLC   10(8,R6),0(R14)     JOBNAME MATCH
         BNE   CHKUCB2             NO
         B     CHKUCB4
         SPACE 1
CHKUCB3  XC    18(4,R6),18(R6)
         MVC   0(3,R6),13(R1)      UNIT ADDR
         MVC   4(6,R6),28(R1)      VOLSER
         MVC   10(8,R6),0(R14)     JOBNAME
         SPACE 1
CHKUCB4  LH    R14,18(0,R6)        BUSY COUNT
         LA    R14,1(0,R14)
         STH   R14,18(0,R6)
         CLC   4(1,R1),CHANNEL     CHANNEL MATCH
         BNE   CHKUCB1A            NO
         LH    R14,20(0,R6)        BUSY COUNT
         LA    R14,1(0,R14)
         STH   R14,20(0,R6)
         B     CHKUCB1A
         SPACE 1
CHKUCB5  LA    R6,UCBTAB-22
         SPACE 1
CHKUCB5A LA    R6,22(0,R6)         NEXT UCB ENTRY
         CLI   0(R6),X'00'         EMPTY SLOT
         BNE   CHKUCB5A            NO
         MVI   0(R6),X'FF'         SET END OF TABLE
         SPACE 1
CHKUCB5B LM    R0,R15,SAVEREGS
         BR    R7
UCBDML#0 ST    R8,UCBDMSAV         .SAVE WORK REG 1
         ST    R10,UCBDMSAV+8      .SAVE WORK REG 3
         ST    R11,UCBDMSAV+12     .SAVE WORK REG 4
         L     R8,UCBDMLOW         .SET SEARCH ARGUMENT
         SPACE 1
UCBDML#1 LA    R8,1(0,R8)          .NEXT UNIT ADDR POSSIBLE
         L     R10,=X'0000FFFF'    .SET MAX NEXT LEAST HIGH
         SPACE 1
UCBDML#2 CLC   0(2,R9),=X'FFFF'    .END OF TABLE
         BE    UCBDMOUT            .YES, GO PROCESS
         SR    R1,R1
         ICM   R1,3,0(R9)          .LOAD UCB ADDR
         LTR   R1,R1               .ZERO ADDR
         BNZ   UCBDML#4            .NO, CONTINUE
         SPACE 1
UCBDML#3 LA    R9,2(0,R9)          .NEXT UCB LOOKUP TABLE ENTRY
         B     UCBDML#2
         SPACE 1
UCBDML#4 CLI   18(R1),X'10'        GRAPHICS
         BE    UCBDML#3            YES, NEXT UCB
         CLI   18(R1),X'40'        COMM
         BE    UCBDML#3            YES, NEXT UCB
         TM    6(R1),X'8A'         BUSY AND/OR CHANNEL PROGRAM ACTIVE
         BZ    UCBDML#3            NO, NEXT UCB
         BAL   R11,UCBDMCNV        .CONVERT UNIT ADDR TO HEX
         CR    R1,R8               .UNIT EQUAL
         BL    UCBDML#3            .LOW NOT EQUAL, NEXT UCB
         LR    R10,R1              .SET NEXT LEAST HIGH UNIT ADDR
         MVC   UCBDMCUR+2(2),0(R9) .SET NEXT LEAST HIGH UCB ADDR
         B     UCBDMOUT            .GO PROCESS
UCBDMCNV SR    R14,R14
         SR    R15,R15
         IC    R15,13(0,R1)        .UNIT ADDR DIGIT
         TM    13(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,14(0,R1)        .UNIT ADDR DIGIT
         TM    14(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         IC    R15,15(0,R1)        .UNIT ADDR DIGIT
         TM    15(R1),X'F0'        .NUMERIC
         BO    *+8                 .YES, BYPASS VALUE ADJUST
         LA    R15,9(0,R15)        .SET VALUE TO COVER A-F
         SLL   R15,28              .SHIFT OUT ALL BUT PERTINENT
         SLDL  R14,4               .INSERT INTO RESULTS REGISTER
         LR    R1,R14              .SET RESULTS REG
         BR    R11
         SPACE 3
UCBDMOUT C     R10,=X'0000FFFF'    .ALL DONE
         BE    UCBDMEX             .YES
         ST    R10,UCBDMLOW        .NEXT LOW UNIT ADDR
         L     R1,UCBDMCUR         .LOAD UCB ADDR FOR FOUND UNIT
         B     UCBDMCON            .CONTINUE
         SPACE 1
UCBDMEX  SR    R1,R1               .CLEAR UCB ADDR REGISTER
         L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         B     UCBDMRET            .END OF UCBS
         SPACE 1
UCBDMCON L     R8,UCBDMSAV         .RELOAD WORK REG 1
         L     R10,UCBDMSAV+8      .RELOAD WORK REG 3
         L     R11,UCBDMSAV+12     .RELOAD WORK REG 4
         SPACE 1
UCBDMRET EQU   *
         BR    R10
         BR    R7
BUSYCHK  LA    R4,CHNTAB-4         CHANNEL TABLE ADDR
         LA    R3,15
         SR    R6,R6
         SPACE 1
BUSYCHK1 LA    R4,4(0,R4)          CHAN TABLE SLOT
         L     R15,0(0,R4)         CHAN BUSY
         LA    R6,1(0,R6)          CHAN NUMBER
         CLI   CHANNEL,X'00'       SINGLE CHANNEL REQUEST
         BE    *+12                NO
         CLM   R6,1,CHANNEL        CHANNEL MATCH
         BNE   BUSYCHK2
         SR    R14,R14
         CVD   R6,DOUBLE
         MVC   WTOLIST+4(80),OVERLAY
         UNPK  CHAN(2),DOUBLE+6(2)
         OI    CHAN+1,X'F0'
         M     R14,=F'100'
         SR    R14,R14
         DR    R14,R5
         LR    R7,R15
         SRDL  R14,32
         LR    R1,R5
         SRL   R1,1
         DR    R14,R1
         AR    R15,R7
         CVD   R15,DOUBLE
         MVC   BUSY+4(4),=X'40202120'
         ED    BUSY+4(4),DOUBLE+6
         SRL   R15,1
         CH    R15,=H'50'
         BNH   *+8
         LH    R15,=H'50'
         EX    R15,PCTMVE
         LA    R15,PCTGRAPH(R15)
         MVI   0(R15),C'>'
         LA    R1,WTOLIST
         BAL   R11,MSGRTN
         SPACE 1
BUSYCHK2 BCT   R3,BUSYCHK1
         B     UCBBUSY
         SPACE 3
PCTMVE   MVC   PCTGRAPH(0),PCTLINE
UCBBUSY  CLI   DSPSW,C' '          DEVICE DISPLAY
         BE    RETURN              NO
         LA    R6,UCBTAB-22
         MVC   CURRUNIT(3),=X'FFFFFF'
         XC    CURRCNT(4),CURRCNT
         SPACE 1
UCBBUSY1 LA    R6,22(0,R6)
         MVC   WTOLIST+4(80),DEVOVLY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    UCBBUSY1            YES
         CLI   0(R6),X'FF'         END OF UCB TABLE
         BE    UCBBUSY3            YES
         CLC   CURRUNIT(2),0(R6)   CURRENT UNIT CHECK
         BL    UCBBUSY1            CURRENT LOW, CONTINUE
         BH    UCBBUSY2            CURRENT HIGH, REPLACE
         SR    R14,R14
         IC    R14,CURRUNIT+2
         SR    R15,R15
         IC    R15,2(0,R6)
         SLL   R14,28
         SRL   R14,28
         SLL   R15,28
         SRL   R15,28
         TM    CURRUNIT+2,X'F0'    NUMERIC
         BO    *+8                 NO
         LA    R14,9(0,R14)
         TM    2(R6),X'F0'         NUMERIC
         BO    *+8                 NO
         LA    R15,9(0,R15)
         CR    R14,R15             CURRENT UNIT CHECK
         BL    UCBBUSY1            CURRENT LOW, CONTINUE
         BH    UCBBUSY2            CURRENT HIGH, REPLACE
         LH    R1,CURRCNT
         AH    R1,18(0,R6)
         STH   R1,CURRCNT
         LH    R1,CURRCNT+2
         AH    R1,20(0,R6)
         STH   R1,CURRCNT+2
         B     UCBBUSY1
         SPACE 1
UCBBUSY2 MVC   CURRUNIT(3),0(R6)
         MVC   CURRVOL(6),4(R6)
         MVC   CURRCNT(4),18(R6)
         B     UCBBUSY1
         SPACE 1
UCBBUSY3 CLC   CURRUNIT(3),=X'FFFFFF'   END OF LIST
         BE    RETURN
         MVC   DEVSTRT(3),CURRUNIT UNIT ADDR
         MVI   DEVSTRT+3,C' '
         MVC   DEVSTRT+4(6),CURRVOL VOLSER
         SR    R14,R14
         LH    R15,CURRCNT         UCB BUSY COUNT
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         LR    R1,R15
         MVC   BUSY(4),=X'40202120'
         ED    BUSY(4),DOUBLE+6
         SR    R14,R14
         LH    R15,CURRCNT+2       UCB BUSY COUNT THIS CHANNEL
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY+4(4),=X'40202120'
         ED    BUSY+4(4),DOUBLE+6
         MVI   BUSY+4,C'%'
         LR    R15,R1
         SRL   R15,1
         CH    R15,=H'50'
         BNH   *+8
         LH    R15,=H'50'
         EX    R15,PCTMVE
         LA    R15,PCTGRAPH(R15)
         MVI   0(R15),C'>'
         LA    R1,WTOLIST
         BAL   R11,MSGRTN
         LA    R6,UCBTAB-22
         SPACE 1
UCBBUSY4 LA    R6,22(0,R6)
         MVC   WTOLIST+4(80),DEVOVLY
         CLI   0(R6),X'00'         EMPTY SLOT
         BE    UCBBUSY4            YES
         CLI   0(R6),X'FF'         END OF UCB TABLE
         BE    UCBBUSY             YES
         CLC   CURRUNIT(3),0(R6)   CURRENT UNIT CHECK
         BNE   UCBBUSY4            NO MATCH
         CLI   DSPSW,C'J'          JOB DISPLAY
         BNE   UCBBUSY5            NO
         MVC   DEVSTRT+3(8),10(R6)   JOBNAME
         MVC   DEVSTRT(3),=C'-- '
         MVC   DEVSTRT+11(4),=CL4' '
         SR    R14,R14
         LH    R15,18(0,R6)        UCB BUSY COUNT
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY(4),=X'40202120'
         ED    BUSY(4),DOUBLE+6
         SR    R14,R14
         LH    R15,20(0,R6)        UCB BUSY COUNT THIS CHANNEL
         M     R14,=F'100'
         DR    R14,R5              PERCENT BUSY
         CVD   R15,DOUBLE
         MVC   BUSY+4(4),=X'40202120'
         ED    BUSY+4(4),DOUBLE+6
         MVI   BUSY+4,C'%'
         LA    R1,WTOLIST
         BAL   R11,MSGRTN
         MVI   0(R6),X'00'         CLEAR ENTRY
         B     UCBBUSY4
         SPACE 1
UCBBUSY5 MVI   0(R6),X'00'         CLEAR ENTRY
         B     UCBBUSY
MSGRTN   SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
TSTTSSVC SVC   35                  ISSUE WTO
         BR    R11
         SPACE 3
RETURN   ESTAE 0
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R4,SAVRET           RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         CLC   TSTTSSVC(2),=X'0A23'  TSO EXECUTION
         BE    EXIT                  NO
         MODESET KEY=NZERO,MODE=PROB
         SPACE 1
EXIT     SR    R15,R15
         LR    R14,R4
         BR    R14
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEEZC03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         LA    R11,RETURN          LOAD RET ADDR
         B     MSGRTN
         LTORG
         DS    0D
INTERVL  DC    CL8'00000020'
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
OVERLAY  DC    CL80'CHANNEL XX BUSY     NNN%'
DEVOVLY  DC    CL80'UUU VVVVVV BUSY NNN/NNN%'
         SPACE 3
PCTLINE  DC    CL51'0====1====2====3====4====5====6====7====8====9===='
         SPACE 3
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
SAVEREGS DS    18F
DOUBLE   DS    2F
XSASAVE  DS    F
DSPSW    DS    C
CHANNEL  DS    C
CHANTEST DS    C
CURRUNIT DS    CL3
CURRVOL  DS    CL6
CURRCNT  DS    F
TEMPLINE DS    CL84
ESTAELST DS    0F,(ESTAEOVX)X AXC-CBT
         SPACE 3
UCBDMSAV DS    4F
UCBDMLOW DS    F
UCBDMCUR DS    F
         SPACE 5
         DS    0F
WTOLIST  DS    F
DEVSTRT  DS    CL8
CHAN     DS    CL2
         DS    CL5
BUSY     DS    CL8
         DS    CL2
PCTGRAPH DS    CL51
         DS    CL4
         SPACE 3
         DS    0F
CHNTAB   DS    16F
UCBTAB   DS    500CL22
         SPACE 3
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
CHAN1    EQU   256
CHAN2    EQU   512
CHAN3    EQU   768
CHAN4    EQU   1024
CHAN5    EQU   1280
CHAN6    EQU   1536
CHAN7    EQU   1792
CHAN8    EQU   2048
CHAN9    EQU   2304
CHAN10   EQU   2560
CHAN11   EQU   2816
CHAN12   EQU   3072
CHAN13   EQU   3328
CHAN14   EQU   3584
CHAN15   EQU   3840
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCZJ03D
         TITLE 'IEEZJ03D -   ##J  JOB MONITOR'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEEZJ03D -       ##J  JOB MONITOR                         ***
***                                                                 ***
***       VERSION -        2.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/XA 2.1.1                             ***
***                                                                 ***
***       UPDATED -        09/01/79                                 ***
***                        08/10/81  JCC-BCB TEST FOR END OF ASCBS  ***
***                        05/15/83  JAL-SNET INCREASE JOBTABLE TO  ***
***                                      HOLD 300 ASIDS             ***
***                        02/07/84  JAL-ADD 31-BIT CODING FOR XA   ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEEZJ03D CSECT
IEEZJ03D AMODE 24
IEEZJ03D RMODE 24
         SPLEVEL SET=2
         LR    R12,R15
         USING IEEZJ03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                   -JAL/XA-
         BSM   0,R9                                         -JAL/XA-
AMODE31  DC    A(CONT31+X'80000000')                        -JAL/XA-
CONT31   DS    0H                                           -JAL/XA-
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         MVI   TSOSW,C' '
         L     R1,XAT              LOAD WAITTIME ADDR
         L     R15,8(0,R1)         LOAD HEX WAITTIME
         LTR   R15,R15             TIME NOT SPECIFIED
         BNZ   *+10                NO
         MVC   0(8,R1),=CL8'00003000'   30 SECONDS DEFAULT
         L     R3,XAL              PARM LIST ADDR
         LA    R3,0(0,R3)
         LTR   R3,R3               ANY PARM
         BZ    PARM2               NO
         MVC   TSOSW(2),0(R3)      SAVE PARM
         CLI   TSOSW,C'T'          TSO DISPLAY
         BE    PARM2               YES, CONTINUE
         CLI   TSOSW,C'J'          JOB DISPLAY
         BE    PARM1               YES, CONTINUE
         MVC   DOUBLE(2),=C'00'
         MVZ   DOUBLE(2),TSOSW
         CLC   DOUBLE(2),=C'00'    DOMAIN DISPLAY
         BNE   PARM1
         PACK  DOUBLE(8),TSOSW(2)
         CVB   R1,DOUBLE
         STC   R1,DOMAIN           SAVE DOMAIN
         MVI   TSOSW,C'D'
         B     PARM2
         SPACE 1
PARM1    MVI   TSOSW,C' '
         SPACE 1
PARM2    MVC   WTOLIST(4),=X'00400100'
         MVI   SCANRET,C' '        SET FOUND
         MVI   SCANTYPE,C'I'       SET IN QUEUE SCAN
SETINIT  L     R4,16               CVT
         L     R4,556(0,R4)        ASVT
         L     R8,516(0,R4)        MAX # ASIDS                   JCC
         CH    R8,=H'0300'         OVER 300 ASIDS                JAL
         BH    RETURN               YES, GET OUT                 JAL
         MH    R8,=H'4'            MULT BY LENGTH                JCC
         LA    R8,528(R4,R8)       FIND END OF ASID LIST         JCC
         ST    R8,ASVTEND          STORE THAT ADDR               JCC
         LA    R4,524(0,R4)        ASCB SLOT ADDR
         LA    R8,JOBTABLE         ASCB/OUCB INFO STORAGE
         SPACE 1
SETINIT1 XC    0(16,R8),0(R8)
         SPACE 1
SETINIT2 LA    R4,4(0,R4)          INCR INTO ASVT
         C     R4,ASVTEND          END OF ASVT                   JCC
         BNL   SETINIT3            YES, EXIT                     JCC
         TM    0(R4),X'80'         AVAILABLE SLOT
         BO    SETINIT2            YES
         L     R5,0(0,R4)          ASCB ADDR
         LA    R5,0(0,R5)
         L     R7,144(0,R5)        OUCB ADDR
         ST    R5,0(0,R8)          SAVE ENTRY ID
         SR    R14,R14
         SR    R15,R15
         ICM   R15,3,40(R5)        EXCP COUNT
         A     R15,108(0,R7)       OUCB EXCP COUNT
         ST    R15,4(0,R8)         SAVE TOTAL EXCPS
         LM    R14,R15,64(R5)      TCB TIME
         SRDL  R14,22
         LR    R1,R15
         LM    R14,R15,200(R5)     SRB TIME
         SRDL  R14,22
         AR    R1,R15
         ST    R1,8(0,R8)          SAVE TOTAL CPU TIME
         LA    R8,12(0,R8)         NEXT ENTRY
         B     SETINIT1
         SPACE 1
SETINIT3 L     R3,XAT              LOAD WAITTIME ADDR
         STIMER WAIT,DINTVL=(R3)
         LA    R1,HDRI             IN QUEUE HDR
         BAL   R11,MSGRTN1
JOBOUT   MVI   JOBMSG,C' '
         MVC   JOBMSG+1(59),JOBMSG
         L     R4,16               CVT ADDR
         L     R4,556(0,R4)        ASVT ADDR
         L     R5,516(0,R4)        MAX # ASIDS                   JCC
         MH    R5,=H'4'            MULT BY LENGTH                JCC
         LA    R5,528(R4,R5)       FIND END OF ASID LIST         JCC
         ST    R5,ASVTEND          STORE THAT ADDR               JCC
         LA    R4,524(0,R4)        ASCB SLOT ADDR
         B     JOBOUT4
         SPACE 1
JOBOUT1  L     R5,0(0,R4)          ASCB ADDR
         LA    R5,0(0,R5)
         L     R6,56(0,R5)         CSCB ADDR
         L     R7,144(0,R5)        LOAD OUCB ADDR
         CLI   SCANTYPE,C'I'       IN QUEUE SCAN
         BNE   JOBOUT2             NO
         CLI   41(R7),X'00'        SRC PRESENT
         BNE   JOBOUT6             YES, GO CHECK DET WAIT
         CLI   38(R5),X'7F'        LOGICAL SWAP
         BE    JOBOUT4             YES, OUT
         B     JOBOUT3             CONTINUE
         SPACE 1
JOBOUT2  CLI   38(R5),X'7F'        LOGICAL SWAP
         BE    JOBOUT3             YES, OUT QUEUE
         CLI   41(R7),X'00'        SWAP REASON
         BE    JOBOUT4             NO, IN QUEUE
         CLI   41(R7),X'06'        DETECTED WAIT
         BNE   JOBOUT3             NO
         TM    21(R7),X'01'        MSO DET WAIT BIT ON
         BZ    JOBOUT4             NO, IGNORE SRC
         SPACE 1
JOBOUT3  BAL   R11,ASCBFORM        GO FORMAT ASCB INFO
         L     R6,144(0,R5)        OUCB ADDR
         L     R3,60(0,R5)         TSB ADDR
         L     R5,56(0,R5)         CSCB ADDR
         BAL   R11,CSCBFORM        GO FORMAT CSCB INFO
         LA    R1,WTOLIST          MSG AREA
         BAL   R11,MSGRTN          GO PRINT MSG
         SPACE 1
JOBOUT4  LA    R4,4(0,R4)          INCR INTO ASVT
         C     R4,ASVTEND          END OF ASVT                   JCC
         BNL   JOBOUT5             YES, RETURN                   JCC
         TM    0(R4),X'80'         AVAILABLE ENTRY
         BO    JOBOUT4             YES, CHECK NEXT
         B     JOBOUT1             GO USE IT
         SPACE 1
JOBOUT5  CLI   SCANTYPE,C'O'       OUT QUEUE SCAN
         BE    RETURN              YES, EXIT
         MVI   SCANRET,C' '        INIT OUTPUT SWITCH
         MVI   SCANTYPE,C'O'       SET OUT QUEUE SCAN NEXT
         LA    R1,HDRO             OUT QUEUE HDR
         BAL   R11,MSGRTN1
         B     JOBOUT              NEXT PASS
         SPACE 1
JOBOUT6  CLI   41(R7),X'06'        DETECTED WAIT
         BNE   JOBOUT4             NO
         TM    21(R7),X'01'        MSO DET WAIT BIT ON
         BZ    JOBOUT3             NO, IGNORE SRC
         B     JOBOUT4
ASCBFORM UNPK  DOUBLE(5),36(3,R5)
         NC    DOUBLE(4),=4X'0F'
         TR    DOUBLE(4),=C'0123456789ABCDEF'
         MVC   ASID(4),DOUBLE      SAVE ASID
         LA    R8,JOBTABLE
         SPACE 1
ASCBFRM1 CLC   0(4,R8),=F'0'       JOBTABLE END
         BE    ASCBFRM2            YES
         C     R5,0(0,R8)          ASCB MATCH
         BE    ASCBFRM2            YES
         LA    R8,12(0,R8)         NEXT ENTRY
         B     ASCBFRM1
         SPACE 1
ASCBFRM2 MVC   CPUT(10),=XL10'402021204B40404B4040'
         LM    R14,R15,64(R5)      CPU TIME
         SRDL  R14,22
         LR    R9,R15              SAVE CPU TIME
         LM    R14,R15,200(R5)     SRB TIME
         SRDL  R14,22
         AR    R15,R9              CPU PLUS SRB TIME
         SR    R14,R14
         D     R14,=F'10'          HUNDREDTHS
         SR    R14,R14
         D     R14,=F'100'         SECONDS
         CVD   R14,DOUBLE          HUNDREDTHS TO PRINT
         UNPK  CPUT+8(2),DOUBLE+6(2)
         OI    CPUT+9,X'F0'
         SR    R14,R14
         D     R14,=F'60'          MINUTES
         CVD   R14,DOUBLE          SECONDS TO PRINT
         UNPK  CPUT+5(2),DOUBLE+6(2)
         OI    CPUT+6,X'F0'
         CVD   R15,DOUBLE          MINUTES TO PRINT
         ED    CPUT(4),DOUBLE+6
         CLI   CPUT+2,C' '         OVER 9 MINUTES
         BNE   ASCBFRM4            YES
         CLC   CPUT+3(3),=C'0.0'
         BNE   ASCBFRM3
         MVC   CPUT+3(3),=CL8' '
         SPACE 1
ASCBFRM3 CLC   CPUT+3(2),=C'0.0'
         BNE   ASCBFRM4
         MVC   CPUT+3(2),=CL8' '
         SPACE 1
ASCBFRM4 CLC   0(4,R8),=F'0'       ANY INTERVAL DATA
         BE    ASCBFRM6            NO
         MVC   CPUC(8),=XL8'40404B40404B4040'
         LM    R14,R15,64(R5)      CPU TIME
         SRDL  R14,22
         LR    R9,R15              SAVE CPU TIME
         LM    R14,R15,200(R5)     SRB TIME
         SRDL  R14,22
         AR    R15,R9              CPU PLUS SRB TIME
         C     R15,8(0,R8)         STEP CHANGE INDICATED
         BNL   *+14                NO
         MVC   CPUC+1(7),=CL7'**CHG**'
         B     ASCBFRM6
         SR    R14,R14
         S     R15,8(0,R8)         CALCULATE INTERVAL TIME
         D     R14,=F'10'          HUNDREDTHS
         SR    R14,R14
         D     R14,=F'100'         SECONDS
         CVD   R14,DOUBLE          HUNDREDTHS TO PRINT
         UNPK  CPUC+6(2),DOUBLE+6(2)
         OI    CPUC+7,X'F0'
         SR    R14,R14
         D     R14,=F'60'          MINUTES
         CVD   R14,DOUBLE          SECONDS TO PRINT
         UNPK  CPUC+3(2),DOUBLE+6(2)
         OI    CPUC+4,X'F0'
         CVD   R15,DOUBLE          MINUTES TO PRINT
         UNPK  CPUC(2),DOUBLE+6(2)
         OI    CPUC+1,X'F0'
         MVI   CPUC,X'40'
         CLC   CPUC+1(3),=C'0.0'
         BNE   ASCBFRM5
         MVC   CPUC+1(3),=CL8' '
         SPACE 1
ASCBFRM5 CLC   CPUC+1(2),=C'0.0'
         BNE   ASCBFRM6
         MVC   CPUC+1(2),=CL8' '
         SPACE 1
ASCBFRM6 SR    R14,R14
         SR    R15,R15
         ICM   R15,3,40(R5)        EXCP COUNT
         A     R15,108(0,R7)       OUCB EXCP COUNT
         LR    R1,R15              SAVE TOTAL EXCPS
         MVC   EXCPT(10),=XL10'40206B2020206B202120'
         CVD   R1,DOUBLE
         ED    EXCPT(10),DOUBLE+4
         CLC   0(4,R8),=F'0'       ANY INTERVAL DATA
         BCR   8,R11               NO
         C     R1,4(0,R8)          STEP CHANGE INDICATED
         BNL   *+12                NO
         MVC   EXCPC+1(5),=CL5'*CHG*'
         BR    R11
         S     R1,4(0,R8)          SUB PREV COUNT
         CVD   R1,DOUBLE
         MVC   EXCPC(6),=X'402020202120'
         ED    EXCPC(6),DOUBLE+5
         BR    R11
CSCBFORM CLI   TSOSW,C'T'          TSO USER DISPLAY
         BNE   CSCBFRM0            NO
         CLI   28(R5),X'01'        TSO USER
         BNE   JOBOUT4             NO, BYPASS
         B     CSCBFRM6
         SPACE 1
CSCBFRM0 CLI   28(R5),X'01'        TSO USER
         BE    JOBOUT4             YES, DONT PROCESS
         CLI   28(R5),X'03'        INIT
         BNE   CSCBFRM3            NO, GO HANDLE
         LA    R9,0(0,R5)          SAVE CSCB ADDR
         SR    R10,R10             INSERT
         IC    R10,30(0,R5)
         SLL   R10,8               ASID
         IC    R10,31(0,R5)
         SPACE 1
CSCBFRM1 L     R5,0(0,R5)          NEXT CSCB
         LA    R5,0(0,R5)          CLEAR HIGH ORDER
         LTR   R5,R5               END OF CSCBS
         BNZ   *+10                NO, CONTINUE
         LR    R5,R9               LOAD CSCB ADDR
         B     JOBOUT4             NO GOOD
         CR    R5,R9               SAME CSCB
         BE    JOBOUT4             YES, NO GOOD
         CH    R10,30(0,R5)        SAME ASID
         BNE   CSCBFRM1            NO, CHECK NEXT
         SPACE 1
CSCBFRM2 MVC   JOBNAME(8),8(R5)
         MVC   STEPNAME(8),64(R5)
         MVC   PROCNAME(8),32(R5)
         B     CSCBFRM4
         SPACE 1
CSCBFRM3 MVC   JOBNAME(8),16(R5)
         MVC   STEPNAME(8),8(R5)
         MVC   PROCNAME(8),32(R5)
         SPACE 1
CSCBFRM4 CLI   TSOSW,C'D'          DOMAIN DISPLAY
         BNE   CSCBFRM5            NO
         CLC   DOMAIN(1),40(R6)    DOMAIN MATCH
         BNE   JOBOUT4
         SPACE 1
CSCBFRM5 CLC   ASID(4),=C'0001'
         BCR   7,R11
         MVC   JOBNAME(26),=CL26'MASTER'
         BR    R11
         SPACE 1
CSCBFRM6 MVC   JOBNAME(8),8(R5)
         MVC   STEPNAME(8),16(R5)
         MVC   PROCNAME(8),=CL8' '
         CLC   TSOSVTST(2),=X'0A23'  SVC 35 REPLACED
         BNE   CSCBFRM5              YES, BYPASS 0C4
         UNPK  PROCNAME(5),82(3,R3)  LINE NUMBER
         NC    PROCNAME(4),=8X'0F'
         TR    PROCNAME(4),=C'0123456789ABCDEF'
         MVC   PROCNAME+4(4),=CL4' '
         B     CSCBFRM5
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEEZJ03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         LA    R11,RETURN          LOAD RET ADDR
MSGRTN   MVI   SCANRET,C'P'
         SPACE 1
MSGRTN1  SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
TSOSVTST SVC   35                  ISSUE WTO
         BR    R11
         SPACE 3
RETURN   CLI   SCANRET,C' '        ANY FOUND
         BE    NOTFOUND            NO, TELL OPERATOR
         ESTAE 0
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         LA    R8,AMODE24                                  -JAL/XA-
         BSM   0,R8                                        -JAL/XA-
AMODE24  DS    0H                                          -JAL/XA-
         SR    R15,R15
         BR    R14
         SPACE 3
NOTFOUND LA    R11,RETURN
         LA    R1,NFNDMSG
         B     MSGRTN
         LTORG
         SPACE 3
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
         SPACE 1
         DS    0F
NFNDMSG  DC    X'00360100'
         DC    CL50'NO JOBS ON OUT QUEUE'
         SPACE 1
HDRI     DC    X'00440100'
         DC    CL26'****   IN  QUEUE   ****'
         DC    CL38' EXCPC    EXCPT    CPUC     CPUT'
         SPACE 1
HDRO     DC    X'00440100'
         DC    CL26'****   OUT  QUEUE   ****'
         DC    CL38' EXCPC    EXCPT    CPUC     CPUT'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
XSASAVE  DS    F
ASID     DS    F
ASVTEND  DS    F                                                 JCC
SCANRET  DS    C
SCANTYPE DS    C
TSOSW    DS    C
DOMAIN   DS    C
         SPACE 5
         DS    0F
WTOLIST  DS    F
JOBMSG   DS    0CL60
JOBNAME  DS    CL9
STEPNAME DS    CL9
PROCNAME DS    CL8
EXCPC    DS    CL6
EXCPT    DS    CL10
CPUC     DS    CL8
CPUT     DS    CL10
         SPACE 3
JOBTABLE DS    900F
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCZP03D
         TITLE 'IEEZP03D -   ##P  PAGING MONITOR'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       IEEZP03D -       ##P  PAGING MONITOR                      ***
***                                                                 ***
***       VERSION -        1.2                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/ESA 3.1.3                            ***
***                                                                 ***
***       UPDATED -        09/01/79                                 ***
***                        01/26/83  AXC-CBT CHANGE ESTAE PARM LEN  ***
***                        08/19/91  JCL-TEC UPDATES FOR ESA        ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
*-------------------------------------------------------------*    @TEC
* UPDATE FOR ESA. PAGINGS STATS ARE NO LONGER KEPT IN THE     *    @TEC
* PVT. THEY HAVE BEEN MOVED ABOVE THE LINE TO A CONTROL BLOCK *    @TEC
* CALLED THE RCE.                                             *    @TEC
*-------------------------------------------------------------*    @TEC
IEEZP03D CSECT
         LR    R12,R15
         USING IEEZP03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                     -JAL/XA-
         BSM   0,R9                                           -JAL/XA-
AMODE31  DC    A(CONT31+X'80000000')                          -JAL/XA-
CONT31   DS    0H                                             -JAL/XA-
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         XC    VIOWRK(16),VIOWRK   ZERO WORK FIELDS                @TEC
         MVC   WTOLIST(4),=X'002C0100'
         L     R1,XAT              WAITTIME ADDR
         L     R15,8(0,R1)         LOAD HEX TIME
         LTR   R15,R15             TIME NOT SPECIFIED
         BNZ   SETINIT             NO
         MVC   0(8,R1),=CL8'00003000'  30 SECONDS DEFAULT
         MVC   8(4,R1),=F'30'          30 SECONDS DEFAULT
SETINIT  L     R4,16               CVT
         L     R4,1168(0,R4)       RCE                             @TEC
         L     R1,84(0,R4)         RCEVIOPI                        @TEC
         A     R1,100(0,R4)        RCEVIOPO                        @TEC
         ST    R1,VIOWRK           SAVE VIO PAGING COUNT           @TEC
         L     R1,80(0,R4)         RCESWPPI                        @TEC
         A     R1,96(0,R4)         RCESWPPO                        @TEC
         ST    R1,SWAPWRK          SAVE SWAP PAGING COUNT          @TEC
         L     R1,72(0,R4)         RCECOMPI                        @TEC
         A     R1,76(0,R4)         RCELPAPI                        @TEC
         A     R1,92(0,R4)         RCECOMPO                        @TEC
         ST    R1,COMNWRK          SAVE COMMON AREA PAGING         @TEC
         L     R1,68(0,R4)         RCETOTPI                        @TEC
         A     R1,88(0,R4)         RCETOTPO                        @TEC
         S     R1,72(0,R4)         RCECOMPI                        @TEC
         S     R1,76(0,R4)         RCELPAPI                        @TEC
         S     R1,92(0,R4)         RCECOMPO                        @TEC
         ST    R1,ASPCWRK          SAVE ADDRESS SPACE PAGING       @TEC
         L     R6,XAT
         L     R6,8(0,R6)          HEX NO. OF SECS
         L     R3,XAT              WAITTIME ADDR
         STIMER WAIT,DINTVL=(R3)
PAGOUT   MVI   PAGMSG,C' '
         MVC   PAGMSG+1(39),PAGMSG
         MVC   PSEC(10),=CL10'PAGES/SEC'
         L     R4,16               CVT ADDR
         L     R4,1168(0,R4)       RCE                             @TEC
         SR    R7,R7
         L     R1,84(0,R4)         RCEVIOPI                        @TEC
         A     R1,100(0,R4)        RCEVIOPO                        @TEC
         S     R1,VIOWRK           MINUS PRIOR VIO COUNT           @TEC
         LTR   R1,R1               OVERFLOW
         BNP   *+6                 NO
         AR    R7,R1               ACCUMULATE TOTAL PAGING
         MVC   PAGNAME(16),=CL16'VIO PAGING'
         BAL   R11,PAGFORM
         L     R1,80(0,R4)         RCESWPPI                        @TEC
         A     R1,96(0,R4)         RCESWPPO                        @TEC
         S     R1,SWAPWRK          MINUS PRIOR SWAP COUNT          @TEC
         LTR   R1,R1               OVERFLOW
         BNP   *+6                 NO
         AR    R7,R1               ACCUMULATE TOTAL PAGING
         MVC   PAGNAME(16),=CL16'SWAP PAGING'
         BAL   R11,PAGFORM
         L     R1,72(0,R4)         RCECOMPI                        @TEC
         A     R1,76(0,R4)         RCELPAPI                        @TEC
         A     R1,92(0,R4)         RCECOMPO                        @TEC
         S     R1,COMNWRK          MINUS PRIOR COMMON AREA         @TEC
         LTR   R1,R1               OVERFLOW
         BNP   *+6                 NO
         AR    R7,R1               ACCUMULATE TOTAL PAGING
         MVC   PAGNAME(16),=CL16'COMMON PAGING'
         BAL   R11,PAGFORM
         L     R1,68(0,R4)         RCETOTPI                        @TEC
         A     R1,88(0,R4)         RCETOTPO                        @TEC
         S     R1,72(0,R4)         RCECOMPI                        @TEC
         S     R1,76(0,R4)         RCELPAPI                        @TEC
         S     R1,92(0,R4)         RCECOMPO                        @TEC
         S     R1,ASPCWRK          MINUS PRIOR AS PAGING           @TEC
         LTR   R1,R1               OVERFLOW
         BNP   *+6                 NO
         AR    R7,R1               ACCUMULATE TOTAL PAGING
         MVC   PAGNAME(16),=CL16'ADDRSPC PAGING'
         BAL   R11,PAGFORM
         LR    R1,R7               TOTAL PAGES/INTERVAL
         MVC   PAGNAME(16),=CL16'TOTAL PAGING'
         BAL   R11,PAGFORM
         B     RETURN
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEEZP03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         LA    R11,RETURN          LOAD RET ADDR
         B     MSGRTN
PAGFORM  LTR   R1,R1               PAGE COUNT OVERFLOW
         BM    PAGFORM1            YES
         L     R15,XAT
         SR    R14,R14
         LR    R15,R1
         M     R14,=F'100'         SET UP HUNDREDTHS
         DR    R14,R6              FIND PAGING RATE
         MVC   PAGSEC(7),=XL7'402020214B2020'
         CVD   R15,DOUBLE          PAGES
         ED    PAGSEC(7),DOUBLE+5
         B     PAGFORM2
         SPACE 1
PAGFORM1 MVC   PAGSEC(7),=CL7'*OVER*'
         SPACE 1
PAGFORM2 LA    R1,WTOLIST
MSGRTN   SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         BR    R11
         SPACE 3
RETURN   ESTAE 0
         LA    R8,AMODE24                                  -JAL/XA-
         BSM   0,R8                                        -JAL/XA-
AMODE24  DS    0H                                          -JAL/XA-
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         LTORG
         DS    0D
WAITTIME DC    CL8'00003000'
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
XSASAVE  DS    F
         SPACE 5
         DS    0F
WTOLIST  DS    F
PAGMSG   DS    0CL40
PAGNAME  DS    CL16
         DS    CL4
PAGSEC   DS    CL7
         DS    CL3
PSEC     DS    CL10
         SPACE 3
VIOWRK   DS    F                  VIO PAGE WORK FIELD              @TEC
SWAPWRK  DS    F                  SWAP PAGE WORK FIELD             @TEC
COMNWRK  DS    F                  COMN PAGE WORK FIELD             @TEC
ASPCWRK  DS    F                  ASPC PAGE WORK FIELD             @TEC
         SPACE 3
ESTAELST DS    0F,(ESTAEOVX)X
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=CSCZS03D
         TITLE 'SP1ZS03D -   ##S  SYSTEM INDICATOR MONITOR'
***********************************************************************
***********************************************************************
***                                                                 ***
***                                                                 ***
***                                                                 ***
***                     COMMAND  SUB-SYSTEM                         ***
***                  -------------------------                      ***
***                                                                 ***
***                                                                 ***
***       SP1ZS03D -       ##S  SYSTEM INDICATOR MONITOR            ***
***                                                                 ***
***       VERSION -        1.0                                      ***
***                                                                 ***
***       MVS LEVEL -      MVS/SP RELEASE 1                         ***
***                                                                 ***
***       UPDATED -        06/15/81                                 ***
***                                                                 ***
***                                                                 ***
***                                                                 ***
***********************************************************************
***********************************************************************
IEEZS03D CSECT
         LR    R12,R15
         USING IEEZS03D,R12
         L     R0,SIZE             LOAD GETMAIN AREA SIZE AND SUBPOOL
         GETMAIN R,LV=(0)
         LR    R13,R1
         USING WORK,R13
         ST    R14,SAVRET          SAVE RETURN ADDR
         ST    R2,XSASAVE          SAVE XSA ADDR
         USING XSA,R2
         L     R3,XAL
         LA    R3,0(0,R3)
         XC    PARM(3),PARM
         LTR   R3,R3
         BZ    *+10                NO PARM
         MVC   PARM(3),0(R3)       SAVE UNIT NAME SCAN
         LR    R10,R13             LOAD SAVE AREA ADDR
         L     R9,AMODE31                                     -JAL/XA-
         BSM   0,R9                                           -JAL/XA-
AMODE31  DC    A(CONT31+X'80000000')                          -JAL/XA-
CONT31   DS    0H                                             -JAL/XA-
         B     ESTAEBYP            BYPASS ESTAE LIST
ESTAEOVL ESTAE STAEXIT,CT,MF=L               * ESTAE PARM FIX GLA-BFG*
ESTAEOVX EQU   *-ESTAEOVL                    * ESTAE PARM FIX GLA-BFG*
ESTAEBYP MVC   ESTAELST(ESTAEOVX),ESTAEOVL   * ESTAE PARM FIX GLA-BFG*
         LA    R1,ESTAELST
         ESTAE PARAM=(10),MF=(E,(1))
         LA    R5,20
         LA    R6,DMNTAB
         USING DMNTAB,R6
         ST    R6,DMNTABAD
         L     R1,=X'7FFFFFFF'     FORCE INITIAL MIN FILL
         SPACE 1
DMNCLR   XC    0(128,R6),0(R6)     CLEAR AN ENTRY
         ST    R1,DMINTGT
         ST    R1,DMINMPL
         ST    R1,DMINRDY
         ST    R1,DMINGOO
         ST    R1,DMINOUT
         ST    R1,DMININC
         ST    R1,DMINWSR
         LA    R6,128(0,R6)        NEXT ENTRY
         BCT   R5,DMNCLR           CLEAR WHOLE DMNTAB
         XC    SYSTAB(100),SYSTAB
         ST    R1,MINMLGCP
         ST    R1,MINMAVCP
         ST    R1,MINMAVPG
         ST    R1,MINMUICA
         ST    R1,MINMASMQ
         L     R1,XAT              WAITTIME ADDR
         L     R15,8(0,R1)         LOAD HEX TIME
         LTR   R15,R15             TIME NOT SPECIFIED
         BNZ   BYPASS              NO
         MVC   0(8,R1),=CL8'00003000'  30 SECONDS DEFAULT
         MVC   8(4,R1),=F'30'          30 SECONDS DEFAULT
         SPACE 1
BYPASS   L     R3,8(0,R1)          LOAD MONITOR TIME
         LR    R5,R3
SYSCHK   STIMER WAIT,DINTVL=INTERVL
         SPACE 1
         L     R4,16               CVT
         L     R4,604(0,R4)        RMCT
         L     R1,4(0,R4)          CCT                             @TEC
         LH    R1,104(0,R1)        LONG TERM CPU UTIL              @TEC
         SRL   R1,8                SCALED BY 256?                  @TEC
         ST    R1,CURRLGCP
         C     R1,MINMLGCP
         BNL   *+8
         ST    R1,MINMLGCP
         C     R1,MAXMLGCP
         BNH   *+8
         ST    R1,MAXMLGCP
         A     R1,ACUMLGCP
         ST    R1,ACUMLGCP
         L     R1,4(0,R4)          CCT                             @TEC
         LH    R1,102(0,R1)        AVERAGE CPU                     @TEC
         ST    R1,CURRAVCP
         C     R1,MINMAVCP
         BNL   *+8
         ST    R1,MINMAVCP
         C     R1,MAXMAVCP
         BNH   *+8
         ST    R1,MAXMAVCP
         A     R1,ACUMAVCP
         ST    R1,ACUMAVCP
         L     R1,228(0,R4)        RCT                             @TEC
         LH    R1,64(0,R1)         AVERAGE PAGING                  @TEC
         ST    R1,CURRAVPG
         C     R1,MINMAVPG
         BNL   *+8
         ST    R1,MINMAVPG
         C     R1,MAXMAVPG
         BNH   *+8
         ST    R1,MAXMAVPG
         A     R1,ACUMAVPG
         ST    R1,ACUMAVPG
         L     R1,228(0,R4)        RCT                             @TEC
         LH    R1,54(0,R1)         AVERAGE UIC                     @TEC
         ST    R1,CURRUICA
         C     R1,MINMUICA
         BNL   *+8
         ST    R1,MINMUICA
         C     R1,MAXMUICA
         BNH   *+8
         ST    R1,MAXMUICA
         A     R1,ACUMUICA
         ST    R1,ACUMUICA
         LH    R1,878(0,R4)        AVERAGE ASMQ             AXC-SP1
         ST    R1,CURRASMQ
         C     R1,MINMASMQ
         BNL   *+8
         ST    R1,MINMASMQ
         C     R1,MAXMASMQ
         BNH   *+8
         ST    R1,MAXMASMQ
         A     R1,ACUMASMQ
         ST    R1,ACUMASMQ
         CLI   PARM,C'D'           DOMAIN MONITOR
         BE    DOMAIN              YES
SYSCHK0  BCT   R3,SYSCHK
         SR    R14,R14
         L     R15,ACUMAVCP
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,AVRGAVCP
         SR    R14,R14
         L     R15,ACUMLGCP
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,AVRGLGCP
         SR    R14,R14
         L     R15,ACUMAVPG
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,AVRGAVPG
         SR    R14,R14
         L     R15,ACUMUICA
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,AVRGUICA
         SR    R14,R14
         L     R15,ACUMASMQ
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,AVRGASMQ
         B     SYSCHK1
SYSCHK1  LA    R10,SYSTAB
         LA    R9,SYSOTAB
         MVC   WTOLIST(4),=X'00360100'
         LA    R3,5                NO. OF OUTPUT LINES
         SPACE 1
SYSCHK2  MVC   WTOLIST+4(50),0(R9)
         L     R1,8(0,R10)         MIN
         CVD   R1,DOUBLE
         MVC   MIN(4),=X'40202120'
         ED    MIN(4),DOUBLE+6
         L     R1,12(0,R10)        MAX
         CVD   R1,DOUBLE
         MVC   MAX(4),=X'40202120'
         ED    MAX(4),DOUBLE+6
         L     R1,16(0,R10)        AVG
         CVD   R1,DOUBLE
         MVC   AVG(4),=X'40202120'
         ED    AVG(4),DOUBLE+6
         LA    R1,WTOLIST
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         LA    R9,50(0,R9)
         LA    R10,20(0,R10)
         BCT   R3,SYSCHK2
         CLI   PARM,C'D'           DOMAIN MONITOR
         BE    DOMAIN4             YES
         B     RETURN
DOMAIN   L     R4,16               CVT
         L     R4,604(0,R4)        RMCT
         LH    R9,188(0,R4)        NO. OF DOMAINS
         BCTR  R9,0
         L     R4,180(0,R4)        DMDT
         LA    R7,20
         L     R6,DMNTABAD
         SPACE 1
DOMAIN1  LA    R4,64(0,R4)         NEXT DOMAIN                     @TEC
         CLC   6(4,R4),=F'0'       EMPTY DOMAIN
         BNE   DOMAIN3             NO
         CLC   12(4,R4),=F'0'      EMPTY DOMAIN
         BNE   DOMAIN3             NO
         BCT   R9,DOMAIN1          NEXT DOMAIN
         B     SYSCHK0
         SPACE 1
DOMAIN2  LA    R6,128(0,R6)
         BCT   R7,DOMAIN3
         B     SYSCHK0
         SPACE 1
DOMAIN3  SR    R1,R1
         IC    R1,0(0,R4)          DOMAIN NO.
         C     R1,DMNNBR           DOMAIN MATCH
         BE    DOMAIN3A            YES
         CLI   DMNNBR+3,X'00'      EMPTY SLOT
         BNE   DOMAIN2             NO
         ST    R1,DMNNBR
         IC    R1,1(0,R4)          MIN TARGET
         ST    R1,DMNMIN
         IC    R1,2(0,R4)          MAX TARGET
         ST    R1,DMNMAX
         IC    R1,3(0,R4)          WT
         ST    R1,DMNWT
DOMAIN3A LH    R1,4(0,R4)          TARGET
         C     R1,DMINTGT
         BNL   *+8
         ST    R1,DMINTGT
         C     R1,DMAXTGT
         BNH   *+8
         ST    R1,DMAXTGT
         A     R1,DACCTGT
         ST    R1,DACCTGT
         LH    R1,6(0,R4)          READY USERS
         LA    R1,8(0,R1)          ROUND UP
         SRL   R1,4                DIVIDE BY 16
         C     R1,DMINRDY
         BNL   *+8
         ST    R1,DMINRDY
         C     R1,DMAXRDY
         BNH   *+8
         ST    R1,DMAXRDY
         A     R1,DACCRDY
         ST    R1,DACCRDY
         LH    R1,8(0,R4)          GOING OUT USERS
         C     R1,DMINGOO
         BNL   *+8
         ST    R1,DMINGOO
         C     R1,DMAXGOO
         BNH   *+8
         ST    R1,DMAXGOO
         A     R1,DACCGOO
         ST    R1,DACCGOO
         LH    R1,10(0,R4)         CURRENT MPL
         C     R1,DMINMPL
         BNL   *+8
         ST    R1,DMINMPL
         C     R1,DMAXMPL
         BNH   *+8
         ST    R1,DMAXMPL
         A     R1,DACCMPL
         ST    R1,DACCMPL
         LH    R1,12(0,R4)         OUT USERS
         C     R1,DMINOUT
         BNL   *+8
         ST    R1,DMINOUT
         C     R1,DMAXOUT
         BNH   *+8
         ST    R1,DMAXOUT
         A     R1,DACCOUT
         ST    R1,DACCOUT
         LH    R1,14(0,R4)         IN USERS
         C     R1,DMININC
         BNL   *+8
         ST    R1,DMININC
         C     R1,DMAXINC
         BNH   *+8
         ST    R1,DMAXINC
         A     R1,DACCINC
         ST    R1,DACCINC
         L     R1,24(0,R4)         IN USERS
         C     R1,DMINWSR
         BNL   *+8
         ST    R1,DMINWSR
         C     R1,DMAXWSR
         BNH   *+8
         ST    R1,DMAXWSR
         A     R1,DACCWSR
         ST    R1,DACCWSR
         BCTR  R9,0
         LA    R6,128(0,R6)        NEXT DOMAIN AREA
         BCT   R7,DOMAIN1
         B     SYSCHK0
DOMAIN4  L     R6,DMNTABAD         DOMAIN TABLE
         SPACE 1
DOMAIN4A CLI   DMNNBR+3,X'00'      END OF TABLE
         BE    DOMAIN5             YES
         SR    R14,R14
         L     R15,DACCTGT
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,DAVGTGT
         SR    R14,R14
         L     R15,DACCMPL
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,DAVGMPL
         SR    R14,R14
         L     R15,DACCRDY
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,DAVGRDY
         SR    R14,R14
         L     R15,DACCGOO
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,DAVGGOO
         SR    R14,R14
         L     R15,DACCOUT
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,DAVGOUT
         SR    R14,R14
         L     R15,DACCINC
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,DAVGINC
         SR    R14,R14
         L     R15,DACCWSR
         DR    R14,R5              AVERAGE CALCULATION
         ST    R15,DAVGWSR
         LA    R6,128(0,R6)
         B     DOMAIN4A
         SPACE 1
DOMAIN5  L     R6,DMNTABAD         DOMAIN TABLE
         LA    R5,20
         LA    R1,DMNHDR1
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         LA    R1,DMNHDR2
         SR    R0,R0
         IC    R0,XAU
         SVC   35
         MVC   DMNLIST(4),=X'00360100'
         MVI   DMNLIST+4,C' '
         MVC   DMNLIST+5(49),DMNLIST+4
         SPACE 1
DOMAIN6  MVC   LTYP(3),=C'AVG'
         L     R1,DMNNBR
         CVD   R1,DOUBLE
         UNPK  LDMN(2),DOUBLE+6(2)
         OI    LDMN+1,X'F0'
         SPACE 1
DOMAIN7  L     R1,DMNWT
         LA    R8,DAVGTGT          AVG VALUES
         CLI   LTYP+2,C'G'         AVG LINE
         BE    DOMAIN8             YES
         L     R1,DMNMIN
         LA    R8,DMINTGT          MIN VALUES
         MVC   LDMN(2),=C'  '
         CLI   LTYP+2,C'N'         MIN LINE
         BE    DOMAIN8             YES
         L     R1,DMNMAX
         LA    R8,DMAXTGT          MAX VALUES
DOMAIN8  MVC   LLIM-1(4),=X'40202120'
         CVD   R1,DOUBLE
         ED    LLIM-1(4),DOUBLE+6
         L     R1,0(0,R8)
         MVC   LTGT-1(4),=X'40202120'
         CVD   R1,DOUBLE
         ED    LTGT-1(4),DOUBLE+6
         L     R1,4(0,R8)
         MVC   LMPL-1(4),=X'40202120'
         CVD   R1,DOUBLE
         ED    LMPL-1(4),DOUBLE+6
         L     R1,8(0,R8)
         MVC   LRDY-1(4),=X'40202120'
         CVD   R1,DOUBLE
         ED    LRDY-1(4),DOUBLE+6
         L     R1,12(0,R8)
         MVC   LGOO-1(4),=X'40202120'
         CVD   R1,DOUBLE
         ED    LGOO-1(4),DOUBLE+6
         L     R1,16(0,R8)
         MVC   LOUT-1(4),=X'40202120'
         CVD   R1,DOUBLE
         ED    LOUT-1(4),DOUBLE+6
         L     R1,20(0,R8)
         MVC   LINC-1(4),=X'40202120'
         CVD   R1,DOUBLE
         ED    LINC-1(4),DOUBLE+6
         L     R1,24(0,R8)
         MVC   LWSR-1(6),=X'402020202120'
         CVD   R1,DOUBLE
         ED    LWSR-1(6),DOUBLE+5
         CLI   PARM+1,C'A'         AVG LINE DISPLAY ONLY
         BNE   DOMAIN8A            NO
         CLI   LTYP,C'A'           IS THIS AVG LINE
         BNE   DOMAIN8B            NO, BYPASS PRINT
         SPACE 1
DOMAIN8A LA    R1,DMNLIST
         SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         SPACE 1
DOMAIN8B CLI   LTYP+2,C'G'         AVG LINE
         BNE   *+14                NO
         MVC   LTYP(3),=C'MIN'
         B     DOMAIN7
         CLI   LTYP+2,C'N'         MIN LINE
         BNE   DOMAIN9             NO
         MVC   LTYP(3),=C'MAX'
         B     DOMAIN7
         SPACE 1
DOMAIN9  LA    R6,128(0,R6)
         CLI   DMNNBR+3,X'00'      END OF OUTPUT
         BE    RETURN              YES
         BCT   R5,DOMAIN6
         B     RETURN
MSGRTN   SR    R0,R0
         IC    R0,XAU              INSERT MCS ID
         SVC   35                  ISSUE WTO
         BR    R11
         SPACE 3
RETURN   ESTAE 0
         LA    R8,AMODE24                                  -JAL/XA-
         BSM   0,R8                                        -JAL/XA-
AMODE24  DS    0H                                          -JAL/XA-
         L     R0,SIZE             LOAD GETMAIN SIZE AND SUBPOOL
         LR    R1,R13              LOAD GETMAIN AREA ADDR
         L     R14,SAVRET          RETURN ADDR
         FREEMAIN R,LV=(0),A=(1)
         SR    R15,R15
         BR    R14
         USING *,R15
STAEXIT  CH    R0,=H'12'           SDWA GOTTEN
         BE    STAEXIT1            NO, FORCE RETURN
************************************************************** GLA-BFG
*  THIS WILL RECORD ANY ABENDS IN LOGREC WITH THE              GLA-BFG
*  OPERANDS, REGISTERS, AND PSW IN IT.                         GLA-BFG
************************************************************** GLA-BFG
         STM   R14,R12,12(R13)     SAVE REGISTER               GLA-BFG
         LR    R14,R13             SAVE ORIG R13               GLA-BFG
         L     R13,0(R1)           GET ESTAE PARM              GLA-BFG
         L     R2,XSASAVE          GET XSA ADDRESS             GLA-BFG
         LR    R13,R14             RESTORE R13                 GLA-BFG
         ICM   R2,15,XAL-XSA(R2)   GET PARM ADDRESS            GLA-BFG
         BZ    ESTNOP              IF NO PARMS THEN SKIP DATA  GLA-BFG
         OI    SDWADPVA-SDWA(1),SDWAVRAM+SDWAEBC SET TO VRA    GLA-BFG
*                                  AND EBCDIC                  GLA-BFG
         MVC   SDWAVRA-SDWA(L'ESTPRFX,1),ESTPRFX MOVE HEADER   GLA-BFG
         MVC   SDWAVRA+11-SDWA(8,1),0(R2) MOVE IN DATA         GLA-BFG
         MVI   SDWAURAL-SDWA(1),19 SET LENGTH OF DATA          GLA-BFG
         B     ESTNOP              SKIP CONSTANTS              GLA-BFG
         ESTMODS ,                                             GLA-BFG
ESTPRFX  DC    0CL11' ',AL1(VRAHID,7),C'OPERAND',AL1(VRARRK,8) GLA-BFG
ESTNOP   L     R2,=A(STAERTRY)     GET RETRY ADDRESS           GLA-BFG
         LA    R3,ESTMODS          POINT AT NAMES              GLA-BFG
         SETRP RC=4,RETADDR=(2),FRESDWA=YES,DUMP=NO,           GLA-BFG X
               RECORD=YES,RECPARM=(3),REGS=(14,12)             GLA-BFG
         SPACE 3
STAEXIT1 L     R0,=A(STAERTRY)     LOAD RETRY ADDR
         LA    R15,4
         BR    R14
         DROP  R15
         SPACE 3
         USING *,R15
STAERTRY L     R12,=A(IEEZS03D)    LOAD ENTRY POINT ADDR
         LR    R13,R1              RELOAD WORK AREA ADDR
         DROP  R15
         LA    R1,STAEMSG          ADDRESSING ERROR
         L     R2,XSASAVE          RELOAD XSA ADDR
         LA    R11,RETURN          LOAD RET ADDR
         B     MSGRTN
         LTORG
         DS    0D
INTERVL  DC    CL8'00000100'
         DS    0F
SIZE     DC    X'F1',AL3(WORKEND-WORKSTRT)
         SPACE 3
DMNHDR1  DC    X'00300100'
         DC    CL44' '
         SPACE 3
DMNHDR2  DC    X'00360100'
         DC    CL50'DMN  TYP  LIM  TGT  MPL  RDY  GOO  OUT  INC   WSR'
         SPACE 3
SYSOTAB  DS    0F
AVCPOVLY DC    CL50'AVERAGE CPU       MIN- NNN    MAX- NNN    AVG- NNN'
LGCPOVLY DC    CL50'LONG TERM CPU     MIN- NNN    MAX- NNN    AVG- NNN'
AVPGOVLY DC    CL50'AVERAGE PAGING    MIN- NNN    MAX- NNN    AVG- NNN'
UICAOVLY DC    CL50'AVERAGE UIC       MIN- NNN    MAX- NNN    AVG- NNN'
ASMQOVLY DC    CL50'ASMQ LENGTH       MIN- NNN    MAX- NNN    AVG- NNN'
         SPACE 3
         DS    0F
STAEMSG  DC    X'00360100'
         DC    CL50'ERROR ENCOUNTERED IN CONTROL BLOCKS, RETRY COMMAND'
WORK     DSECT
WORKSTRT DS    0D
SAVRET   DS    18F
DOUBLE   DS    2F
XSASAVE  DS    F
DMNTABAD DS    F
PARM     DS    F
ESTAELST DS    0F,(ESTAEOVX)X
         DS    0F
SYSTAB   DS    0CL100
CURRAVCP DS    F
ACUMAVCP DS    F
MINMAVCP DS    F
MAXMAVCP DS    F
AVRGAVCP DS    F
CURRLGCP DS    F
ACUMLGCP DS    F
MINMLGCP DS    F
MAXMLGCP DS    F
AVRGLGCP DS    F
CURRAVPG DS    F
ACUMAVPG DS    F
MINMAVPG DS    F
MAXMAVPG DS    F
AVRGAVPG DS    F
CURRUICA DS    F
ACUMUICA DS    F
MINMUICA DS    F
MAXMUICA DS    F
AVRGUICA DS    F
CURRASMQ DS    F
ACUMASMQ DS    F
MINMASMQ DS    F
MAXMASMQ DS    F
AVRGASMQ DS    F
         DS    0F
WTOLIST  DS    F
         DS    CL22
MIN      DS    CL4
         DS    CL8
MAX      DS    CL4
         DS    CL8
AVG      DS    CL4
         SPACE 3
         DS    0F
DMNLIST  DS    F
LDMN     DS    CL3
         DS    CL2
LTYP     DS    CL3
         DS    CL2
LLIM     DS    CL3
         DS    CL2
LTGT     DS    CL3
         DS    CL2
LMPL     DS    CL3
         DS    CL2
LRDY     DS    CL3
         DS    CL2
LGOO     DS    CL3
         DS    CL2
LOUT     DS    CL3
         DS    CL2
LINC     DS    CL3
         DS    CL2
LWSR     DS    CL5
DMNTAB   DS    0CL128
DMNNBR   DS    F
DMNMIN   DS    F
DMNMAX   DS    F
DMNWT    DS    F
DMINTGT  DS    F
DMINMPL  DS    F
DMINRDY  DS    F
DMINGOO  DS    F
DMINOUT  DS    F
DMININC  DS    F
DMINWSR  DS    F
DMAXTGT  DS    F
DMAXMPL  DS    F
DMAXRDY  DS    F
DMAXGOO  DS    F
DMAXOUT  DS    F
DMAXINC  DS    F
DMAXWSR  DS    F
DAVGTGT  DS    F
DAVGMPL  DS    F
DAVGRDY  DS    F
DAVGGOO  DS    F
DAVGOUT  DS    F
DAVGINC  DS    F
DAVGWSR  DS    F
DACCTGT  DS    F
DACCMPL  DS    F
DACCRDY  DS    F
DACCGOO  DS    F
DACCOUT  DS    F
DACCINC  DS    F
DACCWSR  DS    F
         SPACE 3
         DS    19CL128
         SPACE 3
WORKEND  DS    0F
XSA      DSECT
XAP      DS    F
XAD      DS    F
XAX      DS    D
XAE      DS    0C
XAR      DS    F
XAN      DS    0C
XAL      DS    F
XAT      DS    D
XAS      DS    D
XAU      DS    C
         DS    C
XAJ      DS    H
         DS    F
         PRINT NOGEN
         IHASDWA
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         END
./       ADD   NAME=EDIT
         MACRO
&NAME    EDIT  &PR,&NUM,&ED
         LCLA  &A1,&A2,&A3,&A4
         LCLB  &B1,&B2
         LCLC  &C1,&C2,&C3
         ACTR  200
         AIF   (N'&SYSLIST EQ 2 AND K'&ED EQ 0).ANOP1
         AIF   (N'&SYSLIST NE 3).MNOTE1
         AIF   ('&ED'(1,1) EQ '-' OR '&ED'(1,1) EQ '$').EDMK
.ANOP1   ANOP
&A1      SETA  &A1+1
         AIF   (K'&ED LT &A1).CONT
&A2      SETA  &A2+1
&A4      SETA  &A4+1
         AIF   ('&ED'(&A1,1) NE 'Z' AND '&ED'(&A1,1) NE '&C2').NINE
.ANOP2   ANOP
&C1      SETC  '&C1.20'
         AGO   .ANOP1
.NINE    AIF   ('&ED'(&A1,1) NE '9').PER
         AIF   (&B1).ANOP2
&B1      SETB  1
         AIF   (&A1 EQ 1).SIGNIF
         AIF   (&A1 EQ 2 AND &B2).SIGNIF
&C3      SETC  '&C1'(&A4*2-3,2)
         AIF   ('&C3' NE '20').NINE2
&C1      SETC  '&C1'(1,&A4*2-4).'2120'
         AGO   .ANOP1
.NINE2   ANOP
&C1      SETC  '&C1'(1,&A4*2-6).'21&C3.20'
         AGO   .ANOP1
.SIGNIF  ANOP
&C1      SETC  '21'
         AGO   .ANOP1
.PER     AIF   ('&ED'(&A1,1) NE '.').COMMA
&C1      SETC  '&C1.4B'
&A2      SETA  &A2-1
         AGO   .ANOP1
.COMMA   AIF   ('&ED'(&A1,1) NE 'V').SLASH
&C1      SETC  '&C1.6B'
&A2      SETA  &A2-1
         AGO   .ANOP1
.SLASH   AIF   ('&ED'(&A1,1) NE '/').DBCR
&C1      SETC  '&C1.61'
&A2      SETA  &A2-1
         AGO   .ANOP1
.DBCR    AIF   (&A1+1 NE K'&ED).MNOTE2
         AIF   ('&ED'(&A1,2) NE 'CR').DB
&C1      SETC  '&C1.C3D9'
&A2      SETA  &A2-1
         AGO   .CONT
.DB      AIF   ('&ED'(&A1,2) NE 'DB').MNOTE2
&C1      SETC  '&C1.C4C2'
&A2      SETA  &A2-1
.CONT    ANOP
&C3      SETC  '&PR'
         AIF   (L'&NUM*2-1 NE &A2).EDSIZE
.ENDCHEC ANOP
&A2      SETA  0
         AIF   (K'&C1/2+1 NE L'&PR).AREASIZ
.LAST    AIF   (&B2).EDMKEND
&NAME    MVC   &C3,=X'40&C1'
         ED    &C3,&NUM
         MEXIT
.EDSIZE  AIF   (L'&NUM*2-1 LT &A2).LONG
.SHORT   ANOP
&C1      SETC  '20&C1'
&A3      SETA  &A3+1
         AIF   (L'&NUM*2-1 GT &A2+&A3).SHORT
         AGO   .ENDCHEC
.LONG    ANOP
&C1      SETC  '&C1'(3,K'&C1-2)
&A3      SETA  &A3+1
         AIF   (L'&NUM*2-1 LT &A2-&A3).LONG
         AGO   .ENDCHEC
.AREASIZ AIF   (K'&C1/2+1 LT L'&PR).LESS
&A2      SETA  K'&C1/2+1-L'&PR
&A3      SETA  K'&C1/2+1
&C3      SETC  '&C3-&A2.(&A3)'
&B1      SETB  1
         AGO   .LAST
.LESS    ANOP
&B1      SETB  0
&A3      SETA  K'&C1/2+1
         AIF   (K'&C1/2+5 GE L'&PR).PLUSET
&C3      SETC  '&C3.(&A3)'
         AGO   .LAST
.PLUSET  ANOP
&A2      SETA  L'&PR-K'&C1/2-1
&C3      SETC  '&C3+&A2.(&A3)'
         AGO   .LAST
.EDMK    AIF   ('&ED'(1,1) EQ '-').NEG
&C2      SETC  '$'
         AGO   .C2SET
.NEG     ANOP
&C2      SETC  '-'
.C2SET   ANOP
&A1      SETA  1
&B2      SETB  1
         AGO   .ANOP1
.EDMKEND ANOP
&A1      SETA  -1
.EDMKNOP ANOP
&A1      SETA  &A1+2
         AIF   (K'&C1 LT &A1).SETA
         AIF   ('&C1'(&A1,2) EQ '21').SETAA
         AIF   ('&C1'(&A1,2) NE '4B').EDMKNOP
&A1      SETA  (&A1+1)/2
         AGO   .LA
.SETA    ANOP
&A1      SETA  (&A1+1)/2-1
         AGO   .LA
.SETAA   ANOP
&A1      SETA  (&A1+1)/2+1
.LA      ANOP
         AIF   (&B1).MINUS
&A1      SETA  &A1+&A2
         AGO   .MVC
.MINUS   ANOP
&A1      SETA  &A1-&A2
.MVC     ANOP
&NAME    MVC   &C3,=X'40&C1'
         LA    1,&PR+&A1
         EDMK  &C3,&NUM
         AIF   ('&C2' EQ '$').DOLLAR
         BNM   EDIT&SYSNDX
         BCTR  1,0
         MVI   0(1),C'-'
&C3      SETC  '&SYSNDX'
EDIT&C3  EQU   *
         MEXIT
.DOLLAR  BCTR  1,0
         MVI   0(1),C'$'
         MEXIT
.MNOTE1  MNOTE 8,'THREE OPERANDS MUST BE SPECIFIED'
         MEXIT
.MNOTE2  MNOTE 8,'INVALID EDIT PATTERN'
         MEND
./       ADD   NAME=ESTMODS
         MACRO
         ESTMODS
ESTMODS  DC    3CL8'&SYSECT'
         MEND
