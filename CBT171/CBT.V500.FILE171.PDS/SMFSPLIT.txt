*---------------------------------------------------------------------*
*  Program name: SMFSPLIT                                             *
*                                                                     *
*  Purpose:      provide a utility to pre-process SMF records.        *
*                                                                     *
*  Description:                                                       *
*                                                                     *
*    This program allows SMF records to be 'SPLIT' or 'GROUPED'       *
*    together based on the SMF record type.  Input is the data        *
*    set produced by the 'SMFDUMP' utility.  Output is 1 to 50        *
*    (more could be made available by enlarging the DD control        *
*    table size) sequential data sets.  The number of output data     *
*    sets and which records will go to which output data set is       *
*    determined by user supplied control statements.                  *
*                                                                     *
*    The control statements are:                                      *
*       1. DD control statement                                       *
*          COLUMNS  1- 8  'DD     '                                   *
*                  10-17  DDNAME                                      *
*                                                                     *
*          NOTE:  a JCL DD statement is required for each DD          *
*                 defined.                                            *
*                                                                     *
*       2. RECORD TYPE control statement                              *
*          COLUMNS  1- 8  'RECORD  '                                  *
*                  10-12  Required.  SMF record id in decimal,        *
*                         leading zeros required.                     *
*                  20-27  Optional.  User exit name.                  *
*                  30-37  Required.  Output DDNAME.                   *
*                  40-47  Optional.  Output DDNAME.                   *
*                  50-57  Optional.  Output DDNAME.                   *
*                  60-67  Optional.  Output DDNAME.                   *
*                  70-77  Optional.  Output DDNAME.                   *
*                                                                     *
*          NOTE:  Record types not assigned to any output file        *
*                 will be written to the 'DEFAULT' output file.       *
*                                                                     *
*       3. COMMENT Statement.                                         *
*          COLUMNS  1     '*'                                         *
*                   2-80  Any desired user text                       *
*                                                                     *
*    Control statements may be entered in any order with one          *
*    constraint... DDNAMES must be defined by DD control statements   *
*    before referring to them on a RECORD control statement.          *
*                                                                     *
*    Any SMF record type may be directed to up to 5 output data sets. *
*    Any output data set may be referenced by multiple SMF record     *
*    type definition statements.                                      *
*                                                                     *
*    The record formats may also be modified by an optional user      *
*    exit before the record is written to the output data set.        *
*    This allows processing of fields that are of a format difficult  *
*    to process in COBOL (or another high level language) to a        *
*    format that is easier for that language.  If only a few fields   *
*    are of interest, they may be extracted and the others omitted.   *
*    If fields could be re-arranged to make sorting easier they       *
*    could be moved in the exit.  The output record contents are      *
*    entirely under the control of the exit.  The only constraint     *
*    is the output records be of "variable" format.                   *
*                                                                     *
*    Parameter list to an exit routine is:                            *
*         1.  Address of input record                                 *
*         2.  Address of 1st output DD CONTROL BLOCK                  *
*         3.  Address of returned I/O area for 1ST output DD          *
*         4.  Address of 2ND output DD CONTROL BLOCK or zero          *
*         5.  Address of returned I/O area for 2ND output DD          *
*         6.  Address of 3RD output DD CONTROL BLOCK or zero          *
*         7.  Address of returned I/O area for 3RD output DD          *
*         8.  Address of 4TH output DD CONTROL BLOCK or zero          *
*         9.  Address of returned I/O area for 4TH output DD          *
*        10.  Address of 5TH output DD CONTROL BLOCK or zero          *
*        11.  Address of returned I/O area for 5TH output DD          *
*                                                                     *
*    Exits may alter the input record or acquire storage and build    *
*    a new I/O area.  This allows the same record to be reformatted   *
*    differently for each output file.  The exit communicates the     *
*    presence of a new I/O area by placing its address in the         *
*    FIELD WHICH CORRESPONDS TO THE DD TO WHICH IT IS TO BE WRITTEN.  *
*    If this field is left zero, the I/O area is assumed to be the    *
*    original input area.                                             *
*                                                                     *
*    Statistics are kept per record type and output file and reported *
*    during program termination.                                      *
*                                                                     *
*    Sample JCL to extract STEP and JOB termination records to        *
*    one file (FILE1) and CICS statistics to another file (FILE2):    *
*        //SMFSPLIT  JOB .................                            *
*        //SMFSPLIT  EXEC PGM=SMFSPLIT,REGION=2048K                   *
*        //STEPLIB  DD DSN=..............,DISP=SHR                    *
*        //PRINTER  DD SYSOUT=*                                       *
*        //SYSUT1   DD DSN=SMFDUMP.OUTPUT.FILE,DISP=SHR               *
*        //DEFAULT  DD DUMMY                                          *
*        //FILE1    DD DSN=.............,DISP=(NEW,PASS),             *
*        //            UNIT=SYSDA,                                    *
*        //            SPACE=(TRK,(15,15)),                           *
*        //            DCB=(RECFM=VB,LRECL=15996,BLKSIZE=16000)       *
*        //FILE2    DD DSN=.............,DISP=(NEW,PASS),             *
*        //            UNIT=SYSDA,                                    *
*        //            SPACE=(TRK,(15,15)),                           *
*        //            DCB=(RECFM=VB,LRECL=15996,BLKSIZE=16000)       *
*        //SYSIN    DD *                                              *
*        DD       FILE1                                               *
*        RECORD   004                 FILE1                           *
*        RECORD   005                 FILE1                           *
*        DD       FILE2                                               *
*        RECORD   110                 FILE2                           *
*        /*                                                           *
*        //                                                           *
*                                                                     *
*---------------------------------------------------------------------*
         MACRO
         SMFBLOK &BLOCK=,&TYPE=DSECT
         AIF   ('&BLOCK' EQ 'PARM').BLOCK10
         MNOTE 12,'INVALID BLOCK TYPE ''&BLOCK'' '
         MEXIT
.BLOCK10 ANOP
         AIF  ('&TYPE' EQ 'CSECT').BLOCK11
EXITPARM DSECT
         AGO   .BLOCK12
.BLOCK11 ANOP
EXITPARM DS    0D
.BLOCK12 ANOP
EXITRECA DC    A(0)                  INPUT RECORD ADDRESS
EXITF1   DC    A(0)                  OUTPUT FILE BLOCK ADDRESS 1
EXITIOA1 DC    A(0)                  OUTPUT I/O AREA ADDRESS 1
EXITF2   DC    A(0)                  OUTPUT FILE BLOCK ADDRESS 2
EXITIOA2 DC    A(0)                  OUTPUT I/O AREA ADDRESS 2
EXITF3   DC    A(0)                  OUTPUT FILE BLOCK ADDRESS 3
EXITIOA3 DC    A(0)                  OUTPUT I/O AREA ADDRESS 3
EXITF4   DC    A(0)                  OUTPUT FILE BLOCK ADDRESS 4
EXITIOA4 DC    A(0)                  OUTPUT I/O AREA ADDRESS 4
EXITF5   DC    A(0)                  OUTPUT FILE BLOCK ADDRESS 5
EXITIOA5 DC    A(0)                  OUTPUT I/O AREA ADDRESS 5
EXITPL   EQU   *-EXITPARM
          MEND
SMFSPLIT CSECT
         USING SMFSPLIT,R12          DECLARE ENTRY BASE
         USING DDTDSCT,R9            DD TABLE DSECT BASE
         USING RECTDSCT,R8           RECORD TABLE DSECT BASE
         STM   R14,R12,12(R13)       STORE CALLERS REGISTERS
         LR    R12,R15               LOAD BASE REGISTER
         LR    R15,R13               SAVE CALLERS SAVEAREA ADDR
         LA    R13,SAVE              LOAD ADDRESS OF MY SAVE AREA
         ST    R15,4(,R13)           CHAIN CALLERS TO MINE
         ST    R13,8(,R15)           CHAIN MINE TO CALLERS
         USING SAVE,R13              DEFINE 2ND BASE REGISTER
         SPACE
*---------------------------------------------------------------------*
*                                                                     *
*---------------------------------------------------------------------*
INIT0000 DS    0H
         OPEN  (SYSUT1,INPUT)        OPEN SMF INPUT FILE
         OPEN  (SYSIN,INPUT)         OPEN CONTROL STATEMENT FILE
         OPEN  (PRINTER,OUTPUT)      OPEN PRINT OUTPUT FILE
         OPEN  (DEFAULT,OUTPUT)      OPEN DEFAULT OUTPUT FILE
         MVC   HEADING,CNTLHEAD      MOVE 'CONTROL CARD' HEADING
         BAL   R10,HEADINGS          PRINT HEADING
INIT0010 DS    0H
         GET   SYSIN,CARDAREA        READ CONTROL CARD
         MVI   PLINE,C'0'            DOUBLE SPACE
         MVC   PAREA(L'CARDAREA),CARDAREA
         BAL   R10,PRT0000           PRINT CARD IMAGE
         CLI   CNTLTYPE,C'*'         COMMENT CARD??
         BE    INIT0010              YES
         CLC   CNTLTYPE,DDTYPE       DD DEFINITION??
         BE    DD0000                YES
         CLC   CNTLTYPE,RTYPTYPE     RECORD TYPE DEFINITION??
         BE    RTYPE000              YES
         MVC   PLINE(L'MSG01),MSG01  MOVE ERROR MESSAGE
         BAL   R10,PRT0000           PRINT ERROR MESSAGE
         B     INIT0010              GIVE 'EM ANOTHER TRY
         EJECT
*---------------------------------------------------------------------*
*                                                                     *
*           PROCESS DD DEFINITION                                     *
*                                                                     *
*---------------------------------------------------------------------*
DD0000   DS    0H
         CLC   CNTLFLD1,BLANKS       NAME OMITTED??
         BE    DD0030                YES
         L     R9,ADDTBLE            FIRST DD
DD0010   DS    0H
         OC    DDTDDN,DDTDDN         END OF TABLE??
         BZ    DD0020                YES
         CLC   DDTDDN,CNTLFLD1       DUPLICATE DD DEFINITION??
         BE    DD0040                YES
         LA    R9,DDTLEN(R9)         NEXT DD
         B     DD0010                LOOP
DD0020   DS    0H
         MVC   DDTDDN,CNTLFLD1       SAVE DDNAME
         MVC   DDTDCB,MODELDCB       MOVE 'MODEL' DCB
         LA    R2,DDTDCB             DCB ADDRESS
         USING IHADCB,R2             DEFINE DSECT BASE
         MVC   DCBDDNAM,CNTLFLD1     INSERT DDNAME INTO DCB
         OPEN  ((R2),OUTPUT)         OPEN THE DCB
         B     INIT0010              READ NEXT CONTROL STATEMENT
DD0030   DS    0H
         MVC   PLINE(L'MSG02),MSG02  DD NAME MISSING ON DD STATEMENT
         BAL   R10,PRT0000           PRINT MESSAGE
         B     INIT0010              READ NEXT CONTROL STATEMENT
DD0040   DS    0H
         MVC   PLINE(L'MSG03),MSG03  DUPLICATE DD DEFINITION
         BAL   R10,PRT0000           PRINT MESSAGE
         B     INIT0010              READ NEXT CONTROL STATEMENT
         EJECT
*---------------------------------------------------------------------*
*                                                                     *
*           PROCESS RECORD TYPE DEFINITION                            *
*                                                                     *
*---------------------------------------------------------------------*
RTYPE000 DS    0H
         L     R8,ARECTBLE           FIRST RECORD TYPE IN TABLE
         CLC   CNTLFLD1,BLANKS       RECORD TYPE OMITTED??
         BE    RTYPE080              YES
         LA    R1,CNTLFLD1           RECORD TYPE ID
         LA    R2,3                  NUMBER OF DIGITS
RTYPE010 DS    0H
         CLI   0(R1),C'0'            INVALID DIGIT??
         BL    RTYPE090              YES
         CLI   0(R1),C'9'            INVALID DIGIT??
         BH    RTYPE090              YES
         LA    R1,1(R1)              NEXT DIGIT
         BCT   R2,RTYPE010           CHECK IT
         PACK  DWORD,CNTLFLD1(3)     PACK RECORD TYPE
         CVB   R1,DWORD              CONVERT TO BINARY
         CH    R1,H255               VALID RECORD TYPE??
         BH    RTYPE100              NO
         CLC   CNTLFLD3,BLANKS       DDNAME OMITTED??
         BE    RTYPE110              YES
RTYPE020 DS    0H
         CLI   RECTDEC,X'00'         END OF TABLE??
         BE    RTYPE030              YES
         CLC   RECTDEC,CNTLFLD1      DUPLICATE DEFINITION??
         BE    RTYPE120              YES
         LA    R8,RECTLEN(R8)        NEXT RECORD TYPE
         B     RTYPE020              LOOP
RTYPE030 DS    0H
         LA    R2,CNTLFLD3           FIRST DDNAME
         LA    R3,RECTDD             FIRST DD BLOCK ADDRESS
         LA    R4,5                  MAXIMUM DDNAME REFERENCES
RTYPE040 DS    0H
         CLC   0(8,R2),BLANKS        END OF DDNAME REFERENCES??
         BE    RTYPE070              YES
         L     R9,ADDTBLE            FIRST DD
RTYPE050 DS    0H
         OC    DDTDDN,DDTDDN         END OF TABLE??
         BZ    RTYPE130              YES .. INVALID DD REFERENCE
         CLC   DDTDDN,0(R2)          DD LOCATED??
         BE    RTYPE060              YES
         LA    R9,DDTLEN(R9)         NEXT DD
         B     RTYPE050              LOOP
RTYPE060 DS    0H
         ST    R9,0(R3)              DD BLOCK ADDRESS
         LA    R2,10(R2)             NEXT DDNAME
         LA    R3,8(R3)              NEXT DD BLOCK ADDRESS
         BCT   R4,RTYPE040           LOCATE DD BLOCK
RTYPE070 DS    0H
         STC   R1,RECTID             RECORD ID IN BINARY
         UNPK  RECTHEX(3),RECTID(2)  UNPACK RECORD ID
         NC    RECTHEX,HEX0F0F       TURN OFF ZONES
         TR    RECTHEX,HEXCHAR       CONVERT TO PRINTABLE
         MVC   RECTDEC,CNTLFLD1      MOVE DECIMAL RECORD NUMBER
         MH    R1,H45                LENGTH OF DESCRIPTIONS
         A     R1,ADSCTBLE           PLUS BASE ADDRESS
         MVC   RECTDESC,0(R1)        RECORD TYPE DESCRIPTION
         CLC   CNTLFLD2,BLANKS       PROCESSING ROUTINE??
         BE    INIT0010              NO
         LOAD  EPLOC=CNTLFLD2        LOAD THE PROCESSING ROUTINE
         LTR   R15,R15               LOAD SUCCESSFUL??
         BNZ   RTYPE140              NO
         ST    R0,RECTRTN            PROCESSING ROUTINE ADDRESS
         B     INIT0010              READ NEXT CONTROL RECORD
RTYPE080 DS    0H
         MVC   PLINE(L'MSG04),MSG04  RECORD ID OMITTED
         B     RTYPE150              SET RETURN CODE AND PRINT
RTYPE090 DS    0H
         MVC   PLINE(L'MSG05),MSG05  INVALID DIGIT IN RECORD ID
         B     RTYPE150              SET RETURN CODE AND PRINT
RTYPE100 DS    0H
         MVC   PLINE(L'MSG06),MSG06  RECORD ID > 255
         B     RTYPE150              SET RETURN CODE AND PRINT
RTYPE110 DS    0H
         MVC   PLINE(L'MSG07),MSG07  DD-NAME OMITTED ON RECORD DEF
         B     RTYPE150              SET RETURN CODE AND PRINT
RTYPE120 DS    0H
         MVC   PLINE(L'MSG08),MSG08  DUP RECORD TYPE DEFINITION
         B     RTYPE150              SET RETURN CODE AND PRINT
RTYPE130 DS    0H
         MVC   PLINE(L'MSG09),MSG09  INVALID DDNAME REFERENCE
         B     RTYPE150              SET RETURN CODE AND PRINT
RTYPE140 DS    0H
         ST    R15,DWORD             RETURN CODE FROM LOAD
         UNPK  MSG10CD(3),DWORD+6(2) UNPACK RETURN CODE
         MVI   MSG10CD+2,C' '        INSERT BLANK
         NC    MSG10CD,HEX0F0F       NULLIFY ZONES
         TR    MSG10CD,HEXCHAR       TRANSLATE TO PRINTABLE
         MVC   PLINE(MSG10L),MSG10   PROCESSING ROUTINE LOAD FAILURE
RTYPE150 DS    0H
         MVI   RC,8                  SET RETURN CODE
         BAL   R10,PRT0000           PRINT MESSAGE
         B     INIT0010              READ NEXT CONTROL STATEMENT
         EJECT
*---------------------------------------------------------------------*
*                                                                     *
*           PROCESS SMF FILE                                          *
*                                                                     *
*---------------------------------------------------------------------*
PROC0000 DS    0H
         GET   SYSUT1,SMFREC         READ A RECORD
         AP    TOTREC,P1             ADD 1 TO TOTAL RECORDS READ
         LA    R2,SMFREC             INPUT RECORD
         L     R8,ARECTBLE           RECORD TYPE TABLE
PROC0010 DS    0H
         CLI   RECTDEC,X'00'         END OF TABLE??
         BE    PROC0060              YES
         CLC   RECTID,SMFRTY         CORRECT RECORD TYPE??
         BE    PROC0020              YES
         LA    R8,RECTLEN(R8)        NEXT TYPE BLOCK
         B     PROC0010              TRY AGAIN
PROC0020 DS    0H
         OI    RECTFLAG,$FOUND       INDICATE A RECORD OF TYPE FOUND
         L     R1,RECTCNT            TOTAL RECORD COUNT
         LA    R1,1(R1)              ADD 1 TO COUNT
         ST    R1,RECTCNT            SAVE COUNT
         LA    R7,RECTDD             FIRST DD FOR THIS TYPE
         OC    RECTRTN,RECTRTN       ANY PROCESSING ROUTINE??
         BZ    PROC0030              NO
         XC    EXITPARM(EXITPL),EXITPARM   CLEAR PARMS
         LA    R1,SMFREC                   INPUT DATA ADDRESS
         ST    R1,EXITRECA                 INSERT INTO PARM AREA
         MVC   EXITF1(EXITPL-4),RECTDD     DD/IO AREA ADDRESSES
         OI    EXITIOA5,X'80'              END OF PARM CHAIN
         LA    R1,EXITPARM                 PARM LIST ADDRESS
         L     R15,RECTRTN                 EXTERNAL ROUTINE ADDRESS
         BALR  R14,R15                     INVOKE EXTERNAL ROUTINE
         LA    R7,EXITF1             FIRST DD/IO ADDRESS
PROC0030 DS    0H
         LA    R4,5                  MAXIMUM DD'S
PROC0040 DS    0H
         ICM   R9,15,0(R7)           DD BLOCK ADDRESS
         BZ    PROC0000              END OF DD/IO AREAS
         L     R1,DDTCNT             NUMBER OF RECORDS WRITTEN
         LA    R1,1(R1)              ADD 1
         ST    R1,DDTCNT             SAVE TOTAL
         LA    R2,DDTDCB             DCB WITHIN DD BLOCK
         ICM   R3,15,4(R7)           I/O AREA ADDRESS PRESENT??
         BNZ   PROC0050              YES... NEW I/O AREA
         LA    R3,SMFREC             USE ORIGINAL I/O AREA
PROC0050 DS    0H
         PUT   (R2),(R3)             WRITE OUTPUT RECORD
         LA    R7,8(R7)              NEXT DD/IO AREA
         BCT   R4,PROC0040           PROCESS ALL DD'S
         B     PROC0000              ALL DD'S PROCESSED
PROC0060 DS    0H
         PUT   DEFAULT,SMFREC        WRITE THE RECORD TO DEFAULT
         L     R1,DEFCNT             DEFAULT COUNT
         LA    R1,1(R1)              ADD 1
         ST    R1,DEFCNT             SAVE DEFAULT COUNT
         B     PROC0000              READ NEXT TAPE RECORD
         EJECT
*---------------------------------------------------------------------*
*                                                                     *
*           PRINT RECORD TYPE AND DD STATISTICS                       *
*                                                                     *
*---------------------------------------------------------------------*
STAT0000 DS    0H
         MVC   HEADING,RECHEAD1      MOVE RECORD TYPE STATISTICS
         BAL   R10,HEADINGS          PRINT HEADING
         MVC   PLINE,RECHEAD2        MOVE SECONDARY HEADING
         BAL   R10,PRT0000           PRINT SECONDARY HEADING
         L     R8,ARECTBLE           FIRST RECORD TYPE
STAT0010 DS    0H
         CLI   RECTDEC,X'00'         END OF TYPES??
         BE    STAT0020              YES
         MVC   PRRDEC,RECTDEC        MOVE RECORD TYPE (DECIMAL)
         MVC   PRRHEX,RECTHEX        MOVE RECORD TYPE (HEX)
         MVC   PRRDESC,RECTDESC      MOVE RECORD TYPE DESCRIPTION
         L     R1,RECTCNT            NUMBER OF RECORDS
         CVD   R1,DWORD              CONVERT TO DECIMAL
         MVC   PRRCNT,EDWORD         MOVE EDIT WORD
         ED    PRRCNT,DWORD+4        EDIT NUMBER OF RECORDS
         MVC   PAREA(RECSTATL),RECSTAT    MOVE DATA
         MVI   PLINE,C'0'            DOUBLE SPACE
         BAL   R10,PRT0000           PRINT STATISTICS
         LA    R8,RECTLEN(R8)        NEXT RECORD TYPE
         B     STAT0010              CONTINUE RECORD TYPE STATISTICS
STAT0020 DS    0H
         L     R9,ADDTBLE            FIRST DD
         MVC   HEADING,DDHEAD1       MOVE DD STATISTICS HEADING
         BAL   R10,HEADINGS          PRINT HEADING
         MVC   PLINE,DDHEAD2         MOVE SECONDARY HEADING
         BAL   R10,PRT0000           PRINT SECONDARY HEADING
STAT0030 DS    0H
         OC    DDTDDN,DDTDDN         END OF DD'S??
         BZ    STAT0040              YES
         MVC   PRDDN,DDTDDN          DDNAME
         L     R1,DDTCNT             RECORDS WRITTEN TO DD
         CVD   R1,DWORD              CONVERT TO DECIMAL
         MVC   PRDCNT,EDWORD         MOVE EDIT WORD
         ED    PRDCNT,DWORD+4        EDIT NUMBER OF RECORDS
         MVC   PAREA(DDSTATL),DDSTAT      MOVE STATISTICS
         MVI   PLINE,C'0'            DOUBLE SPACE
         BAL   R10,PRT0000           PRINT STATISTICS
         LA    R2,DDTDCB             DCB WITHIN DD BLOCK
         CLOSE ((R2))                CLOSE THE DCB
         LA    R9,DDTLEN(R9)         NEXT DD
         B     STAT0030              CONTINUE DD STATISTICS
STAT0040 DS    0H
         MVC   PRDDN,=CL8'DEFAULT'   DEFAULT DD
         L     R1,DEFCNT             RECORDS WRITTEN TO DEFAULT DD
         CVD   R1,DWORD              CONVERT TO DECIMAL
         MVC   PRDCNT,EDWORD         MOVE EDIT WORD
         ED    PRDCNT,DWORD+4        EDIT NUMBER OF RECORDS
         MVC   PAREA(DDSTATL),DDSTAT      MOVE STATISTICS
         MVI   PLINE,C'0'            DOUBLE SPACE
         BAL   R10,PRT0000           PRINT STATISTICS
         B     EXIT0000              ALL DONE
         EJECT
*---------------------------------------------------------------------*
*                                                                     *
*           PRINTING/HEADINGS                                         *
*                                                                     *
*---------------------------------------------------------------------*
PRT0000  DS    0H
         PUT   PRINTER,PLINE         WRITE PRINT LINE
         AP    LINECT,P1             ADD 1 TO LINE COUNT
         CLI   PLINE,C' '            SINGLE SPACE??
         BE    PRT0010               YES
         AP    LINECT,P1             ADD 1 TO LINE COUNT
PRT0010  DS    0H
         MVC   PLINE,PLINE-1         CLEAR PRINT LINE
         CP    LINECT,P65            PAGE FULL??
         BLR   R10                   NO
HEADINGS DS    0H
         PUT   PRINTER,HEADING       PRINT HEADING
         ZAP   LINECT,P1             RESET LINE COUNT
         BR    R10                   RETURN
         SPACE 2
*---------------------------------------------------------------------*
*                                                                     *
*           END OF JOB                                                *
*                                                                     *
*---------------------------------------------------------------------*
EXIT0000 DS    0H
         CLOSE SYSUT1                INPUT SMF FILE
         CLOSE SYSIN                 CONTROL FILE
         CLOSE DEFAULT               CLOSE DEFAULT OUTPUT FILE
         CLOSE PRINTER               CLOSE PRINT FILE
         SR    R15,R15               CLEAR FOR RC
         IC    R15,RC                SET RC
         L     R13,SAVE+4            RE-LOAD SAVE AREA POINTER
         L     R14,12(R13)           RESTORE R14
         LM    R0,R12,20(R13)        R0-R12
         BR    R14                   TERMINATE
         EJECT
*---------------------------------------------------------------------*
*                      DATA AREAS                                     *
*---------------------------------------------------------------------*
         LTORG
DWORD    DC    D'0'                  DOUBLEWORD WORK AREA
ADDTBLE  DC    A(DDTBLE)             DD TABLE ADDRESS
ARECTBLE DC    A(RECTBLE)            RECORD TYPE TABLE ADDRESS
ADSCTBLE DC    A(DSCTBLE)            RECORD DESCRIPTION TABLE
         SMFBLOK BLOCK=PARM,TYPE=CSECT
DEFCNT   DC    F'0'                  RECORDS WRITTEN TO DEFAULT FILE
H45      DC    H'45'                 CONSTANT
H255     DC    H'255'                CONSTANT
P0       DC    P'0'                  CONSTANT
P1       DC    P'1'                  CONSTANT
P65      DC    P'65'                 CONSTANT
TOTREC   DC    PL4'0'                TOTAL INPUT RECORDS
LINECT   DC    PL3'0'                PRINTER LINE COUNT
RC       DC    X'00'                 EXIT RETURN CODE
HEX0F0F  DC    X'0F0F0F0F'           CONSTANT
HEXCHAR  DC    C'0123456789ABCDEF'   CONSTANT
EDWORD   DC    X'40206B2020206B202120'
         DC    C' '
PLINE    DS    0CL121
         DC    C' '
PAREA    DC    CL120' '
CNTLHEAD DC    CL121'1   CONTROL STATEMENTS'
RECHEAD1 DC    CL121'1   RECORD TYPE STATISTICS'
RECHEAD2 DC    CL121' DEC  HEX     RECORDS  DESCRIPTION'
DDHEAD1  DC    CL121'1   OUTPUT FILE STATISTICS'
DDHEAD2  DC    CL121' DDNAME      RECORDS'
HEADING  DC    CL121' '
RECSTAT  DS    0C
PRRDEC   DC    CL3' '                RECORD TYPE IN CHARACTER
         DC    CL3' '
PRRHEX   DC    CL2' '                RECORD TYPE IN HEX
         DC    CL2' '
PRRCNT   DC    CL10' '               NUMBER OF RECORDS
         DC    CL2' '
PRRDESC  DC    CL45' '               RECORD TYPE DESCRIPTION
RECSTATL EQU   *-RECSTAT
DDSTAT   DS    0C
PRDDN    DC    CL8' '                OUTPUT DDNAME
         DC    CL2' '
PRDCNT   DC    CL10' '               NUMBER OF RECORDS
DDSTATL  EQU   *-DDSTAT
CARDAREA DS    0CL80
CNTLTYPE DS    CL8                   STATEMENT TYPE
         DS    CL1
CNTLFLD1 DS    CL10                  FIELD 1 COLUMNS 10-19
CNTLFLD2 DS    CL10                  FIELD 2 COLUMNS 20-29
CNTLFLD3 DS    CL10                  FIELD 3 COLUMNS 30-39
CNTLFLD4 DS    CL10                  FIELD 4 COLUMNS 40-49
CNTLFLD5 DS    CL10                  FIELD 5 COLUMNS 50-59
CNTLFLD6 DS    CL10                  FIELD 6 COLUMNS 60-69
CNTLFLD7 DS    CL10                  FIELD 7 COLUMNS 70-79
         DS    C
DDTYPE   DC    CL8'DD'
RTYPTYPE DC    CL8'RECORD'
BLANKS   DC    CL80' '
MSG01    DC    C' Invalid control statement'
MSG02    DC    C' DDNAME omitted on ''DD'' statement'
MSG03    DC    C' Duplicate ''DD'' definition'
MSG04    DC    C' SMF ID number omitted on ''RECORD'' statement'
MSG05    DC    C' Invalid digit in SMF ID number'
MSG06    DC    C' SMF ID number invalid (must be < 256)'
MSG07    DC    C' DD omitted on ''RECORD'' statement'
MSG08    DC    C' Duplicate ''RECORD'' definition'
MSG09    DC    C' Invalid DD reference on ''RECORD'' statement'
MSG10    DS    0C
         DC    C'LOAD failed for user exit, RC='
MSG10CD  DC    CL2' '
MSG10L   EQU   *-MSG10
MODELDCB DCB   DSORG=PS,                                               +
               DDNAME=MODEL,                                           +
               RECFM=VB,                                               +
               MACRF=PM
SYSIN    DCB   DSORG=PS,                                               +
               DDNAME=SYSIN,                                           +
               RECFM=FB,                                               +
               EODAD=PROC0000,                                         +
               MACRF=GM
SYSUT1   DCB   DSORG=PS,                                               +
               DDNAME=SYSUT1,                                          +
               RECFM=VBS,                                              +
               EODAD=STAT0000,                                         +
               MACRF=GM
PRINTER  DCB   DSORG=PS,                                               +
               RECFM=FBA,                                              +
               LRECL=121,                                              +
               DDNAME=PRINTER,                                         +
               MACRF=PM
DEFAULT  DCB   DSORG=PS,                                               +
               DDNAME=DEFAULT,                                         +
               MACRF=PM
         PRINT GEN
SAVE     DC    18F'0'                REGISTER SAVE AREA
*---------------------------------------------------------------------*
*                          SMF RECORD DSECT                           *
*---------------------------------------------------------------------*
SMFREC   DS    0C
SMFLEN   DS    HL2                   LENGTH OF RECORD
SMFSEG   DS    HL2                   SEGMENT DESCRIPTOR
SMFFLG   DS    X                     SMF SYSTEM FLAG
SMF@VS2  EQU   X'02'                 VS/2 SYSTEM
SMF@VS1  EQU   X'01'                 VS/1 SYSTEM
SMFRTY   DS    X                     RECORD TYPE
SMFTME   DS    FL4                   TIME WRITTEN
SMFDTE   DS    PL4                   DATE WRITTEN
SMFSID   DS    CL4                   SYSTEM IDENTIFICATION
         DS    CL32800
DDTBLE   DC    (50*DDTLEN)X'00'      GENERATE DD TABLE STORAGE
RECTBLE  DC    (50*RECTLEN)X'00'     GENERATE RECORD TABLE STORAGE
DSCTBLE  DS    0C
         DC    CL45'IPL RECORD                                   ' 00
         DC    CL45'                                             ' 01
         DC    CL45'DUMP HEADER                                  ' 02
         DC    CL45'DUMP TRAILER                                 ' 03
         DC    CL45'STEP TERMINATION                             ' 04
         DC    CL45'JOB TERMINATION                              ' 05
         DC    CL45'JES2 OUTPUT WRITER/EXTERNAL WRITER/PSF       ' 06
         DC    CL45'DATA LOST                                    ' 07
         DC    CL45'I/O CONFIGURATION                            ' 08
         DC    CL45'VARY DEVICE ONLINE                           ' 09
         DC    CL45'ALLOCATION RECOVERY                          ' 0A
         DC    CL45'VARY DEVICE OFFLINE                          ' 0B
         DC    CL45'                                             ' 0C
         DC    CL45'                                             ' 0D
         DC    CL45'INPUT/RDBACK DATASET ACTIVITY                ' 0E
         DC    CL45'OUTPUT/UPDATE/INOUT/OUTIN DATASET ACTIVITY   ' 0F
         DC    CL45'SORT/MERGE STATISTICS                        ' 10
         DC    CL45'SCRATCH DATASET STATUS                       ' 11
         DC    CL45'RENAME DATASET STATUS                        ' 12
         DC    CL45'DIRECT ACCESS VOLUME                         ' 13
         DC    CL45'JOB INITIATION                               ' 14
         DC    CL45'ERROR STATISTICS BY VOLUME                   ' 15
         DC    CL45'CONFIGURATION                                ' 16
         DC    CL45'SMF STATUS RECORD                            ' 17
         DC    CL45'JES2 SPOOL OFFLOAD                           ' 18
         DC    CL45'JES3 DEVICE ALLOCATION                       ' 19
         DC    CL45'JES2 JOB PURGE                               ' 1A
         DC    CL45'JES3 JOB PURGE                               ' 1B
         DC    CL45'                                             ' 1C
         DC    CL45'                                             ' 1D
         DC    CL45'COMMON ADDRESS SPACE WORK RECORD             ' 1E
         DC    CL45'TIOC INITIALIZATION                          ' 1F
         DC    CL45'TSO USER WORK ACCOUNTING RECORD              ' 20
         DC    CL45'                                             ' 21
         DC    CL45'TS-STEP TERMINATION                          ' 22
         DC    CL45'LOGOFF                                       ' 23
         DC    CL45'                                             ' 24
         DC    CL45'NPDA                                         ' 25
         DC    CL45'                                             ' 26
         DC    CL45'NLDM RESPONSE TIME                           ' 27
         DC    CL45'DYNAMIC DD                                   ' 28
         DC    CL45'JES2 START                                   ' 29
         DC    CL45'JES3 START                                   ' 2A
         DC    CL45'JES2 WITHDRAWAL                              ' 2B
         DC    CL45'                                             ' 2C
         DC    CL45'                                             ' 2D
         DC    CL45'                                             ' 2E
         DC    CL45'JES2 SIGNON/START LINE (BSC ONLY)            ' 2F
         DC    CL45'JES2 SIGNOFF/STOP LINE (BSC ONLY)            ' 30
         DC    CL45'JES3 INTEGRITY                               ' 31
         DC    CL45'ACF/VTAM TUNING STATISTICS                   ' 32
         DC    CL45'                                             ' 33
         DC    CL45'JES2 SIGNON/START LINE (SNA ONLY)            ' 34
         DC    CL45'JES2 SIGNOFF/STOP LINE (SNA ONLY)            ' 35
         DC    CL45'JES2 INTEGRITY (SNA ONLY)                    ' 36
         DC    CL45'JES2 NETWORK SIGNON RECORD                   ' 37
         DC    CL45'JES2 NETWORK INTEGRITY RECORD                ' 38
         DC    CL45'JES2 NETWORK SYSOUT TRANSMISSION RECORD      ' 39
         DC    CL45'JES2 NETWORK SIGNOFF RECORD                  ' 3A
         DC    CL45'MVS/BDT FILE-TO-FILE TRANSMISSION RECORD     ' 3B
         DC    CL45'VSAM VOLUME DATASET UPDATED                  ' 3C
         DC    CL45'ICF DEFINE ACTIVITY                          ' 3D
         DC    CL45'VSAM COMPONENT OR CLUSTER OPENED             ' 3E
         DC    CL45'VSAM ENTRY DEFINED                           ' 3F
         DC    CL45'VSAM COMPONENT OR CLUSTER STATUS             ' 40
         DC    CL45'ICF DELETE ACTIVITY                          ' 41
         DC    CL45'ICF ALTER ACTIVITY                           ' 42
         DC    CL45'VSAM ENTRY DELETED                           ' 43
         DC    CL45'VSAM ENTRY RENAMED                           ' 44
         DC    CL45'CPU ACTIVITY                                 ' 45
         DC    CL45'                                             ' 46
         DC    CL45'PAGING ACTIVITY                              ' 47
         DC    CL45'WORKLOAD ACTIVITY                            ' 48
         DC    CL45'CHANNEL PATH ACTIVITY                        ' 49
         DC    CL45'DEVICE ACTIVITY                              ' 4A
         DC    CL45'PAGE/SWAP DATASET ACTIVITY                   ' 4B
         DC    CL45'TRACE ACTIVITY                               ' 4C
         DC    CL45'ENQUE ACTIVITY                               ' 4D
         DC    CL45'MONITOR I ACTIVITY                           ' 4E
         DC    CL45'MONITOR II ACTIVITY                          ' 4F
         DC    CL45'RACF PROCESSING                              ' 50
         DC    CL45'RACF INITIALIZATION                          ' 51
         DC    CL45'SECURITY                                     ' 52
         DC    CL45'                                             ' 53
         DC    CL45'                                             ' 54
         DC    CL45'                                             ' 55
         DC    CL45'                                             ' 56
         DC    CL45'                                             ' 57
         DC    CL45'                                             ' 58
         DC    CL45'                                             ' 59
         DC    CL45'SYSTEM STATUS                                ' 5A
         DC    CL45'                                             ' 5B
         DC    CL45'                                             ' 5C
         DC    CL45'                                             ' 5D
         DC    CL45'                                             ' 5E
         DC    CL45'                                             ' 5F
         DC    CL45'                                             ' 60
         DC    CL45'                                             ' 61
         DC    CL45'                                             ' 62
         DC    CL45'                                             ' 63
         DC    CL45'DB2 STATISTICS                               ' 64
         DC    CL45'DB2 ACCOUNTING                               ' 65
         DC    CL45'DB2 PERFORMANCE                              ' 66
         DC    CL45'                                             ' 67
         DC    CL45'                                             ' 68
         DC    CL45'                                             ' 69
         DC    CL45'                                             ' 6A
         DC    CL45'                                             ' 6B
         DC    CL45'                                             ' 6C
         DC    CL45'                                             ' 6D
         DC    CL45'CICS/VS STATISTICS                           ' 6E
         DC    CL45'                                             ' 6F
         DC    CL45'                                             ' 70
         DC    CL45'                                             ' 71
         DC    CL45'                                             ' 72
         DC    CL45'                                             ' 73
         DC    CL45'                                             ' 74
         DC    CL45'                                             ' 75
         DC    CL45'                                             ' 76
         DC    CL45'                                             ' 77
         DC    CL45'                                             ' 78
         DC    CL45'                                             ' 79
         DC    CL45'                                             ' 7A
         DC    CL45'                                             ' 7B
         DC    CL45'                                             ' 7C
         DC    CL45'                                             ' 7D
         DC    CL45'                                             ' 7E
         DC    CL45'                                             ' 7F
         DC    CL45'                                             ' 80
         DC    CL45'                                             ' 81
         DC    CL45'                                             ' 82
         DC    CL45'                                             ' 83
         DC    CL45'                                             ' 84
         DC    CL45'                                             ' 85
         DC    CL45'                                             ' 86
         DC    CL45'                                             ' 87
         DC    CL45'                                             ' 88
         DC    CL45'                                             ' 89
         DC    CL45'                                             ' 8A
         DC    CL45'                                             ' 8B
         DC    CL45'                                             ' 8C
         DC    CL45'                                             ' 8D
         DC    CL45'                                             ' 8E
         DC    CL45'                                             ' 8F
         DC    CL45'                                             ' 90
         DC    CL45'                                             ' 91
         DC    CL45'                                             ' 92
         DC    CL45'                                             ' 93
         DC    CL45'                                             ' 94
         DC    CL45'                                             ' 95
         DC    CL45'                                             ' 96
         DC    CL45'                                             ' 97
         DC    CL45'                                             ' 98
         DC    CL45'                                             ' 99
         DC    CL45'                                             ' 9A
         DC    CL45'                                             ' 9B
         DC    CL45'                                             ' 9C
         DC    CL45'                                             ' 9D
         DC    CL45'                                             ' 9E
         DC    CL45'                                             ' 9F
         DC    CL45'                                             ' A0
         DC    CL45'                                             ' A1
         DC    CL45'                                             ' A2
         DC    CL45'                                             ' A3
         DC    CL45'                                             ' A4
         DC    CL45'                                             ' A5
         DC    CL45'                                             ' A6
         DC    CL45'                                             ' A7
         DC    CL45'                                             ' A8
         DC    CL45'                                             ' A9
         DC    CL45'                                             ' AA
         DC    CL45'                                             ' AB
         DC    CL45'                                             ' AC
         DC    CL45'                                             ' AD
         DC    CL45'                                             ' AE
         DC    CL45'                                             ' AF
         DC    CL45'                                             ' B0
         DC    CL45'                                             ' B1
         DC    CL45'                                             ' B2
         DC    CL45'                                             ' B3
         DC    CL45'                                             ' B4
         DC    CL45'                                             ' B5
         DC    CL45'                                             ' B6
         DC    CL45'                                             ' B7
         DC    CL45'                                             ' B8
         DC    CL45'                                             ' B9
         DC    CL45'                                             ' BA
         DC    CL45'                                             ' BB
         DC    CL45'                                             ' BC
         DC    CL45'                                             ' BD
         DC    CL45'                                             ' BE
         DC    CL45'                                             ' BF
         DC    CL45'                                             ' C0
         DC    CL45'                                             ' C1
         DC    CL45'                                             ' C2
         DC    CL45'                                             ' C3
         DC    CL45'                                             ' C4
         DC    CL45'                                             ' C5
         DC    CL45'                                             ' C6
         DC    CL45'                                             ' C7
         DC    CL45'                                             ' C8
         DC    CL45'                                             ' C9
         DC    CL45'                                             ' CA
         DC    CL45'                                             ' CB
         DC    CL45'                                             ' CC
         DC    CL45'                                             ' CD
         DC    CL45'                                             ' CE
         DC    CL45'                                             ' CF
         DC    CL45'                                             ' D0
         DC    CL45'                                             ' D1
         DC    CL45'                                             ' D2
         DC    CL45'                                             ' D3
         DC    CL45'                                             ' D4
         DC    CL45'                                             ' D5
         DC    CL45'                                             ' D6
         DC    CL45'                                             ' D7
         DC    CL45'                                             ' D8
         DC    CL45'                                             ' D9
         DC    CL45'                                             ' DA
         DC    CL45'                                             ' DB
         DC    CL45'                                             ' DC
         DC    CL45'                                             ' DD
         DC    CL45'                                             ' DE
         DC    CL45'                                             ' DF
         DC    CL45'                                             ' E0
         DC    CL45'                                             ' E1
         DC    CL45'                                             ' E2
         DC    CL45'                                             ' E3
         DC    CL45'                                             ' E4
         DC    CL45'                                             ' E5
         DC    CL45'                                             ' E6
         DC    CL45'                                             ' E7
         DC    CL45'                                             ' E8
         DC    CL45'                                             ' E9
         DC    CL45'                                             ' EA
         DC    CL45'                                             ' EB
         DC    CL45'                                             ' EC
         DC    CL45'                                             ' ED
         DC    CL45'                                             ' EE
         DC    CL45'                                             ' EF
         DC    CL45'                                             ' F0
         DC    CL45'                                             ' F1
         DC    CL45'                                             ' F2
         DC    CL45'                                             ' F3
         DC    CL45'                                             ' F4
         DC    CL45'                                             ' F5
         DC    CL45'                                             ' F6
         DC    CL45'                                             ' F7
         DC    CL45'                                             ' F8
         DC    CL45'                                             ' F9
         DC    CL45'                                             ' FA
         DC    CL45'                                             ' FB
         DC    CL45'                                             ' FC
         DC    CL45'                                             ' FD
         DC    CL45'                                             ' FE
         DC    CL45'                                             ' FF
         EJECT
*---------------------------------------------------------------------*
*                      DSECTS AND EQUATES                             *
*---------------------------------------------------------------------*
RECTDSCT DSECT
RECTFLAG DS    X                   FLAG BYTE
$FOUND   EQU   X'80'
RECTID   DS    X                   SMF RECORD ID
RECTHEX  DS    CL2                 PRINTABLE RECORD ID IN HEX
RECTDEC  DS    CL3                 PRINTABLE RECORD ID IN CHARACTER
RECTDESC DS    CL45                DESCRIPTION
RECTCNT  DS    F                   NUMBER OF RECORDS OF THIS TYPE
RECTRTN  DS    A                   ADDRESS OF PROCESSING ROUTINE
RECTDCNT DS    H                   NUMBER OF DDS TO WRITE TO
RECTDD   DS    A                   ADDRESS OF DD BLOCK 1
RECTIOA  DS    A                   ADDRESS OF I/O AREA  1
         DS    A                   ADDRESS OF DD BLOCK 2
         DS    A                   ADDRESS OF I/O AREA  2
         DS    A                   ADDRESS OF DD BLOCK 3
         DS    A                   ADDRESS OF I/O AREA  3
         DS    A                   ADDRESS OF DD BLOCK 4
         DS    A                   ADDRESS OF I/O AREA  4
         DS    A                   ADDRESS OF DD BLOCK 5
         DS    A                   ADDRESS OF I/O AREA  5
RECTLEN  EQU   *-RECTDSCT          LENGTH OF ENTRY
         SPACE 2
DDTDSCT  DSECT
DDTDDN   DS    CL8                 DD NAME
DDTCNT   DS    F                   NUMBER OF RECORDS WRITTEN TO DD
DDTDCB   DS    CL96                DCB
DDTLEN   EQU   *-DDTDSCT           LENGTH OF ENTRY
         EJECT
         DCBD  DSORG=PS            GENERATE DCB DSECT
R0       EQU   0                   . R
R1       EQU   1                   .  E
R2       EQU   2                   .   G
R3       EQU   3                   .    I
R4       EQU   4                   .     S
R5       EQU   5                   .      T
R6       EQU   6                   .       E
R7       EQU   7                   .        R
R8       EQU   8                   .
R9       EQU   9                   .          E
R10      EQU   10                  .           Q
R11      EQU   11                  .            U
R12      EQU   12                  .             A
R13      EQU   13                  .              T
R14      EQU   14                  .               E
R15      EQU   15                  .                S
         SPACE 2
         END   SMFSPLIT
