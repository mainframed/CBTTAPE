OPTIONS LINESIZE=80;
TITLE 'SMF 70';
DATA T70 (KEEP = TIMEOUT SMFXXSID
        SMF70SSI          SMF70STY        SMF70TRN
        SMF70RV1          SMF70PRS        SMF70PRL
        SMF70PRN          SMF70CCS        SMF70CCL
        SMF70CCN          SMF70CPS        SMF70CPL
        SMF70CPN          SMF70ASS        SMF70ASL
        SMF70ASN          SMF70BCS        SMF70BCL
        SMF70BCN          SMF70BVS        SMF70BVL
        SMF70BVN
        )
     PRODUCT (KEEP = TIMEOUT
             SMF70MFV          SMF70PRD           SMF70IST
             SMF70DAT          SMF70INT           SMF70MFL
             SMF70SAM          SMF70RV2           SMF70FLA
             SMF70RLS          SMF70CYC           SMF70MVS
             SMF70IML          SMF70PRF           SMF70PTN
             SMF70SRL          SMF70IET
             )
     CCONTROL (KEEP = TIMEOUT
             SMF70MOD          SMF70VER
             SMF70BNP          SMF70INB
             SMF70RVA          SMF70GTS
             )
     CDATA    (KEEP = TIMEOUT
             SMF70WAT          SMF70CID           SMF70CNF
             SMF70RV3          SMF70SER           SMF70RV4
             SMF70SLH          SMF70TPI           CPUBSYPC
             SMF70VFS          SMF70V             SMF70AL1
             )
     ASID     (KEEP = TIMEOUT
         SMF70RMN           SMF70RMM            SMF70RTT
         SMF70R00           SMF70R01            SMF70R02
         SMF70R03           SMF70R04            SMF70R05
         SMF70R06           SMF70R07            SMF70R08
         SMF70R09           SMF70R10            SMF70R11
         SMF70R12           SMF70R13            SMF70R14
         SMF70R15           SMF70IMN            SMF70IMM
         SMF70ITT           SMF70I00            SMF70I01
         SMF70I02           SMF70I03            SMF70I04
         SMF70I05           SMF70I06            SMF70I07
         SMF70I08           SMF70I09            SMF70I10
         SMF70I11           SMF70OMN            SMF70OMM
         SMF70OTT           SMF70O00            SMF70O01
         SMF70O02           SMF70O03            SMF70O04
         SMF70O05           SMF70O06            SMF70O07
         SMF70O08           SMF70O09            SMF70O10
         SMF70O11           SMF70WMN            SMF70WMM
         SMF70WTT           SMF70W00            SMF70W01
         SMF70W02           SMF70W03            SMF70W04
         SMF70W05           SMF70W06            SMF70W07
         SMF70W08           SMF70W09            SMF70W10
         SMF70W11           SMF70BMN            SMF70BMM
         SMF70BTT           SMF70B00            SMF70B01
         SMF70B02           SMF70B03            SMF70B04
         SMF70B05           SMF70B06            SMF70B07
         SMF70B08           SMF70B09            SMF70B10
         SMF70B11           SMF70SMN            SMF70SMM
         SMF70STT           SMF70S00            SMF70S01
         SMF70S02           SMF70S03            SMF70S04
         SMF70S05           SMF70S06            SMF70S07
         SMF70S08           SMF70S09            SMF70S10
         SMF70S11           SMF70TMN            SMF70TMM
         SMF70TTT           SMF70T00            SMF70T01
         SMF70T02           SMF70T03            SMF70T04
         SMF70T05           SMF70T06            SMF70T07
         SMF70T08           SMF70T09            SMF70T10
         SMF70T11           SMF70LMN            SMF70LMM
         SMF70LTT           SMF70L00            SMF70L01
         SMF70L02           SMF70L03            SMF70L04
         SMF70L05           SMF70L06            SMF70L07
         SMF70L08           SMF70L09            SMF70L10
         SMF70L11           SMF70AMN            SMF70AMM
         SMF70ATT           SMF70A00            SMF70A01
         SMF70A02           SMF70A03            SMF70A04
         SMF70A05           SMF70A06            SMF70A07
         SMF70A08           SMF70A09            SMF70A10
         SMF70A11           SMF70PMN            SMF70PMM
         SMF70PTT           SMF70P00            SMF70P01
         SMF70P02           SMF70P03            SMF70P04
         SMF70P05           SMF70P06            SMF70P07
         SMF70P08           SMF70P09            SMF70P10
         SMF70P11
             )
     PRSM     (KEEP = TIMEOUT
             SMF70LPM          SMF70LPN           SMF70PFG
             SMF70BDN          SMF70BDS
             )
     LOGP     (KEEP = TIMEOUT
             SMF70PDT          SMF70VPA           SMF70BPS
             SMF70VPF          SMF70RVX           SMF70EDT
                               SMF70RVY
             )
          ;
  RETAIN V;
  INFILE DATLIB JFCB=JF MISSOVER;
  IF _N_ = 1 THEN DO;
                  INPUT @;
                  IF INDEX(JF,'SYS1.MAN') ¬=0 THEN V=4; ELSE V=0;
                  END;
  IF V=4 THEN
      INPUT    SMFXXLEN PIB2. SMFXXSEG PIB2. @ ;
  INPUT    SMFXXFLG PIB1. SMFXXRTY PIB1.
                       @;
  IF SMFXXRTY = 212 THEN DO;
                        *PUT '212 DETECTED - SKIPPING';
                         DELETE;
                         END;
  IF SMFXXRTY = 70;
  INPUT    TIMEOUT SMFSTAMP8.
      SMFXXSID $CHAR4. @;
  INPUT SMF70SSI $CHAR4.  SMF70STY PIB2.  SMF70TRN PIB2.
        SMF70RV1 PIB2.    SMF70PRS PIB4.  SMF70PRL PIB2.
        SMF70PRN PIB2.    SMF70CCS PIB4.  SMF70CCL PIB2.
        SMF70CCN PIB2.    SMF70CPS PIB4.  SMF70CPL PIB2.
        SMF70CPN PIB2.    SMF70ASS PIB4.  SMF70ASL PIB2.
        SMF70ASN PIB2.    SMF70BCS PIB4.  SMF70BCL PIB2.
        SMF70BCN PIB2.    SMF70BVS PIB4.  SMF70BVL PIB2.
        SMF70BVN PIB2.
        @ ;
  OUTPUT T70;
  DO I=1 TO SMF70PRN;
  OFF = V -3 + SMF70PRS + (I-1)*SMF70PRL;
  INPUT @OFF SMF70MFV $CHAR2.  SMF70PRD $CHAR8.   SMF70IST PD4.
             SMF70DAT PD4.     SMF70INT RMFDUR.   SMF70MFL PIB2.
             SMF70SAM PIB4.    SMF70RV2 PIB2.     SMF70FLA PIB2.
             SMF70RLS $CHAR4.  SMF70CYC PD4.      SMF70MVS $CHAR8.
             SMF70IML PIB1.    SMF70PRF PIB1.     SMF70PTN PIB1.
             SMF70SRL PIB1.    SMF70IET $CHAR8.
  @;
  OUTPUT PRODUCT;
  END;
  DO I=1 TO SMF70CCN;
  OFF = V -3 + SMF70CCS + (I-1)*SMF70CCL;
  INPUT @OFF SMF70MOD PIB2.    SMF70VER PIB1.
             SMF70BNP PIB1.    SMF70INB PIB1.
             SMF70RVA PIB1.    SMF70GTS PIB2.
  @;
  OUTPUT CCONTROL;
  END;
  DO I=1 TO SMF70CPN;
  OFF = V -3 + SMF70CPS + (I-1)*SMF70CPL;
  INPUT @OFF SMF70WAT PIB8.    SMF70CID PIB2.     SMF70CNF PIB1.
             SMF70RV3 PIB1.    SMF70SER PIB3.     SMF70RV4 PIB1.
             SMF70SLH PIB4.    SMF70TPI PIB4.
             SMF70VFS PIB4.    SMF70V   PIB1.     SMF70AL1 PIB1.
  @;
  CPUBSYPC = 100 * (1 - ((SMF70WAT/4096E6) / SMF70INT) );
  OUTPUT CDATA;
  END;
  DO I=1 TO SMF70ASN;
  OFF = V -3 + SMF70ASS + (I-1)*SMF70ASL;
  INPUT @OFF
         SMF70RMN PIB2.     SMF70RMM PIB2.      SMF70RTT PIB4.
         SMF70R00 PIB4.     SMF70R01 PIB4.      SMF70R02 PIB4.
         SMF70R03 PIB4.     SMF70R04 PIB4.      SMF70R05 PIB4.
         SMF70R06 PIB4.     SMF70R07 PIB4.      SMF70R08 PIB4.
         SMF70R09 PIB4.     SMF70R10 PIB4.      SMF70R11 PIB4.
         SMF70R12 PIB4.     SMF70R13 PIB4.      SMF70R14 PIB4.
         SMF70R15 PIB4.     SMF70IMN PIB2.      SMF70IMM PIB2.
         SMF70ITT PIB4.     SMF70I00 PIB4.      SMF70I01 PIB4.
         SMF70I02 PIB4.     SMF70I03 PIB4.      SMF70I04 PIB4.
         SMF70I05 PIB4.     SMF70I06 PIB4.      SMF70I07 PIB4.
         SMF70I08 PIB4.     SMF70I09 PIB4.      SMF70I10 PIB4.
         SMF70I11 PIB4.     SMF70OMN PIB2.      SMF70OMM PIB2.
         SMF70OTT PIB4.     SMF70O00 PIB4.      SMF70O01 PIB4.
         SMF70O02 PIB4.     SMF70O03 PIB4.      SMF70O04 PIB4.
         SMF70O05 PIB4.     SMF70O06 PIB4.      SMF70O07 PIB4.
         SMF70O08 PIB4.     SMF70O09 PIB4.      SMF70O10 PIB4.
         SMF70O11 PIB4.     SMF70WMN PIB2.      SMF70WMM PIB2.
         SMF70WTT PIB4.     SMF70W00 PIB4.      SMF70W01 PIB4.
         SMF70W02 PIB4.     SMF70W03 PIB4.      SMF70W04 PIB4.
         SMF70W05 PIB4.     SMF70W06 PIB4.      SMF70W07 PIB4.
         SMF70W08 PIB4.     SMF70W09 PIB4.      SMF70W10 PIB4.
         SMF70W11 PIB4.     SMF70BMN PIB2.      SMF70BMM PIB2.
         SMF70BTT PIB4.     SMF70B00 PIB4.      SMF70B01 PIB4.
         SMF70B02 PIB4.     SMF70B03 PIB4.      SMF70B04 PIB4.
         SMF70B05 PIB4.     SMF70B06 PIB4.      SMF70B07 PIB4.
         SMF70B08 PIB4.     SMF70B09 PIB4.      SMF70B10 PIB4.
         SMF70B11 PIB4.     SMF70SMN PIB2.      SMF70SMM PIB2.
         SMF70STT PIB4.     SMF70S00 PIB4.      SMF70S01 PIB4.
         SMF70S02 PIB4.     SMF70S03 PIB4.      SMF70S04 PIB4.
         SMF70S05 PIB4.     SMF70S06 PIB4.      SMF70S07 PIB4.
         SMF70S08 PIB4.     SMF70S09 PIB4.      SMF70S10 PIB4.
         SMF70S11 PIB4.     SMF70TMN PIB2.      SMF70TMM PIB2.
         SMF70TTT PIB4.     SMF70T00 PIB4.      SMF70T01 PIB4.
         SMF70T02 PIB4.     SMF70T03 PIB4.      SMF70T04 PIB4.
         SMF70T05 PIB4.     SMF70T06 PIB4.      SMF70T07 PIB4.
         SMF70T08 PIB4.     SMF70T09 PIB4.      SMF70T10 PIB4.
         SMF70T11 PIB4.     SMF70LMN PIB2.      SMF70LMM PIB2.
         SMF70LTT PIB4.     SMF70L00 PIB4.      SMF70L01 PIB4.
         SMF70L02 PIB4.     SMF70L03 PIB4.      SMF70L04 PIB4.
         SMF70L05 PIB4.     SMF70L06 PIB4.      SMF70L07 PIB4.
         SMF70L08 PIB4.     SMF70L09 PIB4.      SMF70L10 PIB4.
         SMF70L11 PIB4.     SMF70AMN PIB2.      SMF70AMM PIB2.
         SMF70ATT PIB4.     SMF70A00 PIB2.      SMF70A01 PIB2.
         SMF70A02 PIB4.     SMF70A03 PIB4.      SMF70A04 PIB4.
         SMF70A05 PIB4.     SMF70A06 PIB4.      SMF70A07 PIB4.
         SMF70A08 PIB4.     SMF70A09 PIB4.      SMF70A10 PIB4.
         SMF70A11 PIB4.     SMF70PMN PIB2.      SMF70PMM PIB2.
         SMF70PTT PIB4.     SMF70P00 PIB2.      SMF70P01 PIB2.
         SMF70P02 PIB4.     SMF70P03 PIB4.      SMF70P04 PIB4.
         SMF70P05 PIB4.     SMF70P06 PIB4.      SMF70P07 PIB4.
         SMF70P08 PIB4.     SMF70P09 PIB4.      SMF70P10 PIB4.
         SMF70P11 PIB4.
  @;
  OUTPUT ASID;
  END;
  *;
  DO I=1 TO SMF70BCN;
  OFF = V -3 + SMF70BCS + (I-1)*SMF70BCL;
  INPUT @OFF SMF70LPM $CHAR8.  SMF70LPN PIB1.     SMF70PFG PIB1.
             SMF70BDN PIB2.    SMF70BDS PIB4.
  @;
  OUTPUT PRSM;
  END;
  *;
  DO I=1 TO SMF70BVN;
  OFF = V -3 + SMF70BVS + (I-1)*SMF70BVL;
  INPUT @OFF SMF70PDT PIB8.    SMF70VPA PIB2.     SMF70BPS PIB2.
             SMF70VPF PIB1.    SMF70RVX PIB3.     SMF70EDT PIB8.
                               SMF70RVY PIB8.
  @;
  OUTPUT LOGP;
  END;
RETURN;
*ROC PRINT DATA=T70;
FORMAT TIMEOUT DATETIME.;
*ROC PRINT DATA=PRODUCT;
FORMAT TIMEOUT DATETIME.;
FORMAT SMF70INT TIME.;
*ROC PRINT DATA=CCONTROL;
FORMAT TIMEOUT DATETIME.;
FORMAT SMF70MOD HEX4.;
*ROC PRINT DATA=CDATA;
FORMAT TIMEOUT DATETIME.;
FORMAT SMF70SER HEX6.;
*ROC PRINT DATA=ASID;
*ORMAT TIMEOUT DATETIME.;
*ROC PRINT DATA=PRSM;
FORMAT TIMEOUT DATETIME.;
*ROC PRINT DATA=LOGP;
FORMAT TIMEOUT DATETIME.;
*;
DATA PRSM_S (KEEP = TOUT SMF70BDN SMF70LPM SEQ);
SET PRSM;
IF SMF70PFG = 0;
IF UPCASE(SMF70LPM) = 'INACTIVE' THEN DELETE;
TOUT = INT( (TIMEOUT+100) / 60 ) * 60;
SEQ = SMF70BDS; OUTPUT;
WORK = SMF70BDN -1;
DO WHILE (WORK ¬=0);
               SEQ+1;
               WORK=WORK-1;
               OUTPUT;
               END;
RETURN;
PROC SORT; BY TOUT SEQ;
*;
DATA LOGICAL (KEEP = TOUT PDT SMF70VPA SEQ);
RETAIN OTOUT 0 SEQ 0;
SET LOGP;
TOUT = INT( (TIMEOUT+100) / 60 ) * 60;
IF TOUT ¬= OTOUT THEN SEQ=0; ELSE SEQ+1;
OTOUT = TOUT;
PDT = SMF70PDT / 1000 / 1000;
RETURN;
PROC SORT; BY TOUT SEQ;
*;
DATA;
MERGE PRSM_S (IN=S1) LOGICAL(IN=S2); BY TOUT SEQ;
DROP SEQ;
IF S1 AND S2;
TOUT = INT( (TOUT+100) / 3600 ) * 3600;   * 3600 IS 1 HOUR;
RETURN;
*;
PROC SORT;
BY SMF70LPM SMF70VPA SMF70BDN TOUT;
*;
PROC UNIVARIATE NOPRINT;
VAR PDT;
BY SMF70LPM SMF70VPA SMF70BDN TOUT;
OUTPUT OUT=UNIVAR
N = N
MEAN = PDT
;
*;
PROC SORT;
BY TOUT;
*;
PROC PRINT SPLIT='*'; BY TOUT; SUM PDT;
FORMAT TOUT DATETIME.;
LABEL SMF70LPM='LOGICAL*PARTITION*NAME';
LABEL SMF70BDN='# LOGICAL*PROCESSORS';
LABEL SMF70VPA='PROCESSOR #';
LABEL TOUT ='DATE*TIME';
LABEL PDT ='DISPATCH*TIME*(SECS)';
RUN;
