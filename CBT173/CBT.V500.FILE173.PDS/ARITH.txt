ARITH    TITLE '** TSO ARITHMETIC COMMAND **'
***********************************************************************
*                                                                     *
*    NAME - ARITH (AR)                                                *
*                                                                     *
*    AUTHOR - TED BESTANI                                             *
*                                                                     *
*    PURPOSE - THIS COMMAND ALLOWS TSO USERS TO ENTER DO DECIMAL AND  *
*              HEX ARITHMETIC ON A 3270 TERMINAL IN FULL SCREEN MODE. *
*                                                                     *
*    ATTRIBUTES - NON-REUSABLE                                        *
*                                                                     *
*    REQUIREMENTS - ARITH REQUIRES THAT VTAM OR TCAM SUPPORT THE      *
*                   FULL-SCREEN OPTION.  IT IS DESIGNED FOR 3278M2    *
*                   TERMINALS.  IT WILL WORK ON BIGGER TOOBS, BUT     *
*                   IT WON'T USE THE ENTIRE SCREEN.                   *
*                                                                     *
*    MACROS USED - TGET, TPUT                                         *
*                                                                     *
***********************************************************************
         EJECT
         PRINT ON,NOGEN,NODATA
ARITH    CSECT
         STM   R14,R12,12(R13)         SAVE CALLERS REGISTERS
         BALR  R9,0                    WHERE ARE WE?
         USING *,R9                    TEMPORARY BASE REGISTER
         ST    R13,SAVEAREA+4          SAVE BACKWARD SA PTR
         LA    R8,SAVEAREA             GET SA ADDR
         ST    R8,8(R13)               SAVE FORWARD SA PTR
         LR    R13,R8                  COPY SA ADDR
         LA    R12,4095(R13)           BASE2 = BASE1 + 4095 +
         LA    R12,1(R12)                                     1
         LA    R11,4095(R12)           BASE3 = BASE2 + 4095 +
         LA    R11,1(R11)                                     1
         LA    R10,4095(R11)           BASE4 = BASE3 + 4095 +
         LA    R10,1(R10)                                     1
         USING SAVEAREA,R13,R12,R11,R10    PERMANENT BASE REGISTERS
         DROP  R9                      DROP TEMPORARY BASE REGISTER
         MVC   SAVECPPL(16),0(R1)      SAVE CP PARM LIST
         SPACE 1
         BAL   R9,DRIVER               CALL MAIN DRIVER ROUTINE
         SPACE 1
         L     R13,SAVEAREA+4          GET BACKWARD SA PTR
         LM    R14,R12,12(R13)         RESTORE REGISTERS
         LA    R15,0                   SET RC=0
         BR    R14                     GO HOME......
         SPACE 1
SAVEAREA DS    18F    PROGRAM MAIN SAVE AREA
SAVECPPL DS    0F     ** TSO COMMAND PROCESSOR PARAMETER LIST **
CPPLCBUF DS    A      ADDRESS OF COMMAND INPUT BUFFER
CPPLUPT  DS    A                 USER PROFILE TABLE
CPPLPSCB DS    A                 PROTECTED STEP CONTROL BLOCK
CPPLECT  DS    A                 ENVIRONMENT CONTROL TABLE
         SPACE 1
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         EJECT
***********************************************************************
*     THIS IS THE HIGHEST LEVEL WORK ROUTINE IN THE PROGRAM.  IT      *
*   DIRECTS THE FLOW OF CONTROL TO THE WORK ROUTINES.                 *
*     THE PROGRAM IS WRITTEN USING BASIC STRUCTURED PROGRAMMING. FLOW *
*   BETWEEN ROUTINES IS ACCOMPLISHED VIA REGISTER 9, WHICH IS ALWAYS  *
*   SAVED UPON ENTRY AND RESTORED BEFORE EXIT.                        *
***********************************************************************
         SPACE 2
DRIVER   DS    0H
         ST    R9,SAVE10
         B     BSAVE10
SAVE10   DC    F'-1'
         DC    CL8'DRIVER  '
BSAVE10  EQU   *
         SPACE 1
         STFSMODE ON,INITIAL=YES       SET FULL SCREEN MODE ON
*--> SET UP THE ATTENTION EXIT
         L     R2,=A(ATTNRTN)          GET ADDR OF ATTN ROUTINE
         STAX  (R2)                    SET UP STAX QUEUE ELEMENT
         LTR   R15,R15                 GO OK?
         BZ    DRBYPASS                YES, BYPASS ERROR CODE
         TPUT  MSG1,L'MSG1             PUT OUT ERROR MESSAGE
         B     EXIT10                  GO HOME.....
DRBYPASS EQU   *
         MVC   SC1LN24(80),ENDLNE01    NORMAL END OF MENU MSG
         MVI   SC1LN04,C' '            INITIALIZE OPTION FIELD
         BAL   R9,TPUTMAIN             DISPLAY MENU SCREEN
DRBYP002 EQU   *
         CLI   INPUT,C'0'              END?
         BE    DRCLEAR                 YES, GO CLEAR AND END
         CLI   INPUT,C'1'              CVD?
         BNE   DRTRY2                  NO, TRY NEXT OPTION
         BAL   R9,RTN$CVD              YES, GO PROCESS
         B     DRBYPASS                GO PUT OUT MENU AGAIN
DRTRY2   EQU   *
         CLI   INPUT,C'2'              CVB?
         BNE   DRTRY3                  NO, TRY NEXT OPTION
         BAL   R9,RTN$CVB              YES, GO PROCESS
         B     DRBYPASS                GO PUT OUT MENU AGAIN
DRTRY3   EQU   *
         CLI   INPUT,C'3'              ADD?
         BNE   DRTRY4                  NO, TRY NEXT OPTION
         BAL   R9,RTN$ADD              YES, GO PROCESS
         B     DRBYPASS                GO PUT OUT MENU AGAIN
DRTRY4   EQU   *
         CLI   INPUT,C'4'              SUB?
         BNE   DRTRY5                  NO, TRY NEXT OPTION
         BAL   R9,RTN$SUB              YES, GO PROCESS
         B     DRBYPASS                GO PUT OUT MENU AGAIN
DRTRY5   EQU   *
         CLI   INPUT,C'5'              MUL?
         BNE   DRTRY6                  NO, TRY NEXT OPTION
         BAL   R9,RTN$MUL              YES, GO PROCESS
         B     DRBYPASS                GO PUT OUT MENU AGAIN
DRTRY6   EQU   *
         CLI   INPUT,C'6'              DIV?
         BNE   DRTRY7                  NO, TRY NEXT OPTION
         BAL   R9,RTN$DIV              YES, GO PROCESS
         B     DRBYPASS                GO PUT OUT MENU AGAIN
DRTRY7   EQU   *
         CLI   INPUT,C'7'              OPTION 7?
         BNE   DRTRY8                  NO, TRY NEXT OPTION
         BAL   R9,RTN$327              YES, GO PROCESS
         B     DRBYPASS                GO PUT OUT MENU AGAIN
DRTRY8   EQU   *
         CLI   INPUT,C'8'              OPTION 8?
         BNE   DRTRY9                  NO, TRY NEXT OPTION
         MVC   SC1LN24(80),ENDLNE03    MOVE END LINE
         MVC   SC1LN04(1),INPUT        MOVE OPTION REQUESTED
         BAL   R9,TPUTMAIN             GO OUTPUT MENU
         B     DRBYP002                GIVE IT ANOTHER TRY
DRTRY9   EQU   *
         CLI   INPUT,C'9'              OPTION 9?
         BNE   DRNOGOOD                NO, PUT OUT ERROR MESSAGE
         MVC   SC1LN24(80),ENDLNE03    MOVE END LINE
         MVC   SC1LN04(1),INPUT        MOVE OPTION REQUESTED
         BAL   R9,TPUTMAIN             GO OUTPUT MENU
         B     DRBYP002                GIVE IT ANOTHER TRY
DRNOGOOD EQU   *
         MVC   SC1LN24(80),ENDLNE02    MOVE END LINE
         MVC   SC1LN04(1),INPUT        MOVE OPTION REQUESTED
         BAL   R9,TPUTMAIN             GO OUTPUT MENU
         B     DRBYP002                GIVE IT ANOTHER TRY
DRCLEAR  EQU   *
         TPUT  CLSCREEN,12,FULLSCR     CLEAR SCREEN
         STLINENO MODE=OFF,LINE=1      SET FULL SCREEN MODE OFF
         SPACE 1
EXIT10   EQU   *
         L     R9,SAVE10
         BR    R9
         EJECT
***********************************************************************
*     THIS ROUTINE PAINTS THE INPUT SCREEN AND READS A RESPONSE FROM  *
*   THE TERMINAL.  UPON RETURN, REGISTER 1 WILL CONTAIN THE NUMBER    *
*   OF BYTES READ FROM THE TERMINAL.                                  *
***********************************************************************
         SPACE 2
TPUTMAIN DS    0H
         ST    R9,SAVE20
         B     BSAVE20
SAVE20   DC    F'-1'
         DC    CL8'TPUTMAIN'
BSAVE20  EQU   *
         SPACE 1
         LA    R2,ATRLST1B             ADDR OF ATTRIBUTE LIST
         ST    R2,ALISTPTR             STORE IN PTR AREA
         LA    R2,SCREEN1              ADDR OF SCREEN
         ST    R2,ASCRNPTR             STORE IN PTR AREA
         LA    R2,ESCREEN1             ADDR OF END OF SCREEN
         ST    R2,ASCRPTRE             STORE IN PTR AREA
         LA    R2,SC1SUFIX             ADDR OF SUFFIX
         ST    R2,ASUFXPTR             STORE IN PTR AREA
         LA    R2,L'SC1SUFIX           GET LENGTH OF SUFFIX
         STC   R2,ASUFXPTR             STORE IN PTR AREA
         BAL   R9,FULLSCR              GO DO DEMO SCREEN WORK
         LTR   R1,R1                   DID USER TYPE IN MENU OPTION?
         BNZ   EXIT20                  NO, GO PAINT MENU AGAIN
         MVI   INPUT,C'0'              SIMULATE END OPTION
         SPACE 1
EXIT20   EQU   *
         L     R9,SAVE20
         BR    R9
         EJECT
***********************************************************************
*     THIS ROUTINE PROCESSES THE CONVERT-TO-DECIMAL SCREEN            *
***********************************************************************
         SPACE 2
RTN$CVD  DS    0H
         ST    R9,SAVE30
         B     BSAVE30
SAVE30   DC    F'-1'
         DC    CL8'RTN$CVD '
BSAVE30  EQU   *
         SPACE 1
         MVC   SC2LN08(8),=CL50' '     CLEAR INPUT
         MVI   SC2LN10,C' '                  OUTPUT
         MVC   SC2LN10+1(20),SC2LN10         OUTPUT
RCVD0010 EQU   *
         MVC   SC2LN24(80),ENDLNE05    PUT OUT BEGINNING MESSAGE
RCVD0020 EQU   *
         LA    R2,ATRLST2B             ADDR OF ATTRIBUTE LIST
         ST    R2,ALISTPTR             STORE IN PTR AREA
         LA    R2,SCREEN2              ADDR OF SCREEN
         ST    R2,ASCRNPTR             STORE IN PTR AREA
         LA    R2,ESCREEN2             ADDR OF END OF SCREEN
         ST    R2,ASCRPTRE             STORE IN PTR AREA
         LA    R2,SC2SUFIX             ADDR OF SUFFIX
         ST    R2,ASUFXPTR             STORE IN PTR AREA
         LA    R2,L'SC2SUFIX           GET LENGTH OF SUFFIX
         STC   R2,ASUFXPTR             STORE IN PTR AREA
         BAL   R9,FULLSCR              GO DO DEMO SCREEN WORK
         LTR   R1,R1                   DID USER TYPE ANYTHING IN?
         BZ    EXIT30                  NO, RETURN TO ORIGINAL MENU
         MVC   HDINPUT,INPUT           MOVE INPUT NUMBER
         BAL   R9,HEXDEC               CONVERT TO HEX
         CLI   HDRC,C'0'               DID IT GO OK?
         BNE   RCVDBAD                 NO, PUT OUT ERROR MESSAGE
         MVI   RESULTSW,C'1'           INDICATE A CURRENT RESULT
         MVI   RESULTRD,C'D'           INDICATE RESULT IN DECIMAL
         ZAP   RESULT99,HDOUTDEC       SAVE CURRENT RESULT
         MVC   SC2LN08(8),HDINPUT      MOVE ORIGINAL INPUT BACK IN
         MVC   SC2LN10(21),DECEDIT     MOVE EDIT MASK
         ED    SC2LN10(21),HDOUTDEC    EDIT THE OUTPUT
         CLI   SC2LN10+20,C' '         IS IT A SPACE?
         BNE   RCVD0010                NO, GO PUT ORIGINAL SCREEN OUT
         MVI   SC2LN10+20,C'+'         WAS A SPACE, REPLACE WITH A +
         B     RCVD0010                PUT ORIGINAL SCREEN BACK OUT
RCVDBAD  EQU   *
         MVC   SC2LN24(80),ENDLNE06    PUT OUT ERROR MESSAGE
         MVC   SC2LN08(8),HDINPUT      PUT ORIGINAL INPUT IN
         B     RCVD0020
         SPACE 1
EXIT30   EQU   *
         L     R9,SAVE30
         BR    R9
         EJECT
***********************************************************************
*     THIS ROUTINE PROCESSES THE CONVERT-TO-HEX SCREEN                *
***********************************************************************
         SPACE 2
RTN$CVB  DS    0H
         ST    R9,SAVE40
         B     BSAVE40
SAVE40   DC    F'-1'
         DC    CL8'RTN$CVB '
BSAVE40  EQU   *
         SPACE 1
         MVC   SC3LN08(16),=CL16' '    CLEAR INPUT
         MVI   SC3LN10,C' '                  OUTPUT
         MVC   SC3LN10+1(07),SC3LN10         OUTPUT
RCVB0010 EQU   *
         MVC   SC3LN24(80),ENDLNE05    PUT OUT BEGINNING MESSAGE
RCVB0020 EQU   *
         LA    R2,ATRLST3B             ADDR OF ATTRIBUTE LIST
         ST    R2,ALISTPTR             STORE IN PTR AREA
         LA    R2,SCREEN3              ADDR OF SCREEN
         ST    R2,ASCRNPTR             STORE IN PTR AREA
         LA    R2,ESCREEN3             ADDR OF END OF SCREEN
         ST    R2,ASCRPTRE             STORE IN PTR AREA
         LA    R2,SC3SUFIX             ADDR OF SUFFIX
         ST    R2,ASUFXPTR             STORE IN PTR AREA
         LA    R2,L'SC3SUFIX           GET LENGTH OF SUFFIX
         STC   R2,ASUFXPTR             STORE IN PTR AREA
         BAL   R9,FULLSCR              GO DO DEMO SCREEN WORK
         LTR   R1,R1                   DID USER TYPE ANYTHING IN?
         BZ    EXIT40                  NO, RETURN TO ORIGINAL MENU
         MVC   DHINPUT,INPUT           MOVE INPUT NUMBER
         BAL   R9,DECHEX               CONVERT TO HEX
         CLI   DHRC,C'0'               DID IT GO OK?
         BNE   RCVBBAD                 NO, PUT OUT ERROR MESSAGE
         MVI   RESULTSW,C'1'           INDICATE A CURRENT RESULT
         MVI   RESULTRD,C'X'           INDICATE RESULT IN DECIMAL
         ZAP   RESULT99,DHOUTDEC       SAVE CURRENT RESULT
         MVC   SC3LN08(16),DHINPUT     MOVE ORIGINAL INPUT BACK IN
         MVC   SC3LN10(08),DHOUTCHR    MOVE THE OUTPUT
         B     RCVB0010                PUT ORIGINAL SCREEN BACK OUT
RCVBBAD  EQU   *
         MVC   SC3LN24(80),ENDLNE06    PUT OUT ERROR MESSAGE
         MVC   SC3LN08(16),DHINPUT     PUT ORIGINAL INPUT IN
         B     RCVB0020
         SPACE 1
EXIT40   EQU   *
         L     R9,SAVE40
         BR    R9
         EJECT
***********************************************************************
*     THIS ROUTINE PROCESSES THE ADD SCREEN                           *
***********************************************************************
         SPACE 2
RTN$ADD  DS    0H
         ST    R9,SAVE50
         B     BSAVE50
SAVE50   DC    F'-1'
         DC    CL8'RTN$ADD '
BSAVE50  EQU   *
         SPACE 1
RADD0010 EQU   *
         MVC   SC4SUFIX+1(2),=X'C94F'  SET CURSOR TO RADIX 1
         MVI   SC4LN08+4,DEFRADIX      INIT RADIX
         MVI   SC4LN10+4,DEFRADIX      INIT RADIX
         MVI   SC4LN14+4,DEFRADIX      INIT RADIX
         MVI   SC4LN08+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC4LN08+32(15),SC4LN08+31    PROPOGATE SPACES
         CLI   RESULTSW,C'1'           IS THERE A CURRENT RESULT?
         BNE   RADDNOCR                NO, BYPASS
         CLI   RESULTRD,C'D'           IS CURRENT RESULT DECIMAL?
         BE    RADDRESD                YES, PROCESS DECIMAL
         UNPK  DHINPUT,RESULT99        UNPACK IT
         OI    DHINPUT+15,X'F0'        CLEAR SIGN NIBBLE
         BAL   R9,DECHEX               CONVERT NUMBER TO HEX DISPLAY
         MVC   SC4LN08+38(8),DHOUTCHR  PUT HEX NUMBER IN SCREEN
         MVI   SC4LN08+4,C'X'          INDICATE HEX RADIX
         B     RADDNOCR                BYPASS DECIMAL CODE
RADDRESD EQU   *
         MVC   SC4LN08+30(16),EDUNPK   UNPACK CURRENT RESULT
         ED    SC4LN08+30(16),RESULT99+8   EDIT CURRENT RESULT
         MVI   SC4LN08+46,C'+'         INIT TO NEGATIVE
         CP    RESULT99,=PL1'0'        SET CONDITION CODE
         BNL   RADDNOCR                BYPASS MOVE
         MVI   SC4LN08+46,C'-'         SET TO NEGATIVE
RADDNOCR EQU   *
         MVI   SC4LN10+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC4LN10+32(15),SC4LN10+31    PROPOGATE SPACES
         MVI   SC4LN14+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC4LN14+32(33),SC4LN14+31    PROPOGATE SPACES
         MVC   SC4LN24(80),ENDLNE05    PUT OUT BEGINNING MESSAGE
RADD0020 EQU   *
         LA    R2,ATRLST4B             ADDR OF ATTRIBUTE LIST
         ST    R2,ALISTPTR             STORE IN PTR AREA
         LA    R2,SCREEN4              ADDR OF SCREEN
         ST    R2,ASCRNPTR             STORE IN PTR AREA
         LA    R2,ESCREEN4             ADDR OF END OF SCREEN
         ST    R2,ASCRPTRE             STORE IN PTR AREA
         LA    R2,SC4SUFIX             ADDR OF SUFFIX
         ST    R2,ASUFXPTR             STORE IN PTR AREA
         LA    R2,L'SC4SUFIX           GET LENGTH OF SUFFIX
         STC   R2,ASUFXPTR             STORE IN PTR AREA
         BAL   R9,FULLSCR              GO DO DEMO SCREEN WORK
         BAL   R9,DYADIC               GO DO PRELIMINARY EDITING
         MVC   SC4LN08+4(1),DIRADIX1   PUT DATA BACK INTO SCREEN
         MVC   SC4LN10+4(1),DIRADIX2   PUT DATA BACK INTO SCREEN
         MVC   SC4LN14+4(1),DIRADIX3   PUT DATA BACK INTO SCREEN
         MVC   SC4LN08+31(16),DIDATA1  PUT DATA BACK INTO SCREEN
         MVC   SC4LN10+31(16),DIDATA2  PUT DATA BACK INTO SCREEN
         MVI   SC4LN14+31,C' '         CLEAR RESULT AREA
         MVC   SC4LN14+32(33),SC4LN14+31
         B     *+4(R15)                BRANCH ON RETURN CODE
         B     RADDRC00                EDITING/CONVERSION OK
         B     RADDRC04                ERROR, RC=04
         B     RADDRC08                ERROR, RC=08
         B     RADDRC12                ERROR, RC=12
         B     RADDRC16                ERROR, RC=16
         B     RADDRC20                ERROR, RC=20
RADDRC00 EQU   *
         MVC   SC4SUFIX+1(2),=X'506F'  SET CURSOR TO RESULT
         MVC   SC4LN24(80),ENDLNE05    PUT OUT BEGINNING MESSAGE
         ZAP   RESULT3,RESULT1         SHIFT FIRST RESULT
         AP    RESULT3,RESULT2         ADD SECOND RESULT
         ZAP   RESULT99,RESULT3        CAPTURE CURRENT RESULT
         MVI   RESULTSW,C'1'           INDICATE CURRENT RESULT ACTIVE
         MVC   RESULTRD,DIRADIX3       INDICATE CURRENT RESULT RADIX
         CP    RESULT3,=PL1'0'         SET CONDITION CODE
         BL    RADDRC0N                IF NEGATIVE, INSERT -
         MVI   DHINPUT+15,C'+'         MOVE A POSITIVE SIGN
         B     RADDRC0B                GO TO BYPASS
RADDRC0N EQU   *
         MVI   DHINPUT+15,C'-'         INSERT A - SIGN
RADDRC0B EQU   *
         CLI   DIRADIX3,C'D'           DID USER WANT ANSWER IN DEC?
         BE    RADDYESD                YES, IN DECIMAL
         MVC   SC4LN14+31(34),=CL50' ' CLEAR AREA FIRST
         UNPK  DHINPUT(15),RESULT3     SET INPUT UP
         OI    DHINPUT+14,X'F0'        CLEAR SIGN NIBBLE
         BAL   R9,DECHEX               CONVERT TO HEX
         MVC   SC4LN14+57(8),DHOUTCHR  MOVE CONVERTED HEX
         B     RADD0020                GO PUT SCREEN BACK OUT
RADDYESD EQU   *
         MVC   SC4LN14+31(34),DECEDIT2 PUT EDIT MASK IN SCREEN
         ED    SC4LN14+31(34),RESULT3+3     EDIT DECIMAL RESULT
         CLI   SC4LN14+64,C' '         IS SIGN A BLANK
         BNE   RADD0020                NO, GO PUT SCREEN BACK OUT
         MVI   SC4LN14+64,C'+'         YES, REPLACE WITH A +
         B     RADD0020                GO PUT SCREEN BACK OUT
RADDRC04 EQU   *
         MVC   SC4SUFIX+1(2),=X'C8F4'  RESET CURSOR POSITION
         B     RADDBAD
RADDRC08 EQU   *
         MVC   SC4SUFIX+1(2),=X'4BD4'  RESET CURSOR POSITION
         B     RADDBAD
RADDRC12 EQU   *
         MVC   SC4SUFIX+1(2),=X'50D4'  RESET CURSOR POSITION
         B     RADDBAD
RADDRC16 EQU   *
         MVC   SC4SUFIX+1(2),=X'C94F'  RESET CURSOR POSITION
         B     RADDBAD
RADDRC20 EQU   *
         MVC   SC4SUFIX+1(2),=X'4B6F'  RESET CURSOR POSITION
         B     RADDBAD
RADDBAD  EQU   *
         MVC   SC4LN24(80),ENDLNE06    PUT OUT ERROR MESSAGE
         B     RADD0020
         SPACE 1
EXIT50   EQU   *
         L     R9,SAVE50
         BR    R9
         EJECT
***********************************************************************
*     THIS ROUTINE PROCESSES THE SUBTRACT SCREEN                      *
***********************************************************************
         SPACE 2
RTN$SUB  DS    0H
         ST    R9,SAVE60
         B     BSAVE60
SAVE60   DC    F'-1'
         DC    CL8'RTN$SUB '
BSAVE60  EQU   *
         SPACE 1
RSUB0010 EQU   *
         MVC   SC5SUFIX+1(2),=X'C94F'  SET CURSOR TO RADIX 1
         MVI   SC5LN08+4,DEFRADIX      INIT RADIX
         MVI   SC5LN10+4,DEFRADIX      INIT RADIX
         MVI   SC5LN14+4,DEFRADIX      INIT RADIX
         MVI   SC5LN08+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC5LN08+32(15),SC5LN08+31    PROPOGATE SPACES
         CLI   RESULTSW,C'1'           IS THERE A CURRENT RESULT?
         BNE   RSUBNOCR                NO, BYPASS
         CLI   RESULTRD,C'D'           IS CURRENT RESULT DECIMAL?
         BE    RSUBRESD                YES, PROCESS DECIMAL
         UNPK  DHINPUT,RESULT99        UNPACK IT
         OI    DHINPUT+15,X'F0'        CLEAR SIGN NIBBLE
         BAL   R9,DECHEX               CONVERT NUMBER TO HEX DISPLAY
         MVC   SC5LN08+38(8),DHOUTCHR  PUT HEX NUMBER IN SCREEN
         MVI   SC5LN08+4,C'X'          INDICATE HEX RADIX
         B     RSUBNOCR                BYPASS DECIMAL CODE
RSUBRESD EQU   *
         MVC   SC5LN08+30(16),EDUNPK   UNPACK CURRENT RESULT
         ED    SC5LN08+30(16),RESULT99+8   EDIT CURRENT RESULT
         MVI   SC5LN08+46,C'+'         INIT TO NEGATIVE
         CP    RESULT99,=PL1'0'        SET CONDITION CODE
         BNL   RSUBNOCR                BYPASS MOVE
         MVI   SC5LN08+46,C'-'         SET TO NEGATIVE
RSUBNOCR EQU   *
         MVI   SC5LN10+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC5LN10+32(15),SC5LN10+31    PROPOGATE SPACES
         MVI   SC5LN14+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC5LN14+32(33),SC5LN14+31    PROPOGATE SPACES
         MVC   SC5LN24(80),ENDLNE05    PUT OUT BEGINNING MESSAGE
RSUB0020 EQU   *
         LA    R2,ATRLST5B             ADDR OF ATTRIBUTE LIST
         ST    R2,ALISTPTR             STORE IN PTR AREA
         LA    R2,SCREEN5              ADDR OF SCREEN
         ST    R2,ASCRNPTR             STORE IN PTR AREA
         LA    R2,ESCREEN5             ADDR OF END OF SCREEN
         ST    R2,ASCRPTRE             STORE IN PTR AREA
         LA    R2,SC5SUFIX             ADDR OF SUFFIX
         ST    R2,ASUFXPTR             STORE IN PTR AREA
         LA    R2,L'SC5SUFIX           GET LENGTH OF SUFFIX
         STC   R2,ASUFXPTR             STORE IN PTR AREA
         BAL   R9,FULLSCR              GO DO DEMO SCREEN WORK
         BAL   R9,DYADIC               GO DO PRELIMINARY EDITING
         MVC   SC5LN08+4(1),DIRADIX1   PUT DATA BACK INTO SCREEN
         MVC   SC5LN10+4(1),DIRADIX2   PUT DATA BACK INTO SCREEN
         MVC   SC5LN14+4(1),DIRADIX3   PUT DATA BACK INTO SCREEN
         MVC   SC5LN08+31(16),DIDATA1  PUT DATA BACK INTO SCREEN
         MVC   SC5LN10+31(16),DIDATA2  PUT DATA BACK INTO SCREEN
         MVI   SC5LN14+31,C' '         CLEAR RESULT AREA
         MVC   SC5LN14+32(33),SC5LN14+31
         B     *+4(R15)                BRANCH ON RETURN CODE
         B     RSUBRC00                EDITING/CONVERSION OK
         B     RSUBRC04                ERROR, RC=04
         B     RSUBRC08                ERROR, RC=08
         B     RSUBRC12                ERROR, RC=12
         B     RSUBRC16                ERROR, RC=16
         B     RSUBRC20                ERROR, RC=20
RSUBRC00 EQU   *
         MVC   SC5SUFIX+1(2),=X'506F'  SET CURSOR TO RESULT
         MVC   SC5LN24(80),ENDLNE05    PUT OUT BEGINNING MESSAGE
         ZAP   RESULT3,RESULT1         SHIFT FIRST RESULT
         SP    RESULT3,RESULT2         SUBTRACT SECOND RESULT
         ZAP   RESULT99,RESULT3        CAPTURE CURRENT RESULT
         MVI   RESULTSW,C'1'           INDICATE CURRENT RESULT ACTIVE
         MVC   RESULTRD,DIRADIX3       INDICATE CURRENT RESULT RADIX
         CP    RESULT3,=PL1'0'         SET CONDITION CODE
         BL    RSUBRC0N                IF NEGATIVE, INSERT -
         MVI   DHINPUT+15,C'+'         MOVE A POSITIVE SIGN
         B     RSUBRC0B                GO TO BYPASS
RSUBRC0N EQU   *
         MVI   DHINPUT+15,C'-'         INSERT A - SIGN
RSUBRC0B EQU   *
         CLI   DIRADIX3,C'D'           DID USER WANT ANSWER IN DEC?
         BE    RSUBYESD                YES, IN DECIMAL
         MVC   SC5LN14+31(34),=CL50' ' CLEAR AREA FIRST
         UNPK  DHINPUT(15),RESULT3     SET INPUT UP
         OI    DHINPUT+14,X'F0'        CLEAR SIGN NIBBLE
         BAL   R9,DECHEX               CONVERT TO HEX
         MVC   SC5LN14+57(8),DHOUTCHR  MOVE CONVERTED HEX
         B     RSUB0020                GO PUT SCREEN BACK OUT
RSUBYESD EQU   *
         MVC   SC5LN14+31(34),DECEDIT2 PUT EDIT MASK IN SCREEN
         ED    SC5LN14+31(34),RESULT3+3     EDIT DECIMAL RESULT
         CLI   SC5LN14+64,C' '         IS SIGN A BLANK
         BNE   RSUB0020                NO, GO PUT SCREEN BACK OUT
         MVI   SC5LN14+64,C'+'         YES, REPLACE WITH A +
         B     RSUB0020                GO PUT SCREEN BACK OUT
RSUBRC04 EQU   *
         MVC   SC5SUFIX+1(2),=X'C8F4'  RESET CURSOR POSITION
         B     RSUBBAD
RSUBRC08 EQU   *
         MVC   SC5SUFIX+1(2),=X'4BD4'  RESET CURSOR POSITION
         B     RSUBBAD
RSUBRC12 EQU   *
         MVC   SC5SUFIX+1(2),=X'50D4'  RESET CURSOR POSITION
         B     RSUBBAD
RSUBRC16 EQU   *
         MVC   SC5SUFIX+1(2),=X'C94F'  RESET CURSOR POSITION
         B     RSUBBAD
RSUBRC20 EQU   *
         MVC   SC5SUFIX+1(2),=X'4B6F'  RESET CURSOR POSITION
         B     RSUBBAD
RSUBBAD  EQU   *
         MVC   SC5LN24(80),ENDLNE06    PUT OUT ERROR MESSAGE
         B     RSUB0020
         SPACE 1
EXIT60   EQU   *
         L     R9,SAVE60
         BR    R9
         EJECT
***********************************************************************
*     THIS ROUTINE PROCESSES THE MULTIPLY SCREEN                      *
***********************************************************************
         SPACE 2
RTN$MUL  DS    0H
         ST    R9,SAVE70
         B     BSAVE70
SAVE70   DC    F'-1'
         DC    CL8'RTN$MUL '
BSAVE70  EQU   *
         SPACE 1
RMUL0010 EQU   *
         MVC   SC6SUFIX+1(2),=X'C94F'  SET CURSOR TO RADIX 1
         MVI   SC6LN08+4,DEFRADIX      INIT RADIX
         MVI   SC6LN10+4,DEFRADIX      INIT RADIX
         MVI   SC6LN14+4,DEFRADIX      INIT RADIX
         MVI   SC6LN08+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC6LN08+32(15),SC6LN08+31    PROPOGATE SPACES
         CLI   RESULTSW,C'1'           IS THERE A CURRENT RESULT?
         BNE   RMULNOCR                NO, BYPASS
         CLI   RESULTRD,C'D'           IS CURRENT RESULT DECIMAL?
         BE    RMULRESD                YES, PROCESS DECIMAL
         UNPK  DHINPUT,RESULT99        UNPACK IT
         OI    DHINPUT+15,X'F0'        CLEAR SIGN NIBBLE
         BAL   R9,DECHEX               CONVERT NUMBER TO HEX DISPLAY
         MVC   SC6LN08+38(8),DHOUTCHR  PUT HEX NUMBER IN SCREEN
         MVI   SC6LN08+4,C'X'          INDICATE HEX RADIX
         B     RMULNOCR                BYPASS DECIMAL CODE
RMULRESD EQU   *
         MVC   SC6LN08+30(16),EDUNPK   UNPACK CURRENT RESULT
         ED    SC6LN08+30(16),RESULT99+8   EDIT CURRENT RESULT
         MVI   SC6LN08+46,C'+'         INIT TO NEGATIVE
         CP    RESULT99,=PL1'0'        SET CONDITION CODE
         BNL   RMULNOCR                BYPASS MOVE
         MVI   SC6LN08+46,C'-'         SET TO NEGATIVE
RMULNOCR EQU   *
         MVI   SC6LN10+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC6LN10+32(15),SC6LN10+31    PROPOGATE SPACES
         MVI   SC6LN14+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC6LN14+32(33),SC6LN14+31    PROPOGATE SPACES
         MVC   SC6LN24(80),ENDLNE05    PUT OUT BEGINNING MESSAGE
RMUL0020 EQU   *
         LA    R2,ATRLST6B             ADDR OF ATTRIBUTE LIST
         ST    R2,ALISTPTR             STORE IN PTR AREA
         LA    R2,SCREEN6              ADDR OF SCREEN
         ST    R2,ASCRNPTR             STORE IN PTR AREA
         LA    R2,ESCREEN6             ADDR OF END OF SCREEN
         ST    R2,ASCRPTRE             STORE IN PTR AREA
         LA    R2,SC6SUFIX             ADDR OF SUFFIX
         ST    R2,ASUFXPTR             STORE IN PTR AREA
         LA    R2,L'SC6SUFIX           GET LENGTH OF SUFFIX
         STC   R2,ASUFXPTR             STORE IN PTR AREA
         BAL   R9,FULLSCR              GO DO DEMO SCREEN WORK
         BAL   R9,DYADIC               GO DO PRELIMINARY EDITING
         MVC   SC6LN08+4(1),DIRADIX1   PUT DATA BACK INTO SCREEN
         MVC   SC6LN10+4(1),DIRADIX2   PUT DATA BACK INTO SCREEN
         MVC   SC6LN14+4(1),DIRADIX3   PUT DATA BACK INTO SCREEN
         MVC   SC6LN08+31(16),DIDATA1  PUT DATA BACK INTO SCREEN
         MVC   SC6LN10+31(16),DIDATA2  PUT DATA BACK INTO SCREEN
         MVI   SC6LN14+31,C' '         CLEAR RESULT AREA
         MVC   SC6LN14+32(33),SC6LN14+31
         B     *+4(R15)                BRANCH ON RETURN CODE
         B     RMULRC00                EDITING/CONVERSION OK
         B     RMULRC04                ERROR, RC=04
         B     RMULRC08                ERROR, RC=08
         B     RMULRC12                ERROR, RC=12
         B     RMULRC16                ERROR, RC=16
         B     RMULRC20                ERROR, RC=20
RMULRC00 EQU   *
         MVC   SC6SUFIX+1(2),=X'506F'  SET CURSOR TO RESULT
         MVC   SC6LN24(80),ENDLNE05    PUT OUT BEGINNING MESSAGE
         ZAP   RESULT3,RESULT1         SHIFT FIRST RESULT
         MP    RESULT3,RESULT2+9(7)    MULTIPLY BY SECOND RESULT
         ZAP   RESULT99,RESULT3        CAPTURE CURRENT RESULT
         MVI   RESULTSW,C'1'           INDICATE CURRENT RESULT ACTIVE
         MVC   RESULTRD,DIRADIX3       INDICATE CURRENT RESULT RADIX
         CP    RESULT3,=PL1'0'         SET THE CONDITION CODE
         BL    RMULRC0N                IF NEGATIVE, INSERT -
         MVI   DHINPUT+15,C'+'         MOVE A POSITIVE SIGN
         B     RMULRC0B                GO TO BYPASS
RMULRC0N EQU   *
         MVI   DHINPUT+15,C'-'         INSERT A - SIGN
RMULRC0B EQU   *
         CLI   DIRADIX3,C'D'           DID USER WANT ANSWER IN DEC?
         BE    RMULYESD                YES, IN DECIMAL
         MVC   SC6LN14+31(34),=CL50' ' CLEAR AREA FIRST
         UNPK  DHINPUT(15),RESULT3     SET INPUT UP
         OI    DHINPUT+14,X'F0'        CLEAR SIGN NIBBLE
         BAL   R9,DECHEX               CONVERT TO HEX
         MVC   SC6LN14+57(8),DHOUTCHR  MOVE CONVERTED HEX
         B     RMUL0020                GO PUT SCREEN BACK OUT
RMULYESD EQU   *
         MVC   SC6LN14+31(34),DECEDIT2 PUT EDIT MASK IN SCREEN
         ED    SC6LN14+31(34),RESULT3+3     EDIT DECIMAL RESULT
         CLI   SC6LN14+64,C' '         IS SIGN A BLANK
         BNE   RMUL0020                NO, GO PUT SCREEN BACK OUT
         MVI   SC6LN14+64,C'+'         YES, REPLACE WITH A +
         B     RMUL0020                GO PUT SCREEN BACK OUT
RMULRC04 EQU   *
         MVC   SC6SUFIX+1(2),=X'C8F4'  RESET CURSOR POSITION
         B     RMULBAD
RMULRC08 EQU   *
         MVC   SC6SUFIX+1(2),=X'4BD4'  RESET CURSOR POSITION
         B     RMULBAD
RMULRC12 EQU   *
         MVC   SC6SUFIX+1(2),=X'50D4'  RESET CURSOR POSITION
         B     RMULBAD
RMULRC16 EQU   *
         MVC   SC6SUFIX+1(2),=X'C94F'  RESET CURSOR POSITION
         B     RMULBAD
RMULRC20 EQU   *
         MVC   SC6SUFIX+1(2),=X'4B6F'  RESET CURSOR POSITION
         B     RMULBAD
RMULBAD  EQU   *
         MVC   SC6LN24(80),ENDLNE06    PUT OUT ERROR MESSAGE
         B     RMUL0020
         SPACE 1
EXIT70   EQU   *
         L     R9,SAVE70
         BR    R9
         EJECT
***********************************************************************
*     THIS ROUTINE PROCESSES THE DIVIDE SCREEN                        *
***********************************************************************
         SPACE 2
RTN$DIV  DS    0H
         ST    R9,SAVE80
         B     BSAVE80
SAVE80   DC    F'-1'
         DC    CL8'RTN$DIV '
BSAVE80  EQU   *
         SPACE 1
RDIV0010 EQU   *
         MVC   SC7SUFIX+1(2),=X'C94F'  SET CURSOR TO RADIX 1
         MVI   SC7LN08+4,DEFRADIX      INIT RADIX
         MVI   SC7LN10+4,DEFRADIX      INIT RADIX
         MVI   SC7LN14+4,DEFRADIX      INIT RADIX
         MVI   SC7LN08+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC7LN08+32(15),SC7LN08+31    PROPOGATE SPACES
         CLI   RESULTSW,C'1'           IS THERE A CURRENT RESULT?
         BNE   RDIVNOCR                NO, BYPASS
         CLI   RESULTRD,C'D'           IS CURRENT RESULT DECIMAL?
         BE    RDIVRESD                YES, PROCESS DECIMAL
         UNPK  DHINPUT,RESULT99        UNPACK IT
         OI    DHINPUT+15,X'F0'        CLEAR SIGN NIBBLE
         BAL   R9,DECHEX               CONVERT NUMBER TO HEX DISPLAY
         MVC   SC7LN08+38(8),DHOUTCHR  PUT HEX NUMBER IN SCREEN
         MVI   SC7LN08+4,C'X'          INDICATE HEX RADIX
         B     RDIVNOCR                BYPASS DECIMAL CODE
RDIVRESD EQU   *
         MVC   SC7LN08+30(16),EDUNPK   UNPACK CURRENT RESULT
         ED    SC7LN08+30(16),RESULT99+8   EDIT CURRENT RESULT
         MVI   SC7LN08+46,C'+'         INIT TO NEGATIVE
         CP    RESULT99,=PL1'0'        SET CONDITION CODE
         BNL   RDIVNOCR                BYPASS MOVE
         MVI   SC7LN08+46,C'-'         SET TO NEGATIVE
RDIVNOCR EQU   *
         MVI   SC7LN10+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC7LN10+32(15),SC7LN10+31    PROPOGATE SPACES
         MVI   SC7LN14+31,C' '         SET FIRST CHAR TO SPACE
         MVC   SC7LN14+32(33),SC7LN14+31    PROPOGATE SPACES
         MVC   SC7LN24(80),ENDLNE05    PUT OUT BEGINNING MESSAGE
RDIV0020 EQU   *
         LA    R2,ATRLST7B             ADDR OF ATTRIBUTE LIST
         ST    R2,ALISTPTR             STORE IN PTR AREA
         LA    R2,SCREEN7              ADDR OF SCREEN
         ST    R2,ASCRNPTR             STORE IN PTR AREA
         LA    R2,ESCREEN7             ADDR OF END OF SCREEN
         ST    R2,ASCRPTRE             STORE IN PTR AREA
         LA    R2,SC7SUFIX             ADDR OF SUFFIX
         ST    R2,ASUFXPTR             STORE IN PTR AREA
         LA    R2,L'SC7SUFIX           GET LENGTH OF SUFFIX
         STC   R2,ASUFXPTR             STORE IN PTR AREA
         BAL   R9,FULLSCR              GO DO DEMO SCREEN WORK
         BAL   R9,DYADIC               GO DO PRELIMINARY EDITING
         MVC   SC7LN08+4(1),DIRADIX1   PUT DATA BACK INTO SCREEN
         MVC   SC7LN10+4(1),DIRADIX2   PUT DATA BACK INTO SCREEN
         MVC   SC7LN14+4(1),DIRADIX3   PUT DATA BACK INTO SCREEN
         MVC   SC7LN08+31(16),DIDATA1  PUT DATA BACK INTO SCREEN
         MVC   SC7LN10+31(16),DIDATA2  PUT DATA BACK INTO SCREEN
         MVI   SC7LN14+31,C' '         CLEAR RESULT AREA
         MVC   SC7LN14+32(33),SC7LN14+31
         B     *+4(R15)                BRANCH ON RETURN CODE
         B     RDIVRC00                EDITING/CONVERSION OK
         B     RDIVRC04                ERROR, RC=04
         B     RDIVRC08                ERROR, RC=08
         B     RDIVRC12                ERROR, RC=12
         B     RDIVRC16                ERROR, RC=16
         B     RDIVRC20                ERROR, RC=20
RDIVRC00 EQU   *
         MVC   SC7SUFIX+1(2),=X'506F'  SET CURSOR TO RESULT
         MVC   SC7LN24(80),ENDLNE05    PUT OUT BEGINNING MESSAGE
         ZAP   RESULT3,RESULT1         SHIFT FIRST RESULT
         DP    RESULT3,RESULT2+9(7)    SUBTRACT SECOND RESULT
         ZAP   REMAIN,RESULT3+9(7)     SAVE THE REMAINDER
         ZAP   DIVWORK1,RESULT3(9)     COPY THE QUOTIENT
         ZAP   RESULT3,DIVWORK1        COPY IT BACK, EXPANDED
         ZAP   RESULT99,RESULT3        CAPTURE CURRENT RESULT
         MVI   RESULTSW,C'1'           INDICATE CURRENT RESULT ACTIVE
         MVC   RESULTRD,DIRADIX3       INDICATE CURRENT RESULT RADIX
         CP    RESULT3,=PL1'0'         SET THE CONDITION CODE
         BL    RDIVRC0N                IF NEGATIVE, INSERT -
         MVI   DHINPUT+15,C'+'         MOVE A POSITIVE SIGN
         B     RDIVRC0B                GO TO BYPASS
RDIVRC0N EQU   *
         MVI   DHINPUT+15,C'-'         INSERT A - SIGN
RDIVRC0B EQU   *
         CLI   DIRADIX3,C'D'           DID USER WANT ANSWER IN DEC?
         BE    RDIVYESD                YES, IN DECIMAL
         MVC   SC7LN14+31(34),=CL50' ' CLEAR AREA FIRST
         UNPK  DHINPUT(15),RESULT3     SET INPUT UP
         OI    DHINPUT+14,X'F0'        CLEAR SIGN NIBBLE
         BAL   R9,DECHEX               CONVERT TO HEX
         MVC   SC7LN14+57(8),DHOUTCHR  MOVE CONVERTED HEX
         B     RDIVREMN                GO PUT SCREEN BACK OUT
RDIVYESD EQU   *
         MVC   SC7LN14+31(34),DECEDIT2 PUT EDIT MASK IN SCREEN
         ED    SC7LN14+31(34),RESULT3+3     EDIT DECIMAL RESULT
         CLI   SC7LN14+64,C' '         IS SIGN A BLANK
         BNE   RDIV0020                NO, GO PUT SCREEN BACK OUT
         MVI   SC7LN14+64,C'+'         YES, REPLACE WITH A +
RDIVREMN EQU   *
         MVI   DHINPUT+15,C'+'         MOVE A POSITIVE SIGN
         CLI   DIRADIX3,C'D'           DID USER WANT ANSWER IN DEC?
         BE    RDIVYSD2                YES, IN DECIMAL
         MVC   SC7LN15+31(34),=CL50' ' CLEAR AREA FIRST
         UNPK  DHINPUT(15),REMAIN      SET INPUT UP
         OI    DHINPUT+14,X'F0'        CLEAR SIGN NIBBLE
         BAL   R9,DECHEX               CONVERT TO HEX
         MVC   SC7LN15+57(8),DHOUTCHR  MOVE CONVERTED HEX
         B     RDIV0020                GO PUT SCREEN BACK OUT
RDIVYSD2 EQU   *
         MVC   SC7LN15+31(34),DECEDIT2 PUT EDIT MASK IN SCREEN
         ED    SC7LN15+31(34),REMAIN+3     EDIT DECIMAL RESULT
         CLI   SC7LN15+64,C' '         IS SIGN A BLANK
         BNE   RDIV0020                NO, GO PUT SCREEN BACK OUT
         MVI   SC7LN15+64,C'+'         YES, REPLACE WITH A +
         B     RDIV0020                GO PUT SCREEN BACK OUT
RDIVRC04 EQU   *
         MVC   SC7SUFIX+1(2),=X'C8F4'  RESET CURSOR POSITION
         B     RDIVBAD
RDIVRC08 EQU   *
         MVC   SC7SUFIX+1(2),=X'4BD4'  RESET CURSOR POSITION
         B     RDIVBAD
RDIVRC12 EQU   *
         MVC   SC7SUFIX+1(2),=X'50D4'  RESET CURSOR POSITION
         B     RDIVBAD
RDIVRC16 EQU   *
         MVC   SC7SUFIX+1(2),=X'C94F'  RESET CURSOR POSITION
         B     RDIVBAD
RDIVRC20 EQU   *
         MVC   SC7SUFIX+1(2),=X'4B6F'  RESET CURSOR POSITION
         B     RDIVBAD
RDIVBAD  EQU   *
         MVC   SC7LN24(80),ENDLNE06    PUT OUT ERROR MESSAGE
         B     RDIV0020
         SPACE 1
EXIT80   EQU   *
         L     R9,SAVE80
         BR    R9
         EJECT
***********************************************************************
*     THIS ROUTINE PROCESSES THE 3270 BUFFER CONVERSION SCREEN        *
***********************************************************************
         SPACE 2
RTN$327  DS    0H
         ST    R9,SAVE90
         B     BSAVE90
SAVE90   DC    F'-1'
         DC    CL8'RTN$327 '
BSAVE90  EQU   *
         SPACE 1
R3270010 EQU   *
         MVI   SC8LN09+3,C'2'          DEFAULT TO MODEL 2
         MVC   SC8LN12+2(2),=CL2'__'   UNDERSCORE ROW FIELD
         MVC   SC8LN13+1(3),=CL3'___'  UNDERSCORE COLUMN FIELD
         MVC   SC8LN16+2(2),=CL2'__'   UNDERSCORE 1ST BUFFER ADDR
         MVC   SC8LN17+2(2),=CL2'__'   UNDERSCORE 2ND BUFFER ADDR
         MVC   SC8LN12+74(6),=CL6' '   CLEAR THE DECIMAL ADDRESS
         MVC   SC8LN13+74(6),=CL6' '   CLEAR THE HEX ADDRESS
         MVC   SC8SUFIX+1(2),=XL2'4AC3'    RESET THE CURSOR ADDRESS
         MVC   SC8LN24(80),ENDLNE05    RESET BOTTOM LINE
R3270020 EQU   *
         LA    R2,ATRLST8B             ADDR OF ATTRIBUTE LIST
         ST    R2,ALISTPTR             STORE IN PTR AREA
         LA    R2,SCREEN8              ADDR OF SCREEN
         ST    R2,ASCRNPTR             STORE IN PTR AREA
         LA    R2,ESCREEN8             ADDR OF END OF SCREEN
         ST    R2,ASCRPTRE             STORE IN PTR AREA
         LA    R2,SC8SUFIX             ADDR OF SUFFIX
         ST    R2,ASUFXPTR             STORE IN PTR AREA
         LA    R2,L'SC8SUFIX           GET LENGTH OF SUFFIX
         STC   R2,ASUFXPTR             STORE IN PTR AREA
         BAL   R9,FULLSCR              GO DO DEMO SCREEN WORK
         CH    R1,=H'10'               DID WE GET 10 BYTES?
         BE    R3270030                YES, CONTINUE
         MVC   SC8LN24(80),ENDLNE07    NO, PUT OUT MESSAGE
         B     R3270020                PUT SCREEN BACK OUT
R3270030 EQU   *
         MVC   SC8LN09+3(1),INPUT+0    RETURN DATA TO ORIGINAL SCREEN
         MVC   SC8LN12+2(2),INPUT+1    RETURN DATA TO ORIGINAL SCREEN
         MVC   SC8LN13+1(3),INPUT+3    RETURN DATA TO ORIGINAL SCREEN
         MVC   SC8LN16+2(2),INPUT+6    RETURN DATA TO ORIGINAL SCREEN
         MVC   SC8LN17+2(2),INPUT+8    RETURN DATA TO ORIGINAL SCREEN
         LA    R2,INPUT                GET ADDR OF INPUT
         LA    R3,10                   GET NUMBER OF BYTES
R3270040 EQU   *
         CLI   0(R2),C'_'              IS IT AN UNDERSCORE?
         BE    R327REPL                YES, REPLACE IT WITH 0
         CLI   0(R2),C'0'              IS IT A SPACE?
         BE    R327REPL                YES, REPLACE IT WITH 0
         LA    R2,1(R2)                BUMP PTR
         BCT   R3,R3270040             ITERATE
         B     R3270050                BYPASS
R327REPL EQU   *
         MVI   0(R2),C'0'              REPLACE WITH A ZERO
         LA    R2,1(R2)                BUMP PTR
         BCT   R3,R3270040             ITERATE
R3270050 EQU   *
         CLI   INPUT+0,C'2'            IS IT AT LEAST A 2?
         BL    R327BAD1                NO, POST AS ERROR
         CLI   INPUT+0,C'5'            IS IT GREATER THAN 5?
         BH    R327BAD1                YES, POST AS ERROR
         CLC   INPUT+1(2),=CL2'00'     DID USER TYPE IN A ROW VALUE?
         BE    R3270500                NO, MAYBE HE WANTS TO GO BUFFER
         CLC   INPUT+3(3),=CL3'000'    DID USER TYPE IN A COLUMN?
         BE    R327BAD3                NO, BUT HE SHOULD HAVE
         TRT   INPUT+1(2),TRTDEC       IS THE ROW NUMERIC?
         BC    7,R327BAD2              NO, POST ERROR MESSAGE
         TRT   INPUT+3(3),TRTDEC       IS THE COLUMN NUMERIC?
         BC    7,R327BAD3              NO, POST ERROR MESSAGE
*--> USER WANTS A ROW/COLUMN TO BUFFER ADDRESS CONVERSION
         CLC   INPUT+1(2),=CL2'43'     HIGHEST ROW POSSIBLE
         BH    R327BAD2                POST ERROR MESSAGE
         CLC   INPUT+3(3),=CL3'132'    HIGHEST COLUMN POSSIBLE
         BH    R327BAD3                POST ERROR MESSAGE
         PACK  R327FLD1,INPUT+1(2)     PACK THE ROW NUMBER
         SP    R327FLD1,=PL1'1'        SUBTRACT 1
         CLI   INPUT,C'5'              IS THIS A 3278 MOD 5?
         BE    R3270060                YES, MULTIPLY BY 132
         MP    R327FLD1,=PL2'80'       NO, MULTIPLY BY 80
         B     R3270070                BRANCH AROUND
R3270060 EQU   *
         MP    R327FLD1,=PL2'132'      MOD 5 - MULTIPLY BY 132
R3270070 EQU   *
         PACK  R327FLD2,INPUT+3(3)     PACK THE COLUMN
         AP    R327FLD1,R327FLD2       ADD TO GET POSITION NUMBER
         SP    R327FLD1,=PL1'1'        SUBTRACT TO GET REL POSITION
         UNPK  SC8LN12+75(4),R327FLD1  PUT THE DECIMAL IN SCREEN
         OI    SC8LN12+78,X'F0'        CLEAR SIGN NIBBLE
         UNPK  DHINPUT,R327FLD1        SET UP FOR TRANSLATION
         OI    DHINPUT+15,X'F0'             CLEAR SIGN
         BAL   R9,DECHEX                    CONVERT TO HEX CHARACTERS
         MVC   SC8LN13+75(4),DHOUTCHR+4     MOVE TO SCREEN
         DP    R327FLD1,=PL2'64'       DIVIDE BY BASE 64
         ZAP   WORKDBLW,R327FLD1(2)    MOVE FOR CONVERSION
         CVB   R2,WORKDBLW             CONVERT FOR USE AS AN INDEX
         SLL   R2,1                    MULTIPLY BY 2
         LA    R3,TABLE327             GET BASE ADDRESS
         AR    R3,R2                   ADD DISPLACEMENT TO BASE
         MVC   SC8LN16+2(2),0(R3)      MOVE CHARACTERS FROM TABLE
         ZAP   WORKDBLW,R327FLD1+2(2)  MOVE FOR CONVERSION
         CVB   R2,WORKDBLW             CONVERT FOR USE AS AN INDEX
         SLL   R2,1                    MULTIPLY BY 2
         LA    R3,TABLE327             GET BASE ADDRESS
         AR    R3,R2                   ADD DISPLACEMENT TO BASE
         MVC   SC8LN17+2(2),0(R3)      MOVE CHARACTERS FROM TABLE
         B     R327GOOD                GO POST GOOD MESSAGE AND DISPLAY
R3270500 EQU   *
         CLC   INPUT+6(2),=CL2'00'     DID USER TYPE IN A BUFFER VALUE?
         BE    R327BAD6                NO, HE HAS TO TYPE IN SOMETHING.
         CLC   INPUT+8(2),=CL2'00'     DID USER TYPE IN A BUFFER VALUE?
         BE    R327BAD5                NO, HE HAS TO TYPE IN SOMETHING.
         TRT   INPUT+1(2),TRTDEC       IS THE ROW NUMERIC?
         BC    7,R327BAD4              NO, POST ERROR MESSAGE
         TRT   INPUT+3(3),TRTDEC       IS THE COLUMN NUMERIC?
         BC    7,R327BAD5              NO, POST ERROR MESSAGE
*--> USER WANTS A BUFFER ADDRESS TO ROW/COLUMN CONVERSION
         LA    R2,TABLE327             GET BASE ADDRESS OF TABLE
         LA    R3,64                   GET TABLE LENGTH
R3270510 EQU   *
         CLC   INPUT+6(2),0(R2)        IS IT THIS POINT IN TABLE
         BE    R3270520                YES, BREAK OUT
         LA    R2,2(R2)                BUMP
         BCT   R3,R3270510             ITERATE
         B     R327BAD4                POST ERROR MESSAGE
R3270520 EQU   *
         LA    R3,TABLE327             GET BASE ADDRESS OF TABLE
         SR    R2,R3                   GET OFFSET
         SRL   R2,1                    DIVIDE BY 2
         SLL   R2,6                    MULTIPLY BY 64
         CVD   R2,WORKDBLW             CONVERT TO DECIMAL
         ZAP   R327FLD1,WORKDBLW       PLACE IN SAFE-KEEPING
         LA    R2,TABLE327             GET BASE ADDRESS OF TABLE
         LA    R3,64                   GET TABLE LENGTH
R3270530 EQU   *
         CLC   INPUT+8(2),0(R2)        IS IT THIS POINT IN TABLE
         BE    R3270540                YES, BREAK OUT
         LA    R2,2(R2)                BUMP
         BCT   R3,R3270530             ITERATE
         B     R327BAD5                POST ERROR MESSAGE
R3270540 EQU   *
         LA    R3,TABLE327             GET BASE ADDRESS OF TABLE
         SR    R2,R3                   GET OFFSET
         SRL   R2,1                    DIVIDE BY 2
         CVD   R2,WORKDBLW             CONVERT TO DECIMAL
         AP    R327FLD1,WORKDBLW       ADD TO BASE
         UNPK  SC8LN12+75(4),R327FLD1  PUT THE DECIMAL IN SCREEN
         OI    SC8LN12+78,X'F0'        CLEAR SIGN NIBBLE
         UNPK  DHINPUT,R327FLD1        SET UP FOR TRANSLATION
         OI    DHINPUT+15,X'F0'             CLEAR SIGN
         BAL   R9,DECHEX                    CONVERT TO HEX CHARACTERS
         MVC   SC8LN13+75(4),DHOUTCHR+4     MOVE TO SCREEN
         CLI   INPUT,C'5'              IS IT A MOD 5?
         BE    R3270550                YES, DIVIDE BY 132
         DP    R327FLD1,=PL2'80'       NO, DIVIDE BY 80
         B     R3270560                GO AROUND
R3270550 EQU   *
         DP    R327FLD1,=PL2'132'      DIVIDE BY 132
R3270560 EQU   *
         AP    R327FLD1+0(2),=PL1'1'   ADD 1 TO GET REAL ROW
         AP    R327FLD1+2(2),=PL1'1'   ADD 1 TO GET REAL COLUMN
         UNPK  SC8LN12+2(2),R327FLD1(2)    PUT ROW IN SCREEN
         OI    SC8LN12+3,X'F0'             CLEAR SIGN
         UNPK  SC8LN13+1(3),R327FLD1+2(2)  PUT COLUMN IN SCREEN
         OI    SC8LN13+3,X'F0'             CLEAR SIGN
R327GOOD EQU   *
         MVC   SC8LN24(80),ENDLNE05    POST GOOD MESSAGE
         B     R3270020                GO BACK UP AND DISPLAY RESULTS
R327BAD1 EQU   *
         MVC   SC8LN24(80),ENDLNE06    POST ERROR MESSAGE
         MVC   SC8SUFIX+1(2),=XL2'4AC3'    RESET CURSOR ADDRESS
         B     R3270020                GO PAINT SCREEN AGAIN
R327BAD2 EQU   *
         MVC   SC8LN24(80),ENDLNE06    POST ERROR MESSAGE
         MVC   SC8SUFIX+1(2),=XL2'4DF2'    RESET CURSOR ADDRESS
         B     R3270020                GO PAINT SCREEN AGAIN
R327BAD3 EQU   *
         MVC   SC8LN24(80),ENDLNE06    POST ERROR MESSAGE
         MVC   SC8SUFIX+1(2),=XL2'4FC1'    RESET CURSOR ADDRESS
         B     R3270020                GO PAINT SCREEN AGAIN
R327BAD4 EQU   *
         MVC   SC8LN24(80),ENDLNE06    POST ERROR MESSAGE
         MVC   SC8SUFIX+1(2),=XL2'D2F2'    RESET CURSOR ADDRESS
         B     R3270020                GO PAINT SCREEN AGAIN
R327BAD5 EQU   *
         MVC   SC8LN24(80),ENDLNE06    POST ERROR MESSAGE
         MVC   SC8SUFIX+1(2),=XL2'D4C2'    RESET CURSOR ADDRESS
         B     R3270020                GO PAINT SCREEN AGAIN
R327BAD6 EQU   *
         MVC   SC8LN24(80),ENDLNE08    POST ERROR MESSAGE
         MVC   SC8SUFIX+1(2),=XL2'4DF2'    RESET CURSOR ADDRESS
         B     R3270020                GO PAINT SCREEN AGAIN
         SPACE 1
EXIT90   EQU   *
         L     R9,SAVE90
         BR    R9
         EJECT
***********************************************************************
*   THIS ROUTINE BUILDS THE FINAL SCREEN, DOES A FULL SCREEN TPUT,    *
* A DUMMY TGET, AND CLEARS THE SCREEN.  THE MAJOR PART OF THE CODE    *
* IS THE BUILDING OF THE FINAL SCREEN.  THE ROUTINE HAS THREE INPUTS. *
* 'ASCRNPTR' POINTS TO A STANDARD 1920 BYTE SCREEN IMAGE WITH NO      *
* ATTRIBUTE CHARACTERS.  'ALISTPTR' CONTAINS THE ADDRESS OF THE       *
* ATTRIBUTE LIST THAT WE WILL USE THIS TIME AROUND.  'SCPREFIX' IS    *
* THE CONTROL STREAM WHICH IS TO BE PREFIXED ONTO THE FINAL SCREEN.   *
*   USING THE THREE INPUTS, A TPUT'ABLE FINAL SCREEN IS BUILT IN THE  *
* 'SCRBLD' AREA AT THE END OF THE PROGRAM.                            *
***********************************************************************
         SPACE 1
FULLSCR  DS    0H
         ST    R9,SAVE500
         B     BSAVE500
SAVE500  DC    F'-1'
         DC    CL8'FULLSCR '
BSAVE500 EQU   *
         SPACE 1
*--> INIT REGISTERS
         L     R2,ALISTPTR             GET PTR TO ATTRIBUTE LIST
         L     R3,0(R2)                GET END OF ATTRIBUTE LIST
         LA    R2,4(R2)                BUMP PAST END ADDRESS
         L     R4,=A(SCRBLD)           GET ADDR OF BUILD AREA
         XR    R5,R5                   INIT LENGTH REGISTER
         L     R6,ASCRNPTR             GET ADDR OF INPUT SCREEN
         L     R7,ASCRPTRE             GET END OF INPUT SCREEN
*--> INSERT PREFIX
         MVC   0(L'SCPREFIX,R4),SCPREFIX   MOVE PREFIX
         LA    R4,L'SCPREFIX(R4)       BUMP PTR
         LA    R5,L'SCPREFIX(R5)       ADD LENGTH
*--> FLAG ATTRIBUTE BYTES FIRST
FSLOOP10 EQU   *
         CR    R2,R3                   END OF ATTRIBUTE LIST?
         BE    FSLOOP20                YES, END OF FLAGGING
         L     R8,0(R2)                GET ADDR OF NEXT ATTR BYTE
         MVI   0(R8),X'1D'             FLAG BYTE WITH A 'START FIELD'
         LA    R2,4(R2)                GET NEXT ATTRIBUTE ADDR
         B     FSLOOP10                GO TRY NEXT
FSLOOP20 EQU   *
         L     R2,ALISTPTR             GET PTR TO ATTRIBUTE LIST
         LA    R2,4(R2)                BUMP PAST END ADDRESS
FSLOOP30 EQU   *
         CR    R6,R7                   INPUT SCREEN EXHAUSTED?
         BE    FSLOOP50                GO TPUT
         CLI   0(R6),X'1D'             IS THIS A FLAG?
         BE    FSLOOP40                YES, GO PROCESS
         CLI   0(R6),C'|'              START OF EXPANSION COMMAND?
         BE    FSLOOP35                YES, GO PROCESS
         MVC   0(1,R4),0(R6)           NO, MOVE THIS BYTE TO OUTPUT
         LA    R4,1(R4)                BUMP PTR TO OUTPUT SCREEN
         LA    R5,1(R5)                BUMP LENGTH OF OUTPUT
         LA    R6,1(R6)                BUMP TO NEXT INPUT BYTE
         B     FSLOOP30                GO TRY NEXT BYTE
FSLOOP35 EQU   *
         PACK  WORKDBLW,1(4,R6)        PACK NUMBER OF BYTES TO EXPAND
         CVB   R8,WORKDBLW             CONVERT RADIX
FSLOOP37 EQU   *
         MVC   0(1,R4),5(R6)           MOVE EXPANSION CHARACTER
         LA    R4,1(R4)                BUMP PTR TO OUTPUT SCREEN
         LA    R5,1(R5)                BUMP LENGTH OF OUTPUT
         BCT   R8,FSLOOP37             PROCESS N TIMES
         LA    R6,6(R6)                BUMP PAST EXPANSION COMMAND
         B     FSLOOP30
FSLOOP40 EQU   *
         MVC   0(1,R4),0(R6)           MOVE FLAG TO OUTPUT
         MVC   1(1,R4),0(R2)           MOVE ATTR TO OUTPUT
         LA    R2,4(R2)                BUMP TO NEXT ATTR
         LA    R4,2(R4)                BUMP TWO BYTES IN OUTPUT
         LA    R5,2(R5)                BUMP LENGTH BY TWO
         LA    R6,1(R6)                BUMP TO NEXT INPUT BYTE
         B     FSLOOP30                GO TRY NEXT BYTE
FSEXMVC  MVC   0(0,R4),0(R8)           MOVE SUFFIX TO OUTPUT
FSLOOP50 EQU   *
         XR    R1,R1                   CLEAR REGISTER
         IC    R1,ASUFXPTR             GET LENGTH TO MOVE
         BCTR  R1,0                    SUBTRACT ONE FOR MVC
         L     R8,ASUFXPTR             ADDR OF SUFFIX
         EX    R1,FSEXMVC              MOVE THE SUFFIX TO OUTPUT
         AR    R4,R1                   BUMP LENGTH OF SUFFIX
         AR    R5,R1                   BUMP LENGTH OF SUFFIX
         LA    R4,1(R4)                RESTORE 1 BYTE FROM EX
         LA    R5,1(R5)                RESTORE 1 BYTE FROM EX
*--> TGET'S AND TPUT'S
         CLI   STAXSW,C'1'             HAVE WE BEEN INTERRUPTED?
         BE    FSINTRPT                YES, RETURN TO ORIGINAL MENU
         L     R4,=A(SCRBLD)           GET ADDR OF OUTPUT
         TPUT  (R4),(R5),FULLSCR       PAINT OUTPUT SCREEN
         TGET  INPUT,50                GET INPUT
         OC    INPUT,=CL50' '          SET TO UPPERCASE
         CLI   STAXSW,C'1'             HAVE WE BEEN INTERRUPTED?
         BE    FSINTRPT                NO, CONTINUE
         CH    R1,=H'2'                DID WE GET ANYTHING?
         BL    EXIT500                 NO, EXIT
         LR    R3,R1                   COPY LENGTH FOR BCT
         LA    R2,INPUT                GET ADDRESS OF INPUT
FSCHKDIR EQU   *
         CLI   0(R2),C'='              DID USER WANT TO GO SOMEWHERE?
         BE    FSWILDGO                YEP, DO IT TO IT......
         LA    R2,1(R2)                BUMP PTR
         BCT   R3,FSCHKDIR             ITERATE
         B     EXIT500                 NOT FOUND, EXIT
FSWILDGO EQU   *
         MVC   INPUT+0(1),1(R2)        MOVE THE REQUESTED FUNCTION
         B     DRBYP002                RETURN TO MENU - WILD GOTO
FSINTRPT EQU   *
         TPUT  CLSCREEN,12,FULLSCR     CLEAR SCREEN
         MVI   STAXSW,C'0'             RESET INTERRUPT SWITCH
         B     DRBYPASS                RETURN TO MENU - WILD GOTO
         SPACE 1
EXIT500  EQU   *
         L     R9,SAVE500
         BR    R9
         EJECT
***********************************************************************
*  INPUT TO THIS ROUTINE IS AN 8 CHARACTER REPRESENTATION OF A FULL-  *
*  WORD HEX NUMBER.  THIS ROUTINE RIGHT-JUSTIFIES THE NUMBER, CHECKS  *
*  IT FOR ALLOWABLE CHARACTERS, PADS IT WITH ZEROES, AND TRANSLATES   *
*  IT INTO REAL HEX AND DECIMAL.                                      *
*  INPUT TO THE ROUTINE IS IN HDINPUT, OUTPUT IS HDOUTHEX, HDOUTDEC,  *
*  HDINPUT(NORMALIZED), AND HDRC.  HDRC=0 (GOOD), HDRC=1 (BAD)        *
***********************************************************************
         SPACE 2
HEXDEC   DS    0H
         ST    R9,SAVE510
         B     BSAVE510
SAVE510  DC    F'-1'
         DC    CL8'HEXDEC  '
BSAVE510 EQU   *
         SPACE 1
         MVI   HDRC,C'0'               INIT TO GOOD
*--> CHECK FOR VALID HEX CHARACTERS
         TRT   HDINPUT,TRTHEX          ANY INVALID CHARS?
         BC    7,HCVDBAD               GO PUT OUT BAD MESSAGE
*--> RIGHT-JUSTIFY HEX REPRESENTATION
         LA    R2,8                    GET LENGTH OF INPUT
HCVDFNDB EQU   *
         CLI   HDINPUT+7,C' '          IS IT A BLANK?
         BNE   HCVDNOTB                NO, FINISHED
         MVC   WORKDBLW+1(7),HDINPUT   MOVE FIRST 7
         MVI   WORKDBLW,C' '           REPLACE WITH A BLANK
         MVC   HDINPUT,WORKDBLW        MOVE IT BACK
         BCT   R2,HCVDFNDB             GO TRY NEXT
         B     HCVDBAD                 ALL BLANKS? - PUT OUT ERROR
HCVDNOTB EQU   *
*--> REPLACE LEADING BLANKS WITH ZEROES
         LA    R3,HDINPUT              GET BEGINNING ADDRESS
         LA    R2,8                    GET LENGTH
HCVDTRBL EQU   *
         CLI   0(R3),C' '              IS IT A BLANK?
         BNE   HCVDTR                  NO, GO TRANSLATE
         MVI   0(R3),C'0'              CHANGE IT TO A ZERO
         LA    R3,1(R3)                BUMP INDEX
         BCT   R2,HCVDTRBL             GO TRY NEXT BYTE
HCVDTR   EQU   *
*--> CHECK FOR ANY REMAINING BLANKS
         MVI   TRTHEX+C' ',X'FF'       CHANGE BLANKS TO INVALID
         TRT   HDINPUT,TRTHEX          ANY INVALID CHARS?
         BC    8,HCVDTR2               NO, GO ABOUT YOUR BUSINESS
         MVI   TRTHEX+C' ',X'00'       RESTORE TRT TABLE
         B     HCVDBAD                 GO PUT OUT BAD MESSAGE
HCVDTR2  EQU   *
         MVI   TRTHEX+C' ',X'00'       RESTORE TRT TABLE
*--> TRANSLATE HEX CHARS TO HEX NIBBLES AND CONVERT RADIX
         MVC   HDWORK,HDINPUT          COPY INPUT TO WORK
         TR    HDWORK,TRHEXNIB         TRANSLATE HEX TO NIBBLES
         LA    R2,8                    GET LENGTH
         LA    R3,HDWORK               GET BEGINNING ADDRESS
         XR    R4,R4                   CLEAR REGISTER
         XC    WORKDBLW,WORKDBLW       CLEAR WORK AREA
HCVDLOAD EQU   *
         MVC   WORKDBLW+3(1),0(R3)     MOVE TRANSLATED CHAR
         SLL   R4,4                    SHIFT LEFT 4 BITS
         O     R4,WORKDBLW             OR IN THE NIBBLE
         LA    R3,1(R3)                BUMP INDEX
         BCT   R2,HCVDLOAD             GO LOAD NEXT NIBBLE
         ST    R4,HDOUTHEX             STORE HEX OUTPUT
         CVD   R4,HDOUTDEC             STORE DEC OUTPUT
*--> REPLACE LEADING ZEROES WITH BLANKS IN HEX FIELD
         LA    R2,7                    GET LENGTH OF FIELD-1
         LA    R3,HDINPUT              GET BEGINNING OF FIELD
HCVDRPL0 EQU   *
         CLI   0(R3),C'0'              IS IT A ZERO?
         BNE   EXIT510                 NO, EXIT
         MVI   0(R3),C' '              REPLACE WITH A BLANK
         LA    R3,1(R3)                BUMP BY 1
         BCT   R2,HCVDRPL0             ITERATE THROUGH ZERO CHECK
         B     EXIT510                 BRANCH AROUND ERROR CODE
*--> FLAG AS BAD INPUT
HCVDBAD  EQU   *
         MVI   HDRC,C'1'               FLAG AS BAD
         SPACE 1
EXIT510  EQU   *
         L     R9,SAVE510
         BR    R9
         EJECT
***********************************************************************
*  INPUT TO THIS ROUTINE IS A 15-DIGIT DECIMAL NUMBER IN CHARACTER    *
*  FORMAT.  THIS ROUTINE RIGHT-JUSTIFIES THE NUMBER, CHECKS IT FOR    *
*  ALLOWABLE CHARACTERS, PADS IT WITH ZEROES, AND TRANSLATES IT INTO  *
*  REAL HEX AND DECIMAL.                                              *
*  INPUT TO RTN IS DHINPUT, OUTPUT IS DHOUTHEX, DHOUTDEC, DHOUTCHR,   *
*  DHINPUT(NORMALIZED), AND HDRC.  DHRC=0 (GOOD), DHRC=1 (BAD)        *
***********************************************************************
         SPACE 2
DECHEX   DS    0H
         ST    R9,SAVE520
         B     BSAVE520
SAVE520  DC    F'-1'
         DC    CL8'DECHEX  '
BSAVE520 EQU   *
         SPACE 1
         MVI   DHRC,C'0'               INIT TO GOOD
         MVI   DHNEG,C'+'              INITIALIZE TO POSITIVE
*--> CHECK FOR NEGATIVE SIGN
         XC    TRCOMMON,TRCOMMON       CLEAR COMMON TRT AREA
         MVI   TRCOMMON+C'+',C'+'      INSERT A PLUS SIGN
         TRT   DHINPUT,TRCOMMON        DID USER TYPE IN A PLUS SIGN?
         BC    8,HCVBTRYD              GO TRY DASH
         MVI   0(R1),C' '              REPLACE PLUS SIGN WITH BLANK
         B     HCVBRTJS                GO RIGHT-JUSTIFY
HCVBTRYD EQU   *
         MVI   TRCOMMON+C'+',X'00'     CLEAR PLUS SIGN FROM TRT AREA
         MVI   TRCOMMON+C'-',C'-'      INSERT A DASH
         TRT   DHINPUT,TRCOMMON        DID USER TYPE IN NEGATIVE SIGN?
         MVI   TRCOMMON+C'-',X'00'     CLEAR DASH FROM TRT AREA
         BC    8,HCVBRTJS              GO RIGHT-JUSTIFY
         MVI   0(R1),C' '              REPLACE NEG SIGN WITH BLANK
         MVI   DHNEG,C'-'              SET SIGN SWITCH TO NEGATIVE
*--> CHECK FOR ILLEGALS THEN RIGHT-JUSTIFY
HCVBRTJS EQU   *
         TRT   DHINPUT,TRTDEC          ANY INVALID CHARS?
         BC    7,HCVBBAD               GO PUT OUT BAD MESSAGE
         LA    R2,16                   GET LENGTH OF INPUT
HCVBFNDB EQU   *
         CLI   DHINPUT+15,C' '         IS IT A BLANK?
         BNE   HCVBNOTB                NO, FINISHED
         MVC   WORK16+1(15),DHINPUT    MOVE FIRST 15
         MVI   WORK16,C' '             REPLACE WITH A BLANK
         MVC   DHINPUT,WORK16          MOVE IT BACK
         BCT   R2,HCVBFNDB             GO TRY NEXT
         B     HCVBBAD                 ALL BLANKS? - PUT OUT ERROR
HCVBNOTB EQU   *
*--> REPLACE LEADING BLANKS WITH ZEROES
         LA    R3,DHINPUT              GET BEGINNING ADDRESS
         LA    R2,16                   GET LENGTH
HCVBTRBL EQU   *
         CLI   0(R3),C' '              IS IT A BLANK?
         BNE   HCVBTR                  NO, GO TRANSLATE
         MVI   0(R3),C'0'              CHANGE IT TO A ZERO
         LA    R3,1(R3)                BUMP INDEX
         BCT   R2,HCVBTRBL             GO TRY NEXT BYTE
HCVBTR   EQU   *
*--> CHECK FOR ANY REMAINING BLANKS
         MVI   TRTDEC+C' ',X'FF'       CHANGE BLANKS TO INVALID
         TRT   DHINPUT,TRTDEC          ANY INVALID CHARS?
         BC    8,HCVBTR2               NO, GO ABOUT YOUR BUSINESS
         MVI   TRTDEC+C' ',X'00'       RESTORE TRT TABLE
         B     HCVBBAD                 GO PUT OUT BAD MESSAGE
HCVBTR2  EQU   *
         MVI   TRTDEC+C' ',X'00'       RESTORE TRT TABLE
*--> TRANSLATE DECIMAL NUMBER TO HEX
         PACK  DHOUTDEC,DHINPUT        PACK INPUT
         MVC   DHINPUT(15),DHINPUT+1   SHIFT LEFT 1 BYTE
         MVC   DHINPUT+15(1),DHNEG     INDICATE NEG OR POSITIVE
         CLI   DHNEG,C'+'              IS IT POSITIVE?
         BE    HCVBYPCS                BYPASS CHANGE SIGN
         NI    DHOUTDEC+7,X'F0'        TURN OFF BITS IN SIGN
         OI    DHOUTDEC+7,X'0D'        INDICATE NEGATIVE
HCVBYPCS EQU   *
         CVB   R2,DHOUTDEC             CONVERT TO BINARY
         ST    R2,DHOUTHEX             STORE HEX VERSION
         LA    R3,8                    GET NUMBER OF NIBBLES
         LA    R4,DHOUTCHR+7           GET BEGIN ADDRESS
HCVBCHR1 EQU   *
         STC   R2,0(R4)                STORE LOW-ORDER NIBBLE
         SRL   R2,4                    SHIFT RIGHT ONE NIBBLE
         BCTR  R4,0                    SUBTRACT ONE FROM INDEX
         BCT   R3,HCVBCHR1             ITERATE 8 TIMES
         NC    DHOUTCHR,=8XL1'0F'      AND OUT HIGH ORDER NIBBLE
         TR    DHOUTCHR,TRHEXCHR       TRANSLATE TO REAL CHARACTERS
*--> REPLACE LEADING ZEROES WITH BLANKS IN HEX FIELD
         LA    R2,7                    GET LENGTH OF FIELD-1
         LA    R3,DHOUTCHR             GET BEGINNING OF FIELD
HCVBRPL0 EQU   *
         CLI   0(R3),C'0'              IS IT A ZERO?
         BNE   HCVBRPL1                NO, EXIT
         MVI   0(R3),C' '              REPLACE WITH A BLANK
         LA    R3,1(R3)                BUMP BY 1
         BCT   R2,HCVBRPL0             ITERATE THROUGH ZERO CHECK
*--> REPLACE LEADING ZEROES WITH BLANKS IN DEC FIELD
HCVBRPL1 EQU   *
         LA    R2,14                   GET LENGTH OF FIELD-1
         LA    R3,DHINPUT              GET BEGINNING OF FIELD
HCVBRPL2 EQU   *
         CLI   0(R3),C'0'              IS IT A ZERO?
         BNE   EXIT520                 NO, EXIT
         MVI   0(R3),C' '              REPLACE WITH A BLANK
         LA    R3,1(R3)                BUMP BY 1
         BCT   R2,HCVBRPL2             ITERATE THROUGH ZERO CHECK
         B     EXIT520                 BYPASS ERROR CODE
*--> FLAG AS BAD INPUT
HCVBBAD  EQU   *
         MVI   DHRC,C'1'               FLAG AS BAD
         SPACE 1
EXIT520  EQU   *
         L     R9,SAVE520
         BR    R9
         EJECT
***********************************************************************
*    THIS ROUTINE HANDLES ALL PRELIMINARY EDITING AND CONVERSION FOR  *
*  THE HIGHER LEVEL ROUTINES THAT PERFORM DYADIC OPERATIONS SUCH AS   *
*  ADDITION AND MULTIPLICATION.  AT ENTRY TO THE ROUTINE, THE INPUT   *
*  IS LOCATED IN THE 'INPUT' INPUT BUFFER.                            *
***********************************************************************
         SPACE 2
DYADIC   DS    0H
         ST    R9,SAVE530
         B     BSAVE530
SAVE530  DC    F'-1'
         DC    CL8'DYADIC  '
BSAVE530 EQU   *
         SPACE 1
         XR    R15,R15                   CLEAR RETURN CODE REGISTER
         MVC   DIDATA1,=CL50' '          INIT DATA 1
         MVC   DIDATA2,=CL50' '          INIT DATA 2
         MVI   DIRADIX1,C' '             INIT RADIX 1
         MVI   DIRADIX2,C' '             INIT RADIX 2
         MVI   DIRADIX3,C' '             INIT RADIX 3
*--> MOVE THE INPUT DATA FROM THE INPUT AREA TO THE FORMAT AREA
         LA    R3,INPUT                GET ORIGIN ADDRESS
         AR    R3,R1                   ADD THE INPUT LENGTH
         MVI   1(R3),C':'              FLAG LAST BYTE
         LA    R3,5                    GET COUNT FOR BCT
         XC    TRCOMMON,TRCOMMON       CLEAR TRT AREA
         MVI   TRCOMMON+C':',C':'      SET CHAR FOR SEARCH
         LA    R4,INPUT+2              SET BASE ADDRESS
         LA    R5,DPEXMVC              SET EXMVC INDEX REGISTER
DPLOOP01 EQU   *
         TRT   0(18,R4),TRCOMMON       FIND NEXT COLON
         LR    R6,R1                   SAVE R1
         SR    R1,R4                   SUBTRACT BASE OF FIELD
         BCTR  R1,0                    SUBTRACT 1 FOR BYTE BEFORE COLON
         LTR   R1,R1                   IS LENGTH=0?
         BZ    DPBYPEX                 YES, BYPASS THE MOVE
         BCTR  R1,0                    SUBTRACT 1 FOR EX MVC
         EX    R1,0(R5)                EXECUTE THE MOVE
DPBYPEX  EQU   *
         LA    R5,6(R5)                BUMP TO NEXT EXECUTED MVC
         LR    R4,R6                   COPY SAVED REGISTER
         LA    R4,1(R4)                BUMP PAST CURRENT COLON
         BCT   R3,DPLOOP01             ITERATE 5 TIMES
         B     DPRADIX                 GO CHECK RADIX
DPEXMVC  MVC   DIRADIX1(0),0(R4)       MOVE RADIX 1
         MVC   DIDATA1(0),0(R4)        MOVE DATA 1
         MVC   DIRADIX2(0),0(R4)       MOVE RADIX 2
         MVC   DIDATA2(0),0(R4)        MOVE DATA 2
         MVC   DIRADIX3(0),0(R4)       MOVE RADIX 3
*--> CHECK THAT RADIX ITEMS ARE ALLOWABLE
DPRADIX  EQU   *
         MVI   TRCOMMON,X'FF'          SET UP TRT AREA
         MVC   TRCOMMON+1(255),TRCOMMON
         MVI   TRCOMMON+C'D',X'00'     ALLOW D=DECIMAL
         MVI   TRCOMMON+C'X',X'00'           X=HEX
         TRT   DIRADIX1,TRCOMMON       RADIX 1 OK?
         BC    7,DPERR04               GO FLAG ERROR RC=04
         TRT   DIRADIX2,TRCOMMON       RADIX 2 OK?
         BC    7,DPERR08               GO FLAG ERROR RC=08
         TRT   DIRADIX3,TRCOMMON       RADIX 3 OK?
         BC    7,DPERR12               GO FLAG ERROR RC=12
*--> CHECK THE DATA ITEMS FOR DECIMAL
         CLI   DIRADIX1,C'D'           DECIMAL?
         BNE   DPCHKD2                 NO, CHECK RADIX 2 : DEC
         MVC   DHINPUT,DIDATA1         SET INPUT UP
         BAL   R9,DECHEX               CALL REFORMAT ROUTINE
         MVC   DIDATA1,DHINPUT         MOVE REFORMATTED INPUT
         CLI   DHRC,C'1'               DID IT GO OK?
         BE    DPERR16                 NO, FLAG ERROR RC=16
         ZAP   RESULT1,DHOUTDEC        SAVE RESULT IN RESULT1
DPCHKD2  EQU   *
         CLI   DIRADIX2,C'D'           DECIMAL?
         BNE   DPCHKX1                 NO, CHECK RADIX 1 : HEX
         MVC   DHINPUT,DIDATA2         SET INPUT UP
         BAL   R9,DECHEX               CALL REFORMAT ROUTINE
         MVC   DIDATA2,DHINPUT         MOVE REFORMATTED INPUT
         CLI   DHRC,C'1'               DID IT GO OK?
         BE    DPERR20                 NO, FLAG ERROR RC=20
         ZAP   RESULT2,DHOUTDEC        SAVE RESULT IN RESULT2
*--> CHECK THE DATA ITEMS FOR HEX; LEFT JUSTIFY AND CONVERT
DPCHKX1  EQU   *
         CLI   DIRADIX1,C'D'           DECIMAL?
         BE    DPCHKX2                 YES, ALREADY CHECKED ABOVE
         LA    R2,8                    NUMBER OF BYTES
         LA    R3,DIDATA1              GET BEGINNING ADDRESS
DPX1LP01 EQU   *
         CLI   0(R3),C' '              IS THIS A BLANK?
         BNE   DPX1LP02                NO, BREAK OUT OF LOOP
         MVC   DIDATA1(15),DIDATA1+1   SHIFT LEFT ONE BYTE
         MVI   DIDATA1+15,C' '         CLEAR SLACK BYTE
         BCT   R2,DPX1LP01             ITERATE 8 TIMES
DPX1LP02 EQU   *
         MVC   HDINPUT,DIDATA1         SET INPUT UP
         BAL   R9,HEXDEC               CALL REFORMAT ROUTINE
         MVC   DIDATA1+0(8),=CL50' '   CLEAR BEGINNING PART
         MVC   DIDATA1+8(8),HDINPUT    MOVE REFORMATTED INPUT
         CLI   HDRC,C'1'               DID IT GO OK?
         BE    DPERR16                 NO, FLAG ERROR RC=16
         ZAP   RESULT1,HDOUTDEC        SAVE RESULT IN RESULT1
DPCHKX2  EQU   *
         CLI   DIRADIX2,C'D'           DECIMAL?
         BE    EXIT530                 YES, ALREADY CHECKED:EXIT RTN
         LA    R2,8                    NUMBER OF BYTES
         LA    R3,DIDATA2              GET BEGINNING ADDRESS
DPX2LP01 EQU   *
         CLI   0(R3),C' '              IS THIS A BLANK?
         BNE   DPX2LP02                NO, BREAK OUT OF LOOP
         MVC   DIDATA2(15),DIDATA2+1   SHIFT LEFT ONE BYTE
         MVI   DIDATA2+15,C' '         CLEAR SLACK BYTE
         BCT   R2,DPX2LP01             ITERATE 8 TIMES
DPX2LP02 EQU   *
         MVC   HDINPUT,DIDATA2         SET INPUT UP
         BAL   R9,HEXDEC               CALL REFORMAT ROUTINE
         MVC   DIDATA2+0(8),=CL50' '   CLEAR BEGINNING PART
         MVC   DIDATA2+8(8),HDINPUT    MOVE REFORMATTED INPUT
         CLI   HDRC,C'1'               DID IT GO OK?
         BE    DPERR20                 NO, FLAG ERROR RC=20
         ZAP   RESULT2,HDOUTDEC        SAVE RESULT IN RESULT2
         B     EXIT530                 EXIT RTN
DPERR04  EQU   *
         LA    R15,4                   INDICATE RADIX 1 NO GOOD
         B     EXIT530                 EXIT RTN
DPERR08  EQU   *
         LA    R15,8                   INDICATE RADIX 2 NO GOOD
         B     EXIT530                 EXIT RTN
DPERR12  EQU   *
         LA    R15,12                  INDICATE RADIX 3 NO GOOD
         B     EXIT530                 EXIT RTN
DPERR16  EQU   *
         LA    R15,16                  INDICATE DATA 1 NOT DECIMAL
         B     EXIT530                 EXIT RTN
DPERR20  EQU   *
         LA    R15,20                  INDICATE DATA 2 NOT DECIMAL
         B     EXIT530                 EXIT RTN
         SPACE 1
EXIT530  EQU   *
         L     R9,SAVE530
         BR    R9
         EJECT
***********************************************************************
*           W O R K I N G   S T O R A G E   S E C T I O N             *
***********************************************************************
         SPACE 2
WORKDBLW DC    D'0'                    HEX/DECIMAL CONVERSION AREA
WORK16   DC    2D'0'                   DEC/HEX WORK AREA
RESULT1  DC    PL16'0'                 RESULT 1 FROM DYADIC ROUTINE
RESULT2  DC    PL16'0'                 RESULT 2 FROM DYADIC ROUTINE
RESULT3  DC    PL16'0'                 RESULT 3 FROM PROCESSORS
REMAIN   DC    PL16'0'                 REMAINDER FROM DIVIDE PROC
DIVWORK1 DC    PL9'0'                  WORK AREA FOR DIVIDE PROC
RESULTSW DC    CL1'0'                  0=NO RESULT99, 1=CURR RESULT99
RESULTRD DC    CL1'D'                  RESULT RADIX = D/X
RESULT99 DC    PL16'0'                 RESULT FROM LAST OPERATION
MSG1     DC    CL17'STAX MACRO FAILED'
ENDLNE01 DC    CL40'-------------- ENTER MENU OPTION NUMBER '
         DC    CL40'DESIRED THEN PRESS ENTER ---------------'
ENDLNE02 DC    CL40'----------------- CORRECT OPTION NUMBER '
         DC    CL40'AND THEN PRESS ENTER -------------------'
ENDLNE03 DC    CL40'----------------- OPTION NOT IN USE - CO'
         DC    CL40'RRECT AND PRESS ENTER ------------------'
ENDLNE05 DC    CL40'------------------------- TO RETURN TO M'
         DC    CL40'ENU PRESS PA1 --------------------------'
ENDLNE06 DC    CL40'------------ INVALID VALUE ENTERED, PLEA'
         DC    CL40'SE CORRECT AND PRESS ENTER -------------'
ENDLNE07 DC    CL40'---------------- MORE CHARACTERS DELETED'
         DC    CL40' THAN INSERTED -------------------------'
ENDLNE08 DC    CL40'---------------- CHOOSE EITHER ROW/COLUM'
         DC    CL40'N OR BUFFER INPUT ----------------------'
INPUT    DC    CL50' '                 INPUT FROM TERMINAL VIA TGET
STAXSW   DC    CL1'0'                  INTERRUPTED, YES/NO
EDUNPK   DC    XL16'40202020202020202020202020202120'
DECEDIT  DC    XL21'402020206B2020206B2020206B2020206B20212060'
DECEDIT2 DC    XL18'40202020206B2020206B2020206B2020206B'
         DC    XL16'2020206B2020206B2020206B20212060'
DEFRADIX EQU   C'D'                    DEFAULT RADIX
*--> WORK DATA ITEMS FOR 3270 TRANSLATION ROUTINE
R327FLD1 DS    F                       WORK AREA
R327FLD2 DS    F                       WORK AREA
*--> WORK DATA ITEMS FOR HEXDEC ROUTINE
HDOUTHEX DS    F                       OUTPUT FROM HEXDEC RTN:HEX
HDINPUT  DS    CL8                     INPUT TO HEXDEC RTN
HDWORK   DS    CL8                     WORKAREA FOR HEXDEC RTN
HDOUTDEC DS    PL8                     OUTPUT FROM HEXDEC RTN:DEC
HDRC     DS    CL1                     RETURN CODE FROM HEXDEC RTN
*--> WORK DATA ITEMS FOR DECHEX ROUTINE
DHOUTDEC DS    PL8                     OUTPUT FROM DECHEX RTN:DEC
DHINPUT  DS    CL16                    INPUT TO DECHEX RTN
DHWORK   DS    CL8                     WORKAREA FOR DECHEX RTN
DHOUTCHR DS    CL8                     OUTPUT FROM DECHEX RTN:CHAR
DHOUTHEX DS    F                       OUTPUT FROM DECHEX RTN:HEX
DHRC     DS    CL1                     RETURN CODE FROM DECHEX RTN
DHNEG    DC    CL1'+'                  '+'=POS, '-'=NEG
*--> WORK AREA FOR THE DYADIC ROUTINE
DYADIN   DS    0CL45                   STRUCTURED INPUT FIELD
         DC    CL2'1:'
DIRADIX1 DS    CL1                     D=DECIMAL, X=HEX
         DC    CL2'2:'
DIDATA1  DS    CL16                    DATA NUMBER 1
         DC    CL2'3:'
DIRADIX2 DS    CL1                     D=DECIMAL, X=HEX
         DC    CL2'4:'
DIDATA2  DS    CL16                    DATA NUMBER 2
         DC    CL2'5:'
DIRADIX3 DS    CL1                     D=DECIMAL, X=HEX
*--> TRT TABLES
TRTHEX   DC    256XL1'FF'              ALL CHARS OTHER THAN
         ORG   TRTHEX+C'0'
         DC    10XL1'00'                   0-9
         ORG   TRTHEX+C'A'
         DC    6XL1'00'                    A-F
         ORG   TRTHEX+C' '
         DC    1XL1'00'                    BLANK
         ORG
TRTDEC   DC    256XL1'FF'              ALL CHARS OTHER THAN
         ORG   TRTDEC+C'0'
         DC    10XL1'00'                   0-9
         ORG   TRTDEC+C' '
         DC    1XL1'00'                    BLANK
         ORG
TRHEXNIB DC    256XL1'00'              DEFAULT CHARACTERS ARE ZERO
         ORG   TRHEXNIB+C'0'
         DC    XL10'00010203040506070809'  0-9
         ORG   TRHEXNIB+C'A'
         DC    XL6'0A0B0C0D0E0F'           A-F
         ORG
TRHEXCHR DC    CL16'0123456789ABCDEF'  TRANSLATE HEX TO HEX CHARS
TRCOMMON DC    XL256'00'               COMMON TRT AREA
*--> IBM 3270 BASE 64 ENCODING TABLE (IS THERE A ROUTINE SOMEWHERE?)
TABLE327 EQU   *
         DC    C'40C1C2C3C4C5C6C7C8C94A4B4C4D4E4F'
         DC    C'50D1D2D3D4D5D6D7D8D95A5B5C5D5E5F'
         DC    C'6061E2E3E4E5E6E7E8E96A6B6C6D6E6F'
         DC    C'F0F1F2F3F4F5F6F7F8F97A7B7C7D7E7F'
         SPACE 2
         LTORG                         LITERAL POOL
         SPACE 2
         EJECT
*--> THE FOLLOWING ARE USED BY THE 'FULLSCR' ROUTINE
CLSCREEN DC    XL12'C11140403C4040001140C113'
SCPREFIX DC    XL11'C11140403C404000114040'
         SPACE 1
ALISTPTR DC    A(0)                    PTR TO ACTIVE ATTR LIST
ASCRNPTR DC    A(0)                    PTR TO ACTIVE INPUT SCREEN
ASCRPTRE DC    A(0)                    PTR TO END OF ACTIVE SCREEN
ASUFXPTR DC    A(0)                    LENGTH/PTR TO SUFFIX
         SPACE 1
ATRLST1B DS    0F
         DC    A(ATRLST1E)             END OF THIS LIST
         DC    AL1(ATR@PH)
         DC    AL3(SC1LN01+00)         FIRST BYTE OF SCREEN
         DC    AL1(ATR@UH)
         DC    AL3(SC1LN03+79)         MENU OPTION NUMBER
         DC    AL1(ATR@PH)
         DC    AL3(SC1LN04+01)         REST OF MENU SCREEN
ATRLST1E EQU   *
         SPACE 1
ATRLST2B DS    0F
         DC    A(ATRLST2E)             END OF THIS LIST
         DC    AL1(ATR@PH)
         DC    AL3(SC2LN01+00)         FIRST BYTE OF SCREEN
         DC    AL1(ATR@PL)
         DC    AL3(SC2LN04+00)
         DC    AL1(ATR@PH)
         DC    AL3(SC2LN04+79)
         DC    AL1(ATR@UH)
         DC    AL3(SC2LN07+79)         BEGIN OF HEX NUMBER
         DC    AL1(ATR@PH)
         DC    AL3(SC2LN08+08)         END OF HEX NUMBER
         DC    AL1(ATR@PL)
         DC    AL3(SC2LN09+79)         BEGIN OF DEC NUMBER
         DC    AL1(ATR@PH)
         DC    AL3(SC2LN10+21)         END OF DEC NUMBER
ATRLST2E EQU   *
         SPACE 1
ATRLST3B DS    0F
         DC    A(ATRLST3E)             END OF THIS LIST
         DC    AL1(ATR@PH)
         DC    AL3(SC3LN01+00)         FIRST BYTE OF SCREEN
         DC    AL1(ATR@PL)
         DC    AL3(SC3LN04+00)
         DC    AL1(ATR@PH)
         DC    AL3(SC3LN04+79)
         DC    AL1(ATR@UH)
         DC    AL3(SC3LN07+79)         BEGIN OF DEC NUMBER
         DC    AL1(ATR@PH)
         DC    AL3(SC3LN08+16)         END OF DEC NUMBER
         DC    AL1(ATR@PL)
         DC    AL3(SC3LN09+79)         BEGIN OF DEC NUMBER
         DC    AL1(ATR@PH)
         DC    AL3(SC3LN10+08)         END OF HEX NUMBER
ATRLST3E EQU   *
         SPACE 1
ATRLST4B DS    0F
         DC    A(ATRLST4E)             END OF THIS LIST
         DC    AL1(ATR@PH)
         DC    AL3(SC4LN01+00)         FIRST BYTE OF SCREEN
         DC    AL1(ATR@PL)
         DC    AL3(SC4LN04+00)
         DC    AL1(ATR@PH)
         DC    AL3(SC4LN04+79)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC4LN08+00)         NOTE NUMBER 1
         DC    AL1(ATR@UHMO)
         DC    AL3(SC4LN08+03)         RADIX NUMBER 1
         DC    AL1(ATR@PHS)
         DC    AL3(SC4LN08+05)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC4LN08+27)         NOTE NUMBER 2
         DC    AL1(ATR@UHMO)
         DC    AL3(SC4LN08+30)         ADD DATA NUMBER 1
         DC    AL1(ATR@PHS)
         DC    AL3(SC4LN08+47)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC4LN10+00)         NOTE NUMBER 3
         DC    AL1(ATR@UHMO)
         DC    AL3(SC4LN10+03)         RADIX NUMBER 2
         DC    AL1(ATR@PHS)
         DC    AL3(SC4LN10+05)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC4LN10+27)         NOTE NUMBER 4
         DC    AL1(ATR@UHMO)
         DC    AL3(SC4LN10+30)         ADD DATA NUMBER 2
         DC    AL1(ATR@PHS)
         DC    AL3(SC4LN10+47)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC4LN14+00)         NOTE NUMBER 5
         DC    AL1(ATR@UHMO)
         DC    AL3(SC4LN14+03)         RADIX NUMBER 3
         DC    AL1(ATR@PHS)
         DC    AL3(SC4LN14+05)
         DC    AL1(ATR@PL)
         DC    AL3(SC4LN14+30)         RESULT NUMBER 1
         DC    AL1(ATR@PH)
         DC    AL3(SC4LN14+65)
         DC    AL1(ATR@PL)
         DC    AL3(SC4LN17+00)         NOTE NUMBER 1:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC4LN17+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC4LN18+00)         NOTE NUMBER 2:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC4LN18+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC4LN19+00)         NOTE NUMBER 3:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC4LN19+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC4LN20+00)         NOTE NUMBER 4:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC4LN20+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC4LN21+00)         NOTE NUMBER 5:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC4LN21+03)
ATRLST4E EQU   *
         SPACE 1
ATRLST5B DS    0F
         DC    A(ATRLST5E)             END OF THIS LIST
         DC    AL1(ATR@PH)
         DC    AL3(SC5LN01+00)         FIRST BYTE OF SCREEN
         DC    AL1(ATR@PL)
         DC    AL3(SC5LN04+00)
         DC    AL1(ATR@PH)
         DC    AL3(SC5LN04+79)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC5LN08+00)         NOTE NUMBER 1
         DC    AL1(ATR@UHMO)
         DC    AL3(SC5LN08+03)         RADIX NUMBER 1
         DC    AL1(ATR@PHS)
         DC    AL3(SC5LN08+05)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC5LN08+27)         NOTE NUMBER 2
         DC    AL1(ATR@UHMO)
         DC    AL3(SC5LN08+30)         SUBTRACT FROM NUMBER
         DC    AL1(ATR@PHS)
         DC    AL3(SC5LN08+47)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC5LN10+00)         NOTE NUMBER 3
         DC    AL1(ATR@UHMO)
         DC    AL3(SC5LN10+03)         RADIX NUMBER 2
         DC    AL1(ATR@PHS)
         DC    AL3(SC5LN10+05)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC5LN10+27)         NOTE NUMBER 4
         DC    AL1(ATR@UHMO)
         DC    AL3(SC5LN10+30)         SUBTRACT NUMBER
         DC    AL1(ATR@PHS)
         DC    AL3(SC5LN10+47)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC5LN14+00)         NOTE NUMBER 5
         DC    AL1(ATR@UHMO)
         DC    AL3(SC5LN14+03)         RADIX NUMBER 3
         DC    AL1(ATR@PHS)
         DC    AL3(SC5LN14+05)
         DC    AL1(ATR@PL)
         DC    AL3(SC5LN14+30)         RESULT NUMBER 1
         DC    AL1(ATR@PH)
         DC    AL3(SC5LN14+65)
         DC    AL1(ATR@PL)
         DC    AL3(SC5LN17+00)         NOTE NUMBER 1:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC5LN17+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC5LN18+00)         NOTE NUMBER 2:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC5LN18+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC5LN19+00)         NOTE NUMBER 3:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC5LN19+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC5LN20+00)         NOTE NUMBER 4:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC5LN20+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC5LN21+00)         NOTE NUMBER 5:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC5LN21+03)
ATRLST5E EQU   *
         SPACE 1
ATRLST6B DS    0F
         DC    A(ATRLST6E)             END OF THIS LIST
         DC    AL1(ATR@PH)
         DC    AL3(SC6LN01+00)         FIRST BYTE OF SCREEN
         DC    AL1(ATR@PL)
         DC    AL3(SC6LN04+00)
         DC    AL1(ATR@PH)
         DC    AL3(SC6LN04+79)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC6LN08+00)         NOTE NUMBER 1
         DC    AL1(ATR@UHMO)
         DC    AL3(SC6LN08+03)         RADIX NUMBER 1
         DC    AL1(ATR@PHS)
         DC    AL3(SC6LN08+05)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC6LN08+27)         NOTE NUMBER 2
         DC    AL1(ATR@UHMO)
         DC    AL3(SC6LN08+30)         1ST # TO MULTIPLY
         DC    AL1(ATR@PHS)
         DC    AL3(SC6LN08+47)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC6LN10+00)         NOTE NUMBER 3
         DC    AL1(ATR@UHMO)
         DC    AL3(SC6LN10+03)         RADIX NUMBER 2
         DC    AL1(ATR@PHS)
         DC    AL3(SC6LN10+05)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC6LN10+27)         NOTE NUMBER 4
         DC    AL1(ATR@UHMO)
         DC    AL3(SC6LN10+30)         2ND # TO MULTIPLY
         DC    AL1(ATR@PHS)
         DC    AL3(SC6LN10+47)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC6LN14+00)         NOTE NUMBER 5
         DC    AL1(ATR@UHMO)
         DC    AL3(SC6LN14+03)         RADIX NUMBER 3
         DC    AL1(ATR@PHS)
         DC    AL3(SC6LN14+05)
         DC    AL1(ATR@PL)
         DC    AL3(SC6LN14+30)         RESULT NUMBER 1
         DC    AL1(ATR@PH)
         DC    AL3(SC6LN14+65)
         DC    AL1(ATR@PL)
         DC    AL3(SC6LN17+00)         NOTE NUMBER 1:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC6LN17+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC6LN18+00)         NOTE NUMBER 2:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC6LN18+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC6LN19+00)         NOTE NUMBER 3:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC6LN19+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC6LN20+00)         NOTE NUMBER 4:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC6LN20+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC6LN21+00)         NOTE NUMBER 5:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC6LN21+03)
ATRLST6E EQU   *
         SPACE 1
ATRLST7B DS    0F
         DC    A(ATRLST7E)             END OF THIS LIST
         DC    AL1(ATR@PH)
         DC    AL3(SC7LN01+00)         FIRST BYTE OF SCREEN
         DC    AL1(ATR@PL)
         DC    AL3(SC7LN04+00)
         DC    AL1(ATR@PH)
         DC    AL3(SC7LN04+79)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC7LN08+00)         NOTE NUMBER 1
         DC    AL1(ATR@UHMO)
         DC    AL3(SC7LN08+03)         RADIX NUMBER 1
         DC    AL1(ATR@PHS)
         DC    AL3(SC7LN08+05)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC7LN08+27)         NOTE NUMBER 2
         DC    AL1(ATR@UHMO)
         DC    AL3(SC7LN08+30)         DIVIDEND
         DC    AL1(ATR@PHS)
         DC    AL3(SC7LN08+47)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC7LN10+00)         NOTE NUMBER 3
         DC    AL1(ATR@UHMO)
         DC    AL3(SC7LN10+03)         RADIX NUMBER 2
         DC    AL1(ATR@PHS)
         DC    AL3(SC7LN10+05)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC7LN10+27)         NOTE NUMBER 4
         DC    AL1(ATR@UHMO)
         DC    AL3(SC7LN10+30)         DIVISOR
         DC    AL1(ATR@PHS)
         DC    AL3(SC7LN10+47)
         DC    AL1(ATR@PLMO)
         DC    AL3(SC7LN14+00)         NOTE NUMBER 5
         DC    AL1(ATR@UHMO)
         DC    AL3(SC7LN14+03)         RADIX NUMBER 3
         DC    AL1(ATR@PHS)
         DC    AL3(SC7LN14+05)
         DC    AL1(ATR@PL)
         DC    AL3(SC7LN14+30)         RESULT NUMBER 1
         DC    AL1(ATR@PH)
         DC    AL3(SC7LN14+65)
         DC    AL1(ATR@PL)
         DC    AL3(SC7LN15+30)         REMAINDER
         DC    AL1(ATR@PH)
         DC    AL3(SC7LN15+65)
         DC    AL1(ATR@PL)
         DC    AL3(SC7LN17+00)         NOTE NUMBER 1:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC7LN17+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC7LN18+00)         NOTE NUMBER 2:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC7LN18+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC7LN19+00)         NOTE NUMBER 3:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC7LN19+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC7LN20+00)         NOTE NUMBER 4:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC7LN20+03)
         DC    AL1(ATR@PL)
         DC    AL3(SC7LN21+00)         NOTE NUMBER 5:EXPLANATION
         DC    AL1(ATR@PH)
         DC    AL3(SC7LN21+03)
ATRLST7E EQU   *
         SPACE 1
ATRLST8B DS    0F
         DC    A(ATRLST8E)             END OF THIS LIST
         DC    AL1(ATR@PHS)
         DC    AL3(SC8LN01+00)         FIRST BYTE OF SCREEN
         DC    AL1(ATR@PLS)
         DC    AL3(SC8LN04+00)
         DC    AL1(ATR@PHS)
         DC    AL3(SC8LN04+79)
         DC    AL1(ATR@UHNM)
         DC    AL3(SC8LN09+02)         MODEL NUMBER
         DC    AL1(ATR@PHS)
         DC    AL3(SC8LN09+04)
         DC    AL1(ATR@UHNM)
         DC    AL3(SC8LN12+01)         ROW NUMBER
         DC    AL1(ATR@PHS)
         DC    AL3(SC8LN12+04)
         DC    AL1(ATR@PLS)
         DC    AL3(SC8LN12+74)         SCREEN ADDRESS (DECIMAL)
         DC    AL1(ATR@UHNM)
         DC    AL3(SC8LN13+00)         COLUMN NUMBER
         DC    AL1(ATR@PHS)
         DC    AL3(SC8LN13+04)
         DC    AL1(ATR@PLS)
         DC    AL3(SC8LN13+74)         SCREEN ADDRESS (HEX)
         DC    AL1(ATR@UHMO)
         DC    AL3(SC8LN16+01)         FIRST BYTE OF BUFFER ADDRESS
         DC    AL1(ATR@PHS)
         DC    AL3(SC8LN16+04)
         DC    AL1(ATR@UHMO)
         DC    AL3(SC8LN17+01)         SECOND BYTE OF BUFFER ADDRESS
         DC    AL1(ATR@PHS)
         DC    AL3(SC8LN17+04)
         DC    AL1(ATR@PLS)
         DC    AL3(SC8LN20+00)         NOTE
         DC    AL1(ATR@PHS)
         DC    AL3(SC8LN22+79)
ATRLST8E EQU   *
         SPACE 1
ATR@PL   EQU X'60'              PROTECT-LOW  / BLUE  /
ATR@PLS  EQU X'F0'              PROTECT-LOW  / BLUE  / SKIP
ATR@PLMO EQU X'61'              PROTECT-LOW  / BLUE  / MDT ON
ATR@PH   EQU X'E8'              PROTECT-HIGH / WHITE /
ATR@PHS  EQU X'F8'              PROTECT-HIGH / WHITE / SKIP
ATR@PHMO EQU X'E9'              PROTECT-HIGH / WHITE / MDT ON
ATR@UL   EQU X'40'              UNPROT-LOW   / GREEN /
ATR@ULMO EQU X'C1'              UNPROT-LOW   / GREEN / MDT ON
ATR@UH   EQU X'C8'              UNPROT-HIGH  / RED   /
ATR@UHMO EQU X'C9'              UNPROT-HIGH  / RED   / MDT ON
ATR@UHNM EQU X'D9'              UNPROT-HIGH  / RED   / MDT ON / NUMERIC
         EJECT
SCREEN1  EQU   *
SC1LN01  DC    CL40'                  T S O   A R I T H M E '
         DC    CL40'T I C   C O M M A N D                   ',C'|0080-'
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
SC1LN03  DC    CL40'                                        '
         DC    CL40'                                        '
SC1LN04  DC    CL40'  <==== ENTER OPTION DESIRED FROM MENU B'
         DC    CL40'ELOW                                    ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    C'|0080-|0320 '
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    CL40'0 - END THE ARITHMETIC COMMAND          '
         DC    CL40'5 - MULTIPLICATION                      ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    CL40'1 - CONVERT HEX TO DECIMAL              '
         DC    CL40'6 - DIVISION                            ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    CL40'2 - CONVERT DECIMAL TO HEX              '
         DC    CL40'7 - CONVERT 3270 BUFFER ADDRESSES       ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    CL40'3 - ADDITION                            '
         DC    CL40'8 - NOT IN USE                          ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    CL40'4 - SUBTRACTION                         '
         DC    CL40'9 - NOT IN USE                          ',C'|0320 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC1LN24  DC    CL40'-------------- ENTER MENU OPTION NUMBER '
         DC    CL40'DESIRED THEN PRESS ENTER ---------------'
ESCREEN1 EQU   *
SC1SUFIX DC    XL4'11C3F013'
         EJECT
SCREEN2  EQU   *
SC2LN01  DC    CL40'                  T S O   A R I T H M E '
         DC    CL40'T I C   C O M M A N D                   ',C'|0080-'
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
         DC    C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC2LN04  DC    CL40'      ====   C O N V E R T   T O   D E C'
         DC    CL40' I M A L   P R O C E S S O R   ====     ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    C'|0080-'
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
SC2LN07  DC    CL40'                                        '
         DC    CL40'                                        '
SC2LN08  DC    CL40'         <==== ENTER HEX VALUE THAT YOU '
         DC    CL40'WISH CONVERTED TO DECIMAL               '
SC2LN09  DC    CL40'                                        '
         DC    CL40'                                        '
SC2LN10  DC    CL40'                      <==== THIS IS THE '
         DC    CL40'RESULT                                  ',C'|1040 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC2LN24  DC    CL40'----------- TO RETURN TO MENU PRESS ENTE'
         DC    CL40'R WITHOUT CHANGING ANYTHING ------------'
ESCREEN2 EQU   *
SC2SUFIX DC    XL4'11C8F013'
         EJECT
SCREEN3  EQU   *
SC3LN01  DC    CL40'                  T S O   A R I T H M E '
         DC    CL40'T I C   C O M M A N D                   ',C'|0080-'
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
         DC    C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC3LN04  DC    CL40'   ====  C O N V E R T   T O   H E X A D'
         DC    CL40' E C I M A L   P R O C E S S O R  ====  ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    C'|0080-'
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
SC3LN07  DC    CL40'                                        '
         DC    CL40'                                        '
SC3LN08  DC    CL40'                 <==== ENTER THE DECIMAL'
         DC    CL40' VALUE THAT YOU WISH CONVERTED TO HEX   '
SC3LN09  DC    CL40'                                        '
         DC    CL40'                                        '
SC3LN10  DC    CL40'         <==== THIS IS THE RESULT       '
         DC    CL40'                                        ',C'|1040 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC3LN24  DC    CL40'----------- TO RETURN TO MENU PRESS ENTE'
         DC    CL40'R WITHOUT CHANGING ANYTHING ------------'
ESCREEN3 EQU   *
SC3SUFIX DC    XL4'11C8F013'
         EJECT
SCREEN4  EQU   *
SC4LN01  DC    CL40'                  T S O   A R I T H M E '
         DC    CL40'T I C   C O M M A N D                   ',C'|0080-'
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
         DC    C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC4LN04  DC    CL40'               ====   A D D I T I O N   '
         DC    CL40'P R O C E S S O R   ====                ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    C'|0080-|0080 '
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC4LN08  DC    CL40' 1: D <==== ENTER RADIX     2:          '
         DC    CL40'        <==== ENTER FIRST NUMBER TO ADD ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC4LN10  DC    CL40' 3: D <==== ENTER RADIX     4:          '
         DC    CL40'        <==== ENTER SECOND NUMBER TO ADD',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC4LN12  DC    CL40'                               ---------'
         DC    CL40'-------                                 ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC4LN14  DC    CL40' 5: D <==== ENTER RADIX                 '
         DC    CL40'                          <==== SUM     ',C'|0160 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC4LN17  DC    CL40' 1: ENTER RADIX OF FIRST NUMBER TO ADD, '
         DC    CL40'D=DECIMAL, X=HEXADECIMAL                '
SC4LN18  DC    CL40' 2: ENTER FIRST NUMBER TO ADD, PLEASE MA'
         DC    CL40'KE SURE ITEM (1) IS EQUIVALENT          '
SC4LN19  DC    CL40' 3: ENTER RADIX OF SECOND NUMBER TO ADD,'
         DC    CL40' D=DECIMAL, X=HEXADECIMAL               '
SC4LN20  DC    CL40' 4: ENTER SECOND NUMBER TO ADD, PLEASE M'
         DC    CL40'AKE SURE ITEM (3) IS EQUIVALENT         '
SC4LN21  DC    CL40' 5: ENTER RADIX THAT YOU WOULD LIKE THE '
         DC    CL40'SUM DISPLAY IN, D=DECIMAL, X=HEXADECIMAL',C'|0160 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC4LN24  DC    CL40'----------- TO RETURN TO MENU PRESS ENTE'
         DC    CL40'R WITHOUT CHANGING ANYTHING ------------'
ESCREEN4 EQU   *
SC4SUFIX DC    XL4'11C94F13'
         EJECT
SCREEN5  EQU   *
SC5LN01  DC    CL40'                  T S O   A R I T H M E '
         DC    CL40'T I C   C O M M A N D                   ',C'|0080-'
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
         DC    C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC5LN04  DC    CL40'             ===   S U B T R A C T I O N'
         DC    CL40'   P R O C E S S O R   ====             ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    C'|0080-|0080 '
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC5LN08  DC    CL40' 1: D <==== ENTER RADIX     2:          '
         DC    CL40'        <==== ENTER # TO SUBTRACT FROM  ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC5LN10  DC    CL40' 3: D <==== ENTER RADIX     4:          '
         DC    CL40'        <==== ENTER # TO SUBTRACT       ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC5LN12  DC    CL40'                               ---------'
         DC    CL40'-------                                 ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC5LN14  DC    CL40' 5: D <==== ENTER RADIX                 '
         DC    CL40'                          <==== #1 - #2 ',C'|0160 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC5LN17  DC    CL40' 1: ENTER RADIX OF # TO SUBTRACT FROM, D'
         DC    CL40'=DECIMAL, X=HEXADECIMAL                 '
SC5LN18  DC    CL40' 2: ENTER # TO SUBTRACT FROM, PLEASE MAK'
         DC    CL40'E SURE ITEM (1) IS EQUIVALENT           '
SC5LN19  DC    CL40' 3: ENTER RADIX OF # TO SUBTRACT, D=DECI'
         DC    CL40'MAL, X=HEXADECIMAL                      '
SC5LN20  DC    CL40' 4: ENTER # TO SUBTRACT, PLEASE MAKE SUR'
         DC    CL40'E ITEM (3) IS EQUIVALENT                '
SC5LN21  DC    CL40' 5: ENTER RADIX THAT YOU WOULD LIKE THE '
         DC    CL40'DIFFERENCE IN, D=DECIMAL, X=HEXADECIMAL ',C'|0160 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC5LN24  DC    CL40'----------- TO RETURN TO MENU PRESS ENTE'
         DC    CL40'R WITHOUT CHANGING ANYTHING ------------'
ESCREEN5 EQU   *
SC5SUFIX DC    XL4'11C94F13'
         EJECT
SCREEN6  EQU   *
SC6LN01  DC    CL40'                  T S O   A R I T H M E '
         DC    CL40'T I C   C O M M A N D                   ',C'|0080-'
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
         DC    C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC6LN04  DC    CL40'          ===   M U L T I P L I C A T I '
         DC    CL40'O N   P R O C E S S O R   ====          ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    C'|0080-|0080 '
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC6LN08  DC    CL40' 1: D <==== ENTER RADIX     2:          '
         DC    CL40'        <==== ENTER 1ST # TO MULTIPLY   ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC6LN10  DC    CL40' 3: D <==== ENTER RADIX     4:          '
         DC    CL40'        <==== ENTER 2ND # TO MULTIPLY   ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC6LN12  DC    CL40'                               ---------'
         DC    CL40'-------                                 ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC6LN14  DC    CL40' 5: D <==== ENTER RADIX                 '
         DC    CL40'                          <==== #2 X #4 ',C'|0160 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC6LN17  DC    CL40' 1: ENTER RADIX OF 1ST # TO MULTIPLY, D='
         DC    CL40'DECIMAL, X=HEXADECIMAL                 '
SC6LN18  DC    CL40' 2: ENTER 1ST # TO MULTIPLY, PLEASE MAKE'
         DC    CL40' SURE ITEM (1) IS EQUIVALENT            '
SC6LN19  DC    CL40' 3: ENTER RADIX OF 2ND # TO MULTIPLY, D='
         DC    CL40'DECIMAL, X=HEXADECIMAL                  '
SC6LN20  DC    CL40' 4: ENTER 2ND # TO MULTIPLY, PLEASE MAKE'
         DC    CL40' SURE ITEM (3) IS EQUIVALENT            '
SC6LN21  DC    CL40' 5: ENTER RADIX THAT YOU WOULD LIKE THE '
         DC    CL40'PRODUCT IN, D=DECIMAL, X=HEXADECIMAL    ',C'|0160 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC6LN24  DC    CL40'----------- TO RETURN TO MENU PRESS ENTE'
         DC    CL40'R WITHOUT CHANGING ANYTHING ------------'
ESCREEN6 EQU   *
SC6SUFIX DC    XL4'11C94F13'
         EJECT
SCREEN7  EQU   *
SC7LN01  DC    CL40'                  T S O   A R I T H M E '
         DC    CL40'T I C   C O M M A N D                   ',C'|0080-'
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
         DC    C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC7LN04  DC    CL40'               ====   D I V I S I O N   '
         DC    CL40'P R O C E S S O R   ====                ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    C'|0080-|0080 '
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC7LN08  DC    CL40' 1: D <==== ENTER RADIX     2:          '
         DC    CL40'        <==== ENTER DIVIDEND            ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC7LN10  DC    CL40' 3: D <==== ENTER RADIX     4:          '
         DC    CL40'        <==== ENTER DIVISOR             ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC7LN12  DC    CL40'                               ---------'
         DC    CL40'-------                                 ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC7LN14  DC    CL40' 5: D <==== ENTER RADIX                 '
         DC    CL40'                          <==== QUOTIENT'
SC7LN15  DC    CL40'                                        '
         DC    CL40'                          <=== REMAINDER',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC7LN17  DC    CL40' 1: ENTER RADIX OF DIVIDEND, D=DECIMAL, '
         DC    CL40'X=HEXADECIMAL                           '
SC7LN18  DC    CL40' 2: ENTER DIVIDEND, PLEASE MAKE SURE ITE'
         DC    CL40'M (1) IS EQUIVALENT                     '
SC7LN19  DC    CL40' 3: ENTER RADIX OF DIVISOR, D=DECIMAL, X'
         DC    CL40'=HEXADECIMAL                            '
SC7LN20  DC    CL40' 4: ENTER DIVISOR, PLEASE MAKE SURE ITEM'
         DC    CL40' (3) IS EQUIVALENT                      '
SC7LN21  DC    CL40' 5: ENTER RADIX THAT YOU WOULD LIKE THE '
         DC    CL40'QUOTIENT IN, D=DECIMAL, X=HEXADECIMAL   ',C'|0160 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC7LN24  DC    CL40'----------- TO RETURN TO MENU PRESS ENTE'
         DC    CL40'R WITHOUT CHANGING ANYTHING ------------'
ESCREEN7 EQU   *
SC7SUFIX DC    XL4'11C94F13'
         EJECT
SCREEN8  EQU   *
SC8LN01  DC    CL40'I                 T S O   A R I T H M E '
         DC    CL40'T I C   C O M M A N D                   ',C'|0080-'
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
         DC    C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC8LN04  DC    CL40'    ====   3 2 7 0   B U F F E R   A D D'
         DC    CL40' R E S S   P R O C E S S O R   ====     ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
         DC    C'|0080-|0160 '
*        DC    CL40'----------------------------------------'
*        DC    CL40'----------------------------------------'
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC8LN09  DC    CL40'   2 <==== ENTER 3278/9 MODEL NUMBER 2 -'
         DC    CL40' 5  (NOTE: 2 - 4 CAUSE THE SAME RESULTS)',C'|0160 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC8LN12  DC    CL40'  __ <==== ENTER ROW NUMBER             '
         DC    CL40'    SCREEN ADDRESS (DECIMAL) ====>      '
SC8LN13  DC    CL40' ___ <==== ENTER COLUMN NUMBER          '
         DC    CL40'                   (HEX)     ====>      ',C'|0160 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC8LN16  DC    CL40'  __ <==== ENTER THE FIRST BYTE OF THE B'
         DC    CL40'UFFER ADDRESS                           '
SC8LN17  DC    CL40'  __ <==== ENTER THE SECOND BYTE OF THE '
         DC    CL40'BUFFER ADDRESS                          ',C'|0160 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC8LN20  DC    CL40' NOTE: IF YOU ARE CONVERTING FROM ROW/CO'
         DC    CL40'LUMN FORMAT TO BUFFER ADDRESS FORMAT, DO'
SC8LN21  DC    CL40'       NOT TYPE IN THE BUFFER ADDRESS.  '
         DC    CL40'IF YOU ARE CONVERTING BUFFER ADDRESS TO '
SC8LN22  DC    CL40'       ROW/COLUMN FORMAT, DO NOT TYPE IN'
         DC    CL40' THE ROW/COLUMN DATA.                   ',C'|0080 '
*        DC    CL40'                                        '
*        DC    CL40'                                        '
SC8LN24  DC    CL40' ------------------------- TO RETURN TO '
         DC    CL40'MENU PRESS PA1 -------------------------'
ESCREEN8 EQU   *
SC8SUFIX DC    XL4'114AC313'
         EJECT
***********************************************************************
*  INTERRUPTION EXIT ROUTINE ---- STAX SERVICE ROUTINE                *
***********************************************************************
         SPACE 2
ATTNRTN  CSECT
         STM   R14,R12,12(R13)         SAVE CALLERS REGISTERS
         BALR  R12,R0                  SET UP BASE REGISTER
         DROP  R12                     DROP OLD BASE REGISTER
         USING *,R12                   SET UP NEW BASE REGISTER
         ST    R13,STAXSAVE+4          SAVEAREA BACKWARD PTR
         LA    R11,STAXSAVE            PICK UP OUR SAVEAREA ADDR
         ST    R11,8(R13)              SAVEAREA FORWARD PTR
         LR    R13,R11                 ESTABLISH NEW S/A PTR
         SPACE 1
         L     R3,STAXSWAD             GET ADDR OF SWITCH ADDR
         MVI   0(R3),C'1'              TURN SWITCH ON
         SPACE 1
         L     R13,STAXSAVE+4          PICK UP OLD S/A ADDR
         LM    R14,R12,12(R13)         RESTORE CALLERS REGISTERS
         LA    R15,0                   SET RC=0
         BR    R14                     RETURN TO CALLER
         SPACE 1
STAXSWAD DC    A(STAXSW)               ADDR OF INTERRUPT SWITCH
STAXSAVE DS    18F                     SAVE AREA FOR INTERRUPT RTN
         SPACE 3
SCRBLD   DS    CL4096                  BUILD AREA FOR FINAL SCREEN
         SPACE 3
         END   ARITH
