1

         Getting Started Using IPCS/ESA                      Page #1


         Need to use IPCS under ESA to look at storage dumps?
         Don't know where to start?  I know exactly how you feel.
         I was once a novice IPCS user.  I would just try anything
         and hope for the best.  Through the years, I have gathered
         a great deal of information on IPCS initialization and
         practical usage.  This article is the first of (I hope)
         many articles on IPCS.


         This article was based on a session entitled PRACTICAL
         IPCS/ESA DUMP ANALYSIS I gave at Nastec 5.0. in
         Orlando at the end of March 1993.


         I will introduce you to IPCS under
         MVS/ESA and the IPCS REXX EXECs I use to run IPCS
         effortlessly in both batch and interactive modes.


         The name IPCS stands for Interactive Problem Control
         System.  This name is misleading since the main
         purpose of IPCS is to allow the user to interactively
         view and interrogate unformatted dumps.


         IPCS can process:


         1) SVCDUMP       This storage dump is taken by the operating
                          system when it detects a condition which
                          would degrade or destroy data.

         2) STAND-ALONE   The operator will initiate this storage
                          dump which contains as many swapped-in
                          address spaces as possible.

         3) SYSMDUMP      This is an unformatted application storage
                          dump specified by the SYSMDUMP dd statement.

         4) GTF TRACE     This is not storage dump information but
                          rather the storage buffers holding current
                          GTF TRACE data which IPCS will format
                          with the GTFTRACE command.  This command
                          will also format external GTF trace data
                          (specification of MODE=EXTERNAL on the
                          GTF trace).

         5) LIVE STORAGE  You have the option to use IPCS to inspect
                          your current address space (unfortunately
                          not other address spaces) in a limited
                          way.  One of these big limitations is
                          the IPCS WHERE command not supported
                          for live storage analysis.

1

         Getting Started Using IPCS/ESA                      Page #2


         The problem control portion of IPCS for the most part has
         been superceded by products such as IBM's Information/Managemen
         (INFO/MGMT) and other non-IBM problem management software.


         IPCS originally started out as a Virtual Machine (VM) product
         and came over to the MVS operating system in the middle 1970s.
         I discovered IPCS sometime in 1983 from a very
         enthusiastic IBM PSR (if you remember these people
         you just may be considered an old-timer in this business).
         After spending some time struggling with the product,
         I found it very exciting that I could perform dump
         analysis right after the SYS1.DUMP?? dataset was filled
         and isolate the failing component while my associates
         were waiting for their PRINT DUMP (AMDPRDMP) printouts.
         Be aware that in the MVS/ESA world, IT IS MANDATORY
+                                            ________________
         TO USE IPCS TO PERFORM DUMP ANALYSIS.  Do not worry,
+        _____________________________________
         once you get used to IPCS you will wonder why you
         did it any other way.


         This article is not intended to be a diagnostic techniques
         discussion but rather a fastpath method to get
         IPCS up and working for you.


         ATTENTION: ALL JCL STATEMENTS AND REXX EXAMPLES ARE PRESENTED
                    WITH NO WARRANTY EXPRESSED OR IMPLIED.  I WILL DO
                    MY BEST TO ANSWER INQUIRIES ON THESE PROCEDURES.

         Author's note:  These are the first IPCS REXX EXEXs I have
                         written.  It isn't that hard to convert
                         CLISTS to REXX EXECs so lets do it!


1

         Getting Started Using IPCS/ESA                      Page #3


         I will begin by covering the most common storage dumps which
         are SVCDUMPS.  Your first step is to get
         SVCDUMP from tape to dasd.

         Check to see if your installation uses the IPCS
         COPYDUMP command to put SYS1.DUMP?? datasets to
         tape.  The IPCS COPYDUMP will create and output tape
         blocksize of 32760 (32K).

         If the LRECL and BLKSIZE on your dump tape ARE NOT
         4160, then YOU MUST USE THE IPCS COPYDUMP command to
         load the SVCDUMP to DASD.
         (see a sample job in FIGURE #1).


         FIGURE #1
+        _________

         //****************************************************//
         //*                                                  *//
         //*  THE IPCS VSAM DUMP DIRECTORY IS ALLOCATED BY    *//
         //*  THE IPCSDDIR DD STATEMENT                       *//
         //*                                                  *//
         //*  THIS PERMANENT IPCS VSAM DUMP DIRECTORY IS      *//
         //*  NEVER OPENED BY THE COPYDUMP COMMAND BUT        *//
         //*  IS STILL NEEDED BY IT (SO MAKE IT VERY SMALL).  *//
         //*                                                  *//
         //*  IPCSDDIR DD STATEMENT ===>  THIS IS YOUR        *//
         //*                              PERMANENT IPCS VSAM *//
         //*                              DUMP DIRECTORY      *//
         //*                              FOR COPYDUMP USAGE  *//
         //*                              ONLY.               *//
         //*                                                  *//
         //*                              NOTE: MAKE THIS     *//
         //*                                    DATASET VERY  *//
         //*                                    SMALL SINCE   *//
         //*                                    IT IS NEVER   *//
         //*                                    OPENED!       *//
         //*                                                  *//
         //*  IPCSPRNT DD STATEMENT ===>  YOUR OUTPUT FOR ANY *//
         //*                              IPCS PRINT OPERATION*//
         //*                              GOES HERE.          *//
         //*                                                  *//
         //*  SYSUT1 DD STATEMENT   ===>  THIS IS THE INPUT   *//
         //*                              SEQUENTIAL DUMP ON  *//
         //*                              TAPE.               *//
         //*                                                  *//
         //*  SYSUT2 DD STATEMENT   ===>  THIS WILL BE YOUR   *//
         //*                              YOUR SEQUENTIAL DUMP*//
         //*                              DATASET ON DASD.    *//
         //****************************************************//
1

         Getting Started Using IPCS/ESA                      Page #4



         FIGURE #1   (CONTINUED)
+        _________

         //CPYDUMP EXEC PGM=IKJEFT01,
         // DYNAMNBR=75,REGION=5M,TIME=1439
         //SYSTSPRT  DD SYSOUT=*
         //SYSUDUMP  DD SYSOUT=*
         //SYSOUT    DD SYSOUT=*
         //SYSPRINT  DD SYSOUT=*
         //IPCSDDIR  DD DSN=YOUR.PERM.IPCS.DUMP.DIR,
         // DISP=SHR
         //IPCSPRNT  DD SYSOUT=*
         //SYSUT1    DD DSN=YOUR.ARCHIVE.DUMP.TAPE,
         // DISP=SHR
         //SYSUT2    DD DSN=YOUR.OUTPUT.DASD.DUMP,
         // UNIT=SYSDA,
         // SPACE=(CYL,(50,20),RLSE),
         // DISP=(,CATLG,DELETE)
         //SYSTSIN  DD  *
         IPCS NOPARM
         SETDEF FLAG(ERROR) NOCONFIRM NOVERIFY
         COPYDUMP OFILE(SYSUT2) INFILE(SYSUT1)
         /*


         If the tape dataset DCB attributes are LRECL=4160,
         BLKSIZE=4160,RECFM=F then all you have to do is
         use IEBGENER to load the dump tape to DASD or
         just copy it from the SYS1.DUMP?? dataset.


         After this copy is complete we are ready to enter IPCS.
         In the past, IPCS had to be initialized BEFORE
         ISPF WHICH WAS A ROYAL PAIN.  GOOD NEWS! AS OF MVS/ESA
         RELEASE 4.3.0. ISPF CAN BE INITIALIZED AHEAD OF IPCS.
         When this time comes at our shop, all of these
         procedures will be revisited and streamlined.
         At our installation I have elected to enter
         IPCS from the TSO READY state using the BLSGLIBD
         IPCS program (that issues ISPF LIBDEFs) instead of
         creating a user panel entry in the ISPF primary
         option menu.  The advantage of this method is I do not
         have to carry around the IPCS storage task overhead
         for all of my NON-IPCS work.  In addition, I can
         reorganize the IPCS VSAM DUMP directory any time I
         want to without the extra allocation/deallocation overhead.

         The disadvantage is
         that I cannot split screen to a normal ISPF/PDF environment.
         This problem can be corrected by the development
         of a few very trivial IPCS REXX EXECs that will
         place you into the commonly-used facilities of
         ISPF BROWSE, EDIT or UTILITY (which
         I will cover later in this article).

1

         Getting Started Using IPCS/ESA                      Page #5



         The files that are allocated by the
         ISPF LIBDEF IPCS PROGRAM (BLSGLIBD)
         via ISPF LIBDEF processing are:


         DDNAME        DATASET NAME      DESCRIPTION
         _______       _____________     ____________________

         ISPSLIB       SYS1.SBLSKEL0     IPCS SKELETON LIBRARY
         ISPMLIB       SYS1.SBLSMSG0     IPCS MESSAGE LIBRARY
         ISPPLIB       SYS1.SBLSPNL0     IPCS PANEL LIBRARY
         ISPTLIB       SYS1.SBLSTBL0     IPCS TABLE LIBRARY


         I do not allocate SYS1.SLBSCLI0 in my SYSPROC
         allocation since I only use IBM IPCS COMMANDS (OPTION 4)
         dialog.

         You will need this SYSPROC concatentation if you
         wish to use the canned IPCS facilities in IPCS ISPF
         OPTION 2 (ANALYSIS).


         If you elect to invoke IPCS the way I do,  I would
         recommend that you copy all the following members:


         BLSGCMDS  -  USED IN IPCS LIST COMMAND

         BLSLCMDS  -  USED IN IPCS BROWSE DIALOG


         from the IPCS table library SYS1.SBLSTBL0 to your
         IPCS input table library defined by the ISPTLIB
         dd statement.  If you do not do this:


         1) THE LIST COMMAND IN THE IPCS DIALOG WILL NOT WORK.

            The LIST command will be passed to ISPF that will
            invoke the LIST command for ISPF LOG/LIST dataset
            manipulation and fail.

            If you abbreviate the IPCS LIST command as "L" then
            the IPCS LIST command will work due to the
            shortened name being different from the name "LIST".

1

         Getting Started Using IPCS/ESA                      Page #6



         2) THE RFIND COMMAND IN THE IPCS DIALOG WILL NOT WORK.


         3) You will only be able to use the IPCS xxxxxxxx COMMAND
            in the dump reporter display panel of the Option 1 BROWSE
            IPCS dialog.


         The main point to using my installation-
         developed REXX EXECS are that these rexx execs are straight-
         forward.  I would encourage the reader to add (or remove)
         code for his/her benefit and the benefit of learning
         REXX.  These REXX EXECS have served me very well just as you
         see them.


         TODAY IS 01/22/93 AND I JUST BECAME AWARE OF AN IBM
         REXX EXEC DESIGN RESTRICTION THAT WILL NOT ALLOW THE
         REXX EXECS TO BE RUN IN BATCH TSO.  IBM LEVEL 2 STATED
         THIS WAS A FUTURE SHARE REQUIREMENT.  IF YOU NEED TO
         RUN IPCS IN BATCH PLESE USE THE CORRESPONDING IPCS
         CLIST (THEY BEGIN WITH A #) ON THE NASPA VIP TAPE
         OR THE CBT TAPE.          TOM BRYANT

         I will introduce various rexx execs and batch jobs
         to perform ipcs analysis.  the rexx execs are:


         IPCS REXX
         EXECS            DESCRIPTION
         _____________    ___________________________________________

         @IPCSBGN         REXX EXEC TO CREATE NEW DUMP DIRECTORY
                          AND INVOKE IPCS.  THIS WOULD BE THE FIRST
                          REXX EXEC YOU WOULD INVOKE.  IN THE FUTURE
                          YOU WOULD USE THE @IPCSCUR REXX EXEC.

         @IPCSCUR         REXX EXEC TO USE EXISTING DUMP DIRECTORY
                          CREATED FROM THE @IPCSBGN REXX EXEC.

         @BROWSE          REXX EXEC TO DO ISPF/PDF BROWSE FUNCTION

         @EDIT            REXX EXEC TO ENTER ISPF/PDF EDIT

         @IPCSSAD         REXX EXEC TO USE EXISTING SADUMP DUMP DIRECTOR
                          THE IPCS VSAM DUMP DIRECTORY IS BUILT BY A
                          SEPARATE BATCH JOB RUN FIRST.

         @IPCSTRM         REXX EXEC TO TERMINATE IPCS


         If we are a first time IPCS user or just need to allocate
         a new IPCS VSAM DUMP directory, we should execute the
         @IPCSBGN command in a TSO ready state or in batch TSO
         (see Figure #2).

1

         Getting Started Using IPCS/ESA                      Page #7



         FIGURE #2         @IPCSBGN
+        _________         ________


         /**************************** REXX ****************************
         /*
         /*      This REXX EXEC will run IPCS in either INTERACTIVE
         /*      or BATCH mode and will allocate a new IPCS VSAM DUMP
         /*      DIRECTORY.
         /*
         /*      NOTE: You must be outside of ISPF/PDF to run this EXEC!
         /*
         /*
         /*      Keyword operands
         /*
         /*      BATCH  ==>  specify this operand if you want IPCS to
         /*                  be run in batch (interactive is default)
         /*
         /*      VOLUME ==>  specify volume where IPCS VSAM DUMP DIRECTO
         /*                  is to be allocated
         /*
         /**************************************************************
         arg batch volume

         status = MSG('OFF')

         subcom ispexec
         if rc=0 then
            do
              say '@IPCSBGN rexx exec cannot be executed under ISPF'
              exit
            end
         else NOP

         If volume = '' then volume = '123456'

         USERID = SYSVAR(syspref)

         "DELETE '"USERID".DDIR.SVCDUMP' CLUSTER"
         if rcë=0 then
            do
              say 'DELETE TSO command failed'
              say 'for IPCS dump directory - RC is' rc
            end
         else NOP

1


         Getting Started Using IPCS/ESA                      Page #8



         FIGURE #2         @IPCSBGN   (CONTINUED)
+        _________         ________


         "DELETE '"USERID".IPCSPRNT'"
         if rcë=0 then
            do
              say 'DELETE TSO command failed'
              say 'for IPCS print dataset - RC is' rc
            end
         else NOP

         "ALLOCATE F(IPCSPRNT) DA('"USERID".IPCSPRNT')",
            "NEW SPA(5 1) CYL REL REUSE"
         if rcë=0 then
            do
              say 'ALLOCATE TSO command failed'
              say 'for IPCS print dataset - RC is' rc
              exit
            end
         else NOP

         if batch ë= 'BATCH' then
            do
              say '@IPCSBGN rexx exec online execution'
              say userid'.DDIR.SVCDUMP vsam dump directory will be creat
              say 'dataset' userid'.IPCSPRNT will be created'
              CALL IPCSDDR
              if result > 0 then exit
              queue "SETDEF LENGTH(200) FLAG(ERROR) LIST",
                          "DISPLAY(MACHINE,REMARK,STORAGE,SYMBOL)",
                          "NOCONFIRM NOVERIFY TERMINAL NOPRINT"
              queue "ISPF PGM(BLSGLIBD) PARM(PANEL(BLSPPRIM))",
                         "PARM(PANEL(BLSPPRIM)) NEWAPPL(BLSG) PASSLIB"
              "IPCS NOPARM"
              exit
             end

1


         Getting Started Using IPCS/ESA                      Page #9



         FIGURE #2         @IPCSBGN   (CONTINUED)
+        _________         ________


         if batch = 'BATCH' then
            do
              say '@IPCSBGN rexx exec batch execution'
              say userid'.DDIR.SVCDUMP vsam dump directory will be creat
              say 'dataset' userid'.IPCSPRNT will be created'
              CALL IPCSDDR
              if result > 0 then exit
              queue "SETDEF LENGTH(200) FLAG(ERROR) LIST",
                          "DISPLAY(MACHINE,REMARK,STORAGE,SYMBOL)",
                          "NOCONFIRM NOVERIFY TERMINAL NOPRINT"
              "IPCS NOPARM"
               exit
            end


         IPCSDDR:

         " DEFINE CLUSTER(NAME('"USERID".DDIR.SVCDUMP')        ",
         " VOLUME("volume") INDEXED FREESPACE(10,10) REUSE     ",
         " IMBED REPLICATE SHAREOPTIONS(1,3))                  ",
         " INDEX(NAME('"USERID".DDIR.SVCDUMP.INDEX')           ",
         " CYLINDERS(1,1) CISZ(4096))                          ",
         " DATA(NAME('"USERID".DDIR.SVCDUMP.DATA')             ",
         " CYLINDERS(70,30) CISZ(4096) KEYS(128,0) RECORDSIZE(384 3072))
         if rcë=0 then
            do
              say 'DEFINE CLUSTER TSO command failed'
              say 'for IPCS dump directory - RC is' rc
              RETURN RC
              exit
            end
         else NOP

1


         Getting Started Using IPCS/ESA                      Page #10



         FIGURE #2         @IPCSBGN   (CONTINUED)
+        _________         ________


         " IPCSDDIR '"USERID".DDIR.SVCDUMP'                    "
         if rcë=0 then
            do
              say 'IPCSDDIR TSO command failed'
              say 'for IPCS dump directory - RC is' rc
              RETURN RC
              exit
            end
         else NOP

         " ALLOCATE FILE(IPCSDDIR)                             ",
         "          DSNAME('"USERID".DDIR.SVCDUMP')            ",
         "          SHR REUSE                                  "
         if rcë=0 then
            do
              say 'ALLOCATE TSO command failed'
              say 'for IPCS dump directory - RC is' rc
              RETURN RC
              exit
            end
         else NOP


         WHAT @IPCSBGN DOES
+        __________________


         1) I make sure we are not running under ISPF
            when I invoke the @IPCSBGN rexx exec.  The previous
            IPCS COPYDUMP procedure to load down dumps from
            tape can be run AT THE SAME TIME as this rexx
            exec since they use different IPCS VSAM dump
            directories.  This will allow you to load a dump
            to dasd while viewing another.


         2) The @IPCSBGN rexx exec will delete any existing dump
            dataset of the name 'userid.DDIR.SVCDUMP' and any
            existing dataset of 'userid.IPCSPRNT' used for
            IPCS output directed to PRINT.

            The use of the REXX OUTTRAP will prevent the TSO
            DELETE messages from going to your terminal screen!


1

         Getting Started Using IPCS/ESA                      Page #11



         3) If IPCS is to be run in BATCH via the batch rexx arg
            statement, then I inform the user that a new IPCS VSAM
            DUMP DIRECTORY and IPCS PRINT dataset will be allocated
            and then invoke the REXX internal subroutine IPCSDDR
            which performs my IPCS VSAM DUMP DIRECTORY allocations.
            The rexx QUEUE command will pass this string to the
            IPCS TSO command processor to issue these SETDEF
            commands and issue IPCS with the NOPARM parameter
            (which means for dump analysis only).


         4) If IPCS is to be run in a foreground TSO environment
            the only addition to the above item #3 is the final
            rexx queue command that passes the ISPF command to IPCS.
            This program name is BLSGLIBD (probably LIBD for LIBDEF)
            and will display the IPCS primary option menu BLSPPRIM
            at IPCS/ISPF initialization time.


         5) I have selected my IPCS session defaults (IPCS SETDEF
            command) as follows:


            LENGTH(200)        - I want 200 bytes displayed for any
                                 list-oriented command

                                 I have found through experience
                                 that 200 is a good number.
                                 Remember that the IPCS default
                                 is just 4 bytes displayed!

            FLAG(ERROR)        - Give me all ERROR messages such as
                                 invalid control blocks but not
                                 informational and warning messages

            DISPLAY(MACHINE,   - Display ASID, virtual address and stora
                    REMARK,    - ** DEFAULT VALUE **
                    REQUEST,   - ** DEFAULT VALUE **
                    STORAGE,   - Make storage look like printed dump
                    SYMBOL)    - ** DEFAULT VALUE **

            NOVERIFY           - Always use the TERMINAL/NOTERMINAL
                                 and PRINT/NOPRINT specified in the
                                 previous SETDEF command (you can
                                 override in most individual IPCS
                                 commands).

1

         Getting Started Using IPCS/ESA                      Page #12



            NOCONFIRM          - Set IPCS default reply to "Y"

                                 This will reply "Y" internally
                                 to the following message using
                                 the COPYDUMP command:

                                 BLS18168D PROCEED WITH COPY
                                           ENTER Y TO CONTINUE,
                                           N TO TERMINATE


                                 This will reply "Y" internally
                                 to the following message seen at
                                 dump initialization:

                                 BLS18160D MAY SUMMARY DATA BE
                                           USED BY DUMP ACCESS
                                           ENTER Y TO USE,
                                           N TO BYPASS

                                 For the most situations, you ALWAYS
                                 want the summary dump data
                                 captured closest to the time
                                 of the failure!
1

         Getting Started Using IPCS/ESA                      Page #13



         The IBM-shipped BLSCDDIR clist in SYS1.SBLSCLI0 dataset
         does not optimize IPCS VSAM DUMP directory processing
         in any way.  I have added IMBED and REPLICATE to reduce
         I/O operations.  The biggest performance improvement was
         the addition of FREESPACE(10 10) to reserve freespace in
         the control areas and control intervals. IPCS creates
         many symbol equates (VSAM updates) in normal processing
         which can cause control interval and control area splits.
         I HAVE SINCE MADE ONE OTHER CHANGE RECOMMENDED BY GUY
         BRUNI (NASTEC 5.0. VSAM SPEAKER) TO CHANGE THE INDEX
         CISIZE FROM 2048 TO 4096.  THIS WORKS VERY WELL IF YOU
         ARE HEAVILY=USING IPCS.


         Since we cannot effectively split-screen to NON-IPCS ISPF
         using this IPCS/ISPF LIBDEF methodology, I wrote a few
         very simple rexx execs that will handle the common
         functions of ISPF BROWSE, EDIT and UTILITY.  To execute
         these REXX EXECS simply key in TSO %???????? (where ????????
         is the rexx exec) at the IPCS command line. Remember that
         the percent (%) sign will search only SYSPROC/SYSEXEC
         which should improve performance.


         ISPF for the particular function is simply invoked
         via ISPEXEC interface (see Figures #4 through #6):


         FIGURE #4         @BROWSE
+        _________         _______


         /**************************** REXX ****************************
         /*
         /*      This REXX EXEC will place the user into ISPF BROWSE.
         /*
         /*      NOTE: You must be under IPCS/ISPF to run this EXEC!
         /*
         /*      Keyword operands
         /*
         /*      DATASET  ==>  the fully-qualified name of the dataset
         /*                    you want to browse
         /*
         /**************************************************************

1

         Getting Started Using IPCS/ESA                      Page #14


         FIGURE #4         @BROWSE    (CONTINUED)
+        _________         _______


         arg dataset

         status = MSG('OFF')

         subcom ispexec
         if rcë=0 then
            do
              say '@BROWSE rexx exec must be executed under ISPF'
              exit
            end
         else NOP

         "ISPEXEC BROWSE DATASET('"dataset"')"
         if rcë=0 then
            do
              say 'ISPF ISPEXEC BROWSE command failed - RC is' rc
              exit
            end
         else NOP

1

         Getting Started Using IPCS/ESA                      Page #15




         FIGURE #5         @EDIT
+        _________         _____


         /**************************** REXX ****************************
         /*
         /*      This REXX EXEC will place the user into ISPF EDIT.
         /*
         /*      NOTE: You must be under IPCS/ISPF to run this EXEC!
         /*
         /*      Keyword operands
         /*
         /*      DATASET  ==>  the fully-qualified name of the dataset
         /*                    you want to edit
         /*
         /**************************************************************

         arg dataset

         status = MSG('OFF')

         subcom ispexec
         if rcë=0 then
            do
              say '@edit rexx exec must be executed under ISPF'
              exit
            end
         else NOP

         "ISPEXEC EDIT DATASET('"dataset"')"
         if rcë=0 then
            do
              say 'ISPF ISPEXEC command failed - RC is' rc
              exit
            end
         else NOP

1

         Getting Started Using IPCS/ESA                      Page #16




         FIGURE #6         @UTILITY
+        _________         ________


         /**************************** REXX ****************************
         /*
         /*      This REXX EXEC will place the user into ISPF utility.
         /*
         /*      NOTE: You must be under IPCS/ISPF to run this EXEC!
         /*
         /**************************************************************

         status = MSG('OFF')

         subcom ispexec
         if rcë=0 then
            do
              say '@UTILITY rexx exec must be executed under ISPF'
              exit
            end
         else NOP

         "ISPEXEC SELECT PANEL(ISRUTIL)"
         if rcë=0 then
            do
              say 'ISPF ISPEXEC SELECT PANEL command failed - RC is' rc
              exit
            end
         else NOP



         If you use the IBM Syslog Display and Search Facility (SDSF)
         (via TSO SDSF command at the IPCS command line)
         be aware that you will have to reestablish your session
         prefix (such as PREFIX userid) since your prefix is
         defaulted to NONE while using SDSF under IPCS.  This
         phenomenon happens because IPCS/ISPF was brought up
         under a new ISPF application identifier (NEWAPPL)
         of BLSG.

1

         Getting Started Using IPCS/ESA                      Page #17



         Our discussion of SVCDUMP would not be complete without
         showing how we exit IPCS (see Figure #7):


         FIGURE #7         @IPCSTRM
+        _________         ________


         /**************************** REXX ****************************
         /*
         /*      This REXX EXEC will perform IPCS termination under
         /*      native TSO/E mode.
         /*
         /*
         /*      NOTE: You must be outside of ISPF/PDF to run this EXEC!
         /*
         /**************************************************************

         status = MSG('OFF')

         subcom ispexec
         if rc=0 then
            do
              say '@IPCSTRM rexx exec cannot be executed under ISPF'
              exit
            end
         else NOP

         queue "END"
         queue "FREE F(IPCSDDIR,IPCSPRNT)"

         SAY 'IPCS termination and cleanup complete'


         SOME @IPCSTRM NOTES
+        ___________________

         You must use the REXX QUEUE command to pass this commands
         to TSO to be executed after the REXX EXEC terminates.
         To date, I have not found a way to suppress the FILE
         IPCSDDIR NOT FREED, IS NOT ALLOCATED message!

         I don't bother to check return codes for the END and
         FREE commands since this action should be straightforward!

1

         Getting Started Using IPCS/ESA                      Page #18


         For the majority of IPCS usage, you will be working
         with an existing IPCS VSAM DUMP directory.  For these
         times you will use the @IPCSCUR rexx exec.  This
         rexx exec is very similar to @IPCSBGN so I won't separately
         explain it here (read the internal comments for
         more information in Figure #8):


         FIGURE #8         @IPCSCUR
+        _________         ________


         /**************************** REXX ****************************
         /*
         /*      This REXX EXEC will run IPCS in either INTERACTIVE
         /*      or BATCH mode using the current IPCS VSAM DUMP DIRECTOR
         /*      previously allocated.
         /*
         /*      NOTE: You must be outside of ISPF/PDF to run this EXEC!
         /*
         /*
         /*      Keyword operands
         /*
         /*      BATCH  ==>  specify this operand if you want IPCS to
         /*                  be run in batch (interactive is default)
         /*
         /**************************************************************

         arg batch

         status = MSG('OFF')

         subcom ispexec
         if rc=0 then
            do
              say '@IPCSCUR rexx exec cannot be executed under ISPF'
              exit
            end
         else NOP

         USERID = SYSVAR(syspref)
         savelne = OUTTRAP(outlne,1)
1

         Getting Started Using IPCS/ESA                      Page #19


         FIGURE #8         @IPCSCUR   (CONTINUED)
+        _________         ________


         "DELETE '"USERID".IPCSPRNT'"
         if rcë=0 then
            do
              say 'DELETE TSO command failed'
              say 'for IPCS print dataset - RC is' rc
            end
         else NOP

         "ALLOCATE F(IPCSPRNT) DA('"USERID".IPCSPRNT')",
            "NEW SPA(5 1) CYL REL REUSE"
         if rcë=0 then
            do
              say 'ALLOCATE TSO command failed'
              say 'for IPCS print dataset - RC is' rc
              exit
            end
         else NOP

         ddir = sysdsn("'"USERID".DDIR.SVCDUMP'")
         if ddir = 'DATASET NOT FOUND' then
            do
               SAY USERID'.DDIR.SVCDUMP' not found
               SAY 'Use @IPCSBGN rexx exec for processing'
               "%@IPCSTRM"
               exit
            end

         "ALLOC F(IPCSDDIR) DA('"USERID".DDIR.SVCDUMP') SHR REUSE"
         if rcë=0 then
            do
              say 'ALLOCATE TSO command failed'
              say 'for IPCS dump directory - RC is' rc
              exit
            end
         else NOP

1

         Getting Started Using IPCS/ESA                      Page #20


         FIGURE #8         @IPCSCUR   (CONTINUED)
+        _________         ________


         if batch ë= 'BATCH' then
            do
              say '@IPCSCUR rexx exec online execution'
              say 'existing' userid'.DDIR.SVCDUMP',
                  'vsam dump directory allocated'
              say 'dataset' userid'.IPCSPRNT will be created'
              queue "SETDEF LENGTH(200) FLAG(ERROR) LIST",
                          "DISPLAY(MACHINE,REMARK,STORAGE,SYMBOL)",
                          "NOCONFIRM NOVERIFY TERMINAL NOPRINT"
              queue "ISPF PGM(BLSGLIBD) PARM(PANEL(BLSPPRIM))",
                         "PARM(PANEL(BLSPPRIM)) NEWAPPL(BLSG) PASSLIB"
              "IPCS NOPARM"
              exit
             end

         if batch = 'BATCH' then
            do
              say '@IPCSCUR rexx exec batch execution'
              say 'existing' userid'.DDIR.SVCDUMP',
                  'vsam dump directory allocated'
              say 'dataset' userid'.IPCSPRNT will be created'
              queue "SETDEF LENGTH(200) FLAG(ERROR) LIST",
                          "DISPLAY(MACHINE,REMARK,STORAGE,SYMBOL)",
                          "NOCONFIRM NOVERIFY TERMINAL NOPRINT"
              "IPCS NOPARM"
               exit
            end

1

         Getting Started Using IPCS/ESA                      Page #21



         I have included a sample job showing how to run IPCS
         in batch tso to prime the IPCS VSAM DUMP directory
         before you perform later IPCS interactive analysis
         (see Figure #9).  This is done for performance reasons!

         Note: You can only have one user of either @IPCSBGN
               or @IPCSCUR at a time due to the same named
               IPCS VSAM DUMP directory


         FIGURE #9         PROCESS SVCDUMP USING IPCS IN BATCH
+        _________         ___________________________________


         //USERIDX JOB acct-info,'IPCSJOB',CLASS=A,
         // MSGCLASS=X,NOTIFY=USERID,TYPRUN=HOLD
         /*JOBPARM ROOM=3004
         //IPCSJOB EXEC  PGM=IKJEFT01,
         // DYNAMNBR=75,REGION=5M,TIME=1439
         //SYSPROC   DD  DSN=USERID.CLIST,DISP=SHR
         //SYSTSPRT  DD  SYSOUT=*
         //SYSTSIN   DD  *
         PROFILE PREFIX(USERID)
         DELETE OUTDSN
         %@IPCSCUR BATCH
         SETDEF NOTERMINAL PRINT
         SETDEF DSNAME('USERID.SVCDUMP.NO1')
         STATUS FAILDATA REGISTERS
         LISTDUMP
         %@IPCSTRM
         RENAME IPCSPRNT OUTDSN
         /*


         An additional IPCS SETDEF command is issued after the
         %@IPCSCUR command to show that we are changing SETDEF
         defaults to run in batch TSO.  You could also change
         the IPCS SETDEF defaults in the @IPCSCUR (and/or %@IPCSBGN)
         rexx execs for the BATCH option.  The choice is yours.


1

         Getting Started Using IPCS/ESA                      Page #22



        I want to introduce a few last procedures to be used for
        looking at stand-alone dumps.  Due to the very large size of
        stand-alone dumps on dasd (and many DB2 SVCDUMPs for
        that matter), I run a special batch job to prime the
        newly-allocated IPCS VSAM DUMP directory for performance
        reasons (see comments in Figure #11).  Before you run this
        this job, run the job in Figure #10 FIRST!



         FIGURE #10        COPY STAND-ALONE DUMP
+        __________        _____________________

                           FROM TAPE TO DASD
+                          _________________

         //USERIDL JOB acct-info,'IPCSDMP',CLASS=A,
         // MSGCLASS=X,NOTIFY=USERID
         /*JOBPARM ROOM=3004
         //*
         //*************************************************************
         //*                                                           *
         //*     LOAD STAND-ALONE DUMP FROM TAPE TO DASD.              *
         //*                                                           *
         //*************************************************************
         //*
         //SADUMP EXEC PGM=IEBGENER,REGION=5M,TIME=1439
         // REGION=5M,TIME=1439
         //SYSPRINT DD SYSOUT=*
         //SYSIN    DD DUMMY
         //SYSUT1   DD   DSN=SADUMP,
         // UNIT=(TAPE,,DEFER),
         // LABEL=(1,NL,,EXPDT=98000),
         // VOL=SER=123456,
         // LRECL=4160,
         // BLKSIZE=29120,
         // RECFM=FBS,
         // DISP=OLD
         //SYSUT2 DD DSN=USERID.SADUMP.CATENQ,
         // UNIT=(SYSDA,3),
         // LRECL=4160,
         // BLKSIZE=4160,
         // RECFM=F,
         // SPACE=(CYL,(90,20),RLSE),
         // DISP=(,CATLG,DELETE)
1

         Getting Started Using IPCS/ESA                      Page #23



         Note the DCB attributes of the STAND-ALONE DUMP tape!
         I was not able to find this information in any IBM
         manual!  I finally found the information in an old
         INFO/MVS entry (E339958) that discussed this topic.
         I would definitely recommend allowing your dasd
         dataset to be multivolume due to the probability
         this will be one very large dataset.


         This next job will create your initialized and loaded
         IPCS VSAM DUMP directory.  For stand-alone dumps, you
         should do it via a batch job because of the amount of
         data to process.


         FIGURE #11        INITIALIZE STAND-ALONE
+        __________        ______________________

                           IPCS VSAM DUMP DIRECTORY
+                          ________________________


         //USERIDI JOB acct-info,'IPCSDDR',CLASS=J,
         // MSGCLASS=X,NOTIFY=USERID,TYPRUN=HOLD
         /*JOBPARM ROOM=3004
         //*
         //*************************************************************
         //*                                                           *
         //*   THIS JOB WILL DEFINE AND LOAD AN IPCS VSAM DUMP         *
         //*   DIRECTORY WITH THE DUMP YOU SPECIFY.                    *
         //*                                                           *
         //*                                                           *
         //*   WARNING:  THIS JOB CAN TAKE A LOT OF CPU TIME           *
         //*             DEPENDING ON THE SIZE OF THE SEQUENTIAL       *
         //*             DUMP DATASET!                                 *
         //*                                                           *
         //*                                                           *
         //*   1ST STEP:    DEFINE IPCS VSAM DUMP DIRECTORY.           *
         //*                                                           *
         //*                                                           *
         //*   2ND STEP:    INVOKE IPCS AND INITIALIZE YOUR            *
         //*                IPCS VSAM DUMP DIRECTORY                   *
         //*                                                           *
         //*                YOU MUST SPECIFY YOUR IPCS VSAM            *
         //*                DUMP DIRECTORY CREATED IN STEP #1          *
         //*                IN THE IPCSDDIR DD STATEMENT.              *
         //*                                                           *
         //*                                                           *
         //*   3RD STEP:    INVOKE IPCS AND LOAD IPCS DUMP             *
         //*                DIRECTORY CREATED IN STEP #1.              *
         //*                                                           *
         //*************************************************************
1

         Getting Started Using IPCS/ESA                      Page #24



         FIGURE #11        INITIALIZE STAND-ALONE
+        __________        ______________________

                           IPCS VSAM DUMP DIRECTORY  (CONTINUED)
+                          ________________________


         //*************************************************************
         //*                                                           *
         //*                YOU MUST SPECIFY YOUR IPCS VSAM            *
         //*                DUMP DIRECTORY CREATED IN STEP #1          *
         //*                IN THE IPCSDDIR DD STATEMENT.              *
         //*                                                           *
         //*                YOU MUST SPECIFY YOUR SEQUENTIAL           *
         //*                DASD DUMP DATASET IN THE DSNAME            *
         //*                KEYWORD PARAMETER OF THE SETDEF            *
         //*                STATEMENT.                                 *
         //*                                                           *
         //*                                                           *
         //*   ALL CONDITION CODES SHOULD BE 0                         *
         //*                                                           *
         //*************************************************************
         //*
         //DEFINE   EXEC  PGM=IDCAMS,
         // REGION=1M
         //SYSPRINT DD  SYSOUT=*
         //SYSIN    DD  *
            DEFINE CLUSTER(NAME('USERID.DDIR.SADUMP.IECVPST') +
                VOLUME(999999) +
                FREESPACE(10,10) +
                INDEXED +
                REUSE +
                IMBED +
                REPLICATE +
                SHAREOPTIONS(1,3)) +
                INDEX(NAME('USERID.DDIR.SADUMP.IECVPST.INDEX') +
                  CYLINDERS(1,1) +
                  CISZ(4096)) +
                DATA(NAME('USERID.DDIR.SADUMP.IECVPST.DATA') +
                  CYLINDERS(100,50) +
                  CISZ(4096) +
                  KEYS(128,0) +
                  RECORDSIZE(384 3072))
         /*
1

         Getting Started Using IPCS/ESA                      Page #25



         FIGURE #11        INITIALIZE STAND-ALONE
+        __________        ______________________

                           IPCS VSAM DUMP DIRECTORY  (CONTINUED)
+                          ________________________


         //DDIRPREP EXEC PGM=IKJEFT01,
         // DYNAMNBR=75,TIME=1439,REGION=5M,COND=(0,NE)
         //IPCSDDIR  DD  DSN=USERID.DDIR.SADUMP.IECVPST,
         //  DISP=OLD,
         //  AMP=('BUFND=20,BUFNI=10')
         //SYSTSPRT  DD  SYSOUT=*
         //SYSTSIN   DD  *
         IPCSDDIR 'USERID.DDIR.SADUMP.IECVPST'
         /*
         //IPCSLOAD EXEC PGM=IKJEFT01,
         // DYNAMNBR=75,TIME=1439,REGION=5M,COND=(0,NE)
         //IPCSDDIR  DD  DSN=USERID.DDIR.SADUMP.IECVPST,
         //  DISP=OLD,
         //  AMP=('BUFND=20,BUFNI=10')
         //IPCSPRNT  DD  SYSOUT=*
         //SYSTSPRT  DD  SYSOUT=*
         //SYSTSIN   DD  *
         IPCS NOPARM
         SETDEF DSNAME('USERID.SADUMP.IECVPST')
         SETDEF TERMINAL NOPRINT NOVERIFY NOCONFIRM
         SELECT CURRENT ERROR
         STATUS FAILDATA REGISTERS CPU
         SUMMARY JOBSUMMARY
         END
         /*


         I use the VSAM AMP parameter to allow us to add many more
         than the default VSAM buffer allocations of 1 index
         and 2 data buffers to maximize performance.  JUST BE
         AWARE THAT THIS JOB RUNS AWHILE SO NOW IS A GOOD TIME FOR
         A BIG CUP OF COFFEE!

1

         Getting Started Using IPCS/ESA                      Page #26



         Our final rexx exec is the %@IPCSSAD procedure which
         uses our IPCS VSAM DUMP directory allocated in
         Figure #11.  The %@IPCSSAD procedure uses the
         same name in the stand-alone dump JCL from Figure #11.
         You will notice many similarities to the %@IPCSCUR rexx
         exec.  The batch JCL in Figure #9 can process a stand-alone
         dump by just using the %@IPCSSAD rexx exec.
         Likewise, the @BROWSE, @EDIT and @UTILITY
         rexx execs work the same as for SVCDUMP processing
         (see Figure #12):



         FIGURE #12        %@IPCSSAD
+        __________        _________


         /**************************** REXX ****************************
         /*
         /*      This REXX EXEC will run IPCS in either INTERACTIVE
         /*      or BATCH mode using an IPCS VSAM DUMP DIRECTORY created
         /*      by the IPCSDDR batch job.
         /*
         /*      NOTE: You must be outside of ISPF/PDF to run this EXEC!
         /*
         /*
         /*      Keyword operands
         /*
         /*      SUFX  ==>  last index name of your sequential dump
         /*                 dataset for the stand-alone dump
         /*
         /*      BATCH  ==>  specify this operand if you want IPCS to
         /*                  be run in batch (interactive is default)
         /*
         /**************************************************************

         arg sufx batch

         status = MSG('OFF')

1

         Getting Started Using IPCS/ESA                      Page #27


         FIGURE #12        %@IPCSSAD  (CONTINUED)
+        __________        _________


         subcom ispexec
         if rc=0 then
            do
              say '@IPCSSAD rexx exec cannot be executed under ISPF'
              exit
            end
         else NOP

         USERID = SYSVAR(syspref)
         savelne = OUTTRAP(outlne,1)

         "DELETE '"USERID".IPCSPRNT'"
         if rcë=0 then
            do
              say 'DELETE TSO command failed'
              say 'for IPCS print dataset - RC is' rc
            end
         else NOP

         "ALLOCATE F(IPCSPRNT) DA('"USERID".IPCSPRNT')",
            "NEW SPA(5 1) CYL REL REUSE"
         if rcë=0 then
            do
              say 'ALLOCATE TSO command failed'
              say 'for IPCS print dataset - RC is' rc
              exit
            end
         else NOP

         ddir = sysdsn("'"USERID".DDIR.SADUMP."sufx"'")
         if ddir = 'DATASET NOT FOUND' then
            do
               SAY USERID'.DDIR.SADUMP.'sufx NOT FOUND
               "%@IPCSTRM"
               exit
            end

         "ALLOCATE F(IPCSDDIR) DA('"USERID".DDIR.SADUMP."sufx"') SHR REU
         if rcë=0 then
            do
              say 'ALLOCATE TSO command failed'
              say 'for IPCS dump directory - RC is' rc
              exit
            end
         else NOP

1

         Getting Started Using IPCS/ESA                      Page #28


         FIGURE #12        %@IPCSSAD  (CONTINUED)
+        __________        _________


         if batch ë= 'BATCH' then
          do
            say '@IPCSSAD rexx exec online execution'
            say 'existing' userid'.DDIR.SADUMP.'sufx,
                'vsam dump directory allocated'
            say 'dataset' userid'.IPCSPRNT will be created'
            queue "SETDEF LENGTH(200) FLAG(ERROR) LIST",
                        "DISPLAY(MACHINE,REMARK,STORAGE,SYMBOL)",
                        "NOCONFIRM NOVERIFY TERMINAL NOPRINT"
            queue "ISPF PGM(BLSGLIBD) PARM(PANEL(BLSPPRIM))",
                       "PARM(PANEL(BLSPPRIM)) NEWAPPL(BLSG) PASSLIB"
            "IPCS NOPARM"
            exit
           end

         if batch = 'BATCH' then
          do
            say '@IPCSSAD rexx exec batch execution'
            say 'existing' userid'.DDIR.SADUMP.'sufx,
                'vsam dump directory allocated'
            say 'dataset' userid'.IPCSPRNT will be created'
            queue "SETDEF LENGTH(200) FLAG(ERROR) LIST",
                        "DISPLAY(MACHINE,REMARK,STORAGE,SYMBOL)",
                        "NOCONFIRM NOVERIFY TERMINAL NOPRINT"
            "IPCS NOPARM"
             exit
          end

1

         Getting Started Using IPCS/ESA                      Page #29



         I hope I have given you a brief but valuable introduction
         to my JCL and REXX EXECS I use for IPCS/ESA that make
         life a whole lot easier.  I have corresponding IPCS CLISTS
         (beginning with the character # instead of @) that will
         do the same thing as the REXX EXECS.


         I have begun submission of all of these procedures to
         the NaSPA VIP tape and/or CBT tape but if you can't
         find them there by the time this article is out
         please contact the editor and get in touch with me
         so I can get you copies of these useful tools.


         I want to give a special thanks to Ms. Ingrid Hines who is an
         IBM Advisory Software Support Specialist and Mr. Jim Chabot
         an IBM IPCS instructor for their careful review of this
         article.


         I hope to do future articles on IPCS/ISPF dialog usage
         and IPCS command usage.  Save those dumps for next time!

