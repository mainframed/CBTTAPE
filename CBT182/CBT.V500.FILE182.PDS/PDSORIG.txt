*          DATA SET CBT709     AT LEVEL 002 AS OF 09/01/76
PDS      TITLE 'T S O   P D S   C O M M A N D   P R O C E S S O R'      00001
*********************************************************************** 00002
*                                                                     * 00003
*                                                                     * 00004
* TITLE -      P D S   -   TSO PDS PROCESSOR                          * 00005
*                                                                     * 00006
* FUNCTION -   PROVIDE THE TSO USER WITH THE CAPABILITY               * 00007
*              TO MANIPULATE A PARITIONED DATA SET                    * 00008
*              DIRECTORY AND SELECTED MEMBERS.                        * 00009
*                                                                     * 00010
*                                                                     * 00011
* OPERATION -  OPERATES AS A STANDARD COMMAND PROCESSOR UNDER         * 00012
*              TSO. ALLOCATES THE DATA SET(S) REQUESTED BY THE        * 00013
*              USER. PROVIDES DISPLAY, RENAME, SCRATCH, AND           * 00014
*              ALIAS FUNCTIONS FOR THE DIRECTORY ENTRIES.             * 00015
*              PRODUCES LOAD MODULE MAPS AND HISTORY SUMMARIES.       * 00016
*              DISPLAYS THE CONTENTS OF MEMBERS OF THE DATA SET.      * 00017
*                                                                     * 00018
*                                                                     * 00019
* INPUT -      STANDARD COMMAND PROCESSOR PARAMETER LIST              * 00020
*              POINTED TO BY REGISTER 1                               * 00021
*                                                                     * 00022
*                                                                     * 00023
* OUTPUT -     NOT APPLICABLE.                                        * 00024
*                                                                     * 00025
*                                                                     * 00026
* ATTRIBUTES - REENTRANT, REUSEABLE, REFRESHABLE.                     * 00027
*                                                                     * 00028
*                                                                     * 00029
*                                                                     * 00030
*                                                                     * 00031
*********************************************************************** 00032
         EJECT                                                          00033
         MACRO                                                          00034
&NAME    SCREEN &TYPE                                                   00035
&NAME    SVC   236 .                    ISSUE SPNB ERASE SVC            00036
         MEND                                                           00037
         SPACE 3                                                        00038
         MACRO                                                          00039
&NAME    CLEAR &FIELD                                                   00040
         LCLC  &L                                                       00041
&L       SETC  'L'''                                                    00042
&NAME    MVI   &FIELD,C' '                                              00043
         MVC   &FIELD+1(&L&FIELD-1),&FIELD                              00044
         MEND                                                           00045
         SPACE 3                                                        00046
         MACRO                                                          00047
&NAME    MSG   &TEXT                                                    00048
         LCLA  &A                                                       00049
&A       SETA  K'&TEXT-2+4                                              00050
&NAME    DC    0H'0',AL2(&A,0),C&TEXT                                   00051
         MEND                                                           00052
         EJECT                                                          00053
         MACRO                                                          00054
&NAME    ENTER &TYPE,&PDL=                                              00055
         GBLC  &MAIN                                                    00056
         AIF   ('&TYPE' NE '').A1                                       00057
&MAIN    SETC  '&NAME'                                                  00058
&NAME    CSECT                                                          00059
         SAVE  (14,12),,*                                               00060
         LR    BASEREG1,R15                                             00061
         LA    BASEREG2,4095(,BASEREG1)                                 00062
         LA    BASEREG2,1(,BASEREG2)                                    00063
         USING &NAME,BASEREG1,BASEREG2                                  00064
         SPACE 2                                                        00065
         B     IHB&SYSNDX                                               00066
         DC    C'COPYRIGHT 1975 BY SECURITY PACIFIC NATIONAL BANK'      00067
IHB&SYSNDX DS  0H                                                       00068
         MEXIT                                                          00069
.A1      AIF   ('&TYPE' NE 'VALCHECK').A2                               00070
&NAME    CSECT                                                          00071
         SAVE  (14,12),,*                                               00072
         LR    VLDBASE,R15 .            ESTABLISH BASE REGISTER         00073
         USING &NAME,VLDBASE                                            00074
         L     WORKREG,4(,R1) .         WORK AREA ADDRESS               00075
         LM    BASEREG1,BASEREG2,BASES .RELOAD MAIN BASE REGISTERS      00076
         L     RPDL,0(,R1) .            PDE ADDRESS                     00077
         LA    R15,VALSAVE              VALIDITY CHECK SAVE AREA        00078
         AGO   .SETSAVE                                                 00079
.A2      ANOP                                                           00080
         AIF   ('&TYPE' NE 'ATTNEXIT').A3                               00081
&NAME    SAVE  (14,12)                                                  00082
         L     WORKREG,8(,R1)                                           00083
         LM    BASEREG1,BASEREG2,BASES                                  00084
         LA    R15,ATTNSAVE                                             00085
         AGO   .SETSAVE                                                 00086
.A3      ANOP                                                           00087
         AIF   ('&TYPE' NE 'COMMAND').A4                                00088
&NAME    CSECT                                                          00089
         SAVE  (14,12),,*                                               00090
         LR    CMDBASE,R15 .            ESTABLISH BASE REGISTER         00091
         USING &NAME,CMDBASE                                            00092
         AIF   ('&PDL' EQ '').NOPDL                                     00093
         USING &PDL,RPDL .          ESTABLISH BASE FOR PDL              00094
.NOPDL   ANOP                                                           00095
         LA    R15,CMDSAVE                                              00096
         AGO   .SETSAVE                                                 00097
.A4      ANOP                                                           00098
         MNOTE 8,'INVALID TYPE ''&TYPE'''                               00099
         MEXIT                                                          00100
.SETSAVE ANOP                                                           00101
         ST    R13,4(,R15)                                              00102
         ST    R15,8(,R13)                                              00103
         LR    R13,R15                                                  00104
         MEND                                                           00105
         EJECT                                                          00106
         MACRO                                                          00107
&NAME    EXIT  &TYPE,&LV=                                               00108
         GBLC  &MAIN                                                    00109
         AIF   ('&NAME' EQ '').NONAME                                   00110
&NAME    DS    0H                                                       00111
.NONAME  ANOP                                                           00112
         AIF   ('&LV' EQ '').A1                                         00113
         LR    R2,R13         ADDR OF THIS SAVE AREA                    00114
.A1      L     R13,4(,R13)                                              00115
         STM   R15,R1,16(R13) RETURN REGS 15, 0, 1                      00116
         AIF   ('&LV' EQ '').A2 NOT DYNAMIC CORE                        00117
         FREEMAIN R,LV=&LV,A=(R2)                                       00118
.A2      SPACE                                                          00119
         RETURN (14,12),T                                               00120
&MAIN    CSECT                                                          00121
         MEND                                                           00122
         SPACE 3                                                        00123
         MACRO $PUTGET -  OUTPUT A DATA LINE AND GET RESPONSE           00124
&NAME   $PUTGET  &LINE,&ATTN=                                           00125
         AIF   ('&NAME' EQ '').NONAME                                   00126
&NAME    DS    0H                                                       00127
.NONAME  ANOP                                                           00128
         AIF   ('&LINE' EQ '(1)' OR '&LINE' EQ '(R1)').CALL             00129
         AIF   ('&LINE'(1,1) EQ '(').R                                  00130
         LA    R1,&LINE .            ADDRESS OF DATA LINE               00131
         AGO   .CALL                                                    00132
.R       ANOP                                                           00133
         LR    R1,&LINE(1) .                ADDRESS OF DATA LINE        00134
.CALL    ANOP                                                           00135
         BAL   R14,$PUTGET .            INVOKE PUTGET INTERFACE         00136
         AIF   ('&ATTN' EQ '').NOATTN                                   00137
         B     &ATTN .               EXIT IF ATTENTION OCCURRED         00138
         AGO   .END                                                     00139
.NOATTN  NOP   0 .                      IGNORE ATTENTIONS               00140
.END     MEND                                                           00141
         EJECT                                                          00142
         MACRO $PUTLINE -  OUTPUT A DATA LINE                           00143
&NAME   $PUTLINE &LINE,&ATTN=                                           00144
         AIF   ('&NAME' EQ '').NONAME                                   00145
&NAME    DS    0H                                                       00146
.NONAME  ANOP                                                           00147
         AIF   ('&LINE' EQ '(1)' OR '&LINE' EQ '(R1)').CALL             00148
         AIF   ('&LINE'(1,1) EQ '(').R                                  00149
         LA    R1,&LINE .            ADDRESS OF DATA LINE               00150
         AGO   .CALL                                                    00151
.R       ANOP                                                           00152
         LR    R1,&LINE(1) .                ADDRESS OF DATA LINE        00153
.CALL    ANOP                                                           00154
         BAL   R14,$PUTLINE .           INVOKE PUTLINE INTERFACE        00155
         AIF   ('&ATTN' EQ '').NOATTN                                   00156
         B     &ATTN .               EXIT IF ATTENTION OCCURRED         00157
         AGO   .END                                                     00158
.NOATTN  NOP   0 .                      IGNORE ATTENTIONS               00159
.END     MEND                                                           00160
         SPACE 2                                                        00161
         MACRO MESSAGE - OUTPUT AN ERROR/STATUS MESSAGE                 00162
&NAME    MESSAGE &MSG1,&MSG2                                            00163
         AIF   ('&MSG1' NE '').MSG1OK                                   00164
         MNOTE 12,'PRIMARY MESSAGE ADDRESS NOT SPECIFIED'               00165
         AGO   .END                                                     00166
.MSG1OK  ANOP                                                           00167
         AIF   ('&NAME' EQ '').NONAME                                   00168
&NAME    DS    0H                                                       00169
.NONAME  ANOP                                                           00170
         AIF   ('&MSG1' EQ '(1)' OR '&MSG1' EQ '(R1)').MSG2             00171
         AIF   ('&MSG1'(1,1) EQ '(').RMSG1                              00172
         LA    R1,&MSG1 .               ADDRESS OF PRIMARY MESSAGE      00173
         AGO   .MSG2                                                    00174
.RMSG1   ANOP                                                           00175
         LR    R1,&MSG1(1) .            ADDRESS OF PRIMARY MESSAGE      00176
.MSG2    ANOP                                                           00177
         AIF   ('&MSG2' EQ '').NOMSG2 NO SECONDARY MESSAGE              00178
         AIF   ('&MSG2' EQ '(0)' OR '&MSG2' EQ '(R0)').CALL             00179
         AIF   ('&MSG2'(1,1) EQ '(').RMSG2                              00180
         LA    R0,&MSG2 .               ADDRESS OF SECONDARY MESSAGE    00181
         AGO   .CALL                                                    00182
.RMSG2   ANOP                                                           00183
         LR    R0,&MSG2(1) .            ADDRESS OF SECONDARY MESSAGE    00184
.CALL    ANOP                                                           00185
         BAL   R14,MESSAGE .            SEND MESSAGES                   00186
         AGO   .END                                                     00187
.NOMSG2  ANOP                                                           00188
         BAL   R14,MESSAGE0 .           SEND PRIMARY MESSAGE            00189
.END     MEND                                                           00190
         EJECT                                                          00191
R0       EQU   0                                                        00192
R1       EQU   1                                                        00193
R2       EQU   2                                                        00194
R3       EQU   3                                                        00195
R4       EQU   4                                                        00196
R5       EQU   5                                                        00197
R6       EQU   6                                                        00198
R7       EQU   7                                                        00199
RPDL     EQU   8                                                        00200
WORKREG  EQU   9                                                        00201
BASEREG1 EQU   10                                                       00202
BASEREG2 EQU   11                                                       00203
VLDBASE  EQU   12                                                       00204
CMDBASE  EQU   12                                                       00205
R13      EQU   13                                                       00206
R14      EQU   14                                                       00207
R15      EQU   15                                                       00208
         SPACE 5                                                        00209
PDS      ENTER                                                          00210
         LR    R2,R1          SAVE ADDR OF CPPL                         00211
         SPACE                                                          00212
         L     R3,CORESIZE                                              00213
         GETMAIN R,LV=(R3)                                              00214
         SPACE 2                                                        00215
         LR    WORKREG,R1    ADDR OF WORK AREA                          00216
         USING WORKAREA,WORKREG                                         00217
         EJECT                                                          00218
*                                                                       00219
*        CLEAR WORK AREA                                                00220
*                                                                       00221
         SPACE 2                                                        00222
         LA    R14,0(,R3)     LENGTH OF AREA                            00223
         BCTR  R14,0          EXECUTED LENGTH                           00224
         LA    R15,255        LOOP FACTOR                               00225
LOOP01   CR    R14,R15        LAST PASS?                                00226
         BNH   LOOP00         YES                                       00227
CLEAR1   XC    0(0,R1),0(R1)                                            00228
         EX    R15,CLEAR1                                               00229
         LA    R1,256(,R1)                                              00230
         SR    R14,R15                                                  00231
         BCT   R14,LOOP01     IF MORE TO CLEAR                          00232
         SPACE                                                          00233
LOOP00   EX    R14,CLEAR1     CLEAR LAST AREA                           00234
         SPACE 2                                                        00235
         STM   BASEREG1,BASEREG2,BASES SAVE BASE REGISTERS              00236
         SPACE 3                                                        00237
*                                                                       00238
*        INITIALIZE WORK AREA                                           00239
*                                                                       00240
         SPACE 2                                                        00241
         MVC   BLDLLIST,BLDLPARM                                        00242
         SPACE                                                          00243
         GTSIZE ,             GET TERMINAL LINE SIZE                    00244
         STH   R1,LINESIZE                                              00245
         SPACE 3                                                        00246
         LA    R0,IOECB                 ECB ADDRESS                     00247
         ST    R0,IOBECB                SET INTO IOB                    00248
         LA    R0,INDCB                 DCB ADDRESSS                    00249
         ST    R0,IOBDCB                SET INTO DCB                    00250
         LA    R0,CCWS                  CCW CHAIN ADDRESS               00251
         ST    R0,IOBCCW                SET INTO IOB                    00252
         MVI   IOBFLAG,X'42'            SET IOB FLAGS                   00253
         EJECT                                                          00254
*                                                                       00255
*        ESTABLISH STAE EXIT                                            00256
*                                                                       00257
         SPACE 3                                                        00258
         MVC   STAEPARM(LSTAE),STAE MOVE PATTERN STAE TO WORK AREA      00259
         STAE  STAEEXIT,CT,PARAM=WORKAREA,MF=(E,STAEPARM) ISSUE STAE    00260
         SPACE                                                          00261
         LA    R15,MAINSAVE                                             00262
         ST    R15,8(,R13)                                              00263
         ST    R13,4(,R15)                                              00264
         LR    R13,R15                                                  00265
         ST    R13,ADDRSAVE             ADDRESS OF FIRST SAVE AREA      00266
         EJECT                                                          00267
*                                                                       00268
*        LOAD TSO SERVICE ROUTINES                                      00269
*                                                                       00270
         SPACE 3                                                        00271
         USING CPPL,R2                  BASE FOR COMMAND PARM LIST      00272
         MVC   ADDRUPT,CPPLUPT          ADDR OF USER PROFILE TABLE      00273
         MVC   ADDRPSCB,CPPLPSCB        ADDR OF P S C B                 00274
         MVC   ADDRECT,CPPLECT          ADDR OF ENVIROMENT TABLE        00275
         MVC   ADDRCBUF,CPPLCBUF        ADDR OF FIRST CMD BUFFER        00276
         ST    R2,CPPLADDR              SAVE CPPL ADDRESS               00277
         DROP  R2                                                       00278
         SPACE 3                                                        00279
         LA    R1,PARSELST                                              00280
         USING PPL,R1                                                   00281
         MVC   PPLUPT,ADDRUPT           SET ADDRESSES OF                00282
         MVC   PPLECT,ADDRECT           CONTROL BLOCKS IN               00283
         ST    WORKREG,PPLUWA           PARSE PARAMETER LIST            00284
         LA    R0,ATTNECB                                               00285
         ST    R0,PPLECB                                                00286
         SPACE 2                                                        00287
         LOAD  EPLOC=IKJPUTL            PUTLINE SERVICE ROUTINE         00288
         ST    R0,ADDRPUTL                                              00289
         LOAD  EPLOC=IKJGETL            GETLINE SERVICE ROUTINE         00290
         ST    R0,ADDRGETL                                              00291
         SPACE 2                                                        00292
         LOAD  EPLOC=IKJPTGT            PUTGET SERVICE ROUTINE          00293
         ST    R0,ADDRPTGT                                              00294
         SPACE 2                                                        00295
         LOAD  EPLOC=IKJSCAN            COMMAND SCAN SERVICE ROUTINE    00296
         ST    R0,ADDRSCAN                                              00297
         EJECT                                                          00298
*                                                                       00299
*                                                                       00300
*        SET UP TO INVOKE PARSE TO GET DATA SET NAME                    00301
*                                                                       00302
*                                                                       00303
         SPACE 2                                                        00304
         STAX  ,                                                        00305
         L     R1,MAINPCL               ADDRESS OF PCL FOR DATASET NAME 00306
         BAL   R14,GOPARSE              GET THE DATA SET NAME           00307
         B     EXIT12                   ERROR EXIT                      00308
         SPACE 2                                                        00309
         XC    ADDRCBUF,ADDRCBUF        NO COMMAND BUFFER LEFT          00310
         SPACE 2                                                        00311
RESTART  DS    0H                                                       00312
         BAL   R14,ALLOCATE             ALLOCATE THE DATA SET           00313
         B     EXIT12                   IF ALLOCATION UNSUCCESSFUL      00314
         SPACE 2                                                        00315
         NI    FLAGS,255-FRESTART                                       00316
         MVC   INDCB(LEXCPDCB),EXCPDCB  MOVE PATTERN DCBS TO            00317
         MVC   STOWDCB(LSAMDCB),SAMDCB  WORK AREA                       00318
         MVC   DCBDDNAM-IHADCB+INDCB,DDNAME                             00319
         MVC   DCBDDNAM-IHADCB+STOWDCB,DDNAME                           00320
         SPACE                                                          00321
         XC    OPENLIST(8),OPENLIST                                     00322
         MVI   OPENLIST,X'80'           SET E-O LIST INDICATOR          00323
         LA    R1,EXLSTX                                                00324
         ST    R1,0(,R13)                                               00325
         MVC   DCBEXLST+1-IHADCB+INDCB(3),1(R13)                        00326
         LA    R1,JFCB                                                  00327
         ST    R1,EXLSTX                                                00328
         MVI   EXLSTX,X'87'                                             00329
         RDJFCB (INDCB,INPUT),MF=(E,OPENLIST)                           00330
         XC    OPENLIST(8),OPENLIST     RESET MF=L AREA                 00331
         MVI   OPENLIST+4,X'80'         FOR 2 DCBS                      00332
         OPEN  (INDCB,INPUT,STOWDCB,INPUT),MF=(E,OPENLIST)              00333
         MVI   OPENLIST,X'80'                                           00334
         CLOSE (STOWDCB),MF=(E,OPENLIST)                                00335
         SPACE                                                          00336
         TM    INDCB+48,X'10' DID DCB OPEN?                             00337
         BO    NEWCMD                   CONTINUE IF YES                 00338
         SPACE 2                                                        00339
         MESSAGE MSGNOPEN               NO, ISSUE MESSAGE AND EXIT      00340
         B     EXIT12                   STAGE DOOR RIGHT                00341
         EJECT                                                          00342
*                                                                       00343
*                                                                       00344
*        DISPLAY PROGRAM OPTIONS FOR USER                               00345
*                                                                       00346
*                                                                       00347
         SPACE 1                                                        00348
LISTOPTS DS    0H                                                       00349
         SPACE                                                          00350
PUTOPTNS DS    0H                                                       00351
         L     R2,VOPTNTBL                                              00352
         SPACE                                                          00353
NEXTOPTN DS    0H                                                       00354
        $PUTLINE (R2)                   DISPLAY OPTION LINE             00355
         SPACE                                                          00356
         MVC   0(2,R13),0(R2)                                           00357
         LA    R0,1                                                     00358
         LH    R1,0(,R13)               ADJUST TO NEXT OPTION           00359
         AR    R1,R0                                                    00360
         OR    R1,R0                                                    00361
         XR    R1,R0                                                    00362
         AR    R2,R1                                                    00363
         CLI   0(R2),X'FF'              LAST ONE?                       00364
         BNE   NEXTOPTN                 NO                              00365
         SPACE 2                                                        00366
NEWCMD   DS    0H                                                       00367
         MVI   ATTNECB,0                                                00368
         NI    FLAGS,255-FMEMBER1-FMEMBER2-FATTR                        00369
         NI    FLAGS+1,255-FATTN                                        00370
         MVI   FLAGS+2,0                                                00371
         XC    ATTRYES,ATTRYES                                          00372
         XC    ATTRNO,ATTRNO                                            00373
         SPACE 2                                                        00374
         STAX  ,                           NULLIFY ATTN EXITS           00375
         SPACE 2                                                        00376
         TM    FLAGS,FCMD               COMMAND BUFFER AVAILABLE?       00377
         BO    HAVECMD                  YES                             00378
         SPACE                                                          00379
        $PUTGET MSGOP,ATTN=EXIT8                                        00380
         SPACE                                                          00381
         EJECT                                                          00382
*                                                                       00383
*                                                                       00384
*        SET UP FOR SUBCOMMAND SCAN                                     00385
*                                                                       00386
*                                                                       00387
         SPACE 2                                                        00388
HAVECMD  DS    0H                                                       00389
         NI    FLAGS,255-FCMD                                           00390
         SPACE 2                                                        00391
         LA    R1,PARMLIST                                              00392
         USING CSPL,R1                                                  00393
         SPACE                                                          00394
         MVC   CSPLUPT,ADDRUPT                                          00395
         MVC   CSPLECT,ADDRECT                                          00396
         LA    R0,ATTNECB                                               00397
         ST    R0,CSPLECB                                               00398
         MVI   ATTNECB,0                                                00399
         LA    R0,SCANANSR                                              00400
         ST    R0,CSPLOA                                                00401
         XC    SCANANSR,SCANANSR                                        00402
         LA    R0,R14SAVE                                               00403
         ST    R0,CSPLFLG                                               00404
         XC    R14SAVE,R14SAVE                                          00405
         SPACE                                                          00406
         MVC   CSPLCBUF,ADDRCBUF                                        00407
         SPACE                                                          00408
         L     R15,ADDRSCAN                                             00409
         BALR  R14,R15                  INVOKE COMMAND SCAN             00410
         SPACE                                                          00411
         LA    R1,SCANANSR              ADDR OF ANSWER AREA             00412
         USING CSOA,R1                                                  00413
         SPACE                                                          00414
         TM    CSOAFLG,CSOANOC          EMPTY BUFFER?                   00415
         BO    NEWCMD                   YES, STILL NEED COMMAND         00416
         SPACE                                                          00417
         TM    CSOAFLG,CSOAEXEC         IMPLICIT EXEC?                  00418
         BZ    HAVECMD1                 YES, DON'T INVOKE EXEC          00419
         SPACE 1                                                        00420
         L     R2,ADDRCBUF                                              00421
         XC    2(2,R2),2(R2)            CLEAR OFFSET                    00422
         SPACE                                                          00423
EXEC     L     R2,ADDRCBUF                                              00424
         L     R1,CPPLADDR                                              00425
         ST    R2,0(,R1)                                                00426
         SPACE 1                                                        00427
         LINK  EP=EXEC                                                  00428
         SPACE                                                          00429
         B     NEWCMD                                                   00430
         SPACE                                                          00431
HAVECMD1 DS    0H                                                       00432
         TM    CSOAFLG,CSOAVWP+CSOAVNP  VALID COMMAND?                  00433
         BNZ   CHECKCMD                 YES                             00434
         SPACE                                                          00435
         MESSAGE MSGINVLD               INVALID COMMAND                 00436
         B     NEWCMD                                                   00437
         EJECT                                                          00438
CHECKCMD DS    0H                                                       00439
         OI    FLAGS,FOPTIONS                                           00440
         TM    CSOAFLG,CSOAVWP          OPERAND PRESENT?                00441
         BO    *+8                      YES                             00442
         XI    FLAGS,FOPTIONS           NO                              00443
         SPACE                                                          00444
         L     R2,CSOACNM               ADDR OF COMMAND NAME            00445
         LH    R3,CSOALNM               LENGTH OF NAME                  00446
         BCTR  R3,0                                                     00447
         DROP  R1                                                       00448
         SPACE                                                          00449
         MVC   SUBNAME(0),0(R2)                                         00450
         EX    R3,*-6                   SAVE SUB COMMAND NAME           00451
         SPACE                                                          00452
         L     R1,VCMDTAB                                               00453
         SR    R15,R15                  SET UP FOR COMMAND SCAN         00454
         SR    R14,R14                                                  00455
         SPACE 2                                                        00456
* COMMAND SCAN ROUTINE                                                  00457
*    NOTE - IN THE CASE OF A POTENTIALLY AMBIGUOUS ENTRY                00458
*           (E.G. ''A'') THE FIRST MATCH IN THE CMDTABLE                00459
*           IS USED                                                     00460
         SPACE                                                          00461
CMDSCAN  IC    R15,8(,R1)               GET CMD LENGTH                  00462
         CR    R15,R3                   CHECK CMD LENGTH                00463
         BNH   NEXTCMD                                                  00464
         SPACE                                                          00465
         CLC   0(0,R1),0(R2)                                            00466
         EX    R3,*-6                   CHECK COMMAND NAME              00467
         BE    CMDVALID                 MATCH, MUST BE COMMAND          00468
         SPACE                                                          00469
NEXTCMD  DS    0H                                                       00470
         LA    R1,16(,R1)               NEXT ENTRY IN TABLE             00471
         CLI   0(R1),X'FF'              END OF TABLE?                   00472
         BNE   CMDSCAN                  NO, CONTINUE                    00473
         SPACE                                                          00474
         LA    R1,MSGUNKN               NOT A VALID COMMAND             00475
         SPACE                                                          00476
CMDERROR DS    0H                                                       00477
         MESSAGE (R1)                                                   00478
         B     NEWCMD                                                   00479
         SPACE                                                          00480
CMDVALID DS    0H                                                       00481
         LR    R14,R1                   SAVE CMD ENTRY                  00482
         MVC   ADDRPCL,12(R14)          SAVE PCL ADDR                   00483
         L     R1,8(,R14)               GET COMMAND PROCESSOR ADDRESS   00484
         ST    R1,ADDRCMD               SAVE IT                         00485
         SPACE 2                                                        00486
         TM    ADDRPCL,X'40'            IGNORE OPTIONS?                 00487
         BO    CALLCMD                  YES                             00488
         SPACE                                                          00489
         TM    ADDRPCL,X'80'            OPERANDS REQUIRED?              00490
         BZ    CMDPARSE                 YES                             00491
         TM    FLAGS,FOPTIONS           NO, WERE ANY SPECIFIED?         00492
         BZ    CALLCMD                                                  00493
         SPACE 2                                                        00494
CMDPARSE DS    0H                                                       00495
         L     R1,ADDRPCL                                               00496
         BAL   R14,GOPARSE              GET THE COMMAND OPERANDS        00497
         B     NEWCMD                   IF PARSE NOT SUCCESSFUL         00498
         EJECT                                                          00499
CALLCMD  DS    0H                                                       00500
         XC    PARMLIST(20),PARMLIST                                    00501
         SPACE 2                                                        00502
         XC    PARMLIST,PARMLIST                                        00503
         STAX  ATTNEXIT,USADDR=(WORKREG),REPLACE=YES,IBUF=0,OBUF=0,    X00504
               MF=(E,PARMLIST)                                          00505
         SPACE 2                                                        00506
         L     R15,ADDRCMD                                              00507
         L     RPDL,ADDRPDL             ADDRESS OF PARSE DESC LIST      00508
         BALR  R14,R15                  LINK TO COMMAND PROCESSOR       00509
         SPACE                                                          00510
         BAL   R14,FREEPDL              CLEAN UP AFTER COMMAND          00511
         SPACE 3                                                        00512
         B     NEWCMD                                                   00513
         EJECT                                                          00514
*                                                                       00515
*                                                                       00516
*        TERMINAL ATTENTION EXIT ROUTINE                                00517
*                                                                       00518
*                                                                       00519
         SPACE 3                                                        00520
ATTNEXIT ENTER ATTNEXIT                                                 00521
         TM    FLAGS+1,FATTN  ALLOW ATTENTIONS?                         00522
         BZ    EXITATTN       NO                                        00523
         SPACE 2                                                        00524
        $PUTGET MSGOP                   GET RESPONSE TO ATTN            00525
         SPACE                                                          00526
         TM    FLAGS,FNULL    NULL LINE ENTERED?                        00527
         BO    EXITATTN       YES, JUST LEAVE                           00528
         SPACE                                                          00529
         OI    FLAGS,FCMD     INDICATE COMMAND AVAILABLE                00530
         SPACE                                                          00531
         POST  ATTNECB                                                  00532
         SPACE                                                          00533
EXITATTN DS    0H                                                       00534
         SR    R15,R15                                                  00535
         EXIT                                                           00536
         EJECT                                                          00537
*                                                                       00538
*                                                                       00539
*        LIST SUBCOMMAND                                                00540
*                                                                       00541
*                                                                       00542
         SPACE 3                                                        00543
LIST     ENTER COMMAND,PDL=PDLLIST      ESTABLISH SUBCOMMAND            00544
         TM    FLAGS,FLOADMOD           THIS A LOAD MODULE LIBRARY?     00545
         LA    R1,MSGNLIST              MSG IF YES                      00546
         BO    LISTERR                  YES, ERROR                      00547
         SPACE 2                                                        00548
         MVC   DIRNAME,MEMBER1          LOCATE MEMBER TO BE LISTED      00549
         BLDL  INDCB,BLDLLIST                                           00550
         B     *+4(R15)                                                 00551
         SPACE 2                                                        00552
         B     LIST1                    00 - SUCCESSFUL                 00553
         B     LISTNONE                 04 - MEMBER NOT FOUND           00554
         B     LISTDERR                 08 - I/O ERROR IN DIRECTORY     00555
         SPACE 2                                                        00556
LIST1    DS    0H                                                       00557
         SPACE 2                                                        00558
         OI    FLAGS+1,FATTN            INDICATE ATTENTIONS ACCEPTED    00559
         EJECT                                                          00560
*                                                                       00561
*                                                                       00562
*        INITIALIZE CHANNEL PROGRAM TO READ SELECTED MEMBER             00563
*                                                                       00564
*                                                                       00565
*        CCW CHAIN USED IS -      SEARCH ID    -----+                   00566
*                                 TIC           ----+                   00567
*                                 READ COUNT                            00568
*                                 READ DATA                             00569
*                                                                       00570
         SPACE 2                                                        00571
         XC    CCWS(LCCWS),CCWS         CLEAR CCW AREA                  00572
         SPACE 2                                                        00573
         LA    R0,IOBSEEK               ADDRESS OF IOB SEEK             00574
         LA    R1,CCWS                  FIRST CCW - SEARCH CCW          00575
         L     R2,BUFFADDR              ADDRESS OF BUFFER               00576
         ST    R0,CCWS                  SEEK ADDRESS IN CCW1            00577
         ST    R1,CCWS+8                TIC ADDRESS IN CCW2             00578
         ST    R0,CCWS+16               READ COUNT ADDR IN CCW3         00579
         ST    R2,CCWS+24               BUFFER ADDR IN CCW4             00580
         LH    R3,BUFFSIZE              LENGTH OF BUFFER                00581
         STH   R3,CCWS+30               SET IN CCW4                     00582
         SPACE 2                                                        00583
         OC    CCWS(LLISTCCW),LISTCCWS  COPY PATTERN CCW CHAIN          00584
         SPACE 2                                                        00585
*                                                                       00586
*        CONVERT TTR OF START OF MEMBER TO CCHHR FORMAT                 00587
*                                                                       00588
         SPACE 2                                                        00589
         STM   14,12,12(13)             SAVE REGISTERS FOR RETURN       00590
         LA    R2,IOBSEEK-3             RETURN CCHHR IN IOBSEEK         00591
         L     R1,INDCB+(DCBDEBAD-IHADCB) DEB ADDRESS                   00592
         MVI   DIRTTR+3,0               CLEAR TTR CONCATENTION FIELD    00593
         L     R0,DIRTTR                GET TTR0 OF MEMBER              00594
         LA    R15,X'100'               GET TTR0 OF PREVIOUS RECORD     00595
         SLR   R0,R15                                                   00596
         L     R15,CVT                                                  00597
         L     R15,CVTPCNVT(,R15)       ADDRESS OF TTR-CCHHR CONVERT    00598
         LR    R3,R13                   SAVE ADDRESS OF SAVE AREA       00599
         BALR  R14,R15                                                  00600
         LR    R13,R3                   RESTORE SAVE AREA ADDRESS       00601
         LM    14,12,12(13)             RESTORE REGISTERS               00602
         EJECT                                                          00603
LIST2    DS    0H                                                       00604
         MVI   IOECB,0                                                  00605
         EXCP  IOB                      READ NEXT RECORD                00606
         WAIT  ECB=IOECB                                                00607
         MVI   DCBIFLGS-IHADCB+INDCB,0  CLEAR I/O STATUS FLAGS          00608
         SPACE 2                                                        00609
         TM    IOBCSW+3,X'01'           END-OF-FILE?                    00610
         BO    LISTEND                  YES                             00611
         SPACE 2                                                        00612
         CLI   IOECB,X'42'              OUT OF EXTENT?                  00613
         BNE   LIST3                    NO, CHECK STATUS                00614
         BAL   R14,NEWEXTNT             YES, ADJUST FOR NEW EXTENT      00615
         MVI   IOBSEEK+4,0              CORRECT TO RECORD 0             00616
         B     LIST2                    THEN RE-READ RECORD             00617
         SPACE                                                          00618
LIST3    DS    0H                                                       00619
         CLI   IOECB,X'7F'              SUCCESSFUL?                     00620
         LA    R1,MSGLISTI              ERROR MESSAGE FOR I/O ERROR     00621
         BNE   LISTERR                  NO, I/O ERROR                   00622
         SPACE 2                                                        00623
LIST5    DS    0H                                                       00624
         LH    R3,BUFFSIZE              MAXIMUM RECORD LENGTH           00625
         SH    R3,IOBCSW+5              SUBTRACT RESIDUAL COUNT         00626
         L     R4,BUFFADDR              START OF BUFFER                 00627
         AR    R3,R4                    ADDRESS OF END OF BUFFER        00628
         SPACE 2                                                        00629
         TM    DCBRECFM-IHADCB+INDCB,X'40' IS FILE VARIABLE FORMAT?     00630
         LH    R2,LRECL                 GET RECORD LENGTH IF NOT        00631
         LA    R5,LISTFIX               FIXED LENGTH RECORD PROCESSOR   00632
         BZ    LIST6                    NO, FIXED FORMAT                00633
         SPACE 2                                                        00634
         MVC   0(2,R13),0(R4)           GET BLOCK LENGTH                00635
         LH    R3,0(,R13)                                               00636
         AR    R3,R4                    END OF VARIABLE-LENGTH BLOCK    00637
         LA    R4,4(,R4)                START OF RECORD ENTRIES         00638
         LA    R5,LISTVAR               VARIABLE LEN RECORD PROCESSOR   00639
         SPACE 3                                                        00640
LIST6    DS    0H                                                       00641
         BCTR  R3,0                     SET END OF BUFFER ADDRESS       00642
         BR    R5                       PROCESS FIRST RECORD            00643
         EJECT                                                          00644
LISTVAR  DS    0H                                                       00645
         MVC   0(2,R13),0(R4)           GET LENGTH OF VARIABLE RECORD   00646
         LA    R4,4(,R4)                SKIP OVER HEADER                00647
         LH    R2,0(,R13)               GET LOGICAL RECORD LENGTH       00648
         LA    R0,4                                                     00649
         SR    R2,R0                    SUBTRACT HEADER LENGTH          00650
         BP    LISTFIX                  CONTINUE IF RECORD EXISTS       00651
         SPACE                                                          00652
         SR    R2,R2                                                    00653
         B     LIST7                                                    00654
         SPACE 2                                                        00655
LISTFIX  DS    0H                                                       00656
         TM    DCBRECFM-IHADCB+INDCB,X'06' SPECIAL CONTROL CHARACTERS?  00657
         BZ    LIST8                    NO                              00658
         LA    R4,1(,R4)                YES, SKIP CARRIAGE CONTROL      00659
         BCT   R2,LIST8                                                 00660
         SPACE 2                                                        00661
LIST7    DS    0H                                                       00662
         BXLE  R4,R2,0(R5)              SKIP TO NEXT RECORD             00663
         B     LIST2                    IF END OF BLOCK                 00664
         SPACE 3                                                        00665
LIST8    DS    0H                                                       00666
         LR    R1,R2                    LENGTH OF DATA AREA             00667
         BCTR  R1,0                     DECREMENT RECORD LEN FOR MOVE   00668
         MVC   MSGTEXT1+4(0),0(R4)                                      00669
         EX    R1,*-6                   MOVE RECORD TO LINE BUFFER      00670
         LA    R1,5(,R1)                LINE LENGTH PLUS HEADER FIELD   00671
         SLL   R1,16                                                    00672
         ST    R1,MSGTEXT1              CREATE OUTPUT LINE HEADER       00673
         LA    R1,MSGTEXT1                                              00674
LISTIT   DS    0H                                                       00675
        $PUTLINE MSGTEXT1,ATTN=LISTEND  OUTPUT THE NEXT LINE            00676
         SPACE 1                                                        00677
         B     LIST7                    GET NEXT RECORD                 00678
         EJECT                                                          00679
LISTERR  DS    0H                       ERROR DURING PROCESSING         00680
         MESSAGE (R1)                   ISSUE ONLY PRIMARY MESSAGE      00681
         B     LISTEND                  EXIT                            00682
         SPACE 2                                                        00683
LISTNONE DS    0H                                                       00684
         MESSAGE MSGNONE                ERROR - MEMBER DOES NOT EXIST   00685
         B     LISTEND                                                  00686
         SPACE 2                                                        00687
LISTDERR DS    0H                                                       00688
         MESSAGE MSGIOERR               I/O ERROR IN DIRECTORY          00689
         SPACE 3                                                        00690
LISTEND  DS    0H                                                       00691
         EXIT  COMMAND                  EXIT FROM SUBCOMMAND            00692
         EJECT                                                          00693
*                                                                       00694
*                                                                       00695
*              HELP  INVOCATION SUBCOMMAND                              00696
*                                                                       00697
*                                                                       00698
         SPACE 3                                                        00699
HELP     ENTER COMMAND     *** NO PDL IS USED FOR THIS SUBCOMMAND ***   00700
         SPACE 2                                                        00701
         L     R2,ADDRCBUF              GET INPUT BUFFER ADDR           00702
         L     R1,CPPLADDR                                              00703
         USING CPPL,R1                                                  00704
         ST    R2,CPPLCBUF              SET CMD ADDRESS                 00705
         DROP  R1                                                       00706
         SPACE                                                          00707
HELPLINK LINK  EP=HELP                  INVOKE THE HELP CMD PROCESSOR   00708
         SPACE                                                          00709
         EXIT COMMAND                                                   00710
         EJECT                                                          00711
*                                                                       00712
*                                                                       00713
*              USAGE STATISTICS SUBCOMMAND                              00714
*                                                                       00715
*                                                                       00716
         SPACE 3                                                        00717
USAGE    ENTER COMMAND     *** NO PDL IS USED FOR THIS SUBCOMMAND ***   00718
         SPACE 2                                                        00719
         OI    FLAGS+1,F1STREAD         INDICATE FIRST ENTRY            00720
         OI    FLAGS+2,FDIRSCAN         ALSO DIRECTORY SCAN REQUEST     00721
         SPACE 2                                                        00722
         BAL   R14,READDIR              SCAN THROUGH THE DIRECTORY      00723
         B     USE1                     IF END OF DIRECTORY             00724
         B     USE2                     IF I/O ERROR                    00725
         B     USE3                     IF PREMATURE EXIT               00726
         SPACE 2                                                        00727
USE1     DS    0H                                                       00728
         LA    R2,MSGUSEB               MSG - TOTAL BLOCKS ALLOCATED    00729
         LH    R1,TOTBLOCK              GET COUNTER                     00730
         BAL   R4,USEFMT                FORMAT MESSAGE                  00731
         SPACE                                                          00732
         LA    R2,MSGUSED               MSG - TOTAL BLOCKS USED         00733
         LH    R1,TOTUSED               GET COUNTER                     00734
         BAL   R4,USEFMT                                                00735
         SPACE                                                          00736
         LA    R2,MSGUSER               MSG - TOTAL MEMBERS             00737
         LH    R1,TOTMEMR               GET COUNTER                     00738
         AH    R1,TOTMEMA                                               00739
         BAL   R4,USEFMT                                                00740
         SPACE                                                          00741
         LA    R2,MSGUSEA               MSG - TOTAL ALIASES             00742
         LH    R1,TOTMEMA                                               00743
         LTR   R1,R1                    ANY ALIASES?                    00744
         BZ    USETOTAL                 NO                              00745
         BAL   R4,USEFMT                                                00746
         SPACE 2                                                        00747
USETOTAL DS    0H                                                       00748
         L     R1,DCBDEBAD-IHADCB+INDCB GET DEB ADDRESS                 00749
         SR    R14,R14                                                  00750
         SR    R15,R15                                                  00751
         SPACE 2                                                        00752
*                                                                       00753
*        CALCULATE TOTAL SIZE OF DATA SET AND UNUSED SPACE              00754
*                                                                       00755
         SPACE 2                                                        00756
         IC    R14,DEBXTNT#(,R1)        GET NUMBER OF EXTENTS IN D.S    00757
         STH   R14,DSNEXTNT             SAVE VALUE                      00758
         LA    R15,DEBAMLNG             GET SIZE OF EACH EXTENT         00759
         SR    R0,R0                                                    00760
USEXTNT  DS    0H                                                       00761
         AH    R0,DEBEXTNT+14(,R1)      ADD NUMBER OF TRACKS IN EXTENT  00762
         AR    R1,R15                   TO TOTAL AND JUMP TO NEW EXTENT 00763
         BCT   R14,USEXTNT              IF MORE EXTENTS                 00764
         SPACE                                                          00765
         STH   R0,DSNTOTAL              SAVE TOTAL D.S. SIZE IN TRACKS  00766
         SPACE 2                                                        00767
         L     R1,CVT                   GET CVT ADDRESS                 00768
         L     R1,0(,R1)                                                00769
         L     R1,4(,R1)                                                00770
         L     R1,12(,R1)               ADDRESS OF TIOT                 00771
         AH    R1,DCBTIOT-IHADCB+INDCB  ADDRESS OF TIOT ENTRY           00772
         L     R1,16(,R1)               ADDRESS OF UCB                  00773
         MVC   VOLUME,UCBVOLI(R1)       EXTRACT VOLUME SERIAL           00774
         SPACE 2                                                        00775
         L     R14,OBTAIN               GET OBTAIN FLAGS                00776
         LA    R15,DSNAME               ADDRESS OF FULL DATA SET NAME   00777
         LA    R0,VOLUME                ADDRESS OF VOLUME SERIAL        00778
         LA    R1,DSCB                  ADDRESS OF DSCB/WORKAREA        00779
         STM   R14,R1,CAMLST            SAVE FOR OBTAIN                 00780
         SPACE                                                          00781
         SR    R0,R0                                                    00782
         OBTAIN CAMLST                  GET DSCB                        00783
         LTR   R15,R15                                                  00784
         BNZ   USENDSCB                                                 00785
         SPACE 2                                                        00786
         LH    R1,DS1LSTAR+DSCB-44      GET TT OF LAST TRACK            00787
         LA    R1,1(,R1)                JUMP FOR COMPUTATION            00788
         LH    R0,DSNTOTAL              COMPUTE AMOUNT OF FREE SPACE    00789
         SR    R0,R1                                                    00790
         STH   R0,DSNEMPTY                                              00791
         SPACE 3                                                        00792
         LH    R1,DSNTOTAL              TOTAL SPACE USED                00793
         LA    R2,MSGUSESI              MSG FOR TOTAL SPACE             00794
         BAL   R4,USEFMT                                                00795
         SPACE                                                          00796
         LH    R1,DSNEMPTY              TOTAL FREE SPACE                00797
         LA    R2,MSGUSEMP                                              00798
         BAL   R4,USEFMT                                                00799
         SPACE                                                          00800
         LH    R1,DSNEXTNT              TOTAL EXTENTS                   00801
         LA    R2,MSGUSEXT                                              00802
         BAL   R4,USEFMT                                                00803
         SPACE 1                                                        00804
         MVC   MSGTEXT1(26),MSGUSEV     MESSAGE PATTERN                 00805
         MVC   MSGTEXT1+19(6),VOLUME      VOLID                         00806
        $PUTLINE MSGTEXT1                                               00807
         SPACE                                                          00808
         B     USEEXIT                                                  00809
         SPACE 2                                                        00810
USENDSCB DS    0H                                                       00811
         MESSAGE MSGNDSCB                                               00812
         B     USEEXIT                                                  00813
         SPACE 3                                                        00814
USEFMT   DS    0H                                                       00815
         CVD   R1,DOUBLE                CONVERT COUNTER TO DECIMAL      00816
         LA    R14,10                                                   00817
         SR    R15,R15                                                  00818
USEFMT1  DS    0H                                                       00819
         SR    R0,R0                                                    00820
         DR    R0,R14                   COMPUTE NUMBER OF SIGIF. DIGITS 00821
         LTR   R1,R1                    RESIDUAL FACTOR ZERO?           00822
         LA    R15,1(,R15)                                              00823
         BNZ   USEFMT1                  NO, KEEP GOING                  00824
         BCTR  R15,0                    YES, REDUCE FOR EXECUTE         00825
         LR    R1,R15                                                   00826
         SLL   R1,4                     SHIFT FOR EXECUTED UNPACK       00827
         OI    DOUBLE+7,X'0F'           CORRECT SIGN FOR EXECUTE        00828
         SPACE                                                          00829
         UNPK  MSGTEXT1+4(0),DOUBLE                                     00830
         EX    R1,*-6                                                   00831
         LA    R1,MSGTEXT1+5(R15)                                       00832
         SPACE                                                          00833
         LH    R15,0(,R2)                                               00834
         LA    R0,5                                                     00835
         SR    R15,R0                                                   00836
         MVC   0(,R1),4(R2)                                             00837
         EX    R15,*-6                                                  00838
         LA    R15,1(R1,R15)                                            00839
         LA    R0,MSGTEXT1                                              00840
         SR    R15,R0                                                   00841
         SLL   R15,16                                                   00842
         ST    R15,MSGTEXT1                                             00843
         SPACE 2                                                        00844
        $PUTLINE MSGTEXT1                                               00845
         SPACE                                                          00846
         BR    R4                       RETURN                          00847
         SPACE 3                                                        00848
USE2     DS    0H                                                       00849
USE3     DS    0H                                                       00850
         MESSAGE MSGUSERR                                               00851
         SPACE 3                                                        00852
USEEXIT  EXIT  COMMAND                                                  00853
         EJECT                                                          00854
*                                                                       00855
*                                                                       00856
*        RENAME SUBCOMMAND                                              00857
*                                                                       00858
*                                                                       00859
         SPACE 3                                                        00860
RENAME   ENTER COMMAND,PDL=PDLRENAM     ESTABLISH SUBCOMMAND            00861
         SPACE                                                          00862
         BAL   R14,OPENSTOW             OPEN STOW DCB                   00863
         BZ    RENEXIT                  EXIT IF DATA SET NOT OPENED     00864
         SPACE 1                                                        00865
         STOW  STOWDCB,MEMBERS,C        ISSUE STOW W/ CHANGE OPTION     00866
         SPACE                                                          00867
         B     *+4(R15)                 PROCESS RETURN CODE             00868
         B     RENAME1                   0- SUCESSFUL                   00869
         B     RENDUP                    4- MEMBER EXISTS WITH NEW NAME 00870
         B     RENAMENO                  8- CURRENT NAME DOES NOT EXIST 00871
         B     RENAMEUN                 12- INVALID RETURN FROM RENAME  00872
         B     RENAMERR                 16- IO ERROR IN DIRECTORY       00873
         EJECT                                                          00874
RENAME1  DS    0H                                                       00875
         MESSAGE MSGRENAM               SEND MESSAGE - MEMBER RENAMED   00876
         B     RENEXIT                                                  00877
         SPACE 3                                                        00878
RENAMENO DS    0H                                                       00879
         MESSAGE MSGNONE                ERROR - MEMBER DOES NOT EXIST   00880
         B     RENEXIT                                                  00881
         SPACE 2                                                        00882
RENDUP   DS    0H                                                       00883
         MESSAGE MSGEXIST               ERROR - DUPLICATE MEMBER        00884
         B     RENEXIT                                                  00885
         SPACE 2                                                        00886
RENAMEUN DS    0H                                                       00887
         MESSAGE MSGSTOWC               ERROR RETURN FROM RENAME        00888
         B     RENEXIT                                                  00889
         SPACE 2                                                        00890
RENAMERR DS    0H                                                       00891
         MESSAGE MSGIOERR               I/O ERROR IN DIRECTORY          00892
         SPACE 3                                                        00893
RENEXIT  DS    0H                                                       00894
         EXIT  COMMAND                                                  00895
         EJECT                                                          00896
*                                                                       00897
*                                                                       00898
*        ALIAS SUBCOMMAND                                               00899
*                                                                       00900
*                                                                       00901
         SPACE                                                          00902
ALIAS    ENTER COMMAND,PDL=PDLALIAS     ESTABLISH SUBCOMMAND            00903
         SPACE 2                                                        00904
         MVC   DIRNAME,MEMBER1          ORIGINAL MEMBER NAME            00905
         SPACE                                                          00906
         BLDL  INDCB,BLDLLIST           LOCATE DIRECTORY ENTRY          00907
         MVC   DIRFLAG(DIREND-DIRFLAG),DIRFLAG+2 BLDL ADDS THINGS       00908
         SPACE                                                          00909
         B     *+4(R15)                 PROCESS RETURN CODE             00910
         B     ALIAS1                   00-SUCCESSFUL                   00911
         B     ALIASNON                 04-MEMBER NOT FOUND             00912
         B     ALIASDIR                 08-I/O ERROR                    00913
         SPACE 3                                                        00914
ALIAS1   DS    0H                                                       00915
         TM    DIRFLAG,X'80'            IS EXISTING MODULE AN ALIAS?    00916
         BZ    ALIAS2                   NO                              00917
         SPACE                                                          00918
         MESSAGE MSGNREAL               YES, ERROR                      00919
         B     ALIASEND                                                 00920
         EJECT                                                          00921
ALIAS2   DS    0H                                                       00922
         MVC   DIRNAME,MEMBER2          SET ALIAS NAME                  00923
         OI    DIRFLAG,X'80'            SET ALIAS FLAG                  00924
         SPACE                                                          00925
         TM    FLAGS,FLOADMOD           IS THIS A LOAD MODULE?          00926
         BZ    ALIAS4                   NO                              00927
         SPACE                                                          00928
         TM    DIRATTR,ATTRSCAT         SCATTER LOADED?                 00929
         BZ    ALIAS2A                  NO, OK                          00930
         MESSAGE MSGASCAT               COMPLAIN                        00931
         B     ALIASEND                 EXIT SUB COMMAND                00932
         SPACE                                                          00933
MSGASCAT MSG   ' ALIAS NOT SUPPORTED FOR SCATTER LOAD MODULES'          00934
         SPACE                                                          00935
ALIAS2A  DS    0H                                                       00936
         XC    DIRAPF2,DIRAPF2          ZERO ALIAS APF DATA             00937
         TM    DIRATTR2,X'88'           VS LKED & APF DATA PRES?        00938
         BZ    ALIAS2Z                  NO, SKIP THE FOLLOWING          00939
         SPACE                                                          00940
         LA    R2,DIRAPF                POINT TO APF INFO               00941
         TM    DIRATTR2,X'10'           SSI PRESENT?                    00942
         BZ    ALIAS2B                                                  00943
         SPACE                                                          00944
         LA    R2,1(,R2)                ROUND TO 1/2 WD                 00945
         N     R2,=F'-2'                FFFFFFFE MASK                   00946
         LA    R2,4(,R2)                POINT TO APF DATA               00947
         MESSAGE MSGSSIDR               TELL SSI DROPPED                00948
         SPACE                                                          00949
ALIAS2B  NI    DIRATTR2,255-X'10'       TURN OFF SSI INDICATOR          00950
         CLI   0(R2),1                  IS SSI LENGTH GOOD              00951
         BE    ALIAS2D                                                  00952
         SPACE                                                          00953
ALIAS2C  MESSAGE MSGAABAD                                               00954
         B     ALIASEND                                                 00955
         SPACE                                                          00956
MSGAABAD MSG   ' BAD APF INFORMATION FORMAT - REQUEST NOT PERFORMED'    00957
MSGSSIDR MSG   ' SSI INFORMATION PRESENT - LEFT ONLY IN PRIMARY NAME '  00958
         SPACE                                                          00959
ALIAS2D  MVC   DIRAPF2+1(1),1(R2)       MOVE IN DATA                    00960
         MVI   DIRAPF2,1                AND SET PROPER LENGTH           00961
         SPACE                                                          00962
ALIAS2Z  DS    0H                                                       00963
         MVC   DIRREAL,MEMBER1          REAL MODULE NAME                00964
         MVC   DIREP,DIRENTRY           REAL MODULE ENTRY ADDRESS       00965
         NI    DIRFLAG,X'E0'            SET DIRECTORY ENTRY LENGTH      00966
         OI    DIRFLAG,(DIREND2-DIRUSER+1)/2                            00967
         SPACE                                                          00968
ALIAS3   DS    0H                                                       00969
         BAL   R14,READCESD             LOCATE POSSIBLE EXTERNAL NAME   00970
         B     ALIAS4                   NOT FOUND, MUST BE PSUEDO ENTRY 00971
         SPACE                                                          00972
         LTR   R1,R1                    ENTRY ADDRESS ZERO?             00973
         BZ    ALIAS3A                  ES                              00974
         NI    DIRATTR+1,255-ATTREP0    NO, INSURE ATTR FLAG OFF        00975
ALIAS3A  DS    0H                                                       00976
         ST    R1,0(,R13)               MOVE ENTRY ADDRESS FOR          00977
         MVC   DIRENTRY,1(R13)          ALIAS TO DIRECTORY ENTRY        00978
         SPACE 2                                                        00979
ALIAS4   DS    0H                                                       00980
         SPACE                                                          00981
         BAL   R14,OPENSTOW             OPEN OUTPUT DCB                 00982
         BZ    ALIASEND                 EXIT IF DCB NOT OPENED          00983
         SPACE                                                          00984
         STOW  STOWDCB,DIRNAME,A        ISSUE STOW TO ADD ALIAS ENTRY   00985
         SPACE                                                          00986
         B     *+4(R15)                 PROCESS RETURN CODE             00987
         SPACE 2                                                        00988
         B     ALIAS5                   00-SUCCESSFUL                   00989
         B     ALIASDUP                 04-MEMBER ALREADY EXISTS        00990
         B     ALIASERR                 08-INVALID RETURN FROM STOW     00991
         B     ALIASFUL                 12-DIRECTORY IS FULL            00992
         B     ALIASDIR                 16-I/O ERROR IN DIRECTORY       00993
         SPACE                                                          00994
         LTORG                                                          00995
         SPACE 2                                                        00996
ALIAS5   DS    0H                                                       00997
         MESSAGE MSGALIAS               INDICATE ALIAS ASSIGNED         00998
         SPACE                                                          00999
         TM    FLAGS,FLOADMOD           MUST WE GIVE ENTRY POINT?       01000
         BZ    ALIASEND                 NO                              01001
         SPACE                                                          01002
         MVC   MSGTEXT1,MSGENTRY        BUILD MESSAGE FOR ENTRY POINT   01003
         LH    R15,MSGTEXT1             LENGTH OF MSG                   01004
         LA    R14,MSGTEXT1(R15)                                        01005
         LA    R15,6(,R15)                                              01006
         STH   R15,MSGTEXT1                                             01007
         SPACE                                                          01008
         MVC   DOUBLE(3),DIRENTRY                                       01009
         MVI   DOUBLE+3,X'04'                                           01010
         UNPK  0(7,R14),DOUBLE(4)                                       01011
         TR    0(6,R14),TRTABLE                                         01012
         SPACE                                                          01013
         MESSAGE MSGTEXT1               INDICATE ENTRY POINT FOR ALIAS  01014
         B     ALIASEND                                                 01015
         SPACE 3                                                        01016
ALIASFUL DS    0H                                                       01017
         MESSAGE MSGFULL                INDICATE DIRECTORY FULL         01018
         B     ALIASEND                                                 01019
         SPACE 2                                                        01020
ALIASDUP DS    0H                                                       01021
         MESSAGE MSGEXIST               INDICATE MEMBER EXISTS          01022
         B     ALIASEND                                                 01023
         SPACE 2                                                        01024
ALIASDIR DS    0H                                                       01025
         MESSAGE MSGIOERR               I/O ERROR IN DIRECTORY          01026
         B     ALIASEND                                                 01027
         SPACE 2                                                        01028
ALIASNON DS    0H                                                       01029
         MESSAGE MSGNONE                MEMBER DOES NOT EXIST           01030
         B     ALIASEND                                                 01031
         SPACE 2                                                        01032
ALIASERR DS    0H                                                       01033
         MESSAGE MSGSTOW8               UNUSUAL RETURN CODE FROM STOW   01034
         SPACE 2                                                        01035
ALIASEND DS    0H                                                       01036
         EXIT  COMMAND                                                  01037
         EJECT                                                          01038
*                                                                       01039
*                                                                       01040
*        SCRATCH SUBCOMMAND                                             01041
*                                                                       01042
*                                                                       01043
         SPACE 2                                                        01044
SCRATCH  ENTER COMMAND,PDL=PDLDELET     ESTABLISH SUBCOMMAND            01045
         SPACE                                                          01046
         BAL   R14,OPENSTOW             OPEN STOW DCB                   01047
         BZ    SCRATCHE                 EXIT IF DCB OPEN FAILED         01048
         SPACE                                                          01049
         STOW  STOWDCB,MEMBER1,D        ISSUE STOW W/ DELETE OPTION     01050
         SPACE 2                                                        01051
         B     *+4(R15)                 PROCESS RETURN CODE             01052
         SPACE 2                                                        01053
         B     SCRATCH1                 00-SUCESSFUL                    01054
         B     SCRERROR                 04-SHOULD NOT OCCUR             01055
         B     SCRNONE                  08-MEMBER DOES NOT EXIST        01056
         B     SCRBAD                   12-SHOULD NOT OCCUR             01057
         B     SCRDIRER                 16-I/O ERROR IN DIRECTORY       01058
         EJECT                                                          01059
SCRATCH1 DS    0H                                                       01060
         MESSAGE MSGGONE                INDICATE MEMBER SCRATCHED       01061
         B     SCRATCHE                                                 01062
         SPACE 2                                                        01063
SCRDIRER DS    0H                                                       01064
         MESSAGE MSGIOERR               I/O ERROR IN DIRECTORY          01065
         B     SCRATCHE                                                 01066
         SPACE 2                                                        01067
SCRNONE  DS    0H                                                       01068
         MESSAGE MSGNONE                MEMBER DOES NOT EXIST           01069
         B     SCRATCHE                                                 01070
         SPACE 2                                                        01071
SCRERROR DS    0H                                                       01072
         MESSAGE MSGSTOW4               ERROR RETURN FROM STOW          01073
         B       SCRATCHE                                               01074
SCRBAD   DS    0H                                                       01075
         MESSAGE MSGSTOWC               ERROR RETURN FROM STOW          01076
         SPACE 3                                                        01077
SCRATCHE EXIT  COMMAND                                                  01078
         EJECT                                                          01079
*                                                                       01080
*                                                                       01081
*        DISPLAY SUBCOMMAND                                             01082
*                                                                       01083
*                                                                       01084
         SPACE 2                                                        01085
DISPLAY  ENTER COMMAND,PDL=PDLDSPLY     ESTABLISH SUBCOMMAND            01086
         TM    FLAGS,FMEMBER1+FMEMBER2  DISPLAY RANGE SPECIFIED?        01087
         BNO   DISPLAY0                 NO                              01088
         LH    R14,LMEMBER1             LENGTH OF STARTING NAME         01089
         LH    R15,LMEMBER2             LENGTH OF ENDING NAME           01090
         CR    R14,R15                  DETERMINE MINIMUM NAME LENGTH   01091
         BNH   DSPCHECK                                                 01092
         LR    R14,R15                                                  01093
DSPCHECK DS    0H                                                       01094
         SPACE                                                          01095
         CLC   MEMBER1(0),MEMBER2                                       01096
         EX    R14,*-6                  INSURE RANGE IS VALID           01097
         BNH   DISPLAY0                 YES, FIRST NAME NOT HIGHER      01098
         SPACE                                                          01099
         MESSAGE MSGRANGE               INDICATE INVALID RANGE          01100
         B     DISPLAYE                                                 01101
         SPACE 2                                                        01102
DISPLAY0 DS    0H                                                       01103
         OI    FLAGS+1,F1STREAD+FATTN                                   01104
         NI    FLAGS+1,255-FEXIST-FLINESET-FRANGE                       01105
         EJECT                                                          01106
DISPLAY1 DS    0H                                                       01107
         BALR  R3,0                     RETURN ADDRESS                  01108
         LH    R4,LINESIZE              GET TERMINAL LINE SIZE          01109
         LA    R0,11                                                    01110
         SR    R4,R0                                                    01111
         LA    R4,MSGTEXT1+3(R4)        END OF LINE ADDRESS             01112
         LA    R5,MSGTEXT1+4            START OF LINE                   01113
         SPACE                                                          01114
         CLEAR MSGTEXT1                                                 01115
         SPACE 2                                                        01116
DISPLAY2 DS    0H                                                       01117
         BAL   R14,READDIR              GET NEXT DIRECTORY ENTRY        01118
         B     DISPLAY6                 LAST DIRECTORY BLOCK PROCESSED  01119
         B     DISPLAY6                 LAST MEMBER IN DIRECTORY        01120
         SPACE 2                                                        01121
         OI    FLAGS+1,FEXIST           MEMBER EXISTS FLAG              01122
         TM    FLAGS,FMEMBER1           START ENTRY SPECIFIED?          01123
         BZ    DISPLAY3                 NO                              01124
         SPACE                                                          01125
         LH    R15,LMEMBER1             LENGTH-1 OF MEMBER NAME         01126
         CLC   MEMBER1(0),MEMNAME                                       01127
         EX    R15,*-6                                                  01128
         BH    DISPLAY2                 NOT WANTED, GET NEXT            01129
         XI    FLAGS,FMEMBER1                                           01130
         SPACE 2                                                        01131
DISPLAY3 DS    0H                                                       01132
         TM    FLAGS,FMEMBER2           LAST ENTRY SPECIFIED?           01133
         BZ    DISPLAY4                 NO                              01134
         SPACE                                                          01135
         LH    R15,LMEMBER2                                             01136
         CLC   MEMBER2(0),MEMNAME       THIS PAST END?                  01137
         EX    R15,*-6                                                  01138
         BL    DISPLAY6                 YES, END OF DISPLAY             01139
         SPACE                                                          01140
DISPLAY4 DS    0H                                                       01141
         TRT   DIRNAME(8),TRTMN         CHECK FOR UNPRINTABLE           01142
         BZ    DISPLAY8                 SKIP IF ALL PRINTABLE           01143
         TM    FLAGS+1,FLINESET         LINE IN PROGRESS?               01144
         BZ    DISPLAY9                 NO, SKIP THE PUTLINE            01145
         LA    R1,MSGTEXT1              COMPUTE LENGTH                  01146
         SR    R5,R1                                                    01147
         SLL   R5,16                    PUT IN UPPER HALF WD            01148
         ST    R5,MSGTEXT1                                              01149
        $PUTLINE MSGTEXT1,ATTN=DISPLAYE                                 01150
         NI    FLAGS+1,255-FLINESET                                     01151
         CLEAR MSGTEXT1                                                 01152
         LA    R5,MSGTEXT1+4            START OF LINE                   01153
         SPACE 2                                                        01154
DISPLAY9 DS    0H                       PRINT IN HEX ROUTINE            01155
         UNPK  0(9,R5),DIRNAME(5)       DO 1ST HALF OF NAME             01156
         UNPK  8(9,R5),DIRNAME+4(5)     DO 2ND HALF OF NAME             01157
         TR    0(16,R5),TRTABLE         FINISH XLATION                  01158
         MVI   16(R5),C' '              CLEAN OUT GARBAGE               01159
         TM    DIRFLAG,X'80'            ALIAS?                          01160
         BZ    *+10                     NO, SKIP THE '-A' SET           01161
         MVC   16(L'IDALIAS,R5),IDALIAS SET ALIAS                       01162
         MVI   19(R5),C'*'              CHAR FORM OF MEMBER NAME        01163
         MVC   20(8,R5),DIRNAME                                         01164
         MVI   28(R5),C'*'                                              01165
         OI    FLAGS+1,FLINESET+FRANGE                                  01166
         LA    R5,31(,R5)               SET LENGTH                      01167
         B     DISPLAY5                 DISPLAY LINE                    01168
         SPACE 2                                                        01169
DISPLAY8 DS    0H                                                       01170
         MVC   0(8,R5),DIRNAME                                          01171
         TM    DIRFLAG,X'80'            ALIAS?                          01172
         BZ    *+10                     NO                              01173
         MVC   8(L'IDALIAS,R5),IDALIAS                                  01174
         LA    R5,10+L'IDALIAS(R5)                                      01175
         SPACE 2                                                        01176
DISPLAY7 DS    0H                                                       01177
         OI    FLAGS+1,FLINESET+FRANGE                                  01178
         CR    R5,R4                    LINE FULL?                      01179
         BL    DISPLAY2                 NO, CONTINUE                    01180
         SPACE 2                                                        01181
DISPLAY5 DS    0H                                                       01182
         LA    R1,MSGTEXT1                                              01183
         SR    R5,R1                                                    01184
         SLL   R5,16                                                    01185
         ST    R5,MSGTEXT1                                              01186
        $PUTLINE MSGTEXT1,ATTN=DISPLAYE                                 01187
         SPACE                                                          01188
         NI    FLAGS+1,255-FLINESET                                     01189
         BR    R3                       RETURN                          01190
         SPACE 3                                                        01191
DISPLAY6 DS    0H                                                       01192
         LA    R3,DISPLAYE              EXIT ADDRESS                    01193
         TM    FLAGS+1,FLINESET         BUFFER IN PROGRESS?             01194
         BO    DISPLAY5                 YES, OUTPUT IT                  01195
         SPACE 2                                                        01196
         TM    FLAGS+1,FRANGE           MEMBER IN RANGE?                01197
         BO    DISPLAYE                 YES                             01198
         TM    FLAGS+1,FEXIST           NO, BUT ANY IN DIRECTORY?       01199
         LA    R1,MSGEMPTY                                              01200
         BZ    *+8                      NO                              01201
         LA    R1,MSGNODSP              YES, THEN NONE IN RANGE         01202
         SPACE                                                          01203
         MESSAGE (R1)                                                   01204
         SPACE 2                                                        01205
DISPLAYE DS    0H                                                       01206
         EXIT  COMMAND                                                  01207
         EJECT                                                          01208
*                                                                       01209
*                                                                       01210
*        ATTRIBUTE SUBCOMMAND                                           01211
*                                                                       01212
*                                                                       01213
         SPACE 2                                                        01214
ATTR     ENTER COMMAND,PDL=PDLATTR      ESTABLISH SUBCOMMAND            01215
         MVC   DIRNAME,MEMBER1          MEMBER NAME FOR BLDL            01216
         CLEAR MSGTEXT1                                                 01217
         MVC   MSGTEXT1+5(23),=C'ATTRIBUTES FOR MEMBER -'               01218
         MVC   MSGTEXT1+29(8),MEMBER1                                   01219
         LA    R1,37                    MESSAGE LENGTH                  01220
         SLL   R1,16                                                    01221
         ST    R1,MSGTEXT1                                              01222
         MESSAGE MSGTEXT1                                               01223
         SPACE                                                          01224
         BLDL  INDCB,BLDLLIST           GET DIRECTORY ENTRY             01225
         MVC   DIRFLAG(DIREND-DIRFLAG),DIRFLAG+2 BLDL ADDS THINGS       01226
         SPACE                                                          01227
         B     *+4(R15)                 PROCESS RETURN CODE             01228
         SPACE 2                                                        01229
         B     ATTR1                    00-SUCESSFUL                    01230
         B     ATTRNONE                 04-MEMBER NOT FOUND             01231
         B     ATTRIO                   08-I/O ERROR                    01232
         SPACE 3                                                        01233
ATTR1    DS    0H                                                       01234
         LA    R2,DIRUSER               LOAD START OF USER AREA (4 SSI) 01235
         TM    FLAGS,FLOADMOD           LOAD MODULE LIBRARY?            01236
         BZ    ATCK4SSI                 NO                              01237
         SPACE                                                          01238
         TM    FLAGS+2,FAPFON+FAPFOFF   CHANGE APF PROCESSING?          01239
         BZ    ATTR1B                   NO, SKIP                        01240
         SPACE                                                          01241
         TM    DIRATTR2,X'88'           CAN CHANGE APF INFO?            01242
         BNO   A1NOGO                                                   01243
         SPACE                                                          01244
         LA    R2,DIRAPF                FIND APF DATA                   01245
         TM    DIRATTR,X'04'            SCATTER?                        01246
         BNO   *+8                                                      01247
         LA    R2,8(,R2)                SCATTER SIZE                    01248
         SPACE                                                          01249
         TM    DIRFLAG,X'80'            ALIAS                           01250
         BNO   *+8                      ALIAS SIZE                      01251
         LA    R2,11(,R2)               ADD ALIAS LENGTH                01252
         SPACE                                                          01253
         TM    DIRATTR2,X'10'           SSI?                            01254
         BNO   *+12                                                     01255
         LA    R2,5(,R2)                ADD 4 AND ROUND TO 1/2 WD       01256
         N     R2,APFROUND                                              01257
         SPACE                                                          01258
         CLI   0(R2),1                  LENGTH RIGHT?                   01259
         BNE   A1NOGO                                                   01260
         SPACE                                                          01261
         TM    FLAGS+2,FAPFON           TURN ON?                        01262
         MVI   1(R2),0                                                  01263
         BNO   *+8                                                      01264
         MVI   1(R2),1                                                  01265
         B     ATTR1D                   CONTINUE                        01266
         SPACE                                                          01267
A1NOGO   MESSAGE MSGADNC                                                01268
         B     ATTR3                    CONTINUE W/DISPLAY              01269
         SPACE 1                                                        01270
ATTR1B   TM    FLAGS,FATTR              CHANGE LOAD MODULE ATTRIBUTES?  01271
         BZ    ATTR3                    NO                              01272
         SPACE                                                          01273
ATTR1D   XC    ATTRNO,FF                                                01274
         OC    DIRATTR,ATTRYES                                          01275
         NC    DIRATTR,ATTRNO                                           01276
         SPACE 5                                                        01277
*                                                                       01278
*        THE FOLLOWING CODE TAKES CARE OF THE RESTRICTION               01279
*        IN CONTENTS SUPERVISION THAT REQUIRES THE 'REUS'               01280
*        OPTION IN ADDITION TO THE 'RENT' OPTION IF A LOAD              01281
*        MODULE IS TO BE ACCEPTED AS REENTERANT.                        01282
*                                                                       01283
         SPACE 2                                                        01284
         TM    DIRATTR,ATTRRENT         WAS RE-ENTERANT SPECIFIED?      01285
         BZ    *+8                      NO                              01286
         OI    DIRATTR,ATTRREUS         YES, ALSO FORCE REUSABLE        01287
         SPACE 2                                                        01288
         BAL   R14,OPENSTOW             OPEN STOW DCB                   01289
         BZ    ATTREXIT                 IF DCB DID NOT OPEN             01290
         SPACE                                                          01291
         MVC   DCBRELAD-IHADCB+STOWDCB,DIRTTR                           01292
         MVI   DCBRELAD-IHADCB+STOWDCB+3,0                              01293
         STOW  STOWDCB,DIRNAME,R                                        01294
         SPACE 2                                                        01295
         B     *+4(R15)                 PROCESS RETURN CODE             01296
         SPACE                                                          01297
         B     ATTR3                    00-SUCESSFUL                    01298
         B     ATTRERR                  04-SHOULD NOT OCCUR             01299
         B     ATTRERR                  08-SHOULD NOT OCCUR             01300
         B     ATTRFULL                 12-DIRECTORY FULL               01301
         B     ATTRIO                   16-I/O ERROR                    01302
         SPACE 5                                                        01303
ATTR3    DS    0H                                                       01304
         MESSAGE MSGATTRS               ATTRIBUTES TITLE LINE           01305
         SPACE 2                                                        01306
         CLEAR MSGTEXT1                                                 01307
         SPACE 2                                                        01308
         LA    R1,MSGTEXT1+3                                            01309
         SR    R0,R0                    NO ATTRIBUTES FLAG              01310
         SPACE                                                          01311
         LA    R14,TBLATTR-12           ATTRIBUTES TABLE                01312
         LH    R2,DIRATTR               GET MODULE ATTRIBUTES           01313
         SPACE 2                                                        01314
NEXTATTR DS    0H                                                       01315
         LA    R14,12(R14)                                              01316
         CLI   0(R14),X'FF'             END OF TABLE?                   01317
         BE    LASTATTR                 YES                             01318
         SPACE                                                          01319
         LH    R15,0(R14)               GET ATTRIBUTE FLAGS             01320
         SPACE                                                          01321
         TM    2(R14),X'80'             POSITIVE OR NEGATIVE ATTRIBUTE? 01322
         LA    R3,X'80'                 MASK FOR POS (FOR BZ INST)      01323
         BZ    *+8                                                      01324
         LA    R3,X'70'                 MASK FOR NEG (FOR BNZ) INST     01325
         SPACE                                                          01326
         NR    R15,R2                   CHECK FOR ATTRIBUTE PRESENT     01327
         BC    0,NEXTATTR                                               01328
         EX    R3,*-4                                                   01329
         SPACE                                                          01330
         BALR  R0,0                     INDICATE ATTRIBUTE EXISTS       01331
         LA    R3,X'7F'                                                 01332
         MVI   0(R1),C','               DELIMITER AFTER LAST ATTR       01333
         IC    R15,2(R14)               LENGTH-1 OF ATTRIBUTE           01334
         NR    R15,R3                                                   01335
         MVC   2(0,R1),3(R14)                                           01336
         EX    R15,*-6                                                  01337
         LA    R1,3(R15,R1)             JUMP POINTER                    01338
         B     NEXTATTR                                                 01339
         SPACE 3                                                        01340
LASTATTR DS    0H                                                       01341
         LTR   R0,R0                    ANY ATTRIBUTES PRESENT?         01342
         LA    R1,NONEMSG                                               01343
         BZ    NOATTRS                  NO                              01344
         SPACE                                                          01345
         LA    R1,L'MSGTEXT1                                            01346
         SLL   R1,16                                                    01347
         ST    R1,MSGTEXT1                                              01348
         LA    R1,MSGTEXT1                                              01349
         SPACE                                                          01350
NOATTRS  DS    0H                                                       01351
         MESSAGE (R1)                                                   01352
         SPACE 2                                                        01353
         CLEAR MSGTEXT1                                                 01354
         LA    R1,L'MSGTEXT1                                            01355
         SLL   R1,16                                                    01356
         ST    R1,MSGTEXT1                                              01357
         SPACE 1                                                        01358
* FORMAT NEW VS INFORMATION                                             01359
         SPACE 1                                                        01360
         LA    R2,DIRAPF                POINT TO APF INFO,              01361
*                                       WILL ADJUST IF NECESSARY        01362
         TM    DIRATTR,X'04'            IS SCATTER FMT?                 01363
         BNO   *+8                      NO, SKIP ADD                    01364
         LA    R2,8(,R2)                ADD SCATTER SIZE                01365
         SPACE                                                          01366
         TM    DIRFLAG,X'80'            ALIAS?                          01367
         BNO   *+8                                                      01368
         LA    R2,11(,R2)               ADD ALIAS LENGTH                01369
         SPACE                                                          01370
         TM    DIRATTR2,X'80'           AOS LKED?                       01371
         BO    ATCKSSI                  YES, CONTINUE                   01372
         MESSAGE MSGNOVSL                                               01373
         TM    DIRFLAG,X'80'            ALIAS?                          01374
         BZ    ATGOTSSI                                                 01375
         B     ATNOSSI                                                  01376
         SPACE                                                          01377
ATCKSSI  TM    DIRATTR2,X'10'           SSI PRESENT?                    01378
         BNO   ATNOSSI                  SKIP SSI PROC                   01379
         SPACE                                                          01380
ATGOTSSI LA    R2,1(,R2)                ROUND UP TO 1/2 WD              01381
         N     R2,APFROUND                                              01382
         SPACE                                                          01383
* R2 NOW POINTS TO SSI, FMT MSG AND CONTINUE                            01384
         SPACE                                                          01385
ATCK4SSI SR    R0,R0                    CK FOR ZERO                     01386
         C     R0,0(,R2)                                                01387
         BE    ATNOSSI                                                  01388
         BCTR  R0,0                     CK FOR -1                       01389
         C     R0,0(,R2)                                                01390
         BE    ATNOSSI                                                  01391
         SPACE                                                          01392
         MVC   MSGTEXT1+5(16),=C'SSI INFORMATION:'                      01393
         UNPK  MSGTEXT1+22(9),0(5,R2)   CVT TO HEX                      01394
         TR    MSGTEXT1+22(8),TRTABLE                                   01395
         MVI   MSGTEXT1+30,C' '         CLEAR GARBAGE                   01396
         SPACE                                                          01397
         LA    R1,MSGTEXT1                                              01398
         MESSAGE (R1)                                                   01399
         CLEAR MSGTEXT1                                                 01400
         LA    R1,L'MSGTEXT1                                            01401
         SLL   R1,16                                                    01402
         ST    R1,MSGTEXT1                                              01403
         SPACE                                                          01404
         TM    FLAGS,FLOADMOD           IS LOAD MODULE LIB?             01405
         BZ    ATTR2                    NO, SKIP THE FOLLOWING          01406
         LA    R2,4(,R2)                ADD SSI SIZE                    01407
         SPACE                                                          01408
ATNOSSI  TM    DIRATTR2,X'80'           AOS LKED?                       01409
         BZ    ATTR2                    NO, CAN'T BE AUTH               01410
         TM    DIRATTR2,X'08'           APFPRES?                        01411
         BO    ATAPF                                                    01412
         MESSAGE MSGNOAPF                                               01413
         B     ATTR2                                                    01414
         SPACE                                                          01415
ATAPF    CLI   0(R2),1                  CHECK APF DATA LEN              01416
         BE    ATAPFLOK                 IF LEN OK                       01417
         MESSAGE MSGAPFLB                                               01418
         B     ATTR2                                                    01419
         SPACE                                                          01420
ATAPFLOK CLI   1(R2),1                  CHECK APF DATA                  01421
         BE    ATAPFOK                  IS AUTH                         01422
         BH    ATAPF2B                  VALUE TOO BIG                   01423
         MESSAGE MSGNAUTH                                               01424
         B     ATTR2                                                    01425
         SPACE                                                          01426
ATAPFOK  MESSAGE MSGYAUTH                                               01427
         B     ATTR2                                                    01428
ATAPF2B  MESSAGE MSGAPF2B                                               01429
         SPACE 2                                                        01430
ATTR2    DS    0H                                                       01431
         OI    FLAGS+1,FATTN                                            01432
         NI    FLAGS+2,255-FREALMOD                                     01433
         NI    FLAGS+1,255-FLINESET                                     01434
         TM    DIRFLAG,X'80'            TRUE MODULE OR ALIAS?           01435
         BO    ATTR4                    ALIAS                           01436
         OI    FLAGS+2,FREALMOD         TRUE NAME                       01437
         SPACE                                                          01438
ATTR4    DS    0H                                                       01439
         MVC   SAVETTR,DIRTTR           TTR OF REAL MODULE              01440
         MVC   MSGTEXT1,MSGNOMOD                                        01441
         OI    FLAGS+1,F1STREAD                                         01442
         SPACE 2                                                        01443
ATTR5    DS    0H                                                       01444
         BAL   R14,READDIR              GET NEXT DIRECTORY MEMBER       01445
         B     ATTRLAST                 END OF DIRECTORY                01446
         B     ATTRLAST                 LAST MEMBER PROCESSED           01447
         SPACE 2                                                        01448
         CLC   SAVETTR,DIRTTR           WANTED MODULE?                  01449
         BNE   ATTR5                    NO                              01450
         SPACE                                                          01451
         TM    FLAGS+2,FREALMOD         LOOK FOR ALL ALIASES?           01452
         BZ    ATTR6                    NO                              01453
         TM    DIRFLAG,X'80'            YES, THIS ONE OF THEM?          01454
         BZ    ATTR5                    NO                              01455
         SPACE 2                                                        01456
         TM    FLAGS+1,FLINESET         LINE IN PROGRESS?               01457
         BO    ATTR5A                   YES                             01458
         MESSAGE MSGOTHER                                               01459
         SPACE 2                                                        01460
         CLEAR MSGTEXT1                                                 01461
         LA    R5,MSGTEXT1+3                                            01462
         OI    FLAGS+1,FLINESET                                         01463
         SPACE 2                                                        01464
ATTR5A   DS    0H                                                       01465
         LA    R2,DIRNAME+7                                             01466
ATTR5B   DS    0H                                                       01467
         CLI   0(R2),C' '                                               01468
         BNE   ATTR5C                                                   01469
         BCT   R2,ATTR5B                                                01470
ATTR5C   DS    0H                                                       01471
         LA    R0,DIRNAME                                               01472
         SR    R2,R0                                                    01473
         BNM   ATTR5D                                                   01474
         SR    R2,R2                                                    01475
ATTR5D   DS    0H                                                       01476
         LA    R15,0(R5,R2)                                             01477
         LA    R1,MSGTEXT1                                              01478
         SR    R15,R0                                                   01479
         CH    R15,LINESIZE             CURRENT LINE FULL?              01480
         BNH   ATTR5E                   NO                              01481
         SLL   R15,16                                                   01482
         ST    R15,MSGTEXT1                                             01483
         MESSAGE (R1)                                                   01484
         SPACE 2                                                        01485
         CLEAR MSGTEXT1                                                 01486
         LA    R5,MSGTEXT1+3                                            01487
         SPACE 2                                                        01488
ATTR5E   DS    0H                                                       01489
         MVI   0(R5),C','                                               01490
         MVC   2(,R5),DIRNAME                                           01491
         EX    R2,*-6                                                   01492
         LA    R5,3(R2,R5)                                              01493
         B     ATTR5                                                    01494
         EJECT                                                          01495
ATTR6    DS    0H                                                       01496
         TM    DIRFLAG,X'80'            THIS THE ALIAS ENTRY?           01497
         BO    ATTR5                    YES, CONTINUE ON                01498
         MVC   MSGTEXT1,MSGREAL                                         01499
         LH    R1,MSGTEXT1                                              01500
         LA    R0,8(R1)                                                 01501
         STH   R0,MSGTEXT1                                              01502
         LA    R1,MSGTEXT1(R1)                                          01503
         MVC   0(8,R1),DIRNAME                                          01504
         SPACE                                                          01505
         LA    R1,MSGTEXT1                                              01506
ATTR7    DS    0H                                                       01507
         MESSAGE (R1)                                                   01508
         B     ATTREXIT                                                 01509
         SPACE 3                                                        01510
ATTRLAST DS    0H                                                       01511
         TM    FLAGS+2,FREALMOD ALIAS OR TRUE MODULE?                   01512
         LA    R1,NONEMSG               ERROR MSG - TRUE NAME NOT FOUND 01513
         BZ    ATTR7                                                    01514
         SPACE                                                          01515
         TM    FLAGS+1,FLINESET         LINE IN PROGRESS?               01516
         BZ    ATTREXIT                 NO, EXIT                        01517
         LA    R1,MSGTEXT1                                              01518
         SR    R5,R1                                                    01519
         SLL   R5,16                                                    01520
         ST    R5,MSGTEXT1                                              01521
         B     ATTR7                                                    01522
         EJECT                                                          01523
ATTRNONE DS    0H                                                       01524
         MESSAGE MSGNONE                                                01525
         B     ATTREXIT                                                 01526
         SPACE 2                                                        01527
ATTRIO   DS    0H                                                       01528
         MESSAGE MSGIOERR                                               01529
         B     ATTREXIT                                                 01530
         SPACE 2                                                        01531
ATTRFULL DS    0H                                                       01532
         MESSAGE MSGFULL                                                01533
         B     ATTREXIT                                                 01534
         SPACE 2                                                        01535
ATTRERR  DS    0H                                                       01536
         MESSAGE MSGSTOWC                                               01537
         B     ATTREXIT                                                 01538
         SPACE 2                                                        01539
APFROUND DC    F'-2'                    FFFFFFFE MASK                   01540
         PRINT NOGEN                                                    01541
MSGYAUTH MSG   ' APF AUTHORIZED'                                        01542
MSGNAUTH MSG   ' NOT APF AUTHORIZED'                                    01543
MSGNOVSL MSG   ' NOT APF AUTHORIZED, NON VS LKED'                       01544
MSGNOAPF MSG   ' NOT APF AUTHORIZED, APF DATA MISSING'                  01545
MSGAPFLB MSG   ' NOT APF AUTHORIZED, APF DATA WRONG LENGTH'             01546
MSGAPF2B MSG   ' APF AUTHORIZED, APF DATA VALUE  < 1'                   01547
MSGADNC  MSG   ' * APF DATA COULD NOT BE CHANGED *'                     01548
         SPACE                                                          01549
         PRINT GEN                                                      01550
         LTORG                                                          01551
         SPACE 2                                                        01552
ATTREXIT DS    0H                                                       01553
         EXIT  COMMAND                                                  01554
         EJECT                                                          01555
*                                                                       01556
*                                                                       01557
*        MAP SUBCOMMAND                                                 01558
*                                                                       01559
*                                                                       01560
         SPACE 2                                                        01561
MAP      ENTER COMMAND,PDL=PDLMAP       ESTABLISH SUBCOMMAND            01562
         TM    FLAGS,FLOADMOD           PROCESSING LOAD LIBRARY?        01563
         BO    MAP1                     YES                             01564
         SPACE                                                          01565
         LA    R1,MSGNLOAD              NOT LOAD LIBRARY                01566
         SPACE                                                          01567
MAP0     DS    0H                                                       01568
         MESSAGE (R1)                                                   01569
         B     MAPEND                                                   01570
         SPACE 2                                                        01571
MAP1     DS    0H                                                       01572
         OI    FLAGS+1,FATTN            ALLOW INTERRUPTIONS             01573
         MVC   DIRNAME,MEMBER1          MEMBER NAME TO BLDL LIST        01574
         BLDL  INDCB,BLDLLIST           LOCATE DIRECTORY ENTRY          01575
         MVC   DIRFLAG(DIREND-DIRFLAG),DIRFLAG+2 BLDL ADDS THINGS       01576
         SPACE                                                          01577
         B     *+4(R15)                 PROCESS RETURN CODE             01578
         SPACE                                                          01579
         B     MAP2                     00-SUCESSFUL                    01580
         B     MAPNONE                  04-MEMBER NOT FOUND             01581
         B     MAPIO                    08-I/O ERROR                    01582
         SPACE 2                                                        01583
MAP2     DS    0H                                                       01584
         OI    FLAGS+1,FALLESD          INDICATE LIST REQUEST           01585
         SPACE 2                                                        01586
         BAL   R14,READCESD             FORMAT THE CESD DATA            01587
         B     MAPNOESD                                                 01588
         SPACE 2                                                        01589
         LA    R4,ESDPTR                ESD TABLE CHAIN POINTER         01590
         SR    R5,R5                    CLEAR SEGTAB/ENTAB SWITCH       01591
         USING ESDENTRY,R4              BASE FOR TABLE                  01592
         SPACE 2                                                        01593
MAPESD   DS    0H                                                       01594
         L     R4,ESDLINK                                               01595
         LTR   R4,R4                    END OF CHAIN?                   01596
         BZ    MAPLAST                  YES                             01597
         CLEAR MSGTEXT1                                                 01598
         SPACE                                                          01599
         CLI   ESDTYPE,CODESD           THIS EXTERNAL DEFINITION?       01600
         BE    MAPSD                    YES                             01601
         SPACE                                                          01602
         CLI   ESDTYPE,CODELR           THIS EXTERNAL REFERENCE?        01603
         BE    MAPLR                    YES                             01604
         SPACE                                                          01605
         CLI   ESDTYPE,CODEPC           THIS PRIVATE CODE?              01606
         BE    MAPPC                    YES                             01607
         SPACE                                                          01608
*        MUST BE SEGTAB OR ENTAB ENTRY                                  01609
         SPACE                                                          01610
         LTR   R5,R5                    SEGTAB PROCESSED?               01611
         MVC   MSGTEXT1+4(8),$SEGTAB                                    01612
         BZ    MAPSEGTB                                                 01613
         MVC   MSGTEXT1+4(8),$ENTAB                                     01614
MAPSEGTB DS    0H                                                       01615
         BALR  R5,0                     SEGTAB PROCESSED CODE           01616
         B     MAPSD1                                                   01617
         SPACE 2                                                        01618
MAPPC    DS    0H                                                       01619
MAPSD    DS    0H                                                       01620
         MVC   MSGTEXT1+4(8),ESDNAME                                    01621
         SPACE                                                          01622
MAPSD1   DS    0H                                                       01623
         TM    DIRATTR,ATTROVLY         OVERLAY PROGRAM?                01624
         BZ    MAPNOVLY                 NO                              01625
         SPACE                                                          01626
         SR    R0,R0                                                    01627
         IC    R0,ESDSEG#                                               01628
         CVD   R0,DOUBLE                                                01629
         OI    DOUBLE+7,X'0F'                                           01630
         UNPK  MSGTEXT1+30(2),DOUBLE+6(2)                               01631
MAPNOVLY DS    0H                                                       01632
         SPACE 3                                                        01633
         MVC   DOUBLE(3),ESDADDR                                        01634
         MVI   DOUBLE+3,X'04'                                           01635
         UNPK  MSGTEXT1+14(7),DOUBLE(4)                                 01636
         TR    MSGTEXT1+14(6),TRTABLE                                   01637
         MVC   DOUBLE(3),ESDLEN                                         01638
         UNPK  MSGTEXT1+22(7),DOUBLE(4)                                 01639
         TR    MSGTEXT1+22(6),TRTABLE                                   01640
         LA    R1,32                                                    01641
         B     MAPPRINT                                                 01642
         SPACE 3                                                        01643
MAPLR    DS    0H                                                       01644
         MVC   MSGTEXT1+30(8),ESDNAME                                   01645
         MVC   DOUBLE(3),ESDADDR                                        01646
         MVI   DOUBLE+3,X'04'                                           01647
         UNPK  MSGTEXT1+40(7),DOUBLE(4)                                 01648
         TR    MSGTEXT1+40(6),TRTABLE                                   01649
         LA    R1,46                                                    01650
         SPACE                                                          01651
MAPPRINT DS    0H                                                       01652
         SLL   R1,16                                                    01653
         ST    R1,MSGTEXT1                                              01654
         SPACE                                                          01655
MSGPRINT DS    0H                                                       01656
        $PUTLINE MSGTEXT1,ATTN=MAPEND                                   01657
         SPACE 3                                                        01658
         B     MAPESD                                                   01659
         SPACE 2                                                        01660
MAPLAST  DS    0H                                                       01661
         BAL   R14,FREEESD                                              01662
         SPACE 3                                                        01663
         CLEAR MSGTEXT1                                                 01664
         LA    R0,6                                                     01665
         SLL   R0,16                                                    01666
         ST    R0,MSGTEXT1                                              01667
        $PUTLINE MSGTEXT1,ATTN=MAPEND                                   01668
         SPACE 3                                                        01669
MAPNOESD DS    0H                                                       01670
         MVC   MSGTEXT1,MSGENTRY                                        01671
         LH    R15,MSGTEXT1                                             01672
         LA    R14,MSGTEXT1(R15)                                        01673
         LA    R15,6(,R15)                                              01674
         STH   R15,MSGTEXT1                                             01675
         SPACE                                                          01676
         MVC   DOUBLE(3),DIRENTRY                                       01677
         MVI   DOUBLE+3,X'04'                                           01678
         UNPK  0(7,R14),DOUBLE(4)                                       01679
         TR    0(6,R14),TRTABLE                                         01680
         SPACE 2                                                        01681
         NI    FLAGS+1,255-FATTN                                        01682
         SPACE                                                          01683
         MESSAGE MSGTEXT1                                               01684
         SPACE 3                                                        01685
         MVC   MSGTEXT1,MSGLEN                                          01686
         LH    R15,MSGTEXT1                                             01687
         LA    R14,MSGTEXT1(R15)                                        01688
         LA    R15,6(R15)                                               01689
         STH   R15,MSGTEXT1                                             01690
         SPACE                                                          01691
         MVC   DOUBLE(3),DIRCORE                                        01692
         UNPK  0(7,R14),DOUBLE(4)                                       01693
         TR    0(6,R14),TRTABLE                                         01694
         SPACE                                                          01695
         TM    DIRFLAG,X'80'            IS MODULE AN ALIAS?             01696
         BZ    MAPREAL                  NO, NO ALIAS INFORMATION        01697
         SPACE                                                          01698
         MESSAGE MSGTEXT1                                               01699
         SPACE                                                          01700
         MVC   SAVETTR,DIRTTR           TTR OF REAL MODULE              01701
         MVC   MSGTEXT1,MSGNOMOD                                        01702
         OI    FLAGS+1,F1STREAD                                         01703
         SPACE 2                                                        01704
MAPALIAS DS    0H                                                       01705
         BAL   R14,READDIR              GET NEXT DIRECTORY MEMBER       01706
         B     MAPREAL                  END OF DIRECTORY                01707
         B     MAPREAL                  LAST MEMBER PROCESSED           01708
         SPACE 2                                                        01709
         TM    DIRFLAG,X'80'            THIS MODULE AN ALIAS?           01710
         BO    MAPALIAS                 YES, IGNORE                     01711
         SPACE                                                          01712
         CLC   SAVETTR,DIRTTR           CORRECT MODULE?                 01713
         BNE   MAPALIAS                 NO                              01714
         SPACE                                                          01715
         MVC   MSGTEXT1,MSGREAL                                         01716
         LH    R1,MSGTEXT1                                              01717
         LA    R0,8(,R1)                                                01718
         STH   R0,MSGTEXT1                                              01719
         LA    R1,MSGTEXT1(R1)                                          01720
         MVC   0(8,R1),DIRNAME                                          01721
         SPACE                                                          01722
MAPREAL  DS    0H                                                       01723
         MESSAGE MSGTEXT1                                               01724
         B     MAPEND                                                   01725
         DROP  R4                                                       01726
         SPACE 3                                                        01727
MAPNONE  DS    0H                                                       01728
         MESSAGE MSGNONE                                                01729
         B     MAPEND                                                   01730
         SPACE 2                                                        01731
MAPIO    DS    0H                                                       01732
         MESSAGE MSGIOERR                                               01733
         SPACE 3                                                        01734
MAPEND   DS    0H                                                       01735
         EXIT  COMMAND                                                  01736
         EJECT                                                          01737
*                                                                       01738
*                                                                       01739
*        HISTORY SUBCOMMAND                                             01740
*                                                                       01741
*                                                                       01742
         SPACE 2                                                        01743
HISTORY  ENTER COMMAND,PDL=PDLHIST      ESTABLISH SUBCOMMAND            01744
         TM    FLAGS,FLOADMOD           PROCESSING LOAD LIBRARY?        01745
         BO    HISTORY1                 YES                             01746
         SPACE                                                          01747
         LA    R1,MSGNLOAD              NOT LOAD LIBRARY                01748
         B     HISTORY0                                                 01749
         SPACE                                                          01750
NOHIST   DS    0H                                                       01751
         LA    R1,MSGNHIST                                              01752
         SPACE                                                          01753
HISTORY0 DS    0H                                                       01754
         MESSAGE (R1)                                                   01755
         B     EXITHIST                                                 01756
         SPACE 2                                                        01757
HISTORY1 DS    0H                                                       01758
         OI    FLAGS+1,FATTN            ALLOW INTERRUPTIONS             01759
         MVC   DIRNAME,MEMBER1          MEMBER NAME TO BLDL LIST        01760
         BLDL  INDCB,BLDLLIST           FIND THE MEMBER                 01761
         MVC   DIRFLAG(DIREND-DIRFLAG),DIRFLAG+2 BLDL ADDS THINGS       01762
         SPACE                                                          01763
         B     *+4(R15)                 PROCESS RETURN CODE             01764
         SPACE                                                          01765
         B     HISTORY2                 00-SUCESSFUL                    01766
         B     HISTNONE                 04-MEMBER NOT FOUND             01767
         B     HISTIOE                  08-I/O ERROR                    01768
         SPACE 2                                                        01769
HISTORY2 DS    0H                                                       01770
         OI    FLAGS+1,FALLESD          INDICATE BUILD ESD LIST         01771
         SPACE 2                                                        01772
         BAL   R14,READCESD             FORMAT THE CESD DATA            01773
         NOP   0                        NO ESD ENTRIES EXIST, CONTINUE  01774
         SPACE 2                                                        01775
         BAL   R14,READIDR              FORMAT THE HISTORY DATA         01776
         B     NOHIST                   HISTORY NOT AVAILABLE           01777
         SPACE 3                                                        01778
         MVC   MSGTEXT1,MSGHIST1        TITLE MESSAGE                   01779
         LH    R1,MSGTEXT1                                              01780
         LA    R0,L'MEMBER1(,R1)        ADJUST TOTAL MSG LENGTH         01781
         STH   R0,MSGTEXT1                                              01782
         LA    R1,MSGTEXT1(R1)                                          01783
         SPACE                                                          01784
         MVC   0(L'MEMBER1,R1),MEMBER1                                  01785
         SPACE                                                          01786
        $PUTLINE MSGTEXT1,ATTN=EXITHIST                                 01787
         SPACE 3                                                        01788
         MVC   MSGTEXT1,MSGHISTD        LAST LINKEDIT DATE MSG          01789
         LH    R1,MSGTEXT1                                              01790
         LA    R0,L'DATEMASK(R1)                                        01791
         STH   R0,MSGTEXT1                                              01792
         LA    R1,MSGTEXT1(R1)                                          01793
         SPACE 2                                                        01794
         MVC   0(L'DATEMASK,R1),DATEMASK                                01795
         ED    0(L'DATEMASK,R1),LKEDDATE                                01796
         SPACE                                                          01797
        $PUTLINE MSGTEXT1,ATTN=EXITHIST                                 01798
         SPACE 2                                                        01799
         L     R1,ESDPTR      ANY ESD ENTRIES?                          01800
         LTR   R1,R1                                                    01801
         BZ    EXITHIST                 NO, PROCESSING COMPLETED        01802
         EJECT                                                          01803
*                                                                       01804
*        FORMAT IMASPZAP IDR DATA ENTRIES                               01805
*                                                                       01806
         SPACE 1                                                        01807
         LA    R2,ESDPTR                START OF ESD CHAIN              01808
         USING ESDENTRY,R2                                              01809
         OI    FLAGS+1,F1IDR                                            01810
         SPACE                                                          01811
HISTZAP  DS    0H                                                       01812
         L     R2,ESDLINK               NEXT ESD ENTRY                  01813
         LTR   R2,R2                    END OF CHAIN?                   01814
         BZ    HISTZAP0                 YES                             01815
         SPACE                                                          01816
         CLI   ESDTYPE,CODESD           CSECT ENTRY?                    01817
         BNE   HISTZAP                  NO, SKIP THIS                   01818
         SPACE                                                          01819
         LA    R3,IDRPTR                SCAN IDR CHAIN                  01820
         USING IDRENTRY,R3                                              01821
         SPACE                                                          01822
HISTZAP1 DS    0H                                                       01823
         L     R3,IDRLINK                                               01824
         LTR   R3,R3                    END OF CHAIN?                   01825
         BZ    HISTZAP                  YES, NEXT ESD ENTRY             01826
         SPACE                                                          01827
         CLC   ESDID,IDRESDID           REQUESTED IDR RECORD?           01828
         BNE   HISTZAP1                 NO                              01829
         CLI   IDRTYPE,IDRZAP           IMASPZAP ENTRY?                 01830
         BNE   HISTZAP1                 NO                              01831
         SPACE                                                          01832
         TM    FLAGS+1,F1IDR            FIRST IDR RECORD?               01833
         BZ    HISTZAP2                 NO                              01834
         XI    FLAGS+1,F1IDR                                            01835
        $PUTLINE MSGHISTZ,ATTN=EXITHIST IMASPZAP TITLE LINE             01836
         SPACE                                                          01837
HISTZAP2 DS    0H                                                       01838
         CLEAR MSGTEXT1                                                 01839
         SPACE                                                          01840
         MVC   MSGTEXT1+4(L'ESDNAME),ESDNAME                            01841
         MVC   MSGTEXT1+8+L'ESDNAME(L'DATEMASK),DATEMASK                01842
         ED    MSGTEXT1+8+L'ESDNAME(L'DATEMASK),IDRDATE                 01843
         MVC   MSGTEXT1+12+L'ESDNAME+L'DATEMASK(L'IDRZDATA),IDRZDATA    01844
         SPACE                                                          01845
         LA    R0,L'ESDNAME+L'DATEMASK+L'IDRZDATA+12                    01846
         SLL   R0,16                                                    01847
         ST    R0,MSGTEXT1                                              01848
        $PUTLINE MSGTEXT1,ATTN=EXITHIST PRINT IMASPZAP DATA LINE        01849
         B     HISTZAP1                 NEXT IDR DATA RECORD            01850
         EJECT                                                          01851
HISTZAP0 DS    0H                                                       01852
         SPACE 3                                                        01853
*                                                                       01854
*        FORMAT THE USER-SUPPLIED IDR DATA RECORDS                      01855
*                                                                       01856
         SPACE 2                                                        01857
         LA    R2,ESDPTR                ADDRESS OF ESD CHAIN            01858
         OI    FLAGS+1,F1IDR                                            01859
         SPACE                                                          01860
HISTUSER DS    0H                                                       01861
         L     R2,ESDLINK               NEXT ESD ENTRY                  01862
         LTR   R2,R2                    END OF CHAIN?                   01863
         BZ    HISTUSR0                 YES                             01864
         SPACE                                                          01865
         CLI   ESDTYPE,CODESD           CSECT ENTRY?                    01866
         BNE   HISTUSER                 NO, NEXT ESD ENTRY              01867
         SPACE 2                                                        01868
         LA    R3,IDRPTR                                                01869
         SPACE                                                          01870
HISTUSR1 DS    0H                                                       01871
         L     R3,IDRLINK               NEXT IDR RECORD                 01872
         LTR   R3,R3                    END OF CHAIN?                   01873
         BZ    HISTUSER                 YES, NEXT ESD ENTRY             01874
         SPACE                                                          01875
         CLI   IDRTYPE,IDRUSER          USER IDR DATA RECORD?           01876
         BNE   HISTUSR1                 NO                              01877
         CLC   ESDID,IDRESDID           WANTED ESD RECORD?              01878
         BNE   HISTUSR1                 NO                              01879
         SPACE 2                                                        01880
         TM    FLAGS+1,F1IDR            TITLE LINE REQUIRED?            01881
         BZ    HISTUSR2                 NO                              01882
         XI    FLAGS+1,F1IDR                                            01883
         SPACE                                                          01884
        $PUTLINE MSGHISTU,ATTN=EXITHIST USER-SUPPLIED IDR TITLE         01885
         SPACE 2                                                        01886
HISTUSR2 DS    0H                                                       01887
         CLEAR MSGTEXT1                                                 01888
         SPACE 2                                                        01889
         MVC   MSGTEXT1+4(L'ESDNAME),ESDNAME                            01890
         MVC   MSGTEXT1+8+L'ESDNAME(L'DATEMASK),DATEMASK                01891
         ED    MSGTEXT1+8+L'ESDNAME(L'DATEMASK),IDRDATE                 01892
         SR    R1,R1                                                    01893
         IC    R1,IDRLDATA                                              01894
         CLI   IDRLDATA,X'FF'           ZERO BYTES???                   01895
         BE    HISTUSRS                 YA, SKIP MOVE                   01896
         MVC   MSGTEXT1+12+L'ESDNAME+L'DATEMASK(0),IDRDATA              01897
         EX    R1,*-6                                                   01898
         B     *+6                                                      01899
HISTUSRS SR    R1,R1                                                    01900
         LA    R1,13+L'ESDNAME+L'DATEMASK(R1)                           01901
         SLL   R1,16                                                    01902
         ST    R1,MSGTEXT1                                              01903
         SPACE 2                                                        01904
        $PUTLINE MSGTEXT1,ATTN=EXITHIST                                 01905
         SPACE                                                          01906
         B     HISTUSR1                                                 01907
         SPACE 3                                                        01908
HISTNONE DS    0H                                                       01909
         MESSAGE MSGNONE                MEMBER DOES NOT EXIST           01910
         B     EXITHIST                                                 01911
         SPACE 3                                                        01912
HISTIOE  DS    0H                                                       01913
         MESSAGE MSGIOERR               I/O ERROR IN DIRECTORY          01914
         SPACE 3                                                        01915
HISTUSR0 DS    0H                                                       01916
EXITHIST DS    0H                                                       01917
         BAL   R14,FREEESD                                              01918
         BAL   R14,FREEIDR                                              01919
         SPACE 2                                                        01920
         NI    FLAGS+1,255-F1IDR                                        01921
         SPACE 2                                                        01922
         EXIT  COMMAND                                                  01923
         SPACE 2                                                        01924
         DROP  R2,R3                                                    01925
         EJECT                                                          01926
*                                                                       01927
*                                                                       01928
*        IDR SCAN SUBROUTINE                                            01929
*                                                                       01930
*                                                                       01931
         SPACE 3                                                        01932
READIDR  DS    0H                                                       01933
         SAVE  (14,12)                  SAVE REGISTERS                  01934
         SPACE 2                                                        01935
         SPACE                                                          01936
         MVC   0(3,R13),DIRTTR                                          01937
         MVI   3(R13),0                                                 01938
         L     R0,0(,R13)               GET STARTING TTR OF MODULE      01939
         LA    R2,MBBCCHHR                                              01940
         L     R1,INDCB+(DCBDEBAD-IHADCB)                               01941
         SPACE 3                                                        01942
         LR    R3,R13                                                   01943
         L     R15,CVT                                                  01944
         L     R15,CVTPCNVT(,R15)       TTR CONVERT                     01945
         BALR  R14,R15                                                  01946
         LR    R13,R3                                                   01947
         LM    14,12,12(13)                                             01948
         SPACE 2                                                        01949
*                                                                       01950
*        BUILD CHANNEL PGM TO READ IDR RECORDS                          01951
*                                                                       01952
         SPACE 2                                                        01953
         LA    R0,IOBSEEK               ADDRESS OF SEEK FIELD           01954
         LA    R1,CCWS                                                  01955
         LA    R2,IDRBUFF                                               01956
         LA    R3,IOBSEEK                                               01957
         XC    CCWS(LCCWS),CCWS                                         01958
         ST    R0,CCWS                                                  01959
         ST    R1,CCWS+8                                                01960
         ST    R2,CCWS+16                                               01961
         ST    R3,CCWS+24                                               01962
         OC    CCWS(LIDRCCWS),IDRCCWS                                   01963
         SPACE 2                                                        01964
         MVI   IOBFLAG,X'42'                                            01965
         SPACE                                                          01966
         LA    R2,IDRPTR                                                01967
         USING IDRENTRY,R2                                              01968
         NI    FLAGS+1,255-FIDR-F1IDR                                   01969
         EJECT                                                          01970
IDREXCP  DS    0H                                                       01971
         MVI   IOECB,0                                                  01972
         EXCP  IOB                      START I/O                       01973
         SPACE                                                          01974
         WAIT  ECB=IOECB                                                01975
         MVI   DCBIFLGS-IHADCB+INDCB,0                                  01976
         SPACE                                                          01977
         CLI   IOECB,X'42'              EXTENT VIOLATION?               01978
         BNE   IDREXCP1                 NO                              01979
         BAL   R14,NEWEXTNT             YES, ADJUST FOR NEW EXTENT      01980
IDREXCP1 DS    0H                                                       01981
         SPACE                                                          01982
         CLI   IOECB,X'7F'              SUCCESSFUL?                     01983
         BNE   LASTIDR                  NO, MUST BE LAST IDR DATA       01984
         SPACE                                                          01985
         CLI   IDRBUFF,X'40'            TEST SYM RECORD?                01986
         BE    IDREXCP                  YES, SKIP RECORD                01987
         SPACE                                                          01988
         CLI   IDRBUFF,X'20'            CESD RECORD?                    01989
         BE    IDREXCP                  NO                              01990
         SPACE                                                          01991
         CLI   IDRBUFF,X'80'            IDR RECORD?                     01992
         BNE   LASTIDR                  NO                              01993
         SPACE                                                          01994
         LA    R3,IDRBUFF+3             START OF IDR DATA               01995
         TM    FLAGS+2,FIDRHCON         CONTINUED HEADER?               01996
         BZ    IDREXCP3                 NO, SKIP                        01997
         SPACE                                                          01998
         L     R15,IDROFSAV             PICK UP AMOUNT WE GOT           01999
         LA    R14,IDRUPREF+1(R15)      TARGET OF MOVE                  02000
         LA    R1,IDRBUFF+3+5-1         FIND LENGTH BYTE                02001
         SR    R1,R15                   BACK UP BY WHAT WE GOT          02002
         SR    R4,R4                    ZERO FOR LENGTH PICKUP          02003
         IC    R4,0(R1)                 PICK UP LENGTH                  02004
         LR    R1,R4                    SAVE LENGTH                     02005
         LA    R4,4(,R1)                GET TOTAL LENGTH OF REC         02006
         MVI   IDRTYPE,IDRUSER          SET TYPE                        02007
         BCTR  R1,0                     DECREMENT                       02008
         STC   R1,IDRLDATA                                              02009
         SR    R4,R15                   COMPUTE LENGTH TO MOVE          02010
         MVC   0(0,R14),IDRBUFF+3                                       02011
         EX    R4,*-6                                                   02012
         MVC   IDRESDID,IDRUPREF        SET ESDID                       02013
         NI    FLAGS+2,255-FIDRHCON     OFF FLAG                        02014
         LA    R3,1(R3,R4)              ADJUST R3 TO NEXT REC           02015
         SPACE                                                          02016
IDREXCP3 TM    FLAGS+2,FIDRCONT         CONTINUED IDR REC?              02017
         BZ    IDREXCP2                 NO, SKIP THE FOLLOWING          02018
         SPACE                                                          02019
         SR    R5,R5                    FIND WHERE TO START MOVE        02020
         IC    R5,IDRLDATA              DATA LENGTH                     02021
         LA    R5,IDRDATA+1(R5)         END OF DATA                     02022
         L     R15,IDROFSAV             LENGTH IN THIS RECORD           02023
         SR    R5,R15                   PLACE TO START MOVE             02024
         LA    R3,0(R15,R3)             MOVE R3 PAST CONTINUED PART     02025
         BCTR  R15,0                    DEC FOR MOVE                    02026
         MVC   0(0,R5),IDRBUFF+3        DO THE MOVE                     02027
         EX    R15,*-6                                                  02028
         NI    FLAGS+2,X'FF'-FIDRCONT   OFF CONTINUED FLAG              02029
         SPACE 2                                                        02030
IDREXCP2 SR    R5,R5                                                    02031
         IC    R5,IDRBUFF+1             BYTE COUNT THIS RECORD          02032
         LA    R5,IDRBUFF(R5)           END OF BUFFER ADDRESS           02033
         SPACE 2                                                        02034
         TM    IDRBUFF+2,X'80'          LAST RECORD OF LOAD MODULE?     02035
         BZ    *+8                      NO                              02036
         OI    FLAGS+1,F1IDR            YES, SET STOP FLAG              02037
         SPACE                                                          02038
         NI    IDRBUFF+2,X'0F'          CLEAR MISC FLAGS                02039
         CLI   IDRBUFF+2,IDRZAP         IMASPZAP IDR RECORD?            02040
         BE    ZAPIDR                   YES                             02041
         CLI   IDRBUFF+2,IDRLKED        LINKAGE EDITOR IDR RECORD?      02042
         BE    LKEDIDR                  YES                             02043
         CLI   IDRBUFF+2,IDRUSER        USER-SUPPLIED IDR RECORD?       02044
         BNE   NEXTIDR                  NO, NEXT RECORD                 02045
         EJECT                                                          02046
*        PROCESS USER-SUPPLIED DATA RECORDS                             02047
         SPACE                                                          02048
USERIDR  DS    0H                                                       02049
         BAL   R14,GETIDR               GET A NEW IDR RECORD            02050
         ST    R1,IDRLINK                                               02051
         LR    R2,R1                    ADDRESS OF NEW RECORD           02052
         SPACE                                                          02053
         LR    R15,R5                   SEE IF SPANNED RECORD HEADER    02054
         SR    R15,R3                   FIND BYTES LEFT IN BUFFER       02055
         LR    R14,R15                  SAVE VALUE                      02056
         SH    R15,=H'5'                IS ROOM FOR HEADER?             02057
         BNM   USERIDR0                 IF ROOM EXISTS                  02058
         OI    FLAGS+2,FIDRHCON         ON 'HDR CONT' FLAG              02059
         MVC   IDRUPREF(0),0(R3)        MOVE IN PART OF HEADER          02060
         EX    R14,*-6                                                  02061
         ST    R14,IDROFSAV             SAVE LENGTH FOR LATER           02062
         B     NEXTIDR                  READ NEXT IDR                   02063
         SPACE                                                          02064
USERIDR0 MVI   IDRTYPE,IDRUSER                                          02065
         MVC   IDRESDID,0(R3)           MOVE ESDID TO IDR AREA          02066
         LA    R1,2(,R3)                YYDDD IDR RECORD CREATED        02067
         BAL   R14,SETIDRDT                                             02068
         SR    R15,R15                                                  02069
         IC    R15,5(,R3)               LENGTH OF USER DATA AREA        02070
         LA    R4,6(,R15)               LENGTH OF THIS RECORD ENTRY     02071
         MVI   IDRTYPE,IDRUSER          INDICATE USER-SUPPLIED ENTRY    02072
         BCTR  R15,0                                                    02073
         BCTR  R4,0                                                     02074
         STC   R15,IDRLDATA                                             02075
         SPACE                                                          02076
         MVC   IDRUPREF(0),0(R3)        MOVE DATA TO RECORD             02077
         EX    R4,*-6                                                   02078
         LA    R4,1(,R4)                                                02079
         SPACE 1                                                        02080
         BXLE  R3,R4,USERIDR                                            02081
         SR    R3,R5                    ENTRY SPAN AN IDR BLOCK??       02082
         BCTR  R3,0                                                     02083
         LTR   R3,R3                    TEST                            02084
         BNP   NEXTIDR                  NO SPAN                         02085
         OI    FLAGS+2,FIDRCONT         MARK FOR CONTINUE PROCESSING    02086
         ST    R3,IDROFSAV              SAVE AMOUNT IN NEXT IDR BLK     02087
         B     NEXTIDR                                                  02088
         SPACE                                                          02089
         LTORG                                                          02090
         EJECT                                                          02091
*        PROCESS IMASPZAP IDR RECORDS                                   02092
         SPACE                                                          02093
ZAPIDR   DS    0H                                                       02094
         SR    R6,R6                                                    02095
         NI    0(R3),X'3F'                                              02096
         IC    R6,0(R3)                 GET COUNT OF IMASPZAP ENTRIES   02097
         LA    R3,1(R3)                                                 02098
         LA    R6,1(R6)                 JUMP COUNT FOR LOOP             02099
         B     ZAPIDR1                                                  02100
         SPACE 2                                                        02101
ZAPIDR2  DS    0H                                                       02102
         BAL   R14,GETIDR                                               02103
         ST    R1,IDRLINK                                               02104
         LR    R2,R1                                                    02105
         SPACE                                                          02106
         MVC   IDRESDID,0(R3)           MOVE ESDID TO IDR RECORD        02107
         SPACE                                                          02108
         LA    R1,2(,R3)                ADDRESS OF DATE OF RECORD       02109
         BAL   R14,SETIDRDT                                             02110
         SPACE                                                          02111
         MVC   IDRDATA,5(R3)            MOVE DATA TO IDR RECORD         02112
         MVI   IDRLDATA,8               SET LENGTH FOR COMPATIBILITY    02113
         MVI   IDRTYPE,IDRZAP           INDICATE IMASPZAP ENTRY         02114
         SPACE                                                          02115
         LA    R3,13(,R3)               JUMP DATA ADDRESS               02116
         SPACE                                                          02117
ZAPIDR1  DS    0H                                                       02118
         BCT   R6,ZAPIDR2               IF ANOTHER ENTRY THIS RECORD    02119
         B     NEXTIDR                  READ NEXT IDR RECORD            02120
         EJECT                                                          02121
*        LINKAGE EDITOR IDR RECORD PROCESSOR                            02122
         SPACE                                                          02123
LKEDIDR  DS    0H                                                       02124
         OI    FLAGS+1,FIDR                                             02125
         LA    R1,12(,R3)               ADDRESS OF DATE                 02126
         LA    R15,LKEDDATE                                             02127
         BAL   R14,SETLKDTE                                             02128
         SPACE 2                                                        02129
NEXTIDR  DS    0H                                                       02130
         TM    FLAGS+1,F1IDR            LAST IDR RECORD?                02131
         BZ    IDREXCP                  NO                              02132
         EJECT                                                          02133
LASTIDR  DS    0H                                                       02134
         NI    FLAGS+2,X'FF'-FIDRCONT-FIDRHCON   OFF CONT FLAGS         02135
         LA    R2,IDRPTR                                                02136
SORTIDR  DS    0H                                                       02137
         L     R2,IDRLINK                                               02138
         LTR   R2,R2                                                    02139
         BZ    SORTIDR1                                                 02140
         SPACE                                                          02141
         L     R1,IDRLINK                                               02142
         SPACE                                                          02143
SORTIDR2 DS    0H                                                       02144
         LTR   R1,R1                                                    02145
         BZ    SORTIDR                                                  02146
         SPACE                                                          02147
         CLC   IDRDATE,IDRDATE-IDRENTRY(R1)                             02148
         BNL   SORTIDR3                                                 02149
         XC    IDRSTART(LENIDR1),IDRSTART-IDRENTRY(R1)                  02150
         XC    IDRSTART-IDRENTRY(LENIDR1,R1),IDRSTART                   02151
         XC    IDRSTART(LENIDR1),IDRSTART-IDRENTRY(R1)                  02152
SORTIDR3 DS    0H                                                       02153
         L     R1,IDRLINK-IDRENTRY(R1)                                  02154
         B     SORTIDR2                                                 02155
SORTIDR1 DS    0H                                                       02156
         LM    14,12,12(13)                                             02157
         TM    FLAGS+1,FIDR             ANY IDR RECORDS?                02158
         BCR   8,R14                    NO                              02159
         B     4(,R14)                  YES                             02160
         EJECT                                                          02161
SETIDRDT DS    0H                                                       02162
         LA    R15,IDRDATE                                              02163
         SPACE                                                          02164
SETLKDTE DS    0H                                                       02165
         ST    R14,R14SAVE                                              02166
         MVC   DAYTABLE,DAYMONTH                                        02167
         XC    DOUBLE,DOUBLE                                            02168
         SR    R14,R14                  COMPUTE FOR LEAPYEAR            02169
         IC    R14,0(R1)                                                02170
         SLL   R14,4                                                    02171
         ST    R14,DOUBLE+4                                             02172
         OI    DOUBLE+7,X'0F'                                           02173
         LR    R14,R1                                                   02174
         CVB   R1,DOUBLE                GET YEAR IN BINARY              02175
         SR    R0,R0                                                    02176
         D     R0,FOUR                                                  02177
         LTR   R0,R0                    THIS A LEAP YEAR?               02178
         BNZ   *+8                      NO                              02179
         MVI   DAYTABLE+1,29            YES, FEB HAS 29 DAYS            02180
         SPACE                                                          02181
         MVC   2(1,R15),0(R14)          YEAR RECORD CREATED             02182
         MVC   DOUBLE+6(2),1(R14)                                       02183
         CLI   DOUBLE+7,0               IS THE DATE BAD?                02184
         BE    DAYSKIP                  YES, DON'T 0C7                  02185
         CVB   R1,DOUBLE                GET RELATIVE DAYS IN BINARY     02186
         SPACE                                                          02187
         LA    R14,DAYTABLE                                             02188
         SR    R0,R0                                                    02189
DAYLOOP  DS    0H                                                       02190
         IC    R0,0(,R14)               DAYS THIS MONTH                 02191
         SR    R1,R0                    WITHIN THIS MONTH?              02192
         BNP   DAYNOW                                                   02193
         LA    R14,1(R14)                                               02194
         B     DAYLOOP                                                  02195
DAYNOW   DS    0H                                                       02196
         AR    R1,R0                    GET DAY OF THE MONTH            02197
         LA    R0,10                                                    02198
         MR    R0,R0                                                    02199
         CVD   R1,DOUBLE                                                02200
         MVC   1(1,R15),DOUBLE+6                                        02201
         LA    R1,DAYTABLE-1                                            02202
         SR    R14,R1                                                   02203
         LA    R1,10                                                    02204
         MR    R0,R14                                                   02205
         CVD   R1,DOUBLE                                                02206
         MVC   0(1,R15),DOUBLE+6                                        02207
         SPACE                                                          02208
DAYSKIP  L     R14,R14SAVE                                              02209
         BR    R14                                                      02210
         EJECT                                                          02211
*                                                                       02212
*                                                                       02213
*        CESD SCAN SUBROUTINE                                           02214
*                                                                       02215
*                                                                       02216
         SPACE 3                                                        02217
READCESD DS    0H                                                       02218
         ST    R14,R14LINK                                              02219
         SPACE                                                          02220
         TM    DIRATTR+1,ATTRNE         DOES MODULE HAVE ESD ENTRIES?   02221
         MVC   MSGTEXT1,MSGNOESD                                        02222
         BCR   1,R14                    NO, EXIT W/ ERROR               02223
         STM   14,12,12(13)             SAVE REGISTERS                  02224
         SPACE 2                                                        02225
         MVC   0(3,R13),DIRTTR                                          02226
         MVI   3(R13),0                                                 02227
         L     R0,0(,R13)               GET STARTING TTR OF MODULE      02228
         LA    R2,MBBCCHHR                                              02229
         L     R1,INDCB+(DCBDEBAD-IHADCB)                               02230
         SPACE 3                                                        02231
         LR    R3,R13                                                   02232
         L     R15,CVT                                                  02233
         L     R15,CVTPCNVT(,R15)       TTR CONVERT                     02234
         BALR  R14,R15                                                  02235
         LR    R13,R3                                                   02236
         LM    14,12,12(13)                                             02237
         SPACE 2                                                        02238
*                                                                       02239
*        BUILD CHANNEL PGM TO READ CESD RECORDS                         02240
*                                                                       02241
         SPACE 2                                                        02242
         LA    R0,IOBSEEK               ADDRESS OF SEEK FIELD           02243
         LA    R1,CCWS                                                  02244
         LA    R2,ESDBUFF                                               02245
         LA    R3,IOBSEEK                                               02246
         XC    CCWS(LCCWS),CCWS                                         02247
         ST    R0,CCWS                                                  02248
         ST    R1,CCWS+8                                                02249
         ST    R2,CCWS+16                                               02250
         ST    R3,CCWS+24                                               02251
         OC    CCWS(LESDCCWS),ESDCCWS                                   02252
         SPACE 2                                                        02253
         MVI   IOBFLAG,X'42'                                            02254
         SPACE                                                          02255
         LA    R2,ESDPTR                                                02256
         EJECT                                                          02257
ESDEXCP  DS    0H                                                       02258
         MVI   IOECB,0                                                  02259
         EXCP  IOB                      START I/O                       02260
         SPACE                                                          02261
         WAIT  ECB=IOECB                                                02262
         MVI   DCBIFLGS-IHADCB+INDCB,0                                  02263
         SPACE                                                          02264
         CLI   IOECB,X'42'              EXTENT VIOLATION?               02265
         BNE   ESDEXCP1                 NO                              02266
         BAL   R14,NEWEXTNT             YES, ADJUST FOR NEW EXTENT      02267
ESDEXCP1 DS    0H                                                       02268
         SPACE                                                          02269
         CLI   IOECB,X'7F'              SUCESSFUL?                      02270
         BNE   ESDLAST                  NO, MUST BE LAST ESD DATA       02271
         SPACE                                                          02272
         CLI   ESDBUFF,X'40'            TEST SYM RECORD?                02273
         BE    ESDEXCP                  YES, SKIP RECORD                02274
         SPACE                                                          02275
         CLI   ESDBUFF,X'20'            CESD RECORD?                    02276
         BNE   ESDLAST                  NO                              02277
         SPACE                                                          02278
         LH    R6,ESDBUFF+4             RELATIVE # OF 1ST ESD ID        02279
         LA    R3,ESDBUFF+8             START OF ESD DATA               02280
         LH    R5,ESDBUFF+6             LENGTH OF DATA IN BUFFER        02281
         AR    R5,R3                                                    02282
         LA    R4,16                    LENGTH OF ONE ENTRY             02283
         SR    R5,R4                                                    02284
         SPACE 2                                                        02285
ESDSCAN  DS    0H                                                       02286
         USING ESDNAME,R3                                               02287
         IC    R0,ESDTYPE                                               02288
         LA    R1,CODESEG               CHECK FOR SEGTAB/ENTAB          02289
         NI    ESDTYPE,X'0F'                                            02290
         NR    R0,R1                                                    02291
         TM    FLAGS+1,FALLESD          SEARCH REQUEST?                 02292
         BZ    ESDMATCH                 YES, SCAN ESD ENTRIES           02293
         CR    R0,R1                    THIS SEGTAB/ENTAB ENTRY?        02294
         BE    ESDUSE1                  YES                             02295
         SPACE                                                          02296
         CLI   ESDTYPE,CODESD           SD ENTRY?                       02297
         BE    ESDUSE                   YES                             02298
         SPACE                                                          02299
         CLI   ESDTYPE,CODELR           LR ENTRY?                       02300
         BE    ESDUSE                                                   02301
         SPACE                                                          02302
         CLI   ESDTYPE,CODEPC           PRIVATE ENTRY?                  02303
         BE    ESDUSEPC                 YES                             02304
         SPACE 2                                                        02305
NEXTESD  DS    0H                                                       02306
         LA    R6,1(,R6)                                                02307
         BXLE  R3,R4,ESDSCAN                                            02308
         SPACE                                                          02309
         B     ESDEXCP                  GET NEXT ESD RECORD             02310
         SPACE 3                                                        02311
ESDUSEPC DS    0H                                                       02312
         MVC   ESDNAME,$PRIVATE         IDENTIFY PRIVATE ENTRY          02313
         B     ESDUSE                                                   02314
         SPACE                                                          02315
ESDUSE1  DS    0H                                                       02316
         STC   R0,ESDTYPE                RESTORE SEGTAB/ENTAB TYPE      02317
ESDUSE   DS    0H                                                       02318
         BAL   R14,GETESD                                               02319
         DROP  R3                                                       02320
         USING ESDENTRY,R2                                              02321
         ST    R1,ESDLINK                                               02322
         LR    R2,R1                                                    02323
         STH   R6,ESDID                 SAVE ESD ID                     02324
         MVC   ESDNAME(LENESD1),0(R3)   SAVE ESD ENTRY                  02325
         B     NEXTESD                                                  02326
         SPACE 2                                                        02327
ESDLAST  DS    0H                                                       02328
         OC    ESDPTR,ESDPTR                                            02329
         MVC   MSGTEXT1,MSGNOESD                                        02330
         L     R14,R14LINK                                              02331
         BZ    ESDEXIT                  EXIT - NO ESD DATA AVAILABLE    02332
         SPACE 2                                                        02333
         LA    R2,ESDPTR                                                02334
         SPACE                                                          02335
ESDSORT  DS    0H                                                       02336
         L     R2,ESDLINK                                               02337
         L     R1,ESDLINK                                               02338
         LTR   R1,R1                                                    02339
         BZ    ESDSORT1                 LAST ESD ENTRY                  02340
         SPACE                                                          02341
ESDSORT2 DS    0H                                                       02342
         CLC   ESDSEG#,ESDSEG#-ESDENTRY(R1) CHECK ENTRY SEGMENT #S      02343
         BL    ESDSORT3                                                 02344
         BH    ESDSWAP                                                  02345
         SPACE                                                          02346
         CLC   ESDADDR,ESDADDR-ESDENTRY(R1)                             02347
         BL    ESDSORT3                                                 02348
         BH    ESDSWAP                                                  02349
         SPACE                                                          02350
         CLC   ESDTYPE,ESDTYPE-ESDENTRY(R1)                             02351
         BL    ESDSORT3                                                 02352
         BH    ESDSWAP                                                  02353
         SPACE                                                          02354
         CLC   ESDNAME,ESDNAME-ESDENTRY(R1)                             02355
         BNH   ESDSORT3                                                 02356
         SPACE                                                          02357
ESDSWAP  DS    0H                                                       02358
         XC    ESDNAME(LENESD2),ESDNAME-ESDENTRY(R1)                    02359
         XC    ESDNAME-ESDENTRY(LENESD2,R1),ESDNAME                     02360
         XC    ESDNAME(LENESD2),ESDNAME-ESDENTRY(R1)                    02361
         SPACE                                                          02362
ESDSORT3 DS    0H                                                       02363
         L     R1,ESDLINK-ESDENTRY(,R1)                                 02364
         LTR   R1,R1                                                    02365
         BNZ   ESDSORT2                                                 02366
         B     ESDSORT                                                  02367
         SPACE 3                                                        02368
ESDSORT1 DS    0H                                                       02369
ESDOUT   DS    0H                                                       02370
         L     R14,R14LINK                                              02371
         LA    R14,4(,R14)              ADJUST EXIT ADDRESS             02372
         NI    FLAGS+1,255-FALLESD                                      02373
         SPACE 2                                                        02374
ESDEXIT  DS    0H                                                       02375
         LM    15,12,16(13)             RESTORE REGISTERS               02376
         BR    R14                      EXIT                            02377
         DROP  R2                                                       02378
         SPACE 3                                                        02379
ESDMATCH DS    0H                                                       02380
         USING ESDNAME,R3                                               02381
         CLI   ESDTYPE,CODESD           VALID EXTERNAL SYMBOL?          02382
         BE    ESDCHECK                 YES                             02383
         CLI   ESDTYPE,CODELR           ANOTHER VALID ENTRY             02384
         BNE   NEXTESD                  NO VALID, CONTINUE              02385
         SPACE                                                          02386
ESDCHECK DS    0H                                                       02387
         CLC   ESDNAME,DIRNAME          REQUESTED NAME?                 02388
         BNE   NEXTESD                  NO                              02389
         SPACE                                                          02390
         CLI   ESDSEG#,1                IS SYMBOL IN ROOT SEGMENT?      02391
         BNE   NEXTESD                  NO, CONTINUE                    02392
         SPACE                                                          02393
         L     R1,ESDADDR-1             GET SYMBOL OFFSET               02394
         LA    R1,0(,R1)                                                02395
         ST    R1,24(,13)               RETURN OFFSET IN REG 1          02396
         B     ESDOUT                                                   02397
         EJECT                                                          02398
*                                                                       02399
*                                                                       02400
*        ESD TABLE SUBROUTINES                                          02401
*                                                                       02402
*                                                                       02403
         SPACE 2                                                        02404
GETESD   DS    0H                                                       02405
         GETMAIN R,LV=LENESD                                            02406
         XC    0(LENESD,R1),0(R1)                                       02407
         BR    R14                                                      02408
         SPACE 5                                                        02409
FREEESD  DS    0H                                                       02410
         ST    R14,R14SAVE                                              02411
         SPACE                                                          02412
         L     R14,ESDPTR                                               02413
         SPACE                                                          02414
FREEESD1 DS    0H                                                       02415
         LTR   R1,R14                                                   02416
         BZ    FREEESD2                                                 02417
         L     R14,ESDLINK-ESDENTRY(,R14)                               02418
         SPACE                                                          02419
         FREEMAIN R,LV=LENESD,A=(1)                                     02420
         B     FREEESD1                                                 02421
         SPACE 2                                                        02422
FREEESD2 DS    0H                                                       02423
         XC    ESDPTR,ESDPTR                                            02424
         L     R14,R14SAVE                                              02425
         BR    R14                                                      02426
         EJECT                                                          02427
*                                                                       02428
*                                                                       02429
*        IDR TABLE SUBROUTINES                                          02430
*                                                                       02431
*                                                                       02432
         SPACE 2                                                        02433
GETIDR   DS    0H                                                       02434
         OI    FLAGS+1,FIDR             IDR DATA USED                   02435
         GETMAIN R,LV=LENIDR                                            02436
         XC    0(LENIDR,R1),0(R1)                                       02437
         BR    R14                                                      02438
         SPACE 5                                                        02439
FREEIDR  DS    0H                                                       02440
         ST    R14,R14SAVE                                              02441
         SPACE                                                          02442
         L     R14,IDRPTR                                               02443
         SPACE                                                          02444
FREEIDR1 DS    0H                                                       02445
         LTR   R1,R14                                                   02446
         BZ    FREEIDR2                                                 02447
         L     R14,IDRLINK-IDRENTRY(,R14)                               02448
         SPACE                                                          02449
         FREEMAIN R,LV=LENIDR,A=(1)                                     02450
         B     FREEIDR1                                                 02451
         SPACE 2                                                        02452
FREEIDR2 DS    0H                                                       02453
         XC    IDRPTR,IDRPTR                                            02454
         L     R14,R14SAVE                                              02455
         BR    R14                                                      02456
         EJECT                                                          02457
*                                                                       02458
*        CHANGE SUBCOMMAND SPECIAL ENTRY                                02459
*                                                                       02460
         SPACE 2                                                        02461
CHANGE   DS    0H                                                       02462
         OI    FLAGS,FRESTART           INDICATE RESTART                02463
         SPACE 2                                                        02464
*                                                                       02465
*        END SUBCOMMAND SPECIAL ENTRY                                   02466
*                                                                       02467
         SPACE 2                                                        02468
END      DS    0H                                                       02469
         L     R1,BUFFADDR              BUFFER ADDRESS                  02470
         LTR   R1,R1                    BUFFER PRESENT?                 02471
         BZ    FREENONE                 NO                              02472
         XC    BUFFADDR,BUFFADDR        CLEAR BUFFER ADDRESS            02473
         LH    R0,DCBBLKSI-IHADCB+INDCB                                 02474
         FREEMAIN R,LV=(0),A=(1)                                        02475
         SPACE                                                          02476
FREENONE DS    0H                                                       02477
         MVI   PARMLIST,0                                               02478
         MVI   PARMLIST+4,X'80'                                         02479
         CLOSE (INDCB,,STOWDCB),MF=(E,PARMLIST)                         02480
         SPACE 2                                                        02481
         TM    FLAGS,FRESTART           RESTART REQUEST?                02482
         BO    RESTART                  YES                             02483
         SPACE 2                                                        02484
         MVC   DDNAME1,DCBDDNAM-IHADCB+INDCB DDNAME TO DE-ALLOCATE      02485
         BAL   R14,DEALLOC              FREE THE DATA SET               02486
         SPACE                                                          02487
         B     EXIT0                                                    02488
         EJECT                                                          02489
*                                                                       02490
*                                                                       02491
*        INPUT BUFFER RELEASE SUBROUTINE                                02492
*                                                                       02493
*                                                                       02494
         SPACE 2                                                        02495
FREEBUFF DS    0H                                                       02496
         TM    FLAGS,FCMD               BUFFER IN USE?                  02497
         BCR   1,R14                    YES, LEAVE IT                   02498
         STM   R14,R1,12(R13)                                           02499
         L     R1,ADDRCBUF                                              02500
         LTR   R1,R1                                                    02501
         BZ    NOBUFF                   NONE EXISTS                     02502
         SPACE                                                          02503
         LH    R0,0(,R1)                                                02504
         LA    R15,1          SUBPOOL IS 1                              02505
         SLL   R15,24                                                   02506
         OR    R0,R15                                                   02507
         SPACE                                                          02508
         FREEMAIN R,LV=(0),A=(1)                                        02509
         SPACE                                                          02510
NOBUFF   DS    0H                                                       02511
         LM    R14,R1,12(R13)                                           02512
         XC    ADDRCBUF,ADDRCBUF                                        02513
         BR    R14                                                      02514
         SPACE 3                                                        02515
*                                                                       02516
*                                                                       02517
*        DATA SET END-OF-EXTENT PSUEDO APPENDAGE                        02518
*                                                                       02519
*                                                                       02520
         SPACE 2                                                        02521
NEWEXTNT DS    0H                                                       02522
         SR    R0,R0                                                    02523
         SR    R15,R15                                                  02524
         L     R1,DCBDEBAD-IHADCB+INDCB                                 02525
         IC    R15,MBBCCHHR             CURRENT EXTENT #                02526
         IC    R0,DEBXTNT#(R1)          # EXTENTS IN DATA SET           02527
         LA    R15,1(,R15)              ONE MORE DONE                   02528
         CR    R15,R0                   CHECK FOR END OF DATA SET       02529
         BCR   2,R14                    YES, EXIT                       02530
         STC   R15,MBBCCHHR             NO, SAVE NEW EXTENT COUNT       02531
         MVI   IOBSEEK+4,X'01'                                          02532
         SLL   R15,4                    COMPUTE EXTENT OFFSET           02533
         AR    R1,R15                   IN DEB                          02534
         MVC   IOBSEEK(4),DEBEXTNT+6(R1)                                02535
         MVI   IOECB,X'7F'                                              02536
         BR    R14                                                      02537
         EJECT                                                          02538
*                                                                       02539
*                                                                       02540
*        DIRECTORY READ SUBROUTINE                                      02541
*                                                                       02542
*                                                                       02543
         SPACE 2                                                        02544
READDIR  DS    0H                                                       02545
         ST    R14,R14SAVE                                              02546
         SPACE                                                          02547
         TM    FLAGS+1,F1STREAD         IS THIS FIRST TIME?             02548
         BZ    DEBLOCK                  NO                              02549
         SPACE                                                          02550
         XI    FLAGS+1,F1STREAD                                         02551
         NI    FLAGS+2,255-FDIREND      END OF DIRECTORY TO COME        02552
         SR    R0,R0                    CLEAR DIRECTORY TOTALS          02553
         STH   R0,TOTUSED                                               02554
         STH   R0,TOTBLOCK                                              02555
         STH   R0,TOTMEMR               TOTAL REAL MEMBERS              02556
         STH   R0,TOTMEMA               TOTAL ALIASES                   02557
         SPACE                                                          02558
*                                                                       02559
*        INITIALIZE DIRECTORY READ SUBROUTINE                           02560
*                                                                       02561
         SPACE                                                          02562
         LA    R0,X'100'                TTR OF FIRST BLOCK              02563
         L     R1,DCBDEBAD-IHADCB+INDCB                                 02564
         LA    R2,MBBCCHHR                                              02565
         SPACE                                                          02566
         L     R15,CVT                                                  02567
         L     R15,CVTPCNVT(,R15)       TTR TO CCHHR CONVERT ROUTINE    02568
         STM   14,12,12(R13)            SAVE REGISTERS                  02569
         LR    R3,R13                                                   02570
         BALR  R14,R15                  CONVERT TTR                     02571
         LR    R13,R3                                                   02572
         LM    14,12,12(R13)            RESTORE REGISTERS               02573
         SPACE 2                                                        02574
         MVI   IOBFLAG,X'42'                                            02575
         XC    CCWS(LCCWS),CCWS                                         02576
         SPACE                                                          02577
         LA    R14,IOBSEEK              CREATE CHANNEL PGM TO READ      02578
         LA    R15,CCWS                 DIRECTORY BLOCKS                02579
         LA    R0,IOBSEEK                                               02580
         LA    R1,DIRBLOCK                                              02581
         SPACE                                                          02582
         ST    R14,CCWS                 ADDR FOR SEARCH CCW             02583
         ST    R15,CCWS+8               ADDR FOR TIC CCW                02584
         ST    R1,CCWS+16               ADDR FOR READ DATA              02585
         ST    R0,CCWS+24               ADDR FOR READ COUNT CCW         02586
         SPACE                                                          02587
         OC    CCWS(LDIRCCWS),DIRCCWS   MERGE IN REAL CCWS              02588
         SPACE 3                                                        02589
READDIR1 DS    0H                                                       02590
         MVI   IOECB,0                                                  02591
         EXCP  IOB                                                      02592
         SPACE                                                          02593
         WAIT  ECB=IOECB                                                02594
         MVI   DCBIFLGS-IHADCB+INDCB,0 CLEAR STATUS FLAGS               02595
         SPACE                                                          02596
         CLI   IOECB,X'42'              EXTENT VIOLATION?               02597
         BNE   *+8                      NO                              02598
         BAL   R14,NEWEXTNT             YES, ADJUST FOR NEW EXTENT      02599
         SPACE                                                          02600
         CLI   IOECB,X'7F'              SUCESSFUL COMPLETION?           02601
         BE    READDIR2                 YES, DELOCK DIRECTORY           02602
         SR    R15,R15                                                  02603
         TM    IOBCSW+3,X'01'           END OF FILE?                    02604
         BO    READDIR4                 YES, EXIT AT END OF DIRECTORY   02605
         SPACE                                                          02606
         B     READDIR5                 EXIT AS IF LAST MEMBER          02607
         SPACE 3                                                        02608
READDIR2 DS    0H                                                       02609
         LH    R14,TOTBLOCK             JUMP TOTAL DIRECTORY            02610
         LA    R14,1(,R14)              BLOCK COUNTER                   02611
         STH   R14,TOTBLOCK                                             02612
         SPACE                                                          02613
         TM    FLAGS+2,FDIRSCAN+FDIREND END OF DIRECTORY?               02614
         BO    READDIR1                                                 02615
         SPACE                                                          02616
         LA    R15,DIRBLOCK                                             02617
         LA    R0,2                                                     02618
         LH    R1,DIRBLOCK                                              02619
         LA    R1,DIRBLOCK-1(R1)                                        02620
         STM   R15,R1,DIRPTRS                                           02621
         SPACE                                                          02622
         LH    R14,TOTUSED                                              02623
         LA    R14,1(,R14)                                              02624
         STH   R14,TOTUSED              COUNT USED BLOCK                02625
         SPACE 2                                                        02626
DEBLOCK  DS    0H                                                       02627
         LM    R15,R1,DIRPTRS                                           02628
         BXH   R15,R0,READDIR1                                          02629
         STM   R15,R1,DIRPTRS                                           02630
         SPACE                                                          02631
         CLC   FF(8),0(R15)             LAST MEMBER?                    02632
         BE    READDIR3                 YES                             02633
         SPACE                                                          02634
         LA    R14,X'1F'                                                02635
         IC    R0,11(,R15)                                              02636
         NR    R0,R14                                                   02637
         AR    R0,R0                                                    02638
         LA    R14,12                                                   02639
         AR    R0,R14                   LENGTH OF CURRENT ENTRY         02640
         STM   R15,R1,DIRPTRS           SAVE RESTART POINTERS           02641
         SPACE                                                          02642
         MVC   DIRNAME(74),0(R15)       COPY ENTRY TO WORK AREA         02643
         SPACE 2                                                        02644
         TM    11(R15),X'80'            ENTRY AN ALIAS?                 02645
         LA    R14,TOTMEMR              ASSUME NOT                      02646
         BZ    *+8                      NO, REAL MEMBER                 02647
         LA    R14,TOTMEMA              YES, ALIAS MEMBER               02648
         SPACE                                                          02649
         LH    R15,0(,R14)                                              02650
         LA    R15,1(,R15)                                              02651
         STH   R15,0(,R14)                                              02652
         SPACE 2                                                        02653
         TM    FLAGS+2,FDIRSCAN         SCAN TOTAL DIRECTORY?           02654
         BO    DEBLOCK                  YES, CONTINUE THIS BLOCK        02655
         SPACE 2                                                        02656
         LA    R15,8                    EXIT OFFSET                     02657
         B     READDIR4                                                 02658
         SPACE 2                                                        02659
READDIR3 DS    0H                                                       02660
         OI    FLAGS+2,FDIREND          END OF DIRECTORY                02661
         TM    FLAGS+2,FDIRSCAN         STATISTICS SCAN?                02662
         BO    READDIR1                 YES, CONTINUE IT                02663
         SPACE                                                          02664
READDIR5 DS    0H                                                       02665
         LA    R15,4                    LAST MEMBER EXIT OFFSET         02666
         SPACE 2                                                        02667
READDIR4 DS    0H                                                       02668
         L     R14,R14SAVE                                              02669
         NI    FLAGS+2,255-FDIRSCAN-FDIREND                             02670
         B     0(R14,R15)                                               02671
         EJECT                                                          02672
*                                                                       02673
*                                                                       02674
*        PARSE INTERFACE SUBROUTINE                                     02675
*                                                                       02676
*                                                                       02677
         SPACE 3                                                        02678
GOPARSE  DS    0H                                                       02679
         ST    R1,ADDRPCL                                               02680
         ST    R14,R14PARSE                                             02681
         BAL   R14,FREEPDL                                              02682
         SPACE 3                                                        02683
*                                                                       02684
*        BUILD PARSE PARAMETER LIST AND INVOKE                          02685
*        IKJPARS TO ANALYZE COMMAND OPERANDS                            02686
*                                                                       02687
         SPACE 3                                                        02688
         LA    R1,PARSELST              AREA FOR PARSE PARAMETERS       02689
         USING PPL,R1                   BASE FOR PARSE PARAMETER LIST   02690
         SPACE 2                                                        02691
         MVC   PPLUPT,ADDRUPT           PASS UPT ADDRESS                02692
         MVC   PPLECT,ADDRECT           AND ECT ADDRESS                 02693
         MVC   PPLCBUF,ADDRCBUF         AND COMMAND BUFFER ADDR         02694
         SPACE                                                          02695
         ST    WORKREG,PPLUWA           ALSO PASS WORK AREA ADDRESS     02696
*                                       FOR VALIDITY CHECK EXITS        02697
         SPACE                                                          02698
         LA    R0,ATTNECB               ECB FOR ATTN INTERRUPTS         02699
         MVI   ATTNECB,0                CLEAR ECB                       02700
         ST    R0,PPLECB                PASSE TO PARSE                  02701
         SPACE                                                          02702
         LA    R0,ADDRPDL               PASS ADDR OF WORD WHERE PARSE   02703
         ST    R0,PPLANS                RETURNS PDL ADDRESS             02704
         SPACE                                                          02705
         MVC   PPLPCL,ADDRPCL           ADDRESS OF PARSE CONTROL LIST   02706
         SPACE 3                                                        02707
         LINK  EPLOC=IKJPARS            INVOKE PARSE                    02708
         DROP  R1                                                       02709
         SPACE 2                                                        02710
         LA    R14,MAXPARSE             RETURN CODE LIMIT               02711
         CR    R15,R14                  CHECK RETURN CODE WITHIN LIMITS 02712
         BNL   PARSEBAD                 NO, ERROR                       02713
         SPACE                                                          02714
         B     *+4(R15)                 PROCESS RETURN CODE             02715
         SPACE                                                          02716
PARSERET B     PARSEOK                  00- SUCESSFUL                   02717
         B     EXIT8                    04- PARSE UNABLE TO PROMPT      02718
         B     PARSE1                   08- USER ENTERED ATTENTION      02719
         B     PARSEBAD                 12- INVALID PARAMETERS          02720
         B     PARSEBAD                 16- PARSE INTERNAL FAILURE      02721
         B     EXIT8                    20 - VALIDITY CHECK ERROR       02722
MAXPARSE EQU   *-PARSERET               MAXIMUM PARSE RETURN CODES      02723
         SPACE 2                                                        02724
         SPACE 2                                                        02725
PARSEBAD DS    0H                                                       02726
         MVC   MSGTEXT2+4(L'MSGPARSE),MSGPARSE                          02727
         LA    R1,MSGTEXT2+4+L'MSGPARSE                                 02728
         SPACE                                                          02729
         CVD   R15,DOUBLE                                               02730
         OI    DOUBLE+7,X'0F'                                           02731
         UNPK  0(2,R1),DOUBLE                                           02732
         SPACE                                                          02733
         LA    R0,MSGTEXT2-2                                            02734
         SR    R1,R0                                                    02735
         SLL   R1,16                                                    02736
         ST    R1,MSGTEXT2                                              02737
         SPACE 2                                                        02738
         LA    R0,MSGTEXT2    PUT OUT 'COMMAND ERROR' MSG               02739
         MESSAGE MSGCMDER,(R0)                                          02740
         B     EXIT12                                                   02741
         SPACE 2                                                        02742
PARSE1   DS    0H                                                       02743
         SR    R15,R15        RETURN AT OFFSET 0                        02744
         B     PARSEOUT                                                 02745
         SPACE 2                                                        02746
PARSEOK  DS    0H                                                       02747
         LA    R15,4                                                    02748
         SPACE                                                          02749
PARSEOUT DS    0H                                                       02750
         L     R14,R14PARSE                                             02751
         B     0(R15,R14)               EXIT FROM PARSE                 02752
         EJECT                                                          02753
PUTERROR DS    0H                                                       02754
GETERROR DS    0H                                                       02755
EXIT12   DS    0H                                                       02756
         LA    R15,12                   ERROR CODE 12                   02757
         B     RETURN                                                   02758
         SPACE                                                          02759
EXIT8    DS    0H                                                       02760
         LA    R15,8                    ERROR CODE 8                    02761
         B     RETURN                                                   02762
         SPACE                                                          02763
EXIT4    DS    0H                                                       02764
         LA    R15,4                                                    02765
         B     RETURN                                                   02766
         SPACE                                                          02767
EXIT0    DS    0H                                                       02768
         SR    R15,R15                                                  02769
         SPACE 3                                                        02770
RETURN   DS    0H                                                       02771
         LTR   R2,R15                   NORMAL EXIT?                    02772
         BZ    RETURN1                  YES                             02773
         SPACE 2                                                        02774
         LA    R1,PARMLIST              AREA FOR STACK PARM LIST        02775
         USING IOPL,R1                                                  02776
         SPACE                                                          02777
         MVC   IOPLUPT,ADDRUPT                                          02778
         MVC   IOPLECT,ADDRECT                                          02779
         LA    R0,ATTNECB                                               02780
         MVI   ATTNECB,0                                                02781
         ST    R0,IOPLECB                                               02782
         SPACE 2                                                        02783
         STACK PARM=PARMLIST+16,DELETE=ALL,MF=(E,(1))                   02784
         SPACE 3                                                        02785
         TCLEARQ INPUT                  CLEAR INPUT BUFFERS             02786
         SPACE 3                                                        02787
RETURN1  DS    0H                                                       02788
         BAL   R14,FREEPDL              FREE THE PARSE STROAGE          02789
         SPACE                                                          02790
         DELETE EPLOC=IKJPUTL                                           02791
         SPACE                                                          02792
         DELETE EPLOC=IKJGETL                                           02793
         SPACE                                                          02794
         DELETE EPLOC=IKJSCAN                                           02795
         SPACE 3                                                        02796
         STAE  0,OV                     CANCEL STAE EXIT                02797
         SPACE 3                                                        02798
         L     R13,ADDRSAVE             RESTORE FIRST SAVE AREA ADDR    02799
         LR    R15,R2                   RESTORE RETURN CODE             02800
         SPACE                                                          02801
         L     R0,CORESIZE                                              02802
         SPACE                                                          02803
         EXIT  LV=(0)                                                   02804
         EJECT                                                          02805
*                                                                       02806
*        STAE EXIT                                                      02807
*                                                                       02808
         SPACE 3                                                        02809
STAEEXIT DS    0H                                                       02810
         USING *,R15                    TEMPORARY BASE                  02811
         SPACE                                                          02812
         CH    R0,STAECODE              IS WORK AREA PROVIDED?          02813
         BE    STAE1                    NO                              02814
         SPACE                                                          02815
         L     WORKREG,0(R1)            YES, GET OUR WORK AREA ADDR     02816
         B     STAE2                                                    02817
         SPACE 2                                                        02818
STAE1    DS    0H                                                       02819
         LR    WORKREG,R2               OUR WORK AREA ADDR              02820
         SPACE 2                                                        02821
STAE2    DS    0H                                                       02822
         STM   0,15,STAEREGS                                            02823
         SPACE 2                                                        02824
         LM    BASEREG1,BASEREG2,BASES                                  02825
         DROP  R15                                                      02826
         SPACE                                                          02827
         LA    R13,STAESAVE                                             02828
         SPACE 2                                                        02829
STAE4    LM    0,15,STAEREGS                                            02830
         SR    R15,R15                  NO RETRY EXIT                   02831
         BR    R14                                                      02832
         SPACE                                                          02833
STAECODE DC    H'20'                                                    02834
         EJECT                                                          02835
*                                                                       02836
*                                                                       02837
*        STOW DCB OPEN SUBROUTINE                                       02838
*                                                                       02839
*                                                                       02840
         SPACE 3                                                        02841
OPENSTOW DS    0H                                                       02842
         TM    STOWDCB+48,X'10'         DCB OPEN?                       02843
         BO    4(,R14)                  YES, EXIT                       02844
         MVI   OPENLIST,X'80'                                           02845
         ST    R14,0(,R13)              SAVE RETURN ADDRESS             02846
         OPEN  (STOWDCB,OUTPUT),MF=(E,OPENLIST)                         02847
         L     R14,0(,R13)                                              02848
         TM    DCBOFLGS-IHADCB+STOWDCB,X'10' DID DCB OPEN?              02849
         BO    4(,R14)                  YES, RETURN                     02850
         SPACE 2                                                        02851
         MESSAGE MSGNOPEN                                               02852
         SPACE 2                                                        02853
         L     R14,0(,R13)                                              02854
         BR    R14                                                      02855
         EJECT                                                          02856
*                                                                       02857
*                                                                       02858
*        MEMBER NAME VALIDITY CHECK SUBROUTINE                          02859
*                                                                       02860
*                                                                       02861
         SPACE 3                                                        02862
VERMEMBR ENTER VALCHECK                                                 02863
         TM    6(RPDL),X'80'            WAS MEMBER NAME SPECIFIED?      02864
         BZ    SKIPTHIS                 NO                              02865
         SPACE 2                                                        02866
         L     R15,0(,RPDL)             ADDR OF MEMBER NAME             02867
         LH    R14,4(,RPDL)             LENGTH OF NAME                  02868
         BCTR  R14,0                    EXECUTE LENGTH                  02869
         SPACE 2                                                        02870
         OI    FLAGS,FMEMBER2                                           02871
         CLI   SUBNAME,C'D'             PAD WITH F'S?                   02872
         LM    R6,R7,FF                 LOAD HIGH VALUES PAD            02873
         BE    *+8                      YES, SKIP BLANK PAD             02874
         LM    R6,R7,BLANKS                                             02875
         TM    FLAGS,FMEMBER1           FIRST MEMBER PROCESSED?         02876
         LA    R1,MEMBER2                                               02877
         LA    R2,LMEMBER2                                              02878
         BO    MEM2ND                   YES                             02879
         XI    FLAGS,FMEMBER1+FMEMBER2                                  02880
         LM    R6,R7,BLANKS             CHANGE PAD FOR 1ST              02881
         LA    R1,MEMBER1                                               02882
         LA    R2,LMEMBER1                                              02883
MEM2ND   DS    0H                                                       02884
         SPACE                                                          02885
         MVI   0(R1),C' '               BLANK MEMBER AREA               02886
         MVC   1(7,R1),0(R1)                                            02887
         STH   R14,0(,R2)               STASH LENGTH                    02888
         SPACE                                                          02889
         LTR   R14,R14                  ONE BYTE MEMBER NAME?           02890
         BZ    VERCHAR                  YES, CAN'T BE HEX               02891
         CLC   =C'X''',0(R15)           BEGINS WITH  X' ?               02892
         BE    VERHEX                   YES, IS HEX MEMBER NAME         02893
         CLI   5(RPDL),8                TOO LONG?                       02894
         BNH   VERCHAR                  YES, IS CHARACTER NAME          02895
         SPACE                                                          02896
VERBAD   LA    R15,4                    SET ERROR RETURN CODE           02897
         B     VEREXIT                  GO TRY AGAIN                    02898
         SPACE                                                          02899
VERHEX   SR    R4,R4                    COUNT NIBBLES IN R4             02900
         LA    R5,0(R14,R15)            POINT TO LAST CHAR              02901
         CLI   0(R5),C''''              IS IT A QUOTE?                  02902
         BNE   VERBAD                   NO, INVALID SYNTAX              02903
         BCTR  R5,0                     BACK UP ONE CHAR                02904
         SR    R14,R14                  BXH INCREMENT                   02905
         BCTR  R14,0                                                    02906
         LA    R15,1(,R15)              POINT FRONT TO '                02907
         CR    R5,R15                   NULL STRING?                    02908
         BNH   VERBAD                   YES, INVALID SYNTAX             02909
         SPACE                                                          02910
VERHLOOP IC    R3,0(R5)                 GET CHAR IN REG 3               02911
         CLI   0(R5),C'A'               A-F?                            02912
         BL    VERBAD                   LOWER THAN 'A' IS BAD           02913
         CLI   0(R5),C'F'                                               02914
         BNH   VERAF                                                    02915
         CLI   0(R5),C'0'               0-9?                            02916
         BL    VERBAD                                                   02917
         CLI   0(R5),C'9'                                               02918
         BH    VERBAD                                                   02919
         SPACE                                                          02920
         B     *+8                      SKIP NEXT INS                   02921
VERAF    LA    R3,9(,R3)                UP LOW NIB FROM 1-5 TO A-F      02922
         SLL   R3,28                    GET NIBBLE IN UPPER FOUR        02923
         SRDL  R6,4                     REG 6 AND 7 ARE TARGET          02924
         OR    R6,R3                    ADD NIBBLE TO ALREADY GOT       02925
         LA    R4,1(,R4)                COUNT NIBBLES                   02926
         BXH   R5,R14,VERHLOOP          CHECK NEXT BYTE                 02927
         B     VERHLEND                 SKIP LITERAL POOL               02928
         SPACE                                                          02929
         LTORG                                                          02930
         SPACE                                                          02931
VERHLEND ST    R4,DOUBLE                CHECK IF NUM CHAR IS ODD        02932
         TM    DOUBLE+3,1               ODD NIBBLES?????                02933
         BZ    *+8                                                      02934
         SRDL  R6,4                     IF ODD NIBBLES SPECIFIED        02935
         SPACE 1                                                        02936
         STM   R6,R7,0(R1)              SAVE VALUE                      02937
         B     SKIPTHIS                 EXIT                            02938
         SPACE                                                          02939
VERCHAR  MVC   0(0,R1),0(R15)           PROCESS CHAR FORM OF MEM NAME   02940
         EX    R14,*-6                                                  02941
         SPACE 2                                                        02942
SKIPTHIS DS    0H                                                       02943
         SR    R15,R15                                                  02944
VEREXIT  EXIT                                                           02945
         EJECT                                                          02946
*                                                                       02947
*                                                                       02948
*        NEW ATTRIBUTES VALIDITY CHECK SUBROUTINE                       02949
*                                                                       02950
*                                                                       02951
         SPACE 2                                                        02952
VERATTR  ENTER VALCHECK                                                 02953
VERATTR4 DS    0H                                                       02954
         L     R15,0(,RPDL)                                             02955
         LH    R14,4(,RPDL)                                             02956
         SPACE 2                                                        02957
         LA    R3,ATTRNO                                                02958
         LA    R1,ATTRYES                                               02959
         SPACE                                                          02960
         LA    R2,L'NO                                                  02961
         CR    R14,R2                   CAN 'NO' OPTION BE PREFIXED?    02962
         BL    VERATTR1                 NO                              02963
         SPACE                                                          02964
         CLC   NO,0(R15)                'NO' OPTION PREFIXED?           02965
         BNE   VERATTR1                 NO                              02966
         SPACE                                                          02967
         AR    R15,R2                   ADJUST ATTRIBUTE ADDRESS        02968
         SR    R14,R2                   DECREMENT LENGTH                02969
         BZ    VERATTR0                 LENGTH ERROR                    02970
         LA    R1,ATTRNO                                                02971
         LA    R3,ATTRYES                                               02972
         SPACE 2                                                        02973
VERATTR1 DS    0H                                                       02974
         BCTR  R14,0                    DECREMENT LENGTH FOR EXECUTE    02975
         LA    R0,LATTR                 MAXIMUM ATTRIBUTE LENGTH        02976
         CR    R14,R0                                                   02977
         BNL   VERATTR0                 INVALID LENGTH                  02978
         SPACE 2                                                        02979
         SR    R0,R0                    NO FIRST ATTRIBUTE              02980
         SPACE                                                          02981
         LA    R2,ATTRTBL               TABLE OF CHANGEABLE ATTRIBUTES  02982
         SPACE                                                          02983
LOOPATTR DS    0H                                                       02984
         CLC   0(0,R15),0(R2)                                           02985
         EX    R14,*-6                                                  02986
         BE    VERATTR2                                                 02987
VERATTR5 DS    0H                                                       02988
         LA    R2,LATTRTBL(R2)                                          02989
         CLI   0(R2),X'FF'                                              02990
         BNE   LOOPATTR                                                 02991
         LTR   R2,R0                    PREVIOUS MATCH?                 02992
         BNZ   VERATTR3                 YES                             02993
         B     VERATTR0                 INVALID ATTRIBUTE               02994
         SPACE                                                          02995
VERATTR2 DS    0H                                                       02996
         LTR   R0,R0                    FIRST MATCH                     02997
         BNZ   VERATTRX                 NO                              02998
         SPACE                                                          02999
         LR    R0,R2                    SAVE ADDRESS                    03000
         B     VERATTR5                 CONTINUE SCAN                   03001
         SPACE 2                                                        03002
VERATTR3 DS    0H                                                       03003
         TM    LATTR(R2),X'40'          AUTH REQUEST?                   03004
         BZ    VERATTRY                                                 03005
         SPACE                                                          03006
         LA    R0,ATTRNO                TURN ON OR OFF?                 03007
         CR    R0,R1                                                    03008
         BE    VERATOFF                                                 03009
         SPACE 1                                                        03010
         OI    FLAGS+2,FAPFON           TURN ON                         03011
         B     EXITATT0                                                 03012
VERATOFF OI    FLAGS+2,FAPFOFF                                          03013
         B     EXITATT0                                                 03014
         SPACE                                                          03015
VERATTRY TM    LATTR(R2),X'80'          REVERSE MATCH?                  03016
         BZ    VERATTR6                 NO                              03017
         LR    R1,R3                    ALTERNATE BIT MASK              03018
VERATTR6 DS    0H                                                       03019
         OC    0(L'ATTRYES,R1),LATTR+1(R2) SET ATTRIBUTE STATUS FLAGS   03020
         SPACE 2                                                        03021
         OI    FLAGS,FATTR              INDICATE CHANGE ATTRIBUTES      03022
         SPACE                                                          03023
EXITATT0 SR    R15,R15                                                  03024
         SPACE                                                          03025
EXITATTR DS    0H                                                       03026
         EXIT                                                           03027
         SPACE 3                                                        03028
VERATTR0 DS    0H                                                       03029
         MVC   MSGTEXT1,MSGBADAT                                        03030
BADATTR  DS    0H                                                       03031
         LH    R1,MSGTEXT1                                              03032
         LA    R0,1(R1,R14)                                             03033
         STH   R0,MSGTEXT1                                              03034
         LA    R1,MSGTEXT1(R1)                                          03035
         MVC   0(0,R1),0(R15)                                           03036
         EX    R14,*-6                                                  03037
         SPACE 2                                                        03038
         MESSAGE MSGTEXT1                                               03039
         SPACE 2                                                        03040
         LA    R15,8                                                    03041
         B     EXITATTR                                                 03042
         SPACE 3                                                        03043
VERATTRX DS    0H                                                       03044
         MVC   MSGTEXT1,MSGDUPAT                                        03045
         B     BADATTR                                                  03046
         EJECT                                                          03047
*                                                                       03048
*                                                                       03049
*        INPUT DATA SET VALIDITY CHECK EXIT                             03050
*                                                                       03051
*                                                                       03052
         SPACE 3                                                        03053
VERDSN   ENTER VALCHECK                                                 03054
         CLEAR DSNAME                                                   03055
         SPACE 2                                                        03056
         CLEAR PASSWORD                                                 03057
         SPACE 2                                                        03058
         CLEAR VOLUME                                                   03059
         SPACE 2                                                        03060
         L     R15,0(,RPDL)             ADDR OF DSNAME                  03061
         LH    R14,4(,RPDL)             LENGTH OF DSNAME                03062
         STH   R14,DSNLEN                                               03063
         BCTR  R14,0                                                    03064
         MVC   DSNAME(0),0(R15)                                         03065
         EX    R14,*-6                  MOVE DSNAME TO AREA             03066
         SPACE 2                                                        03067
         TM    22(RPDL),X'80'           PASSWORD SUPPLIED?              03068
         BZ    NOPASS                   NO                              03069
         SPACE                                                          03070
         L     R15,16(,RPDL)                                            03071
         LH    R14,20(,RPDL)                                            03072
         BCTR  R14,0                                                    03073
         MVC   PASSWORD(0),0(R15)                                       03074
         EX    R14,*-6                  MOVE PASSWORD TO AREA           03075
NOPASS   DS    0H                                                       03076
         SPACE 3                                                        03077
         OI    FLAGS+1,FQUOTE           ASSUME DSNAME QUOTED            03078
         TM    6(RPDL),X'40'            IS DSNAME IN QUOTES?            03079
         BO    NOUSERID                 YES                             03080
         XI    FLAGS+1,FQUOTE           NO, MUST QUALIFY NAME           03081
NOUSERID DS    0H                                                       03082
         SPACE 3                                                        03083
         SR    R15,R15                                                  03084
         SPACE                                                          03085
         EXIT                                                           03086
         EJECT                                                          03087
*                                                                       03088
*        VOLUME SERIAL VALIDITY CHECK                                   03089
*                                                                       03090
         SPACE 2                                                        03091
VERVOL   ENTER VALCHECK                                                 03092
         LH    R15,4(,RPDL)                                             03093
         L     R1,0(,RPDL)                                              03094
         BCTR  R15,0                                                    03095
         SPACE                                                          03096
         MVC   VOLUME(0),0(R1)                                          03097
         EX    R15,*-6                                                  03098
         SPACE 2                                                        03099
         SR    R15,R15                                                  03100
         EXIT                                                           03101
         EJECT                                                          03102
*                                                                       03103
*        FREE DATA SET NO LONGER REQUIRED                               03104
*                                                                       03105
         SPACE 2                                                        03106
DEALLOC  DS    0H                                                       03107
         ST    R14,R14LINK                                              03108
         TM    FLAGS+2,FPERMDS          DATA SET PERMANENTLY ALLOCATED? 03109
         BO    DEALLOC1                 YES, SKIP EXPLICIT DEALLOCATION 03110
         SPACE                                                          03111
         LA    R1,DAIRBLK                                               03112
         XC    DAIRBLK(LDAIRBLK),DAIRBLK                                03113
         USING DAPB18,R1                                                03114
         MVC   DA18DDN,DDNAME           DE-ALLOCATE THE DATA SET        03115
         LA    R0,X'18'                                                 03116
         STH   R0,DA18CD                                                03117
         SPACE                                                          03118
         BAL   R14,CALLDAIR                                             03119
         SPACE 2                                                        03120
DEALLOC1 DS    0H                                                       03121
         NI    FLAGS+2,255-FPERMDS      CLEAR DATA SET STATUS           03122
         L     R14,R14LINK                                              03123
         BR    R14                                                      03124
         EJECT                                                          03125
*                                                                       03126
*        PARSE CLEANUP ROUTINE                                          03127
*                                                                       03128
         SPACE 3                                                        03129
FREEPDL  DS    0H                                                       03130
         SPACE                                                          03131
         ST    R14,R14SAVE                                              03132
         SPACE                                                          03133
         L     R1,ADDRPDL               ADDR OF PDL                     03134
         LA    R1,0(R1)                                                 03135
         LTR   R1,R1                    DOES ONE EXIST?                 03136
         BCR   8,R14                    NO, EXIT                        03137
         SPACE                                                          03138
         IKJRLSA ADDRPDL                RELEASE THE STORAGE             03139
         SPACE                                                          03140
         L     R14,R14SAVE                                              03141
         XC    ADDRPDL,ADDRPDL                                          03142
         BR    R14                                                      03143
         EJECT                                                          03144
*                                                                       03145
*        DATA SET ALLOCATION SUBROUTINE                                 03146
*                                                                       03147
         SPACE 2                                                        03148
ALLOCATE DS    0H                                                       03149
         ST    R14,R14ALLOC             SAVE LINKAGE REGISTER           03150
         NI    FLAGS+2,255-FPERMDS      CLEAR DATA SET STATUS           03151
         SPACE 2                                                        03152
RETRY    DS    0H                                                       03153
         LA    R1,DAIRBLK                                               03154
         XC    DAIRBLK(LDAIRBLK),DAIRBLK                                03155
         USING DAPB08,R1                                                03156
         SPACE                                                          03157
         MVC   DA08PSWD,PASSWORD                                        03158
         SPACE                                                          03159
         TM    FLAGS+1,FQUOTE           QUALIFY DATA SET NAME?          03160
         BO    NQUALIFY                 NO                              03161
         OI    DA08CTL,DA08UID                                          03162
NQUALIFY DS    0H                                                       03163
         SPACE 2                                                        03164
         LA    R0,X'08'                 DATA SET ALLOCATION CODE        03165
         STH   R0,DA08CD                                                03166
         SPACE                                                          03167
         LA    R0,DSNLEN                ADDR OF DSNAME FIELD            03168
         ST    R0,DA08PDSN                                              03169
         SPACE                                                          03170
         CLEAR DA08DDN                                                  03171
         SPACE                                                          03172
         CLEAR DA08UNIT                 NO UNIT REQUESTED               03173
         SPACE                                                          03174
         MVC   DA08SER,VOLUME           VOLUME SPECIFIED                03175
         SPACE                                                          03176
         CLEAR DA08MNM                  NO MEMBER NAME                  03177
         SPACE                                                          03178
         MVI   DA08DSP1,DA08SHR         DISP=(SHR,KEEP,KEEP)            03179
         MVI   DA08DPS2,DA08KEEP                                        03180
         MVI   DA08DPS3,DA08KEP                                         03181
         SPACE                                                          03182
         BAL   R14,CALLDAIR                                             03183
         LA    R1,DAIRBLK                                               03184
         LTR   R15,R15                  SUCCESSFUL?                     03185
         BNZ   DAIRFAIL                 NO, ERROR                       03186
         SPACE 2                                                        03187
         MVC   DDNAME,DA08DDN           SAVE DDNAME                     03188
         SPACE                                                          03189
         TM    DA08DSO,X'02'            IS DATA SET DSORG=PO?           03190
         BO    STATALOC                 YES, DETERMINE DATA SET STATUS  03191
         SPACE 3                                                        03192
         MVC   DDNAME1,DDNAME           DDNAME TO DE-ALLOCATE           03193
         BAL   R14,DEALLOC              FREE THE DATA SET               03194
         SPACE 2                                                        03195
         MESSAGE MSGNLIB                                                03196
         SPACE 2                                                        03197
RECOVERY DS    0H                                                       03198
ASKAGAIN DS    0H                                                       03199
        $PUTGET MSGRETRY,ATTN=NOTALLOC                                  03200
         SPACE 2                                                        03201
         TM    FLAGS,FNULL              USER WANT ANOTHER DATA SET?     03202
         BO    ASKAGAIN                 NULL REPLY, ASK AGAIN           03203
         SPACE                                                          03204
         L     R1,MAINPCL               YES, INVOKE PARSE               03205
         BAL   R14,GOPARSE                                              03206
         B     NOTALLOC                 EXIT - PARSE FAILURE            03207
         B     RETRY                    SUCCESSFUL - RETRY ALLOCATION   03208
         SPACE 2                                                        03209
STATALOC DS    0H                                                       03210
         XC    DAIRBLK(LDAIRBLK),DAIRBLK                                03211
         USING DAPB00,R1                BASE FOR DSE STATUS REQUEST     03212
         MVC   DA00DDN,DDNAME           DDNAME FOR STATUS REQUEST       03213
         BAL   R14,CALLDAIR             GET DATA SET STATUS             03214
         LTR   R15,R15                  SUCESSFUL?                      03215
         LA    R1,DAIRBLK               RESTORE ADDR OF PARM AREA       03216
         LA    R15,4                    RETURN OFFSET                   03217
         BNZ   EXITALOC                 NO, JUST RETURN                 03218
         TM    DA00FLG,DA00PERM         DATA SET PERM ALLOCATED?        03219
         BZ    EXITALOC                 NO, EXIT                        03220
         OI    FLAGS+2,FPERMDS          YES, INDICATE PERMANENT DATASET 03221
         B     EXITALOC                                                 03222
         SPACE 2                                                        03223
NOTALLOC DS    0H                                                       03224
         SR    R15,R15                  ERROR EXIT - NOT ALLOCATED      03225
         SPACE 3                                                        03226
EXITALOC DS    0H                                                       03227
         L     R14,R14ALLOC                                             03228
         B     0(R14,R15)               EXIT FROM ALLOCATION            03229
         EJECT                                                          03230
*                                                                       03231
*        DYNAMIC ALLOCATION INVOCATION SUBROUTINE                       03232
*                                                                       03233
         SPACE 3                                                        03234
CALLDAIR DS    0H                                                       03235
         ST    R14,R14SAVE              SAVE LINKAGE REGISTER           03236
         SPACE 2                                                        03237
         LA    R1,PARMLIST              BUILD DYNAMIC ALLOC PARM LIST   03238
         USING DAPL,R1                                                  03239
         SPACE                                                          03240
         MVC   DAPLUPT,ADDRUPT                                          03241
         MVC   DAPLECT,ADDRECT                                          03242
         MVC   DAPLPSCB,ADDRPSCB                                        03243
         SPACE                                                          03244
         LA    R0,ATTNECB                                               03245
         MVI   ATTNECB,0                                                03246
         ST    R0,DAPLECB                                               03247
         SPACE                                                          03248
         LA    R0,DAIRBLK                                               03249
         ST    R0,DAPLDAPB                                              03250
         SPACE 2                                                        03251
         LINK  EPLOC=IKJDAIR                                            03252
         SPACE 2                                                        03253
         L     R14,R14SAVE              RESTORE LINKAGE REGISTER        03254
         BR    R14                      EXIT                            03255
         EJECT                                                          03256
DAIRFAIL DS    0H                                                       03257
         NI    FLAGS+1,255-FNORETRY                                     03258
         SPACE 2                                                        03259
         LA    R14,MAXDAIR                                              03260
         CR    R15,R14                  CHECK DAIR RETURN CODE          03261
         BH    DAIRBAD                  VERY BAD ERROR                  03262
         SPACE 3                                                        03263
         B     *(R15)                   DAIR ERROR PROCESSING           03264
         B     DAIRBAD                  RC=04 INVALID DAIR PARAMETERS   03265
         B     DAIRCAM                  RC=08 ERROR IN CATALOG MGMT     03266
         B     DAIRDYN                  RC=12 ERROR IN DYNAMIC ALLOC    03267
         B     DAIRFULL                 RC=16 NO SPACE IN TIOT          03268
MAXDAIR  EQU   16                                                       03269
         SPACE 3                                                        03270
DAIRFULL LA    R1,MSGFULL               ERROR MSG                       03271
         LA    R0,MSGFULL1              SECOND LEVEL MSG                03272
         B     ALLOCBAD                                                 03273
         EJECT                                                          03274
*                                                                       03275
*        PROCESS ERRORS FROM CATALOG MANAGEMENT                         03276
*                                                                       03277
         SPACE 2                                                        03278
DAIRCAM  DS    0H                                                       03279
         USING DAPB08,R1                                                03280
         SPACE                                                          03281
         LH    R15,DA08CTRC             GET CAM RETURN CODE             03282
         LA    R14,MAXCAMCD             MAX CAM ERROR CODE              03283
         CR    R15,R14                                                  03284
         BH    DAIRCAMX                 IF DISASTER ERROR CODE          03285
         SPACE                                                          03286
         B     *(R15)                   PROCESS ERROR CODE              03287
         B     CAMERR4                  04 - VOLUME NOT MOUNTED         03288
         B     CAMERR8                  08 - INVALID CATALOG STRUCTURE  03289
         B     CAMERR12                 12 -     ''          ''         03290
         B     CAMERR16                 16                              03291
         B     CAMERR20                 20                              03292
MAXCAMCD EQU   20                                                       03293
         SPACE 3                                                        03294
CAMERR4  LA    R1,MSGVOL                LAST PART OF 1ST LEVEL MSG      03295
CAMERROR SR    R0,R0                    NO SECOND LEVEL MSG             03296
         B     ALLOCERR                 PUT OUT ERROR MSG               03297
         SPACE 2                                                        03298
CAMERR8  DS    0H                                                       03299
         LA    R1,MSGNOCAT              MSG 'DATA SET NOT CATALOGED'    03300
         B     CAMERROR                                                 03301
CAMERR16 DS    0H                                                       03302
CAMERR12 LA    R1,MSGINDEX              INCONSISTENT CTLG STRUCTURE     03303
         LA    R0,MSGDSFMT                                              03304
         B     ALLOCERR                                                 03305
         SPACE 2                                                        03306
CAMERR20 DS    0H                                                       03307
         LA    R1,MSGSYNTX              INVALID DSNAME SYNTAX'          03308
         LA    R0,MSGDSN                                                03309
         B     ALLOCERR                                                 03310
         SPACE 3                                                        03311
DAIRCAMX DS    0H                                                       03312
         LH    R1,MSGCATER              LEN OF ERROR MSG                03313
         SPACE                                                          03314
         MVC   MSGTEXT2(0),MSGCATER                                     03315
         EX    R1,*-6                                                   03316
         SPACE                                                          03317
         LA    R1,MSGTEXT2(R1)                                          03318
         CVD   R15,DOUBLE                                               03319
         OI    DOUBLE+7,X'0F'                                           03320
         UNPK  0(2,R1),DOUBLE                                           03321
         LA    R1,2(R1)                                                 03322
         LA    R0,MSGTEXT2                                              03323
         SR    R1,R0                                                    03324
         SLL   R1,16                                                    03325
         ST    R1,MSGTEXT2                                              03326
         SPACE 2                                                        03327
         SR    R1,R1                                                    03328
         B     ALLOCBAD                                                 03329
         EJECT                                                          03330
*                                                                       03331
*        PROCESS ERRORS FROM DYNAMIC ALLOCATION                         03332
*                                                                       03333
         SPACE 3                                                        03334
DAIRDYN  DS    0H                                                       03335
         USING DAPB08,R1                                                03336
         LH    R15,DA08DARC   RETURN CODE FROM DYNAMIC ALLOCATION       03337
         SPACE                                                          03338
         LA    R14,DYNMSGS    START OF MSG LOOKUP TABLE                 03339
         LA    R1,DYNMSGE     LAST MSG IN TABLE                         03340
         SPACE 2                                                        03341
DAIRDYN1 CH    R15,0(R14)     THIS ERROR CODE?                          03342
         BE    DAIRDYN2       YES                                       03343
         SPACE                                                          03344
         TM    2(R14),X'80'   IS SECOND LEVEL MSG THERE?                03345
         LA    R0,6           LENGTH FOR SINGLE MSG                     03346
         BZ    DAIRDYN3       NO                                        03347
         LA    R0,10          LENGTH FOR 2 MSG LEVELS                   03348
         SPACE 2                                                        03349
DAIRDYN3 BXLE  R14,R0,DAIRDYN1                                          03350
         SPACE 2                                                        03351
DAIRBAD  DS    0H                                                       03352
         SR    R1,R1          DEFAULT TO FIRST LEVEL MSG                03353
         LH    R14,MSGDYNER                                             03354
         MVC   MSGTEXT2(0),MSGDYNER                                     03355
         EX    R14,*-6        CREATE MSG - DYNAMIC ALLOCATION FAILURE   03356
         STH   R15,DOUBLE                                               03357
         LA    R14,MSGTEXT2(R14)                                        03358
         UNPK  0(5,R14),DOUBLE(3)                                       03359
         TR    0(4,R14),TRTABLE                                         03360
         LA    R0,MSGTEXT2-4                                            03361
         SR    R14,R0                                                   03362
         SLL   R14,16                                                   03363
         ST    R14,MSGTEXT2                                             03364
         LA    R0,MSGTEXT2                                              03365
         B     ALLOCBAD                                                 03366
         SPACE 3                                                        03367
DAIRDYN2 MVC   DOUBLE(8),2(R14) MOVE ADDR OF ERROR MSGS                 03368
         L     R1,DOUBLE      ADDR OF FIRST LEVEL MSG                   03369
         SR    R0,R0          DEFAULT - NO LEVEL 2 MSG                  03370
         LTR   R1,R1          ANY SECOND LEVEL?                         03371
         LA    R1,0(R1)       FIRST LEVEL MSG ADDR                      03372
         BNM   DAIRDYN4       ONLY LEVEL 1                              03373
         L     R0,DOUBLE+4    SECOND LEVEL MSG                          03374
DAIRDYN4 DS    0H                                                       03375
         B     ALLOCERR                                                 03376
         SPACE 3                                                        03377
DYNMSGS  DS    0H                                                       03378
         DC    X'6708',X'00',AL3(MSG6708)                               03379
         DC    X'0210',X'80',AL3(MSG210),AL4(MSG210X)                   03380
         DC    X'0214',X'80',AL3(MSG214),AL4(MSG214X)                   03381
         DC    X'0218',X'80',AL3(MSG218),AL4(MSG218X)                   03382
         DC    X'021C',X'80',AL3(MSG21C),AL4(MSG21CX)                   03383
         DC    X'0334',X'00',AL3(MSG334)                                03384
DYNMSGE  DS    0H                                                       03385
         DC    X'041C',X'80',AL3(0),AL4(MSG41CX)                        03386
         EJECT                                                          03387
*                                                                       03388
*                                                                       03389
*        ALLOCATION ERROR MESSAGE SUBROUTINE                            03390
*                                                                       03391
*                                                                       03392
         SPACE 3                                                        03393
ALLOCBAD DS    0H                                                       03394
         OI    FLAGS+1,FNORETRY INDICATE NO ALLOCATION RETRY            03395
         SPACE                                                          03396
ALLOCERR DS    0H                                                       03397
         LA    R15,MSGTEXT1+4  BUFFER ADDRESS                           03398
         MVC   0(L'MSG1,R15),MSG1 MOVE 'DATA SET ' MSG TO BUFFER        03399
         LH    R14,DSNLEN     LENGTH OF DSNAME                          03400
         LA    R15,L'MSG1(R15)                                          03401
         SPACE                                                          03402
         MVC   0(0,R15),DSNAME                                          03403
         EX    R14,*-6        MOVE DSNAME TO BUFFER                     03404
         AR    R15,R14                                                  03405
         SPACE 2                                                        03406
         MVC   0(L'MSG3,R15),MSG3 MOVE ' NOT ALLOCATED, ' MSG TO BUFFER 03407
         LA    R15,L'MSG3(R15)                                          03408
         SPACE 2                                                        03409
         LTR   R1,R1          DEFAULT FIRST LEVEL MSG?                  03410
         BNZ   ALOCERR4       NO                                        03411
         SPACE                                                          03412
         LA    R1,MSG4        YES                                       03413
         SPACE                                                          03414
ALOCERR4 LH    R14,0(R1)      GET MSG LEN + 4                           03415
         SPACE                                                          03416
         MVC   0(0,R15),4(R1)                                           03417
         EX    R14,*-6                                                  03418
         AR    R15,R14                                                  03419
         LA    R14,MSGTEXT1+4                                           03420
         SR    R15,R14                                                  03421
         SLL   R15,16                                                   03422
         ST    R15,MSGTEXT1   STORE MESSAGE LENGTH                      03423
         SPACE                                                          03424
         MESSAGE MSGTEXT1,(R0)                                          03425
         SPACE 2                                                        03426
         TM    FLAGS+1,FNORETRY BYPASS ALLOCATION RECOVERY?             03427
         BO    NOTALLOC       YES                                       03428
         B     RECOVERY       NO, THEN ATTEMPT RETRY                    03429
         EJECT                                                          03430
MESSAGE0 DS    0H                                                       03431
         SR    R0,R0                    NO SECONDARY MESSAGE            03432
         SPACE 2                                                        03433
MESSAGE  DS    0H                                                       03434
         ST    R14,R14SAVE    SAVE LINKAGE REGISTER                     03435
         SPACE                                                          03436
         LTR   R0,R0          SECOND LEVEL MSG?                         03437
         BZ    ERRORM1        NO                                        03438
         SPACE                                                          03439
         MVC   MSGTEXT1,0(R1) INSURE MSG IN WORK AREA                   03440
         LA    R1,MSGTEXT1                                              03441
         SPACE                                                          03442
         LH    R14,0(R1)      LENGTH OF FIRST LEVEL MSG                 03443
         LA    R15,0(R14,R1)  ADDR OF END OF MSG                        03444
         LA    R14,1(R14)     JUMP MSG LENGTH                           03445
         STH   R14,0(R1)                                                03446
         MVI   0(R15),C'+'    INDICATE SECOND LEVEL MSG EXISTS          03447
         SPACE 2                                                        03448
         SR    R14,R14        CLEAR CHAIN FIELD                         03449
         LA    R15,1          ONE SEGMENT IN 2ND MSG                    03450
         STM   R14,R0,PUTOLD2 CREATE SECOND-LEVEL                       03451
*                             OUTPUT LINE DESCRIPTOR ('OLD')            03452
         LA    R0,PUTOLD2                                               03453
         SPACE 3                                                        03454
ERRORM1  LR    R14,R0         NEXT 'OLD' ADDR OR ZERO                   03455
         LA    R15,1          ONE SEGMENT                               03456
         LR    R0,R1          MSG ADDR                                  03457
         STM   R14,R0,PUTOLD1 FIRST LEVEL 'OLD'                         03458
         SPACE                                                          03459
         LA    R1,PARMLIST                                              03460
         USING IOPL,R1                                                  03461
         SPACE                                                          03462
         MVC   IOPLECT,ADDRECT                                          03463
         MVC   IOPLUPT,ADDRUPT                                          03464
         SPACE                                                          03465
         LA    R0,ATTNECB                                               03466
         ST    R0,IOPLECB                                               03467
         MVI   ATTNECB,0                                                03468
         SPACE 3                                                        03469
         L     R15,ADDRPUTL                                             03470
         XC    PARMLIST+16(4),PARMLIST+16                               03471
         PUTLINE PARM=PARMLIST+16,ENTRY=(15),MF=(E,(1)),               X03472
               OUTPUT=(PUTOLD1,TERM,MULTLVL,INFOR)                      03473
         SPACE 3                                                        03474
         L     R14,R14SAVE                                              03475
         BR    R14                                                      03476
         EJECT                                                          03477
*                                                                       03478
*                                                                       03479
*        PUTLINE PROCESSING                                             03480
*                                                                       03481
*                                                                       03482
         SPACE 3                                                        03483
$PUTLINE DS    0H                                                       03484
         TM    ATTNECB,X'40'  ATTN OCCUR?                               03485
         BCR   1,R14          YES, IMMED RETURN                         03486
         ST    R14,R14PUTL                                              03487
         BAL   R14,FREEBUFF                                             03488
         SPACE                                                          03489
         LR    R14,R1         SAVE DATA LINE POINTER                    03490
         SPACE                                                          03491
         LA    R1,PUTLPARM                                              03492
         USING IOPL,R1                                                  03493
         MVC   IOPLECT,ADDRECT                                          03494
         MVC   IOPLUPT,ADDRUPT                                          03495
         SPACE                                                          03496
         LA    R0,ATTNECB                                               03497
         ST    R0,IOPLECB                                               03498
         SPACE                                                          03499
         L     R15,ADDRPUTL                                             03500
         XC    IOPLEND(16),IOPLEND                                      03501
         LR    R0,R14         ADDR OF DATA LINE                         03502
         SPACE                                                          03503
         PUTLINE PARM=IOPLEND,ENTRY=(15),MF=(E,(1)),                   X03504
               OUTPUT=((0),TERM,SINGLE,DATA),                          X03505
               TERMPUT=(EDIT,WAIT,NOHOLD,NOBREAK)                       03506
         SPACE                                                          03507
         TM    ATTNECB,X'40'  ATTN OCCUR?                               03508
         BO    PUTLINE2       YES                                       03509
         SPACE                                                          03510
         LA    R14,4                                                    03511
         CR    R15,R14        CHECK COMPLETION                          03512
         BH    PUTERROR       PUTLINE ERROR                             03513
         LR    R15,R14                                                  03514
         BL    PUTLINE1                                                 03515
         SPACE                                                          03516
PUTLINE2 DS    0H                                                       03517
         SR    R15,R15                                                  03518
         SPACE                                                          03519
PUTLINE1 DS    0H                                                       03520
         L     R14,R14PUTL                                              03521
         B     0(R14,R15)                                               03522
         EJECT                                                          03523
*                                                                       03524
*                                                                       03525
*        PUTGET PROCESSING                                              03526
*                                                                       03527
*                                                                       03528
         SPACE 3                                                        03529
$PUTGET  DS    0H                                                       03530
         TM    ATTNECB,X'40'  ATTN OCCUR?                               03531
         BCR   1,R14          YES, IMMED RETURN                         03532
         ST    R14,R14PTGT                                              03533
         BAL   R14,FREEBUFF                                             03534
         NI    FLAGS,255-FNULL                                          03535
         SPACE                                                          03536
         LA    R0,1           ONLY ONE SEGMENT                          03537
         STM   R0,R1,PUTOLD1                                            03538
         SPACE                                                          03539
         LA    R1,PTGTPARM                                              03540
         USING IOPL,R1                                                  03541
         MVC   IOPLECT,ADDRECT                                          03542
         MVC   IOPLUPT,ADDRUPT                                          03543
         SPACE                                                          03544
         LA    R0,ATTNECB                                               03545
         ST    R0,IOPLECB                                               03546
         SPACE                                                          03547
         L     R15,ADDRPTGT                                             03548
         XC    IOPLEND(16),IOPLEND                                      03549
         SPACE 2                                                        03550
         PUTGET PARM=IOPLEND,MF=(E,(1)),ENTRY=(15),                    X03551
               OUTPUT=(PUTOLD1,SINGLE,MODE),                           X03552
               TERMPUT=(EDIT,WAIT,NOHOLD,NOBREAK),                     X03553
               TERMGET=(EDIT,WAIT)                                      03554
         SPACE                                                          03555
         LTR   R15,R15                  ERASE SCREEN ONLY ON ZERO RC    03556
         BNZ   $PUTGETA                                                 03557
*        SCREEN ,                       ERASE SCREEN                    03558
         SPACE                                                          03559
$PUTGETA LA    R14,8                                                    03560
         CR    R15,R14                                                  03561
         BH    GETERROR       PUTGET ERROR                              03562
         SR    R15,R15                                                  03563
         TM    ATTNECB,X'40'  ATTN OCCUR?                               03564
         BO    PUTGET1        YES                                       03565
         SPACE                                                          03566
         LA    R1,PTGTPARM                                              03567
         LA    R1,IOPLEND                                               03568
         USING PGPB,R1                                                  03569
         L     R1,PGPBIBUF                                              03570
         LA    R0,4                                                     03571
         CH    R0,0(R1)       IS THIS A NULL LINE                       03572
         ST    R1,ADDRCBUF                                              03573
         BL    NOTNULL        NO                                        03574
         OI    FLAGS,FNULL    INDICATE NULL LINE                        03575
NOTNULL  DS    0H                                                       03576
         LA    R15,4                                                    03577
         SPACE                                                          03578
PUTGET1  DS    0H                                                       03579
         L     R14,R14PTGT                                              03580
         B     0(R14,R15)                                               03581
         EJECT                                                          03582
*                                                                       03583
*        DCB OPEN EXIT                                                  03584
*                                                                       03585
*                                                                       03586
         SPACE 2                                                        03587
OPENEXIT DS    0H                                                       03588
         USING IHADCB,R1                                                03589
         NI    FLAGS,255-FLOADMOD                                       03590
         TM    DCBRECFM,X'C0' IS DATA SET IN LOAD MODULE FORMAT?        03591
         BNO   OPEN1          NO, NOT RECFM=U                           03592
         OI    FLAGS,FLOADMOD INDICATE LOAD MODULE                      03593
OPEN1    DS    0H                                                       03594
         OC    BUFFADDR,BUFFADDR BUFFER PRESENT?                        03595
         BCR   7,R14          YES                                       03596
         SPACE                                                          03597
         LH    R2,DCBBLKSI    GET SIZE OF BUFFER                        03598
         MVC   LRECL,DCBLRECL                                           03599
         LR    R3,R14                                                   03600
         GETMAIN EC,LV=(R2),SP=0,A=BUFFADDR,MF=(E,PARMLIST)             03601
         LR    R14,R3                                                   03602
         LTR   R15,R15        SUCESSFUL?                                03603
         BZ    OPEN2          YES                                       03604
         XC    BUFFADDR,BUFFADDR                                        03605
OPEN2    DS    0H                                                       03606
         STH   R2,BUFFSIZE                                              03607
         BR    R14                                                      03608
         DROP  R1                                                       03609
         EJECT                                                          03610
*                                                                       03611
*                                                                       03612
*        P A R S E   C O N T R O L   L I S T                            03613
*                                                                       03614
*                                                                       03615
         SPACE 3                                                        03616
         PRINT NOGEN                                                    03617
PCLMAIN  IKJPARM DSECT=MAINPDL                                          03618
INPUTDSN IKJPOSIT DSNAME,VALIDCK=VERDSN,                               $03619
               PROMPT='NAME OF DATA SET',                              $03620
               HELP=('NAME OF THE PARTITIONED DATA SET TO BE PROCESSED'$03621
               )                                                        03622
OPTVOL   IKJKEYWD                                                       03623
         IKJNAME 'VOLUME',SUBFLD=$VOLUME                                03624
$VOLUME  IKJSUBF                                                        03625
VOLNAME  IKJIDENT 'VOLUME NAME',MAXLNTH=6,FIRST=ALPHANUM,              X03626
               OTHER=ALPHANUM,VALIDCK=VERVOL,                          X03627
               PROMPT='VOLUME NAME',                                   X03628
               HELP=('VOLUME WHERE DATA SET RESIDES')                   03629
         IKJENDP                                                        03630
         SPACE                                                          03631
PCLDSPLY IKJPARM DSECT=PDLDSPLY                                         03632
PCLD1    IKJIDENT 'MEMBER NAME',MAXLNTH=19,                            $03633
               FIRST=ALPHA,OTHER=ANY,                                  $03634
               VALIDCK=VERMEMBR                                         03635
PCLD2    IKJIDENT 'MEMBER NAME',MAXLNTH=19,                            $03636
               FIRST=ALPHA,OTHER=ANY,                                  $03637
               VALIDCK=VERMEMBR                                         03638
         IKJENDP                                                        03639
         SPACE                                                          03640
PCLALIAS IKJPARM DSECT=PDLALIAS                                         03641
PCLAL1   IKJIDENT 'MEMBER NAME',FIRST=ALPHA,OTHER=ANY,                 $03642
               PROMPT='CURRENT MEMBER NAME',                           $03643
               HELP=('NAME OF THE MEMBER TO BE ASSIGNED AN ALIAS'),    $03644
               VALIDCK=VERMEMBR,                                       $03645
               MAXLNTH=19                                               03646
PCLAL2   IKJIDENT 'MEMBER NAME',FIRST=ALPHA,OTHER=ANY,                 $03647
               PROMPT='ALIAS NAME',                                    $03648
               HELP=('NAME TO BE ASSIGNED AS AN ALIAS'),               $03649
               VALIDCK=VERMEMBR,                                       $03650
               MAXLNTH=19                                               03651
         IKJENDP                                                        03652
         SPACE                                                          03653
PCLDELET IKJPARM DSECT=PDLDELET                                         03654
PCLS1    IKJIDENT 'MEMBER NAME',FIRST=ALPHA,OTHER=ANY,                 $03655
               PROMPT='MEMBER TO BE DELETED',                          $03656
               HELP=('NAME OF THE MEMBER TO BE SCRATCHED'),            $03657
               VALIDCK=VERMEMBR,                                       $03658
               MAXLNTH=19                                               03659
         IKJENDP                                                        03660
         SPACE                                                          03661
PCLLIST  IKJPARM DSECT=PDLLIST                                          03662
PCLL1    IKJIDENT 'MEMBER NAME',FIRST=ALPHA,OTHER=ANY,                 $03663
               PROMPT='MEMBER TO BE LISTED',                           $03664
               HELP=('NAME OF THE MEMBER TO BE DISPLAYED'),            $03665
               VALIDCK=VERMEMBR,                                       $03666
               MAXLNTH=19                                               03667
         IKJENDP                                                        03668
         SPACE                                                          03669
PCLRENAM IKJPARM DSECT=PDLRENAM                                         03670
PCLREN1  IKJIDENT 'MEMBER NAME',FIRST=ALPHA,OTHER=ANY,                 $03671
               PROMPT='CURRENT MEMBER NAME',                           $03672
               HELP=('NAME OF THE MEMBER TO BE RENAMED'),              $03673
               VALIDCK=VERMEMBR,                                       $03674
               MAXLNTH=19                                               03675
PCLREN2  IKJIDENT 'MEMBER NAME',FIRST=ALPHA,OTHER=ANY,                 $03676
               PROMPT='NEW MEMBER NAME',                               $03677
               HELP=('NEW NAME OF THE MEMBER'),                        $03678
               VALIDCK=VERMEMBR,                                       $03679
               MAXLNTH=19                                               03680
         IKJENDP                                                        03681
         SPACE                                                          03682
PCLMAP   IKJPARM DSECT=PDLMAP                                           03683
PCLM1    IKJIDENT 'MEMBER NAME',FIRST=ALPHA,OTHER=ANY,                 $03684
               PROMPT='MEMBER TO BE MAPPED',                           $03685
               HELP=('NAME OF THE MEMBER FOR WHICH A LOAD MODULE MAP IS$03686
                TO BE PRODUCED'),                                      $03687
               VALIDCK=VERMEMBR,                                       $03688
               MAXLNTH=19                                               03689
         IKJENDP                                                        03690
         SPACE                                                          03691
PCLATTR  IKJPARM DSECT=PDLATTR                                          03692
PCLAT1   IKJIDENT 'MEMBER NAME',FIRST=ALPHA,OTHER=ANY,                 $03693
               PROMPT='MEMBER NAME',                                   $03694
               HELP=('NAME OF THE MEMBER FOR WHICH THE ATTRIBUTES ARE T$03695
               TO BE LISTED'),                                         $03696
               VALIDCK=VERMEMBR,                                       $03697
               MAXLNTH=19                                               03698
*        AGO   .$00001        NO SUPPORT FOR RELEASE 20                 03699
PCLAT2   IKJIDENT 'NEW ATTRIBUTES',LIST,FIRST=ALPHA,OTHER=ALPHA,       $03700
               VALIDCK=VERATTR,MAXLNTH=19,                             $03701
               HELP=('THE NEW ATRIBUTES TO BE ASSIGNED TO THIS LOAD MOD$03702
               ULE','NULLIFY ATTRIBUTES BY PREFIXING ''NO'' TO THE ATTR$03703
               IBUTE NAME')                                             03704
.$00001  ANOP                                                           03705
         IKJENDP                                                        03706
         SPACE                                                          03707
PCLHIST  IKJPARM DSECT=PDLHIST                                          03708
PCLH1    IKJIDENT 'MEMBER NAME',FIRST=ALPHA,OTHER=ANY,                 $03709
               PROMPT='MEMBER NAME',                                   $03710
               HELP=('NAME OF THE LOAD MODULE FOR WHICH THE HISTORY IS $03711
               TO BE LISTED'),                                         $03712
               VALIDCK=VERMEMBR,                                       $03713
               MAXLNTH=19                                               03714
         IKJENDP                                                        03715
         PRINT GEN                                                      03716
         EJECT                                                          03717
*                                                                       03718
*                                                                       03719
*        CONSTANTS                                                      03720
*                                                                       03721
*                                                                       03722
         SPACE 2                                                        03723
CVT      EQU   16                                                       03724
CVTPCNVT EQU   28                                                       03725
         SPACE                                                          03726
DEBXTNT# EQU   16             OFFSET IN DEB FOR # OF EXTENTS            03727
DEBEXTNT EQU   32             OFFSET IN DEB FOR D.A. EXTENT ENTRY       03728
DEBAMLNG EQU   16             SIZE OF DIRECT ACCESS EXTENT IN DEB       03729
         SPACE 2                                                        03730
UCBVOLI  EQU   28             OFFSET IN UCB FOR VOLUME SERIAL           03731
         SPACE 2                                                        03732
DS1LSTAR EQU   98             OFFSET IN DSCB FOR LAST TTR USED          03733
         SPACE 2                                                        03734
         PRINT NOGEN                                                    03735
         DS    0F                                                       03736
CORESIZE DC    AL1(1),AL3(LENWORK)                                      03737
MAINPCL  DC    A(PCLMAIN)     PARSE LIST FOR DATA SET NAME              03738
         SPACE 3                                                        03739
IKJDAIR  DC    CL8'IKJDAIR'   DYNAMIC ALLOCATION INTERFACE ROUTINE      03740
IKJPUTL  DC    CL8'IKJPUTL'   PUTLINE SERVICE ROUTINE                   03741
IKJGETL  DC    CL8'IKJGETL'   GETLINE SERVICE ROUTINE                   03742
IKJPTGT  DC    CL8'IKJPTGT'   PUTGET SERVICE ROUTINE                    03743
IKJSCAN  DC    CL8'IKJSCAN'   COMMAND SCAN SERVICE ROUTINE              03744
IKJPARS  DC    CL8'IKJPARS'   PARSE SERVICE ROUTINE                     03745
         SPACE 2                                                        03746
STAE     STAE  0,CT,MF=L      PATTERN STAE EXIT                         03747
LSTAE    EQU   *-STAE                                                   03748
         SPACE 2                                                        03749
EXCPDCB  DCB   DSORG=PO,DEVD=DA,DDNAME=X,MACRF=E                        03750
LEXCPDCB EQU   *-EXCPDCB                                                03751
SAMDCB   DCB   DSORG=PO,DEVD=DA,DDNAME=X,MACRF=(R,W),EXLST=EXLST        03752
LSAMDCB  EQU   *-SAMDCB                                                 03753
EXLST    DC    X'85',AL3(OPENEXIT)                                      03754
         SPACE 3                                                        03755
OBTAIN   CAMLST SEARCH,0,0,0                                            03756
         ORG   OBTAIN+4                                                 03757
         SPACE 3                                                        03758
BLDLPARM DC    AL2(1,74)                                                03759
DATEMASK DC    X'402120612020612020'                                    03760
         SPACE 2                                                        03761
NO       DC    C'NO'                                                    03762
IDALIAS  DC    C'-A'                                                    03763
FF       DC    8X'FF'                                                   03764
BLANKS   DC    8C' '                                                    03765
TRTABLE  EQU   *-X'F0'                                                  03766
         DC    C'0123456789ABCDEF'                                      03767
         SPACE 2                                                        03768
FOUR     DC    F'4'                                                     03769
         SPACE                                                          03770
DAYMONTH DC    AL1(31,28,31,30,31,30,31,31,30,31,30,31)                 03771
         SPACE 2                                                        03772
* TRANSLATE AND TEST TABLE TO DETERMINE IF A MEMBER NAME                03773
*  IS ALL PRINTABLE.   - SPNB ASSUMES A 2260 KEYBOARD                   03774
         SPACE 1                                                        03775
DISPLAY  CSECT ,                      PUT THIS TABLE IN DISPLAY'S CSECT 03776
TRTMN    DC    256X'FF'                 SET ALL BAD                     03777
         ORG   TRTMN+C' '               A SPACE IS OK                   03778
         DC    X'00'                                                    03779
         ORG   TRTMN+C'.'               GOOD CHARACTERS                 03780
         DC    6X'00'                   .<(+|&   6 CHARS                03781
         ORG   TRTMN+C'$'               GOOD CHARACTERS                 03782
         DC    7X'00'                   $*);-/    7 CHARS              03783
         ORG   TRTMN+C','               GOOD CHARACTERS                 03784
         DC    5X'00'                   , _>?      5 CHARS              03785
         ORG   TRTMN+C':'               GOOD CHARACTERS                 03786
         DC    5X'00'                   :#@'=      5 CHARS              03787
         ORG   TRTMN+C'A'               GOOD CHARACTERS                 03788
         DC    9X'00'                   ABCDEFGHI                       03789
         ORG   TRTMN+C'J'               GOOD CHARACTERS                 03790
         DC    9X'00'                   JKLMNOPQR                       03791
         ORG   TRTMN+C'S'               GOOD CHARACTERS                 03792
         DC    8X'00'                   STUVWXYZ                        03793
         ORG   TRTMN+C'0'               GOOD CHARACTERS                 03794
         DC    10X'00'                  0123456789                      03795
         ORG                                                            03796
PDS      CSECT ,                        GO BACK TO MAIN CSECT           03797
         EJECT                                                          03798
*                                                                       03799
*        NOTE - THE SAME SET OF LOGICAL CCWS CAN BE USED                03800
*        TO READ A PDS DIRECTORY, OR THE CESD ENTRIES, OR               03801
*        IDR RECORDS WITHIN A LOAD MODULE.                              03802
*                                                                       03803
         SPACE                                                          03804
IDRCCWS  DS    0D                                                       03805
ESDCCWS  DS    0D                                                       03806
DIRCCWS  DS    0D                                                       03807
         CCW   X'31',0,X'60',5                                          03808
         CCW   X'08',0,X'60',1                                          03809
         CCW   X'86',0,X'60',256                                        03810
         CCW   X'92',0,X'20',5                                          03811
LDIRCCWS EQU   *-DIRCCWS                                                03812
LESDCCWS EQU   *-ESDCCWS                                                03813
LIDRCCWS EQU   *-IDRCCWS                                                03814
         SPACE 2                                                        03815
LISTCCWS DS    0D                                                       03816
         CCW   X'31',0,X'60',5                                          03817
         CCW   X'08',0,X'60',1                                          03818
         CCW   X'92',0,X'60',5                                          03819
         CCW   X'86',0,X'20',0                                          03820
LLISTCCW EQU   *-LISTCCWS                                               03821
         SPACE 3                                                        03822
TBLATTR  DS    0H                                                       03823
         DC    BL2'1000000000000000',AL1(3),CL9'RENT'                   03824
         DC    BL2'0100000000000000',AL1(3),CL9'REUS'                   03825
         DC    BL2'0000000000000001',AL1(3),CL9'REFR'                   03826
         DC    BL2'0010000000000000',AL1(6),CL9'OVERLAY'                03827
         DC    BL2'0001000000000000',AL1(3),CL9'TEST'                   03828
         DC    BL2'0000100000000000',AL1(8),CL9'LOAD ONLY'              03829
         DC    BL2'0000010000000000',AL1(3),CL9'SCTR'                   03830
         DC    BL2'0000000000001000',AL1(7),CL9'NOT EDIT'               03831
         DC    BL2'0000001000000000',AL1(128+7),CL9'NOT EXEC'           03832
         DC    BL2'0000000010000000',AL1(128+1),CL9'DC'                 03833
         DC    X'FF'                                                    03834
         SPACE 2                                                        03835
ATTRRENT EQU   X'80'                                                    03836
ATTRREUS EQU   X'40'                                                    03837
ATTROVLY EQU   X'20'                                                    03838
ATTRTEST EQU   X'10'                                                    03839
ATTRNE   EQU   X'08'          NOT-EDITABLE ATTRIBUTE                    03840
ATTRSCAT EQU   X'04'                                                    03841
ATTREP0  EQU   X'20'          ASSIGNED ENTRY PT AT OFFSET 0             03842
ATTRREFR EQU   X'01'                                                    03843
ATTRLOAD EQU   X'08'                                                    03844
ATTREXEC EQU   X'02'                                                    03845
ATTRTBL  DS    0X                                                       03846
         DC    CL8'RENT',X'00',AL1(ATTRRENT,0)                          03847
LATTRTBL EQU   *-ATTRTBL                                                03848
LATTR    EQU   8                                                        03849
         DC    CL8'REUS',X'00',AL1(ATTRREUS,0)                          03850
         DC    CL8'REFR',X'00',AL1(0,ATTRREFR)                          03851
         DC    CL8'EXEC',X'00',AL1(ATTREXEC,0)                          03852
         DC    CL8'LOAD',X'00',AL1(ATTRLOAD,0)                          03853
         DC    CL8'AUTH',X'40',AL1(0,0)                                 03854
         DC    X'FF'                                                    03855
$SEGTAB  DC    CL8'$SEGTAB'                                             03856
$ENTAB   DC    CL8'$ENTAB'                                              03857
$PRIVATE DC    CL8'$PRIVATE'                                            03858
         EJECT                                                          03859
OPTNTBL  CSECT                                                          03860
         MSG   'THE FOLLOWING OPTIONS ARE AVAILABLE:'                   03861
         MSG   'DISPLAY -   DISPLAY DIRECTORY'                          03862
         MSG   'RENAME  -   RENAME A MEMBER'                            03863
         MSG   'SCRATCH -   SCRATCH A MEMBER'                           03864
         MSG   'ALIAS   -   ASSIGN AN ALIAS TO A MEMBER'                03865
         MSG   'ATTR    -   LIST LOAD MODULE ATTRIBUTES'                03866
         MSG   'MAP     -   MAP STRUCTURE OF LOAD MODULE'               03867
         MSG   'HISTORY -   LIST HISTORY OF LOAD MODULE'                03868
         MSG   'LIST    -   LIST CONTENTS OF A MEMBER'                  03869
         MSG   'USAGE   -   LIST DIRECTORY STATISTICS'                  03870
         MSG   'CHANGE  -   SELECT A NEW DATA SET'                      03871
         MSG   'OPTIONS -   DISPLAY THIS MENU'                          03872
         MSG   'HELP    -   DISPLAY HELP TEXT'                          03873
         DC    X'FFFF'                                                  03874
         SPACE 3                                                        03875
CMDTABLE CSECT                                                          03876
         DC    CL8'DISPLAY ',AL1(7),AL3(DISPLAY),X'80',AL3(PCLDSPLY)    03877
         DC    CL8'RENAME  ',AL1(6),AL3(RENAME),X'00',AL3(PCLRENAM)     03878
         DC    CL8'SCRATCH ',AL1(7),AL3(SCRATCH),X'00',AL3(PCLDELET)    03879
         DC    CL8'ATTR    ',AL1(4),AL3(ATTR),X'00',AL3(PCLATTR)        03880
         DC    CL8'ALIAS   ',AL1(5),AL3(ALIAS),X'00',AL3(PCLALIAS)      03881
         DC    CL8'MAP     ',AL1(3),AL3(MAP),X'00',AL3(PCLMAP)          03882
         DC    CL8'HELP    ',AL1(4),AL3(HELP),X'40',AL3(0)              03883
         DC    CL8'HISTORY ',AL1(7),AL3(HISTORY),X'00',AL3(PCLHIST)     03884
         DC    CL8'CHANGE  ',AL1(6),AL3(CHANGE),X'00',AL3(PCLMAIN)      03885
         DC    CL8'LIST    ',AL1(4),AL3(LIST),X'00',AL3(PCLLIST)        03886
         DC    CL8'USAGE   ',AL1(5),AL3(USAGE),X'40',AL3(0)             03887
         DC    CL8'OPTIONS ',AL1(7),AL3(LISTOPTS),X'40',AL3(0)          03888
         DC    CL8'END     ',AL1(3),AL3(END),X'40',AL3(0)               03889
         DC    CL8'EXEC    ',AL1(4),AL3(EXEC),X'40',AL3(0)              03890
         DC    X'FF'                                                    03891
PDS      CSECT                                                          03892
         SPACE                                                          03893
VOPTNTBL DC    V(OPTNTBL)                                               03894
VCMDTAB  DC    V(CMDTABLE)                                              03895
         EJECT                                                          03896
*                                                                       03897
*        PROGRAM MESSAGES                                               03898
*                                                                       03899
         SPACE 2                                                        03900
         PRINT NOGEN                                                    03901
         SPACE                                                          03902
MSGUSEV  MSG   'VOLUME SERIAL         '                                 03903
MSGOP    MSG   ' ENTER OPTIONS'                                         03904
MSGUSEB  MSG   ' DIRECTORY BLOCKS ALLOCATED '                           03905
MSGUSED  MSG   ' DIRECTORY BLOCKS IN USE '                              03906
MSGUSER  MSG   ' MEMBERS EXIST'                                         03907
MSGUSEA  MSG   ' OF THEM ARE ALIASES'                                   03908
MSGUSESI MSG   ' TRACKS ALLOCATED '                                     03909
MSGUSEMP MSG   ' TRACKS UNUSED '                                        03910
MSGUSEXT MSG   ' EXTENTS USED '                                         03911
MSGUSERR MSG   ' DIRECTORY ERROR'                                       03912
MSGNDSCB MSG   ' OBTAIN ERROR'                                          03913
MSGSTOWC MSG   ' STOW ERROR, CODE = 12'                                 03914
MSGSTOW8 MSG   ' STOW ERROR, CODE = 8'                                  03915
MSGSTOW4 MSG   ' STOW ERROR, CODE = 4'                                  03916
MSGNLIST MSG   ' UNABLE TO LIST LOAD MODULES'                           03917
MSGLISTI MSG   ' I/O ERROR READING MEMBER'                              03918
MSGNLIB  MSG   ' DATA SET NOT PARTITIONED'                              03919
MSGNLOAD MSG   ' DATA SET NOT LOAD LIBRARY'                             03920
MSGNOPEN MSG   ' UNABLE TO PROCESS DATA SET'                            03921
MSGBADAT MSG   ' INVALID ATTRIBUTE, '                                   03922
MSGDUPAT MSG   ' CONFLICTING ATTRIBUTE IGNORED - '                      03923
MSGIOERR MSG   ' DIRECTORY I/O ERROR'                                   03924
MSGEMPTY MSG   ' NO MEMBERS EXIST'                                      03925
MSGRANGE MSG   ' INVALID RANGE'                                         03926
MSGNODSP MSG   ' NO MEMBERS WITHIN RANGE'                               03927
MSGEXIST MSG   ' MEMBER CURRENTLY EXISTS'                               03928
MSGNONE  MSG   ' MEMBER NOT FOUND'                                      03929
MSGGONE  MSG   ' SCRATCHED'                                             03930
MSGRENAM MSG   ' RENAMED'                                               03931
MSGATTRS MSG   ' ATTRIBUTES FOR THIS MODULE ARE:'                       03932
MSGNREAL MSG   ' MODULE IS AN ALIAS, ALIAS NOT ASSIGNED'                03933
MSGREAL  MSG   ' MODULE IS ALIAS FOR '                                  03934
MSGOTHER MSG   ' ALIASES FOR THIS MODULE ARE:'                          03935
MSGNOMOD MSG   ' MODULE IS ALIAS BUT REAL MODULE DOES NOT EXIST'        03936
NONEMSG  MSG   ' NONE'                                                  03937
MSGNOESD MSG   ' MODULE HAS NO EXTERNAL SYMBOLS'                        03938
MSGALIAS MSG   ' ALIAS ASSIGNED'                                        03939
MSGENTRY MSG   ' ENTRY POINT AT '                                       03940
MSGLEN   MSG   ' MODULE LENGTH  '                                       03941
MSGHIST1 MSG   'HISTORY SUMMARY FOR MODULE '                            03942
MSGHISTD MSG   'LAST LINK-EDITED ON'                                    03943
MSGHISTZ MSG   'IMASPZAP UPDATE HISTORY BY CSECT -'                     03944
MSGHISTU MSG   'USER-SUPPLIED UPDATE HISTORY BY CSECT -'                03945
MSGNHIST MSG   ' NO HISTORY AVAILABLE'                                  03946
MSGUNKN  MSG   ' INVALID SUBCOMMAND.  FOR HELP, ENTER - OPTIONS'        03947
MSGRETRY MSG   ' RE-ENTER DATA SET NAME'                                03948
MSGVOL   MSG   ' REQUIRED VOLUME NOT MOUNTED'                           03949
MSGINVLD EQU   MSGUNKN                                                  03950
MSGNOCAT MSG   ' DATA SET NOT CATALOGED'                                03951
MSGINDEX MSG   ' INCONSISTENT CATALOG STRUCTURE'                        03952
MSGCATER MSG   ' CATALOG ERROR CODE '                                   03953
MSGSYNTX MSG   ' INVALID SYNTAX IN DATA SET NAME'                       03954
MSGDSFMT MSG   ' DATA SET NAME ALREADY EXISTS AT A LOWER LEVEL'         03955
MSGDSN   MSG   ' AN INDEX OF THE DATA SET NAME EXCEEDS 8 CHARACTERS'    03956
MSG20C   MSG   'DATA SET IN USE'                                        03957
MSG20CX  MSG   ' DATA SET IN USE BY ANOTHER USER OR A BACKGROUND JOB'   03958
MSG210   EQU   MSG20C                                                   03959
MSG210X  EQU   MSG20CX                                                  03960
MSG214   MSG   'VOLUME NOT AVAILABLE'                                   03961
MSG214X  MSG   ' VOLUME CAN NOT BE MOUNTED'                             03962
MSG218   EQU   MSG214                                                   03963
MSG218X  EQU   MSG214X                                                  03964
MSG21C   EQU   MSG214                                                   03965
MSG21CX  MSG   ' USER ATTRIBUTES INCORRECT'                             03966
MSG334   MSG   'NAME EXCEEDS 44 CHARACTERS'                             03967
MSG41CX  MSG   ' DATA SET ON MORE THAN ONE VOLUME'                      03968
MSG6708  MSG   'DATA SET NOT ON VOLUME'                                 03969
MSGDYNER MSG   ' DYNAMIC ALLOCATION ERROR CODE '                        03970
MSGFULL  MSG   'TOO MANY DATA SETS'                                     03971
MSGFULL1 MSG   ' FREE DATA SETS NO LONGER REQUIRED'                     03972
MSGCMDER MSG   ' COMMAND SYSTEM ERROR'                                  03973
MSG4     MSG   'SYSTEM ERROR'                                           03974
MSG1     DC    C' DATA SET '                                            03975
MSG3     DC    C' NOT ALLOCATED, '                                      03976
MSGPARSE DC    C' PARSE ERROR CODE '                                    03977
         SPACE 3                                                        03978
PATCH    DC    10F'0'                                                   03979
         EJECT                                                          03980
*                                                                       03981
*        DYNAMIC WORK AREA                                              03982
*                                                                       03983
         SPACE 3                                                        03984
WORKAREA DSECT                                                          03985
MAINSAVE DS    18A                                                      03986
CMDSAVE  DS    18A                                                      03987
VALSAVE  DS    18A                                                      03988
ATTNSAVE DS    18A                                                      03989
PARSELST DS    7A                       AREA FOR PARSE PARM LIST        03990
ADDRSAVE DS    A                        ADDR OF FIRST SAVE AREA         03991
CPPLADDR DS    A                        ADDR OF CPPL                    03992
         SPACE                                                          03993
STAEREGS DS    16A                                                      03994
STAESAVE DS    18A                                                      03995
R14SAVE  DS    A                                                        03996
R14PARSE DS    A                                                        03997
R14ATTN  DS    A                                                        03998
R14ALLOC DS    A                                                        03999
R14LINK  DS    A                                                        04000
R14PUTL  DS    A                                                        04001
R14GETL  DS    A                                                        04002
R14PTGT  DS    A                                                        04003
         SPACE                                                          04004
BASES    DS    2A             PROGRAM BASE ADDRESSES                    04005
         SPACE                                                          04006
ADDRUPT  DS    A                                                        04007
ADDRECT  DS    A                                                        04008
ADDRPSCB DS    A                                                        04009
ADDRCBUF DS    A                                                        04010
         SPACE                                                          04011
ADDRPCL  DS    A              ADDR OF PCL FOR PARSE                     04012
ADDRPUTL DS    A              ADDR OF IKJPUTL                           04013
ADDRGETL DS    A              ADDR OF IKJGETL                           04014
ADDRPTGT DS    A              ADDR OF IKJPTGT                           04015
ADDRSCAN DS    A              ADDR OF IKJSCAN                           04016
         SPACE                                                          04017
ADDRPDL  DS    A                                                        04018
ADDRCMD  DS    A                                                        04019
OPENLIST DS    2A                                                       04020
         SPACE 2                                                        04021
ATTNECB  DS    F                                                        04022
         SPACE                                                          04023
ESDPTR   DS    A              ADDRESS OF ESD DATA CHAIN                 04024
IDRPTR   DS    A                                                        04025
         SPACE                                                          04026
PARMLIST DS    10A                                                      04027
GETLPARM DS    10A                                                      04028
PUTLPARM DS    10A                                                      04029
PTGTPARM DS    10A                                                      04030
SCANANSR DS    XL8                                                      04031
SUBNAME  DS    CL8                                                      04032
BUFFADDR DS    A                                                        04033
BUFFSIZE DS    H                                                        04034
LRECL    DS    H                                                        04035
ATTRYES  DS    XL2                                                      04036
ATTRNO   DS    XL2                                                      04037
         SPACE 2                                                        04038
LINESIZE DS    H                                                        04039
LMEMBER1 DS    H                                                        04040
LMEMBER2 DS    H                                                        04041
         SPACE 2                                                        04042
TOTBLOCK DS    H                                                        04043
TOTUSED  DS    H                                                        04044
TOTMEMR  DS    H                                                        04045
TOTMEMA  DS    H                                                        04046
DSNTOTAL DS    H                                                        04047
DSNEMPTY DS    H                                                        04048
DSNEXTNT DS    H                                                        04049
         SPACE                                                          04050
MEMBERS  DS    0X                                                       04051
MEMBER1  DS    CL8            FIRST MEMBER NAME                         04052
MEMBER2  DS    CL8            SECOND MEMBER NAME                        04053
         SPACE                                                          04054
SAVETTR  DS    XL3,X                                                    04055
LKEDDATE DS    XL3                                                      04056
         SPACE 2                                                        04057
VOLUME   DS    CL8                                                      04058
         SPACE                                                          04059
DOUBLE   DS    D                                                        04060
         SPACE                                                          04061
STAEPARM STAE  0,CT,MF=L                                                04062
         SPACE                                                          04063
FLAGS    DS    XL4            GENERAL STATUS FLAGS                      04064
*        FLAGS AT BYTE 0                                                04065
FOPTIONS EQU   X'80'          OPTIONS PRESENT WITH COMMAND              04066
FCMD     EQU   X'40'          SUBCOMMAND BUFFER AVAILABLE               04067
FNULL    EQU   X'20'          NULL LINE ENTERED                         04068
FMEMBER1 EQU   X'10'          FIRST MEMBER FLAG                         04069
FMEMBER2 EQU   X'08'          SECOND MEMBER FLAG                        04070
FLOADMOD EQU   X'04'          DATA SET IN LOAD MODULE FORMAT            04071
FRESTART EQU   X'02'          RESTART W/ NEW DATA SET                   04072
FATTR    EQU   X'01'          CHANGE ATTRIBUTES REQUEST                 04073
*        FLAGS AT BYTE 1                                                04074
F1STREAD EQU   X'80'          INITIAL ENTRY TO READ SUBROUTINE          04075
FLINESET EQU   X'40'          OUTPUT LINE IN PROGRESS                   04076
FEXIST   EQU   X'20'          MEMBERS EXIST IN DATA SET                 04077
FRANGE   EQU   X'10'          MEMBERS EXIST IN DISPLAY RANGE            04078
FIDR     EQU   X'40'          IDR RECORDS EXIST                         04079
F1IDR    EQU   X'20'          IDR TITLE PROCESSED                       04080
FALLESD  EQU   X'08'          REQUEST ALL ESD ENTRIES                   04081
FNORETRY EQU   X'04'          NO ALLOCATION RETRY ALLOWED               04082
FQUOTE   EQU   X'02'          DATA SET NAME IS QUOTED                   04083
FATTN    EQU   X'01'          INTERRUPTIONS ALLOWED                     04084
*        FLAGS AT BYTE 2                                                04085
FREALMOD EQU   X'80'          TRUE MODULE NAME SPECIFIED                04086
FPERMDS  EQU   X'40'          DATA SET IS PERMANENTLY ALLOCATED         04087
FDIRSCAN EQU   X'20'          SCAN DIRECTORY STATUS                     04088
FDIREND  EQU   X'10'          LAST USED BLOCK ENCOUNTERED               04089
FIDRCONT EQU   X'08'          PROCESSING CONTINUED IDR RECORD           04090
FIDRHCON EQU   X'04'                                                    04091
FAPFON   EQU   X'02'          TURN ON APF REQUESTED                     04092
FAPFOFF  EQU   X'01'          TURN OFF APF REQUESTED                    04093
         SPACE 2                                                        04094
DDNAME   DS    CL8                                                      04095
DDNAME1  DS    CL8                                                      04096
PASSWORD DS    CL8                                                      04097
DSNLEN   DS    H                                                        04098
DSNAME   DS    CL44                                                     04099
         ORG   DSNAME                                                   04100
JFCB     DS    XL176                    AREA FOR JFCB                   04101
         ORG                                                            04102
         SPACE 2                                                        04103
         DS    0D                                                       04104
DSCB     DS    XL148                    AREA FOR OBTAIN WORKAREA/DSCB   04105
         ORG   DSCB                                                     04106
DAIRBLK  DS    25D            SPACE FOR DAIR PARAMETER LIST             04107
LDAIRBLK EQU   *-DAIRBLK                                                04108
         ORG                                                            04109
         SPACE 2                                                        04110
CAMLST   CAMLST SEARCH,0,0,0                                            04111
         SPACE                                                          04112
         DS    0F                                                       04113
MSGTEXT1 DS    XL124                                                    04114
MSGTEXT2 DS    XL124                                                    04115
         SPACE                                                          04116
         ORG   MSGTEXT1                                                 04117
DAYTABLE DS    XL12                                                     04118
         ORG                                                            04119
         SPACE 2                                                        04120
PUTOLD1  DS    3F                                                       04121
PUTOLD2  DS    3F                                                       04122
         SPACE 2                                                        04123
INDCB    DCB   DSORG=PO,MACRF=(R,W),DDNAME=X                            04124
STOWDCB  DCB   DSORG=PO,MACRF=(R,W),DDNAME=X                            04125
EXLSTX   DS    A                                                        04126
         SPACE 2                                                        04127
         DS    0F                                                       04128
BLDLLIST DS    XL4                                                      04129
MEMNAME  DS    0CL8                                                     04130
DIRNAME  DS    CL8                                                      04131
DIRTTR   DS    XL3                                                      04132
DIRFLAG  DS    X                                                        04133
DIRUSER  DS    XL62                                                     04134
         ORG   DIRUSER                                                  04135
*        THE FOLLOWING FIELDS APPLY TO LOAD MODULES                     04136
DIRSTART DS    XL4            TTR OF FIRST TEXT BLOCK                   04137
DIRNOTE  DS    XL3            TTR OF NOTE LIST                          04138
DIRNOTE# DS    X                                                        04139
DIRATTR  DS    XL2                                                      04140
DIRCORE  DS    XL3            SIZE OF LOAD MODULE                       04141
DIRTEXTL DS    XL2            LENGTH OF 1ST TEXT RECORD                 04142
DIRENTRY DS    XL3            ENTRY POINT ADDRESS                       04143
DIRATTR2 DS    XL1            ADDITIONAL ATTRIB BYTES                   04144
         DS    XL2            RESERVED                                  04145
DIRAPF   DS    0XL2           APF (IF NOT SCAT, SSI, OR ALIAS)          04146
DIREP    DS    XL3            ENTRY POINT (REAL MEMBER)                 04147
DIRREAL  DS    CL8            REAL NAME OF MEMBER                       04148
DIRAPF2  DS    XL2            APF INFO IF W/ALIAS                       04149
DIREND2  EQU   *              END OF ALIAS SECTION                      04150
         ORG                                                            04151
DIREND   EQU   *                                                        04152
         SPACE 2                                                        04153
         DS    0D                                                       04154
         SPACE 2                                                        04155
CCWS     DS    6D                                                       04156
LCCWS    EQU   *-CCWS                                                   04157
         SPACE                                                          04158
IOECB    DS    F                                                        04159
IOB      DS    0F                                                       04160
IOBFLAG  DS    X'42000000'                                              04161
IOBECB   DS    A(IOECB)                                                 04162
         DS    X                                                        04163
IOBCSW   DS    XL7                                                      04164
IOBCCW   DS    A(CCWS)                                                  04165
IOBDCB   DS    A(INDCB)                                                 04166
         DS    2F                                                       04167
MBBCCHHR DS    XL3                                                      04168
IOBSEEK  DS    XL5                                                      04169
         DS    4F                                                       04170
LIOB     EQU   *-IOB                                                    04171
         SPACE 2                                                        04172
IDROFSAV DS    F              CONTINUED IDR BLK OFFSET SAVE AREA        04173
DIRPTRS  DS    3F                                                       04174
*        NOTE - THE SAME BUFFER CAN BE USED TO                          04175
*        CONTAIN A PDS DIRECTORY BLOCK OR AN IDR OR                     04176
*        CESD RECORD FROM A LOAD MODULE                                 04177
IDRBUFF  DS    0XL256                                                   04178
ESDBUFF  DS    0XL256                                                   04179
DIRBLOCK DS    XL256                                                    04180
         DS    XL80                     PAD WORK AREA FOR MVS           04181
         SPACE 5                                                        04182
LENWORK  EQU   *-WORKAREA                                               04183
         PRINT GEN                                                      04184
         EJECT                                                          04185
*                                                                       04186
*                                                                       04187
*        ESD TABLE FORMAT                                               04188
*                                                                       04189
*                                                                       04190
         SPACE 2                                                        04191
ESDENTRY DSECT                                                          04192
ESDLINK  DS    F                                                        04193
ESDNAME  DS    CL8            NAME OF EXTERNAL SYMBOL                   04194
ESDTYPE  DS    X              ESD TYPE                                  04195
CODESD   EQU   X'00'          ENTERNAL DEFINATION                       04196
CODELR   EQU   X'03'          EXTERNAL REFERENCE                        04197
CODESEG  EQU   X'14'          OVERLAY SEGMENT TABLE                     04198
CODEPC   EQU   X'04'          PRIVATE CODE DEFINITION                   04199
CODEENTB EQU   CODESEG        OVERLAY ENTRY TABLE                       04200
ESDADDR  DS    XL3            RELATIVE OFFSET                           04201
ESDSEG#  DS    X              SEGMENT NUMBER                            04202
ESDLEN   DS    XL3            LENGTH OF SD ENTRY                        04203
LENESD1  EQU   *-ESDNAME      LENGTH OF ESD DATA                        04204
ESDID    DS    XL2            RELATIVE ESD ID #                         04205
LENESD2  EQU   *-ESDNAME      LENGTH OF ESD DATA                        04206
LENESD   EQU   *-ESDENTRY     LENGTH OF ENTRY                           04207
         EJECT                                                          04208
IDRENTRY DSECT                                                          04209
IDRLINK  DS    A                                                        04210
IDRSTART EQU   *                                                        04211
IDRESDID DS    XL2                                                      04212
IDRTYPE  DS    X                                                        04213
IDRZAP   EQU   X'01'                                                    04214
IDRLKED  EQU   X'02'                                                    04215
IDRUSER  EQU   X'08'                                                    04216
IDRDATE  DS    XL3                                                      04217
IDRLDATA DS    X                                                        04218
IDRUPREF DS    XL6                      USER REC PREFIX                 04219
IDRZDATA DS    0CL8                                                     04220
IDRDATA  DS    CL40                                                     04221
LENIDR1  EQU   *-IDRSTART                                               04222
LENIDR   EQU   *-IDRENTRY                                               04223
         EJECT                                                          04224
         IKJPPL                                                         04225
         EJECT                                                          04226
         IKJIOPL                                                        04227
IOPLEND  DS    0F                                                       04228
         EJECT                                                          04229
         IKJPSCB                                                        04230
         EJECT                                                          04231
         IKJECT                                                         04232
         EJECT                                                          04233
         IKJCPPL                                                        04234
         EJECT                                                          04235
         IKJCSPL                                                        04236
         EJECT                                                          04237
         IKJCSOA                                                        04238
         EJECT                                                          04239
         IKJPGPB                                                        04240
         EJECT                                                          04241
         IKJGTPB                                                        04242
         EJECT                                                          04243
         IKJDAPL                                                        04244
         EJECT                                                          04245
         IKJDAP00                                                       04246
         EJECT                                                          04247
         IKJDAP04                                                       04248
         EJECT                                                          04249
         IKJDAP08                                                       04250
         EJECT                                                          04251
         IKJDAP0C                                                       04252
DA0CDDN  DS    XL8 START OF DDNAME LIST                                 04253
         EJECT                                                          04254
         IKJDAP10                                                       04255
         EJECT                                                          04256
         IKJDAP14                                                       04257
         EJECT                                                          04258
         IKJDAP18                                                       04259
         EJECT                                                          04260
         IKJDAP1C                                                       04261
         EJECT                                                          04262
         IKJDAP24                                                       04263
         EJECT                                                          04264
         IKJDAP28                                                       04265
         EJECT                                                          04266
         IKJDAP2C                                                       04267
         EJECT                                                          04268
         IKJDAP30                                                       04269
         EJECT                                                          04270
         DCBD  DSORG=PO                                                 04271
         SPACE 5                                                        04272
         END                                                            04273
