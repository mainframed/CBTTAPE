         TITLE 'LISTA FUNCTION '                               SS AUG86
*************************************************************  SS NOV85
*                                                              SS NOV85
*      LISTA  FUNCTION                                         SS NOV85
*                                                              SS NOV85
*************************************************************  SS NOV85
         SPACE 2
ISPLISTA DS    0H                                              SS NOV85
         USING *,R4                                            SS NOV85
         SPACE 1
* HIERARCHICAL SUPPORT REMOVED                                 SS OCT88
         BAS   R2,ISPSETST              SET STATS PREV TABLE   SS AUG86
         CLI   SPFFUNST+2,C'P'          LISTA   PENDING PROC   SS AUG86
         BE    ISPLTA5                  YES, SET TO REPROCESS  SS AUG86
         L     R14,SPFVTPT         RELOAD VERB POINTER         SS JUL87
         SR    R15,R15             CLEAR FOR IC                SS JUL87
         IC    R15,$TLEX(R14)      SUB FUNCTION CODE           SS JUL87
         L     R15,ISPLTAAT(R15)   GET SUB FUC ADDR            SS JUL87
         BR    R15                      *                      SS JUL87
ISPLTAAT DS    0F                       *                      SS JUL87
         DC    A(ISPLTAAN)    0   NORMAL LISTA                 SS JUL87
         DC    A(ISPTSK00)    4   TASKLIB LIST                 SS JUL87
         DC    A(ISPLKLST)    8   LINKLIST (XA ONLY)           SS JUL87
ISPTSK00 DS    0F                       *                      SS JUL87
         CLI   SPFFUNST+2,C'I'   INACT                         SS JUL87
         BE    ISPTSK01          YES, BUILD NEW TABLE          SS JUL87
         TM    SPFTSVDF+1,X'02'  ALREADY HAVE LIST             SS JUL87
         BO    ISPLTA1           YES, DISPLAY IT               SS JUL87
ISPTSK01 DS    0H                       *                      SS JUL87
         LA    R1,ISPLSTAV        DEF VAR TABLE                SS NOV85
         BAS   R2,ISPVDEFX                                     SS NOV85
         OI    SPFPRBI2,X'02'    SET TASKLIB MODE              SS JUL87
         B     ISPLSTAR          SET UP TABLE                  SS JUL87
ISPLKLST DS    0F                       *                      SS JUL87
ISPLTAAN DS    0F                       *                      SS JUL87
         L     R15,SPFOPER      FIRST BLANK AFTER CMD          SS AUG86
ISPLTART DS    0F                       *                      SS DEC87
         LA    R14,30           MAX LENGTH                     SS AUG86
         LA    R1,ISPLSTAP      PARSE LIST                     SS AUG86
         BAS   R2,ISPPARSI      PARSE IT                       SS AUG86
         C     R15,ISPL8        RETURN CODE                    SS AUG86
         BH    ISPLSTAE         BAD KEYS                       SS DEC87
* DO VDEF                                                      SS NOV85
         LA    R1,ISPLSTAV        DEF VAR TABLE                SS NOV85
         BAS   R2,ISPVDEFX                                     SS NOV85
         CLI   SPFFUNST+2,C'I'    INACTIVE                     SS AUG86
         BE    ISPLTA2            YES   *                      SS AUG86
         TM    SPFTBPF2,SPFTFUNC  AT FUNCTION?                 SS OCT88
         BO    ISPLTA1            YES, SKIP LISTA TEST         SS OCT88
         TM    SPFLAG4,SPFFFUN    AT FUNCTION?                ABL JAN87
         BO    ISPLTA1            YES, SKIP LISTA TEST        ABL JAN87
         CLI   SPFTBPFI+1,2       ALREADY AT LISTA             SS AUG86
         BE    ISPLSTAR           THEN REOPEN TABLE            SS AUG86
ISPLTA1  DS    0H                                             ABL JAN87
         LH    R1,SPFFUNLP+4      GET LAST PANEL               SS AUG86
         LNR   R1,R1                    *                      SS AUG86
         BAS   R2,ISPSTKI         SWAP PANEL                   SS AUG86
         LA    R15,100            DISPLAY IF NO OPERANDS      ABL JAN87
         CLI   SPFPRRC,8          ANY OPERANDS?               ABL JAN87
         BER   R3                 NO, DISPLAY TABLE AS IS     ABL JAN87
         B     ISPLSTAR           REOPEN  TABLE                SS AUG86
ISPLTA2  DS    0H                       *                      SS AUG86
         LA    R1,15              PANEL E                      SS NOV85
         LNR   R1,R1              SET FOR SWAP                 SS AUG86
         BAS   R2,ISPSTKI         STACK IT                     SS NOV85
         B     ISPLSTAO           OPEN                         SS NOV85
ISPLSTAH DC    AL2(SPFLISTA-SPWRKC) HOME ADDRESS OFFSET        SS NOV85
ISPLSTAR DS    0H                                              SS NOV85
* RESET TB IF OPEN                                             SS NOV85
         BAS   R2,ISPTBEND                                     SS NOV85
ISPLSTAO DS    0H                                              SS NOV85
* OPEN TB                                                      SS NOV85
         MVC   SPFTBL,SPFCSUF    GET BASE NAME                 SS NOV85
         MVI   SPFTBL+2,C'A'     SET TO PDA                    SS NOV85
         XC    SPFTFLG1(4),SPFTFLG1                            SS NOV85
         XC    SPFTFF(2),SPFTFF                                SS NOV85
         LA    R15,0             NO KEY                        SS NOV85
         LA    R0,ISPLSTAN       VER NAMES                     SS NOV85
         BAS   R2,ISPTBOPN                                     SS NOV85
         BAS   R2,ISPSETST         ALSO INIT STATUS FLAG       SS AUG86
*   TEST PARSE OUTPUT                   *                      SS AUG86
         TM    SPFPRBI2,X'02'      TASK LIB PROCESSING         SS JUL87
         BZ    ISPTSK03                 *                      SS JUL87
         OI    SPFTSVDF+1,X'02'    SET TASK PROCESSING         SS JUL87
         XC    SPFPRBI1(2),SPFPRBI1 FORCE ALL OPTION           SS JUL87
         B     ISPLSTAF            DO IT                       SS JUL87
ISPTSK03 DS    0H                       *                      SS JUL87
         NI    SPFTSVDF+1,255-X'02' CLEAR OLD FLAG             SS JUL87
         OC    SPFPRBI,SPFPRBI     ANY BITS ON                 SS AUG86
         BZ    ISPLSTAD         NO KEYS SET DEFAULT            SS AUG86
         TM    SPFPRBI3,X'01'           ALL OPTION             SS AUG86
         BZ    *+10                     NO                     SS AUG86
         XC    SPFPRBI1(2),SPFPRBI1     YES, CLEAR ALL FLAGS   SS AUG86
         TM    SPFPRBI3,X'02'           SET DEFAULT            SS AUG86
         BZ    *+10                     NO                     SS AUG86
         MVC   SPFTSVDF(2),SPFPRBI1     SET NEW DEFAULTS       SS AUG86
         B     ISPLSTAF                 CONTINUE               SS AUG86
ISPLSTAD DS    0H                       *                      SS AUG86
         MVC   SPFPRBI1(2),SPFTSVDF     GET DEFAULTS           SS AUG86
ISPLSTAF DS    0H                       *                      SS AUG86
* SET UP DSAB SCAN                                             SS NOV85
         L     R2,CVTPTR(,R0)     CVT                          SS NOV85
         L     R2,0(,R2)          ACT TCB PT                   SS NOV85
         L     R2,4(,R2)          ACT TCB                      SS NOV85
         TM    SPFTSVDF+1,X'02'   TASKLIB REQUEST              SS JUL87
         BZ    ISPTSK90                 *                      SS JUL87
ISPTSK02 DS    0H                       *                      SS JUL87
         ST    R2,SPFTKTCB       SAVE TCB ADDRESS              SS JUL87
         L     R1,12(,R2)        TIOT ADDRESS                  SS JUL87
         ICM   R2,15,X'28'(R2)   TASK DCB                      SS JUL87
         BZ    ISPLSTAX          NO MORE DCBS, DONE            SS JUL87
         LH    R2,X'28'(,R2)     TIOT OFFSET                   SS JUL87
         LA    R2,0(R1,R2)       TIOT ENTRY                    SS JUL87
         MVC   SPFADDNM,4(R2)    COPY DDNAME                   SS JUL87
         LA    R14,SPFADDNM      POINT TO DDNAME               SS JUL87
         BAS   R2,ISPFDSAB       FIND DSAB                     SS JUL87
         ST    R1,SPFATMP1       SAVE DSAB ADDRESS             SS JUL87
         B     ISPLSTAL          PROCESS IT                    SS JUL87
ISPTSK10 DS    0H                       *                      SS JUL87
         L     R2,SPFTKTCB       RELOAD TCB ADDRESS            SS JUL87
         L     R1,X'28'(,R2)     RELOAD DCB ADDRESS            SS JUL87
ISPTSK11 ICM   R2,15,X'84'(R2)   MOTHER TASK                   SS JUL87
         BZ    ISPLSTAX          ZERO ADDRESS, DONE            SS JUL87
         C     R1,X'28'(,R2)     SAVE DCB ADDRESS              SS JUL87
         BE    ISPTSK11          YES, TRY NEXT                 SS JUL87
         B     ISPTSK02          NEW ONE, PROCESS IT           SS JUL87
ISPTSK90 DS    0H                       *                      SS JUL87
         L     R2,TCBJSCB-TCBRBP(R2)     JSCB                  SS NOV85
         L     R2,JSCDSABQ-IEZJSCB(R2)   DSAB QUE              SS NOV85
         L     R2,12(,R2)                FIRST DSAB            SS NOV85
         ST    R2,SPFATMP1               SAVE TEMP             SS NOV85
* ADD DDN ENTRIES                                              SS NOV85
ISPLSTAL DS    0H                                              SS NOV85
         L     R2,SPFATMP1                                     SS NOV85
         LTR   R2,R2                                           SS NOV85
         BZ    ISPLSTAX           EXIT                         SS NOV85
         USING DSAB,R2                                         SS NOV85
         MVC   SPFAOPT,ISPBLK8                                 SS NOV85
         MVC   SPFADATA,ISPBLK8                                SS NOV85
         XC    SPFATFLG,SPFATFLG                               SS NOV85
         AIF   ('&MVSLEV' GE 'MVS220').MVS22A                  WW JUL88
         SR    R1,R1                                           SS NOV85
         ICM   R1,7,DSABSSVA     SIOT                          SS NOV85
         LA    R1,16(,R1)        OVER SWA HEADER               SS NOV85
         AGO   .MVS22AX                                        WW JUL88
.MVS22A  ANOP                                                  WW JUL88
         TM    SPFLAG5,SPFXA            REALLY XA              SS JUL88
         BZ    *+4+4+4+2                NO, SKIP  BSM          SS JUL88
         LA    R1,*+4+4+2               POINT AFTER BSM        SS JUL88
         O     R1,ISPX80                31 BIT MODE            SS JUL88
         BSM   0,R1                     SET MODE               SS JUL88
         L     R1,DSABSIOT              POINT TO SIOT          WW JUL88
.MVS22AX ANOP                                                  SS JUL88
         USING INDMSIOT,R1                                     SS NOV85
         MVC   SPFACLS,SCTOUTPN    SAVE SYSOUT CLASS           SS NOV85
         TM    SCTSBYT1,SCTDUMMY   DUMMY DATASET               SS NOV85
         BZ    *+8                                             SS NOV85
         OI    SPFATFLG,SPFANUCB   NO UCB                      SS NOV85
         TM    SCTSBYT2,SIOTCATL   CATALOG DATASET             SS NOV85
         BZ    ISPLSTA7                                        SS NOV85
         OI    SPFATFLG,SPFATYSE   GOT TYPE                    SS NOV85
         MVC   SPFATYPE,=C'CTLG'                               SS NOV85
ISPLSTA7 DS    0H                                              SS NOV85
* GET DISP AND CDSP FROM SIOT                                  SS JUL88
         MVC   SPFADISP(8),ISPBLK8  CLEAR DISP AND CDSP        SS NOV85
         TM    SCTSDISP,X'10'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFADISP,=C'PASS'                               SS NOV85
         TM    SCTSDISP,X'08'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFADISP,=C'KEEP'                               SS NOV85
         TM    SCTSDISP,X'04'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFADISP,=C'DLET'                               SS NOV85
         TM    SCTSDISP,X'02'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFADISP,=C'CTLG'                               SS NOV85
         TM    SCTSDISP,X'01'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFADISP,=C'UNCT'                               SS NOV85
         TM    SIOTALTD,X'08'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAADSP,=C'KEEP'                               SS NOV85
         TM    SIOTALTD,X'04'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAADSP,=C'DLET'                               SS NOV85
         TM    SIOTALTD,X'02'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAADSP,=C'CTLG'                               SS NOV85
         TM    SIOTALTD,X'01'                                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAADSP,=C'UNCT'                               SS NOV85
         AIF   ('&MVSLEV' LT 'MVS220').MVS22B                  WW JUL88
         TM    SPFLAG5,SPFXA            REALLY XA              SS JUL88
         BZ    *+4+4+2                  NO, SKIP  BSM          SS JUL88
         LA    R1,*+4+2                 POINT AFTER BSM        SS JUL88
         BSM   0,R1                     SET MODE 24            SS JUL88
.MVS22B  ANOP                                                  SS JUL88
         DROP  R1                                             DRK NOV98
         L     R1,DSABTIOT                                     SS NOV85
         USING TIOENTRY,R1                                     SS NOV85
         ST    R1,SPFATMP2        SAVE TIOT ADDR               SS NOV85
         TM    SPFTSVDF+1,X'02'   TASK LIB LIST                SS JUL87
         BZ    ISPTSK20           NO, NORMAL PROCESSING        SS JUL87
         CLC   TIOEDDNM,ISPBLK8   CONCAT                       SS MAY88
         BE    ISPTSK22           YES CONTINUE                 SS MAY88
         CLC   SPFADDNM,TIOEDDNM  NEXT  DDNAME                 SS JUL87
         BNE   ISPTSK10           DIFFERENT, MUST BE NEW       SS JUL87
ISPTSK20 DS    0H                       *                      SS JUL87
         CLC   TIOEDDNM,ISPBLK8   CONCAT                       SS MAY88
         BE    ISPTSK22           YES CONTINUE                 SS MAY88
         MVC   SPFADDNM,TIOEDDNM                               SS JUL87
         LA    R0,1                   CONCAT COUNT = 1         SS MAY88
         STH   R0,SPFACCNT            SET                      SS MAY88
         B     ISPTSK28                 *                      SS MAY88
ISPTSK22 DS    0H                       *                      SS MAY88
         MVC   SPFADDNM,ISPBLK8         *                      SS MAY88
         MVI   SPFADDNM+2,C'#'        FOR CONCAT               SS MAY88
         LH    R1,SPFACCNT            LAST COUNT               SS MAY88
         LA    R1,1(,R1)              ONE MORE                 SS MAY88
         STH   R1,SPFACCNT            NEW COUNT                SS MAY88
         BAS   R2,ISPDECCV            DEC NUMBER               SS MAY88
         MVC   SPFADDNM+5(3),SPFDCNV3 3 DIGIT NUMBER          DRK JUN99
         L     R2,SPFATMP1            RELOAD DSAB ADDR         SS MAY88
         L     R1,DSABTIOT            RELOAD TIOT ADDR         SS MAY88
ISPTSK28 DS    0H                       *                      SS MAY88
         ICM   R0,B'1110',DSABFLG1    FLAGS                    SS NOV85
         ICM   R0,B'0001',TIOELINK    FLAGS                    SS NOV85
         LR    R1,R0                                           SS NOV85
         BAS   R2,ISPHEXCV                                     SS NOV85
         MVC   SPFAFLAG(8),SPFHEXCV                            SS NOV85
         L     R2,SPFATMP1                                     SS NOV85
         MVC   SPFAOCNT,ISPBLK8                                SS NOV85
         LH    R1,DSABOPCT        OPEN COUNT                   SS NOV85
         CH    R1,=H'9'                                        SS NOV85
         BH    ISPLSTA9                                        SS NOV85
         MVC   SPFAOCNT(1),DSABOPCT+1   MOVE NUMBER            SS NOV85
         OI    SPFAOCNT,X'F0'           FIX NUMERIC ZONE       SS NOV85
         B     *+8                                             SS NOV85
ISPLSTA9 MVI   SPFAOCNT,C'*'           ALLOC OVER 9            SS NOV85
*        L     R2,SPFATMP1                                     SS NOV85
*        TM    SPFATFLG,SPFATYSE                               SS NOV85
*        BO    ISPLSTA8                                        SS NOV85
*        LA    R1,DSABORG         DSORG                        SS NOV85
*        BAS   R2,ISPDSORG                                     SS NOV85
*        STCM  R0,15,SPFATYPE                                  SS NOV85
ISPLSTA8 DS    0H                                              SS NOV85
         AIF   ('&MVSLEV' GE 'MVS220').MVS22C                  WW JUL88
         L     R1,SPFATMP2        TIOT ENT ADDR                SS NOV85
         SR    R2,R2                                           SS NOV85
         ICM   R2,7,TIOEJFCB                                   SS NOV85
         LA    R2,16(,R2)        OVER HEADER                   SS NOV85
         AGO   .MVS22CX                                        WW JUL88
.MVS22C  ANOP                                                  WW JUL88
         L     R2,SPFATMP1              DSAB ADDR              WW JUL88
         TM    SPFLAG5,SPFXA            REALLY XA              SS JUL88
         BZ    *+4+4+4+2                NO, SKIP  BSM          SS JUL88
         LA    R1,*+4+4+2               POINT AFTER BSM        SS JUL88
         O     R1,ISPX80                31 BIT MODE            SS JUL88
         BSM   0,R1                     SET MODE               SS JUL88
         L     R2,DSABSIOT              POINT TO SIOT          WW JUL88
         L     R2,SJFCBPTR-SIOT(R2)     JFCB ADDR              WW JUL88
.MVS22CX ANOP                                                  SS JUL88
         TM    SPFATFLG,SPFATYSE                              DRK JAN01
         BO    *+4+4+2+4+2+4                                  DRK FEB02
         LA    R1,JFCDSORG-JFCB(,R2)    DSORG                 DRK JAN01
         LR    R15,R2                   SAVE JFCB ADDR        DRK JAN01
         BAS   R2,ISPDSORG                                    DRK JAN01
         LR    R2,R15                   RESTORE JFCB ADDR     DRK JAN01
         STCM  R0,15,SPFATYPE                                 DRK JAN01
         MVC   SPFADSN,JFCBDSNM-JFCB(R2)                       SS NOV85
         MVC   SPFAMEM,JFCBELNM-JFCB(R2)                       SS NOV85
         TM    JFCBIND2-JFCB(R2),JFCNEW                        SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAALLC,=C'NEW '                               SS NOV85
         TM    JFCBIND2-JFCB(R2),JFCMOD                        SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAALLC,=C'MOD '                               SS NOV85
         TM    JFCBIND2-JFCB(R2),JFCOLD                        SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAALLC,=C'OLD '                               SS NOV85
         TM    JFCBIND2-JFCB(R2),JFCSHARE                      SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAALLC,=C'SHR '                               SS NOV85
         TM    JFCBIND2-JFCB(R2),JFCTEMP                       SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFAALLC,=C'TMP '                               SS NOV85
         ST    R2,SPFSAVER              SAVE JFCB ADDRESS     DRK JUL03
         AIF   ('&MVSLEV' LT 'MVS220').MVS22D                  WW JUL88
         TM    SPFLAG5,SPFXA            REALLY XA              SS JUL88
         BZ    *+4+4+2                  NO, SKIP  BSM          SS JUL88
         LA    R1,*+4+2                 POINT AFTER BSM        SS JUL88
         BSM   0,R1                     SET MODE 24            SS JUL88
         L     R1,SPFATMP2        RELOAD TIOT ADDRESS          SS JUL88
.MVS22D  ANOP                                                  SS JUL88
         L     R2,SPFATMP1        GET DSAB                     SS NOV85
         MVC   SPFASTAT,ISPBLK8                                SS NOV85
         TM    DSABFLG1,DSABPALC  PERMANENT                    SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFASTAT,=C'PRM '                               SS NOV85
         TM    DSABFLG1,DSABCONV  CONVERTIBLE                  SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFASTAT,=C'CNV '                               SS NOV85
         TM    DSABFLG3,DSABVAM   VIO                          SS NOV85
         BZ    ISPLATAA                                        SS NOV85
         MVC   SPFATYPE,=C'VIO '                               SS NOV85
         OI    SPFATFLG,SPFANUCB+SPFATYSE                      SS NOV85
         B     ISPLSTA5                                        SS NOV85
ISPLATAA DS    0H                                              SS NOV85
         TM    DSABFLG3,DSABCATL  THIS A CATALOG               SS NOV85
         BZ    ISPLATAB                                        SS NOV85
         MVC   SPFATYPE,=C'CTLG'                               SS NOV85
         OI    SPFATFLG,SPFATYSE                               SS NOV85
         B     ISPLSTA2                                        SS NOV85
ISPLATAB DS    0H                                              SS NOV85
         TM    DSABFLG3,DSABVVDS  THIS A CATALOG               SS NOV85
         BZ    ISPLATAC                                        SS NOV85
         MVC   SPFATYPE,=C'VVDS'                               SS NOV85
         OI    SPFATFLG,SPFATYSE                               SS NOV85
         B     ISPLSTA2                                        SS NOV85
ISPLATAC DS    0H                                              SS NOV85
         TM    TIOELINK,TIOESYOT  SYSOUT                       SS NOV85
         BZ    ISPLSTA1           NO TRY TERM                  SS NOV85
         MVC   SPFATYPE,=C'JES '                               SS NOV85
         OI    SPFATFLG,SPFANUCB+SPFATYSE                      SS NOV85
         MVC   SPFAVOL,=CL6'CLS='                              SS NOV85
         MVC   SPFAVOL+5(1),SPFACLS                            SS NOV85
         B     ISPLSTA4                                        SS NOV85
ISPLSTA1 DS    0H                                              SS NOV85
         TM    TIOELINK,TIOTTERM                               SS NOV85
         BZ    ISPLSTA2                                        SS NOV85
         OI    SPFATFLG,SPFANUCB+SPFATYSE                      SS NOV85
         MVC   SPFATYPE,=C'TERM'                               SS NOV85
         B     ISPLSTA5                                        SS NOV85
ISPLSTA2 DS    0H                                              SS NOV85
         CLC   SPFADSN(8),=C'NULLFILE'                         SS NOV85
         BE    ISPLSTA5                                        SS NOV85
         TM    SPFATFLG,SPFANUCB                               SS NOV85
         BO    ISPLSTA5                                        SS NOV85
         SR    R2,R2                                           SS NOV85
         IC    R2,TIOELNGH                                     SS NOV85
         CH    R2,=H'20'         ONE DEV ENTRY LONG            SS NOV85
         BH    ISPLSTA3                                        SS NOV85
         SR    R2,R2                                           SS NOV85
         ICM   R2,7,TIOEFSRT     UCB ADDR                      SS NOV85
         MVC   SPFAVOL,UCBVOLI-UCBOB(R2) GET VOLUME            SS NOV85
         B     ISPLSTA4                                        SS NOV85
ISPLSTA5 MVC   SPFAVOL,ISPBLK8                                 SS NOV85
         B     ISPLSTA4                                        SS NOV85
ISPLSTA3 MVC   SPFAVOL,=C'*MULT*'                              SS NOV85
ISPLSTA4 DS    0H                                              SS NOV85
         MVC   SPFABLKS(5),ISPBLK8                            DRK JUL03
         MVC   SPFALREC(5),ISPBLK8                            DRK JUL03
         MVC   SPFARECF(4),ISPBLK8                            DRK JUL03
         CLI   SPFADDNM+2,C'#'          CONCATENATION?        DRK JUL03
         BNE   ISPLSTAZ                 NO                    DRK JUL03
         LA    R14,SPFADSN              GET DSNAME            DRK JUL03
         LA    R1,SPFAVOL               AND VOL               DRK JUL03
         BAS   R2,ISPDSCB               READ DSCB             DRK JUL03
         LTR   R15,R15                  GOOD READ             DRK JUL03
         BNZ   ISPNULLF                 NO, BYPASS            DRK JUL03
ISPLSTAZ DS    0H                                             DRK JUL03
         TM    SPFLAG5,SPFXA            REALLY XA             DRK JUL03
         BZ    *+4+4+4+2                NO, SKIP  BSM         DRK JUL03
         LA    R1,*+4+4+2               POINT AFTER BSM       DRK JUL03
         O     R1,ISPX80                31 BIT MODE           DRK JUL03
         BSM   0,R1                     SET MODE              DRK JUL03
         L     R2,SPFSAVER              RESTORE JFCB ADDR     DRK JUL03
         SPACE 1
         CLC   SPFADSN(8),=C'NULLFILE'  DUMMY?                DRK JUN03
         BE    ISPNULLF                 YES, SKIP             DRK JUN03
         SR    R1,R1                                          DRK JUN03
         CLI   SPFADDNM+2,C'#'          CONCATENATION?        DRK JUL03
         BNE   *+4+4+4                  NO                    DRK JUL03
         ICM   R1,3,SPFDSCB+DS1BLKL-DS1FMTID   USE OBTAIN     DRK JUL03
         B     *+4+4                                          DRK JUL03
         ICM   R1,3,JFCBLKSI-JFCB(R2)   BLKSIZE               DRK JUN03
         LTR   R1,R1                    ZERO?                 DRK JUN03
         BZ    ISPNULLF                 YES, SKIP             DRK JUN03
         LR    R15,R2                   SAVE JFCB ADDR        DRK JUN03
         BAS   R2,ISPDECCV                                    DRK JUN03
         LR    R2,R15                   RESTORE JFCB ADDR     DRK JUN03
         MVC   SPFABLKS,SPFDCNV5                              DRK JUN03
         SR    R1,R1                                          DRK JUN03
         CLI   SPFADDNM+2,C'#'          CONCATENATION?        DRK JUL03
         BNE   *+4+4+4                  NO                    DRK JUL03
         ICM   R1,3,SPFDSCB+DS1LRECL-DS1FMTID  USE OBTAIN     DRK JUL03
         B     *+4+4                                          DRK JUL03
         ICM   R1,3,JFCLRECL-JFCB(R2)   LRECL                 DRK JUN03
         LR    R15,R2                   SAVE JFCB ADDR        DRK JUN03
         BAS   R2,ISPDECCV                                    DRK JUN03
         LR    R2,R15                   RESTORE JFCB ADDR     DRK JUN03
         MVC   SPFALREC,SPFDCNV5                              DRK JUN03
* RECFM LOOP FROM PETER HAVERCAN (VTOCLIST)                   DRK JUN03
         LA    R14,SPFARECF             OUTPUT RECFM          DRK JUN03
         CLI   SPFADDNM+2,C'#'          CONCATENATION?        DRK JUL03
         BNE   *+4+4+4                  NO                    DRK JUL03
         L     R0,SPFDSCB+DS1RECFM-DS1FMTID    USE OBTAIN     DRK JUL03
         B     *+4+4                                          DRK JUL03
         L     R0,JFCRECFM-JFCB(,R2)    INPUT RECFM           DRK JUN03
         LA    R1,FMTYPES               TABLE OF RECFM TYPES  DRK JUN03
         LA    R15,7                    NO OF BITS TO TEST    DRK JUN03
         STCM  R0,8,FULLWORD            STORE RECFM FOR TM    DRK JUL03
         TM    FULLWORD,B'11000000'     CHECK FOR U           DRK JUL03
         BNO   ISPFMLP                  NOT UNDEFINED         DRK JUN03
         MVI   0(R14),C'U'              MOVE IN U             DRK JUN03
         N     R0,=X'3FFFFFFF'          OFF F & V BITS        DRK JUN03
         B     ISPFMJMP                 AND JOIN LOOP         DRK JUN03
ISPFMLP  DS    0H                                             DRK JUN03
         LTR   R0,R0                    TEST SIGN BIT         DRK JUN03
         BNM   ISPFMEND                 BIT IS OFF            DRK JUN03
         MVC   0(1,R14),0(R1)           MOVE CORRESP CHAR     DRK JUN03
ISPFMJMP DS    0H                                             DRK JUN03
         LA    R14,1(,R14)              PT@ NEXT OUTPUT SPOT  DRK JUN03
ISPFMEND DS    0H                                             DRK JUN03
         LA    R1,1(,R1)                PT@ NEXT TYPE IN LIST DRK JUN03
         SLL   R0,1                     SHIFT OVER NEXT BIT   DRK JUN03
         BCT   R15,ISPFMLP              AND GO TEST IT        DRK JUN03
         SPACE 1
         SR    R1,R1                                          DRK JUL03
         CLI   SPFADDNM+2,C'#'          CONCATENATION?        DRK JUL03
         BNE   *+4+4+4                  NO                    DRK JUL03
         ICM   R1,1,SPFDSCB+DS1CREDT-DS1FMTID  USE OBTAIN     DRK JUL03
         B     *+4+4                                          DRK JUL03
         ICM   R1,1,JFCBCRDT-JFCB(R2)   YY - BINARY           DRK JUL03
         CVD   R1,DOUBLE                                      DRK JUL03
         MVO   DOUBLE+6(2),DOUBLE+6(2)                        DRK JUL03
         MVC   MEMLWK(1),DOUBLE+6       YY                    DRK JUL03
         SR    R1,R1                                          DRK JUL03
         CLI   SPFADDNM+2,C'#'          CONCATENATION?        DRK JUL03
         BNE   *+4+4+4                  NO                    DRK JUL03
         ICM   R1,3,SPFDSCB+DS1CREDT-DS1FMTID+1 USE OBTAIN    DRK JUL03
         B     *+4+4                                          DRK JUL03
         ICM   R1,3,JFCBCRDT-JFCB+1(R2) DDDD - BINARY         DRK JUL03
         CVD   R1,DOUBLE                                      DRK JUL03
         MVC   MEMLWK+1(2),DOUBLE+6     DDDC                  DRK JUL03
         OI    MEMLWK+2,X'0F'           DDDF                  DRK JUL03
         LA    R1,MEMLWK                POINT TO YYDDDF       DRK JUL03
         LA    R15,FULLWORD+1                                 DRK JUL03
         L     R2,=V(CONVDATE)                                DRK JUL03
         BASR  R14,R2                                         DRK JUL03
         MVC   FULLWORD(1),FULLWORD+3   CONVERT TO YYMMDD     DRK JUL03
         MVC   SPFAMEM(L'DAT2MASK),DAT2MASK                   DRK JUL03
         ED    SPFAMEM(L'DAT2MASK),FULLWORD                   DRK JUL03
         OI    SPFAMEM+1,X'F0'          SHOW YY               DRK JUL03
         MVC   SPFAMEM(8),SPFAMEM+1                           DRK JUL03
         SPACE 1
ISPNULLF DS    0H                                             DRK JUN03
         TM    SPFLAG5,SPFXA            REALLY XA             DRK JUL03
         BZ    *+4+4+2                  NO, SKIP  BSM         DRK JUL03
         LA    R1,*+4+2                 POINT AFTER BSM       DRK JUL03
         BSM   0,R1                     SET MODE 24           DRK JUL03
         SPACE 1
         L     R2,SPFATMP1       RESET DSAB ADDR               SS NOV85
*        SR    R1,R1                                           SS AUG86
*        ICM   R1,7,DSABSSVA     SIOT                          SS AUG86
         CLI   SPFPRBI2,0               ANY OPTIONS?          ABL JAN87
         BNE   ISPLSA80                 YES, DO FILTERING     ABL JAN87
         CLI   SPFPRBI1,0               ANY OPTIONS?           SS AUG86
         BE    ISPLSTAU                 NO, DO TABLE UPDATE    SS AUG86
ISPLSA80 DS    0H                                             ABL JAN87
         TM    SPFPRBI1,X'80'           TEST OPEN              SS AUG86
         BZ    ISPLSA40                 *                      SS AUG86
         CLI   SPFAOCNT,C'0'            OPEN COUNT ZERO        SS AUG86
         BNE   ISPLSTAU                 NO, THEN OPEN          SS AUG86
ISPLSA40 TM    SPFPRBI1,X'40'           UNOPEN                 SS AUG86
         BZ    ISPLSA20                 *                      SS AUG86
         CLI   SPFAOCNT,C'0'            OPEN COUNT ZERO        SS AUG86
         BE    ISPLSTAU                 NO, THEN OPEN          SS AUG86
ISPLSA20 TM    SPFPRBI1,X'20'           CONCATENATED           SS AUG86
         BZ    ISPLSA10                 *                      SS AUG86
         TM    DSABFLG1,DSABCATM        CAT FLAG               SS AUG86
         BO    ISPLSTAU                 YES                    SS AUG86
ISPLSA10 TM    SPFPRBI1,X'10'           NONCONCATENATED        SS AUG86
         BZ    ISPLSA08                 *                      SS AUG86
         TM    DSABFLG1,DSABCATM        CAT FLAG               SS AUG86
         BZ    ISPLSTAU                 NO                     SS AUG86
ISPLSA08 TM    SPFPRBI1,X'08'           NULLFILE               SS AUG86
         BZ    ISPLSA04                 *                      SS AUG86
         CLC   SPFADSN(8),=C'NULLFILE'  NULLFILE               SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA04 TM    SPFPRBI1,X'04'           ATTRIB                 SS AUG86
         BZ    ISPLSA02                 *                      SS AUG86
         CLC   SPFADSN(8),=C'NULLFILE'  NULLFILE               SS AUG86
         BNE   ISPLSA01                 NETHER TERM OR ATTRIB  SS AUG86
         CLC   SPFATYPE,=C'TERM'        TERMINAL               SS AUG86
         BNE   ISPLSTAU                 NO, JUST DUMMY         SS AUG86
         B      ISPLSA01                NOT TERMINAL           SS AUG86
ISPLSA02 TM    SPFPRBI1,X'02'           TERMINAL               SS AUG86
         BZ    ISPLSA01                 *                      SS AUG86
         CLC   SPFATYPE,=C'TERM'        TERMINAL               SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA01 TM    SPFPRBI1,X'01'           TERMINAL               SS AUG86
         BZ    ISPLSA8X                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFATYPE,=C'JES '        JES FILE               SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA8X TM    SPFPRBI2,X'80'           TMP                    SS AUG86
         BZ    ISPLSA4X                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFAALLC,=C'TMP '        TMP                    SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA4X TM    SPFPRBI2,X'40'           NEW                    SS AUG86
         BZ    ISPLSA2X                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFAALLC,=C'NEW '        NEW                    SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA2X TM    SPFPRBI2,X'20'           MOD                    SS AUG86
         BZ    ISPLSA1X                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFAALLC,=C'MOD '        MOD                    SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSA1X TM    SPFPRBI2,X'10'           OLD                    SS AUG86
         BZ    ISPLSAX8                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFAALLC,=C'OLD '        OLD                    SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
ISPLSAX8 TM    SPFPRBI2,X'08'           SHR                    SS AUG86
         BZ    ISPLSTAS                 NONE OF THE ABOVE      SS AUG86
         CLC   SPFAALLC,=C'SHR '        SHR                    SS AUG86
         BE    ISPLSTAU                 YES                    SS AUG86
         B     ISPLSTAS                 SKIP IT                SS AUG86
ISPLSTAU DS    0H                       *                      SS AUG86
         BAS   R2,ISPTBADD                                     SS NOV85
ISPLSTAS DS    0H                       *                      SS AUG86
         L     R2,SPFATMP1       RESET DSAB ADDR               SS NOV85
         L     R2,DSABFCHN                                     SS NOV85
         ST    R2,SPFATMP1       NEW   DSAB ADDR               SS NOV85
         B     ISPLSTAL          LOOP TO TOP                   SS NOV85
* RETURN TO TBDISPL                                            SS NOV85
ISPLSTAX DS    0H                                              SS NOV85
         LA    R15,1                                           SS NOV85
         ST    R15,SPFTTOP                                     SS NOV85
         ST    R15,SPFTTOP2                                    SS JUL87
         BAS   R2,ISPTOP                                       SS NOV85
         LA    R15,100           GO TO TBDISPL                 SS NOV85
         BR    R3                                              SS NOV85
         DROP  R1,R2                                           SS NOV85
ISPLSTAE DS    0H                                              SS NOV85
*        LA    R15,28       INVALID                            SS DEC87
*        BR    R3                                              SS DEC87
         MVC   SPFVZCMD(250),SPFINPUT COPY BAD COMMAND         SS DEC87
         LA    R15,ISPLTAPP       ADDRESS OF PANEL TABLE       SS OCT88
         LA    R1,SPFMSGID        SET FOR MESSAGE              SS DEC87
         BAS   R2,ISPSINGI        DISPLAY PANEL                SS DEC87
         MVI   SPFMSGID,C' '      CLEAR MESSAGE ID             SS DEC87
         L     R2,=A(ISPLTVQ3)                                DRK JUN03
         C     R15,ISPL8          END KEY                      SS DEC87
         BER   R2                 RETURN TO FUNCTION CMD      DRK JUN03
*        BE    ISPLTVQ3           RETURN TO FUNCTION CMD       SS DEC87
         MVC   SPFINPUT(250),SPFZSEL    COPY                   SS DEC87
         LA    R15,SPFINPUT             STARTING ADDRESS       SS DEC87
         LA    R14,30                   LENGTH                 SS DEC87
         LA    R1,C' '                  BLANK                  SS DEC87
         BAS   R2,ISPCLI                FIND BLANK AFTER CMD   SS DEC87
         B     ISPLTART                 RETRY                  SS DEC87
ISPLTA5  DS    0H                       *                      SS AUG86
         L     R15,SPFOPER              BLANK AFTER CMD        SS FEB89
         LA    R14,30                   SCAN FOR OPERAND       SS FEB89
         BAS   R2,ISPCKBLK                                     SS FEB89
         LTR   R15,R15                  ANY                    SS FEB89
         BNZ   ISPLTA1B                 YES, CANNOT PROCESS    SS FEB89
         LH    R1,SPFFUNLP+4      GET LAST PANEL               SS AUG86
         LNR   R1,R1                    *                      SS AUG86
         BAS   R2,ISPSTKI         SWAP PANEL                   SS AUG86
         LA    R15,36             GO TO PENDING ACT PROC       SS AUG86
         BR    R3                                              SS NOV85
ISPLTA1B DS    0H                       *                      SS FEB89
         MVC   SPFMSGID,ISPPDSM         GENERIC MESSAGE        SS FEB89
         MVI   SPFMSGID+6,C'1'          PDSM..1B MESSAGE       SS FEB89
         MVI   SPFMSGID+7,C'B'          BUSY MSG               SS FEB89
         LA    R15,100                  TO DISPLAY             SS FEB89
         BR    R3                       RETURN TO ROUTER       SS FEB89
ISPLTAPP DC    CL8'&P.LALTA'            *                      SS OCT88
FMTYPES  DC    CL8'FVTBSAM'             PERMISSIBLE RECFM'S   DRK JUN03
DAT2MASK DC    X'402120612020612020'                          DRK JUL03
         LTORG ,                                               SS NOV85
ISPLSTAP DS    0F                                 MATCHES      SS AUG86
***                                               ============ SS AUG86
         DC    X'32',X'000001',CL8'ALL'           A/ALL        SS AUG86
         DC    X'31',X'800000',CL8'OPEN'          O/OP        ABL JAN87
         DC    X'21',X'400000',CL8'CLOSED'      **CL          ABL JAN87
         DC    X'31',X'400000',CL8'UNOPEN'      **U/UN         SS AUG86
         DC    X'21',X'200000',CL8'CATENATE'     *CA          ABL JAN87
         DC    X'21',X'200000',CL8'CONCAT'       *CO          ABL JAN87
         DC    X'22',X'100000',CL8'NONCON'      **NON          SS AUG86
         DC    X'22',X'100000',CL8'NONCAT'      **NON          SS AUG86
         DC    X'34',X'080000',CL8'DUMMY'        *D/DUMMY      SS AUG86
         DC    X'33',X'080000',CL8'NULLFILE'     *N/NULL       SS AUG86
         DC    X'23',X'040000',CL8'ATTRIB'        ATTR         SS AUG86
         DC    X'33',X'020000',CL8'TERMINAL'      T/TERM       SS AUG86
         DC    X'32',X'010000',CL8'JESFILE'       J/JES        SS AUG86
         DC    X'23',X'008000',CL8'TEMPORY'      *TEMP         SS AUG86
         DC    X'22',X'008000',CL8'TMP'          *TMP          SS AUG86
         DC    X'22',X'004000',CL8'NEW'           NEW          SS AUG86
         DC    X'22',X'002000',CL8'MOD'           MOD          SS AUG86
         DC    X'22',X'001000',CL8'OLD'           OLD          SS AUG86
         DC    X'22',X'000800',CL8'SHR'           SHR          SS AUG86
         DC    X'23',X'000200',CL8'TASKLIB'       TASK         SS JUL87
         DC    X'22',X'000002',CL8'SETDEF'        SET         ABL JAN87
         DC    X'FF'                    *                      SS AUG86
         DC    X'23',X'000004',CL8'LNKLST'        LNKL         SS JUL87
         DS    0F                                              SS NOV85
ISPLSTAV DC    H'0',X'10',X'00'                                SS NOV85
         DC    A(VSPFADDN),AL2(SPFADDNM-SPWRKC),H'08'          SS NOV85
         DC    A(VSPFADSN),AL2(SPFADSN-SPWRKC),H'44'           SS NOV85
         DC    A(VSPFAVOL),AL2(SPFAVOL-SPWRKC),H'06'           SS NOV85
         DC    A(VSPFADSB),AL2(SPFADSAB-SPWRKC),H'04'          SS NOV85
         DC    A(VSPFAFLG),AL2(SPFAFLAG-SPWRKC),H'08'          SS NOV85
         DC    A(VSPFACNT),AL2(SPFACCNT-SPWRKC),H'02'          SS NOV85
         DC    A(VSPFABLK),AL2(SPFABLKS-SPWRKC),H'05'         DRK JUN03
         DC    X'FF'                                           SS NOV85
VSPFADDN DC    C'(PDSADDN PDSADATA PDSAMEM)'                   SS NOV85
VSPFADSN DC    C'PDSADSN '                                     SS NOV85
VSPFAVOL DC    C'PDSAVOL '                                     SS MAY88
VSPFADSB DC    C'(PDSADSAB PDSAOPT PDSATYPE PDSADISP PDSACDSP PDSAOCNT X
               PDSAALLC PDSASTAT PDSARECF)'                   DRK JUN03
VSPFAFLG DC    C'PDSAFLAG '                                    SS NOV85
VSPFACNT DC    C'PDSACCNT '                                    SS NOV85
VSPFABLK DC    C'(PDSABLKS PDSALREC)'                         DRK JUN03
ISPLSTAN DC    C'(PDSAOPT PDSADDN PDSADATA PDSADSAB PDSATYPE PDSADISP  X
               PDSACDSP PDSAOCNT PDSAFLAG PDSAVOL PDSADSN PDSAMEM      X
               PDSAALLC PDSASTAT PDSACCNT PDSABLKS PDSALREC PDSARECF)'
         SPACE 2
         DROP  R4                                             DRK NOV98
         TITLE 'LISTV FUNCTION '                               SS AUG86
*************************************************************  SS NOV85
*                                                              SS NOV85
*      LISTV  FUNCTION                                         SS NOV85
*                                                              SS NOV85
*************************************************************  SS NOV85
         SPACE 2
ISPLISTV DS    0H                                              SS NOV85
         USING *,R4                                            SS NOV85
         SPACE 1
* HIERARCHICAL SUPPORT REMOVED                                 SS OCT88
         BAS   R2,ISPSETST              SET STATS PREV TABLE   SS AUG86
         CLI   SPFFUNST+3,C'P'          LISTV   PENDING ACT    SS AUG86
         BE    ISPLTVQ5                 YES, LET TBDSP REPROC  SS AUG86
         NI    SPFTSVDF+1,255-X'01'     CLEAR PROMPT FLAG      SS AUG86
*  DO PARSE ON LISTV COMMAND                                   SS NOV85
         L     R15,SPFOPER      FIRST BLANK AFTER CMD          SS NOV85
ISPLSTVH DS    0H                                              SS AUG86
         LA    R14,30           MAX LENGTH                     SS NOV85
         LA    R1,ISPLSTVP      PARSE LIST                     SS NOV85
         BAS   R2,ISPPARSI      PARSE IT                       SS NOV85
         C     R15,ISPL8        RETURN CODE                    SS NOV85
         BH    ISPLSTVE         ERROR                         ABL APR86
         BE    ISPLSTVQ         NO OPTIONS                     SS NOV85
*        TM    SPFPRBI,X'80'+X'40'  ADDR AND GROUP             SS NOV85
         TM    SPFPRBI,X'04'+X'40'  ADDR AND GROUP             SS MAR88
         BO    ISPLSTVK         BOTH ON, CONFLICT              SS NOV85
* CHECK FOR RANGE ON STRING LENGTH 3 OR 5 FOR ADDR OR VOL/GRP DRK MAY98
         LH    R1,SPFPRLN       GET LENGTH                     SS NOV85
         TM    SPFPRBI,X'40'    GROUP                          SS NOV85
         BZ    ISPLSTV2         NO                             SS NOV85
         CH    R1,=H'7'                                        SS NOV85
         BH    ISPLSTVW                                        SS NOV85
         B     ISPLSTV3                                        SS NOV85
ISPLSTV2 DS    0H                                              SS NOV85
         CH    R1,=H'5'         MAX                            SS NOV85
         BH    ISPLSTVW                                        SS NOV85
*        TM    SPFPRBI,X'40'    BY ADDRESS                     SS FEB88
         TM    SPFPRBI,X'04'    BY ADDRESS                     SS MAR88
         BZ    *+12                                            SS NOV85
         CH    R1,=H'3'         MUST BE LESS (4DIGIT UCBS)    DRK MAY98
         BH    ISPLSTVW                                        SS NOV85
ISPLSTV3 DS    0H                                              SS NOV85
         L     R14,SPFPRSR         STRING ADDRESS              SS NOV85
         OC    0(0,R14),ISPBLK8    <<EXECUTED>>                SS NOV85
         EX    R1,*-6              FORCE UPPER CASE            SS NOV85
* DO VDEF                                                      SS NOV85
         LA    R1,ISPLSTVV        DEF VAR TABLE                SS NOV85
         BAS   R2,ISPVDEFX                                     SS NOV85
* STACK 17                                                     SS NOV85
         CLI   SPFTBPFI+1,3       ALREADY AT LISTV?            SS AUG86
         BE    ISPLSTVR           THEN CHECK FOR RESET         SS AUG86
         CLI   SPFFUNST+3,C'I'    INACTIVE                     SS AUG86
         BE    ISPLTV2            YES   *                      SS AUG86
         LH    R1,SPFFUNLP+6      GET LAST PANEL               SS AUG86
         LNR   R1,R1                    *                      SS AUG86
         BAS   R2,ISPSTKI         SWAP PANEL                   SS AUG86
         B     ISPLSTVR           CHECK FOR RESET              SS AUG86
ISPLTV2  DS    0H                       *                      SS AUG86
         LA    R1,17              PANEL H                      SS NOV85
         LNR   R1,R1              SET FOR SWAP                 SS AUG86
         BAS   R2,ISPSTKI         STACK IT                     SS NOV85
         B     ISPLSTVO           OPEN                         SS NOV85
ISPLSTVR DS    0H                                              SS NOV85
*  RESET TB IS OPEN AND RESET OPTION                           SS NOV85
         TM    SPFPRBI,X'08'      RESET REQUEST                SS NOV85
         BZ    ISPLSTV1           NO, SKIP END AND OPEN        SS NOV85
         BAS   R2,ISPTBEND                                     SS NOV85
ISPLSTVO DS    0H                                              SS NOV85
* OPEN TB                                                      SS NOV85
         MVC   SPFTBL,SPFCSUF    GET BASE NAME                 SS NOV85
         MVI   SPFTBL+2,C'V'     SET TO PDV                    SS NOV85
         XC    SPFTFLG1(4),SPFTFLG1                            SS NOV85
         XC    SPFTFF(2),SPFTFF                                SS NOV85
*        TM    SPFPRBI,X'40'     ADDRESS ORDER                 SS FEB88
         TM    SPFPRBI,X'04'     ADDRESS ORDER                 SS MAR88
         BZ    ISPLSTVS          NO SORT IN VOL ORDER          SS AUG86
         LA    R15,ISPLSTVM      SORT LIST (BY ADDR)           SS AUG86
         B     ISPLSTVF          COMPLETE                      SS AUG86
ISPLSTVS DS    0H                       *                      SS AUG86
*        OI    SPFTFLG3,SPFTSDEF THIS IS DEFAULT               SS OCT88
*        LA    R15,ISPLSTVG      SORT LIST (BY VOL)            SS OCT88
ISPLSTVF DS    0H                       *                      SS OCT88
*        ST    R15,SPFTSORA             *                      SS AUG86
*        OI    SPFTFLG3,SPFTSORT        *                      SS AUG86
         LA    R15,VSPFVVOL      VOL IS KEY                    SS NOV85
         LA    R0,ISPLSTVN       VER NAMES                     SS NOV85
         BAS   R2,ISPTBOPN                                     SS NOV85
         BAS   R2,ISPSETST         ALSO INIT STATUS FLAG       SS AUG86
*        LA    R1,9              NORMAL SORT                   SS OCT88
         LH    R1,SPFTBPSR       GET SORT DEFAULT              SS OCT88
         TM    SPFPRBI,X'04'     BY ADDRESS ORDER              SS OCT88
         BZ    *+8                      *                      SS OCT88
         LA    R1,3(,R1)         NEXT ENTRY                    SS OCT88
         LR    R0,R1                    *                      SS OCT88
         MVC   SPFTSVX,SPFPRBI2  SAVE OPTION FLAG              SS FEB90
         BAS   R2,ISPSORTI       CALL SORT INIT                SS OCT88
         MVC   SPFPRBI2,SPFTSVX  RESTORE FLAG                  SS FEB90
         LA    R15,1                                           SS NOV85
         ST    R15,SPFTTOP                                     SS NOV85
         ST    R15,SPFTTOP2                                    SS JUL87
         OI    SPFPRBI2,X'80'    TERMINATE IF NO VOLUME FOUND ABL APR86
*  SET UP UCB SCAN                                             SS NOV85
ISPLSTV1 DS    0H                                              SS NOV85
         TM    SPFPRBI,X'40'       GROUP                       SS NOV85
         BO    ISPLSTVA            YES                         SS NOV85
         L     R1,SPFSEC4A         GET  BASE                   SS MAY88
         LA    R1,SPFUCBSN-SPFSEC4K(,R1) POINT TO SPFUCBSN     SS MAY88
         XC    0(100,R1),0(R1)     ZERO FOR FRESH START        SS MAY88
*        XC    SRVUCBIC,SRVUCBIC   ZERO UCBSCAN IOC TOKEN     DRK JUN98
         L     R1,CVTPTR(,R0)      CVT                         SS NOV85
         L     R1,CVTUCBSC-CVT(R1) IOSSVSUCB  UCB SCAN         SS NOV85
         ST    R1,SPFVTMP2         SAVE ADDRESS                SS NOV85
         B     ISPLSTVL            START LOOP                  SS NOV85
ISPLSTVI DC    X'1000'             IEFEB4UV REQUEST           ABL MAR88
ISPLSTVA DS    0H                                              SS NOV85
*  SET UP CALL FOR IEFEB4UV                                    SS NOV85
         TM    SPFLAG5,SPFXA            XA SYSTEM              SS JUL88
         BO    ISPLSTVX                 YES USE IEFEB4UV       SS JUL88
* SET UP CALL FOR 370 GET GENERIC       *                      SS AUG86
         L     R1,SPFSEC4A         GET  BASE                   SS MAY88
         LA    R1,SPFUCBSN-SPFSEC4K(,R1) POINT TO SPFUCBSN     SS MAY88
         XC    0(100,R1),0(R1)     ZERO FOR FRESH START        SS MAY88
         ST    R1,PARMLIST              *                      SS AUG86
         LA    R1,PARMLIST+12           GENERIC NAME           SS AUG86
         ST    R1,PARMLIST+4            PARM 2                 SS AUG86
         LA    R1,SPFUCBA               RETURN UCB ADDR        SS AUG86
         ST    R1,PARMLIST+8            PARM 3                 SS AUG86
         MVC   PARMLIST+12(8),ISPBLK8 PRE BLANK                SS AUG86
         LH    R1,SPFPRLN          GET LENGTH                  SS AUG86
         L     R14,SPFPRSR         GET NAME ADDRESS            SS AUG86
         MVC   PARMLIST+12(0),0(R14)  COPY NAME                SS AUG86
         EX    R1,*-6              COPY FOR LENGTH             SS AUG86
         LA    R1,PARMLIST              *                      SS AUG86
         L     R15,ISPGET3A             ADDRESS OF ROUTINE     SS AUG86
         ST    R15,SPFVTMP2             SAVE RTN ADDRESS       SS AUG86
         BASR  R14,R15                  *                      SS AUG86
         LTR   R15,R15                  *                      SS AUG86
         BNZ   ISPLSTVD                 NONE                   SS AUG86
         OI    SPFPRBI,X'02'            370 GENERIC            SS AUG86
         L     R1,SPFUCBA               *                      SS AUG86
         B     ISPLSTVC                 PROCESS UCB            SS AUG86
ISPLSTVX DS    0H                       *                      SS AUG86
         AIF   ('&MVSLEV' GE 'MVS410').MVS41E                 DRK JUN98
         LA    R1,PARMLIST+8       UNIT TABLE                  SS AUG86
         ST    R1,PARMLIST         SET POINTER                 SS AUG86
         LA    R1,ISPLSTVI         REQUEST FLAG                SS AUG86
         ST    R1,PARMLIST+4       SET POINTER                 SS AUG86
         MVC   PARMLIST+8(8),ISPBLK8  PRE BLANK                SS AUG86
         LH    R1,SPFPRLN          GET LENGTH                  SS AUG86
         L     R14,SPFPRSR         GET NAME ADDRESS            SS AUG86
         MVC   PARMLIST+8(0),0(R14) COPY NAME                  SS AUG86
         EX    R1,*-6              COPY FOR LENGTH             SS AUG86
         SR    R1,R1                    *                      SS AUG86
         ST    R1,PARMLIST+20      ZERO ATTRIBUTE AREA         SS AUG86
         LA    R1,PARMLIST         POINT TO PARMLIST           SS AUG86
         LINK  EP=IEFEB4UV         XA SERVICE ROUTINE          SS AUG86
         LTR   R15,R15                  *                      SS AUG86
         BNZ   ISPLSTVD            NO ENTRIES                  SS AUG86
         L     R15,PARMLIST+16     GET POINTER TO LIST         SS AUG86
         ST    R15,SPFTSV1         SAVE                        SS AUG86
         L     R1,4(,R15)          GET COUNT                   SS AUG86
         LA    R1,1(,R1)           COUNT +1 FOR LOOP           SS AUG86
         STH   R1,SPFTSVH          SAVE COUNT                  SS AUG86
         LA    R15,8(,R15)         FIRST ENTRY                 SS AUG86
         ST    R15,SPFVTMP2        LOOP POINTER                SS AUG86
         B     ISPLSTVL
         AGO   .MVS41EX                                       DRK JUN98
.MVS41E  ANOP                                                 DRK JUN98
         L     R1,SPFSEC4A               GET BASE             DRK SEP98
         LA    R1,SPFUCBSN-SPFSEC4K(,R1) POINT TO SPFUCBSN    DRK SEP98
         XC    0(100,R1),0(R1)          ZERO FOR FRESH START  DRK SEP98
*        XC    SRVUCBIC,SRVUCBIC        ZERO UCBSCAN IOC TOKENDRK SEP98
         SPACE 1                                              DRK SEP98
         L     R1,DEVLISTP              PT AT DEVICE NUM LIST DRK JUN98
         MVC   0(4,R1),=A(DEVLISTL)     LENGTH OF LIST        DRK JUN98
         MVC   4(4,R1),=A(0)            ZERO ENTRY COUNT      DRK JUN98
         MVC   GENERIC(8),ISPBLK8       PRE BLANK             DRK JUN98
         LH    R1,SPFPRLN               GET LENGTH            DRK JUN98
         L     R14,SPFPRSR              GET NAME ADDRESS      DRK JUN98
         MVC   GENERIC(0),0(R14)        COPY NAME             DRK JUN98
         EX    R1,*-6                   COPY FOR LENGTH       DRK JUN98
         SPACE 1                                              DRK JUN98
         L     R15,CVTPTR(,R0)              CVT               DRK JUN98
         TM    CVTOSLV1-CVT(R15),HBB5510    4 DIGIT UCB?      DRK JUN98
         BO    MVS510                                         DRK JUN98
         EDTINFO RTNDEVN,                                     DRK JUN98X
               UNITNAME=GENERIC,                              DRK JUN98X
               DEVNLIST=DEVLISTP,                             DRK JUN98X
               DYNAMIC=YES,                                   DRK JUN98X
               MF=(E,SRVEDTPL)                                DRK JUN98
         LTR   R15,R15                  OK?                   DRK JUN98
         BNZ   ISPLSTVD                 NO                    DRK JUN98
         B     ISPLSTVL                 YES                   DRK JUN98
MVS510   DS    0H                                             DRK JUN98
         L     R15,CVTPTR(,R0)              CVT               DRK JUN98
         TM    CVTOSLV1-CVT(R15),HBB5520    LOC=ANY?          DRK JUN98
         BO    MVS520                                         DRK JUN98
         EDTINFO RTNDEVN,                                     DRK JUN98X
               UNITNAME=GENERIC,                              DRK JUN98X
               DEVNLIST=DEVLISTP,                             DRK JUN98X
               DYNAMIC=YES,                                   DRK JUN98X
               RANGE=ALL,                                     DRK JUN98X
               MF=(E,SRVEDTPL)                                DRK JUN98
         LTR   R15,R15                  OK?                   DRK JUN98
         BNZ   ISPLSTVD                 NO                    DRK JUN98
         B     ISPLSTVL                 YES                   DRK JUN98
MVS520   DS    0H                                             DRK JUN98
         EDTINFO RTNDEVN,                                     DRK JUN98X
               UNITNAME=GENERIC,                              DRK JUN98X
               DEVNLIST=DEVLISTP,                             DRK JUN98X
               DYNAMIC=YES,                                   DRK JUN98X
               RANGE=ALL,                                     DRK JUN98X
               LOC=ANY,                                       DRK JUN98X
               MF=(E,SRVEDTPL)                                DRK JUN98
         LTR   R15,R15                  OK?                   DRK JUN98
         BNZ   ISPLSTVD                 NO                    DRK JUN98
         B     ISPLSTVL                 YES                   DRK JUN98
.MVS41EX ANOP                                                 DRK JUN98
*  LOOP THRU UCBS
ISPLSTVL DS    0H                  LOOP                        SS NOV85
         TM    SPFPRBI,X'02'       370 GROUP                   SS AUG86
         BO    ISPLSTVB            YES                         SS AUG86
         TM    SPFPRBI,X'40'       XA GROUP                    SS AUG86
         BZ    ISPLSTUB            NO, THEN UCB SCAN          DRK JUN98
         AIF   ('&MVSLEV' LT 'MVS410').NMVS41E                DRK JUN98
         B     ISPLSTUB            UCBSCAN+EDTINFO SEARCH     DRK JUN98
.NMVS41E ANOP                                                 DRK JUN98
ISPLSTXA DS    0H                XA GROUP                     DRK JUN98
*  EXTRACT ENTRY FROM IEFEB4UV UCB LIST                       DRK JUN98
         L     R1,SPFVTMP2       GET POINTER ADDRESS           SS AUG86
         LA    R15,4(,R1)        NEXT ADDRESS                  SS AUG86
         ST    R15,SPFVTMP2      SAVE IT                       SS AUG86
         LH    R15,SPFTSVH       GET COUNT                     SS AUG86
         BCT   R15,ISPLSTVJ      MORE TO DO                    SS AUG86
*  AT END OF LIST FREEMAIN                                     SS NOV85
         L     R1,SPFTSV1        GET LIST ADDRESS              SS AUG86
         L     R0,0(,R1)         SUBPOOL AND LENGTH            SS AUG86
         FREEMAIN R,LV=(0),A=(1) FREE LIST                     SS AUG86
         B     ISPLSTVD                 *                      SS AUG86
ISPLSTVJ DS    0H                       *                      SS AUG86
         STH   R15,SPFTSVH       SAVE COUNT                    SS AUG86
         L     R1,0(,R1)         GET UCB ADDRESS               SS AUG86
         B     ISPLSTVC                                        SS NOV85
ISPLSTVB DS    0H                  INVOKE GET370GN ROUTINE    DRK JUN98
         L     R1,SPFSEC4A         GET  BASE                   SS MAY88
         LA    R1,SPFUCBSN-SPFSEC4K(,R1) POINT TO SPFUCBSN     SS MAY88
         ST    R1,PARMLIST                                     SS NOV85
         LA    R1,ISPLSTVZ                                     SS NOV85
         ST    R1,PARMLIST+4                                   SS NOV85
         LA    R1,SPFUCBA                                      SS NOV85
         ST    R1,PARMLIST+8                                   SS NOV85
         OI    PARMLIST+8,X'80'                                SS NOV85
         LA    R1,PARMLIST                                     SS NOV85
         L     R15,SPFVTMP2        ROUTINE ADDRESS             SS NOV85
         BASR  R14,R15                                         SS NOV85
         LTR   R15,R15                                         SS NOV85
         BNZ   ISPLSTVD            DONE                        SS NOV85
         L     R1,SPFUCBA                                      SS NOV85
         B     ISPLSTVC            PROCESS UCB
ISPLSTUB DS    0H                  INVOKE UCB SCAN            DRK JUN98
         AIF   ('&MVSLEV' GE 'MVS410').MVS41A                 DRK JUN98
         L     R1,SPFSEC4A         GET  BASE                   SS MAY88
         LA    R1,SPFUCBSN-SPFSEC4K(,R1) POINT TO SPFUCBSN     SS MAY88
         ST    R1,PARMLIST                                     SS NOV85
         LA    R1,ISPLSTVZ                                     SS NOV85
         ST    R1,PARMLIST+4                                   SS NOV85
         LA    R1,SPFUCBA                                      SS NOV85
         ST    R1,PARMLIST+8                                   SS NOV85
         OI    PARMLIST+8,X'80'                                SS NOV85
         LA    R1,PARMLIST                                     SS NOV85
         L     R15,SPFVTMP2        ROUTINE ADDRESS             SS NOV85
         BASR  R14,R15                                         SS NOV85
         LTR   R15,R15                                         SS NOV85
         BNZ   ISPLSTVD            DONE                        SS NOV85
         L     R1,SPFUCBA                                      SS NOV85
         B     ISPLSTVC            PROCESS UCB
         AGO   .MVS41AX                                       DRK JUN98
.MVS41A  ANOP                                                 DRK JUN98
         L     R1,SPFSEC4A         GET  BASE                  DRK JUN98
         LA    R1,SPFUCBSN-SPFSEC4K(,R1) POINT TO SPFUCBSN    DRK JUN98
         LR    R0,R1               UCBSCAN WORKAREA           DRK JUN98
         L     R15,CVTPTR(,R0)     CVT                        DRK JUN98
         TM    CVTOSLV1-CVT(R15),HBB5510  4-DIGIT UCBS?       DRK JUN98
         BO    ISP4DGIT                                       DRK JUN98
         UCBSCAN COPY,                                        DRK JUN98X
               WORKAREA=(R0),                                 DRK JUN98X
               UCBAREA=SRVUCBUC,                              DRK JUN98X
               DCEAREA=SRVUCBDC,                              DRK JUN98X
               DCELEN==H'56',                                 DRK DEC00X
               DYNAMIC=YES,                                   DRK JUN98X
               DEVCLASS=DASD,                                 DRK JUN98X
               MF=(E,SRVUCBPL)                                DRK JUN98
         LTR   R15,R15                                        DRK JUN98
         BNZ   ISPLSTVD            DONE                       DRK JUN98
         LA    R1,SRVUCBUC         UCB ADDRESS                DRK JUN98
         B     ISPLSTVC            PROCESS UCB                DRK JUN98
ISP4DGIT DS    0H                                             DRK JUN98
         UCBSCAN COPY,                                        DRK JUN98X
               WORKAREA=(R0),                                 DRK JUN98X
               UCBAREA=SRVUCBUC,                              DRK JUN98X
               DCEAREA=SRVUCBDC,                              DRK JUN98X
               DCELEN==H'56',                                 DRK DEC00X
               RANGE=ALL,                                     DRK JUN98X
               DYNAMIC=YES,                                   DRK JUN98X
               DEVCLASS=DASD,                                 DRK JUN98X
               MF=(E,SRVUCBPL)                                DRK JUN98
         LTR   R15,R15                                        DRK JUN98
         BNZ   ISPLSTVD            DONE                       DRK JUN98
         LA    R1,SRVUCBUC         UCB ADDRESS                DRK JUN98
         B     ISPLSTVC                                       DRK JUN98
.MVS41AX ANOP                                                 DRK JUN98
*  PROCESS UCB                                                DRK MAY98
ISPLSTVC DS    0H                                              SS NOV85
         USING UCBOB,R1                                        SS NOV85
         CLI   UCBTBYT3,X'20'      REALLY A DASD DEVICE        SS AUG86
         BNE   ISPLSTVL            NO, SKIP IT                 SS AUG86
         TM    UCBSTAT,UCBONLI     IS IT ONLINE                SS NOV85
         BZ    ISPLSTVL            NO, SKIP IT                 SS NOV85
         CLI   UCBVOLI,C' '        ANY VOLUME                  SS NOV85
         BNH   ISPLSTVL            NO VOLUME, SKIP IT          SS NOV85
         TM    UCBSTAT,UCBCHGS+UCBUNLD GOING OFFLINE           SS NOV85
         BNZ   ISPLSTVL            YES, SKIP IT                SS NOV85
         TM    SPFPRBI2,X'0F'      ANY FILTERING               SS APR87
         BZ    ISPLTVV3            NO   *                      SS APR87
         TM    SPFPRBI2,X'08'      SHR TEST                    SS APR87
         BZ    *+12                     *                      SS APR87
         TM    UCBTYP+1,X'20'      SHARE DASD                  SS APR87
         BO    ISPLTVV3            YES, SELECT                 SS APR87
         TM    SPFPRBI2,X'04'      PRIVATE TEST                SS APR87
         BZ    *+12                     *                      SS APR87
         TM    UCBSTAB,UCBBPRV          *                      SS APR87
         BO    ISPLTVV3            YES, SELECT                 SS APR87
         TM    SPFPRBI2,X'02'      PUBLIC  TEST                SS APR87
         BZ    *+12                     *                      SS APR87
         TM    UCBSTAB,UCBBPUB          *                      SS APR87
         BO    ISPLTVV3            YES, SELECT                 SS APR87
         TM    SPFPRBI2,X'01'      STORAGE TEST                SS APR87
         BZ    *+12                     *                      SS APR87
         TM    UCBSTAB,UCBBSTR          *                      SS APR87
         BO    ISPLTVV3            YES, SELECT                 SS APR87
         B     ISPLSTVL            NONE, SKIP THIS ONE         SS APR87
ISPLTVV3 DS    0H                       *                      SS APR87
         AIF   ('&MVSLEV' GE 'MVS510').MVS51A                 DRK MAY98
         MVI   SPFVADDR,C'0'         ZERO FILL                DRK MAY98
         MVC   SPFVADDR+1(3),UCBNAME CUU                      DRK MAY98
         AGO   .MVS51AX                                       DRK MAY98
.MVS51A  ANOP                                                 DRK MAY98
         ST    R1,SPFUCBAD         SAVE UCB POINTER           DRK MAY98
         UCBDEVN UCBPTR=SPFUCBAD,DEVN=SPFVADDR  4-DIGIT DEVN  DRK MAY98
         CLI   SPFVADDR,C' '       3DIGIT UCB NAME?           DRK JUN98
         BNE   *+8                 NO                         DRK JUN98
         MVI   SPFVADDR,C'0'       YES, THEN ZERO FILL        DRK JUN98
         L     R1,SPFUCBAD         RESTORE UCB POINTER        DRK MAY98
.MVS51AX ANOP                                                 DRK MAY98
         AIF   ('&MVSLEV' LT 'MVS410').NMVS41F                DRK JUN98
         TM    SPFPRBI,X'40'       BY GROUP                   DRK JUN98
         BNO   ISPLSTNG            NO                         DRK JUN98
         ST    R1,SPFUCBAD         SAVE UCB POINTER           DRK JUN98
         LA    R15,SPFVADDR        4DIGIT EBCDIC DEVICE NAME  DRK JUN98
         BAS   R2,DEVNLIST         SEARCH EDT DEV NUM LIST    DRK JUN98
         L     R1,SPFUCBAD         RESTORE UCB POINTER        DRK JUN98
         LTR   R15,R15             DEV NUM FOUND?             DRK JUN98
         BNZ   ISPLSTVL            NO                         DRK JUN98
         B     ISPLSTV7            YES, USE                   DRK JUN98
.NMVS41F ANOP                                                 DRK JUN98
         TM    SPFPRBI,X'40'       BY GROUP                    SS AUG86
         BO    ISPLSTV7            YES, USE                    SS AUG86
ISPLSTNG DS    0H
         LH    R15,SPFPRLN         LENGTH OF PARM              SS NOV85
         L     R14,SPFPRSR         STRING ADDRESS              SS NOV85
         CLI   0(R14),C'*'         ALL VOLUMES                 SS APR87
         BE    ISPLSTV7            YES, USE THIS ONE           SS APR87
         CLI   0(R14),C':'         ALL VOLUMES                 SS APR87
         BE    ISPLSTV7            YES, USE THIS ONE           SS APR87
*        TM    SPFPRBI,X'40'       BY ADDRESS                  SS FEB88
         TM    SPFPRBI,X'04'       BY ADDRESS                  SS MAR88
         BO    ISPLSTV4            YES                         SS NOV85
         CLC   UCBVOLI(0),0(R14)   <<EXECUTED>>                SS NOV85
         EX    R15,*-6                                         SS NOV85
         BNE   ISPLSTVL            NOT THE ONE                 SS NOV85
         B     ISPLSTV7                                        SS NOV85
ISPLSTV4 DS    0H                                             DRK MAY98
         CLC   SPFVADDR(0),0(R14)   <<EXECUTED>>              DRK MAY98
         EX    R15,*-6                                         SS NOV85
         BNE   ISPLSTVL            NOT THE ONE                 SS NOV85
         B     ISPLSTV7                                        SS NOV85
*  ADD / REPLACE VOL ENTRIES                                   SS NOV85
ISPLSTV7 DS    0H                                              SS NOV85
         OI    SPFPRBI2,X'40'      AT LEAST ONE VOLUME FOUND  ABL APR86
         ST    R1,SPFVTMP1         SAVE UCB FOR NOW            SS NOV85
         NI    SPFPRBI,255-X'01'   CLEAR FLAG BEFORE           SS NOV85
         MVC   SPFVVOL,UCBVOLI     GET VOLSER                  SS NOV85
         BAS   R2,ISPGET           SEE IF DUP                  SS NOV85
         LTR   R15,R15             FOUND ONE                   SS NOV85
         BNZ   ISPLSTV5            NO                          SS NOV85
         BAS   R2,ISPDEL1          DELETE OLD ONE              SS JUL87
ISPLSTV5 DS    0H                                              SS NOV85
         L     R1,SPFVTMP1         RESET R1                    SS NOV85
         ST    R1,SPFVUCBA                                     SS NOV85
         MVC   SPFVVOL,UCBVOLI     GET VOLSER                  SS NOV85
         MVC   SPFVDATA,ISPBLK8                                SS NOV85
*        MVC   SPFVDATA,PDSNAME    *** TEST ONLY ***          DRK JUN98
ISPLSTV6 DS    0H                                              SS NOV85
         MVC   SPFVOPT,ISPBLK8                                 SS NOV85
         MVC   SPFVINDC,ISPBLK8                                SS NOV85
         MVC   SPFVSTAT,ISPBLK8                                SS NOV85
         BAS   R2,ISPVSTAI         STATUS SUBROUTINE           SS NOV85
         MVC   SPFVXNUM(8),ISPBLK8                            DRK MAY98
         MVC   SPFVTCYL(7),ISPBLK8   BLANK 1                  DRK SEP12
         MVC   SPFVTTRK(42),SPFVTCYL BLANK 6                  DRK SEP12
         MVC   SPFVVSIZ(4),ISPBLK8                            DRK DEC98
         MVC   SPFVSPCU(12),SPFVVSIZ                          DRK DEC98
         TM    SPFPRBI,X'10'       NOSPACE                     SS NOV85
         BO    ISPLSTV8            ADD ENTRY                   SS NOV85
         TM    SPFPRBI,X'20'       SPACE                       SS JUL88
         BO    ISPLSTV9            GET SPACE                   SS NOV85
         CLI   SPFSPAC,C'N'        NOSPACE DEFAULT             SS JUL88
         BE    ISPLSTV8            YES, ADD ENTRY              SS JUL88
ISPLSTV9 DS    0H                       *                      SS JUL88
         BAS   R2,ISPVSPAI         VOLUME SPACE  BUILD  SUB    SS NOV85
         LTR   R15,R15             ALL OK                      SS APR87
         BZ    ISPLSTV8            YES                         SS APR87
         CLC   SPFVDATA(2),=C'*R'  VTOC RESERVED CODE?        ABL MAY88
         BE    ISPLSTV8            YES, BRANCH                ABL MAY88
         CLC   SPFVDATA(2),=C'*V'  VTOC ENQUEUED CODE?        ABL MAY88
         BE    ISPLSTV8            YES, BRANCH                ABL MAY88
         MVC   SPFVDATA,ISPLSPCE   VTOC ERROR CODE             SS APR87
ISPLSTV8 DS    0H                                              SS NOV85
* CAN DO ADD NOW                                               SS JUL87
         BAS   R2,ISPTBADD                                     SS NOV85
         B     ISPLSTVL            CONTINUE WITH NEXT UCB      SS NOV85
         SPACE 1
* RETURN TO DISPLAY                                            SS NOV85
ISPLSTVD DS    0H                                              SS NOV85
         LA    R15,100             GO TO TBDISPL               SS NOV85
         TM    SPFPRBI2,X'40'      AT LEAST ONE VOLUME FOUND? ABL APR86
         BOR   R3                  YES, RETURN                ABL APR86
         MVC   SPFMSGID,ISPPDSM    ERROR MESSAGE              ABL APR86
         MVI   SPFMSGID+6,C'8'     NO MATCHING VOLUME         ABL APR86
         MVI   SPFMSGID+7,C'A'                                ABL APR86
         BR    R3                  OPTIONAL ?                  SS AUG86
         TM    SPFPRBI2,X'80'      TERMINATE IF NONE?         ABL APR86
         BNOR  R3                  NO, RETURN                 ABL APR86
         L     R14,ISP$ENDA             POINT TO FUNCTION      SS AUG86
         ST    R14,SPFVTPT              *                      SS AUG86
         LA    R15,16                   *                      SS AUG86
         BR    R3                       *                      SS AUG86
         SPACE 1
*         LISTV WITH NO OPERANDS                               SS AUG86
ISPLSTVQ DS    0H                                              SS NOV85
         CLI   SPFFUNST+3,C'I'    INACTIVE                     SS AUG86
         BE    ISPLTVQ2           YES, PROMPT                  SS AUG86
         CLI   SPFTBPFI+1,3       ALREADY AT LISTV?            SS AUG86
         BE    ISPLTVQ2           YES PROMPT                   SS FEB89
         LH    R1,SPFFUNLP+6      GET LAST PANEL               SS FEB89
         LNR   R1,R1                    *                      SS FEB89
         BAS   R2,ISPSTKI         SWAP PANEL                   SS FEB89
         B     ISPLTVQ7           DISPLAY                      SS FEB89
ISPLTVQ5 DS    0H                       *                      SS AUG86
         L     R15,SPFOPER              BLANK AFTER CMD        SS FEB89
         LA    R14,30                   SCAN FOR OPERAND       SS FEB89
         BAS   R2,ISPCKBLK                                     SS FEB89
         LTR   R15,R15                  ANY                    SS FEB89
         BNZ   ISPLTV1B                 YES, CANNOT PROCESS    SS FEB89
         LH    R1,SPFFUNLP+6      GET LAST PANEL               SS AUG86
         LNR   R1,R1                    *                      SS AUG86
         BAS   R2,ISPSTKI         SWAP PANEL                   SS AUG86
         LA    R15,36             PENDING ACT PROC             SS AUG86
         BR    R3                 RETURN TO ROUTER             SS AUG86
ISPLTV1B DS    0H                       *                      SS FEB89
         MVC   SPFMSGID,ISPPDSM         GENERIC MESSAGE        SS FEB89
         MVI   SPFMSGID+6,C'1'          PDSM..1B MESSAGE       SS FEB89
         MVI   SPFMSGID+7,C'B'          BUSY MSG               SS FEB89
ISPLTVQ7 DS    0H                       *                      SS AUG86
         LA    R15,100            GO TO DISPLAY                SS AUG86
         BR    R3                 RETURN TO ROUTER             SS AUG86
ISPLTVQ2 DS    0H                       *                      SS AUG86
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS NOV85
         MVI   SPFMSGID+6,C'2'    NO OPERAND    MESSAGE        SS NOV85
         MVI   SPFMSGID+7,C'V'                                 SS NOV85
ISPLTVQ1 DS    0H                       *                      SS AUG86
         MVI   SPFVZCMD,C' '            BLANK                  SS AUG86
         MVC   SPFVZCMD+1(249),SPFVZCMD      RIPPLE            SS AUG86
ISPLTVQ8 DS    0H                                              SS DEC87
         LA    R15,ISPLTVPP       ADDRESS OF PANEL TABLE       SS OCT88
         LA    R1,SPFMSGID        SET FOR MESSAGE              SS AUG86
         BAS   R2,ISPSINGI        DISPLAY PANEL                SS AUG86
         MVI   SPFMSGID,C' '      CLEAR MESSAGE ID             SS AUG86
         NI    SPFTSVDF+1,255-X'01'     CLEAR PROMPT FLAG      SS AUG86
         C     R15,ISPL8          END KEY                      SS AUG86
         BE    ISPLTVQ3           RETURN TO FUNCTION CMD       SS AUG86
         OI    SPFTSVDF+1,X'01'         SET   PROMPT FLAG      SS AUG86
         MVC   SPFINPUT(250),SPFZSEL    COPY                   SS AUG86
         LA    R15,SPFINPUT             STARTING ADDRESS       SS AUG86
         LA    R14,30                   LENGTH                 SS AUG86
         LA    R1,C' '                  BLANK                  SS AUG86
         BAS   R2,ISPCLI                FIND BLANK AFTER CMD   SS AUG86
         B     ISPLSTVH                 RETRY PARSE            SS AUG86
ISPLTVPP DC    CL8'&P.LVLTV'                                   SS OCT88
ISPLTVQ3 DS    0H                       *                      SS AUG86
         TM    SPFLAG4,SPFFFUN          FROM FUNCTION          SS AUG86
         BO    ISPLTVQ4                 YES, GO BACK           SS AUG86
         LA    R15,100                  GO TO PREV DISPLAY     SS AUG86
         BR    R3                       RETURN TO ROUTER       SS AUG86
ISPLTVQ4 DS    0H                       *                      SS AUG86
         L     R14,ISP$FUNA             POINT TO FUNCTION      SS AUG86
         ST    R14,SPFVTPT              *                      SS AUG86
         LA    R15,16                   *                      SS AUG86
         BR    R3                       *                      SS AUG86
         SPACE 1
* INVALID RANGE ON STRING                                      SS NOV85
ISPLSTVW DS    0H                                              SS NOV85
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS NOV85
         MVI   SPFMSGID+6,C'3'    TOO LONG      MESSAGE        SS NOV85
         MVI   SPFMSGID+7,C'V'                                 SS NOV85
         B     ISPLSTVE                                       ABL APR86
         SPACE 1
* KEY CONFLICT                                                 SS NOV85
ISPLSTVK DS    0H                                              SS NOV85
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS NOV85
         MVI   SPFMSGID+6,C'7'    KEY CONFLICT  MESSAGE        SS NOV85
         MVI   SPFMSGID+7,C'A'                                 SS NOV85
         SPACE 1
ISPLSTVE DS    0H                                              SS AUG86
         TM    SPFTSVDF+1,X'01'   SET PROMPT MODE              SS AUG86
         BO    ISPLTVQ1           PROMPT WITH MESSAGE          SS AUG86
         MVC   SPFVZCMD(250),SPFINPUT COPY BAD COMMAND         SS DEC87
         B     ISPLTVQ8           PROMPT WITH MESSAGE          SS DEC87
         SPACE 2
ISPLSTVG DC    C'(PDSVVOL,C,A)'   SORT LISTV ON VOL            SS AUG86
ISPLSTVM DC    C'(PDSVXADD,C,A)'  SORT LISTV ON ADDR           SS AUG86
ISPLSTVP DS    0F                                              SS NOV85
         DC    X'80',X'800000',CL8' '                          SS FEB88
*                      80  ON TO ALLOW * AND :                 SS FEB88
         DC    X'33',X'040000',CL8'ADDRESS'                    SS FEB88
         DC    X'34',X'400000',CL8'GROUP'                      SS AUG86
         DC    X'34',X'400000',CL8'GENERIC'                    SS AUG86
         DC    X'34',X'200000',CL8'SPACE'                      SS NOV85
         DC    X'36',X'100000',CL8'NOSPACE'                    SS NOV85
         DC    X'31',X'100000',CL8'NO'                         SS NOV85
         DC    X'32',X'080000',CL8'RESET'                     DRK JUL98
         DC    X'21',X'000800',CL8'SHARED'                     SS NOV85
         DC    X'21',X'000400',CL8'SHR'                        SS NOV85
         DC    X'23',X'000400',CL8'PRIVATE'                    SS NOV85
         DC    X'22',X'000200',CL8'PUBLIC'                     SS NOV85
         DC    X'23',X'000100',CL8'STORAGE'                    SS NOV85
         DC    X'FF'                                           SS NOV85
ISPLSTVZ DC    X'20'        UCB SCAN FOR DASD                  SS NOV85
         SPACE 2
         DS    0F                                              SS NOV85
ISPLSTVV DC    H'0',X'08',X'00'                                SS NOV85
         DC    A(VSPFVVOL),AL2(SPFVVOL-SPWRKC),H'06'           SS NOV85
         DC    A(VSPFVXAD),AL2(SPFVXADD-SPWRKC),H'02'          SS AUG86
         DC    A(VSPFVCTK),AL2(SPFVCNTK-SPWRKC),H'01'         DRK JUL98
         DC    A(VSPFVUCB),AL2(SPFVUCBA-SPWRKC),H'04'          SS NOV85
         DC    A(VSPFVDAT),AL2(SPFVDATA-SPWRKC),H'08'          SS NOV85
         DC    A(VSPFVTCY),AL2(SPFVTCYL-SPWRKC),H'07'         DRK SEP12
         DC    X'FF'                                           SS NOV85
VSPFVVOL DC    C'PDSVVOL '                                     SS NOV85
VSPFVXAD DC    C'PDSVXADD '                                    SS AUG86
VSPFVCTK DC    C'PDSVCNTK '                                   DRK JUL98
VSPFVUCB DC    C'(PDSVUCBA PDSVOPT PDSVADDR PDSVATTR PDSVCNT' DRK MAY98
         DC    C' PDSVXNUM PDSVDSCB PDSVSTAT PDSVVSIZ'        DRK MAY98
         DC    C' PDSVSPCU PDSVACYL PDSVFRAG)'                DRK DEC98
VSPFVDAT DC    C'(PDSVDATA PDSVTYPE PDSVVTOC PDSVINDC)'        SS NOV85
VSPFVTCY DC    C'(PDSVTCYL PDSVTTRK PDSVLCYL PDSVLTRK'        DRK AUG98
         DC    C' PDSVDCYL PDSVFMT0 PDSVVIRS)'                DRK DEC98
ISPLSTVN DC    C'(PDSVOPT PDSVDATA PDSVUCBA PDSVTYPE PDSVADDR PDSVVTOC X
               PDSVATTR PDSVCNT PDSVTCYL PDSVTTRK PDSVXNUM PDSVDSCB    X
               PDSVLCYL PDSVLTRK PDSVINDC PDSVSTAT PDSVVSIZ PDSVXADD   X
               PDSVCNTK PDSVSPCU PDSVDCYL PDSVACYL'           DRK AUG98
         DC    C' PDSVFMT0 PDSVVIRS PDSVFRAG)'                DRK DEC98
         DROP  R4                                             DRK NOV98
*              ABOVE  TABLE LAST EDIT                          SS AUG86
         SPACE 5                                               SS NOV85
*                                                              SS NOV85
*   ISPVSTAT SUBROUTINE  BUILD VOLUME STATS                    SS NOV85
*                                                              SS NOV85
ISPVSTAT DS    0H                                              SS NOV85
         USING *,R4                                            SS NOV85
         L     R1,SPFVUCBA                                     SS NOV85
         MVC   SPFVVOL,UCBVOLI     GET VOLSER                  SS NOV85
         AIF   ('&MVSLEV' GE 'MVS510').MVS51B                 DRK MAY98
         MVI   SPFVADDR,C'0'         ZERO FILL                DRK MAY98
         MVC   SPFVADDR+1(3),UCBNAME CUU                      DRK MAY98
         AGO   .MVS51BX                                       DRK MAY98
.MVS51B  ANOP                                                 DRK MAY98
         UCBDEVN UCBPTR=SPFVUCBA,DEVN=SPFVADDR  4-DIGIT DEVN  DRK MAY98
         CLI   SPFVADDR,C' '       3DIGIT UCB NAME?           DRK JUN98
         BNE   *+8                 NO                         DRK JUN98
         MVI   SPFVADDR,C'0'       YES, THEN ZERO FILL        DRK JUN98
         L     R1,SPFVUCBA         RESTORE UCB POINTER        DRK MAY98
.MVS51BX ANOP                                                 DRK MAY98
         MVC   SPFVXADD(2),UCBCHAN CUU IN HEX                  SS AUG86
*        IC    R0,UCBNAME          GET C OF CUU               ABL JAN87
*        SLL   R0,28               DROP ZONE                  ABL JAN87
*        SRL   R0,28               SHIFT BACK                 ABL JAN87
*        STC   R0,SPFVXADD         RESET C OF CUU             ABL JAN87
         SR    R0,R0               CLEAR FOR IC               DRK JUN98
*        IC    R0,UCBUSER+1            ASSUME MVS/XA          ABL FEB87
         ICM   R0,B'0011',UCBUSER  ASSUME MVS/XA (2 BYTES)    DRK JUL98
         L     R15,CVTPTR(,R0)                                ABL FEB87
         TM    CVTDCB-CVT(R15),X'80'   CVTMVSE (XA)?          ABL FEB87
         BO    *+4+2+4                 YES, BRANCH            DRK JUL98
         SR    R0,R0               CLEAR FOR IC               DRK JUL98
         IC    R0,UCBUSER          ONE BYTE ONLY              ABL APR86
         LR    R1,R0               LOAD USER COUNT            ABL APR86
         SPACE 1                                              DRK JUL98
         SR    R14,R14             CLEAR FOR DIVIDE           DRK JUL98
         LR    R15,R1              DIVIDEND                   DRK JUL98
         D     R14,=F'1000'        DIVIDE BY 1000             DRK JUL98
         LTR   R15,R15             ANY QUOTIENT?              DRK JUL98
         BZ    CONV2DEC            NO, THEN < 1000            DRK JUL98
         LR    R1,R15              YES, COUNT IN K UNITS      DRK JUL98
         SPACE 1                                              DRK JUL98
CONV2DEC DS    0H                                             DRK JUL98
         BAS   R2,ISPDECCV         CONVERT TO DEC              SS NOV85
         LTR   R15,R15             K UNITS?                   DRK JUL98
         BZ    *+4+6+4             NO                         DRK JUL98
         MVC   SPFDCNV3,SPFDCNV3+1 YES, SHIFT K COUNT LEFT 1  DRK JUL98
         MVI   SPFDCNV3+2,C'K'     PLUG IN K LITERAL          DRK JUL98
         SPACE 1                                              DRK JUL98
         MVC   SPFVCNT,SPFDCNV3    GET VALUE                   SS NOV85
         MVI   SPFVCNT+3,C' '                                  SS NOV85
         MVI   SPFVCNTK,C'1'       ASSUME K UNITS (SORT LAST) DRK JUL98
         LTR   R15,R15             K UNITS?                   DRK JUL98
         BNZ   *+4+4               YES, SORT LAST             DRK JUL98
         MVI   SPFVCNTK,C'0'       NO, SORT FIRST             DRK JUL98
         L     R1,SPFVUCBA         RESTORE UCB POINTER         SS NOV85
         TM    UCBSTAB,UCBBPRV     PRIVATE                     SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVATTR,=C'PRIV'                               SS NOV85
         TM    UCBSTAB,UCBBPUB     PUBLIC                      SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVATTR,=C'PUB '                               SS NOV85
         TM    UCBSTAB,UCBBSTR     STORAGE                     SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVATTR,=C'STOR'                               SS NOV85
         TM    UCBSTAT,UCBRESV     RESERVED                    SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVSTAT,=C'RESV'                               SS NOV85
         TM    UCBSTAT,UCBPRES     PERMANENT RESIDENT          SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVSTAT,=C'PRES'                               SS NOV85
         TM    UCBSTAT,UCBSYSR     SYSTEM RESIDENT             SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVSTAT,=C'SYSR'                               SS NOV85
         MVC   SPFVINDC(4),ISPBLK8 RESET INDC AREA             SS NOV85
         TM    UCBSTAT,UCBALOC     ALLOCATED                   SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC,C'A'                                   SS NOV85
         TM    UCBSTAB,UCBPGFL     PAGE DATASET                SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+1,C'P'                                 SS NOV85
         TM    UCBTYP+1,X'20'      SHARED DEVICE FLAG          SS APR87
         BZ    *+8                                             SS APR87
         MVI   SPFVINDC+3,C'S'     SHARED VOLUME               SS APR87
         TM    UCBTYP+1,X'08'      VIRT DASD 3330V             SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+3,C'M'     MASS STORE                  SS NOV85
         TM    UCBSTAB,UCBBNUL     CATALOG (NOT ALWAYS SET)    SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+2,C'C'                                 SS NOV85
         MVC   SPFVTYPE,ISPBLK8                                SS NOV85
         LA    R1,UCBTYP                                       SS NOV85
         BAS   R2,ISPDEVTC                                     SS NOV85
         STH   R15,SPFVCSIZ        TRK/CYL                     SS NOV85
         BAS   R2,ISPDEVNM         GET DEVICE TYPE NAME        SS NOV85
         LTR   R15,R15                                         SS NOV85
         BZ    *+10                                            SS NOV85
         MVC   SPFVTYPE,0(R15)                                 SS NOV85
         L     R1,SPFVUCBA         RESTORE UCB POINTER         SS NOV85
         SPACE 1
         AIF   ('&MVSLEV' LT 'MVS410').NMVS41B                DRK JUN98
         LA    R15,SRVUCBDC            DCE ADDRESS            DRK JUN98
         USING DCE,R15                                        DRK AUG98
         LA    R14,MODELTBL-4          MDR DEVICE TYPE CODES  DRK JUN98
TYPELOOP LA    R14,4(,R14)             NEXT TABLE ENTRY       DRK JUN98
         CLI   0(R14),X'FF'            END OF TABLE?          DRK JUN98
         BE    TYPEEXIT                YES, BRANCH            DRK JUN98
         CLC   UCBTBYT4-UCBOB(1,R1),0(R14) MATCH DEVICE TYPE? DRK JUN98
         BNE   TYPELOOP                    NO, BRANCH         DRK JUN98
         CLC   DCEMDRDT,1(R14)         MATCH DCEMDRDT?        DRK AUG98
         BNE   TYPELOOP                NO, BRANCH             DRK JUN98
         MVC   SPFVTYPE+4(2),2(R14)    ADD THE DESIGNATOR     DRK JUN98
         AIF   ('&SYSPARM' NE 'CSC-STL').S2K6                 DRK SEP12
*        CLC   SPFVVOL(3),=C'S2K'        *** TEST ***         DRK SEP12
*        BNE   *+4+6                     *** TEST ***         DRK SEP12
*        MVC   SPFVTYPE+4(2),=C'-A'      *** TEST ***         DRK SEP12
.S2K6    ANOP                                                 DRK SEP12
         B     TYPEEXIT                                       DRK JUN98
         DROP  R15                                            DRK AUG98
         SPACE 1
*                                                             DRK JUN98
* MDR DEVICE TYPE CODES FROM EREP REFERENCE MANUAL            DRK JUN98
*                                                             DRK JUN98
         AIF   ('&MDRDT' EQ 'MXI' OR '&MDRDT' EQ 'TASID').MXI DRK NOV98
* USE DVOL DISPLAY FORMAT                                     DRK NOV98
MODELTBL DC    X'0E1C',C'D '           3380D                  DRK JUN98
         DC    X'0E1B',C'E '           3380E                  DRK JUN98
         DC    X'0E21',C'J '           3380J                  DRK JUN98
         DC    X'0E23',C'K '           3380K                  DRK JUN98
         DC    X'0F26',C'M1'           3390M1                 DRK JUN98
         DC    X'0F27',C'M2'           3390M2                 DRK JUN98
         DC    X'0F24',C'M3'           3390M3                 DRK JUN98
         DC    X'0F31',C'OP'           3390OP(TICAL) LIKE M3  DRK JUN98
         DC    X'0F32',C'M9'           3390M9                 DRK JUN98
         DC    X'0F3E',C'MA'           3390MA                 DRK AUG12
         DC    X'0428',C'M1'           9345M1                 DRK NOV99
         DC    X'0429',C'M2'           9345M2                 DRK NOV99
         AGO   .TBLEND                                        DRK NOV98
.MXI     ANOP                                                 DRK NOV98
* USE MXI/TASID DISPLAY FORMAT                                DRK NOV98
MODELTBL DC    X'0E1C',C'-D'           3380-D                 DRK NOV98
         DC    X'0E1B',C'-E'           3380-E                 DRK NOV98
         DC    X'0E21',C'-J'           3380-J                 DRK NOV98
         DC    X'0E23',C'-K'           3380-K                 DRK NOV98
         DC    X'0F26',C'-1'           3390-1                 DRK NOV98
         DC    X'0F27',C'-2'           3390-2                 DRK NOV98
         DC    X'0F24',C'-3'           3390-3                 DRK NOV98
         DC    X'0F31',C'-O'           3390-O(PTICAL) LIKE -3 DRK OCT99
         DC    X'0F32',C'-9'           3390-9                 DRK NOV98
         DC    X'0F3E',C'-A'           3390-A                 DRK AUG12
         DC    X'0428',C'-1'           9345-1                 DRK NOV99
         DC    X'0429',C'-2'           9345-2                 DRK NOV99
.TBLEND  ANOP                                                 DRK NOV98
         DC    X'FF'                   END OF TABLE           DRK JUN98
TYPEEXIT DS    0H                                             DRK JUN98
         SPACE 1                                              DRK JUN98
.NMVS41B  ANOP                                                DRK JUN98
* SET VTOC ADDRESS IN SPFVVTOC                                 SS NOV85
         SR    R0,R0                                           SS NOV85
         ICM   R1,3,UCBVTOC       GET TT OF TTR0               SS NOV85
         ICM   R1,12,=X'0000'     CLEAR                        SS NOV85
         LH    R15,SPFVCSIZ                                    SS NOV85
         DR    R0,R15                                          SS NOV85
         SLL   R1,16              SHIFT CC                     SS NOV85
         OR    R1,R0              ADD IN HH                    SS NOV85
         BAS   R2,ISPHEXCV        CONVERT TO HEX               SS NOV85
         MVC   SPFVVTOC,SPFHEXCV  MOVE IT                      SS NOV85
         BR    R3                                              SS NOV85
         DROP  R4                                              SS NOV85
         LTORG ,                        *                      SS MAR87
*                                                              SS NOV85
*   ISPVSPAC SUBROUTINE  BUILD VOLUME SPACE AND DSCB F4 INFO   SS NOV85
*                                                              SS NOV85
ISPVSPAC DS    0H                                              SS NOV85
         USING *,R4                                            SS NOV85
         SR    R15,R15         SET ZERO RC                     SS APR87
         L     R1,SPFVUCBA         POINT TO UCB               DRK JUL98
         TM    UCBTYP+1,X'08'      MASS STORE/VIRT DASD 3330V DRK JUL98
         BOR   R3                  SKIP LSPACE                DRK JUL98
         CLI   SPFSPWA,C'Y'        WAIT FOR SPACE              SS JUL88
         BE    ISPVSPAE            YES, GET SPACE NOW          SS JUL88
*        L     R2,CVTPTR(,R0)                                 ABL MAY88
*        TM    CVTDCB-CVT(R2),X'80'    CVTMVSE--XA?           ABL MAY88
*        BNO   ISPVSPAD                NO, BRANCH             ABL MAY88
         L     R2,SPFVUCBA         POINT TO UCB               ABL MAY88
*        SH    R2,=H'15'           OFFSET TO UCBIOSF1         ABL MAY88
*        TM    0(R2),X'80'         RESERVED?                  ABL MAY88
*        BNO   ISPVSPAD            NO, BRANCH                 ABL MAY88
         CLI   UCBSQC-UCBCMSEG(R2),0  ANY RESERVE COUNT        SS JUL88
         BZ    ISPVSPAD            NO, CHECK FOR ENQ           SS JUL88
         MVC   SPFVDATA,ISPLSPCR   VTOC RESERVED CODE         ABL MAY88
         LA    R15,4               SET ERROR RETURN           ABL MAY88
         BR    R3                  SKIP LSPACE                ABL MAY88
ENQTESTV ENQ   (*-*,*-*,E,*-*,SYSTEMS),RET=TEST,MF=L          ABL MAY88
         ORG   ENQTESTV+4                                     ABL MAY88
SYSVTOC  DC    CL8'SYSVTOC '            FOR VTOC ENQUEUE TEST ABL MAY88
ISPLSPCR DC    CL8'*RESERVE'                                  ABL MAY88
ISPLSPCV DC    CL8'*VTOCENQ'                                  ABL MAY88
ISPVSPAD DS    0H                                             ABL MAY88
         AIF ('&MVSLEV' LT 'MVS13X').NMVS13A                  ABL MAY88
         XC    PARMLIST(48),PARMLIST                          ABL MAY88
         GQSCAN AREA=(WORKTBL,296),                           ABL MAY88X
               RESNAME=(SYSVTOC,SPFVVOL,06),                  ABL MAY88X
               REQLIM=1,SCOPE=ALL,MF=(E,PARMLIST)             ABL MAY88
         SR    R1,R1                                          ABL MAY88
         CH    R15,=H'4'           ALLOCATED?                 ABL MAY88
         BE    ISPVSPAE            NO, EXIT                   ABL MAY88
         MVC   SPFVDATA,ISPLSPCV   VTOC RESERVED CODE         ABL MAY88
         LA    R15,4               SET ERROR RETURN           ABL MAY88
         BR    R3                  SKIP LSPACE                ABL MAY88
.NMVS13A ANOP                      ,                          ABL MAY88
ISPVSPAE DS    0H                                             ABL MAY88
         L     R0,SPFVUCBA         GET UCB ADDR                SS NOV85
         BAS   R2,ISPLSPAC         UPDATE SPACE                SS NOV85
         LTR   R15,R15             ZERO RC                     SS APR87
         BNZR  R3                  SKIP, BAD RC                SS APR87
* SHOULD ALSO READ DSCB F4 FOR MORE INFORMATION                SS NOV85
         L     R1,SPFVUCBA                                     SS NOV85
         LA    R1,UCBVOLI          LOCATION OF VOLUME          SS NOV85
         BAS   R2,ISPFMT4          GET DSCB FORMAT 4           SS NOV85
         LTR   R15,R15                                         SS NOV85
         BNZR  R3                  SKIP, BAD RC                SS NOV85
         LH    R1,DS4DSREC-DS4IDFMT+SPFDSCB                    SS NOV85
         BAS   R2,ISPDECCV                                     SS NOV85
         MVC   SPFVDSCB,SPFDCNV4                               SS NOV85
         MVC   SPFVINDC+4(4),ISPBLK8   RESET INDC AREA         SS NOV85
         TM    DS4VTOCI-DS4IDFMT+SPFDSCB,DS4IVTOC  INDEX VTOC  SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+4,C'I'                                 SS NOV85
         TM    DS4VTOCI-DS4IDFMT+SPFDSCB,DS4DVTOC IX DISABLED DRK AUG98
         BZ    *+8                                            DRK AUG98
         MVI   SPFVINDC+4,C'D'                                DRK AUG98
*        TM    DS4VSIND-DS4IDFMT+SPFDSCB,X'80'     VSAM OWNED  SS NOV85
         TM    DS4VSIND-DS4IDFMT+SPFDSCB,DS4VVDSA  VVDS ALLOC DRK NOV12
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+5,C'V'                                 SS NOV85
         SR    R1,R1                                           SS NOV85
         ICM   R1,3,DS4VSCRA-DS4IDFMT+SPFDSCB      CRA         SS NOV85
         LTR   R1,R1                               ANY         SS NOV85
         BZ    *+8                                             SS NOV85
         MVI   SPFVINDC+6,C'R'                                 SS NOV85
         L     R1,SPFVUCBA         GET UCB ADDRESS            DRK DEC01
         TM    UCBFL5,UCBSMS       SMS MANAGED VOLUME         DRK DEC01
         BZ    *+8                                            DRK DEC01
         MVI   SPFVINDC+7,C'M'                                DRK DEC01
         SPACE 1                                              DRK AUG98
         AIF   ('&MVSLEV' LT 'MVS410').NMVS41G                DRK AUG98
         LA    R15,SRVUCBDC        DCE ADDRESS                DRK AUG98
         USING DCE,R15                                        DRK AUG98
         SR    R14,R14             ASSUME ZERO                DRK AUG98
         TM    DCEFLAG1,DCENOALT   NO ALTERNATE CYLS?         DRK MAR00
         BO    ISPVALT             YES                        DRK MAR00
         TM    DCEFLAG3,DCEALTV    DCEALCYL VALID?            DRK AUG98
         BNO   ISPVALT             NO                         DRK AUG98
         ICM   R14,1,DCEALCYL      YES, NUM OF ALT CYLS       DRK AUG98
         DROP  R1,R15                                         DRK DEC01
         B     ISPVALT                                        DRK AUG98
.NMVS41G ANOP                                                 DRK AUG98
ISPVALT  DS    0H                                             DRK AUG98
         STCM  R14,1,SPFVXALT      SAVE ALT CYLS              DRK AUG98
         LR    R1,R14              ALT CYLS                   DRK AUG98
         BAS   R2,ISPDECCV                                    DRK AUG98
         MVC   SPFVACYL,SPFDCNV4                              DRK AUG98
         SPACE 1
         SR    R1,R1                                          DRK AUG98
         ICM   R1,3,DS4DSCYL-DS4IDFMT+SPFDSCB      DEV CYLS   DRK AUG98
         SPACE 1
         AIF   ('&MVSLEV' LT 'MVS710').NDS4DC1                DRK MAR16
         CLC   DS4DSCYL-DS4IDFMT+SPFDSCB(2),=X'FFFE' DS4EAV?  DRK SEP12
         BNE   *+4+4                                 NO       DRK SEP12
         L     R1,DS4DCYL-DS4IDFMT+SPFDSCB           YES      DRK SEP12
.NDS4DC1 ANOP                                                 DRK MAR16
         AIF   ('&SYSPARM' NE 'CSC-STL').S2K7                 DRK SEP12
*        CLC   SPFVVOL(3),=C'S2K'        *** TEST ***         DRK SEP12
*        BNE   *+4+4                     *** TEST ***         DRK SEP12
*        L     R1,=A(1182006)   FAKE EAV *** TEST ***         DRK SEP12
.S2K7    ANOP                                                 DRK SEP12
         SPACE 1
         SR    R14,R14                                        DRK AUG98
         ICM   R14,1,SPFVXALT      ALT CYLS                   DRK AUG98
         SR    R1,R14              - ALT CYLS                 DRK AUG98
         BAS   R2,ISPDECCV                                    DRK AUG98
         MVC   SPFVDCYL,SPFDCNV7                              DRK SEP12
         SPACE 1
         CLC   SPFVTCYL(7),ISPBLK8 LSPACE INFO?               DRK SEP12
         BE    ISPNOSPC            NO, SKIP SPACE USED CALC   DRK AUG98
         SPACE 1                                              DRK AUG98
         PACK  DOUBLE(8),SPFVTCYL(7) FREE CYLS                DRK SEP12
         CVB   R1,DOUBLE                                      DRK AUG98
         MH    R1,SPFVCSIZ         FREE CYLS * TRK/CYL        DRK AUG98
         PACK  DOUBLE(8),SPFVTTRK(7) FREE TRKS                DRK SEP12
         CVB   R0,DOUBLE                                      DRK AUG98
         AR    R0,R1               TOTAL FREE TRKS            DRK AUG98
         SPACE 1
         SR    R2,R2                                          DRK AUG98
         ICM   R2,3,DS4DSCYL-DS4IDFMT+SPFDSCB      DEV CYLS   DRK AUG98
         SPACE 1
         AIF   ('&MVSLEV' LT 'MVS710').NDS4DC2                DRK MAR16
         CLC   DS4DSCYL-DS4IDFMT+SPFDSCB(2),=X'FFFE' DS4EAV?  DRK SEP12
         BNE   *+4+4                                 NO       DRK SEP12
         L     R2,DS4DCYL-DS4IDFMT+SPFDSCB           YES      DRK SEP12
.NDS4DC2 ANOP                                                 DRK MAR16
         AIF   ('&SYSPARM' NE 'CSC-STL').S2K8                 DRK SEP12
*        CLC   SPFVVOL(3),=C'S2K'        *** TEST ***         DRK SEP12
*        BNE   *+4+4                     *** TEST ***         DRK SEP12
*        L     R2,=A(1182006)   FAKE EAV *** TEST ***         DRK SEP12
.S2K8    ANOP                                                 DRK SEP12
         SPACE 1
         SR    R14,R14                                        DRK AUG98
         ICM   R14,1,SPFVXALT      ALT CYLS                   DRK AUG98
         SR    R2,R14              - ALT CYLS                 DRK AUG98
         MH    R2,SPFVCSIZ         DEV CYLS * TRK/CYL         DRK AUG98
         LR    R1,R2               DEV TRKS                   DRK AUG98
         SPACE 1
         SR    R1,R0               DEV TRKS - TOTAL TRKS FREE DRK AUG98
         MH    R1,=H'100'          * 100 FOR PERCENT          DRK AUG98
         SR    R0,R0               CLEAR EVEN FOR DIVIDE      DRK AUG98
         DR    R0,R2               PERCENT SPACE USED         DRK AUG98
         BAS   R2,ISPDECCV         CONVERT VALUE IN R1        DRK AUG98
         MVC   SPFVSPCU,SPFDCNV3   SPACE USED                 DRK AUG98
         MVI   SPFVSPCU+3,C'%'                                DRK AUG98
         SPACE 1                                              DRK AUG98
ISPNOSPC DS    0H                                             DRK AUG98
         SPACE 1                                              DRK AUG98
ISPCAXLV DS    0H                                             DRK AUG98
         TM    SPFLAG5,SPFXA            REALLY XA             DRK MAR07
         BZ    *+4+4+4+2                NO, SKIP  BSM         DRK MAR07
         LA    R14,*+4+4+2              POINT AFTER BSM       DRK MAR07
         O     R14,ISPX80               31 BIT MODE           DRK MAR07
         BSM   0,R14                    SET MODE              DRK MAR07
         SPACE 1                                              DRK MAR07
         L     R1,CVTPTR(,R0)   PT TO CVT                     DRK AUG98
         L     R1,CVTCBSP-CVT(,R1) AMCBS PTR                  DRK AUG98
         L     R1,20(,R1)       PT TO 1ST CAXWA               DRK AUG98
ISPCAXL1 DS    0H                                             DRK AUG98
*        LA    R1,0(,R1)        CLEAR HIGH ORDER BYTE         DRK MAR07
         LTR   R1,R1            IS THERE A CAXWA CHAIN?       DRK AUG98
         BZ    ISPCAXLX         NO CAX, EXIT                  DRK AUG98
         TM    9(R1),X'80'      CATALOG DELETED?              DRK AUG98
         BZ    *+4+4            NO                            DRK AUG98
         B     ISPCAXL2         YES, SKIP                     DRK SEP98
         TM    9(R1),X'08'      CATALOG DISCONNECTED?         DRK AUG98
         BZ    *+4+4            NO                            DRK AUG98
         B     ISPCAXL2         YES, SKIP                     DRK SEP98
         TM    9(R1),X'20'      GETMAIN ERROR?                DRK AUG98
         BZ    *+4+4            NO                            DRK AUG98
         B     ISPCAXL2         YES, SKIP                     DRK SEP98
         TM    9(R1),X'10'      IO ERROR?                     DRK AUG98
         BZ    *+4+4            NO                            DRK AUG98
         B     ISPCAXL2         YES, SKIP                     DRK SEP98
         SPACE 1                                              DRK SEP98
         ICM   R2,B'1111',188(R1)       31-BIT UCB ADDR?      DRK SEP98
         BNZ   *+4+4                    YES                   DRK SEP98
         L     R2,28(,R1)               NO, USE 24-BIT ADDR   DRK SEP98
         MVC   SPFXVOL(6),28(R2)        PICKUP VOL SER        DRK SEP98
         SPACE 1                                              DRK SEP98
         CLC   SPFVVOL(6),SPFXVOL VOLSER MATCH?               DRK AUG98
         BNE   ISPCAXL2           NO                          DRK AUG98
         MVI   SPFVINDC+2,C'C'    YES, ACTIVE CATALOG ON VOL  DRK AUG98
         B     ISPCAXLX           EXIT                        DRK AUG98
ISPCAXL2 DS    0H                                             DRK AUG98
         L     R1,4(,R1)          NEXT CAXWA                  DRK AUG98
         B     ISPCAXL1                                       DRK AUG98
ISPCAXLX DS    0H                                             DRK AUG98
         TM    SPFLAG5,SPFXA            REALLY XA             DRK MAR07
         BZ    *+4+4+2                  NO, SKIP  BSM         DRK MAR07
         LA    R14,*+4+2                POINT AFTER BSM       DRK MAR07
         BSM   0,R14                    SET MODE 24           DRK MAR07
         SPACE 1                                              DRK AUG98
         LA    R1,DS4VTOCE-DS4IDFMT+SPFDSCB                    SS NOV85
         SR    R0,R0                                           SS NOV85
         SR    R2,R2                                           SS NOV85
         ICM   R0,3,2(R1)      CC OF LOWER LIMIT               SS NOV85
         ICM   R2,3,4(R1)      HH OF LOWER LIMIT               SS NOV85
         MH    R0,SPFVCSIZ     CC TIMES TRK/CYL                SS NOV85
         ALR   R2,R0           RELATIVE TRK OF LOWER LIMIT     SS NOV85
         LR    R15,R2          SAVE HERE                       SS NOV85
         ICM   R0,3,6(R1)      CC OF UPPER LIMIT               SS NOV85
         ICM   R2,3,8(R1)      HH OF UPPER LIMIT               SS NOV85
         MH    R0,SPFVCSIZ     CC TIMES TRK/CYL                SS NOV85
         ALR   R2,R0           RELATIVE TRK OF UPPER LIMIT     SS NOV85
         SLR   R2,R15          DIFFERENCE                      SS NOV85
         LA    R1,1                                            SS NOV85
         ALR   R1,R2           VTOC SIZE IN TRKS               SS NOV85
         BAS   R2,ISPDECCV                                     SS NOV85
         MVC   SPFVVSIZ,SPFDCNV4                               SS NOV85
         SR    R15,R15         SET ZERO RC                     SS APR87
         BR    R3                                              SS NOV85
         DROP  R4                                              SS NOV85
         LTORG ,                        *                      SS MAR87
