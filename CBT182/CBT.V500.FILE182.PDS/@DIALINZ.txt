         TITLE 'SPECIAL LINE CMDS  EXTENSION'                  SS AUG89
*************************************************************  SS AUG89
*                                                              SS AUG89
*      SPECIAL LINE CMD EXTENSIONS                             SS AUG89
*                                                              SS AUG89
*      THESE PROCESSOR IS ENTERED FROM OTHER LINE CMD          SS AUG89
*      PROCESSORS TO CONTINUE LINE PROCESSING                  SS AUG89
*      R0 EQUALS THE EXTENSION FUNCTION                        SS AUG89
*      RETURN IS THROUGH POST PROCESSING CODE (0 FOR CLEANUP)  SS AUG89
*      DIRECTLY OR AFTER PDS COMMAND REQUEST                   SS AUG89
*      RETURN MAY ALSO GO DIRECTLY TO TABLE DISPLAY PROCESSING SS AUG89
*                                                              SS AUG89
*************************************************************  SS AUG89
         SPACE 2                                               SS AUG89
ISPCLZL  DS    0H                                              SS AUG89
         USING *,R4                                            SS AUG89
         SPACE 1                                               SS AUG89
         LR    R15,R0                                          SS AUG89
         B     *+4(R15)             INDEX TO PROCESSOR         SS AUG89
         B     ISPCLZ3           0  INVALID                    SS AUG89
         B     ISPCLZR           4  RENAME DSN                 SS AUG89
         B     ISPCLZD           8  DELETE DSN                 SS AUG89
         B     ISPCLZC          12  CATALOG DSN                SS AUG89
         B     ISPCLZU          16  UCAT DSN                   SS AUG89
         SPACE 3                                               SS AUG89
         SPACE 3                                               SS AUG89
*                                       *                      SS AUG89
*  NORMAL AND ERROR RETURN /EXITS       *                      SS AUG89
*                                       *                      SS AUG89
*  NORMAL POST PROCESSING CHECK AND CLEANUP                    SS AUG89
ISPCLZN  DS    0H                  NORMAL CLEANUP              SS AUG89
         BAS   R2,ISPLMSGS         PROCESS MESSAGE             SS AUG89
         LH    R1,SPFTBPOT                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS AUG89
         BAS   R2,ISPTBPUT         UPDATE TABLE                SS AUG89
* RETURN TO LINE COMMAND POST PROCESSING CLEANUP               SS AUG89
ISPCLZY  DS    0H                                              SS AUG89
         BAS   R2,ISPQUERY      GET CUR CRP FOR CURSOR         SS AUG89
         MVC   SPFTCCRP,SPFTCRP SAVE CUR CRP                   SS AUG89
         MVI   SPFTPOSI,0         GO TO CLEANUP  POST PROC     SS AUG89
         OI    SPFTFLG1,SPFTLPOS  INDICATE RETURN TO POST PROC SS AUG89
         LH    R15,SPFTBPLF       LINE COMMAND PROCESSOR       SS AUG89
         BR    R3                       *                      SS AUG89
* PROCESS NEW COMMAND                   *                      SS AUG89
ISPCLZNW DS    0H                       PROCESS NEW LINE CMD   SS AUG89
         NI    SPFTFLG1,255-SPFTLPOS    NO POST PROCESSING     SS AUG89
         LH    R15,SPFTBPLF             LINE PROCESS CODE      SS AUG89
         BR    R3                       THROUGH ROUTER         SS AUG89
* PROCESS MESSAGE  R1 MAIN MSG, R15 DATA MSG                   SS AUG89
ISPCLZMG DS    0H                       *                      SS AUG89
         MVC   SPFMLIN2(79),0(R1)       COPY MAIN MSG          SS AUG89
         LH    R1,SPFTBPDA                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(8,R1),0(R15)           COPY DATA MSG          SS AUG89
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS AUG89
         MVI   SPFMSGID+7,C'A'                                 SS AUG89
         MVI   SPFMSGID+6,C'1'    GENERAL ERROR MESSAGE        SS AUG89
         B     ISPCLZ2                  TERMINATE LINE         SS AUG89
* ERROR IN PDS COMMAND                  *                      SS AUG89
* INVALID COMMAND                       *                      SS AUG89
ISPCLZ3  DS    0H                                              SS AUG89
         LH    R1,SPFTBPDA                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(8,R1),ISPINVLD                                SS AUG89
* TERMINATE LINE COMMAND                *                      SS AUG89
ISPCLZ2  DS    0H                                              SS AUG89
         OI    SPFLAG2,SPFNPOS      POSITIONING NOT ALLOWED    SS AUG89
         BAS   R2,ISPTBPUT          UPDATE TABLE LINE          SS AUG89
         BAS   R2,ISPQUERY                                     SS AUG89
         MVC   SPFTCCRP,SPFTCRP     SAVE CUR CPR FOR CURSOR    SS AUG89
         NI    SPFTFLG1,255-SPFTLPOS  RESET POST PROC FLAG     SS AUG89
         OI    SPFTFLG2,SPFLKILL   SET FOR ERROR               SS AUG89
         LA    R15,100             TBDISPL SUPPORT             SS AUG89
         BR    R3                  RETURN TO ROUTER            SS AUG89
         SPACE 2                                               SS AUG89
ISPCLZU  DS    0H                                              SS AUG89
* UNCATALOG DATASET                     *                      SS AUG89
         CLC   SPFCVOL,ISPCLZMM         MIGRATED               SS AUG89
         BE    ISPCLZZ0                 YES, SKIP              SS AUG89
* FIRST CHECK IF IT IS A CATALOGED DSN                         SS AUG89
         LA    R1,SPFCDSN               *                      SS AUG89
         BAS   R2,ISPCATL               *                      SS AUG89
         LTR   R15,R15                  FOUND                  SS AUG89
         BNZ   ISPCLZU2                 NO, CHECK MORE         SS AUG89
         CLC   WORKTBL(2),ISPL1+2       ONLY ONE VOL           SS AUG89
         BNE   ISPCLZUU                 NO, NOT THE SAME       SS AUG89
         CLC   SPFCVOL,WORKTBL+6        SAME VOLUME            SS AUG89
         BNE   ISPCLZUU                 NO                     SS AUG89
         MVC   SPFCAMLS(12),ISPCLZUC    UNCAT CAMLIST          SS AUG89
         LA    R1,SPFCDSN               *                      SS AUG89
         ST    R1,SPFCAMLS+4            SET DSN ADDR           SS AUG89
         CATALOG SPFCAMLS               UNCAT                  SS AUG89
         LTR   R15,R15                  RC                     SS AUG89
         BNZ   ISPCLZE1                 CHECK NONZERO RC       SS AUG89
         MVI   SPFCCAT,C'N'             SET TO NO CAT          SS AUG89
         B     ISPCLZN                  CONTINUE NORMAL        SS AUG89
ISPCLZU2 DS    0H                       *                      SS AUG89
         C     R15,ISPL4                NO CATALOG             SS AUG89
         BE    ISPCLZE4                                        SS AUG89
         CH    R15,ISPH16               NO CATALOG             SS AUG89
         BH    ISPCLZE1                 OTHER ERROR            SS AUG89
ISPCLZUU DS    0H                                              SS AUG89
         MVI   SPFCCAT,C'N'             NOT     CATALOGED      SS AUG89
         LH    R1,SPFTBPDA                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(8,R1),ISPCLZX2         COPY DATA MSG          SS AUG89
         LH    R1,SPFTBPOT                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS AUG89
         BAS   R2,ISPTBPUT         UPDATE TABLE                SS AUG89
         B     ISPCLZY                  CONTINUE               SS AUG89
ISPCLZUC CAMLST UNCAT,0                 *                      SS AUG89
         SPACE 2                                               SS AUG89
ISPCLZC  DS    0H                                              SS AUG89
* CATALOG   DATASET                     *                      SS AUG89
         CLC   SPFCVOL,ISPCLZMM         MIGRATED               SS AUG89
         BE    ISPCLZZ0                 YES, SKIP              SS AUG89
* FIRST CHECK IF IT IS A CATALOGED DSN                         SS AUG89
         LA    R1,SPFCDSN               *                      SS AUG89
         BAS   R2,ISPCATL               *                      SS AUG89
         C     R15,ISPL4                NO CATALOG             SS AUG89
         BE    ISPCLZE4                                        SS AUG89
         LTR   R15,R15                  FOUND                  SS AUG89
         BNZ   ISPCLZC2                 YES, DUP               SS AUG89
         CLC   WORKTBL(2),ISPL1+2       ONLY ONE VOL           SS AUG89
         BNE   ISPCLZE7                 NO, NOT THE SAME       SS AUG89
         CLC   SPFCVOL,WORKTBL+6        SAME VOLUME            SS AUG89
         BNE   ISPCLZE7                 NO                     SS AUG89
         MVI   SPFCCAT,C'Y'             ALREADY CATALOGED      SS AUG89
         LH    R1,SPFTBPDA                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(8,R1),ISPCLZCM         COPY DATA MSG          SS AUG89
         LH    R1,SPFTBPOT                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS AUG89
         BAS   R2,ISPTBPUT         UPDATE TABLE                SS AUG89
         B     ISPCLZY                  CONTINUE               SS AUG89
ISPCLZCM DC    CL8'*WASCATD'            *                      SS AUG89
ISPCLZC2 DS    0H                                              SS AUG89
         CH    R15,ISPH16               NOT FOUND              SS AUG89
         BH    ISPCLZE1                 SOME ERROR             SS AUG89
         MVC   SPFCAMLS(12),ISPCLZCC    CAT   CAMLIST          SS AUG89
         LA    R1,SPFCDSN               *                      SS AUG89
         ST    R1,SPFCAMLS+4            SET DSN ADDR           SS AUG89
         LA    R1,WORKTBL               *                      SS AUG89
         ST    R1,SPFCAMLS+12           SET WORKTBL            SS AUG89
         LA    R1,1                     *                      SS AUG89
         STH   R1,WORKTBL               SET VOL COUNT          SS AUG89
         MVC   WORKTBL+6(6),SPFCVOL     SET VOL                SS AUG89
         SR    R0,R0                    *                      SS AUG89
         STH   R0,WORKTBL+12            ZERO SEQ NUM           SS AUG89
         CLI   SPFCDEV,0          ANY TYPE                     SS OCT88
         BNE   ISPCLZCY           YES, SKIP                    SS AUG89
         LA    R15,SPFCVOL        GET VOLUME                   SS AUG89
         BAS   R2,ISPDEVTY        GET DEVTYPE                  SS AUG89
         LTR   R15,R15            FOUND *                      SS AUG89
         BNZ   ISPCLZD4           NO, ERROR                    SS AUG89
         STCM  R1,B'1111',SPFCDEV SET DEVTYPE                  SS AUG89
ISPCLZCY DS    0H                                              SS AUG89
         MVC    WORKTBL+2(4),SPFCDEV    SET DEVICE TYPE        SS AUG89
         CATALOG SPFCAMLS               UNCAT                  SS AUG89
         LTR   R15,R15                  RC                     SS AUG89
         BNZ   ISPCLZEC                 CHECK NONZERO RC       SS AUG89
         MVI   SPFCCAT,C'Y'             SET TO CATALOG         SS AUG89
         B     ISPCLZN                  CONTINUE NORMAL        SS AUG89
ISPCLZCC CAMLST CAT,0,,8                *                      SS AUG89
         SPACE 2                                               SS AUG89
ISPCLZD  DS    0H                                              SS AUG89
* DELETE    DATASET                     *                      SS AUG89
         CLC   SPFCVOL,ISPCLZMM         MIGRATED               SS AUG89
         BE    ISPCLZZ0                 YES, SKIP              SS AUG89
* FIRST CHECK IF DATASET EXISTS                                SS AUG89
         LA    R1,SPFCVOL               *                      SS AUG89
         LA    R14,SPFCDSN              *                      SS AUG89
         BAS   R2,ISPDSCB               *                      SS AUG89
* CHECK NOT FOUND                       *                      SS AUG89
         LTR   R15,R15                  FOUND                  SS AUG89
         BNZ   ISPCLZD9                 NO, CHECK WHY          SS AUG89
* ALSO  CHECK IF DATASET IS CATALOGED                          SS AUG89
         LA    R1,SPFCDSN               *                      SS AUG89
         BAS   R2,ISPCATL               *                      SS AUG89
         LTR   R15,R15                  FOUND                  SS AUG89
         BNZ   ISPCLZD2                 NO, NOT CATALOGED      SS AUG89
         CLC   WORKTBL(2),ISPL1+2       ONLY ONE VOL           SS AUG89
         BNE   ISPCLZD2                 NO, NOT THE SAME       SS AUG89
         CLC   SPFCVOL,WORKTBL+6        SAME VOLUME            SS AUG89
         BNE   ISPCLZD2                 NO                     SS AUG89
         MVI   SPFCCAT,C'Y'             YES, CATALOGED         SS AUG89
         MVC   SPFCDEV,WORKTBL+2        GET DEVTYPE            SS AUG89
* DISPLAY PROMPT PANEL                  *                      SS AUG89
         MVC   SPFCUCUR,ISPYES          *                      SS AUG89
         MVC   SPFMSGID,ISPBLK8         *                      SS AUG89
         MVI   SPFVZCMD,C' '            BLANK                  SS AUG89
         MVC   SPFVZCMD+1(248),SPFVZCMD    RIPPLE              SS DEC87
         LA    R15,ISPCLZDP       ADDRESS OF PANEL TABLE       SS OCT88
         LA    R1,SPFMSGID        SET FOR MESSAGE              SS DEC87
         BAS   R2,ISPSINGI        DISPLAY PANEL                SS DEC87
         MVI   SPFMSGID,C' '      CLEAR MESSAGE ID             SS DEC87
         C     R15,ISPL8          END KEY                      SS DEC87
         BE    ISPCLZDC           CANCEL REQUEST               SS DEC87
* WORKTBL FILLED IN BY CATALOG LOCATE   *                      SS AUG89
         B     ISPCLZD3                 NO                     SS AUG89
ISPCLZDP DC    CL8'&P.LCDE'             *                      SS OCT88
ISPCLZD2 DS    0H                                              SS AUG89
         MVI   SPFCCAT,C'N'             NOT CATALOGED          SS AUG89
* DISPLAY PROMPT PANEL                  *                      SS AUG89
         MVI   SPFVZCMD,C' '            BLANK                  SS AUG89
         MVC   SPFVZCMD+1(248),SPFVZCMD    RIPPLE              SS DEC87
         LA    R15,ISPCLZDT       ADDRESS OF PANEL TABLE       SS OCT88
         LA    R1,ISPBLK8         SET FOR MESSAGE              SS DEC87
         BAS   R2,ISPSINGI        DISPLAY PANEL                SS DEC87
         MVI   SPFMSGID,C' '      CLEAR MESSAGE ID             SS DEC87
         C     R15,ISPL8          END KEY                      SS DEC87
         BE    ISPCLZDC           CANCEL REQUEST               SS DEC87
* WORKTBL NEEDS TO BE BUILT             *                      SS AUG89
         XC    WORKTBL(255),WORKTBL     *                      SS AUG89
         LA    R1,1                     *                      SS AUG89
         STH   R1,WORKTBL               SET VOL COUNT          SS AUG89
         MVC   WORKTBL+6(6),SPFCVOL     SET VOL                SS AUG89
         SR    R0,R0                    *                      SS AUG89
         STH   R0,WORKTBL+12            ZERO SEQ NUM           SS AUG89
         CLI   SPFCDEV,0          ANY TYPE                     SS OCT88
         BNE   ISPCLZDY           YES, SKIP                    SS AUG89
         LA    R15,SPFCVOL        GET VOLUME                   SS AUG89
         BAS   R2,ISPDEVTY        GET DEVTYPE                  SS AUG89
         LTR   R15,R15            FOUND *                      SS AUG89
         BNZ   ISPCLZD4           NO, ERROR                    SS AUG89
         STCM  R1,B'1111',SPFCDEV SET DEVTYPE                  SS AUG89
ISPCLZDY DS    0H                                              SS AUG89
         MVC    WORKTBL+2(4),SPFCDEV    SET DEVICE TYPE        SS AUG89
         B     ISPCLZD3                 NO                     SS AUG89
ISPCLZDT DC    CL8'&P.LCD2'             *                      SS OCT88
ISPCLZD3 DS    0H                                              SS AUG89
* DELETE                                *                      SS AUG89
         MVC   SPFCAMLS(12),ISPCLZSC    SCRATCH CAMLIST        SS AUG89
         LA    R1,SPFCDSN               *                      SS AUG89
         ST    R1,SPFCAMLS+4            SET DSN ADDR           SS AUG89
         LA    R1,WORKTBL               *                      SS AUG89
         ST    R1,SPFCAMLS+12           SET WORKTBL            SS AUG89
         XC    WORKTBL+252(4),WORKTBL+252  CLEAR TTR           SS AUG89
         SR    R0,R0                    NO UCB                 SS AUG89
         SCRATCH SPFCAMLS               *                      SS AUG89
         LTR   R15,R15                  RC                     SS AUG89
         BNZ   ISPCLZF0                 ERROR                  SS AUG89
         MVI   SPFCVTOC,C'N'            NO LONGER ON VTOC      SS AUG89
         CLI   SPFCCAT,C'Y'             UNCAT POSSIBLE         SS AUG89
         BNE   ISPCLZD5                 NO, CLEANUP            SS AUG89
         CLI   SPFCUCUR,C'Y'            UNCAT REQUEST          SS AUG89
         BNE   ISPCLZD5                 NO, CLEANUP            SS AUG89
         MVC   SPFCAMLS(12),ISPCLZUC    UNCAT CAMLIST          SS AUG89
         LA    R1,SPFCDSN               *                      SS AUG89
         ST    R1,SPFCAMLS+4            SET DSN ADDR           SS AUG89
         CATALOG SPFCAMLS               UNCAT                  SS AUG89
         LTR   R15,R15                  RC                     SS AUG89
         BNZ   ISPCLZE1                 CHECK NONZERO RC       SS AUG89
         MVI   SPFCCAT,C'N'             SET TO NO CAT          SS AUG89
ISPCLZD5 DS    0H                                              SS AUG89
         CLI   SPFCCAT,C'Y'             STILL CATALOGED        SS AUG89
         BE    ISPCLZD6                 YES, NO REMOVE OPTION  SS AUG89
         CLI   SPFLFDEL,C'Y'            REMOVE IS YES          SS AUG89
         BE    ISPCLZD7                 YES, THEN REMOVE       SS AUG89
ISPCLZD6 DS    0H                                              SS AUG89
         B     ISPCLZN                  DO NOT REMOVE          SS AUG89
ISPCLZD7 DS    0H                       REMOVE                 SS AUG89
         BAS   R2,ISPDEL1               *                      SS AUG89
         B     ISPCLZY                  *                      SS AUG89
ISPCLZD9 DS    0H                       REMOVE                 SS AUG89
         C     R15,ISPL8                *                      SS AUG89
         BNE   ISPCLZDE                 *                      SS AUG89
         MVI   SPFCVTOC,C'N'            NOT ON VTOC            SS AUG89
         LH    R1,SPFTBPDA                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(8,R1),ISPCLZDM         COPY DATA MSG          SS AUG89
         LH    R1,SPFTBPOT                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS AUG89
         BAS   R2,ISPTBPUT         UPDATE TABLE                SS AUG89
         B     ISPCLZY                  CONTINUE               SS AUG89
ISPCLZDM DC    CL8'*WASGONE'            *                      SS AUG89
ISPCLZDC DS    0H                       BYPASS                 SS AUG89
         LH    R1,SPFTBPDA                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(8,R1),ISPCLZDQ         COPY DATA MSG          SS AUG89
         LH    R1,SPFTBPOT                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS AUG89
         BAS   R2,ISPTBPUT         UPDATE TABLE                SS AUG89
         B     ISPCLZY                  CONTINUE               SS AUG89
ISPCLZDQ DC    CL8'*BYPASS'             *                      SS AUG89
ISPCLZSC CAMLST SCRATCH,0,,8,,OVRD      *                      SS AUG89
         SPACE 2                                               SS AUG89
ISPCLZR  DS    0H                                              SS AUG89
         CLC   SPFCVOL,ISPCLZMM         MIGRATED               SS AUG89
         BE    ISPCLZZ0                 YES, SKIP              SS AUG89
* FIRST CHECK IF DATASET EXISTS                                SS AUG89
         LA    R1,SPFCVOL               *                      SS AUG89
         LA    R14,SPFCDSN              *                      SS AUG89
         BAS   R2,ISPDSCB               *                      SS AUG89
* CHECK NOT FOUND                       *                      SS AUG89
         LTR   R15,R15                  FOUND                  SS AUG89
         BNZ   ISPCLZR8                 NO, CHECK WHY          SS OCT89
* ALSO  CHECK IF DATASET IS CATALOGED                          SS AUG89
         LA    R1,SPFCDSN               *                      SS AUG89
         BAS   R2,ISPCATL               *                      SS AUG89
         LTR   R15,R15                  FOUND                  SS AUG89
         BNZ   ISPCLZR2                 NO, NOT CATALOGED      SS AUG89
         CLC   WORKTBL(2),ISPL1+2       ONLY ONE VOL           SS AUG89
         BNE   ISPCLZR2                 NO, NOT THE SAME       SS AUG89
         CLC   SPFCVOL,WORKTBL+6        SAME VOLUME            SS AUG89
         BNE   ISPCLZR2                 NO                     SS AUG89
         MVI   SPFCCAT,C'Y'             YES, CATALOGED         SS AUG89
         MVC   SPFCDEV,WORKTBL+2        GET DEVTYPE            SS AUG89
         MVC   SPFCUCUR,ISPYES          *                      SS AUG89
         MVC   SPFCCNEW,ISPYES          *                      SS AUG89
         MVC   SPFCCNTL,ISPYES          *                      SS AUG89
         MVC   SPFMSGID,ISPBLK8         *                      SS AUG89
ISPCLZR0 DS    0H                                              SS AUG89
* DISPLAY PROMPT PANEL                  *                      SS AUG89
         MVI   SPFVZCMD,C' '            BLANK                  SS AUG89
         MVC   SPFVZCMD+1(248),SPFVZCMD    RIPPLE              SS DEC87
         LA    R15,ISPCLZRP       ADDRESS OF PANEL TABLE       SS OCT88
         LA    R1,SPFMSGID        SET FOR MESSAGE              SS DEC87
         BAS   R2,ISPSINGI        DISPLAY PANEL                SS DEC87
         MVI   SPFMSGID,C' '      CLEAR MESSAGE ID             SS DEC87
         C     R15,ISPL8          END KEY                      SS DEC87
         BE    ISPCLZDC           CANCEL REQUEST               SS DEC87
* WORKTBL FILLED IN BY CATALOG LOCATE   *                      SS AUG89
         B     ISPCLZR3                 NO                     SS AUG89
ISPCLZRP DC    CL8'&P.LCRE'             *                      SS OCT88
ISPCLZR2 DS    0H                                              SS AUG89
         MVI   SPFCCAT,C'N'             NOT CATALOGED          SS AUG89
         MVC   SPFCCNEW,ISPNO           *                      SS AUG89
         MVC   SPFMSGID,ISPBLK8         *                      SS AUG89
* DISPLAY PROMPT PANEL                  *                      SS AUG89
ISPCLZR1 DS    0H                                              SS AUG89
         MVI   SPFVZCMD,C' '            BLANK                  SS AUG89
         MVC   SPFVZCMD+1(248),SPFVZCMD    RIPPLE              SS DEC87
         LA    R15,ISPCLZRT       ADDRESS OF PANEL TABLE       SS OCT88
         LA    R1,SPFMSGID        SET FOR MESSAGE              SS DEC87
         BAS   R2,ISPSINGI        DISPLAY PANEL                SS DEC87
         MVI   SPFMSGID,C' '      CLEAR MESSAGE ID             SS DEC87
         C     R15,ISPL8          END KEY                      SS DEC87
         BE    ISPCLZDC           CANCEL REQUEST               SS DEC87
         B     ISPCLZR3                 NO                     SS AUG89
ISPCLZRT DC    CL8'&P.LCR2'             *                      SS OCT88
ISPCLZR3 DS    0H                                              SS AUG89
* VALIDATE TARGATE DSN                  *                      SS AUG89
         LA    R1,SPFCVOL               *                      SS AUG89
         LA    R14,SPFZSEL              NEW DSN                SS AUG89
         BAS   R2,ISPDSCB               *                      SS AUG89
         LTR   R15,R15                  RC=0                   SS AUG89
         BZ    ISPCLZRD                 YES, DUP               SS AUG89
         C     R15,ISPL8                RC=8                   SS DEC87
         BNE   ISPCLZDE                 NO, SOME ERROR         SS DEC87
* VALIDATE CATALOG NEW                  *                      SS AUG89
         CLI   SPFCCNEW,C'Y'            CATALOG NEW            SS AUG89
         BNE   ISPCLZRB                 NO, SKIP CHECK         SS AUG89
         LA    R1,SPFZSEL               *                      SS AUG89
         BAS   R2,ISPCATL               *                      SS AUG89
         LTR   R15,R15                  FOUND                  SS AUG89
         BZ    ISPCLZR4                 YES, CANT CTLG         SS AUG89
ISPCLZRB DS    0H                       *                      SS AUG89
* WORKTBL NEEDS TO BE BUILT             *                      SS AUG89
         XC    WORKTBL(255),WORKTBL     *                      SS AUG89
         LA    R1,1                     *                      SS AUG89
         STH   R1,WORKTBL               SET VOL COUNT          SS AUG89
         MVC   WORKTBL+6(6),SPFCVOL     SET VOL                SS AUG89
         SR    R0,R0                    *                      SS AUG89
         STH   R0,WORKTBL+12            ZERO SEQ NUM           SS AUG89
         CLI   SPFCDEV,0          ANY TYPE                     SS OCT88
         BNE   ISPCLZRY           YES, SKIP                    SS AUG89
         LA    R15,SPFCVOL        GET VOLUME                   SS AUG89
         BAS   R2,ISPDEVTY        GET DEVTYPE                  SS AUG89
         LTR   R15,R15            FOUND *                      SS AUG89
         BNZ   ISPCLZD4           NO, ERROR                    SS AUG89
         STCM  R1,B'1111',SPFCDEV SET DEVTYPE                  SS AUG89
ISPCLZRY DS    0H                                              SS AUG89
         MVC    WORKTBL+2(4),SPFCDEV    SET DEVICE TYPE        SS AUG89
* SETUP RENAME                          *                      SS AUG89
         MVC   SPFCAMLS(12),ISPCLZRC    RENAME  CAMLIST        SS AUG89
         LA    R1,SPFCDSN               *                      SS AUG89
         ST    R1,SPFCAMLS+4            SET DSN ADDR           SS AUG89
         LA    R1,SPFZSEL               SET NEW NAME           SS AUG89
         ST    R1,SPFCAMLS+8            SET DSN ADDR           SS AUG89
         LA    R1,WORKTBL               *                      SS AUG89
         ST    R1,SPFCAMLS+12           SET WORKTBL            SS AUG89
         SR    R0,R0                    NO UCB                 SS AUG89
         RENAME SPFCAMLS                *                      SS AUG89
         LTR   R15,R15                  RC                     SS AUG89
         BNZ   ISPCLZF0                 ERROR                  SS AUG89
         MVI   SPFCVTOC,C'N'            NO LONGER ON VTOC      SS AUG89
         CLI   SPFCCAT,C'Y'             UNCAT POSSIBLE         SS AUG89
         BNE   ISPCLZR5                 NO, CLEANUP            SS AUG89
         CLI   SPFCUCUR,C'Y'            UNCAT REQUEST          SS AUG89
         BNE   ISPCLZR5                 NO, CLEANUP            SS AUG89
         MVC   SPFCAMLS(12),ISPCLZUC    UNCAT CAMLIST          SS AUG89
         LA    R1,SPFCDSN               *                      SS AUG89
         ST    R1,SPFCAMLS+4            SET DSN ADDR           SS AUG89
         CATALOG SPFCAMLS               UNCAT                  SS AUG89
         LTR   R15,R15                  RC                     SS AUG89
         BNZ   ISPCLZR5                 CHECK NONZERO RC       SS AUG89
         MVI   SPFCCAT,C'N'             SET TO NO CAT          SS AUG89
ISPCLZR5 DS    0H                                              SS AUG89
         SR    R0,R0                    *                      SS AUG89
         STH   R0,WORKTBL+12            ZERO SEQ NUM           SS AUG89
         MVC   SPFCCNTL,ISPNO           ASSUME NO CAT          SS AUG89
         CLI   SPFCCNEW,C'Y'            NEED TO CAT NEW        SS AUG89
         BNE   ISPCLZR6                 NO, UPDATE TABLE       SS AUG89
         MVC   SPFCCNTL,ISPYES          ASSUME GOOD CAT        SS AUG89
         MVC   SPFCAMLS(12),ISPCLZCC    CAT   CAMLIST          SS AUG89
         LA    R1,SPFZSEL               NEW NAME               SS AUG89
         ST    R1,SPFCAMLS+4            SET DSN ADDR           SS AUG89
         LA    R1,WORKTBL               *                      SS AUG89
         ST    R1,SPFCAMLS+12           SET WORKTBL            SS AUG89
         CATALOG SPFCAMLS               CAT NEW                SS AUG89
         LTR   R15,R15                  RC                     SS AUG89
         BZ    ISPCLZR6                 OK, CONTINUE           SS AUG89
         MVI   SPFCCNTL,C'B'            BAD CATALOG            SS AUG89
ISPCLZR6 DS    0H                                              SS AUG89
         BAS   R2,ISPLMSGS              SET MESSAGE            SS AUG89
         LH    R1,SPFTBPOT                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS AUG89
         BAS   R2,ISPTBMOD              SAVE ANY CHANGES       SS AUG89
         MVC   SPFVZCMD(44),SPFCDSN     SAVE DSN OF OLD        SS AUG89
         MVC   SPFCDSN,SPFZSEL          GET NEW                SS AUG89
         MVC   SPFCCAT(1),SPFCCNTL      NEW CAT ATTR           SS AUG89
         MVC   SPFCDATA,ISPNEWNM        NEW NAME               SS AUG89
         MVC   SPFCOPT,ISPBLK8          CLEAR OPT              SS AUG89
         MVI   SPFCVTOC,C'Y'            ON VTOC                SS AUG89
         MVC   SPFCCAT(1),SPFCCNTL      NEW CAT ATTR           SS AUG89
         CLI   SPFCCAT,C'B'             BAD CAT                SS AUG89
         BNE   ISPCLZRG                 NO, GOOD               SS AUG89
         MVI   SPFCCAT,C'N'             NO, CAT                SS AUG89
         MVC   SPFCDATA,ISPCLZX1        MESSAGE                SS AUG89
ISPCLZRG DS    0H                       *                      SS AUG89
         BAS   R2,ISPTBMOD              PUT IT IN TABLE        SS AUG89
         MVC   SPFCDSN,SPFVZCMD         GET OLD DSN            SS AUG89
         BAS   R2,ISPGET                *                      SS AUG89
         CLI   SPFCCAT,C'Y'             STILL CATALOGED        SS AUG89
         BE    ISPCLZR7                 YES, NO REMOVE OPTION  SS AUG89
         CLI   SPFLFOLD,C'Y'            REMOVE IS YES          SS AUG89
         BNE   ISPCLZY                  DONE                   SS AUG89
         BAS   R2,ISPDEL1               *                      SS AUG89
         B     ISPCLZY                  DONE                   SS AUG89
ISPCLZR7 DS    0H                                              SS AUG89
         CLI   SPFCUCUR,C'Y'            WAS IT TO BE UNCAT     SS AUG89
         BNE   ISPCLZY                  OK                     SS AUG89
         MVC   SPFCDATA,ISPCLZXN        CAN UNCAT              SS AUG89
         BAS   R2,ISPTBMOD              SET MESSAGE            SS AUG89
         B     ISPCLZY                  DONE                   SS AUG89
ISPCLZRC CAMLST RENAME,0,4,8            *                      SS AUG89
ISPCLZRD DS    0H                                              SS AUG89
         LA    R1,ISPCLZRM              GET DUP MESSAGE        SS AUG89
         B     ISPCLZR9                 *                      SS AUG89
ISPCLZR8 DS    0H                                              SS OCT89
         C     R15,ISPL8                *                      SS OCT89
         BNE   ISPCLZDE                 *                      SS OCT89
         MVI   SPFCVTOC,C'N'            NOT ON VTOC            SS OCT89
         B     ISPCLZDE                 *                      SS OCT89
ISPCLZR4 DS    0H                                              SS AUG89
         LA    R1,ISPCLZRN              GET DUP CAT MSG        SS AUG89
* SETUP MESSAGE                         *                      SS AUG89
ISPCLZR9 DS    0H                                              SS AUG89
         MVC   SPFCCNTL,ISPNO           DONE CHANGE DSN        SS AUG89
         MVC   SPFMLIN2(79),0(R1)       COPY MAIN MSG          SS AUG89
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS AUG89
         MVI   SPFMSGID+7,C'A'                                 SS AUG89
         MVI   SPFMSGID+6,C'1'    GENERAL ERROR MESSAGE        SS AUG89
         CLI   SPFCCAT,C'N'             CATALOGED              SS AUG89
         BE    ISPCLZR1                 NO, OTHER DISPLAY      SS AUG89
         B     ISPCLZR0                 YES, FIRST DISPLAY     SS AUG89
ISPCLZE1 DS    0H                       *                      SS AUG89
         B     *+4(R15)                 BRANCH ON RC           SS AUG89
         B     ISPCLZN                  0 NORMAL               SS AUG89
         B     ISPCLZE4                 4 NO CAT FOUND         SS AUG89
         B     ISPCLZE8                 8 DSN NOT FOUND        SS AUG89
         B     ISPCLZE8                 12 DSN NOT FOUND       SS AUG89
         B     ISPCLZE8                 16 DSN NOT FOUND       SS AUG89
         B     ISPCLZES                 20 SYNTAX ERROR        SS AUG89
         B     ISPCLZEI                 24 I/O ERROR           SS AUG89
         B     ISPCLZEI                 28 CANT BE             SS AUG89
ISPCLZEC DS    0H                       *                      SS AUG89
         B     *+4(R15)                 BRANCH ON RC           SS AUG89
         B     ISPCLZN                  0 NORMAL               SS AUG89
         B     ISPCLZE4                 4 NO CAT FOUND         SS AUG89
         B     ISPCLZEV                 8  INCONSISTENT        SS AUG89
         B     ISPCLZEV                 12 NOT USED            SS AUG89
         B     ISPCLZEV                 16 INCONSISTENT        SS AUG89
         B     ISPCLZEO                 20 OUT OF SPACE        SS AUG89
         B     ISPCLZEI                 24 I/O ERROR           SS AUG89
         B     ISPCLZEI                 28 CANT BE             SS AUG89
ISPCLZF0 DS    0H                       REMOVE                 SS AUG89
* SCRATCH OR RENAME FAILURE             *                      SS AUG89
         C     R15,ISPL8                NEED STATUS CODE       SS AUG89
         BNE   ISPCLZDE                 NO, SAME AS OBTAIN     SS AUG89
         IC    R15,WORKTBL+13           GET STATUS CODE        SS AUG89
         SLL   R15,2                    TIME 4 FOR BRANCH      SS AUG89
         B     *+4(R15)                 BRANCH ON RC           SS AUG89
         B     ISPCLZN                  0 NORMAL               SS AUG89
         B     ISPCLZD4                 1 NO DSCB              SS AUG89
         B     ISPCLZF8                 2 PASSWORD             SS AUG89
         B     ISPCLZDV                 3 CANT BE              SS AUG89
         B     ISPCLZDI                 4 I/O ERROR            SS AUG89
         B     ISPCLZDV                 5 CANT BE              SS AUG89
         B     ISPCLZD4                 6 NO VOLUME            SS AUG89
         B     ISPCLZF7                 7 IN USE               SS AUG89
         B     ISPCLZF8                 8 RACF                 SS AUG89
ISPCLZDE DS    0H                       *                      SS AUG89
* OBTAIN FAILED                         *                      SS AUG89
         CH    R15,=H'16'               RC > 16               DRK APR10
         BH    ISPCLZDV                 CANT BE               DRK APR10
         B     *+4(R15)                 BRANCH ON RC           SS AUG89
         B     ISPCLZN                  0 NORMAL               SS AUG89
         B     ISPCLZD4                 4 NO VOLUME            SS AUG89
         B     ISPCLZD8                 8  NOT FOUND           SS AUG89
         B     ISPCLZDI                 12 I/O ERROR           SS AUG89
         B     ISPCLZDV                 16 CANT BE             SS AUG89
ISPCLZE4 DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZM1              MSG 1                  SS AUG89
         LA    R15,ISPCLZX1             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZE8 DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZM2              MSG 1                  SS AUG89
         LA    R15,ISPCLZX2             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZES DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZM3              MSG 1                  SS AUG89
         LA    R15,ISPCLZX3             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZEI DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZM4              MSG 1                  SS AUG89
         LA    R15,ISPCLZX4             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZEV DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZM5              MSG 1                  SS AUG89
         LA    R15,ISPCLZX5             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZEO DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZM6              MSG 1                  SS AUG89
         LA    R15,ISPCLZX6             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZE7 DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZM7              MSG 1                  SS AUG89
         LA    R15,ISPCLZX7             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZD4 DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZM8              MSG 1                  SS AUG89
         LA    R15,ISPCLZX8             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZD8 DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZM9              MSG 1                  SS AUG89
         LA    R15,ISPCLZX9             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZDI DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZMA              MSG 1                  SS AUG89
         LA    R15,ISPCLZX4             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZF7 DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZFU              MSG 1                  SS AUG89
         LA    R15,ISPCLZFI             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZF8 DS    0H                       *                      SS AUG89
         LA    R1,ISPCLZFS              MSG 1                  SS AUG89
         LA    R15,ISPCLZFP             DATA/MSG 1             SS AUG89
         B     ISPCLZMG                 SET MESSAGE            SS AUG89
ISPCLZZ0 DS    0H                       MIGRATED DATASET       SS AUG89
         MVI   SPFCVTOC,C'N'            NOT ON VTOC            SS AUG89
         LH    R1,SPFTBPDA                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(8,R1),ISPCLZX0         COPY DATA MSG          SS AUG89
         LH    R1,SPFTBPOT                                     SS AUG89
         LA    R1,SPWRKC(R1)                                   SS AUG89
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS AUG89
         BAS   R2,ISPTBPUT         UPDATE TABLE                SS AUG89
         B     ISPCLZY                  CONTINUE               SS AUG89
ISPCLZDV DS    0H                       *                      SS AUG89
         EX    R1,*                     ABEND                  SS AUG89
ISPCLZMM DC    CL6'MIGRAT'              MIGRATED               SS AUG89
ISPCLZX0 DC    CL8'*UNAVAL'             MIGRATED               SS AUG89
ISPCLZX1 DC    CL8'*NOCAT'              *                      SS AUG89
ISPCLZX2 DC    CL8'*NOTCATD'            *                      SS AUG89
ISPCLZX3 DC    CL8'*BADDSN'             *                      SS AUG89
ISPCLZX4 DC    CL8'*IOERROR'            *                      SS AUG89
ISPCLZX5 DC    CL8'*CANTCAT'            *                      SS AUG89
ISPCLZX6 DC    CL8'*NOSPACE'            *                      SS AUG89
ISPCLZX7 DC    CL8'*DUP    '            *                      SS AUG89
ISPCLZX8 DC    CL8'*NOVOL  '            *                      SS AUG89
ISPCLZX9 DC    CL8'*NOTHERE'            *                      SS AUG89
ISPCLZXN DC    CL8'*NOUNCAT'            *                      SS AUG89
ISPCLZFI DC    CL8'*INUSE'              *                      SS AUG89
ISPCLZFP DC    CL8'*SECURED'            *                      SS AUG89
ISPCLZM1 DC    CL79'CATALOG CANNOT BE FOUND OR OPENED'         SS AUG89
ISPCLZM2 DC    CL79'DATASET NOT FOUND IN CATALOG'              SS AUG89
ISPCLZM3 DC    CL79'DATASET SYNTAX ERROR'                      SS AUG89
ISPCLZM4 DC    CL79'I/O ERROR IN CATALOG'                      SS AUG89
ISPCLZM5 DC    CL79'DATASET NAME INCONSISTENT WITH CATALOG STRUCTURE'
ISPCLZM6 DC    CL79'THERE IS NO SPACE TO CATALOG THE DATASET'  SS AUG89
ISPCLZM7 DC    CL79'DUPLICATE NAME ON THE CATALOG'             SS AUG89
ISPCLZM8 DC    CL79'VOLUME NOT MOUNTED OR AVAILABLE'           SS AUG89
ISPCLZM9 DC    CL79'DATASET NOT ON VOLUME'                     SS AUG89
ISPCLZMA DC    CL79'I/O ERROR ON VTOC'                         SS AUG89
ISPCLZFU DC    CL79'THIS DATASET IS IN USE'                    SS AUG89
ISPCLZFS DC    CL79'YOUR ID DOES NOT HAVE UPDATE AUTHORITY FOR THIS DATX
               ASET'                    *                      SS AUG89
ISPCLZRM DC    CL79'NEW DATATSET ALREADY EXISTS ON THE VOLUME, CHANGE NX
               EW NAME'                 *                      SS AUG89
ISPCLZRN DC    CL79'NEW DATATSET ALREADY CATALOGED, CHANGE NEW NAME OR X
               USE NO CATALOG'          *                      SS AUG89
         SPACE 2                                               SS AUG89
         SPACE 2                                               SS AUG89
         DROP  R4                       *                      SS AUG89
