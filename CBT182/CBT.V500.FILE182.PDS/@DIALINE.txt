         TITLE 'GENERAL USE LINE CMD FUNCTION'                 SS NOV88
*************************************************************  SS NOV88
*                                                              SS NOV88
*      GENERAL USE LINE CMD FUNCTIONS                          SS NOV88
*                                                              SS NOV88
*************************************************************  SS NOV88
         SPACE 2
ISPLAVL  DS    0H                                              SS NOV85
ISPLLL   DS    0H  ALL LABELS CHANGED FROM ISPLAV.. TO ISPLL.. SS NOV88
         USING *,R4                                            SS NOV85
         SPACE 1
         BAS   R2,ISPSETST        SET TABLE STATS             ABL JAN87
         TM    SPFTFLG1,SPFTLPOS  POST PROCESSING REQUIRED     SS NOV85
         BO    ISPLLPP              YES                        SS NOV85
         NI    SPFLAG0,255-SPFCKER-SPFMSGER   RESET            SS SEP84
         LH    R1,SPFTBPDA    DATA OFFSET                      SS NOV85
         LA    R1,SPWRKC(R1)                                   SS NOV85
         OC    0(8,R1),ISPBLK8 FORCE UPPER CASE                SS NOV85
ISPLL00  DS    0H                       *                      SS JUL87
         BAS   R2,ISPTBNT     NOTE LINE ROW ID                 SS MAY89
         MVC   SPFTNOTE,SPFFIXED  SAVE ROW ID                  SS MAY89
         LH    R1,SPFTBPOT    OPT OFFSET                       SS NOV85
         LA    R1,SPWRKC(R1)                                   SS NOV85
         MVC   SPFINPUT(4),0(R1)  MOVE CMD                     SS NOV85
         MVI   SPFINPUT+4,C' '    FORCE TRAILING BLANK         SS NOV85
         OC    SPFINPUT(4),ISPBLK8 FORCE UPPER CASE            SS NOV85
         LA    R1,SPFINPUT                                     SS NOV85
         LA    R15,4          LIMIT OF SCAN OF LINE ENTRY      SS NOV85
         L     R14,SPFTBPLC  TABLE FOR SEARCH                  SS NOV85
         BAS   R2,ISPVER1           CHECK CMD VERB             SS NOV85
         MVC   SPFTTPT,SPFVTPT      COPY POINTER               SS NOV85
         TM    $TLF2(R14),#H        FROM O LINE CMD ONLY       SS NOV85
         BO    ISPLL3                                          SS NOV85
         TM    $TLF2(R14),#D        NOT FOR REPEAT CMDS        SS DEC87
         BO    ISPLL0               YES, SKIP                  SS DEC87
         TM    $TLF1(R14),#E        POSSIBLE CLIST             SS DEC87
         BO    ISPLL0               YES, PROCESSED LATER       SS DEC87
         MVC   SPFBLKCM,$TLCM(R14)  SAVE COMMAND FOR REPEAT    SS DEC87
ISPLL0   DS    0H                                              SS NOV85
         SR    R15,R15                                         SS SEP84
         IC    R15,$TLFU(R14)       GET PROCESSOR INDEX        SS JUL85
         B     *+4(R15)             INDEX TO PROCESSOR         SS SEP84
         B     ISPLL3            0  INVALID                    SS SEP84
         B     ISPLLB            4  BLANK LISTA                SS SEP84
         B     ISPLLD            8  DELETE ENTRY               SS NOV85
         B     ISPLLP           12  SELECT PANEL SUPPORT       SS NOV84
         B     ISPLLU           16  UTILITY COMMANDS           SS SEP84
         B     ISPLLFR          20  LISTA FREE                 SS NOV85
         B     ISPLLFR          24  LISTA DECONCAT             SS NOV85
         B     ISPLL3           28  LISTA SET CONCAT ENTRY     SS NOV85
         B     ISPLLSP          32  LISTV SPACE                SS NOV85
         B     ISPLLSP          36  LISTV UPDATE STATS         SS NOV85
         B     ISPLL3           40  LISTV ALLOC VOLUME         SS NOV85
         B     ISPLL3           44  LISTV VSAM TIME STAMP      SS NOV85
         B     ISPLL3           48  LISTV FREE SPACE EXTENTS   SS NOV85
         B     ISPLL3           52  LISTV DATASET LIST         SS NOV85
         B     ISPLL3           56  LISTV FIND DSN BY CCHH     SS NOV85
         B     ISPLLLG          60  LOG TABLE LINE             SS NOV86
         B     ISPLLCHG         64  LISTA CHANGE COMMAND      ABL JAN87
         B     ISPLLSX          68  SELECT COMMAND             SS JUL87
         B     ISPLLXX          72  EXTENSION XCTL             SS JUL87
         B     ISPLLG           76  PDS LINE COMMAND          ABL MAY88
         B     ISPLLGG          80  INTERFACE WITH LISTF VTOC  SS OCT88
         B     ISPLLTT          84  TCT EXECUTE COMMAND        SS NOV88
         B     ISPLLTAD         88  TCT ADD BLANK LINE         SS NOV88
         B     ISPLLTUP         92  TCT VIEW AND UPDATE        SS NOV88
         B     ISPLLZZ          96  EXTENSION XCTL CLZ         SS AUG89
         SPACE 3                                               SS SEP84
ISPLLPP  DS    0H                                              SS NOV88
         L     R15,SPFTNOTE        GET SAVED ROW ID            SS MAY89
         BAS   R2,ISPTBRD          REPOSITION TO ROW           SS MAY89
         L     R14,SPFTTPT         GET MY TABLE ENTRY          SS NOV85
         SR    R15,R15                                         SS SEP84
         IC    R15,SPFTPOSI         GET POST PROCESSOR INDEX   SS SEP84
         B     *+4(R15)             INDEX TO PROCESSOR         SS SEP84
         B     ISPLLY            0  CLEAN UP                   SS SEP84
         B     ISPLLGP           4  GENERAL PROCESSOR          SS SEP84
         B     ISPLLCG           8  CHANGE PROCESSOR          ABL JAN87
         B     ISPLL2           12  RETURN AFTER DISPLAY ERR   SS NOV88
         SPACE 1                                               SS NOV88
ISPLLAA DC     AL2(SPFLISTA-SPWRKC)                            SS NOV85
ISPLLVV DC     AL2(SPFLISTV-SPWRKC)                            SS NOV85
         SPACE 3                                               SS SEP84
ISPLLER  DS    0H                                              SS SEP84
         NI    SPFLAG0,255-SPFCKER-SPFMSGER   RESET            SS SEP84
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                ABL JUN85
         MVI   SPFMSGID+7,C'A'                                ABL JUN85
         MVI   SPFMSGID+6,C'1'    GENERAL ERROR MESSAGE       ABL JUN85
         LA    R15,ISPERMSG       ERROR MESSAGE                SS FEB89
         B     ISPLL4           CONTINUE                       SS FEB89
ISPLLBSY DS    0H                       *                      SS FEB89
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS FEB89
         MVI   SPFMSGID+7,C'B'                                 SS FEB89
         MVI   SPFMSGID+6,C'1'    GENERAL ERROR MESSAGE        SS FEB89
         LA    R15,ISPBUSY           BUSY MSG                  SS FEB89
         B     ISPLL4                SET MSG                   SS FEB89
ISPLL3   DS    0H                                              SS SEP84
         LA    R15,ISPINVLD          INVALID MESSAGE           SS FEB89
ISPLL4   DS    0H                                              SS SEP84
         LH    R1,SPFTBPDA                                     SS NOV85
         LA    R1,SPWRKC(R1)                                   SS NOV85
         MVC   0(8,R1),0(R15)                                  SS FEB89
ISPLL2   DS    0H                                              SS NOV85
         OI    SPFLAG2,SPFNPOS      POSITIONING NOT ALLOWED   ABL APR86
         BAS   R2,ISPTBPUT          UPDATE TABLE LINE          SS SEP84
         BAS   R2,ISPQUERY                                     SS MAR85
         MVC   SPFTCCRP,SPFTCRP     SAVE CUR CPR FOR CURSOR    SS MAR85
         NI    SPFTFLG1,255-SPFTLPOS  RESET POST PROC FLAG     SS AUG86
         NI    SPFTFLG1,255-SPFTYOFF  RESET OFFSET    FLAG     SS NOV88
         OI    SPFTFLG2,SPFLKILL   SET FOR ERROR               SS AUG86
         MVC   SPFBLKCM(4),ISPBLK8  BLANK INVALID CMD          SS DEC87
         CLC   SPFTCCRP,SPFTTOP2    CURSOR WITHIN RANGE        SS MAR89
         BNL   ISPLL100             YES                        SS MAR89
         MVC   SPFTTOP2,SPFTTOP     TRY IT WITH SCROLL         SS MAR89
         CLC   SPFTCCRP,SPFTTOP2    CURSOR WITHIN RANGE        SS MAR89
         BNL   ISPLL100             YES                        SS MAR89
         MVC   SPFTTOP2,SPFTCCRP    SET SCROLL TO CURSOR       SS MAR89
ISPLL100 LA    R15,100             TBDISPL SUPPORT             SS MAR89
         BR    R3                  RETURN TO ROUTER            SS NOV85
         SPACE 2                                               SS NOV85
ISPLLC   DS    0H                                              SS NOV85
         LA    R15,112            ISPCMDC                      SS NOV85
         BR    R3                 RETURN TO ROUTER             SS NOV85
         SPACE 2                                               SS SEP84
ISPLLXX  DS    0H                                              SS NOV85
         SR    R0,R0                    ZERO FOR IC            SS JUL87
         IC    R0,$TLEX(R14)            EX CODE                SS JUL87
         LA    R15,156                  EXTENSION FUNCTION     SS JUL87
         BR    R3                       RETURN TO ROUTER       SS JUL87
         SPACE 2                                               SS NOV85
ISPLLZZ  DS    0H                                              SS AUG89
         SR    R0,R0                    ZERO FOR IC            SS AUG89
         IC    R0,$TLEX(R14)            EX CODE                SS AUG89
         LA    R15,208                  EXTENSION FUNCTION     SS AUG89
         BR    R3                       RETURN TO ROUTER       SS AUG89
         SPACE 2                                               SS AUG89
ISPLLD   DS    0H                                              SS NOV85
         LH    R15,SPFTBPDA             DATA OFFSET            SS JUL87
         LA    R15,SPWRKC(R15)          ADDRESS                SS JUL87
         CLI   0(R15),C'*'              MSG                    SS JUL87
         BE    ISPLLD1                  YES, NORMAL DELETE 1   SS JUL87
         CLC   0(8,R15),ISPBLK8         BLANK                  SS JUL87
         BE    ISPLLD1                  YES, NORMAL DELETE 1   SS JUL87
         LA    R0,4                     EXCLUDE AMOUNT CODE    SS JUL87
         LA    R15,156                  EXTENSION FUNCTION     SS JUL87
         BR    R3                       RETURN TO ROUTER       SS JUL87
ISPLLD1 BAS    R2,ISPDEL1                                      SS NOV85
         BAS   R2,ISPQUERY                                     SS MAR89
         MVC   SPFTCCRP,SPFTCRP     SAVE CUR CPR FOR CURSOR    SS MAR89
         CLC   SPFTCCRP,SPFTTOP     CURSOR WITHIN RANGE        SS MAR89
         BNL   ISPLL5               YES                        SS MAR89
         MVC   SPFTTOP,SPFTTOP2     USE NON SCROLL VALUE       SS MAR89
         CLC   SPFTCCRP,SPFTTOP     CURSOR WITHIN RANGE        SS MAR89
         BNL   ISPLL5               YES                        SS MAR89
         MVC   SPFTTOP,SPFTCCRP     SET SCROLL TO CURSOR       SS MAR89
         B     ISPLL5                                          SS MAR89
ISPLLCG  DS    0H                                             ABL JAN87
         MVI   SPFPANPR,0          PANEL NAME CHANGED         ABL FEB87
         OI    SPFLAG2,SPFNPOS     OVERRIDE POSITIONING       ABL FEB87
         TM    $TLF1(R14),#V       VIEW MODE EXPECTED?        ABL JAN87
         BO    ISPLLCV             YES, IGNORE ERROR MSG FLG  ABL JAN87
         TM    SPFLAG0,SPFMSGER    ANY ERRORS?                ABL JAN87
         BO    ISPLLER             YES, TERMINATE LIST CMDS.  ABL JAN87
ISPLLCV  DS    0H                                             ABL JAN87
         BAS   R2,ISPLMSGS         PROCESS MESSAGE            ABL JAN87
         LH    R1,SPFTBPOT         OPT                        ABL JAN87
         LA    R1,SPWRKC(R1)                                  ABL JAN87
         MVC   0(4,R1),ISPBLK8      CLEAR OPTION              ABL JAN87
         BAS   R2,ISPTBPUT         UPDATE TABLE               ABL JAN87
         TM    ##ADRPA#,$F         SOFT ATTN SIGNALLED?       ABL JAN87
         BNO   ISPLLCC             NO, BRANCH                 ABL JAN87
         NI    ##ADRPA#,255-$F     YES, TURN OFF FLAG         ABL JAN87
         MVC   SPFADATA,ISPATTN    SPECIAL *ATTN* FLAG        ABL JAN87
         B     ISPLL2              TERMINATE LINE COMMANDS    ABL JAN87
ISPLLCC  DS    0H                       *                      SS MAR87
         TM    SPFLAG0,SPFMSGER    ANY ERRORS?                ABL JAN87
         BO    ISPLLX              YES, GO TO LOG             ABL JAN87
         MVI   SPFINPUT,C' '       BLANK                       SS MAR87
         MVC   SPFINPUT+1(47),SPFINPUT  BLANK                  SS MAR87
         L     R14,SPFTTPT         RELOAD CMD TABLE ENTRY PT   SS MAR87
         TM    $TLF2(R14),#R       SECONDARY COMMAND SET       SS MAR87
         BO    ISPLLCR             PROCESS IT                  SS MAR87
         CLI   $TLEX(R14),0        CHANGE ONLY                 SS MAR87
         BE    ISPLLX              YES, SET UP FOR VIEW LOG    SS MAR87
         MVC   PUTGETBF(11),ISPENDIT    USE AS MODEL           SS MAR87
         MVC   SPFINPUT(8),$TLCM(R14)   COPY IN NAME           SS MAR87
         B     ISPLLCX             PROCESS COMMAND             SS MAR87
ISPLLCR  DS    0H                       *                      SS MAR87
         SR    R1,R1               CLEAR FOR INSERT            SS MAR87
         IC    R1,$TLEX(R14)       GET INDEX                   SS MAR87
         LA    R1,ISPREAL(R1)           *                      SS MAR87
         MVC   PUTGETBF(4),ISPMALL      USE AS MODEL           SS MAR87
         MVC   SPFINPUT(10),0(R1)       *                      SS MAR87
         SPACE 1                                              DRK AUG02
         TM    DSORG,DS1DSGPO      PARTITIONED INPUT?         DRK AUG02
         BO    ISPLLCX             YES, BRANCH                DRK AUG02
         LA    R15,ISPREAL         POINT TO TABLE             DRK AUG02
         CLC   30(10,R15),SPFINPUT BROWSE :                   DRK AUG02
         BNE   *+4+4+6             NO                         DRK AUG02
         LA    R1,ISPLLCRB         YES, DROP COLON            DRK AUG02
         MVC   SPFINPUT(10),0(R1)  BROWSE SEQUENTIAL          DRK AUG02
         CLC   40(10,R15),SPFINPUT EDIT :                     DRK AUG02
         BNE   *+4+4+6             NO                         DRK AUG02
         LA    R1,ISPLLCRE         YES, DROP COLON            DRK AUG02
         MVC   SPFINPUT(10),0(R1)  EDIT SEQUENTIAL            DRK AUG02
         CLC   80(10,R15),SPFINPUT VIEW :                     DRK AUG02
         BNE   *+4+4+6             NO                         DRK AUG02
         LA    R1,ISPLLCRV         YES, DROP COLON            DRK AUG02
         MVC   SPFINPUT(10),0(R1)  VIEW SEQUENTIAL            DRK AUG02
         B     ISPLLCX                                        DRK AUG02
ISPLLCRB DC    CL10'&NBRO'                                    DRK AUG02
ISPLLCRE DC    CL10'&NEDI'                                    DRK AUG02
ISPLLCRV DC    CL10'&NVIE'                                    DRK AUG02
         SPACE 1                                              DRK AUG02
ISPLLCX  DS    0H                       *                      SS MAR87
         MVI   SPFTPOSI,0          COME BACK TO ISPLLY         SS NOV85
         OI    SPFTFLG1,SPFTLPOS                               SS NOV85
* HIERARCHICAL SUPPORT REMOVED          *                      SS OCT88
         BAS   R2,ISPSETST         SET AND RETREIVE STATUS     SS MAR87
         LH    R1,SPFFUNLP+0       GET LOG LAST PANEL          SS MAR87
         LNR   R1,R1               SET FOR SWAP                SS MAR87
         BAS   R2,ISPSTKI          SWAP TO LOG PANEL           SS MAR87
         LA    R15,104             CODE.. PROCESS COMMAND      SS MAR87
         BR    R3                  RETURN TO ROUTER            SS MAR87
         SPACE 3                                               SS SEP84
ISPLLN   DS    0H                  NORMAL CLEANUP              SS NOV85
         BAS   R2,ISPLMSGS         PROCESS MESSAGE             SS NOV85
ISPLLN2  DS    0H                  NORMAL CLEANUP WITHOUT MSG ABL MAY88
         LH    R1,SPFTBPOT                                     SS NOV85
         LA    R1,SPWRKC(R1)                                   SS NOV85
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS SEP84
         BAS   R2,ISPTBPUT         UPDATE TABLE                SS SEP84
         TM    ##ADRPA#,$F         SOFT ATTN SIGNALLED?       ABL APR85
         BNO   ISPLLX              NO, BRANCH                 ABL APR85
         NI    ##ADRPA#,255-$F     YES, TURN OFF FLAG         ABL APR85
         MVC   SPFADATA,ISPATTN    SPECIAL *ATTN* FLAG        ABL APR85
         B     ISPLL2              TERMINATE LINE COMMANDS    ABL APR85
ISPLLX   DS    0H                                              SS SEP84
         L     R14,SPFTTPT         GET MY TABLE ENTRY          SS NOV85
         TM    $TLF1(R14),#V       VIEW MODE TO FOLLOW         SS SEP84
         BZ    ISPLLY              NO                          SS NOV85
         MVI   SPFTPOSI,0          COME BACK TO ISPLLY         SS NOV85
* HIERARCHICAL SUPPORT REMOVED          *                      SS OCT88
         BAS   R2,ISPSETST              SET AND RETRIEVE STAT  SS OCT88
         LA    R15,100                  DISPLAY PANEL          SS OCT88
         LTR   R1,R1                    THIS LOG ALREADY       SS OCT88
         BZR   R3                       YES EXIT               SS OCT88
         LH    R1,SPFFUNLP+0            GET LOG LAST PANEL     SS OCT88
         LNR   R1,R1                    SET FOR SWAP           SS OCT88
         BAS   R2,ISPSTKI               SWAP TO LOG PANEL      SS OCT88
         LA    R15,100                  DISPLAY PANEL          SS OCT88
         BR    R3                       RETURN TO ROUTER       SS OCT88
ISPLLB   DS    0H                                              SS MAR85
         LH    R1,SPFTBPOT       OPT OFFSET                    SS JUL87
         LA    R1,SPWRKC(R1)            *                      SS JUL87
         MVC   0(4,R1),ISPBLK8   CLEAR X41                     SS JUL87
         LH    R1,SPFTBPDA                                     SS NOV85
         LA    R1,SPWRKC(R1)                                   SS NOV85
         CLI   0(R1),C'*'       IS IT A MSG                    SS MAR85
         BNE   ISPLLB2          NO,  CLEAR                     SS MAR85
         CLC   00(8,R1),ISPINVLD  INVALID MSG                  SS MAR85
         BNE   ISPLLM           NO, DON'T CLEAR               ABL JUN85
ISPLLB2  DS    0H                                              SS MAR85
         MVC   00(8,R1),ISPBLK8    BLANK OUT DATA              SS MAR85
         B     ISPLLM                                         ABL JUN85
ISPLLM   DS    0H                                             ABL JUN85
         BAS   R2,ISPTBPUT      UPDATE TABLE                   SS MAR85
         B     ISPLL5                                          SS FEB89
ISPLLY   DS    0H                                              SS NOV85
         BAS   R2,ISPQUERY      GET CUR CRP FOR CURSOR         SS MAR85
         MVC   SPFTCCRP,SPFTCRP SAVE CUR CRP                   SS MAR85
ISPLL5   DS    0H                                              SS FEB89
         NI    SPFTFLG1,255-SPFTLPOS                           SS JUL87
         TM    SPFTFLG2,SPFRETOP        DO WE NEED TBTOP       SS MAR89
         BZ    *+12                     NO                     SS MAR89
         BAS   R2,ISPTOP                START AT TOP           SS MAR89
         NI    SPFTFLG2,255-SPFRETOP    NOW RESET FLAG         SS MAR89
         BAS   R2,ISPNXLN       NEXT LINE COMMAND              SS JUL87
         LTR   R15,R15                  *                      SS JUL87
         BZ    ISPLLL           PROCESS IT                     SS JUL87
*  AT THIS POINT ANY DEFERED LINE COMMAND CAN NOW BE PROCESSED SS JUL87
         BAS   R2,ISPBOTM       RESET TO BOTTOM                SS JUL87
         LA    R15,100          TABLE PANEL DISPLAY SUPPORT    SS NOV85
         BR    R3                  RETURN TO ROUTER            SS NOV85
         SPACE 2                                               SS SEP84
*   GENERAL SAMPLE FOR LINE CMD                                SS NOV85
ISPLLG   DS    0H                                              SS SEP84
*        MVC   SPFTPOSI(1),$TLFU(R14)  POST PROCESSING INDEX   SS JUL85
         MVI   SPFTPOSI,4          GENERAL PURPOSE POST PROC   SS OCT88
         TM    $TLF2(R14),#P       DIFFERENT POST PROC         SS NOV84
         BZ    ISPLLG2              NO SKIP                    SS NOV84
         MVC   SPFTPOSI(1),$TLEX(R14) USE IT                   SS NOV84
ISPLLG2  DS    0H                                              SS SEP84
         OI    SPFLAG0,SPFCKER     ALSO CHECK FOR ERRORS       SS NOV84
         LA    R15,$TLCM(R14)   GET NAME                       SS JUL85
         TM    $TLF2(R14),#R       REAL CMD OFFSET*2           SS NOV84
         BZ    ISPLLG3                                         SS JUL85
         SR    R15,R15                                         SS NOV84
         IC    R15,$TLEX(R14)                                  SS NOV84
         LA    R15,ISPREAL(R15)                                SS NOV84
ISPLLG3  DS    0H                                             ABL OCT84
         MVC   PUTGETBF(4),ISPCMD30                           ABL OCT84
         MVC   SPFINPUT(8),0(R15) COPY CMD NAME                SS SEP84
         MVI   SPFINPUT+8,C' '                                 SS SEP84
         MVC   SPFINPUT+9(8),SPFVVOL                          ABL MAY88
         MVI   SPFINPUT+9+6,C' '                              ABL MAY88
         MVI   SPFINPUT+9+7,C' '                              ABL MAY88
* BUILD REST OF CMD                                           ABL OCT84
         CLI   SPFVDATA,X'00'      NULLS                      ABL MAY88
         BE    ISPLLG5             YES, CONVERT TO BLANKS      SS NOV84
         CLI   SPFVDATA,C'*'       STATUS MESSAGE?            ABL MAY88
         BNE   *+10                NO, BRANCH                 ABL OCT84
ISPLLG5  DS    0H                                              SS NOV84
         MVC   SPFVDATA(8),ISPBLK8 YES, BLANK IT OUT          ABL MAY88
         MVC   SPFINPUT+18(8),SPFVDATA                        ABL MAY88
         MVC   SPFVSAVD,SPFVDATA                              ABL MAY88
         TM    $TLF1(R14),#V       VIEW MODE OUTPUT?           SS DEC84
         BZ    ISPLLG6             NO, BRANCH                  SS DEC84
         OI    SPFLAG3,SPFLOGM     YES, MARK FOR LOGGING       SS DEC84
         OI    SPFTFLG1,SPFTLPOS   POST PROCESSING REQUIRED   ABL MAY88
         OI    SPFTFLG1,SPFTLCD    LINE COMMAND IS ACTIVE     ABL MAY88
         MVC   SPFTCCRP,SPFTCRP    SAVE CURRENT CPR           ABL MAY88
ISPLLG6  DS    0H                                              SS NOV84
         B     ISPLLC                                         ABL OCT84
*                                       *                      SS JUL87
*   SELECT COMMAND                      *                      SS JUL87
*                                       *                      SS JUL87
ISPLLSX  DS    0H                       *                      SS JUL87
         LH    R1,SPFTBPOT              OPT OFFSET             SS JUL87
         LA    R1,SPWRKC(R1)            OPT ADDRESS            SS JUL87
         SR    R15,R15                  ZERO FOR IC            SS JUL87
         IC    R15,$TLEX(R14)           EX CODE                SS JUL87
         LA    R15,SPFSELFU(R15)        ADDR, IX TO SEL TABLE  SS JUL87
         MVC   0(4,R1),0(R15)           COPY LINE COMMAND      SS JUL87
         CLI   0(R1),C' '               BLANK                  SS NOV88
         BE    ISPLLSX2                 *                      SS NOV88
         CLI   0(R1),X'&IBLK'           DASH FOR BLANK         SS NOV88
         BE    ISPLLSX2                 *                      SS NOV88
         B     ISPLL00                  PROCESS FROM TOP       SS JUL87
ISPLLSX2 DS    0H                       *                      SS JUL87
         MVI   0(R1),C'O'               O OPTION               SS NOV88
         B     ISPLL00                  PROCESS FROM TOP       SS JUL87
*                                                              SS NOV85
*  LISTV SPACE AND STATUS LINE CMDS                            SS NOV85
*                                                              SS NOV85
ISPLLSP  DS    0H                                              SS NOV85
         AIF   ('&MVSLEV' GE 'MVS410').MVS41H                 DRK SEP98
         L     R1,SPFVUCBA         UCB ACTUAL ADDRESS          SS NOV85
         AGO   .MVS41HX                                       DRK SEP98
.MVS41H  ANOP                                                 DRK SEP98
         L     R1,SPFSEC4A         GET  BASE                  DRK SEP98
         LA    R1,SPFUCBSN-SPFSEC4K(,R1) POINT TO SPFUCBSN    DRK SEP98
         XC    0(100,R1),0(R1)     ZERO FOR FRESH START       DRK SEP98
*        XC    SRVUCBIC,SRVUCBIC   ZERO UCBSCAN IOC TOKEN     DRK SEP98
         LR    R0,R1               UCBSCAN WORKAREA           DRK SEP98
         L     R15,CVTPTR(,R0)     CVT                        DRK SEP98
         TM    CVTOSLV1-CVT(R15),HBB5510  4-DIGIT UCBS?       DRK SEP98
         BO    ISPLLSP4                                       DRK SEP98
*                                                             DRK SEP98
*  COPY OF UCB FOR VOLUME                                     DRK SEP98
*                                                             DRK SEP98
         UCBSCAN COPY,                                        DRK SEP98X
               WORKAREA=(R0),                                 DRK SEP98X
               UCBAREA=SRVUCBUC,                              DRK SEP98X
               DCEAREA=SRVUCBDC,                              DRK NOV99X
               DCELEN==H'56',                                 DRK DEC00X
               DYNAMIC=YES,                                   DRK SEP98X
               VOLSER=SPFVVOL,                                DRK SEP98X
               MF=(E,SRVUCBPL)                                DRK SEP98
         LTR   R15,R15                                        DRK SEP98
         BNZ   ISPLLS2             UCB FOR VOLUME UNAVAILABLE DRK SEP98
         LA    R1,SRVUCBUC         UCB ADDRESS                DRK SEP98
         ST    R1,SPFVUCBA         UCB COPY ADDRESS           DRK SEP98
         B     ISPLLSPD            PROCESS UCB                DRK SEP98
ISPLLSP4 DS    0H                                             DRK SEP98
         UCBSCAN COPY,                                        DRK SEP98X
               WORKAREA=(R0),                                 DRK SEP98X
               UCBAREA=SRVUCBUC,                              DRK SEP98X
               DCEAREA=SRVUCBDC,                              DRK NOV99X
               DCELEN==H'56',                                 DRK DEC00X
               RANGE=ALL,                                     DRK SEP98X
               DYNAMIC=YES,                                   DRK SEP98X
               VOLSER=SPFVVOL,                                DRK SEP98X
               MF=(E,SRVUCBPL)                                DRK SEP98
         LTR   R15,R15                                        DRK SEP98
         BNZ   ISPLLS2             UCB FOR VOLUME UNAVAILABLE DRK SEP98
         LA    R1,SRVUCBUC         UCB ADDRESS                DRK SEP98
         ST    R1,SPFVUCBA         UCB COPY ADDRESS           DRK SEP98
         B     ISPLLSPD                                       DRK SEP98
         LTORG ,                                              DRK SEP98
ISPLLSPD DS    0H                                             DRK SEP98
.MVS41HX ANOP                                                 DRK SEP98
         USING UCBOB,R1                                        SS NOV85
         TM    UCBSTAT,UCBONLI     IS IT ONLINE                SS NOV85
         BZ    ISPLLS2             NO, SKIP IT                 SS NOV85
         CLI   UCBVOLI,C' '        ANY VOLUME                  SS NOV85
         BNH   ISPLLS2             NO VOLUME, SKIP IT          SS NOV85
         TM    UCBSTAT,UCBCHGS+UCBUNLD GOING OFFLINE           SS NOV85
         BNZ   ISPLLS2             YES, SKIP IT                SS NOV85
         DROP  R1                                              SS NOV85
         OI    SPFTFLG2,SPFRETOP   DO CMD SCAN FROM TOP        SS MAR89
         BAS   R2,ISPVSTAI         UPDATE STATS                SS NOV85
         L     R14,SPFTTPT              RELOAD POINTER         SS NOV85
         CLI   $TLFU(R14),36            STAT                   SS NOV85
         BE    ISPLLN              YES SKIP SPACE              SS NOV85
         BAS   R2,ISPVSPAI         UPDATE SPACE                SS NOV85
         LTR   R15,R15             ALL OK                      SS APR87
         BZ    ISPLLN              YES, NORMAL CLEANUP         SS APR87
         CLC   SPFVDATA(2),ISPLLSPR VTOC RESERVED CODE?        SS NOV88
         BE    ISPLLN2             YES, BRANCH                ABL MAY88
         CLC   SPFVDATA(2),ISPLLSPV VTOC ENQUEUED CODE?        SS NOV88
         BE    ISPLLN2             YES, BRANCH                ABL MAY88
         MVC   SPFVDATA,ISPLSPCE   VTOC ERROR CODE             SS APR87
         B     ISPLL2              ERROR  CLEANUP              SS APR87
ISPLLSPR DC    C'*R'                    *                      SS NOV88
ISPLLSPV DC    C'*V'                    *                      SS NOV88
         SPACE 2                                               SS NOV85
ISPLLS2  DS    0H                                              SS NOV85
         MVC   SPFVDATA,ISPLLS3                                SS NOV85
         B     ISPLL2                                          SS NOV85
ISPLLS3 DC     CL8'*UNAVAL*'                                   SS NOV85
         SPACE 2                                               SS NOV85
*                                                              SS NOV85
*  LISTA FREE LINE CMD                                         SS NOV85
*                                                              SS NOV85
ISPLLFR  DS    0H                                              SS NOV85
*        CLC   SPFADDNM,ISPBLK8                                SS NOV85
*        BNH   ISPLLFE                  NO DD                  SS NOV85
         CLI   SPFADDNM,C' '            CONCAT DD              SS MAY88
         BE    ISPLLFE                  YES, SKIP              SS MAY88
         LA    R14,SPFADDNM             VERIFY DD STILL ALLOC  SS NOV85
         BAS   R2,ISPFDSAB                                     SS NOV85
         LTR   R1,R1                                           SS NOV85
         BZ    ISPLLF8                  GONE                   SS NOV85
         LH    R2,DSABOPCT-DSAB(R1)     GET OPEN COUNT         SS NOV85
         LTR   R2,R2                                           SS NOV85
         BNZ   ISPLLF9                  STILL OPEN             SS NOV85
         TM    DSABFLG1-DSAB(R1),DSABNUSE                      SS NOV85
         BO    ISPLLFA                  IN USE                 SS NOV85
         L     R14,SPFTTPT              RELOAD POINTER         SS NOV85
         CLI   $TLFU(R14),24            DECONCAT               SS NOV85
         BNE   ISPLLFD                  NO SKIP                SS NOV85
         TM    DSABFLG1-DSAB(R1),DSABCATM IS IT CONCAT?        SS NOV85
         BZ    ISPLLFB                    NO, BRANCH           SS NOV85
         TM    DSABFLG1-DSAB(R1),DSABPCAT IS IT PERM CAT?      SS NOV85
         BO    ISPLLFC                    YES, BRANCH          SS NOV85
         LA     R0,S99VRBDC                                    SS NOV85
         B      ISPLLFF                                        SS NOV85
ISPLLFD  DS    0H                                              SS NOV85
         LA    R0,S99VRBUN              SET UNALLOC            SS NOV85
ISPLLFF  DS    0H
         LA    R1,SPFADDNM              DDNAME                 SS NOV85
         BAS   R2,ISPUNALC                                     SS NOV85
         LTR   R15,R15                                         SS NOV85
         BZ    ISPLLN                   NORMAL                 SS NOV85
         MVC   SPFADATA,ISPERMSG                               SS NOV85
         B     ISPLL2                   TERMINATE  LINE CMD    SS NOV85
ISPLLF8  DS    0H                                              SS NOV85
         MVC   SPFADATA,ISPLLFM                                SS NOV85
         B     ISPLL2                                          SS NOV85
ISPLLF9  DS    0H                                              SS NOV85
         MVC   SPFADATA,ISPLLFM+8                              SS NOV85
         B     ISPLL2                                          SS NOV85
ISPLLFA  DS    0H                                              SS NOV85
         MVC   SPFADATA,ISPLLFM+16                             SS NOV85
         B     ISPLL2                                          SS NOV85
ISPLLFB  DS    0H                                              SS NOV85
         MVC   SPFADATA,ISPLLFM+24                             SS NOV85
         B     ISPLL2                                          SS NOV85
ISPLLFC  DS    0H                                              SS NOV85
         MVC   SPFADATA,ISPLLFM+32                             SS NOV85
         B     ISPLL2                                          SS NOV85
ISPLLFE  DS    0H                                              SS NOV85
         MVC   SPFADATA,ISPLLFM+40                             SS NOV85
         B     ISPLL2                                          SS NOV85
ISPLLFG  DS    0H                                             ABL JAN87
         MVC   SPFADATA,ISPLLFM+48                            ABL JAN87
         B     ISPLL2                                         ABL JAN87
ISPLLFM DC     CL8'*DD GONE'        0                          SS NOV85
         DC    CL8'*OPEN DD'        8                          SS NOV85
         DC    CL8'*IN USE*'       16                          SS NOV85
         DC    CL8'*NOT CON'       24                          SS NOV85
         DC    CL8'*PERMCON'       32                          SS NOV85
         DC    CL8'*NO DDN*'       40                          SS NOV85
         DC    CL8'*BAD DSN'       48                         ABL JAN87
         SPACE 3                                               SS NOV85
*   INTERFACE TO LISTF VTOC                                    SS NOV85
ISPLLGG  DS    0H                                              SS SEP84
         CLI   SPFFUNST+5,C'P'     LISTF PENDING               SS FEB89
         BE    ISPLLBSY            YES, BUSY                   SS FEB89
*                                                             DRK MAR17
* PROBLEM:  SPFVUCBA IS NOT THE CORRECT UCB FOR LISTF VOLUME. DRK MAR17
* SOLUTION: @DIALSTC CALLS ISPDEVTY TO GET DEVICE TYPE.       DRK MAR17
*                                                             DRK MAR17
*        L     R1,SPFVUCBA                                     SS AUG89
*        USING UCBOB,R1                                        SS AUG89
*        MVC   SPFCLVOL,SPFVVOL         SET NEW VOL            SS AUG89
*        MVC   SPFCLDEV,UCBTYP          AND DEVTYP             SS AUG89
*        NI    SPFCLDEV+1,255-UCBRR     OFF SHARE BIT          SS AUG89
*        DROP  R1                                             DRK NOV98
         MVC   SPFCPVOL,SPFVVOL    PASS VOLUME FOR PROMPT      SS OCT88
         MVI   SPFINPUT,C' '            *                      SS OCT88
         MVC   SPFINPUT+1(249),SPFINPUT                        SS OCT88
         MVC   PUTGETBF(4),ISPCMD30                            SS OCT88
         IC    R15,$TLEX(R14)                                  SS OCT88
         LA    R15,ISPREAL(R15)                                SS OCT88
         MVC   SPFINPUT(10),0(R15) COPY CMD NAME               SS OCT88
         MVI   SPFTPOSI,4          GENERAL POST PROCESSING     SS OCT88
         OI    SPFTFLG1,SPFTLPOS   POST PROCESSING REQUIRED    SS OCT88
         OI    SPFTFLG1,SPFTLCD    LINE COMMAND IS ACTIVE      SS OCT88
         MVC   SPFTCCRP,SPFTCRP    SAVE CURRENT CPR            SS OCT88
         LA    R15,104             NORMAL COMMAND PROCESSING   SS OCT88
         BR    R3                  TO ROUTER                   SS OCT88
         SPACE 3                                               SS NOV85
* GENERAL SAMPLE OF POST PROCESSING                            SS NOV85
ISPLLGP  DS    0H                                              SS SEP84
         TM    $TLF1(R14),#V       VIEW MODE EXPECTED?        ABL DEC84
         BO    ISPLLN              YES, IGNORE ERROR MSG FLG  ABL DEC84
         TM    SPFLAG0,SPFMSGER    ANY ERRORS?                 SS SEP84
         BO    ISPLLER             YES, TERMINATE LIST CMDS.   SS SEP84
* INSERT ANY POST PROCESSING HERE                              SS NOV85
         B     ISPLLN              NORMAL CLEAN UP             SS NOV85
*                                                              SS NOV84
*  LINE CMD SELECT PANEL DISPLAY SUPPORT (O LINE COMMAND)      SS NOV84
*                                                              SS NOV84
ISPLLP   DS    0H                                              SS NOV84
         LH    R1,SPFTBPDA                                     SS NOV85
         LA    R1,SPWRKC(R1)                                   SS NOV85
         OI    SPFLAG0,SPFCKER     ALSO CHECK FOR ERRORS       SS NOV84
         CLI   0(R1),X'00'         NULLS                       SS NOV84
         BE    ISPLLP3             YES, CONVERT TO BLANKS      SS NOV84
         CLI   0(R1),C'*'  '       STATUS MESSAGE?             SS NOV84
         BNE   *+10                NO, BRANCH                  SS NOV84
ISPLLP3  DS    0H                                              SS NOV84
         MVC   0(8,R1),ISPBLK8     YES, BLANK IT OUT           SS NOV84
         MVC   SPFASAVD,0(R1)      SAVE FOR PANEL              SS NOV84
         MVI   SPFVZCMD,C' '             BLANK FIRST           SS NOV84
         MVC   SPFVZCMD+1(249),SPFVZCMD                        SS NOV84
         L     R14,SPFTTPT         RESTORE R14                 SS NOV85
         LH    R1,SPFTBPOT         OPT                         SS AUG86
         LA    R1,SPWRKC(R1)                                   SS AUG86
         TM    $TLF1(R14),#E       IS THIS FOR CMD SEARCH      SS AUG86
         BZ    ISPLLP6             NO, CONTINUE                SS AUG86
         MVC   SPFVZCMD(4),0(R1)   GET CMD NAME                SS AUG86
         MVC   SPFBLKCM(4),0(R1)   SAVE COMMAND                SS DEC87
         OI    SPFLAG4,SPFNOIV     DO NOT DISPLAY INVALID      SS AUG86
         B     ISPLLP2             FORCE NONDISPL              SS AUG86
ISPLLP6  DS    0H                       *                      SS AUG86
         TM    $TLF2(R14),#Z       NONDISPL                    SS NOV84
         BO    ISPLLP2             YES                         SS NOV84
         MVC   SPFVZCMD(4),0(R1)   ANY .MORE                   SS NOV84
         BAS   R2,ISPSHCMD         SET IT UP                   SS NOV84
         CLI   SPFVZCMD,C' '       ANY .MORE                   SS NOV84
         BE    ISPLLP4             NO                          SS NOV84
ISPLLP2  DS    0H                                              SS NOV84
         OI    SPFLAG4,SPFNOND     INVOKE PANEL NON-DISPLAY    SS NOV84
ISPLLP4  DS    0H                                              SS NOV84
         BAS   R2,ISPSETVI                                     SS NOV85
         L     R1,SPFPANT                                      SS NOV84
         ST    R1,SPFPANC          SET CURRENT TO NEW          SS NOV84
         L     R14,SPFTTPT         RESTORE R14                 SS NOV85
         SR    R15,R15                                         SS NOV84
         IC    R15,$TLEX(R14)      GET                         SS NOV84
         SLL   R15,3                 TIME 8 : INDEX TO OFFSET  SS OCT88
         AL    R15,ISP$PNA             PANEL                   SS MAR85
         MVC   SPFPSTK(8),0(R15)            NAME               SS NOV84
ISPLLP5  DS    0H                                              SS NOV84
         BAS   R2,ISPPANDI                                     SS NOV85
         NI    SPFLAG4,255-SPFNOIV RESET, IF USED              SS AUG86
         CLC   SPFZSEL(4),ISPCEND     END KEY?                 SS NOV84
         BNE   ISPLLP7                NO, CONTINUE             SS JUL87
         LH    R1,SPFTBPOT            OPT OFFSET               SS JUL87
         LA    R1,SPWRKC(R1)          ADDRESS                  SS JUL87
         MVC   0(4,R1),ISPBLK8        CLEAR                    SS JUL87
         BAS   R2,ISPTBPUT              *                      SS JUL87
         B     ISPLLY                 YES, DONE                SS JUL87
ISPLLP7  DS    0H                       *                      SS JUL87
         CLI   SPFZSEL,C'?'           INVALID                  SS AUG86
         BE    ISPLL3                 YES                      SS AUG86
         CLC   SPFZSEL(3),ISPPGM      SELECT PGM               SS AUG86
         BE    ISPLLSL                LINE SELECT SUPPORT      SS AUG86
         CLC   SPFZSEL(3),ISPCCMD     SELECT CMD               SS AUG86
         BE    ISPLLSL                LINE SELECT SUPPORT      SS AUG86
         CLC   SPFZSEL(3),ISPTRAP     TRAP CMD                 SS NOV88
         BE    ISPLLTP                SYSOUT TRAP CMD          SS NOV88
         MVC   SPFINPUT(250),SPFZSEL                           SS NOV84
         MVC   PUTGETBF(4),ISPLEN2                             SS NOV84
         L     R14,SPFTTPT          RESTORE R14                SS NOV85
         MVI   SPFTPOSI,16          USE GENERAL PURPOSE POST   SS NOV84
         OI    SPFTFLG1,SPFTLPOS                               SS NOV85
         TM    $TLF2(R14),#A        RESCAN.. MULTY FUNC PANEL? SS NOV84
         BZ    ISPLLC               NO, NO CHANGE              SS NOV84
*  RESCAN LINE CMD FROM PANEL                                  SS NOV84
         LA    R1,SPFINPUT                                     SS NOV85
         L     R14,SPFTBPLC  TABLE FOR SEARCH                  SS NOV85
         BAS   R2,ISPVERG           CHECK CMD VERB             SS NOV85
         MVC   SPFTTPT,SPFVTPT      COPY POINTER               SS NOV85
         C     R15,ISPL8            VALID VERB?                SS NOV84
         BH    ISPLL3               NO, ERROR                  SS NOV84
         TM    $TLF1(R14),#V        VIEW MODE OUTPUT?         ABL DEC84
         BZ    *+8                  NO, BRANCH                ABL DEC84
         OI    SPFLAG3,SPFLOGM      YES, MARK FOR LOGGING     ABL DEC84
         TM    $TLF2(R14),#T        ALLOWED FROM O LINE CMD?  ABL DEC84
         BO    ISPLL0               YES, PROCESS INTERNALLY   ABL DEC84
         TM    $TLF2(R14),#P        DIFFERENT POST PROCESSOR?  SS NOV84
         BZ    ISPLLC               NO, BRANCH                 SS NOV84
         MVC   SPFTPOSI(1),$TLEX(R14) USE IT                   SS NOV84
         B     ISPLLC                                          SS NOV84
*                                       *                      SS NOV88
*  TCT LINE COMMAND SUPPORT             *                      SS NOV88
*                                       *                      SS NOV88
* TCT VIEW AND UPDATE                   *                      SS NOV88
ISPLLTUP DS    0H                       *                      SS NOV88
         CLI   $TLCM(R14),C'V'          VIEW                   SS JAN89
         BE    ISPLLTUV                 YES, SETUP             SS NOV88
         CLI   $TLCM(R14),C'U'          UPDATE                 SS JAN89
         BNE   ISPLL3                   INVALID                SS NOV88
         MVC   SPFTOPT,ISPLLTUE         YES, SET EXEC          SS NOV88
         B     ISPLLTUD                 DISPLAY PANEL          SS NOV88
ISPLLTUV DS    0H                       *                      SS NOV88
         MVC   SPFTOPT,ISPLLTUN         SET NOEX               SS NOV88
ISPLLTUD DS    0H                       *                      SS NOV88
         MVI   SPFVZCMD,C' '            BLANKS                 SS NOV88
         MVC   SPFVZCMD+1(249),SPFVZCMD MORE BLANKS            SS NOV88
         LA    R1,ISPBLK8               NO MESSAGE             SS MAR89
         LA    R15,ISPLLTUX             PANEL                  SS NOV88
         BAS   R2,ISPSINGI              DISPLAY SUBR           SS NOV88
         LTR   R15,R15                  END KEY                SS NOV88
         BZ    ISPLLTUG                 NO, GOOD, CONTINUE     SS NOV88
         BAS   R2,ISPGET                REFRESH                SS NOV88
         B     ISPLLB                   BLANK OPT+MSG          SS NOV88
ISPLLTUG DS    0H                       *                      SS NOV88
         BAS   R2,ISPTBPUT              SAVE CHANGES           SS NOV88
         B     ISPLL00                  PROCESS INTERNALLY     SS NOV88
ISPLLTUX DC    CL8'&P.LTUP'             VIEW/UPDATE PANEL      SS NOV88
ISPLLTUE DC    CL4'&IEXC'               *                      SS NOV88
ISPLLTUN DC    CL4'&INEX'               *                      SS NOV88
         SPACE 2                        *                      SS NOV88
* TCT INSERT BLANK LINE                 *                      SS NOV88
ISPLLTAD DS    0H                       *                      SS NOV88
         MVC   SPFTOPT,ISPBLK8          CLEAR OPT              SS NOV88
         BAS   R2,ISPTBPUT              UPDATE THIS LINE       SS NOV88
         MVC   SPFTDATA,ISPBLK8         CLEAR FOR INSERT       SS NOV88
         MVI   SPFTTYPE,C' '               TYPE ALSO           SS NOV88
         LA    R1,SPFTCMDD-SPFSEC4K                            SS NOV88
         AL    R1,SPFSEC4A                                     SS NOV88
         MVI   0(R1),C' '               BLANK                  SS NOV88
         MVC   1(245,R1),0(R1)           RIPPLE                SS NOV88
         BAS   R2,ISPTBADD              INSERT LINE            SS NOV88
         B     ISPLLY                   CLEANUP                SS NOV88
*                                       *                      SS NOV88
*  TCT EXECUTE CMD                      *                      SS NOV88
*                                       *                      SS NOV88
ISPLLTT  DS    0H                       *                      SS NOV88
         CLI   SPFTTYPE,C'*'            COMMENT                SS NOV88
         BE    ISPLLB                   BLANK OUT              SS NOV88
         CLI   SPFTTYPE,C'P'            PDS COMMAND            SS NOV88
         BE    ISPLLTTP                 PROCESS                SS NOV88
         CLI   SPFTTYPE,C' '            BLANK                  SS NOV88
         BE    ISPLLTTT                 TSO COMMAND            SS NOV88
         CLI   SPFTTYPE,C'-'            DASH                   SS NOV88
         BE    ISPLLTTT                 TSO COMMAND            SS NOV88
         CLI   SPFTTYPE,C'T'            T FOR TRAP             SS NOV88
         BE    ISPLLTTT                 TSO COMMAND            SS NOV88
         B     ISPLL3                   INVALID TYPE           SS NOV88
ISPLLTTP DS    0H                       *                      SS NOV88
         MVC   SPFTOPT,ISPBLK8          CLEAR OPT              SS NOV88
         BAS   R2,ISPTBPUT                AND REPLACE          SS NOV88
         L     R1,SPFSEC4A              GET SECOND BASE        SS NOV88
         MVC   SPFINPUT(245),SPFTCMDD-SPFSEC4K(R1)  DATA       SS NOV88
         MVC   SPFINPUT+245(5),ISPBLK8  BLANK REST             SS NOV88
         MVC   PUTGETBF(4),ISPLEN2                             SS NOV88
         MVI   SPFTPOSI,4          COME BACK TO ISPLLGP        SS NOV88
         OI    SPFTFLG1,SPFTLPOS                               SS NOV88
         BAS   R2,ISPSETST         SET AND RETREIVE STATUS     SS NOV88
         LH    R1,SPFFUNLP+0       GET LOG LAST PANEL          SS NOV88
         LNR   R1,R1               SET FOR SWAP                SS NOV88
         BAS   R2,ISPSTKI          SWAP TO LOG PANEL           SS NOV88
         LA    R15,104             CODE.. PROCESS COMMAND      SS NOV88
         BR    R3                  RETURN TO ROUTER            SS NOV88
         SPACE 3                                               SS NOV88
ISPLLTTT DS    0H                       *                      SS NOV88
         L     R1,SPFSEC4A              GET SECOND BASE        SS NOV88
         MVC   SPFZSEL+4(245),SPFTCMDD-SPFSEC4K(R1)            SS NOV88
         MVI   SPFZSEL+249,C')'         CLOSE                  SS NOV88
         MVI   SPFZSEL+3,C'('           OPEN                   SS NOV88
         MVC   SPFZSEL(3),ISPCCMD       ASSUME COMMAND         SS NOV88
         CLI   SPFTTYPE,C'T'            TRAP                   SS NOV88
         BNE   ISPLLTT2                 NO                     SS NOV88
         CLC   SPFZENVI(8),ISPLLEV   CHECK FOR 2.3             SS NOV88
         BL    ISPLLTT2                 NO ENV                 SS NOV88
         CLI   SPFTPSET,C'Y'            IS TRAP SET            SS NOV88
         BE    ISPLLTT5                 YES, OK                SS NOV88
         LA    R1,ISPBLK8               NO, MESSAGE            SS NOV88
         LA    R15,ISPLLTT3             SETTRAP PANEL          SS NOV88
         BAS   R2,ISPSINGI              REQUEST SETTRAP        SS NOV88
         CLI   SPFTPSET,C'Y'            CHANGED TO YES         SS NOV88
         BE    ISPLLTT5                 YES, OK                SS NOV88
         B     ISPLLTT2                 NO, CONVERT TO CMD     SS NOV88
ISPLLTT3 DC    CL8'&P.SETT'             *                      SS NOV88
ISPLLTT5 DS    0H                       *                      SS NOV88
         MVC   SPFZSEL(3),ISPTRAP       MAKE IT TRAP           SS NOV88
         BAS   R2,ISPTRAPI              CALL TRAP PROCESSOR    SS NOV88
         CLI   SPFTCNT,C'0'             ANY OUTPUT             SS NOV88
         BE    ISPLLTTR                 PROCESS RETURN CODE    SS NOV88
         LTR   R15,R15                  ZERO RC                SS NOV88
         BZ    ISPLLTTZ                 YES                    SS NOV88
         MVC   SPFTDATA,SPFMLIN1        COPY RETURN            SS NOV88
         BAS   R2,ISPTBPUT              AND UPDATE             SS NOV88
         MVI   SPFTPOSI,12         COME BACK TO ISPLL2         SS NOV88
         B     ISPLLTTL                 GOTO LOG               SS NOV88
ISPLLTTZ DS    0H                       PROCESS RETURN CODE    SS NOV88
         MVC   SPFTOPT,ISPBLK8          CLEAR OPT              SS NOV88
         BAS   R2,ISPLMSGS              SET MESSAGE            SS NOV88
         BAS   R2,ISPTBPUT              AND UPDATE             SS NOV88
         MVI   SPFTPOSI,0          COME BACK TO ISPLLY         SS NOV88
ISPLLTTL DS    0H                       PROCESS RETURN CODE    SS NOV88
         OI    SPFTFLG1,SPFTLPOS                               SS NOV88
         BAS   R2,ISPSETST         SET AND RETREIVE STATUS     SS NOV88
         LH    R1,SPFFUNLP+0       GET LOG LAST PANEL          SS NOV88
         LNR   R1,R1               SET FOR SWAP                SS NOV88
         BAS   R2,ISPSTKI          SWAP TO LOG PANEL           SS NOV88
         LA    R15,100             CODE.. PROCESS COMMAND      SS NOV88
         BR    R3                  RETURN TO ROUTER            SS NOV88
ISPLLTT2 DS    0H                       *                      SS NOV88
         BAS   R2,ISPSLCTI              SELECT PROCESSOR       SS NOV88
ISPLLTTR DS    0H                       PROCESS RETURN CODE    SS NOV88
         LTR   R15,R15                  ZERO RC                SS NOV88
         BZ    ISPLLTT0                 YES                    SS NOV88
         MVC   SPFTDATA,SPFMLIN1        COPY RETURN            SS NOV88
         B     ISPLL2                   PROCESS AS ERROR       SS NOV88
ISPLLTT0 DS    0H                       PROCESS RETURN CODE    SS NOV88
         MVC   SPFTOPT,ISPBLK8          CLEAR OPT              SS NOV88
         BAS   R2,ISPLMSGS              SET MESSAGE            SS NOV88
         BAS   R2,ISPTBPUT              AND UPDATE             SS NOV88
         OI    SPFTFLG1,SPFTYOFF        *                      SS NOV88
         MVC   SPFCURSR,ISPLLTTY        TYPE FIELD             SS NOV88
         MVC   SPFCUOFF,ISPL1           OFFSET ONE             SS NOV88
         B     ISPLLY                   CONTINUE NORMALLY      SS NOV88
ISPLLTTY DC    CL8'PDSTTYPE'            TYPE FIELD             SS NOV88
*                                       *                      SS NOV88
*  GENERAL PURPOSE SYSOUT TRAP CMD                             SS NOV88
*                                       *                      SS NOV88
ISPLLTP  DS    0H                       *                      SS NOV88
         CLC   SPFZENVI(8),ISPLLEV   CHECK FOR 2.3             SS NOV88
         BL    ISPLLTPE                 NO ENV                 SS NOV88
         CLI   SPFTPSET,C'Y'            IS TRAP SET            SS NOV88
         BNE   ISPLLTPE                 NO, NO                 SS NOV88
         BAS   R2,ISPTRAPI              CALL TRAP PROCESSOR    SS NOV88
         CLI   SPFTCNT,C'0'             ANY OUTPUT             SS NOV88
         BE    ISPLLSLR                 PROCESS RETURN CODE    SS NOV88
         LH    R1,SPFTBPDA              DATA OFFSET            SS NOV88
         LA    R1,SPWRKC(R1)            ADDRESS                SS NOV88
         LTR   R15,R15                  ZERO RC                SS NOV88
         B     ISPLLTPZ                 PROCESS RETURN CODE    SS NOV88
         LTR   R15,R15                  ZERO RC                SS NOV88
         BZ    ISPLLS5                  YES                    SS NOV88
         MVC   0(8,R1),SPFMLIN1         GET FORMATTED MSG      SS NOV88
         BAS   R2,ISPTBPUT              AND UPDATE             SS NOV88
         MVI   SPFTPOSI,12         COME BACK TO ISPLL2         SS NOV88
         B     ISPLLTPL                 GOTO LOG               SS NOV88
ISPLLTPZ DS    0H                       PROCESS RETURN CODE    SS NOV88
         MVC   0(8,R1),ISPBLK8          FIRST BLANK            SS NOV88
         MVI   0(R1),C'*'               MSG TAG                SS NOV88
         MVC   1(4,R1),SPFBLKCM         COPY NAME              SS NOV88
         MVC   5(3,R1),ISPBLK8          BLANK REST             SS NOV88
         LH    R1,SPFTBPOT         OPT                         SS NOV88
         LA    R1,SPWRKC(R1)                                   SS NOV88
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS NOV88
         BAS   R2,ISPTBPUT              AND UPDATE             SS NOV88
         MVI   SPFTPOSI,0          COME BACK TO ISPLLY         SS NOV88
ISPLLTPL DS    0H                       PROCESS RETURN CODE    SS NOV88
         OI    SPFTFLG1,SPFTLPOS                               SS NOV88
         BAS   R2,ISPSETST         SET AND RETREIVE STATUS     SS NOV88
         LH    R1,SPFFUNLP+0       GET LOG LAST PANEL          SS NOV88
         LNR   R1,R1               SET FOR SWAP                SS NOV88
         BAS   R2,ISPSTKI          SWAP TO LOG PANEL           SS NOV88
         LA    R15,100             CODE.. PROCESS COMMAND      SS NOV88
         BR    R3                  RETURN TO ROUTER            SS NOV88
ISPLLTPE DS    0H                       *                      SS NOV88
         MVC   SPFZSEL(3),ISPCCMD    CHANGE TO A COMMAND       SS NOV88
         B     ISPLLSL                  *                      SS NOV88
ISPLLEV DC     C'ISPF 2.3'           VERSION REQUIRES TSO/E    SS NOV88
*                                       *                      SS NOV88
*  SELECT CMD/PGM                       *                      SS NOV88
*                                       *                      SS NOV88
ISPLLSL  DS    0H                       *                      SS AUG86
         BAS   R2,ISPSLCTI              SELECT PROCESSOR       SS AUG86
ISPLLSLR DS    0H                       *                      SS AUG86
         LH    R1,SPFTBPDA              DATA OFFSET            SS JUL87
         LA    R1,SPWRKC(R1)            ADDRESS                SS JUL87
         LTR   R15,R15                  ZERO RC                SS AUG86
         BZ    ISPLLS5                  YES                    SS AUG86
         MVC   0(8,R1),SPFMLIN1         GET FORMATTED MSG      SS JUL87
*        LH    R1,SPFTBPOT         OPT                         SS NOV88
*        LA    R1,SPWRKC(R1)                                   SS NOV88
*        MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS NOV88
         BAS   R2,ISPTBPUT         UPDATE TABLE                SS NOV88
         B     ISPLL2              PROCESS AS ERROR            SS NOV88
ISPLLS5  DS    0H                       *                      SS AUG86
         MVC   0(8,R1),ISPBLK8          FIRST BLANK            SS JUL87
         MVI   0(R1),C'*'               MSG TAG                SS JUL87
         MVC   1(4,R1),SPFBLKCM         COPY NAME              SS DEC87
         MVC   5(3,R1),ISPBLK8          BLANK REST             SS DEC87
         LH    R1,SPFTBPOT         OPT                         SS AUG86
         LA    R1,SPWRKC(R1)                                   SS AUG86
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS AUG86
         BAS   R2,ISPTBPUT         UPDATE TABLE               ABL DEC87
         B     ISPLLY              REENTER TABLE   DISPLAY     SS AUG86
         SPACE 3                                               SS NOV84
*                                                              SS MAR85
*   FORMAT UT1 LINE COMMAND                                    SS MAR85
*                                                              SS MAR85
ISPLLU   DS    0H                                              SS MAR85
         B     ISPLL3                   *                      SS JUL87
         SPACE 2                                               SS NOV86
*                                       *                      SS NOV86
*   COPY  TABLE LINE TO LOG             *                      SS NOV86
*                                       *                      SS NOV86
ISPLLLG  DS    0H                       *                      SS NOV86
         BAS   R2,ISPLOGBT              SET LOG TO BOTTOM      SS NOV86
         BAS   R2,ISPMVTBL              GET FORMAT INFO        SS NOV86
         SR    R14,R14                  ZERO FOR IC            SS NOV86
         IC    R14,9(R1)                GET FORMAT LENGTH      SS NOV86
         BCTR  R14,0                    ONE LESS FOR MVC       SS NOV86
         STH   R14,SPFTSVH              SAVE FOR LATER         SS NOV86
         LA    R15,4(,R15)              ALTERNATE ROUT ENTRY   SS NOV86
ISPLLLL  DS    0H                       *                      SS NOV86
         LA    R1,WORKTBL               TEMP WORK AREA         SS NOV86
         MVI   0(R1),C' '               BLANK                  SS NOV86
         MVC   1(79,1),0(R1)               RIPPLE              SS NOV86
         BASR  R2,R15                   FORMAT ROUTINE         SS NOV86
         ST    R15,SPFTSV1              SAVE NEXT STEP ROUTINE SS NOV86
         LH    R14,SPFTSVH              GET LENGTH             SS NOV86
*              R1 STILL POINTING TO FORMATTED DATA             SS NOV86
         BAS   R2,ISPADD79              ADD TO LOG             SS NOV86
         ICM   R15,15,SPFTSV1           GET ROUTINE ADDRESS    SS NOV86
         BNZ   ISPLLLL                  CONTINUE FORMAT        SS NOV86
         B     ISPLLN                   DONE, CLEANUP          SS NOV86
         SPACE 3                                               SS NOV84
*                                                             ABL JAN87
*   FORMAT CHANGE LINE COMMAND                                ABL JAN87
*                                                             ABL JAN87
ISPLLCHG DS    0H                                             ABL JAN87
         CLI   SPFTBPFI+1,2             IS IT LISTA            SS OCT88
         BE    ISPLLCH4                 YES                    SS OCT88
         CLC   SPFCVOL,ISPLLCHM         MIGRATED DSN           SS FEB89
         BE    ISPLLCHC                 YES, BYPASS OBTAIN     SS FEB89
         LA    R14,SPFCDSN              GET DSNAME             SS FEB89
         LA    R1,SPFCVOL               AND VOL                SS FEB89
         BAS   R2,ISPDSCB               READ DSCB              SS FEB89
         LTR   R15,R15                  GOOD READ              SS FEB89
         BNZ   ISPLLCHD                 NO, CHECK MORE         SS FEB89
         MVI   SPFCVTOC,C'Y'            SET ON VTOC           DRK MAY08
         LA    R1,SPFDSCB+DS1DSORG-DS1FMTID  DSORG             SS FEB89
         BAS   R2,ISPDSORG              CONVERT DSORG          SS FEB89
         STCM  R0,B'1100',SPFCDSOR      SAVE                   SS FEB89
         CLI   SPFCDSOR,C'D'            IS DA?                DRK JUL03
         BE    ISPLLCHC                 YES, OK               DRK JUL03
         CLI   SPFCDSOR,C'P'            IS PO OR PS            SS FEB89
         BNE   ISPLLCHI                 NO, GIVE MSG           SS FEB89
ISPLLCHC DS    0H                       *                      SS OCT88
         BAS   R2,ISPUSTKM              TERMINATE ANY MEMLIST  SS OCT88
         LH    R1,SPFFUNLP+10           GET LISTC PANEL INDEX  SS OCT88
         B     ISPLLCH3                 *                      SS OCT88
ISPLLCH4 DS    0H                       *                      SS OCT88
         CLC   SPFADSN(8),ISPLLCHN         DUMMY?              SS NOV88
         BE    ISPLLFG                     YES, DO NOT ALLOW  ABL JAN87
         CLI   SPFADSN,C' '                ANY DSNAME?        ABL JAN87
         BE    ISPLLFG                     NO, BRANCH         ABL JAN87
         CLI   SPFAVOL,C' '             ANY VOL                SS FEB89
         BE    ISPLLFG                     NO, BRANCH          SS FEB89
         CLI   SPFATYPE,C'C'            CATALOG TYPE           SS FEB89
         BE    ISPLLCHI                 INVALID TYPE           SS FEB89
         LA    R14,SPFADSN              GET DSNAME             SS FEB89
         LA    R1,SPFAVOL               AND VOL                SS FEB89
         BAS   R2,ISPDSCB               READ DSCB              SS FEB89
         LTR   R15,R15                  GOOD READ              SS FEB89
         BNZ   ISPLLCHD                 NO, CHECK MORE         SS FEB89
         LA    R1,SPFDSCB+DS1DSORG-DS1FMTID  DSORG             SS FEB89
         BAS   R2,ISPDSORG              CONVERT DSORG          SS FEB89
         ST    R0,SPFATYPE              SAVE                   SS FEB89
         CLI   SPFATYPE,C'D'            IS DA?                DRK AUG03
         BE    ISPLLCHB                 YES, OK               DRK JUL03
         CLI   SPFATYPE,C'P'            IS PO OR PS            SS FEB89
         BNE   ISPLLCHI                 NO, GIVE MSG           SS FEB89
ISPLLCHB DS    0H                       *                     DRK JUL03
         BAS   R2,ISPUSTKM              TERMINATE ANY MEMLIST  SS OCT88
         LH    R1,SPFFUNLP+4            GET LISTA PANEL INDEX  SS MAR87
ISPLLCH3 DS    0H                       *                      SS OCT88
         LNR   R1,R1                    SET FOR SWAP           SS MAR87
         BAS   R2,ISPSTKI               RETURN TO LISTA TABLE  SS MAR87
         L     R14,SPFTTPT              RELOAD PT TO CMD TBL   SS MAR87
         MVC   PUTGETBF(4),ISPCMD50                           ABL JAN87
         MVI   SPFINPUT,X'40'                                 ABL JAN87
         MVC   SPFINPUT+1(79),SPFINPUT                        ABL JAN87
         MVC   SPFINPUT(8),ISPLLCH9    COMMAND NAME           ABL JAN87
         MVI   SPFINPUT+9,C''''        QUOTE                  ABL JAN87
         CLI   SPFTBPFI+1,2             IS IT LISTA            SS OCT88
         BE    ISPLLCH5                 YES                    SS OCT88
         MVC   SPFINPUT+10(44),SPFCDSN DSNAME                  SS OCT88
         B     ISPLLCH6                 *                      SS OCT88
ISPLLCHN DC    CL8'NULLFILE'            *                      SS NOV88
ISPLLCH5 DS    0H                       *                      SS OCT88
         MVC   SPFINPUT+10(44),SPFADSN DSNAME                 ABL JAN87
ISPLLCH6 DS    0H                       *                      SS OCT88
         LA    R1,SPFINPUT+10                                 ABL JAN87
         LA    R1,1(,R1)               FIND                   ABL JAN87
         CLI   0(R1),C' '                  FIRST              ABL JAN87
         BNE   *-8                              BLANK         ABL JAN87
         MVI   0(R1),C''''             ADD FINAL QUOTE        ABL JAN87
         CLI   SPFTBPFI+1,2             IS IT LISTA            SS OCT88
         BE    ISPLLCH7                 YES                    SS OCT88
         CLI   SPFCVOL,C'*'            MULTI VOLUME            SS OCT88
         BE    ISPLLCH2                YES, BRANCH             SS OCT88
         CLC   SPFCVOL,ISPLLCHM        MIGRATE VOLUME          SS OCT88
         BE    ISPLLCH2                YES, BRANCH             SS OCT88
         MVI   2(R1),C'V'              V OF V(                 SS OCT88
         MVI   3(R1),C'('              ( OF V(                 SS OCT88
         MVC   4(6,R1),SPFCVOL         VOLSER                  SS OCT88
         MVI   4+6(R1),C')'            FINAL )                 SS OCT88
         B     ISPLLCH2                 *                      SS OCT88
ISPLLCHM DC    C'MIGRAT'               DFHSM MIGRATED DS       SS NOV88
ISPLLCH7 DS    0H                       *                      SS OCT88
         CLI   SPFAVOL,C' '            ANY VOLUME?            ABL JAN87
         BE    ISPLLCH2                NO, BRANCH             ABL JAN87
         MVI   2(R1),C'V'              V OF V(                ABL JAN87
         MVI   3(R1),C'('              ( OF V(                ABL JAN87
         MVC   4(6,R1),SPFAVOL         VOLSER                 ABL JAN87
         MVI   4+6(R1),C')'            FINAL )                ABL JAN87
ISPLLCH2 DS    0H                                             ABL JAN87
         BAS   R2,ISPQUERY                                    ABL JAN87
         OI    SPFLAG3,SPFLOGM        LOG THE COMMAND         ABL JAN87
         OI    SPFTFLG1,SPFTLPOS                              ABL JAN87
         OI    SPFTFLG1,SPFTLCD       LINE COMMAND ACTIVE     ABL JAN87
         MVI   SPFTPOSI,08                 POST PROCESSING    ABL JAN87
         MVC   SPFTCCRP,SPFTCRP       CURRENT CPR FOR CURSOR  ABL JAN87
         B     ISPLLC                 SEND COMMAND TO PDS     ABL JAN87
* ERROR CONDITIONS                      *                      SS FEB89
ISPLLCHD DS    0H                                              SS FEB89
         C     R15,ISPL8              RC > 8                  DRK OCT13
         BH    ISPLLCHO               YES, I/O ERROR           SS FEB89
         LA    R15,ISPLLCHE           NO,  DSN MSG             SS FEB89
         CLI   SPFTBPFI+1,2             IS IT LISTA            SS OCT88
         BE    ISPLL4                   YES, SET MSG           SS OCT88
         C     R15,ISPL4              RC 4                     SS FEB89
         BE    ISPLLCHV                 VOLUME NOT MOUNTED     SS FEB89
*                                       *                      SS FEB89
*  AT THIS POINT THE DATASET IS NOT ON THE VOLUME              SS FEB89
*  HOWEVER IF IT IS CATALOGED, FOR SOME DASD MANAGEMENT        SS FEB89
*  SYSTEMS THIS MAY MEAN IT IS JUST MIGRATED.                  SS FEB89
*                                       *                      SS FEB89
         CLI   SPFCCAT,C'Y'             IS IT CATALOGED        SS FEB89
         BE    ISPLLCHC                 YES, ASSUME MIGRATED   SS FEB89
ISPLLCHV DS    0H                       *                      SS FEB89
         MVI   SPFCVTOC,C'N'            FLAG NOT ON VTOC       SS FEB89
         B     ISPLL4                   *                      SS FEB89
ISPLLCHO DS    0H                       *                      SS FEB89
         LA    R15,ISPLLCHE+8         I/O MSG                  SS FEB89
         B     ISPLL4                   *                      SS FEB89
ISPLLCHI DS    0H                       *                      SS FEB89
         LA    R15,ISPLLCHE+16        WRONG TYPE DSORG MSG     SS FEB89
         B     ISPLL4                   *                      SS FEB89
ISPLLCHE DS    0H                       *                      SS FEB89
         DC    CL8'*NOTONVO'            MSG 0                  SS FEB89
         DC    CL8'*VTOCERR'            MSG 8                  SS FEB89
         DC    CL8'*NOTPSPO'            MSG 16                 SS FEB89
ISPCMD50 DC    XL4'00500000'       80 CHARACTERS              ABL JAN87
ISPLLCH9 DC    CL8'&NCHA'          CHANGE COMMAND              SS MAR87
         SPACE 2                                               SS NOV86
         DROP  R4                                              SS NOV85
         SPACE 2
         TITLE  'COMMON LINE CMD FUNCTION EXTENSION'           SS JUL87
*************************************************************  SS JUL87
*                                                              SS JUL87
*      COMMON LINE CMD FUNCTIONS EXTENSION                     SS JUL87
*                                                              SS JUL87
*      THESE PROCESSOR IS ENTERED FROM OTHER LINE CMD          SS JUL87
*      PROCESSORS TO CONTINUE LINE PROCESSING                  SS JUL87
*      R0 EQUALS THE EXTENSION FUNCTION                        SS JUL87
*      RETURN IS THROUGH POST PROCESSING CODE (0 FOR CLEANUP)  SS JUL87
*      DIRECTLY OR AFTER PDS COMMAND REQUEST                   SS JUL87
*      RETURN MAY ALSO GO DIRECTLY TO TABLE DISPLAY PROCESSING SS JUL87
*                                                              SS JUL87
*************************************************************  SS JUL87
         SPACE 2
ISPCLXL  DS    0H                                              SS JUL87
         USING *,R4                                            SS JUL87
         SPACE 1                                               SS JUL87
         LR    R15,R0                                          SS JUL87
         B     *+4(R15)             INDEX TO PROCESSOR         SS JUL87
         B     ISPCLX3           0  INVALID                    SS JUL87
         B     ISPCLXXR          4  X AMOUNT                   SS JUL87
         B     ISPCLXK           8  KILL COMMAND               SS JUL87
         B     ISPCLXR          12  REPEAT LINE COMMAND        SS JUL87
         B     ISPCLXB          16  BLOCK REPEAT LINE COMMAND  SS JUL87
         SPACE 3                                               SS JUL87
ISPCLXAA DC    AL2(SPFLISTA-SPWRKC)                            SS JUL87
ISPCLXVV DC    AL2(SPFLISTV-SPWRKC)                            SS JUL87
         SPACE 3                                               SS JUL87
*                                       *                      SS JUL87
*  NORMAL AND ERROR RETURN /EXITS       *                      SS JUL87
*                                       *                      SS JUL87
* PASS COMMAND TO PDS                   *                      SS JUL87
ISPCLXC  DS    0H                                              SS JUL87
         LA    R15,112            ISPCMDC                      SS JUL87
         BR    R3                 RETURN TO ROUTER             SS JUL87
*  NORMAL POST PROCESSING CHECK AND CLEANUP                    SS JUL87
ISPCLXN  DS    0H                  NORMAL CLEANUP              SS NOV85
         BAS   R2,ISPLMSGS         PROCESS MESSAGE             SS NOV85
         LH    R1,SPFTBPOT                                     SS NOV85
         LA    R1,SPWRKC(R1)                                   SS NOV85
         MVC   0(4,R1),ISPBLK8     CLEAR OPTION                SS SEP84
         BAS   R2,ISPTBPUT         UPDATE TABLE                SS SEP84
         TM    ##ADRPA#,$F         SOFT ATTN SIGNALLED?       ABL APR85
         BNO   ISPCLXX             NO, BRANCH                 ABL APR85
         NI    ##ADRPA#,255-$F     YES, TURN OFF FLAG         ABL APR85
         LH    R15,SPFTBPDA          DATA AREA OFFSET          SS JUL87
         LA    R15,SPWRKC(R15)       ADDRESS                   SS JUL87
         MVC   0(8,R15),ISPATTN      ATTN FLAG                 SS JUL87
         B     ISPCLX2             TERMINATE LINE COMMANDS    ABL APR85
*  CHECK FOR VIEW MODE                  *                      SS JUL87
ISPCLXX  DS    0H                                              SS SEP84
         L     R14,SPFTTPT         GET MY TABLE ENTRY          SS NOV85
         TM    $TLF1(R14),#V       VIEW MODE TO FOLLOW         SS SEP84
         BZ    ISPCLXY             NO                          SS NOV85
         MVI   SPFTPOSI,0          COME BACK TO ISPLLY         SS NOV85
* HIERARCHICAL SUPPORT REMOVED          *                      SS OCT88
* SWITCH FUNCTION                       *                      SS JUL87
         BAS   R2,ISPSETST              SET AND RETRIEVE STAT  SS OCT88
         LA    R15,100                  DISPLAY PANEL          SS OCT88
         LTR   R1,R1                    THIS LOG ALREADY       SS OCT88
         BZR   R3                       YES EXIT               SS OCT88
         LH    R1,SPFFUNLP+0            GET LOG LAST PANEL     SS OCT88
         LNR   R1,R1                    SET FOR SWAP           SS OCT88
         BAS   R2,ISPSTKI               SWAP TO LOG PANEL      SS OCT88
         LA    R15,100                  DISPLAY PANEL          SS OCT88
         BR    R3                       RETURN TO ROUTER       SS OCT88
* RETURN TO LINE COMMAND POST PROCESSING CLEANUP               SS JUL87
ISPCLXY  DS    0H                                              SS NOV85
         BAS   R2,ISPQUERY      GET CUR CRP FOR CURSOR         SS MAR85
         MVC   SPFTCCRP,SPFTCRP SAVE CUR CRP                   SS MAR85
         MVI   SPFTPOSI,0         GO TO CLEANUP  POST PROC     SS JUL87
         OI    SPFTFLG1,SPFTLPOS  INDICATE RETURN TO POST PROC SS JUL87
         LH    R15,SPFTBPLF       LINE COMMAND PROCESSOR       SS JUL87
         BR    R3                       *                      SS JUL87
* PROCESS NEW COMMAND                   *                      SS JUL87
ISPCLXNW DS    0H                       PROCESS NEW LINE CMD   SS JUL87
         NI    SPFTFLG1,255-SPFTLPOS    NO POST PROCESSING     SS JUL87
         LH    R15,SPFTBPLF             LINE PROCESS CODE      SS JUL87
         BR    R3                       THROUGH ROUTER         SS JUL87
* PROCESS MESSAGE  R1 MAIN MSG, R15 DATA MSG                   SS JUL87
ISPCLXMG DS    0H                       *                      SS JUL87
         MVC   SPFMLIN2(79),0(R1)       COPY MAIN MSG          SS JUL87
         LH    R1,SPFTBPDA                                     SS JUL87
         LA    R1,SPWRKC(R1)                                   SS JUL87
         MVC   0(8,R1),0(R15)           COPY DATA MSG          SS JUL87
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS JUL87
         MVI   SPFMSGID+7,C'A'                                 SS JUL87
         MVI   SPFMSGID+6,C'1'    GENERAL ERROR MESSAGE        SS JUL87
         B     ISPCLX2                  TERMINATE LINE         SS JUL87
* ERROR IN PDS COMMAND                  *                      SS JUL87
ISPCLXER DS    0H                                              SS JUL87
         NI    SPFLAG0,255-SPFCKER-SPFMSGER   RESET            SS JUL87
         LH    R1,SPFTBPDA                                     SS JUL87
         LA    R1,SPWRKC(R1)                                   SS JUL87
         MVC   0(8,R1),ISPERMSG                                SS JUL87
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS JUL87
         MVI   SPFMSGID+7,C'A'                                 SS JUL87
         MVI   SPFMSGID+6,C'1'    GENERAL ERROR MESSAGE        SS JUL87
         B     ISPCLX2            TERMINATE LINE               SS JUL87
* INVALID COMMAND                       *                      SS JUL87
ISPCLX3  DS    0H                                              SS JUL87
         LH    R1,SPFTBPDA                                     SS JUL87
         LA    R1,SPWRKC(R1)                                   SS JUL87
         MVC   0(8,R1),ISPINVLD                                SS JUL87
* TERMINATE LINE COMMAND                *                      SS JUL87
ISPCLX2  DS    0H                                              SS JUL87
         OI    SPFLAG2,SPFNPOS      POSITIONING NOT ALLOWED    SS JUL87
         BAS   R2,ISPTBPUT          UPDATE TABLE LINE          SS JUL87
         BAS   R2,ISPQUERY                                     SS JUL87
         MVC   SPFTCCRP,SPFTCRP     SAVE CUR CPR FOR CURSOR    SS JUL87
         NI    SPFTFLG1,255-SPFTLPOS  RESET POST PROC FLAG     SS JUL87
         OI    SPFTFLG2,SPFLKILL   SET FOR ERROR               SS JUL87
         LA    R15,100             TBDISPL SUPPORT             SS JUL87
         BR    R3                  RETURN TO ROUTER            SS JUL87
         SPACE 2                                               SS JUL87
*                                       *                      SS JUL87
*  X OUT BY AMOUNT                      *                      SS JUL87
*                                       *                      SS JUL87
ISPCLXXR DS    0H          ****   EXCLUDE SUBCOMMANDS ***      SS JUL87
         LH    R15,SPFTBPDA          DATA AREA OFFSET          SS JUL87
         LA    R15,SPWRKC(R15)       ADDRESS                   SS JUL87
         LA    R14,8                 TRY FOR 30 BYTES          SS JUL87
         LA    R1,ISPCLXXP           PARSE LIST                SS JUL87
         BAS   R2,ISPPARSI           PARSE ROUTINE             SS JUL87
         C     R15,ISPL8             RETURN CODE               SS JUL87
         BE    ISPCLX3               INVALID COMMAND           SS JUL87
         TM    SPFPRBI,X'01'         NUMBER                    SS JUL87
         BO    ISPCLXXN              YES                       SS JUL87
         TM    SPFPRBI,X'80'         ALL?                      SS JUL87
         BO    ISPCLXXA              YES, BRANCH               SS JUL87
         TM    SPFPRBI,X'60'         BELOW/ABOVE?              SS JUL87
         BNZ   ISPCLXXM              YES, BRANCH               SS JUL87
         B     ISPCLX3               NO, ERROR                 SS JUL87
ISPCLXXP DS    0F                                              SS JUL87
         DC    X'51',X'01',X'00',X'00',F'-9999999',F'99999999' SS JUL87
         DC    X'21',X'80',X'00',X'00',CL8'ALL'               ABL JAN87
         DC    X'30',X'40',X'00',X'00',CL8'BELOW'             ABL JAN87
         DC    X'30',X'40',X'00',X'00',CL8'DOWN'   D/DOWN     DRK NOV02
         DC    X'21',X'20',X'00',X'00',CL8'ABOVE'             ABL JAN87
         DC    X'30',X'20',X'00',X'00',CL8'UP'     U/UP       DRK NOV02
         DC    X'FF'                                          ABL JAN87
ISPCLXXM DS    0H                       *                      SS JUL87
         L     R14,SPFTSIZE        DELETE NUMBER               SS JUL87
         ST    R14,SPFPRNU              *                      SS JUL87
ISPCLXXN DS    0H                       *                      SS JUL87
         BAS   R2,ISPQUERY              *                      SS JUL87
         L     R14,SPFPRNU         GET NUMBER                  SS JUL87
         LTR   R14,R14             NEGATIVE                    SS JUL87
         BZ    ISPCLXN             ZERO THEN EXIT              SS JUL87
         BM    ISPCLXX0            NEGATIVE                    SS JUL87
         TM    SPFPRBI,X'20'       ABOVE                       SS JUL87
         BO    ISPCLXX6            TREAT AS NEGATIVE           SS JUL87
         L     R15,SPFTSIZE        END OF TABLE                SS JUL87
         S     R15,SPFTCRP         CURRENT ENTRY               SS JUL87
         CR    R14,R15             NUMBER TO BIG               SS JUL87
         BNH   *+6                 NO                          SS JUL87
         LR    R14,R15             SET TO MAX                  SS JUL87
         ST    R14,SPFFIXED        DELETE THIS AMOUNT          SS JUL87
         ST    R14,SPFFIXE2        POSITION                    SS JUL87
         BAS   R2,ISPDEL           DO IT*                      SS JUL87
         BAS   R2,ISPQUERY         GET NEW VALUES              SS JUL87
         B     ISPCLXN             CONTINUE                    SS JUL87
ISPCLXX0 DS    0H                       *                      SS JUL87
         LPR   R14,R14             SET POSITIVE                SS JUL87
ISPCLXX6 DS    0H                       *                      SS JUL87
         L     R15,SPFTCRP         CURRENT POSITION            SS JUL84
         BCTR  R15,0               POSITION ONE UP             SS JUL84
         LTR   R15,R15             AT TOP                      SS JUL84
         BZ    ISPCLXN             YES NO CLIP                 SS JUL84
         CR    R14,R15             TO BIG                      SS JUL87
         BNH   *+6                 NO                          SS JUL87
         LR    R14,R15             SET TO MAX                  SS JUL87
         ST    R14,SPFFIXED        DELETE AMOUNT               SS JUL87
         S     R15,SPFTCRP         DELTA                       SS JUL87
         ST    R15,SPFFIXE2        SET POSITION                SS JUL87
         L     R15,SPFTCRP         CALC                        SS JUL87
         SR    R15,R14                NEW AT TOP               SS JUL87
         ST    R15,SPFTTOP         NEW                         SS JUL87
         BAS   R2,ISPDEL           DO IT                       SS JUL87
         LA    R15,1               REPOSITION TO ORG CRP       SS JUL87
         BAS   R2,ISPSKIP               *                      SS JUL87
         BAS   R2,ISPQUERY         RESET STATS                 SS JUL87
         B     ISPCLXN             CONTINUE                    SS JUL87
ISPCLXXA DS    0H                                              SS JUL84
         BAS   R2,ISPTBEND         TERMINATE TABLE             SS AUG86
         BAS   R2,ISPTBCRE                                     SS AUG86
         LA    R15,100             TO DISPLAY                  SS AUG86
         BR    R3                       *                      SS JUL87
*                                       *                      SS JUL87
*   KILL LINE COMMANDS                  *                      SS JUL87
*                                       *                      SS JUL87
ISPCLXK  DS    0H                                              SS MAR85
         LH    R15,SPFTBPDA          DATA AREA OFFSET          SS JUL87
         LA    R15,SPWRKC(R15)       ADDRESS                   SS JUL87
         MVC   0(8,R15),ISPBLK8      CLEAR ON ONLY FIRST LINE  SS JUL87
ISPCLXK2 DS    0H                                              SS MAR85
         LH    R1,SPFTBPOT       OPT OFFSET                    SS JUL87
         LA    R1,SPWRKC(R1)            *                      SS JUL87
         MVC   0(4,R1),ISPBLK8   CLEAR X41                     SS JUL87
         BAS   R2,ISPTBPUT      UPDATE TABLE                   SS MAR85
         NI    SPFTFLG1,255-SPFTLPOS                           SS JUL87
         BAS   R2,ISPNXLN       NEXT LINE COMMAND              SS JUL87
         LTR   R15,R15                  *                      SS JUL87
         BZ    ISPCLXK2         PROCESS IT                     SS JUL87
         BAS   R2,ISPBOTM       RESET TO BOTTOM                SS JUL87
         LA    R15,100          TABLE PANEL DISPLAY SUPPORT    SS NOV85
         BR    R3                  RETURN TO ROUTER            SS NOV85
*                                       *                      SS JUL87
*   REPEAT LINE COMMAND                 *                      SS JUL87
*                                       *                      SS JUL87
ISPCLXR  DS    0H                                              SS JUL87
         CLC   SPFBLKCM(4),ISPBLK8      ANY REPEAT CMD         SS DEC87
         BE    ISPCLX3                  NO, INVALID MSG        SS DEC87
         LH    R1,SPFTBPOT              OPT OFFSET             SS JUL87
         LA    R1,SPWRKC(R1)            ADDR                   SS JUL87
         MVC   0(4,R1),SPFBLKCM         COPY COMMAND           SS DEC87
         BAS   R2,ISPTBPUT              UPDATE TABLE           SS JUL87
         B     ISPCLXNW                 GO PROCESS CMD         SS JUL87
*                                       *                      SS JUL87
*   BLOCK REPEAT LINE COMMAND           *                      SS JUL87
*                                       *                      SS JUL87
ISPCLXB  DS    0H                                              SS JUL87
         BAS   R2,ISPNXLN               CHECK FOR BLOCK END    SS JUL87
         LTR   R15,R15                  RC WILL TELL           SS JUL87
         BNZ   ISPCLXBI                 NONE, INCOMPLETE       SS JUL87
         LH    R1,SPFTBPOT              OPT OFFSET             SS JUL87
         LA    R1,SPWRKC(R1)            ADDR                   SS JUL87
         L     R14,SPFTTPT              CMD POINTER            SS JUL87
         CLI   0(R1),ISPBLKC            BLANK OUT LINE COMMAND SS JUL87
         BNE   ISPCLXBS                 NO, CONTINUE           SS JUL87
         MVC   0(4,R1),ISPBLK8          JUST BLANK IT          SS JUL87
         BAS   R2,ISPTBPUT              SAVE IT                SS JUL87
         B     ISPCLXB                  TRY AGAIN              SS JUL87
ISPCLXBS DS    0H                       *                      SS JUL87
         CLC   0(2,R1),$TLCM(R14)       SAME COMMAND           SS JUL87
         BNE   ISPCLXBO                 NO, OVERLAP WITH OTHER SS JUL87
         BAS   R2,ISPTOP                BACKUP                 SS JUL87
         BAS   R2,ISPNXLN               TO START OF BLOCK CMD  SS JUL87
         NI    SPFLAG5,255-SPFBKMT      RESET FLAG             SS NOV88
         L     R14,SPFTTPT              GET COMMAND POINTER    SS JUL87
         TM    $TLF2(R14),#R            USE INTERNAL COMMAND   SS JUL87
         BZ    ISPCLXBA                 NO, USE PREVIOUS       SS JUL87
         MVC   SPFBLKCM(4),ISPBLK8      FIRST BLANK            SS JUL87
         MVC   SPFBLKCM(1),$TLCM(R14)   COPY COMMAND CHAR      SS JUL87
         B     ISPCLXBL                 PROCESS WITHOUT DISPLY SS JUL87
ISPCLXBA DS    0H                       *                      SS JUL87
         MVI   SPFVZCMD,C' '            BLANK                  SS DEC87
         MVC   SPFVZCMD+1(249),SPFVZCMD                        SS DEC87
         LA    R15,ISPCLXB0             PANEL NAME             SS JUL87
         LA    R1,ISPBLK8               NO MSG                 SS JUL87
         BAS   R2,ISPSINGI              DISPLAY PANEL          SS JUL87
         LTR   R15,R15                  CHECK RC               SS JUL87
         BNZ   ISPCLX2                  END, TERMINATE CMD     SS JUL87
         CLC   SPFZSEL(8),ISPBLK8       ANY MATCH DATA         SS NOV88
         BE    ISPCLXBL                 NO                     SS NOV88
         OI    SPFLAG5,SPFBKMT          YES, SET FLAG          SS NOV88
         LA    R1,C' '                  BLANK IN R1 FOR COMPR  SS NOV88
         LA    R15,SPFZSEL              *                      SS NOV88
         LA    R14,10                   *                      SS NOV88
         BAS   R2,ISPCLI                FIND END OF STRING     SS NOV88
         LA    R14,SPFZSEL+1            *                      SS NOV88
         SR    R15,R14                  LENGTH LESS ONE        SS NOV88
         STC   R15,SPFTSVX              SAVE FOR COMPARE       SS NOV88
         LH    R1,SPFTBPOT              OPT OFFSET             SS NOV88
         LA    R1,SPWRKC(R1)            ADDR                   SS NOV88
         MVC   0(4,R1),ISPBLK8          MAKE FIRST BLANK       SS NOV88
         BAS   R2,ISPTBPUT              *                      SS NOV88
ISPCLXBL DS    0H                       *                      SS JUL87
         TM    SPFLAG5,SPFBKMT          IS FLAG SET            SS NOV88
         BZ    ISPCLXBN                 NO, NO TEST MATCH      SS NOV88
         LH    R1,SPFTBPDA              DATA OFFSET            SS NOV88
         LA    R1,SPWRKC(R1)            ADDR                   SS NOV88
         IC    R15,SPFTSVX              GET LENGTH             SS NOV88
         CLC   0(0,R1),SPFZSEL          COMPARE DATA           SS NOV88
         EX    R15,*-6                  EXECUTE COMPARE FOR LN SS NOV88
         BNE   ISPCLXBM                 CONTINUE               SS NOV88
ISPCLXBN DS    0H                       *                      SS NOV88
         LH    R1,SPFTBPOT              OPT OFFSET             SS JUL87
         LA    R1,SPWRKC(R1)            ADDR                   SS JUL87
         MVC   0(4,R1),SPFBLKCM         COPY SAVED COMMAND     SS JUL87
         BAS   R2,ISPTBPUT              *                      SS JUL87
ISPCLXBM DS    0H                       *                      SS NOV88
         LA    R15,1                    SKIP ONE               SS JUL87
         BAS   R2,ISPSKIP               DO TABLE SKIP          SS JUL87
         LH    R1,SPFTBPOT              OPT OFFSET             SS JUL87
         LA    R1,SPWRKC(R1)            ADDR                   SS JUL87
         L     R14,SPFTTPT              CMD POINTER            SS JUL87
         CLC   0(2,R1),$TLCM(R14)       SAME COMMAND           SS JUL87
         BNE   ISPCLXBL                 NO, NOT BOTTOM, LOOP   SS JUL87
         MVC   0(4,R1),SPFBLKCM         COPY SAVED COMMAND     SS JUL87
         TM    SPFLAG5,SPFBKMT          IS FLAG SET            SS NOV88
         BZ    ISPCLXBX                 NO, NO TEST MATCH      SS NOV88
         LH    R1,SPFTBPDA              DATA OFFSET            SS NOV88
         LA    R1,SPWRKC(R1)            ADDR                   SS NOV88
         IC    R15,SPFTSVX              GET LENGTH             SS NOV88
         CLC   0(0,R1),SPFZSEL          COMPARE DATA           SS NOV88
         EX    R15,*-6                  EXECUTE COMPARE FOR LN SS NOV88
         BE    ISPCLXBX                 YES, LAST OK           SS NOV88
         LH    R1,SPFTBPOT              OPT OFFSET             SS NOV88
         LA    R1,SPWRKC(R1)            ADDR                   SS NOV88
         MVC   0(4,R1),ISPBLK8          MAKE LAST BLANK        SS NOV88
ISPCLXBX DS    0H                       *                      SS NOV88
         BAS   R2,ISPTBPUT              *                      SS JUL87
         BAS   R2,ISPTOP                BACKUP                 SS JUL87
         BAS   R2,ISPNXLN               TO START OF BLOCK CMD  SS JUL87
         B     ISPCLXNW                 PROCESS ADDED LNE CMDS SS JUL87
ISPCLXB0 DC    CL8'&P.BLKP'             BLOCK PROMPT PANEL     SS JUL87
ISPCLXBI DS    0H                       *                      SS JUL87
         BAS   R2,ISPTOP                BACKUP                 SS JUL87
         BAS   R2,ISPNXLN               TO START OF BLOCK CMD  SS JUL87
         LA    R1,ISPCLXB1              MSG TEXT               SS JUL87
         LA    R15,ISPCLXB2             DATA MSG               SS JUL87
*        B     ISPCLXMG                 PROCESS AND TERMINATE  SS FEB89
         MVC   SPFMLIN2(79),0(R1)       COPY MAIN MSG          SS FEB89
         LH    R1,SPFTBPDA                                     SS FEB89
         LA    R1,SPWRKC(R1)                                   SS FEB89
         MVC   0(8,R1),0(R15)           COPY DATA MSG          SS FEB89
         MVC   SPFMSGID,ISPPDSM   INIT MESSAGE                 SS FEB89
*        MVI   SPFMSGID+7,C'A'                                 SS FEB89
         MVI   SPFMSGID+7,C'Q'    QUIET MODE                  DRK OCT99
         MVI   SPFMSGID+6,C'1'    GENERAL ERROR MESSAGE        SS FEB89
         BAS   R2,ISPTBPUT              UPDATE ENTRY           SS FEB89
         B     ISPCLXY                  CONTINUE NORMAL CLEAN  SS FEB89
ISPCLXB1 DC    CL79'BLOCK COMMAND IS INCOMPLETE'               SS JUL87
ISPCLXB2 DC    CL8'*NOEND'              *                      SS JUL87
ISPCLXBO DS    0H                       *                      SS JUL87
         BAS   R2,ISPTOP                BACKUP                 SS JUL87
         BAS   R2,ISPNXLN               TO START OF BLOCK CMD  SS JUL87
         LA    R1,ISPCLXB3              MSG TEXT               SS JUL87
         LA    R15,ISPCLXB4             DATA MSG               SS JUL87
         B     ISPCLXMG                 PROCESS                SS JUL87
ISPCLXB3 DC    CL79'BLOCK COMMAND OVERLAPS WITH OTHER LINE COMMANDS OR X
               IS IMPROPERLY ENDED'     *                     Y2K AUG97
ISPCLXB4 DC    CL8'*OVERLAP'            *                      SS JUL87
         SPACE 2                                               SS SEP84
         DROP  R4                       *                      SS JUL87
