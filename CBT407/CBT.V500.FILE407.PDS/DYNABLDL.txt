DYNABLDL TITLE ' '                                            11/83 DBC
************************************************************* 11/86 SBG
*  MODIFIED 11/05/86 TO HAVE A NEW FEATURE.  YOU CAN NOW    * 11/86 SBG
*   EXCLUDE UP TO SIX LINKLIST LIBRARIES FROM THE SEARCH.   * 11/86 SBG
*   THIS IS DONE BY CONDITIONAL ASSEMBLY.  TO TURN ON THIS  * 11/86 SBG
*   FEATURE, SET &LIBEX EQUAL TO 'YES'.  FOR MORE DETAILS,  * 11/86 SBG
*   LOOK FOR THE NAME EXCLLIBS.                             * 11/86 SBG
*                                                           * 11/86 SBG
*  IT IS RECOMMENDED TO NULLIFY THE IEABLD-- MEMBER IN      * 11/86 SBG
*   SYS1.PARMLIB.  THIS RESULTS IN A SIZABLE PERFORMANCE    * 11/86 SBG
*   IMPROVEMENT.  SAVE THE OLD MEMBER, JUST IN CASE.        * 11/86 SBG
*                                                           * 11/86 SBG
*  NOTE:  TO CHANGE THE SIZE OF THE DYNABLDL TABLE, SEE     * 01/88 SBG
*            LABEL "ENTRYCNT" IN THE CODE BELOW.            * 01/88 SBG
*                                                           * 01/88 SBG
*  MUCH THANKS TO DAVE COLE, WHO HELPED ME PUT THIS         * 11/86 SBG
*   ENHANCEMENT INTO THE PROGRAM, AND TO JEFF BROIDO,       * 11/86 SBG
*   WHO MADE ME RECOGNIZE THE DESIRABILITY OF THE FEATURE   * 11/86 SBG
*   TO THE GENERAL PUBLIC.                                  * 11/86 SBG
*                                                           * 11/86 SBG
*  S.GOLOB - NEWSWEEK, INC. - LIVINGSTON, N.J. - 11/05/86   * 11/86 SBG
************************************************************* 11/86 SBG
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
* MODULE NAME = DYNABLDL.                                   * 11/83 DBC
*                                                           * 11/83 DBC
* DESCRIPTIVE NAME = DYNAMIC BLDL FACILITY.                 * 11/83 DBC
*                                                           * 11/83 DBC
* COPYRIGHT = DAVID B. COLE - 1983.                         * 11/83 DBC
*                                                           * 11/83 DBC
* STATUS = RELEASE 88, MODIFICATION LEVEL A.                * 01/88 SBG
*                                                           * 11/83 DBC
* FUNCTION = MAINTAIN A DYNAMICALLY UPDATED LIST OF THE     * 11/83 DBC
*            MOST FREQUENTLY USED BLDL ENTRIES FROM THE     * 11/83 DBC
*            LINK LIST LIBRARIES.                           * 11/83 DBC
*                                                           * 11/83 DBC
*            THIS PROGRAM IS CONCEPTUALLY BASED ON THE      * 11/83 DBC
*            VARIOUS DYNAMIC BLDL PROGRAMS AVAILABLE FROM   * 11/83 DBC
*            THE "CBT MODS" TAPE. HOWEVER, THIS VERSION IS  * 11/83 DBC
*            A COMPLETE REWRITE THAT INCORPORATES A SERIES  * 11/83 DBC
*            OF IMPROVEMENTS LISTED BELOW UNDER "CHANGE     * 11/83 DBC
*            HISTORY".                                      * 11/83 DBC
*                                                           * 11/83 DBC
* PROCESSOR = OS/VS ASSEMBLER.                              * 11/83 DBC
*                                                           * 11/83 DBC
* ATTRIBUTES = NOT REENTRANT.                               * 11/83 DBC
*                                                           * 11/83 DBC
* DEPENDANCIES = STRUCTURE OF IGC018.                       * 11/83 DBC
*                                                           * 11/83 DBC
* AUTHOR = DAVID B. COLE (DBC)                              * 11/83 DBC
*          RR#2 BOX 712                                     * 11/83 DBC
*          AFTON, VA. 22920                                 * 11/83 DBC
*                                                           * 05/84 DBC
*          ADDITIONAL MODIFICATIONS MADE BY:                * 05/84 DBC
*                                                           * 09/84 DBC
*          JERRY L. CALLEN (JLC)                            * 05/84 DBC
*          UNIVERSITY OF CHICAGO                            * 05/84 DBC
*          COMPUTER CENTER                                  * 05/84 DBC
*          5640 SOUTH ELLIS AVENUE                          * 05/84 DBC
*          CHICAGO, IL. 60637                               * 05/84 DBC
*                                                           * 09/84 DBC
*          BILL HORTEN (WRH)                                * 09/84 DBC
*          TENNESSEE EASTMAN COMPANY                        * 09/84 DBC
*          BOX 1973                                         * 09/84 DBC
*          KINGSPORT, TN. 37662                             * 09/84 DBC
*                                                           * 09/84 DBC
*          SAM GOLOB   (SBG)                                * 01/88 SBG
*          NEWSWEEK, INCORPORATED                           * 01/88 SBG
*          333 ROUTE 46 WEST                                * 01/88 SBG
*          MOUNTAIN LAKES, NJ. 07046                        * 01/88 SBG
*          (201) 316-2328                                   * 01/88 SBG
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         TITLE 'CHANGE HISTORY'                               11/83 DBC
************************************************************* 10/85 DBC
*                                                           * 01/88 SBG
* RELEASE 88A                                               * 01/88 SBG
*                                                           * 01/88 SBG
* LAST CHANGE DATE = JANUARY 4, 1988                        * 01/88 SBG
*                                                           * 01/88 SBG
*                  - INCLUDE ADDITIONAL VERSION TABLE       * 01/88 SBG
*                        DFP 1.2  JDQ1111 BASE LEVEL        * 01/88 SBG
************************************************************* 01/88 SBG
         EJECT ,                                              01/88 SBG
************************************************************* 01/88 SBG
*                                                           * 10/85 DBC
* RELEASE 85A                                               * 10/85 DBC
*                                                           * 10/85 DBC
* LAST CHANGE DATE = OCTOBER 3, 1985                        * 10/85 DBC
*                                                           * 10/85 DBC
*                  - INCLUDE ADDITIONAL VERSION TABLES      * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         EJECT ,                                              10/85 DBC
************************************************************* 09/84 DBC
*                                                           * 09/84 DBC
* RELEASE 84C                                               * 09/84 DBC
*                                                           * 09/84 DBC
* LAST CHANGE DATE = SEPTEMBER 27, 1984                     * 09/84 DBC
*                                                           * 09/84 DBC
*                  - INCLUDED ADDITIONAL VERSION TABLES     * 09/84 DBC
*                    WORKED OUT BY BILL HORTEN OF TENNESSEE * 09/84 DBC
*                    EASTMAN COMPANY.                       * 09/84 DBC
*                                                           * 09/84 DBC
*                  - MODIFIED THE SRCHPDS HOOK TO PROPERLY  * 09/84 DBC
*                    HANDLE SOME CHANGES IN THE DFP         * 09/84 DBC
*                    VERSIONS OF IGC018. THESE NEWER        * 09/84 DBC
*                    VERSIONS WILL SOMETIMES SWITCH TO THE  * 09/84 DBC
*                    DEB'S PROTECT KEY (INSTEAD OF THE      * 09/84 DBC
*                    CALLER'S PROTECT KEY) BEFORE STORING   * 09/84 DBC
*                    THE RETURNED DIRECTORY INFORMATION.    * 09/84 DBC
*                                                           * 09/84 DBC
************************************************************* 09/84 DBC
         EJECT ,                                              09/84 DBC
************************************************************* 08/84 DBC
*                                                           * 08/84 DBC
* RELEASE 84B                                               * 08/84 DBC
*                                                           * 08/84 DBC
* LAST CHANGE DATE = AUGUST 27,  1984                       * 08/84 DBC
*                                                           * 08/84 DBC
*                  - SUPPORT FOR ADDITIONAL VERSIONS OF     * 08/84 DBC
*                    IGC018 (VERSIONS 7 AND 8) HAS BEEN     * 08/84 DBC
*                    ADDED. THANKS TO VAL PITCHETT OF STATE * 08/84 DBC
*                    FARM INSURANCE FOR HELP WITH THIS.     * 08/84 DBC
*                                                           * 08/84 DBC
*                  - THE DYNABLDL REPORT NOW FLAGS THOSE    * 08/84 DBC
*                    LOAD MODULES THAT ARE REENTRANT. THIS  * 08/84 DBC
*                    WILL BE HELPFUL IN DETERMINING WHICH   * 08/84 DBC
*                    MODULES MIGHT BE BETTER PLACED IN      * 08/84 DBC
*                    SYS1.LPALIB.                           * 08/84 DBC
*                                                           * 08/84 DBC
************************************************************* 08/84 DBC
         EJECT ,                                              08/84 DBC
************************************************************* 04/84 JLC
*                                                           * 04/84 JLC
* RELEASE 84A                                               * 05/84 DBC
*                                                           * 04/84 JLC
* LAST CHANGE DATE = MAY 29, 1984                           * 05/84 DBC
*                                                           * 04/84 JLC
*                  - "TYPO" TYPE BUGS FIXED AT LABELS       * 04/84 JLC
*                    "ENTCNT" AND "SIZESCAN". (BY CHANCE    * 04/84 JLC
*                    THE BUGS HAD NO FUNCTIONAL EFFECT).    * 04/84 JLC
*                                                           * 04/84 JLC
*                  - SUPPORT ADDED FOR THE UZ61167 LEVEL OF * 04/84 JLC
*                    IGC018.                                * 04/84 JLC
*                                                           * 05/84 DBC
*                  - SUPPORT FOR A SECOND VARIATION OF THE  * 05/84 DBC
*                    UZ61168 LEVEL OF IGC018 ADDED.         * 05/84 DBC
*                                                           * 04/84 JLC
************************************************************* 04/84 JLC
         EJECT ,                                              05/84 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
* RELEASE 83.A                                              * 11/83 DBC
*                                                           * 11/83 DBC
* LAST CHANGE DATE - NOVEMBER 15, 1983                      * 11/83 DBC
*                                                           * 11/83 DBC
*                  - THIS VERSION OF DYNABLDL IS CAPABLE OF * 11/83 DBC
*                    RECOGNIZING AND HOOKING INTO ANY OF    * 11/83 DBC
*                    SEVERAL VERSIONS OF IBM'S IGC018. THE  * 11/83 DBC
*                    RECOGNITION CODE IS TABLE DRIVEN, AND  * 11/83 DBC
*                    ADDITIONAL RECOGNITION TABLES CAN BE   * 11/83 DBC
*                    FAIRLY EASILY ADDED.                   * 11/83 DBC
*                                                           * 11/83 DBC
*                  - THE RECOGNITION TABLES ARE             * 11/83 DBC
*                    COMPREHENSIVE. EACH TABLE CONSISTS OF  * 11/83 DBC
*                    FOUR PARTS. THE FIRST, LABELED "ID#"   * 11/83 DBC
*                    (WHERE "#" REPRESENTS AN ARBITRARY     * 11/83 DBC
*                    UNIQUE NUMERIC SUFIX), MUST MATCH AN   * 11/83 DBC
*                    IGC018'S IDENTIFICATION HEADER. THIS   * 11/83 DBC
*                    IS USED TO DISTINGUISH ONE IGC018 FROM * 11/83 DBC
*                    ANOTHER. THE SECOND AND THIRD PARTS,   * 11/83 DBC
*                    LABELED "SRCHPO#" AND "DFOUND#", MUST  * 11/83 DBC
*                    MATCH THE TWO LOCATIONS IN IGC018      * 11/83 DBC
*                    WHERE DYNABLDL INSERTS ITS JUMPS TO    * 11/83 DBC
*                    ITS INTERCEPT ROUTINES. THE FOURTH     * 11/83 DBC
*                    PART CONSISTS OF A LIST OF DESCRIPTORS * 11/83 DBC
*                    OF ALL IBM PRIVATE DATA FIELDS         * 11/83 DBC
*                    REFERENCED BY THE INTERCEPT ROUTINES.  * 11/83 DBC
*                    MOST OF THE DESCRIPTORS ARE S-CONS     * 11/83 DBC
*                    GIVING THE BASE REGISTER BY WHICH      * 11/83 DBC
*                    IGC018 REFERENCES A FIELD AND THE      * 11/83 DBC
*                    DISPLACEMENT OF THAT FIELD INTO THE    * 11/83 DBC
*                    IBM PRIVATE CONTROL BLOCK. THE         * 11/83 DBC
*                    DYNABLDL INITIALIZATION ROUTINE USES   * 11/83 DBC
*                    THIS LIST TO DYNAMICALLY MODIFY ALL    * 11/83 DBC
*                    MACHINE INSTRUCTIONS IN THE TWO        * 11/83 DBC
*                    INTERCEPT ROUTINES SO THAT THEY        * 11/83 DBC
*                    CORRECTLY MATCH THE PARTICULAR VERSION * 11/83 DBC
*                    OF IGC018 BEING HOOKED INTO. NOTE, THE * 11/83 DBC
*                    TWO IBM PRIVATE CONTROL BLOCKS         * 11/83 DBC
*                    INVOLVED HERE ARE THE "BLDL WORK AREA" * 11/83 DBC
*                    AND BLDL'S "SVRB EXTENDED SAVE AREA".  * 11/83 DBC
*                                                           * 11/83 DBC
*                  - ALL ROUTINES RELATED TO DYNABLDL HAVE  * 11/83 DBC
*                    BEEN CONSOLIDATED INTO A SINGLE        * 11/83 DBC
*                    PROGRAM. THIS RELIEVES THE POTENTIAL   * 11/83 DBC
*                    FOR ERRORS ARISING FROM PARTIAL        * 11/83 DBC
*                    MODIFICATIONS.                         * 11/83 DBC
*                                                           * 11/83 DBC
*                  - THE DYNAMIC BLDL TABLE IS NOW          * 11/83 DBC
*                    MAINTAINED BY A STRAIGHT FORWARD       * 11/83 DBC
*                    "LEAST RECENTLY USED" ALGORITHM. THE   * 11/83 DBC
*                    PREVIOUSLY USED PERIODIC SORTS AND     * 11/83 DBC
*                    PARTIAL REFILL METHOD HAS BEEN         * 11/83 DBC
*                    DISCARDED.                             * 11/83 DBC
*                                                           * 11/83 DBC
*                  - PRIOR VERSIONS OF DYNABLDL DID NOT     * 11/83 DBC
*                    INTERCEPT LINKLIST BLDL REQUESTS IN    * 11/83 DBC
*                    WHICH THE USER REQUESTED TWO OR MORE   * 11/83 DBC
*                    NAMES. FURTHER, PRIOR DYNABLDLS DID    * 11/83 DBC
*                    NOT COUNT SUCH IGNORED REQUESTS AS     * 11/83 DBC
*                    "MISSES". CONSEQUENTLY, THE "HIT RATE" * 11/83 DBC
*                    REPORTED BACK WAS INCORRECT. (IT WAS   * 11/83 DBC
*                    TOO HIGH). THIS VERSION OF DYNABLDL    * 11/83 DBC
*                    DOES HANDLE MULTI-ENTRY BLDL REQUESTS, * 11/83 DBC
*                    AND MY EXPERIENCE HAS BEEN THAT THE    * 11/83 DBC
*                    TRUE HIT RATE HAS RISEN FROM ABOUT 80% * 11/83 DBC
*                    TO BETTER THAN 95%.                    * 11/83 DBC
*                                                           * 11/83 DBC
*                  - THE REPORT FUNCTION NOW PRODUCES THREE * 11/83 DBC
*                    LISTINGS OF THE DYNAMIC TABLE (PRINTED * 11/83 DBC
*                    IN 3-COLUMN FORMAT USING LESS THAN 79  * 11/83 DBC
*                    CHARACTERS PER LINE - SUITABLE FOR     * 11/83 DBC
*                    3270 DISPLAY). ONE LISTING IS SORTED   * 11/83 DBC
*                    BY NAME; A SECOND IS SORTED BY HITS    * 11/83 DBC
*                    COUNT; THE THIRD IS SORTED BY L.R.U.   * 11/83 DBC
*                    CHARACTERISTIC.                        * 11/83 DBC
*                                                           * 11/83 DBC
*                  - THE DYNABLDL STOP FUNCTION NOW         * 11/83 DBC
*                    COMPLETELY REMOVES DYNABLDL FROM THE   * 11/83 DBC
*                    SYSTEM RATHER THAN JUST DISABLING THE  * 11/83 DBC
*                    HOOK ROUTINES.                         * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         TITLE 'DOCUMANTATION'                                11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*              INSTALLATION GUIDE                           * 11/83 DBC
*                                                           * 11/83 DBC
* USE THE FOLLOWING STEPS TO INSTALL DYNABLDL.              * 11/83 DBC
*                                                           * 11/83 DBC
* EXAMINE THE MICROFICHE FOR THE VERSION OF IGC018 (THE     * 11/83 DBC
* BLDL SVC ROUTINE) THAT EXISTS ON YOUR SYSTEM. IN          * 11/83 DBC
* PARTICULAR, EXAMINE THE FOLLOWING.                        * 11/83 DBC
*                                                           * 11/83 DBC
*        - THE MODULE IDENTIFICATION FIELDS LOCATED NEAR    * 11/83 DBC
*          THE START OF IGC018. THIS IS USED BY DYNABLDL TO * 11/83 DBC
*          IDENTIFY THE VERSION OF IGC018 THAT EXISTS IN    * 11/83 DBC
*          YOUR SYSTEM.                                     * 11/83 DBC
*                                                           * 11/83 DBC
*        - THE CODE LOCATED AT IGC018'S LABEL "SRCHPDS".    * 11/83 DBC
*          THIS IS WHERE DYNABLDL INSERTS ITS JUMP TO ITS   * 11/83 DBC
*          DYNAMIC TABLE LOOKUP ROUTINE.                    * 11/83 DBC
*                                                           * 11/83 DBC
*        - THE CODE LOCATED AT ICG018'S LABEL "DFOUND" OR   * 10/85 DBC
*          "FINDKEY" (DEPENDING UPON THE VERSION IF ICG018  * 10/85 DBC
*          THAT YOU HAVE). THIS IS WHERE DYNABLDL INSERTS   * 10/85 DBC
*          ITS JUMP TO ITS DYNAMIC TABLE UPDATE ROUTINE.    * 10/85 DBC
*                                                           * 11/83 DBC
*        - THE BASE REGISTER (USUALLY R13) AND              * 11/83 DBC
*          DISPLACEMENTS OF THE FOLLOWING FIELDS IN THE     * 11/83 DBC
*          "WORKAREA" DSECT.                                * 11/83 DBC
*              RDAREA                                       * 11/83 DBC
*              CONCAT#                                      * 11/83 DBC
*          THESE ARE FIELDS REFERENCED BY THE INTERCEPT     * 11/83 DBC
*          ROUTINES.                                        * 11/83 DBC
*                                                           * 11/83 DBC
*        - THE BASE REGISTER (USUALLY R6) AND DISPLACEMENTS * 09/84 DBC
*          OF THE FOLLOWING FIELDS IN THE SVRB EXTENDED     * 09/84 DBC
*          SAVE AREA. (REMEMBER THAT AN ASSEMBLY XREF FOR   * 09/84 DBC
*          IGC018 WILL LIST THE VALUES OF THE FOLLOWING     * 09/84 DBC
*          LABELS AT +X'40' GREATER THAT THEIR TRUE OFFSETS * 09/84 DBC
*          BECAUSE OF THE PRESENCE OF A 64-BYTE LONG PREFIX * 10/85 DBC
*          SECTION IN THE RB DSECT MAP).                    * 09/84 DBC
*              EXSKEY                                       * 09/84 DBC
*              EXSFLG                                       * 09/84 DBC
*              EXSBLDL (FLAG BIT)                           * 09/84 DBC
*          THESE FIELDS AND FLAGS ARE REFERENCES BY THE     * 09/84 DBC
*          INTERCEPT ROUTINES.                              * 09/84 DBC
*                                                           * 11/83 DBC
*        - THE REGISTER (USUALLY R12 AND NAMED "RBASE")     * 11/83 DBC
*          USED AS IGC018'S PROGRAM BASE, AND ITS RELATIVE  * 11/83 DBC
*          BASE ADDRESS (USUALLY X'2').                     * 11/83 DBC
*                                                           * 11/83 DBC
*        - THE BASE REGISTERS USED BY IGC018 TO POINT TO:   * 11/83 DBC
*              - THE DCB OF THE LIBRARIES CURRENTLY BEING   * 11/83 DBC
*                SEARCHED (USUALLY R11 AND NAMED "RDCB"),   * 11/83 DBC
*              - THE USER'S PARAMETER LIST THAT WAS PASSED  * 11/83 DBC
*                TO THE BLDL ROUTINE (USUALLY R10 AND NAMED * 11/83 DBC
*                "RLIST"),                                  * 11/83 DBC
*              - THE PDS DIRECTORY ENTRY FOUND BY IGC018 AT * 11/83 DBC
*                THE TIME THAT "DFOUND" IS CALLED (USUALLY  * 11/83 DBC
*                R8 AND NAMED "RPDS1").                     * 11/83 DBC
*                                                           * 11/83 DBC
* EXAMINE THE VERSION TABLES ALREADY EXISTING IN THIS       * 11/83 DBC
* DYNABLDL TO SEE IF ANY OF THEM MATCH YOUR VERSION OF      * 11/83 DBC
* IGC018. IF SO, THEN DYNABLDL WILL FUNCTION ON YOUR SYSTEM * 11/83 DBC
* WITHOUT MODIFICATION. IF NOT, THEN YOU WILL HAVE TO ADD A * 11/83 DBC
* VERSION TABLE TO DYNABLDL DESCRIBING YOUR IGC018.  UNLESS * 11/83 DBC
* THE LOGIC OF IGC018 CHANGES DRASTICLY, CREATING A NEW     * 11/83 DBC
* VERSION TABLE SHOULD BE ALL THAT YOU NEED TO DO; YOU      * 11/83 DBC
* SHOULD NOT HAVE TO CHANGE ANYTHING ELSE IN DYNABLDL.      * 11/83 DBC
*                                                           * 11/83 DBC
* NOTE, AN EASY TEST WOULD BE TO SIMPLY RUN DYNABLDL AS     * 11/83 DBC
* RECEIVED. IF IT RECOGNIZES YOUR IGC018, THEN IT WILL RUN. * 11/83 DBC
* IF IT CANNOT RECOGNIZE YOUR IGC018, THEN IT WILL SAY SO   * 11/83 DBC
* AND TERMINATE.                                            * 11/83 DBC
*                                                           * 11/83 DBC
* IF YOU NEED TO ADD A NEW VERSION TABLE, THEN DO THE       * 11/83 DBC
* FOLLOWING:                                                * 11/83 DBC
*                                                           * 11/83 DBC
*        - USING THE INFORMATION GATHERED BY YOUR           * 11/83 DBC
*          EXAMINATION OF IGC018, CREATE A NEW VERSION      * 11/83 DBC
*          TABLE MODELED ON THE VERSION TABLES ALREADY      * 11/83 DBC
*          PROVIDED. BE SURE TO INCLUDE A 4-ELEMENT VECTOR  * 11/83 DBC
*          POINTING TO THE FOUR PARTS OF YOUR NEW VERSION   * 11/83 DBC
*          TABLE.                                           * 11/83 DBC
*                                                           * 11/83 DBC
*        - ADD TO THE "VERSIONS" VECTOR AN ENTRY POINTING   * 11/83 DBC
*          TO YOUR 4-ELEMENT VECTOR.                        * 11/83 DBC
*                                                           * 11/83 DBC
*        - REASSEMBLE DYNABLDL USING "SYS1.MACLIB",         * 11/83 DBC
*          "SYS1.AMODGEN", AND THE MACLIB PROVIDED WITH THE * 11/83 DBC
*          DYNABLDL DISTRIBUTION.                           * 11/83 DBC
*                                                           * 11/83 DBC
* LINK EDIT DYNABLDL INTO A LINKLIST LIBRARY OR SOME OTHER  * 11/83 DBC
* AUTHORIZED LIBRARY. NOTE, ALTHOUGH THE INTERCEPT ROUTINES * 11/83 DBC
* INSERTED INTO IGC018 ARE REENTRANT, DYNABLDL ITSELF IS    * 11/83 DBC
* NOT. THEREFORE, DYNABLDL SHOULD NOT BE PLACED IN          * 11/83 DBC
* SYS1.LPALIB.                                              * 11/83 DBC
*                                                           * 11/83 DBC
* CREATE THE FOLLOWING PROC NAMED DYNABLDL:                 * 11/83 DBC
*                                                           * 11/83 DBC
*        //IEFPROC EXEC PGM=DYNABLDL,REGION=100K            * 11/83 DBC
*        //STEPLIB  DD  DSN= --- (ONLY IF NOT IN LINKLIST)  * 11/83 DBC
*        //IEFRDER  DD  DDNAME=SYSPRINT                     * 11/83 DBC
*        //SYSPRINT DD  SYSOUT=A (USED FOR REPORT FUNCTION) * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         EJECT ,                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*              USER'S GUIDE                                 * 11/83 DBC
*                                                           * 11/83 DBC
* THE FOLLOWING ASSUMES THAT DYNABLDL HAS BEEN INSTALLED AS * 11/83 DBC
* DESCRIBED ABOVE.                                          * 11/83 DBC
*                                                           * 11/83 DBC
* TO START DYNABLDL USE THE FOLLOWING OPERATOR COMMAND.     * 11/83 DBC
*        S DYNABLDL                -- OR --                 * 11/83 DBC
*        S DYNABLDL,PARM=START     -- OR --                 * 11/83 DBC
*        S DYNABLDL,PARM=S                                  * 11/83 DBC
* DYNABLDL WILL (A) ATTEMPT TO RECOGNIZE THE VERSION OF     * 11/83 DBC
* IGC018 RUNNING ON YOUR SYSTEM, (B) DETERMINE WHETHER OR   * 11/83 DBC
* DYNAMIC BLDL PROCESSING IS ALREADY UP AND RUNNING,        * 11/83 DBC
* (C) GENERATE INTERCEPT ROUTINES IN FIXED GLOBAL MEMORY,   * 11/83 DBC
* (D) INSERT INTO IGC018 JUMPS TO THE INTERCEPT ROUTINES,   * 11/83 DBC
* AND (E) TERMINATE LEAVING BEHIND THE ENABLED INTERCEPT    * 11/83 DBC
* ROUTINES.                                                 * 11/83 DBC
*                                                           * 11/83 DBC
* TO STOP DYNABLDL USE THE FOLLOWING OPERATOR COMMAND.      * 11/83 DBC
*        S DYNABLDL,PARM=STOP      -- OR --                 * 11/83 DBC
*        S DYNABLDL,PARM=P                                  * 11/83 DBC
* DYNABLDL WILL REMOVE THE HOOKS FROM IGC018 (BY RESTORING  * 11/83 DBC
* THE ORIGINAL CODE) AND FREE THE GLOBAL MEMORY CONTAINING  * 11/83 DBC
* THE INTERCEPT ROUTINES.                                   * 11/83 DBC
*                                                           * 11/83 DBC
* A DYNABLDL ACTIVITY REPORT CAN BE GENERATED ONLY WHILE    * 11/83 DBC
* DYNABLDL PROCESSING IS ACTIVE. TO GENERATE AN ACTIVITY    * 11/83 DBC
* REPORT, USE THE FOLLOWING OPERATOR COMMAND.               * 11/83 DBC
*        S DYNABLDL,PARM=REPORT    -- OR --                 * 11/83 DBC
*        S DYNABLDL,PARM=R                                  * 11/83 DBC
*                                                           * 11/83 DBC
* TO GENERATE ONLY AN ACTIVITY SUMMARY MESSAGE (WTO), USE   * 11/83 DBC
* THE FOLLOWING OPERATOR COMMAND.                           * 11/83 DBC
*        S DYNABLDL,DSN=NULLFILE,PARM=REPORT  -- OR --      * 11/83 DBC
*        S DYNABLDL,DSN=NULLFILE,PARM=R                     * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         TITLE 'IHASVC MACRO'                                 11/83 DBC
         MACRO                                                11/83 DBC
         IHASVC &D                                            11/83 DBC
SVC      DSECT ,                                              11/83 DBC
SVCENTRY DS    0XL8                SVC TABLE ENTRY            11/83 DBC
SVCEP    DS    A                   A(SVC ROUTINE)             11/83 DBC
SVCATTR1 DS    BL2                 ATTRIBUTES                 11/83 DBC
SVCTP1   EQU   B'00000000'         TYPE 0                     11/83 DBC
SVCTP2   EQU   B'10000000'         TYPE 2                     11/83 DBC
SVCTP34  EQU   B'11000000'         TYPE 3/4                   11/83 DBC
SVCTP6   EQU   B'00100000'         TYPE 6                     11/83 DBC
SVCAPF   EQU   B'00001000'         CALLER MUST BE AUTHORIZED  11/83 DBC
SVCESR   EQU   B'00000100'         "ESR" SVC                  11/83 DBC
SVCNP    EQU   B'00000010'         NON-PREEMPTIVE SVC         11/83 DBC
SVCLOCKS DS    BL2                 LOCK ATTRIBUTES            11/83 DBC
SVCLL    EQU   B'10000000'         LOCAL LOCK                 11/83 DBC
SVCCMS   EQU   B'01000000'         CMS LOCK                   11/83 DBC
SVCOPT   EQU   B'00100000'         OPT LOCK                   11/83 DBC
SVCALLOC EQU   B'00010000'         SALLOC LOCK                11/83 DBC
SVCDISP  EQU   B'00001000'         DISP LOCK                  11/83 DBC
         MEND                                                 11/83 DBC
         TITLE '@ZAP MACRO'                                   11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        THIS MACRO BUILDS A ROUTINE TO DYNAMICALLY ADJUST  * 11/83 DBC
*        AT EXECUTION TIME THOSE MACHINE INSTRUCTIONS THAT  * 11/83 DBC
*        REFERENCE PRIVATE IBM DATA FIELDS.                 * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         MACRO                                                11/83 DBC
&N       @ZAP  &X                                             11/83 DBC
         GBLA  &@ZAP#,&@ZCNT,&@ZAPFO(1024)                    11/83 DBC
         GBLC  &@ZAPZN(1024),&@ZAPFN(1024)                    11/83 DBC
         LCLA  &F#,&FO,&SIGN                                  11/83 DBC
         LCLC  &ZN,&CN,&FN,&NN,&VALUE,&C1                     11/83 DBC
         AIF   ('&X' EQ '').DUMP                              11/83 DBC
.*                                                            11/83 DBC
&@ZAP#   SETA  &@ZAP#+1                                       11/83 DBC
&ZN      SETC  'ZAP&@ZAP#'                                    11/83 DBC
         AIF   ('&N' EQ '').GOTZN                             11/83 DBC
&ZN      SETC  '&N'                                           11/83 DBC
.GOTZN   ANOP                                                 11/83 DBC
&ZN      DS    0H                                             11/83 DBC
.*                                                            11/83 DBC
&F#      SETA  0                                              11/83 DBC
.LP1     AIF   (&F# GE N'&SYSLIST).END1                       11/83 DBC
&F#      SETA  &F#+1                                          11/83 DBC
&@ZCNT   SETA  &@ZCNT+1                                       11/83 DBC
&@ZAPZN(&@ZCNT) SETC '&ZN'                                    11/83 DBC
&@ZAPFN(&@ZCNT) SETC '&SYSLIST(&F#,1)'                        11/83 DBC
&VALUE   SETC  '&SYSLIST(&F#,2)'                              11/83 DBC
&C1      SETC  '&VALUE'(1,1)                                  11/83 DBC
&SIGN    SETA  1                                              11/83 DBC
         AIF   ('&C1' NE '+' AND '&C1' NE '-').GOTNUM         11/83 DBC
&VALUE   SETC  '&VALUE'(2,K'&VALUE-1)                         11/83 DBC
         AIF   ('&C1' EQ '+').GOTNUM                          11/83 DBC
&SIGN    SETA  -1                                             11/83 DBC
.GOTNUM  ANOP                                                 11/83 DBC
&@ZAPFO(&@ZCNT) SETA &SIGN*&VALUE                             11/83 DBC
         AGO   .LP1                                           11/83 DBC
.*                                                            11/83 DBC
.END1    MEXIT                                                11/83 DBC
.*                                                            11/83 DBC
.*                                                            11/83 DBC
.*                                                            11/83 DBC
.DUMP    ANOP                                                 11/83 DBC
&NN      SETC  '&N'                                           11/83 DBC
&F#      SETA  0                                              11/83 DBC
.LP2     AIF   (&F# GE &@ZCNT).END2                           11/83 DBC
&F#      SETA  &F#+1                                          11/83 DBC
         AIF   ('&ZN' EQ '&@ZAPZN(&F#)').NSPACE               11/83 DBC
         SPACE 1                                              11/83 DBC
&ZN      SETC  '&@ZAPZN(&F#)'                                 11/83 DBC
.NSPACE  ANOP                                                 11/83 DBC
&FN      SETC  '&@ZAPFN(&F#)'                                 11/83 DBC
&FO      SETA  &@ZAPFO(&F#)                                   11/83 DBC
&C1      SETC  '+'                                            11/83 DBC
         AIF   (&FO GE 0).GOTSIGN                             11/83 DBC
&C1      SETC  '-'                                            11/83 DBC
.GOTSIGN ANOP                                                 11/83 DBC
         AIF   (&FO/2*2 NE &FO).IMED                          11/83 DBC
&NN      LH    R0,&ZN&C1&FO                                   11/83 DBC
&NN      SETC  ''                                             11/83 DBC
         AH    R0,&FN                                         11/83 DBC
         STH   R0,&ZN&C1&FO                                   11/83 DBC
         AGO   .LP2                                           11/83 DBC
.IMED    ANOP                                                 11/83 DBC
&NN      OC    &ZN&C1&FO.(1),&FN                              11/83 DBC
&NN      SETC  ''                                             11/83 DBC
         AGO   .LP2                                           11/83 DBC
.*                                                            11/83 DBC
.END2    ANOP                                                 11/83 DBC
&@ZCNT   SETA  0                                              11/83 DBC
         MEND                                                 11/83 DBC
         TITLE 'IBM CONTROL BLOCK MAPS'                       11/83 DBC
         PUNCH '         SETCODE AC(1)'                       11/83 DBC
         SPACE 3                                              11/83 DBC
DYNABLDL CSECT ,                                              11/83 DBC
         PRINT NOGEN                                          11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        CVT = COMMUNICATIONS VECTOR TABLE                  * 11/83 DBC
*        CVTFIX = PREFIX AND BASIC SECTIONS DSECT           * 11/83 DBC
*        CVTFIX = PREFIX SECTION BASE                       * 11/83 DBC
*        CVTMAP = BASIC SECTION BASE                        * 11/83 DBC
*        CVTXTNT1 = OS COMMON EXTENSION DSECT AND BASE      * 11/83 DBC
*        CVTXTNT2 = VS1/VS2 COMMON EXTENSION DSECT AND BASE * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         CVT   DSECT=YES,PREFIX=YES,LIST=YES                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DCB = DATA CONTROL BLOCK                           * 11/83 DBC
*        IHADCB = DSECT AND BASE                            * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         DCBD  DSORG=(PS,PO)                                  11/83 DBC
         SPACE 3                                              08/84 DBC
************************************************************* 08/84 DBC
*        PDS2 = PARTITIONED DATASET DIRECTORY ENTRIES FOR   * 08/84 DBC
*               LOAD MODULES AS SHOWN BY THE BLDL SVC.      * 08/84 DBC
*        PDS2 = DSECT AND BASE                              * 08/84 DBC
************************************************************* 08/84 DBC
         SPACE 1                                              08/84 DBC
         IHAPDS ,                                             08/84 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SCVT = SECONDARY COMMUNICATIONS VECTOR TABLE       * 11/83 DBC
*        SCVTSECT = DSECT AND BASE                          * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         IHASCVT LIST=YES                                     11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SVCTABLE = SVC TABLE ENTRY                         * 11/83 DBC
*        SVC = DSECT AND BASE                               * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         IHASVC ,                                             11/83 DBC
SVCENTLN EQU   *-SVC               TABLE ENTRY LENGTH         11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        STANDARD REGISTER NAMES                            * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         #REGS R,                  STANDARD REGISTER NAMES    11/83 DBC*
               (BLDLBASE,R10),     IGC018 LOCATION POINTER    11/83 DBC*
               (VERSBASE,R9),      SPECIFIC VERSION VECTOR PT 11/83 DBC*
               (TABLBASE,R8)       HOOK ROUTINES AREA BASE    11/83 DBC
         SPACE 1                                              11/83 DBC
BLDLSVC  EQU   18                  BLDL SVC NUMBER            11/83 DBC
ENTRYCNT EQU   256                 DYNAMIC LIST SIZE          01/88 SBG
CLOKSHFT EQU   10                  A SHIFT VALUE FOR          11/83 DBC
*                                  SELECTING BITS 10-41 OF    11/83 DBC
*                                  THE TOD CLOCK. NOTE, THESE 11/83 DBC
*                                  ARE THE SAME BITS USED BY  11/83 DBC
*                                  THE SRM FOR ITS INTERVAL   11/83 DBC
*                                  TIMINGS.                   11/83 DBC
LINKSVC  EQU   1                   BLDL'S SIGNAL RETURNED TO  11/83 DBC
*                                  THE USER THAT THE          11/83 DBC
*                                  DIRECTORY ENTRY WAS FOUND  11/83 DBC
*                                  IN EITHER SVCLIB OR A      11/83 DBC
*                                  LINKLIST LIBRARY.          11/83 DBC
LEN3270  EQU   79                  LENGTH OF A 3270 DISPLAY   11/83 DBC
*                                  LINE                       11/83 DBC
         SPACE 1                                              11/83 DBC
         #PUT  SUBAD=PUTWTO,MF=INIT                           11/83 DBC
         SPACE 3                                              11/83 DBC
         PRINT ON,GEN,NODATA                                  11/83 DBC
         EJECT ,                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        BLDLIST -- THIS DSECT MAPS PLIST HEADER FIELDS     * 11/83 DBC
*        THAT A USER OF THE BLDL SVC PASSES TO BLDL.        * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
BLDLIST  DSECT ,                   BLDL PLIST HEADER          11/83 DBC
BLDENTS  DS    H                   NUMBER OF ELEMENTS BEING   11/83 DBC
*                                  PASSED                     11/83 DBC
BLDELEN  DS    H                   THE LENGTH OF EACH ELEMENT 11/83 DBC
BLDENT   DS    0C                  THE START OF THE FIRST     11/83 DBC
*                                  ELEMENT                    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        PDS1 -- THIS DSECT MAPS A PDS DIRECTORY ENTRY.     * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PDS1     DSECT ,                   PDS DIRECTORY ENTRY        11/83 DBC
PDS1NAME DS    CL8                 MEMBER NAME                11/83 DBC
PDS1TTRP DS    XL3                 MEMBER'S TTR IN THE DASD   11/83 DBC
*                                  LIBRARY                    11/83 DBC
PDS1INDC DS    B                   FLAGS & L'UDATA/2          11/83 DBC
PDS1LUSR EQU   B'00011111'         LENGTH BITS                11/83 DBC
PDS1USRD DS    0X                  USER DATA FIELDS           11/83 DBC
         TITLE 'DYNAHEAD DSECT'                               11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        DYNAHEAD -- THIS DSECT MAPS THE DYNAMIC AREA       * 11/83 DBC
*        DESCRIPTOR TABLE.                                  * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DYNAHEAD DSECT ,                                              11/83 DBC
DHID     DC    CL8'DYNAHEAD'       ID FIELD                   11/83 DBC
AREA     DC    A(DYNAHEAD)         A(DYNA AREA)               11/83 DBC
AREASPLN DS    A                   AREA'S SUBPOOL AND LENGTH  11/83 DBC
SRCHPOPT DS    A                   A(SRCHPDS HOOK ROUTINE)    11/83 DBC
DFOUNDPT DS    A                   A(DFOUND HOOK ROUTINE)     11/83 DBC
         SPACE 1                                              11/83 DBC
DYNAFIRS DC    A(*-*)            | --> FIRST DYNALIST ENTRY   11/83 DBC
DYNAELEN DC    A(DYNLLEN)        | L' EACH DYNLLIST ENTRY     11/83 DBC
DYNALAST DC    A(*-*+(ENTRYCNT-1)*DYNLLEN) --> LAST ENTRY     11/83 DBC
DYNACLOK DS    F                   STARTUP TIME (BITS 10-41)  11/83 DBC
DYNAHITS DC    F'0'                LIST HITS                  11/83 DBC
DYNAMISS DC    F'0'                LIST MISSES                11/83 DBC
DYNADDED DC    F'0'                NAMES ADDED TO LIST        11/83 DBC
*                                  (INCLUDING STEALS)         11/83 DBC
DHEADLEN EQU   *-DYNAHEAD          L'HEADER                   11/83 DBC
         TITLE 'DYNL DSECT'                                   11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        DYNL -- THIS DSECT MAPS A DYNAMIC BLDL LIST ENTRY. * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DYNL     DSECT ,                                              11/83 DBC
DYNLLRU# DS    F                   L.R.U. ALGORYTHM CONTROL   11/83 DBC
DYNLHITS DS    F                   HIT COUNT                  11/83 DBC
DYNLCLOK DS    F                   ENTRY CREATION TIME        11/83 DBC
DYNLELEN DS    H                   L'DIRECTORY ENTRY IN THIS  11/83 DBC
*                                  SLOT                       11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        GENERAL FORMAT PDS DIRECTORY ENTRY                 * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DENT     DS    0D                                             11/83 DBC
DENTNAME DS    CL8                 MEMBER NAME. NOTE, THIS    11/83 DBC
*                                  FIELD MUST BE DWORD        11/83 DBC
*                                  ALIGNED DUE TO A "CDS"     11/83 DBC
*                                  INSTRUCTION THAT IS ISSUED 11/83 DBC
*                                  AGAINST IT                 11/83 DBC
DYNLLOCK EQU   DENTNAME+3-DENTNAME LOCAL CONTROL LOCK BYTE    11/83 DBC
UNLOCKED EQU   C' '                LOCAL CONTROL LOCK FLAG    11/83 DBC
DENTTTRP DS    XL3                 MEMBER'S TTR IN THE DASD   11/83 DBC
*                                  LIBRARY                    11/83 DBC
DENTCNCT DS    FL1                 LIBRARY CONCATENATION      11/83 DBC
*                                  INDEX                      11/83 DBC
DENTLIBF DC    AL1(LINKSVC)        ORIGINATING LIBRARY TYPE   11/83 DBC
*                                  ALWAYS "LINKLIST LIB")     11/83 DBC
DENTINDC DS    B                   FLAGS & L'UDATA/2          11/83 DBC
DENTLUSR EQU   B'00011111'         LENGTH BITS                11/83 DBC
DENTUSRD DS    XL(DENTLUSR*2)      USER DATA (MAX LENGTH)     11/83 DBC
DENTLEN  EQU   *-DENT              MAX D'ENTRY LENGTH         11/83 DBC
         SPACE 1                                              11/83 DBC
DYNLEND  DS    0D                  ALIGNMENT                  11/83 DBC
DYNLLEN  EQU   DYNLEND-DYNL        L'DYNAMIC BLDL LIST ENTRY  11/83 DBC
         TITLE 'IGC018 DSECT'                                 11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        IGC018 -- THIS IS A DUMMY DSECT USED SIMPLY TO     * 11/83 DBC
*        SHOW WHERE, IN THE CODE, "BLDLBASE" IS LOADED AND  * 11/83 DBC
*        WHERE IT IS NOT.                                   * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
IGC018   DSECT ,                                              11/83 DBC
         TITLE 'VERSION DSECT'                                11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        VERSION -- THIS DSECT MAPS A VECTOR CONTAINING     * 11/83 DBC
*        POINTERS TO THE FOUR PARTS OF A VERSION TABLE.     * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
VERSION  DSECT ,                                              11/83 DBC
IDVV     DS    A                   --> VERSION VERIFIER       11/83 DBC
SRCHPOVV DS    A                   --> ORIGINAL "SRCHPDS" COD 11/83 DBC
DFOUNDVV DS    A                   --> ORIGINAL "DFOUND" CODE 11/83 DBC
DATAOFFS DS    A                   --> IBM DATA FIELDS DESCRIPTORS  DBC
         TITLE 'ORIGINAL DSECT'                               11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        ORIGINAL -- THIS DSECT MAPS CONTROL BLOCKS (PARTS  * 11/83 DBC
*        ONE, TWO, AND THREE OF THE VARIOUS VERSION TABLES) * 11/83 DBC
*        THAT DESCRIBE SECTIONS OF ORIGINAL CODE IN IGC018. * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
ORIGINAL DSECT ,                                              11/83 DBC
ORIGLOC  DS    Y                   OFFSET TO ORIGINAL CODE'S LOCATION C
ORIGLEN  DS    Y                   ORIGINAL CODE'S LENGTH     11/83 DBC
ORIGCODE DS    0X                  ORIGINAL CODE              11/83 DBC
         TITLE 'FIELDS DSECT'                                 11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        FIELDS -- THIS DSECT MAPS TABLES THAT DESCRIBE IBM * 11/83 DBC
*        PRIVATE DATA FIELDS. EACH ENTRY CORRESPONDS EITHER * 11/83 DBC
*        TO A DATA FIELD OR TO IMMEDIATE DATA THAT DYNABLDL * 11/83 DBC
*        REFERENCES BUT THAT IS PRIVATE TO IBM AND,         * 11/83 DBC
*        THEREFORE, MAY CHANGE ACCROSS VARIOUS VERSIONS OF  * 11/83 DBC
*        IGC018.                                            * 11/83 DBC
*                                                           * 11/83 DBC
*        DATA FIELD ENTRIES CONSIST OF AN S-CON             * 11/83 DBC
*        (BASE-REGISTER/DISPLACEMENT) WHICH CAN BE USED TO  * 11/83 DBC
*        REFERENCE THAT FIELD IN A PARTICULAR VERSION OF    * 11/83 DBC
*        IGC018.                                            * 11/83 DBC
*                                                           * 11/83 DBC
*        "IMMEDIATE DATA" ENTRIES CONSIST OF A SINGLE BYTE  * 11/83 DBC
*        CONTAINING THE ACTUAL BIT PATTERN USED BY A        * 11/83 DBC
*        PARTICULAR VERSION OF IGC018 TO REPRESENT THE      * 11/83 DBC
*        IMMEDIATE DATA.                                    * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
FIELDS   DSECT ,                                              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        VARIOUS BASE REGISTERS USED BY IGC018.             * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
RBASE    DS    S                   IGC018'S PROGRAM BASE      11/83 DBC
*                                  REGISTER DESCRIPTOR. THIS  11/83 DBC
*                                  S-CON GIVES THE            11/83 DBC
*                                  PROGRAMMING BASE REGISTER  11/83 DBC
*                                  (USUALLY R12) AND THE      11/83 DBC
*                                  RELATIVE BASE ADDRESS      11/83 DBC
*                                  (USUALLY +2) USED BY       11/83 DBC
*                                  IGC018.                    11/83 DBC
         SPACE 1                                              11/83 DBC
RPDS1    DS    S                   REGISTER USED BY IGC018 TO 11/83 DBC
*                                  POINT TO THE FOUND PDS     11/83 DBC
*                                  DIRECTORY ENTRY AT THE     11/83 DBC
*                                  TIME THAT "DFOUND" IS      11/83 DBC
*                                  CALLED.                    11/83 DBC
RLIST    DS    S                   REGISTER USED BY IGC018 TO 11/83 DBC
*                                  POINT TO THE USER'S BLDL   11/83 DBC
*                                  PARAMETER LIST.            11/83 DBC
RDCB     DS    S                   REGISTER USED BY IGC018 TO 11/83 DBC
*                                  POINT TO THE DCB FOR THE   11/83 DBC
*                                  LIBRARIES CURRENTLY BEING  11/83 DBC
*                                  SEARCHED.                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        FIELDS IN IGC018'S DYNAMIC WORK AREA               * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
RDAREA   DS    S                   BASE/DISPLACEMENT          11/83 DBC
*                                  NOTE, THIS FIELD IS A 256  11/83 DBC
*                                  BYTE DIRECTORY BLOCK       11/83 DBC
*                                  BUFFER WHOSE INTERNAL      11/83 DBC
*                                  STRUCTURE IS PUBLIC AND    11/83 DBC
*                                  WHICH, AT THE TIME THE     11/83 DBC
*                                  SRCHPDS HOOK ROUTINE IS    11/83 DBC
*                                  CALLED, CAN BE USED BY     11/83 DBC
*                                  DYNABLDL FOR ITS OWN       11/83 DBC
*                                  PURPOSES.                  11/83 DBC
         SPACE 1                                              11/83 DBC
CONCAT#  DS    S                   BASE/DISPLACEMENT          11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        FIELDS IN IGC018'S SVRB EXTENDED SAVE AREA         * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
EXSKEY   DS    S                   BASE/DISPLACEMENT          11/83 DBC
EXSFLG   DS    S                   BASE/DISPLACEMENT          09/84 DBC
EXSBLDL  DS    B                   FLAG'S BIT VALUE           09/84 DBC
         SPACE 3                                              11/83 DBC
FIELDSLN EQU   *-FIELDS            L'DATA AREA                11/83 DBC
         TITLE 'DYNAWA DSECT'                                 11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        DYNAWA -- DYNAMIC WORK AREA USED BY THE TWO HOOK   * 11/83 DBC
*        ROUTINES. THE "SRCHPDS" ROUTINE MAPS THIS AREA     * 11/83 DBC
*        INTO THE "RDAREA" FIELD OF BLDL'S "WORKAREA" DSECT * 11/83 DBC
*        WHICH IS AN I/O BUFFER FOR DIRECTORY BLOCKS AND IS * 11/83 DBC
*        NOT IN USE AT THE TIME THAT "SRCHPDS" IS CALLED.   * 11/83 DBC
*        THE "DFOUND" ROUTINE HAS TO GETMAIN ITS "DYNAWA"   * 11/83 DBC
*        AREA SINCE THE "RDAREA" FIELD IS IN USE AT THE     * 11/83 DBC
*        TIME THAT "DFOUND" IS CALLED.                      * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DYNAWA   DSECT ,                   LOCAL DYNAMIC WORK AREA    11/83 DBC
REGSAVE  DS    13A                 REGISTER SAVE AREA         11/83 DBC
CLOKSAVE DS    2A                  "STCK" BUFFER              11/83 DBC
KEYSAVE  DS    X                   CALLER'S KEY SAVE AREA     11/83 DBC
USERKEY  DS    X                   USER'S KEY SAVE AREA       11/83 DBC
BLDLFLG  DS    B                   IGC018'S EXSFLG SAVE AREA  09/84 DBC
CCIDSAVE DS    X                   CONCATENATION INDEX SAVE A 11/83 DBC
DYNAWAL  EQU   *-DYNAWA            L'DYNAWA                   11/83 DBC
         #TEST SIZE=(DYNAWAL,LE,256) MUST FIT WITHIN IGC018'S 11/83 DBC*
                                   "RDAREA" FIELD             11/83 DBC
         TITLE 'INFO DSECT'                                   11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        INFO -- THIS DSECT MAPS THE INFORMATION MESSAGE    * 11/83 DBC
*        PRINTED BY THE REPORT FUNCTION FOR EACH DYNAMIC    * 11/83 DBC
*        BLDL TABLE ENTRY. NOTE, EACH MESSAGE LINE CONTAINS * 11/83 DBC
*        THREE SEGMENTS. THE FIRST CONTAINS INFORMATION     * 11/83 DBC
*        SORTED BY BLDL MEMBER NAME. THE SECOND CONTAINS    * 11/83 DBC
*        INFORMATION SORTED BY HITS FREQUENCY. THE THIRD    * 11/83 DBC
*        CONTAINS INFORMATION SORTED BY LEAST RECENT USAGE. * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
INFO     DSECT ,                                              11/83 DBC
COUNT    DS    CL3,C' '            MSG LINE NUMBER            11/83 DBC
         SPACE 1                                              11/83 DBC
NAMEBAR  DS    C'|',C' '           GUTTER                     11/83 DBC
NAMENAME DS    CL(L'DENTNAME),C' ' MEMBER NAME                11/83 DBC
NAMELIB# DS    CL2,C' '            LINKLIST LIB ID NUMBER     11/83 DBC
NAMEHITS DS    CL5,C' '            HITS COUNT                 11/83 DBC
         SPACE 1                                              11/83 DBC
HITSBAR  DS    C'|',C' '           GUTTER                     11/83 DBC
HITSHITS DS    CL5,C' '            HITS COUNT                 11/83 DBC
HITSRENT DS    C                   REENTRANT MODULE SIGNAL    08/84 DBC
HITSNAME DS    CL(L'DENTNAME),C' ' MEMBER NAME                11/83 DBC
HITSIDLE DS    CL4,C' '            ENTRY'S IDLE TIME          11/83 DBC
HITSAGE  DS    CL4,C' '            ENTRY AGE                  11/83 DBC
         SPACE 1                                              11/83 DBC
LRUBAR   DS    C'|',C' '           GUTTER                     11/83 DBC
LRUIDLE  DS    CL4,C' '            IDLE INTERVAL              11/83 DBC
LRUNAME  DS    CL(L'DENTNAME),C' ' MEMBER NAME                11/83 DBC
LRUHITS  DS    CL5                 HITS COUNT                 11/83 DBC
         SPACE 1                                              11/83 DBC
INFOLEN  EQU   *-INFO              MESSAGE LENGTH             11/83 DBC
         #TEST SIZE=(INFOLEN,LE,LEN3270) SHOULD FIT ON A 3270 11/83 DBC
         TITLE 'INITIAL ENTRY - FUNCTION SELECTION'           11/83 DBC
************************************************************* 11/83 DBC
*        STANDARD NON-REENTRANT ENTRY LINKAGE               * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DYNABLDL #ENTER 'COPYRIGHT DAVID B. COLE - 1983',BASES=2      11/83 DBC
         L     R3,0(,R1)           LOAD THE PARM FIELD PTR    11/83 DBC
         LA    R3,0(,R3)           PURIFY IT                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        ENQ TO SERIALIZE DYNABLDL PROCESSING               * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         ENQ   MF=(E,SERIALIZ)                                11/83 DBC
         OI    FLAG,ENQED          SET AUDIT FLAG             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        GET THE CURRENT T.O.D. ISSOLATE BITS 10-41 WHICH   * 11/83 DBC
*        MEASURE TIME RANGING FROM ABOUT 1/1000TH OF A      * 11/83 DBC
*        SECOND UP TO APPROXIMATELY ONE MONTH. NOTE, THIS   * 11/83 DBC
*        IS THE SAME TIME SCALE USED BY THE SRM FOR ITS     * 11/83 DBC
*        INTERVAL TIMINGS.                                  * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         STCK  CLOCK               GET THE TOD CLOCK          11/83 DBC
         LM    R0,R1,CLOCK         LOAD THE VALUE             11/83 DBC
         SLDL  R0,CLOKSHFT         ISSOLATE BITS 10-41 INTO   11/83 DBC
*                                  REGISTER 0.                11/83 DBC
         ST    R0,CLOCK            STORE BACK                 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        LOCATE THE BLDL SVC ROUTINE (IGC018).              * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     BLDLBASE,CVTPTR     --> CVT                    11/83 DBC
         L     BLDLBASE,CVTABEND-CVTMAP(,BLDLBASE) --> SCVT   11/83 DBC
         L     BLDLBASE,SCVTSVCT-SCVTSECT(,BLDLBASE) --> SVCTABLE 3 DBC
         L     BLDLBASE,SVCENTRY-SVC+BLDLSVC*SVCENTLN(,BLDLBASE) 83 DBC
*                                  --> IGC018                 11/83 DBC
         USING IGC018,BLDLBASE     SIGNAL THIS FACT           11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        IDENTIFY WHICH VERSION OF IGC018 IS IN THIS        * 11/83 DBC
*        SYSTEM.                                            * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R2,VERSIONS-4       --> RECOGNITION VECTOR     11/83 DBC
         BALR  R4,0                LOAD LOOP POINT            11/83 DBC
         LA    R2,4(,R2)           --> NEXT TABLES PTR        11/83 DBC
         ICM   VERSBASE,15,0(R2)   --> SPECIFIC TABLES VECTOR 11/83 DBC
*                                  EO-RECOG VECTOR?           11/83 DBC
         BZ    UNRECOGN            YES, IGC018 NOT RECOGNIZED 11/83 DBC
         USING VERSION,VERSBASE    NO, DCL TABLE VECTOR BASE  11/83 DBC
         L     R1,IDVV             --> IDENTIFIER CODE        11/83 DBC
         BAL   R14,VERIFY          DOES IGC018 MATCH THIS?    11/83 DBC
         BR    R4                  +0 NO, KEEP TRYING         11/83 DBC
         NOPR  0                      (FILLER)                11/83 DBC
*                                  +4 YES, PROCEED            11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        THE CURRENT VERSION OF IGC018 HAS BEEN RECOGNIZED. * 11/83 DBC
*        NOW EXAMINE THE "SRCHPDS" HOOK LOCATION TO SEE     * 11/83 DBC
*        WHAT IT CONTAINS.                                  * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,SRCHPOVV         --> VERIFY DATA            11/83 DBC
         USING ORIGINAL,R1         DCL A BASE FOR IT          11/83 DBC
         LH    R15,ORIGLOC         GET HOOK OFFSET            11/83 DBC
         LA    R15,IGC018(R15)     CNVRT TO AN ADDRESS        11/83 DBC
         CLC   0(SRCHPOAA-SRCHPOHH,R15),SRCHPOHH HAS THE      11/83 DBC
*                                  SRCHPO HOOK ALREADY BEEN   11/83 DBC
*                                  SET?                       11/83 DBC
         BE    VEROK1              YES, PROCEED               11/83 DBC
         OI    FLAG,SRCHPO00       NO, REMEMBER               11/83 DBC
         BAL   R14,VERIFY          DOES THE HOOK LOCATION     11/83 DBC
*                                  CONTAIN WHAT IT OUGHT TO?  11/83 DBC
         B     BADSTRUC            +0 NO, ERROR               11/83 DBC
*                                  +4 YES, PROCEED            11/83 DBC
         DROP  R1                  RELEASE VERIFIER BASE      11/83 DBC
VEROK1   DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        NOW DO THE SAME FOR THE "DFOUND" HOOK LOCATION.    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,DFOUNDVV         --> VERIFY DATA            11/83 DBC
         USING ORIGINAL,R1         DCL A BASE FOR IT          11/83 DBC
         LH    R15,ORIGLOC         GET HOOK OFFSET            11/83 DBC
         LA    R15,IGC018(R15)     CNVRT TO AN ADDRESS        11/83 DBC
         CLC   0(DFOUNDAA-DFOUNDHH,R15),DFOUNDHH HAS THE      11/83 DBC
*                                  DFOUND HOOK ALREADY BEEN   11/83 DBC
*                                  SET?                       11/83 DBC
         BE    VEROK2              YES, PROCEED               11/83 DBC
         OI    FLAG,DFOUND00       NO, REMEMBER               11/83 DBC
         BAL   R14,VERIFY          DOES THE HOOK LOCATION     11/83 DBC
*                                  CONTAIN WHAT IT OUGHT TO?  11/83 DBC
         B     BADSTRUC            +0 NO, ERROR               11/83 DBC
*                                  +4 YES, PROCEED            11/83 DBC
         DROP  R1                  RELEASE VERIFIER BASE      11/83 DBC
VEROK2   DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        EXAMINE THE PARM FIELD TO DETERMINE THE DESIRED    * 11/83 DBC
*        FUNCTION ("START", "STOP", OR "REPORT").           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LTR   R3,R3               IS A PARM FIELD SET UP?    11/83 DBC
         BZ    START               NO, ASSUME "START"         11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R15,PARMS-(PRMROOTL-(L'PRMLEN-1)) YES, PRIME   11/83 DBC
         SR    R2,R2               PRIME LENGTH REGISTER      11/83 DBC
         BALR  R14,0               LOAD SCAN LOOP HEAD        11/83 DBC
         LA    R15,PRMROOTL-(L'PRMLEN-1)(R2,R15) --> NEXT ENT 11/83 DBC
         ICM   R2,3,PRMLEN(R15)    GET L'ENTRY; EO-TABLE?     11/83 DBC
         BM    INVALID             YES, ERROR                 11/83 DBC
         LA    R2,L'PRMLEN-1(,R2)  NO, GET L'TEXT+L'LENFLD-1  11/83 DBC
         CLC   0(*-*,R3),PRMTEXT-2(R15) (EXECUTED)            11/83 DBC
         #TEST SIZE=(PRMTEXT-2,EQ,PRMLEN)                     11/83 DBC
         EX    R2,*-6              RIGHT ENTRY?               11/83 DBC
         BHR   R14                 NOT YET, CONTINUE SEARCH   11/83 DBC
         BL    INVALID             NO, INVALID PARM           11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R15,PRMHNDLR(,R15)  YES, LOAD HANDLER ADDRESS  11/83 DBC
         BR    R15                 GOTO THE HANDLER           11/83 DBC
         TITLE 'START -- DYNAMIC BLDL STARTUP ROUTINE'        11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        START -- THIS ROUTINE STARTS UP DYNAMIC BLDL       * 11/83 DBC
*        PROCESSING.                                        * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
************************************************************* 11/83 DBC
*        START PROCESSING REQUIRES AUTHORIZATION. TEST THIS * 11/83 DBC
*        (DRAMATICALLY) BY ATTEMPTING TO AQUIRE SUPERVISOR  * 11/83 DBC
*        STATE.                                             * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
START    MODESET MODE=SUP          SET SUPERVISOR STATE       11/83 DBC
         OI    FLAG,SUPER          REMEMBER IN SUPER STATE    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        START PROCESSING CAN PROCEED ONLY IF BOTH IGC018   * 11/83 DBC
*        HOOKS ARE NOT YET SET. CHECK THIS OUT.             * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         TM    FLAG,SRCHPO00+DFOUND00 ARE BOTH HOOK LOCATIONS 11/83 DBC
*                                  CLEAR?                     11/83 DBC
         BZ    DONEB4              NO, BOTH ARE SET; EXIT.    11/83 DBC
         BM    MESS                NO, ONE IS, ONE ISN'T; THE 11/83 DBC
*                                  USER MUST INVOKE STOP      11/83 DBC
*                                  PROCESSING TO CLEAN UP THE 11/83 DBC
*                                  MESS.                      11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        IGC018 HAS BEEN POSITIVELY RECOGNIZED. NOW ADJUST  * 11/83 DBC
*        ALL IBM PRIVATE FIELD REFERENCES, CONTAINED IN THE * 11/83 DBC
*        TWO HOOK ROUTINES ("SRCHPDS" AND "DFOUND"), SO     * 11/83 DBC
*        THAT THEY CORRESPOND CORRECTLY TO THE RECOGNIZED   * 11/83 DBC
*        VERSION OF IGC018. NOTE, I DO THIS NOW, PRIOR TO   * 11/83 DBC
*        MOVING THE HOOK ROUTINES TO SP245, SO THAT I DON'T * 11/83 DBC
*        HAVE TO DO IT IN KEY-0.                            * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
************************************************************* 11/83 DBC
*        DEVELOP A RETURN DESCRIPTOR FOR THE SRCHPDS HOOK.  * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,DATAOFFS         --> IBM PRIVATE FIELDS     11/83 DBC
*                                  DESCRIPTORS                11/83 DBC
         USING FIELDS,R1           DCL A BASE FOR THEM        11/83 DBC
         SR    R14,R14             CLEAR FOR INSERT           11/83 DBC
         ICM   R14,3,RBASE         GET IGC018'S BASE          11/83 DBC
*                                  DESCRIPTOR                 11/83 DBC
         SRDL  R14,12              SEPARATE THE DISPLACEMENT  11/83 DBC
*                                  FROM THE BASE REG          11/83 DBC
         SRL   R15,20              ALIGN THE DISPLACEMENT     11/83 DBC
         SLL   R14,12              ALIGN THE REG VALUE        11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,SRCHPOVV         --> SRCHPDS VERIFY DATA    11/83 DBC
         DROP  R1                  RELEASE FIELDS BASE        11/83 DBC
         USING ORIGINAL,R1         DCL VERIFY DATA BASE       11/83 DBC
         LNR   R0,R15              GET BASE'S DISPLACEMENT    11/83 DBC
         AH    R0,ORIGLOC          SUBTR FROM PATCH'S         11/83 DBC
*                                  DISPLACEMENT               11/83 DBC
         AH    R0,ORIGLEN          ADD IN THE PATCH'S LENGTH  11/83 DBC
*                                  TO DETERMINE THE ADDRESS   11/83 DBC
*                                  OF THE LOCATION PAST THE   11/83 DBC
*                                  PATCH RELATIVE TO IGC018'S 11/83 DBC
*                                  BASE REGISTER.             11/83 DBC
         CL    R0,=X'00000FFF'     BASE REG OVERFLOW?         11/83 DBC
         #DIE  H,'IGC018 IS LONGER THAN 4K' YES               11/83 DBC
         OR    R0,R14              NO, GET COMBINED           11/83 DBC
*                                  BASE/DISPLACEMENT VALUE    11/83 DBC
         STH   R0,SRCHPOXX         STORE FOR USE BY @ZAP      11/83 DBC
         DROP  R1                  RELEASE SRCHPDS VERIFY     11/83 DBC
*                                  DATA BASE                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        NOW DO THE SAME FOR THE DFOUND HOOK.               * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,DFOUNDVV         --> DFOUND VERIFY DATA     11/83 DBC
         USING ORIGINAL,R1         DCL VERIFY DATA BASE       11/83 DBC
         LNR   R0,R15              GET BASE'S DISPLACEMENT    11/83 DBC
         AH    R0,ORIGLOC          SUBTR FROM PATCH'S         11/83 DBC
*                                  DISPLACEMENT               11/83 DBC
         AH    R0,ORIGLEN          ADD IN THE PATCH'S LENGTH  11/83 DBC
*                                  TO DETERMINE THE ADDRESS   11/83 DBC
*                                  OF THE LOCATION PAST THE   11/83 DBC
*                                  PATCH RELATIVE TO IGC018'S 11/83 DBC
*                                  BASE REGISTER.             11/83 DBC
         CL    R0,=X'00000FFF'     BASE REG OVERFLOW?         11/83 DBC
         #DIE  H,'IGC018 IS LONGER THAN 4K' YES               11/83 DBC
         OR    R0,R14              NO, GET COMBINED           11/83 DBC
*                                  BASE/DISPLACEMENT VALUE    11/83 DBC
         STH   R0,DFOUNDXX         STORE FOR USE BY @ZAP      11/83 DBC
         DROP  R1                  RELEASE DFOUND VERIFY DATA 11/83 DBC
*                                  BASE                       11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        NOW CALL @ZAP TO ADJUST ALL REFERENCES TO IBM      * 11/83 DBC
*        PRIVATE DATA FIELDS.                               * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,DATAOFFS         --> THE TABLE OF IBM       11/83 DBC
*                                  PRIVATE FIELD REFERENCE    11/83 DBC
*                                  DESCRIPTORS.               11/83 DBC
         L     R15,=A(@ZAP)        --> THE GRAND ADJUSTER     11/83 DBC
         BALR  R14,R15             ADJUST IBM FIELDS REFS     11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        NOW ALLOCATE GLOBAL, FIXED, KEY-0, FETCH           * 11/83 DBC
*        ACCESSABLE MEMORY (SP245) INTO WHICH THE HOOK      * 11/83 DBC
*        ROUTINES AND DYNAMIC BLDL TABLE WILL BE BUILT. THE * 11/83 DBC
*        AREA WILL BE USED AS FOLLOWS.                      * 11/83 DBC
*                                                           * 11/83 DBC
*        - THE "DYNAHEAD" TABLE.                            * 11/83 DBC
*                                                           * 11/83 DBC
*        - THE "SRCHPDS" HOOK ROUTINE CONSTRUCTED AS        * 11/83 DBC
*          FOLLOWS:                                         * 11/83 DBC
*          - THE "SRCHPDS" CODE RELOCATED FROM THIS MODULE, * 11/83 DBC
*          - THE "SRCHPDS" VERIFIED CODE COPIED FROM        * 11/83 DBC
*            IGC018,                                        * 11/83 DBC
*          - THE "SRCHPOBC" BRANCH STATEMENT.               * 11/83 DBC
*                                                           * 11/83 DBC
*        - THE "DFOUND" HOOK ROUTINE CONSTRUCTED AS         * 11/83 DBC
*          FOLLOWS:                                         * 11/83 DBC
*          - THE "DFOUND" CODE RELOCATED FROM THIS MODULE,  * 11/83 DBC
*          - THE "DFOUND" VERIFIED CODE COPIED FROM IGC018, * 11/83 DBC
*          - THE "DFOUNDBC" BRANCH STATEMENT.               * 11/83 DBC
*                                                           * 11/83 DBC
*        - THE DYNAMIC BLDL TABLE, DWORD ALIGNED.           * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
************************************************************* 11/83 DBC
*        DETERMINE  THE AMOUNT OF MEMORY NEEDED.            * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R0,7                GET DWORD ROUNDER          11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R3,(DHEADLEN+7)/8*8 GET L'DYNAHEAD ROUNDED     11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,SRCHPOVV         --> VERIFIER               11/83 DBC
         LH    R1,ORIGLEN-ORIGINAL(,R1) GET VERIFIED LEN      11/83 DBC
         LA    R1,SRCHPOLL+L'SRCHPOBC+7(,R1) INCLUDE L'BODY - 11/83 DBC
         OR    R1,R0                ROUNDED UP TO -           11/83 DBC
         XR    R1,R0                 DWORD ALIGNMENT          11/83 DBC
         AR    R3,R1               ACCUMULATE                 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,DFOUNDVV         --> VERIFIER               11/83 DBC
         LH    R1,ORIGLEN-ORIGINAL(,R1) GET VERIFIED LEN      11/83 DBC
         LA    R1,DFOUNDLL+L'DFOUNDBC+7(,R1) INCLUDE L'BODY - 11/83 DBC
         OR    R1,R0                ROUNDED UP TO -           11/83 DBC
         XR    R1,R0                 DWORD ALIGNMENT          11/83 DBC
         AR    R3,R1               ACCUMULATE                 11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R1,DYNLLEN          GET L'DLIST ENTRY          11/83 DBC
         #TEST SIZE=(DYNLLEN/8*8,EQ,DYNLLEN)                  11/83 DBC
         MH    R1,=Y(ENTRYCNT)     GET DLIST TABLE SIZE       11/83 DBC
         AR    R3,R1               ACCUMULATE IT              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        GETMAIN AND CLEAR THE AREA                         * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         MODESET EXTKEY=ZERO,SAVEKEY=PSWKEY,WORKREG=2 KEY0    11/83 DBC
         OI    FLAG,KEY0           SET AUDIT FLAG             11/83 DBC
         SPACE 1                                              11/83 DBC
         ICM   R3,8,=AL1(245)      GET SUBPOOL ID             11/83 DBC
         GETMAIN R,LV=(R3)         ALLOCATE GLOBAL MEMORY     11/83 DBC
         LR    TABLBASE,R1         COPY AREA PTR              11/83 DBC
         USING DYNAHEAD,TABLBASE   DCL A BASE FOR IT          11/83 DBC
         LR    R0,R1               COPY THE AREA PTR          11/83 DBC
         LR    R1,R3               COPY THE AREA LENGTH       11/83 DBC
         SR    R15,R15             PREPARE TO CLEAR THE AREA  11/83 DBC
         MVCL  R0,R14              CLEAR THE AREA             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        BEGIN TO CONSTRUCT THE DYNAHEAD TABLE              * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   DHID,=CL8'DYNAHEAD' STORE TABLE ID             11/83 DBC
         ST    TABLBASE,AREA       SAVE A(AREA)               11/83 DBC
         ST    R3,AREASPLN         SAVE SP & LEN OF AREA      11/83 DBC
         MVC   DYNACLOK,CLOCK      COPY TOD BITS 10-41        11/83 DBC
         LA    R14,DYNAHEAD+(DHEADLEN+7)/8*8 --> PAST TABLE   11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        CONSTRUCT THE SRCHPDS HOOK ROUTINE                 * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         ST    R14,SRCHPOAA        STORE IGC018'S POINTER     11/83 DBC
         ST    R14,SRCHPOPT        STORE A(SRCHPDS HOOK)      11/83 DBC
         ST    TABLBASE,SRCHPODH   A(DYNAHEAD) --> SRCHPDS    11/83 DBC
         LA    R0,SRCHPDS          --> SRCHPDS SOURCE         11/83 DBC
         LA    R1,SRCHPOLL         GET ITS LENGTH             11/83 DBC
         LR    R15,R1              GET L'SINK                 11/83 DBC
         MVCL  R14,R0              COPY BODY OF SRCHPDS HOOK  11/83 DBC
         L     R1,SRCHPOVV         --> VERIFY DATA            11/83 DBC
         USING ORIGINAL,R1         DCL A BASE FOR IT          11/83 DBC
         LA    R0,ORIGCODE         --> CODE MATCHED IN IGC018 11/83 DBC
         LH    R15,ORIGLEN         GET ITS LENGTH             11/83 DBC
         LR    R1,R15              COPY                       11/83 DBC
         DROP  R1                  RELEASE VERIFIER BASE      11/83 DBC
         MVCL  R14,R0              COPY IGC018 CODE           11/83 DBC
         MVC   0(L'SRCHPOBC,R14),SRCHPOBC COPY RETURN INSTR   11/83 DBC
         LA    R14,L'SRCHPOBC+7(,R14) ADVANCE -               11/83 DBC
         SRL   R14,3                SCANNER -                 11/83 DBC
         SLL   R14,3                 ROUNDED                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        CONSTRUCT THE DFOUND HOOK ROUTINE                  * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         ST    R14,DFOUNDAA        STORE IGC018'S POINTER     11/83 DBC
         ST    R14,DFOUNDPT        STORE A(DFOUND HOOK)       11/83 DBC
         ST    TABLBASE,DFOUNDDH   A(DYNAHEAD) --> DFOUND     11/83 DBC
         LA    R0,DFOUND           --> DFOUND SOURCE          11/83 DBC
         LA    R1,DFOUNDLL         GET ITS LENGTH             11/83 DBC
         LR    R15,R1              GET L'SINK                 11/83 DBC
         MVCL  R14,R0              COPY BODY OF DFOUND HOOK   11/83 DBC
         L     R1,DFOUNDVV         --> VERIFY DATA            11/83 DBC
         USING ORIGINAL,R1         DCL A BASE FOR IT          11/83 DBC
         LA    R0,ORIGCODE         --> CODE MATCHED IN IGC018 11/83 DBC
         LH    R15,ORIGLEN         GET ITS LENGTH             11/83 DBC
         LR    R1,R15              COPY                       11/83 DBC
         DROP  R1                  RELEASE VERIFIER BASE      11/83 DBC
         MVCL  R14,R0              COPY IGC018 CODE           11/83 DBC
         MVC   0(L'DFOUNDBC,R14),DFOUNDBC COPY RETURN INSTR   11/83 DBC
         LA    R14,L'DFOUNDBC+7(,R14) ADVANCE -               11/83 DBC
         SRL   R14,3                SCANNER -                 11/83 DBC
         SLL   R14,3                 ROUNDED                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        CONSTRUCT THE DYNAMIC LIST TABLE DESCRIPTOR AND    * 11/83 DBC
*        SKELETON.                                          * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         ST    R14,DYNAFIRS        STORE SO-TABLE             11/83 DBC
         LA    R0,DYNLLEN          GET L'ENTRY                11/83 DBC
         ST    R0,DYNAELEN         STORE                      11/83 DBC
         LR    R1,R0               COPY                       11/83 DBC
         MH    R1,=Y(ENTRYCNT-1)   GET OFFSET TO LAST ENTRY   11/83 DBC
         AR    R1,R14              CNVRT TO ADDRESS           11/83 DBC
         ST    R1,DYNALAST         STORE                      11/83 DBC
         SPACE 1                                              11/83 DBC
         USING DYNL,R14            DCL DYNL ENTRY BASE        11/83 DBC
DYNLINIT OI    DENTNAME+DYNLLOCK,UNLOCKED "NOT LOCKED"        11/83 DBC
         BXLE  R14,R0,DYNLINIT     LOOP FOR ALL ENTRIES       11/83 DBC
         DROP  R14                 RELEASE DYNL ENTRY BASE    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        COPY THE HOOKS TO IGC018.                          * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,DFOUNDVV         --> VERIFY DATA            11/83 DBC
         LH    R1,ORIGLOC-ORIGINAL(,R1) GET HOOK OFFSET       11/83 DBC
         LA    R1,IGC018(R1)       GET HOOK ADDRESS           11/83 DBC
         MVC   0(DFOUNDHL,R1),DFOUNDHH COPY HOOK TO IGC018    11/83 DBC
         NI    FLAG,255-DFOUND00   REMEMBER HOOK NOW SET      11/83 DBC
         SPACE 3                                              11/83 DBC
         L     R1,SRCHPOVV         --> VERIFY DATA            11/83 DBC
         LH    R1,ORIGLOC-ORIGINAL(,R1) GET HOOK OFFSET       11/83 DBC
         LA    R1,IGC018(R1)       GET HOOK ADDRESS           11/83 DBC
         MVC   0(SRCHPOHL,R1),SRCHPOHH COPY HOOK TO IGC018    11/83 DBC
         NI    FLAG,255-SRCHPO00   REMEMBER HOOK NOW SET      11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        START PROCESSING DONE. CLEAN UP AND EXIT.          * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         DROP  TABLBASE            RELEASE GLOBAL AREA BASE   11/83 DBC
         SPACE 1                                              11/83 DBC
         MODESET KEYADDR=PSWKEY,WORKREG=2 RESTORE KEY8        11/83 DBC
         NI    FLAG,255-KEY0       CLEAR AUDIT FLAG           11/83 DBC
         SPACE 1                                              11/83 DBC
         B     STARTED             ISSUE MSG AND EXIT         11/83 DBC
         TITLE 'STOP -- DYNAMIC BLDL SHUTDOWN ROUTINE'        11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        STOP -- THIS ROUTINE SHUTS DOWN DYNAMIC BLDL       * 11/83 DBC
*        PROCESSING.                                        * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
************************************************************* 11/83 DBC
*        STOP PROCESSING REQUIRES AUTHORIZATION. TEST THIS  * 11/83 DBC
*        (DRAMATICALLY) BY ATTEMPTING TO AQUIRE SUPERVISOR  * 11/83 DBC
*        STATE.                                             * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
STOP     MODESET MODE=SUP          SET SUPERVISOR STATE       11/83 DBC
         OI    FLAG,SUPER          REMEMBER IN SUPER STATE    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        I WILL PROCEED ONLY IF AT LEAST ONE HOOK IS SET.   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         TM    FLAG,SRCHPO00+DFOUND00 IS EITHER HOOK SET?     11/83 DBC
         BO    STOPDB4             NO, JUST EXIT              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        AT LEAST ONE HOOK HAS BEEN PREVIOUSLY SET. LOAD    * 11/83 DBC
*        KEY0 SO THAT I CAN CLEAR IT (OR THEM).             * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         MODESET EXTKEY=ZERO,SAVEKEY=PSWKEY,WORKREG=2         11/83 DBC
         OI    FLAG,KEY0           SET AUDIT FLAG             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        CLEAR THE "DFOUND" HOOK FIRST.                     * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         BALR  TABLBASE,0          LOAD A NON-ZERO POINTER TO 11/83 DBC
*                                  AN ACCESSIBLE GARBAGE AREA 11/83 DBC
         SPACE 1                                              11/83 DBC
         TM    FLAG,DFOUND00       IS THIS HOOK ALREADY CLER? 11/83 DBC
         BNZ   CLEARD1             YES, SKIP                  11/83 DBC
         L     R1,DFOUNDVV         NO, --> VERIFY DATA        11/83 DBC
         USING ORIGINAL,R1         DCL ITS BASE               11/83 DBC
         LH    R15,ORIGLOC         GET HOOK'S OFFSET          11/83 DBC
         LA    R15,IGC018(R15)     GET ITS ADDRESS            11/83 DBC
         L     TABLBASE,DFOUNDAA-DFOUNDHH(,R15) --> INTERCEPT 11/83 DBC
         L     TABLBASE,DFOUNDDH-DFOUND(,TABLBASE) -->        11/83 DBC
*                                  DYNABLDL'S CONTROL TABLE   11/83 DBC
         MVC   0(DFOUNDHL,R15),ORIGCODE CLEAR THE HOOK        11/83 DBC
         OI    FLAG,DFOUND00       SET AUDIT FLAG             11/83 DBC
         DROP  R1                  RELEASE VERIFIER BASE      11/83 DBC
CLEARD1  DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        NOW CLEAR THE "SRCHPDS" HOOK.                      * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         TM    FLAG,SRCHPO00       IS THIS HOOK ALREADY CLER? 11/83 DBC
         BNZ   CLEARD2             YES, SKIP                  11/83 DBC
         L     R1,SRCHPOVV         NO, --> VERIFY DATA        11/83 DBC
         USING ORIGINAL,R1         DCL ITS BASE               11/83 DBC
         LH    R15,ORIGLOC         GET HOOK'S OFFSET          11/83 DBC
         LA    R15,IGC018(R15)     GET ITS ADDRESS            11/83 DBC
         CLC   DHID-DYNAHEAD(,TABLBASE),=CL8'DYNAHEAD' IS     11/83 DBC
*                                  CONTROL TABLE PTR OK?      11/83 DBC
         BE    GOTDHPTR            YES, PROCEED               11/83 DBC
         L     TABLBASE,SRCHPOAA-SRCHPOHH(,R15) NO, -->       11/83 DBC
*                                  INTERCEPT ROUTINE          11/83 DBC
         L     TABLBASE,SRCHPODH-SRCHPDS(,TABLBASE) -->       11/83 DBC
*                                  DYNABLDL'S CONTROL TABLE   11/83 DBC
GOTDHPTR MVC   0(SRCHPOHL,R15),ORIGCODE CLEAR THE HOOK        11/83 DBC
         OI    FLAG,SRCHPO00       SET AUDIT FLAG             11/83 DBC
         DROP  R1                  RELEASE VERIFIER BASE      11/83 DBC
CLEARD2  DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        NOW, IF I WAS ABLE TO GET A POINTER TO THE HEADER  * 11/83 DBC
*        TABLE, THEN FREEMAIN DYNABLDL'S GLOBAL DATA AREA.  * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         CLC   DHID-DYNAHEAD(,TABLBASE),=CL8'DYNAHEAD' DO I   11/83 DBC
*                                  HAVE A PTR TO THE CONTROL  11/83 DBC
*                                  TABLE?                     11/83 DBC
         BNE   FREED               NO, FORGET IT              11/83 DBC
         USING DYNAHEAD,TABLBASE   YES, DCL HEADER TABLE'S    11/83 DBC
*                                  BASE                       11/83 DBC
         L     R1,AREA             --> GLOBAL AREA            11/83 DBC
         L     R0,AREASPLN         GET ITS SUBPOOL AND LENGTH 11/83 DBC
         FREEMAIN R,LV=(0),A=(1)   FREE IT                    11/83 DBC
         DROP  TABLBASE            RELEASE BASE               11/83 DBC
         SR    TABLBASE,TABLBASE   SET "TABLE FREED" SIGNAL   11/83 DBC
FREED    DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RESTORE KEY8.                                      * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         MODESET KEYADDR=PSWKEY,WORKREG=2                     11/83 DBC
         NI    FLAG,255-KEY0       CLEAR AUDIT FLAG           11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        EXIT ACCORDING TO WHETHER OR NOT I WAS ABLE TO     * 11/83 DBC
*        FREE THE GLOBAL AREA.                              * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LTR   TABLBASE,TABLBASE   WAS THE GLOBAL AREA FOUND? 11/83 DBC
         BNZ   PARTSTOP            NO, ISSUE SPECIAL MSG      11/83 DBC
         B     STOPPED             YES, EXIT NORMALLY         11/83 DBC
         TITLE 'REPORT -- DYNAMIC BLDL ACTIVITY REPORTING ROUTINE'  DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        REPORT -- THIS ROUTINE GENERATES A REPORT OF       * 11/83 DBC
*        DYNAMIC BLDL'S ACTIVITY. THREE SORTS OF THE TABLE  * 11/83 DBC
*        ARE PRINTED IN 3-COLUMN FORMAT. THE FIRST LISTS    * 11/83 DBC
*        THE TABLE BY MEMBER NAME. THE SECOND LISTS IT BY   * 11/83 DBC
*        HIT COUNT (MOST HITS TO LEAST HITS). THE THIRD     * 11/83 DBC
*        LISTS THE TABLE BY L.R.U. CHARACTERISTIC (MOST TO  * 11/83 DBC
*        LEAST RECENTLY USED). ALSO A SUMMARY MESSAGE IS    * 11/83 DBC
*        BOTH PRINTED AND DISPLAYED VIA WTO GIVING THE      * 11/83 DBC
*        "HIT RATE" AND OTHER DATA.                         * 11/83 DBC
*                                                           * 11/83 DBC
*        OUTPUT IS WRITTEN TO SYSPRINT WHICH CAN HAVE ANY   * 11/83 DBC
*        RECORD FORMAT AND ANY RECORD LENGTH THAT CAN HOLD  * 11/83 DBC
*        AT LEAST 79 BYTES OF DATA. NOTE THAT THE RECORD    * 11/83 DBC
*        LENGTH IS SUITABLE FOR DISPLAY ON A 3270 TERMINAL. * 11/83 DBC
*                                                           * 11/83 DBC
*        IF SYSPRINT IS OMITTED, THEN ONLY A SUMMARY        * 11/83 DBC
*        MESSAGE IS DISPLAYED TO THE OPERATORS.             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
************************************************************* 11/83 DBC
*        PROCEED ONLY IF DYNABLDL IS CURRENTLY ACTIVE.      * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
REPORT   TM    FLAG,SRCHPO00+DFOUND00 ARE BOTH HOOKS IN?      11/83 DBC
         BNZ   DOWN                NO, EXIT                   11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DYNABLDL IS ACTIVE. LOCATE THE DYNABLDL GLOBAL     * 11/83 DBC
*        AREA.                                              * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     TABLBASE,DFOUNDVV   --> VERIFY DATA            11/83 DBC
         LH    TABLBASE,ORIGLOC-ORIGINAL(,TABLBASE) GET HOOK  11/83 DBC
*                                  OFFSET                     11/83 DBC
         LA    TABLBASE,IGC018(TABLBASE) CNVRT TO ADDRESS     11/83 DBC
         L     TABLBASE,DFOUNDAA-DFOUNDHH(,TABLBASE) -->      11/83 DBC
*                                  "SRCHPDS" INTERCEPT        11/83 DBC
         L     TABLBASE,DFOUNDDH-DFOUND(,TABLBASE) -->        11/83 DBC
*                                  CONTROL TABLE              11/83 DBC
         USING DYNAHEAD,TABLBASE   DCL ITS BASE               11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        CONSTRUCT THE FIRST SUMMARY MESSAGE.               * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   STATBUF(11),=C'TABLE LIFE '                    11/83 DBC
         L     R1,CLOCK            GET CURRENT TIME           11/83 DBC
*                                  (SECONDS*1024)             11/83 DBC
         S     R1,DYNACLOK         GET TABLE LIFE             11/83 DBC
         SRL   R1,CLOKSHFT         CNVRT TO SECONDS           11/83 DBC
         LA    R1,30(,R1)          ADD ROUNDER                11/83 DBC
         SR    R0,R0               CLEAR FOR DIVIDE           11/83 DBC
         D     R0,=F'60'           CNVRT TO MINUTES           11/83 DBC
         SR    R0,R0               CLEAR AGAIN                11/83 DBC
         D     R0,=F'60'           CNVRT TO HOURS(R1) & MINS  11/83 DBC
         BAL   R14,ZONEIT          CNVRT HOURS TO EBCDIC      11/83 DBC
         MVC   STATBUF+11(*-*),0(R1) (EXECUTED)               11/83 DBC
         EX    R15,*-6             COPY TO MSG L-J            11/83 DBC
         LA    R5,STATBUF+12(R15)  LOAD SCANNER               11/83 DBC
         MVI   0(R5),C':'          DELIMITER                  11/83 DBC
         CVD   R0,DWORK            CNVRT MINS TO DECIMAL      11/83 DBC
         UNPK  1(2,R5),DWORK(8)    ZONE IT                    11/83 DBC
         OI    2(R5),C'0'          FIX THE FUCKING SIGN       11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   3(10,R5),=C', ENTRIES '                        11/83 DBC
         LM    R1,R3,DYNAFIRS      LOAD TABLE DESCRIPTOR      11/83 DBC
         LR    R0,R1               SAVE SO-TABLE              11/83 DBC
ENTCNT   CLI   DENTNAME-DYNL(R1),0 UNUSED SLOT YET?           04/84 JLC
         BE    ENTCNTZ             YES, DONE HERE             11/83 DBC
         BXLE  R1,R2,ENTCNT        NO, KEEP SCANNING          11/83 DBC
ENTCNTZ  SR    R1,R0               YES, GET LIST SIZE         11/83 DBC
         SR    R0,R0               CLEAR FIR DIVIDE           11/83 DBC
         DR    R0,R2               GET # USED SLOTS           11/83 DBC
         BAL   R14,ZONEIT          CONVERT IT TO EBCDIC       11/83 DBC
         MVC   13(*-*,R5),0(R1)    (EXECUTED)                 11/83 DBC
         EX    R15,*-6             COPY IT JEFT JUSTIFIED     11/83 DBC
         LA    R5,14(R15,R5)       ADVANCE SCANNER            11/83 DBC
         SPACE 1                                              11/83 DBC
         CL    R5,=A(STATBUF+L'STATBUF) BUFFER OVERFLOW?      11/83 DBC
         #DIE  H                   YES, DESIGN ERROR          11/83 DBC
         LA    R1,STATBUF          NO, --> SO-BUFFER          11/83 DBC
         SR    R5,R1               GET L'MSG                  11/83 DBC
         STC   R5,STATBUF-1        STORE FOR OUTPUT ROUTINES  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DISPLAY THE FIRST SUMMARY MESSAGE TO THE           * 11/83 DBC
*        OPERATORS.                                         * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         CH    R5,=Y(WTOMAXL-9)    TOO LONG?                  11/83 DBC
         BNH   STATLNOK            NO, PROCEED                11/83 DBC
         LA    R5,WTOMAXL-9        YES, RESET                 11/83 DBC
STATLNOK MVC   WTOBUF+L'WTOHEAD(9),=C'DYNABLDL ' INSERT ID    11/83 DBC
         MVC   WTOBUF+L'WTOHEAD+9(WTOMAXL-9),STATBUF COPY     11/83 DBC
         LA    R5,9(,R5)           ADJ L'MSG                  11/83 DBC
         STC   R5,WTOBUF+L'WTOHEAD-1 STORE FOR "PUTWTO"       11/83 DBC
         #PUT  WTOBUF+L'WTOHEAD    DISPLAY THE MESSAGE        11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        CONSTRUCT THE SECOND SUMMARY MESSAGE.              * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   STATBUF2(5),=C'HITS '                          11/83 DBC
         L     R7,DYNAHITS         LOAD TOTAL HITS COUNT      11/83 DBC
         LR    R1,R7               COPY FOR CONVERSION        11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   STATBUF2+5(*-*),0(R1) (EXECUTED)               11/83 DBC
         EX    R15,*-6             COPY TO MSG                11/83 DBC
         LA    R5,STATBUF2+6(R15)  ADVANCE SCANNER            11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   0(9,R5),=C', MISSES '                          11/83 DBC
         ICM   R2,15,DYNAMISS      LOAD TOTAL MISSES; ANY?    11/83 DBC
         BZ    NO2NDMSG            NO, NO USAGE               11/83 DBC
         LR    R1,R2               COPY FOR CONVERSION        11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   9(*-*,R5),0(R1)     (EXECUTED)                 11/83 DBC
         EX    R15,*-6             COPY TO MSG                11/83 DBC
         LA    R5,10(R15,R5)       ADVANCE SCANNER            11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   0(13,R5),=C' (GOOD NAMES '                     11/83 DBC
         L     R3,DYNADDED         GET STEAL COUNT            11/83 DBC
         LR    R1,R3               COPY FOR CONVERSION        11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   13(*-*,R5),0(R1)    (EXECUTED)                 11/83 DBC
         EX    R15,*-6             COPY TO MSG                11/83 DBC
         LA    R5,14(R15,R5)       ADVANCE SCANNER            11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   0(12,R5),=C', BAD NAMES '                      11/83 DBC
         LR    R1,R2               GET MISS COUNT             11/83 DBC
         SR    R1,R3               SUBTR STEAL COUNT          11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   12(*-*,R5),0(R1)    (EXECUTED)                 11/83 DBC
         EX    R15,*-6             COPY TO MSG                11/83 DBC
         LA    R5,13(R15,R5)       ADVANCE SCANNER            11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   0(12,R5),=C'), HIT RATE ' YES                  11/83 DBC
         AR    R2,R7               TOTAL USE COUNT            11/83 DBC
         MH    R7,=H'1000'         SHIFT THE DECIMAL PLACE    11/83 DBC
         SR    R6,R6               CLEAR FOR DIVIDE           11/83 DBC
         DR    R6,R2               GET HIT RATE TO A 10TH OF  11/83 DBC
*                                  A PERCENT                  11/83 DBC
         SR    R1,R1               CLEAR ROUNDER              11/83 DBC
         AR    R6,R6               DOUBLE THE REMAINDER       11/83 DBC
         CR    R6,R2               NEED TO ROUND UP?          11/83 DBC
         BL    NOROUNUP            NO, SKIP                   11/83 DBC
         LA    R1,1                YES, RESET THE ROUNDER     11/83 DBC
NOROUNUP AR    R1,R7               COPY AND ROUND FOR CNVRSN  11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   12(*-*,R5),0(R1)    (EXECUTED)                 11/83 DBC
         EX    R15,*-6             COPY TO MSG                11/83 DBC
         LA    R5,12(R15,R5)       --> LAST DIGIT ("10THS")   11/83 DBC
         MVC   1(1,R5),0(R5)       MOVE IT OUT OF THE WAY     11/83 DBC
         MVI   0(R5),C'.'          INSERT DECIMAL POINT       11/83 DBC
         MVI   2(R5),C'%'          INSERT PERCENT SIGN        11/83 DBC
         LA    R5,3(,R5)           ADVANCE SCANNER            11/83 DBC
         SPACE 1                                              11/83 DBC
         CL    R5,=A(STATBUF2+L'STATBUF2) BUFFER OVERFLOW?    11/83 DBC
         #DIE  H                   YES, DESIGN ERROR          11/83 DBC
         LA    R1,STATBUF2         NO, --> SO-BUFFER          11/83 DBC
         SR    R5,R1               GET L'MSG                  11/83 DBC
         STC   R5,STATBUF2-1       STORE FOR OUTPUT ROUTINES  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DISPLAY THE SECOND SUMMARY MESSAGE TO THE          * 11/83 DBC
*        OPERATORS.                                         * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         CH    R5,=Y(WTOMAXL-9)    TOO LONG?                  11/83 DBC
         BNH   STATLOK2            NO, PROCEED                11/83 DBC
         LA    R5,WTOMAXL-9        YES, RESET                 11/83 DBC
STATLOK2 MVC   WTOBUF+L'WTOHEAD(9),=C'DYNABLDL ' INSERT ID    11/83 DBC
         MVC   WTOBUF+L'WTOHEAD+9(WTOMAXL-9),STATBUF2 COPY    11/83 DBC
         LA    R5,9(,R5)           ADJ L'MSG                  11/83 DBC
         STC   R5,WTOBUF+L'WTOHEAD-1 STORE FOR "PUTWTO"       11/83 DBC
         #PUT  WTOBUF+L'WTOHEAD    DISPLAY THE MESSAGE        11/83 DBC
NO2NDMSG DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        CONSTRUCT THE THIRD SUMMARY MESSAGE.               * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   STATBUF3(14),=C'MAX ENTRY AGE ' TEXT           11/83 DBC
         LM    R5,R7,DYNAFIRS      DYNA-TABLE DESCRIPTOR      11/83 DBC
         USING DYNL,R5             DCL SLOT BASE              11/83 DBC
         ICM   R0,15,DYNLCLOK      ANY SLOTS USED?            11/83 DBC
         BZ    NO3RDMSG            NO, SKIP THIS MSG          11/83 DBC
MXAGESCN CL    R0,DYNLCLOK         YES, ALREADY GOT OLDEST    11/83 DBC
*                                  BIRTHDATE?                 11/83 DBC
         BNH   MXAGENXT            YES, SKIP                  11/83 DBC
         ICM   R1,15,DYNLCLOK      NO, GET OLDEST; EO-USED?   11/83 DBC
         BZ    MXAGEGOT            YES, DONE HERE             11/83 DBC
         LR    R0,R1               NO, COPY                   11/83 DBC
MXAGENXT BXLE  R5,R6,MXAGESCN      CONTINUE SCANNING          11/83 DBC
         DROP  R5                  RELEASE SLOT BASE          11/83 DBC
MXAGEGOT L     R1,CLOCK            GET CURRENT TIME           11/83 DBC
         SR    R1,R0               CNVRT BIRTHDATE TO AGE     11/83 DBC
         SRL   R1,CLOKSHFT         CNVRT TO SECONDS           11/83 DBC
         LA    R1,30(,R1)          ADD ROUNDER                11/83 DBC
         SR    R0,R0               CLEAR FOR DIVIDE           11/83 DBC
         D     R0,=F'60'           CNVRT TO MINUTES           11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   STATBUF3+14(*-*),0(R1) (EXECUTED)              11/83 DBC
         EX    R15,*-6             COPY TO MSG                11/83 DBC
         LA    R4,STATBUF3+15(R15) ADVANCE SCANNER            11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   0(30,R4),=C' MINUTES, MAX ENTRY IDLE TIME '    11/83 DBC
         LM    R5,R7,DYNAFIRS      DYNA-TABLE DESCRIPTOR      11/83 DBC
         USING DYNL,R5             DCL SLOT BASE              11/83 DBC
         L     R0,DYNLLRU#         PRINT LIMIT TESTER         11/83 DBC
MXIDLELP CL    R0,DYNLLRU#         ALREADY GOT MOST IDLE?     11/83 DBC
         BNH   MXIDLENX            YES, SKIP                  11/83 DBC
         ICM   R1,15,DYNLLRU#      NO, GET MOST IDLE; EO-USD? 11/83 DBC
         BZ    MXIDLEGO            YES, DONE HERE             11/83 DBC
         LR    R0,R1               NO, COPY                   11/83 DBC
MXIDLENX BXLE  R5,R6,MXIDLELP      CONTINUE SCANNING          11/83 DBC
         DROP  R5                  RELEASE SLOT BASE          11/83 DBC
MXIDLEGO L     R1,CLOCK            GET CURRENT TIME           11/83 DBC
         SR    R1,R0               CNVRT IDLE TIME TO INTERVA 11/83 DBC
         SRL   R1,CLOKSHFT         CNVRT TO SECONDS           11/83 DBC
         LA    R1,30(,R1)          ADD ROUNDER                11/83 DBC
         SR    R0,R0               CLEAR FOR DIVIDE           11/83 DBC
         D     R0,=F'60'           CNVRT TO MINUTES           11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   30(*-*,R4),0(R1)    (EXECUTED)                 11/83 DBC
         EX    R15,*-6             COPY TO MSG                11/83 DBC
         LA    R4,31(R15,R4)       ADVANCE SCANNER            11/83 DBC
         MVC   0(8,R4),=C' MINUTES' MORE TEXT                 11/83 DBC
         LA    R4,8(,R4)           ADVANCE SCANNER            11/83 DBC
         SPACE 1                                              11/83 DBC
         CL    R4,=A(STATBUF3+L'STATBUF3) BUFFER OVERFLOW?    11/83 DBC
         #DIE  H                   YES, DESIGN ERROR          11/83 DBC
         LA    R1,STATBUF3         NO, --> SO-BUFFER          11/83 DBC
         SR    R4,R1               GET L'MSG                  11/83 DBC
         STC   R4,STATBUF3-1       STORE FOR OUTPUT ROUTINES  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DISPLAY THE THIRD SUMMARY MESSAGE TO THE           * 11/83 DBC
*        OPERATORS.                                         * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         CH    R4,=Y(WTOMAXL-9)    TOO LONG?                  11/83 DBC
         BNH   STATLOK3            NO, PROCEED                11/83 DBC
         LA    R4,WTOMAXL-9        YES, RESET                 11/83 DBC
STATLOK3 MVC   WTOBUF+L'WTOHEAD(9),=C'DYNABLDL ' INSERT ID    11/83 DBC
         MVC   WTOBUF+L'WTOHEAD+9(WTOMAXL-9),STATBUF3 COPY    11/83 DBC
         LA    R4,9(,R4)           ADJ L'MSG                  11/83 DBC
         STC   R4,WTOBUF+L'WTOHEAD-1 STORE FOR "PUTWTO"       11/83 DBC
         #PUT  WTOBUF+L'WTOHEAD    DISPLAY THE MESSAGE        11/83 DBC
NO3RDMSG DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        ATTEMPT TO OPEN SYSPRINT AND WRITE TITLE AND       * 11/83 DBC
*        STATUS LINES.                                      * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         OPEN  (SYSPRINT,OUTPUT)   ATTEMPT THE OPEN           11/83 DBC
         TM    DCBOFLGS-IHADCB+SYSPRINT,DCBOFOPN OPENED?      11/83 DBC
         BZ    NOSYSP              NO, EXIT                   11/83 DBC
         SPACE 1                                              11/83 DBC
         #PUT  DYNATIT,SUBAD=PUTSYSP YES, SEND TITLE          11/83 DBC
         SPACE 1                                              11/83 DBC
         #PUT  NULL                SEND SPACER                11/83 DBC
         #PUT  STATBUF             SEND SUMMARY MESSAGE       11/83 DBC
         SPACE 1                                              11/83 DBC
         #PUT  STATBUF2            PRINT 2ND MSG, IF ANY      11/83 DBC
         SPACE 1                                              11/83 DBC
         #PUT  STATBUF3            PRINT 3RD MSG, IF ANY      11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DETERMINE THE LOCATION AND SIZE OF THE DYNAMIC     * 11/83 DBC
*        BLDL TABLE, AND THEN GETMAIN A LOCAL AREA THAT IS  * 11/83 DBC
*        LARGE ENOUGH TO HOLD THREE COPIES.                 * 05/84 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LM    R5,R7,DYNAFIRS      LOAD THE TABLE DESCRIPTOR  11/83 DBC
         LR    R1,R5               COPY SCANNER               11/83 DBC
SIZESCAN CLI   DENTNAME-DYNL(R1),0 EMPTY SLOT YET?            04/84 JLC
         BE    SIZEGOTN            YES, SIZE FOUND            11/83 DBC
         BXLE  R1,R6,SIZESCAN      NO, CONTINUE SCANNING      11/83 DBC
SIZEGOTN SR    R1,R5               EMPTY SLOT FOUND; GET      11/83 DBC
*                                  TABLE SIZE; EMPTY?         11/83 DBC
         BNP   EMPTY               YES, EXIT WITH MSG         11/83 DBC
         LR    R7,R1               NO, SAVE TABLE SIZE        11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R0,0(R1,R1)         DOUBLE IT                  11/83 DBC
         AR    R0,R1               TRIPLE IT                  11/83 DBC
         SPACE 1                                              11/83 DBC
         ST    R0,RTBLSIZE         SAVE FOR FREEMAIN          11/83 DBC
         GETMAIN R,LV=(0)          GET A LOCAL AREA           11/83 DBC
         ST    R1,RTBLPTR          SAVE FOR FREEMAIN          11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        NOW MAKE THE FIRST COPY OF THE ACTIVE TABLE, AND   * 11/83 DBC
*        DETERMINE POINTERS TO WHERE THE OTHER TWO COPIES   * 11/83 DBC
*        WILL GO.                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LR    R3,R1               SAVE 1ST COPY POINTER      11/83 DBC
         LR    R14,R5              --> COPY SOURCE            11/83 DBC
         LR    R15,R7              GET ITS LENGTH             11/83 DBC
         LR    R0,R3               --> COPY SINK              11/83 DBC
         LR    R1,R7               GET ITS LENGTH             11/83 DBC
         MVCL  R0,R14              MAKE THE 1ST COPY          11/83 DBC
         LR    R4,R0               SAVE SECOND COPY POINTER   11/83 DBC
         LA    R5,0(R7,R4)         GET 3RD COPY POINTER       11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SORT THE FIRST COPY OF THE DYNA-TABLE IN           * 11/83 DBC
*        DESCENDING ORDER BY HITS COUNT.                    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LR    R15,R7              GET L'LIST                 11/83 DBC
         LR    R0,R6               GET L'ENTRY                11/83 DBC
         LR    R1,R3               GET A(LIST)                11/83 DBC
         LA    R2,SORTHITS         --> COMPARE ROUTINE        11/83 DBC
         BAL   R14,SORT            SORT THE MOTHER            11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        CREATE AND SORT THE L.R.U. ORDERED LIST.           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LR    R14,R4              --> COPY SINK              11/83 DBC
         LR    R15,R7              GET L'SINK                 11/83 DBC
         LR    R0,R3               --> COPY SOURCE            11/83 DBC
         LR    R1,R7               GET L'COPY SOURCE          11/83 DBC
         MVCL  R14,R0              MAKE THE 2ND COPY          11/83 DBC
         SPACE 1                                              11/83 DBC
         LR    R15,R7              GET L'LIST                 11/83 DBC
         LR    R0,R6               GET L'ENTRY                11/83 DBC
         LR    R1,R4               GET A(LIST)                11/83 DBC
         LA    R2,SORTLRU          --> COMPARE ROUTINE        11/83 DBC
         BAL   R14,SORT            SORT THE LIST              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        CREATE AND SORT THE NAME ORDERED LIST.             * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LR    R14,R5              --> COPY SINK              11/83 DBC
         LR    R15,R7              GET L'SINK                 11/83 DBC
         LR    R0,R3               --> COPY SOURCE            11/83 DBC
         LR    R1,R7               GET L'COPY SOURCE          11/83 DBC
         MVCL  R14,R0              MAKE THE 3RD COPY          11/83 DBC
         SPACE 1                                              11/83 DBC
         LR    R15,R7              GET L'LIST                 11/83 DBC
         LR    R0,R6               GET L'ENTRY                11/83 DBC
         LR    R1,R5               GET A(LIST)                11/83 DBC
         LA    R2,SORTNAME         --> COMPARE ROUTINE        11/83 DBC
         BAL   R14,SORT            SORT THE LIST              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        PRINT THE TABLE TITLE LINES.                       * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         #PUT  NULL                SPACE                      11/83 DBC
         #PUT  NULL                SPACE                      11/83 DBC
         #PUT  SORTTIT             TITLE                      11/83 DBC
         #PUT  SORTTIT0            SUB-TITLE                  08/84 DBC
         #PUT  SORTSUBT            SUB-TITLE                  11/83 DBC
         #PUT  INFOBUF             BARRED SPACER              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SCAN THE THREE TABLES SIMULTANIOUSLY TO GENERATE   * 11/83 DBC
*        THE THREE REPORTS IN 3-COLUMN FORMAT.              * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R2,INFOBUF          --> MSG BUFFER             11/83 DBC
         USING INFO,R2             DECLARE A BASE FOR IT      11/83 DBC
         SPACE 1                                              11/83 DBC
         AR    R7,R3               --> PAST 1ST TABLE         11/83 DBC
         SR    R7,R6               --> LAST ENTRY (BXLE LIM)  11/83 DBC
         SPACE 1                                              11/83 DBC
INFOLOOP MVI   INFO,C' '           CLEAR THE -                11/83 DBC
         MVC   INFO+1(INFOLEN-1),INFO MESSAGE BUFFER          11/83 DBC
         MVI   NAMEBAR,C'|'        INSERT GUTTER              11/83 DBC
         MVI   HITSBAR,C'|'        INSERT GUTTER              11/83 DBC
         MVI   LRUBAR,C'|'         INSERT GUTTER              11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R1,1                GET INCRIMENT              11/83 DBC
         AH    R1,COUNTER          INCRIMENT LINE COUNTER     11/83 DBC
         STH   R1,COUNTER          STORE NEW VALUE            11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   COUNT,0(R1)         COPY TO MSG L-J            11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        FORMAT INFO FROM THE HITS SORTED TABLE.            * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         USING DYNL,R3             DCL TABLE ENTRY BASE       11/83 DBC
         MVC   HITSNAME,DENTNAME   MEMBER NAME                11/83 DBC
         SPACE 1                                              08/84 DBC
         MVI   HITSRENT,C' '       CLEAR RENT SIGNAL          08/84 DBC
         TM    PDS2ATR-PDS2+DENT,PDS2RENT REENTRANT MODULE?   08/84 DBC
         BZ    HINORENT            NO, SKIP                   08/84 DBC
         MVI   HITSRENT,C'*'       YES, SIGNAL THAT FACT      08/84 DBC
HINORENT DS    0H                                             08/84 DBC
         SPACE 1                                              11/83 DBC
         L     R1,CLOCK            CURRENT TIME (APPROX       11/83 DBC
*                                  SECONDS*1024)              11/83 DBC
         S     R1,DYNLLRU#         CNVRT TO INTERVAL          11/83 DBC
         SRL   R1,CLOKSHFT         CNVRT TO SECONDS           11/83 DBC
         LA    R1,30(,R1)          ADJUST FOR ROUNDING        11/83 DBC
         SR    R0,R0               CLEAR FOR DIVIDE           11/83 DBC
         D     R0,=F'60'           CNVRT TO MINUTES           11/83 DBC
         BAL   R14,ZONEIT          CNVRT MM TO EBCDIC         11/83 DBC
         MVC   HITSIDLE,ZONEBUF+L'ZONEBUF-L'HITSAGE COPY      11/83 DBC
         CLI   ZONEBUF+L'ZONEBUF-L'HITSIDLE-1,C' ' OVERFLOW?  11/83 DBC
         BE    HIFITS              NO, SKIP                   11/83 DBC
         MVC   HITSIDLE,=10C'*'    YES, "SAY SO"              11/83 DBC
HIFITS   DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,CLOCK            CURRENT TIME (APPROX       11/83 DBC
*                                  SECONDS*1024)              11/83 DBC
         S     R1,DYNLCLOK         CNVRT TO INTERVAL          11/83 DBC
         SRL   R1,CLOKSHFT         CNVRT TO SECONDS           11/83 DBC
         LA    R1,30(,R1)          ADJUST FOR ROUNDING        11/83 DBC
         SR    R0,R0               CLEAR FOR DIVIDE           11/83 DBC
         D     R0,=F'60'           CNVRT TO MINUTES           11/83 DBC
         BAL   R14,ZONEIT          CNVRT MM TO EBCDIC         11/83 DBC
         MVC   HITSAGE,ZONEBUF+L'ZONEBUF-L'HITSAGE COPY       11/83 DBC
         CLI   ZONEBUF+L'ZONEBUF-L'HITSAGE-1,C' ' OVERFLOW?   11/83 DBC
         BE    HAFITS              NO, SKIP                   11/83 DBC
         MVC   HITSAGE,=10C'*'     YES, "SAY SO"              11/83 DBC
HAFITS   DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,DYNLHITS         LOAD HITS COUNTER          11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   HITSHITS,ZONEBUF+L'ZONEBUF-L'HITSHITS COPY     11/83 DBC
         CLI   ZONEBUF+L'ZONEBUF-L'HITSHITS-1,C' ' OVERFLOW?  11/83 DBC
         BE    HHFITS              NO, PROCEED                11/83 DBC
         MVC   HITSHITS,=10C'*'    YES, SIGNAL THAT           11/83 DBC
HHFITS   DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
         DROP  R3                  RELEASE HITS TABLE ENT BAS 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        FORMAT INFO FROM THE L.R.U. SORTED TABLE.          * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         USING DYNL,R4             DCL TABLE ENTRY BASE       11/83 DBC
         MVC   LRUNAME,DENTNAME    MEMBER NAME                11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,CLOCK            CRNT TIME IN SECS*1024     11/83 DBC
         S     R1,DYNLLRU#         CNVRT TO IDLE INTERVAL     11/83 DBC
         SRL   R1,CLOKSHFT         CNVRT TO APPROX SECS       11/83 DBC
         LA    R1,30(,R1)          ADD ROUNDER                11/83 DBC
         SR    R0,R0               CLEAR FOR DIVIDE           11/83 DBC
         D     R0,=F'60'           CNVRT TO MINUTES           11/83 DBC
         BAL   R14,ZONEIT          CNVRT MM TO EBCDIC         11/83 DBC
         MVC   LRUIDLE,ZONEBUF+L'ZONEBUF-L'LRUIDLE  COPY      11/83 DBC
         CLI   ZONEBUF+L'ZONEBUF-L'LRUIDLE-1,C' ' OVERFLOW?   11/83 DBC
         BE    LUFITS              NO, PROCEED                11/83 DBC
         MVC   LRUIDLE,=10C'*'     YES, SAY SO                11/83 DBC
LUFITS   DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,DYNLHITS         LOAD HITS COUNTER          11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   LRUHITS,ZONEBUF+L'ZONEBUF-L'LRUHITS COPY       11/83 DBC
         CLI   ZONEBUF+L'ZONEBUF-L'LRUHITS-1,C' ' OVERFLOW?   11/83 DBC
         BE    LHFITS              NO, PROCEED                11/83 DBC
         MVC   LRUHITS,=10C'*'     YES, SIGNAL THAT           11/83 DBC
LHFITS   DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
         DROP  R4                  RELEASE DURA TABLE ENT BAS 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        FORMAT INFO FROM THE NAMES SORTED TABLE.           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         USING DYNL,R5             DCL TABLE ENTRY BASE       11/83 DBC
         MVC   NAMENAME,DENTNAME   MEMBER NAME                11/83 DBC
         SPACE 1                                              11/83 DBC
         SR    R1,R1               CLEAR FOR INSERT           11/83 DBC
         IC    R1,DENTCNCT         GET LIB#                   11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   NAMELIB#,0(R1)      COPY TO MSG                11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,DYNLHITS         LOAD HITS COUNTER          11/83 DBC
         BAL   R14,ZONEIT          CNVRT TO EBCDIC            11/83 DBC
         MVC   NAMEHITS,ZONEBUF+L'ZONEBUF-L'NAMEHITS COPY     11/83 DBC
         CLI   ZONEBUF+L'ZONEBUF-L'NAMEHITS-1,C' ' OVERFLOW?  11/83 DBC
         BE    NHFITS              NO, PROCEED                11/83 DBC
         MVC   NAMEHITS,=10C'*'    YES, SIGNAL THAT           11/83 DBC
NHFITS   DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
         DROP  R5                  RELEASE NAME TABLE ENT BAS 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DISPLAY THE MESSAGE AND THEN LOOP FOR THE NEXT     * 11/83 DBC
*        ENTRIES.                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         #PUT  INFOBUF             DISPLAY THE MSG            11/83 DBC
         SPACE 1                                              11/83 DBC
         AR    R4,R6               ADVANCE 2ND TABLE SCANNER  11/83 DBC
         AR    R5,R6               ADVANCE 3RD TABLE SCANNER  11/83 DBC
         BXLE  R3,R6,INFOLOOP      ADVANCE 1ST TBL SCNR & LOO 11/83 DBC
         DROP  R2                  RELEASE MSG BUFFER BASE    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DONE. FREEMAIN AND EXIT.                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LM    R0,R1,RTBLSIZE      LOAD REPORT AREA DESCRIPTR 11/83 DBC
         FREEMAIN R,LV=(0),A=(1)   FREE IT                    11/83 DBC
         SPACE 1                                              11/83 DBC
         SR    R1,R1               SINGAL NO TERMINATION MSG  11/83 DBC
         B     EXIT0               GO EXIT                    11/83 DBC
         DROP  TABLBASE            RELEASE CONTROL TABLE BASE 11/83 DBC
         TITLE 'VARIOUS TERMINATION SETUPS'                   11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        THE FOLLOWING ARE VARIOUS TERMINATION SETUP        * 11/83 DBC
*        ROUTINES.                                          * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 3                                              11/83 DBC
BADSTRUC BAL   R1,EXIT16                                      11/83 DBC
         DC    AL1(L'MBADSTRU)                                11/83 DBC
MBADSTRU DC    C'DYNABLDL CANNOT FIND THE PROPER HOOK POINTS IN THE VER*
               SION OF IGC018 INSTALLED ON THIS SYSTEM'       11/83 DBC
         SPACE 3                                              11/83 DBC
DONEB4   BAL   R1,EXIT4                                       11/83 DBC
         DC    AL1(L'MDONEB4)                                 11/83 DBC
MDONEB4  DC    C'DYNABLDL IS ALREADY ACTIVE'                  11/83 DBC
         SPACE 3                                              11/83 DBC
MESS     BAL   R1,EXIT8                                       11/83 DBC
         DC    AL1(L'MMESS)                                   11/83 DBC
MMESS    DC    C'DYNABLDL IS ALREADY PARTIALLY ACTIVE - IT MUST BE STOP*
               PED AND THEN STARTED'                          11/83 DBC
         SPACE 3                                              11/83 DBC
STOPDB4  BAL   R1,EXIT0                                       11/83 DBC
         DC    AL1(L'MSTOPDB4)                                11/83 DBC
MSTOPDB4 DC    C'DYNABLDL IS ALREADY STOPPED'                 11/83 DBC
         SPACE 3                                              11/83 DBC
DOWN     BAL   R1,EXIT8                                       11/83 DBC
         DC    AL1(L'MDOWN)                                   11/83 DBC
MDOWN    DC    C'DYNABLDL IS NOT ACTIVE'                      11/83 DBC
         SPACE 3                                              11/83 DBC
UNRECOGN BAL   R1,EXIT16                                      11/83 DBC
         DC    AL1(L'MUNRECOG)                                11/83 DBC
MUNRECOG DC    C'DYNABLDL IS UNABLE TO RECOGNIZE THE VERSION OF IGC018 *
               INSTALLED ON THIS SYSTEM'                      11/83 DBC
         SPACE 3                                              11/83 DBC
INVALID  BAL   R1,EXIT16                                      11/83 DBC
         DC    AL1(L'MINVALID)                                11/83 DBC
MINVALID DC    C'DYNABLDL PARM FIELD IS INVALID - ONLY START, STOP, OR *
               REPORT MAY BE SPECIFIED'                       11/83 DBC
         SPACE 3                                              11/83 DBC
STARTED  BAL   R1,EXIT0                                       11/83 DBC
         DC    AL1(L'MSTARTED)                                11/83 DBC
MSTARTED DC    C'DYNABLDL STARTED'                            11/83 DBC
         SPACE 3                                              11/83 DBC
STOPPED  BAL   R1,EXIT0                                       11/83 DBC
         DC    AL1(L'MSTOPPED)                                11/83 DBC
MSTOPPED DC    C'DYNABLDL STOPPED'                            11/83 DBC
         SPACE 3                                              11/83 DBC
PARTSTOP BAL   R1,EXIT4                                       11/83 DBC
         DC    AL1(L'MPARTSTO)                                11/83 DBC
MPARTSTO DC    C'DYNABLDL STOPPED BUT THE DYNAMIC BLDL TABLE COULD NOT *
               BE FREED'                                      11/83 DBC
         SPACE 3                                              11/83 DBC
EMPTY    BAL   R1,EXIT0                                       11/83 DBC
         DC    AL1(L'MEMPTY)                                  11/83 DBC
MEMPTY   DC    C'DYNABLDL TABLE IS EMPTY'                     11/83 DBC
         SPACE 3                                              11/83 DBC
NOSYSP   SR    R1,R1               SIGNAL NO MESSAGE          11/83 DBC
         B     EXIT4               EXIT                       11/83 DBC
         TITLE 'TERMINATION'                                  11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        CLEAN UP AND EXIT PROCESSING                       * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
************************************************************* 11/83 DBC
*        COMPLETION CODE VECTOR                             * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
EXIT16   BAL   R0,EXIT             COMPLETION 16              11/83 DBC
EXIT12   BAL   R0,EXIT             COMPLETION 12              11/83 DBC
EXIT8    BAL   R0,EXIT             COMPLETION 8               11/83 DBC
EXIT4    BAL   R0,EXIT             COMPLETION 4               11/83 DBC
EXIT0    BAL   R0,EXIT             COMPLETION 0               11/83 DBC
EXIT     LA    R15,EXIT            LOAD VECTOR BASE           11/83 DBC
         SR    R15,R0              CNVRT TO COMPLETION CPODE  11/83 DBC
         LA    R15,0(,R15)         PURIFY                     11/83 DBC
         CH    R15,RCD             HIGHEST PRODUCED?          11/83 DBC
         BNH   RCDZ                NO, KEEP HIGHER VALUE      11/83 DBC
         STH   R15,RCD             YES, STORE NEW HIGH        11/83 DBC
RCDZ     DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        IF SYSPRINT IS OPENED, THEN WRITE A COMPLETION     * 11/83 DBC
*        MESSAGE, IF ANY, TO IT, AND THEN CLOSE IT.         * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         TM    DCBOFLGS-IHADCB+SYSPRINT,DCBOFOPN IS IT OPEN?  11/83 DBC
         BZ    NOPRT               NO, SKIP                   11/83 DBC
         LTR   R2,R1               YES, IS THERE A            11/83 DBC
*                                  TERMINATION MESSAGE?       11/83 DBC
         BZ    NOPRTMSG            NO, SKIP                   11/83 DBC
         #PUT  NULL,SUBAD=PUTSYSP  YES, SPACE A LINE          11/83 DBC
         #PUT  NULL                SPACE ANOTHER LINE         11/83 DBC
         #PUT  (R2)                PRINT THE MESSAGE          11/83 DBC
NOPRTMSG DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
         CLOSE SYSPRINT            CLOSE THE FILE             11/83 DBC
         FREEPOOL SYSPRINT         FREE ITS BUFFERS           11/83 DBC
         LR    R1,R2               RESTORE MSG PTR            11/83 DBC
NOPRT    DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        WRITE A COMPLETION MESSAGE, IF ANY, TO THE         * 11/83 DBC
*        OPERATORS.                                         * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LTR   R1,R1               IS THERE A FINAL MSG?      11/83 DBC
         BZ    MSGZ                NO, SKIP                   11/83 DBC
         #PUT  (R1),SUBAD=PUTWTO   YES, WRITE IT              11/83 DBC
MSGZ     DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RETURN TO PROBLEM MODE.                            * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         TM    FLAG,SUPER          IN SUPERVISOR STATE?       11/83 DBC
         BZ    SUPERZ              NO, SKIP                   11/83 DBC
         NI    FLAG,255-SUPER      YES, CLEAR AUDIT           11/83 DBC
         MODESET MODE=PROB         RESUME PROBLEM MODE        11/83 DBC
SUPERZ   DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DE-SERIALIZE                                       * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         TM    FLAG,ENQED          SERIALIZED?                11/83 DBC
         BZ    ENQEDZ              NO, SKIP                   11/83 DBC
         NI    FLAG,255-ENQED      YES, CLEAR AUDIT           11/83 DBC
         DEQ   MF=(E,SERIALIZ)     DEQ                        11/83 DBC
ENQEDZ   DS    0H                                             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RESTORE REGS AND RETURN TO CALLER                  * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LH    R15,RCD             LOAD COMPLETION CODE       11/83 DBC
         #EXIT ((R14,R12)),RC=(R15) EXIT TO CALLER            11/83 DBC
         TITLE 'PUTSYSP -- SEND MESSAGES TO A PRINT FILE'     11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        PUTSYSP -- THIS ROUTINE SEND MESSAGES TO A PRINT   * 11/83 DBC
*        FILE. ALL RECFMS ARE SUPPORTED.                    * 11/83 DBC
*                                                           * 11/83 DBC
*        INPUTS:                                            * 11/83 DBC
*              - R1 POINTS TO A MESSAGE BLOCK.              * 11/83 DBC
*              - R14 POINTS TO THE RETURN ADDRESS.          * 11/83 DBC
*                                                           * 11/83 DBC
*        RETURN 0(,R14):                                    * 11/83 DBC
*              - IF THE SYSPRINT FILE IS OPEN, AND IF THE   * 11/83 DBC
*                GIVEN MESSAGE IS NON-NULL, THEN THE        * 11/83 DBC
*                MESSAGE IS WRITTEN TO SYSPRINT.            * 11/83 DBC
*              - ALL REGISTERS ARE RESTORED.                * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PUTSYSP  TM    DCBOFLGS-IHADCB+SYSPRINT,DCBOFOPN SYSPRINT     11/83 DBC
*                                  AVAILABLE?                 11/83 DBC
         BZR   R14                 NO, RETURN DOING NOTHING   11/83 DBC
         STM   R14,R2,SAVEPUTS     YES, SAVE REGISTERS        11/83 DBC
         SPACE 1                                              11/83 DBC
         SR    R2,R2               CLEAR FOR INSERT           11/83 DBC
         ICM   R2,1,0(R1)          GET L'MSG; NULL?           11/83 DBC
         BZ    PUTSRET             YES, RETURN DOING NOTHING  11/83 DBC
         SPACE 1                                              11/83 DBC
         TM    DCBRECFM-IHADCB+SYSPRINT,DCBRECU NO, RECFM=U?  11/83 DBC
         BNM   PUTRECU             YES, GO HANDLE             11/83 DBC
         TM    DCBRECFM-IHADCB+SYSPRINT,DCBRECF NO, RECFM=F?  11/83 DBC
         BO    PUTRECF             YES, GO HANDLE             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RECFM=V HANDLER                                    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PUTRECV  LA    R0,4(,R2)           GET NEEDED LRECL           11/83 DBC
         STH   R0,DCBLRECL-IHADCB+SYSPRINT STORE FOR PUT      11/83 DBC
*                                  LOCATE                     11/83 DBC
         PUT   SYSPRINT            GET NEXT RECORD SLOT       11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R0,4(,R2)           GET REC LEN AGAIN          11/83 DBC
         SLL   R0,16               SHIFT                      11/83 DBC
         ST    R0,0(,R1)           STORE RDW                  11/83 DBC
         L     R15,SAVEPUTS+12     --> MESSAGE                11/83 DBC
         BCTR  R2,0                ADJ L'MSG FOR 'EX'         11/83 DBC
         MVC   4(*-*,R1),1(R15)    (EXECUTED)                 11/83 DBC
         EX    R2,*-6              COPY MSG TO BUFFER         11/83 DBC
         B     PUTSRET             DONE HERE                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RECFM=F HANDLER                                    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PUTRECF  PUT   SYSPRINT            GET NEXT RECORD SLOT       11/83 DBC
         LR    R0,R1               --> COPY SINK              11/83 DBC
         LH    R1,DCBLRECL-IHADCB+SYSPRINT GET L'SINK         11/83 DBC
         L     R14,SAVEPUTS+12     --> MSG BLOCK              11/83 DBC
         LA    R14,1(,R14)         --> COPY SOURCE            11/83 DBC
         LR    R15,R2              GET L'SOURCE               11/83 DBC
         ICM   R15,8,=C' '         GET PADDING BYTE           11/83 DBC
         MVCL  R0,R14              COPY MSG TO BUFFER         11/83 DBC
         B     PUTSRET             DONE HERE                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RECFM=U HANDLER                                    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PUTRECU  STH   R2,DCBLRECL-IHADCB+SYSPRINT STORE FOR PUT      11/83 DBC
*                                  LOCATE                     11/83 DBC
         PUT   SYSPRINT            GET NEXT RECORD SLOT       11/83 DBC
         L     R15,SAVEPUTS+12     --> MSG BLOCK              11/83 DBC
         BCTR  R2,0                ADJ L'MSG FOR 'EX'         11/83 DBC
         MVC   0(*-*,R1),1(R15)    (EXECUTED)                 11/83 DBC
         EX    R2,*-6              COPY MSG TO BUFFER         11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RETURN TO CALLER                                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PUTSRET  LM    R14,R2,SAVEPUTS     RESTORE REGISTERS          11/83 DBC
         BR    R14                 RETURN                     11/83 DBC
         TITLE 'PUTWTO -- ISSUE MESSAGES TO THE OPERATORS'    11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        PUTWTO -- THIS ROUTINE ISSUES MESSAGES TO THE      * 11/83 DBC
*        OPERATORS.                                         * 11/83 DBC
*                                                           * 11/83 DBC
*        ROUTE CODES USED:                                  * 11/83 DBC
*              - 2 IS "MASTER CONSOLE INFORMATION"          * 11/83 DBC
*              - 11 IS "PROGRAMMER INFORMATION"             * 11/83 DBC
*                                                           * 11/83 DBC
*        DESCRIPTOR CODES USED:                             * 11/83 DBC
*              - 4 IS "SYSTEM STATUS"                       * 11/83 DBC
*                                                           * 11/83 DBC
*        INPUTS:                                            * 11/83 DBC
*              - R1 POINTS TO A MESSAGE BLOCK.              * 11/83 DBC
*              - R14 POINTS TO A RETURN ADDRESS.            * 11/83 DBC
*                                                           * 11/83 DBC
*        RETURN 0(,R14):                                    * 11/83 DBC
*              - THE MESSAGE, IF NON-NULL, HAS BEEN ISSUED. * 11/83 DBC
*              - ALL REGISTERS ARE RESTORED.                * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PUTWTO   STM   R14,R1,SAVEPUTW     SAVE REGISTERS             11/83 DBC
         SPACE 1                                              11/83 DBC
         SR    R15,R15             CLEAR FOR INSERT           11/83 DBC
         ICM   R15,1,0(R1)         GET L'MSG; NULL?           11/83 DBC
         BZ    PUTWRET             YES, RETURN TO CALLER      11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   WTOBUF(L'WTOHEAD),WTOHEAD COPY HEADER FIELDS   11/83 DBC
         SPACE 1                                              11/83 DBC
         CH    R15,=Y(WTOMAXL)     NO, TOO LONG?              11/83 DBC
         BNH   PUTWLNOK            NO, PROCEED                11/83 DBC
         LA    R15,WTOMAXL         YES, TRUNCATE              11/83 DBC
PUTWLNOK DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
         BCTR  R15,0               ADJ FOR "EX"               11/83 DBC
         MVC   WTOBUF+L'WTOHEAD(*-*),1(R1) (EXECUTED)         11/83 DBC
         EX    R15,*-6             COPY MSG TO WTO BUFFER     11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R15,L'WTOHEAD+1(,R15) GET L'MSG+4              11/83 DBC
         STH   R15,WTOBUF          STORE INTO PLIST           11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R15,WTOBUF(R15)     --> PAST THE TEXT          11/83 DBC
         MVC   0(L'WTOTAIL,R15),WTOTAIL COPY TRAILER FIELDS   11/83 DBC
         SPACE 1                                              11/83 DBC
         WTO   MF=(E,WTOBUF)       ISSUE THE MSG              11/83 DBC
         SPACE 1                                              11/83 DBC
PUTWRET  LM    R14,R1,SAVEPUTW     RESTORE REGISTERS          11/83 DBC
         BR    R14                 RETURN TO CALLER           11/83 DBC
         TITLE 'SORT -- AN INPLACE-SORTING ROUTINE'           11/83 DBC
SORT     #SORT CMPRID=(R2),SVID=SAVESORT                      11/83 DBC
         TITLE 'SORTHITS/SORTLRU/SORTNAME -- VARIOUS SORTING COMPARISON*
                ROUTINES'                                     11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        SORTHITS -- THIS COMPARISON ROUTINE SORTS DYNAMIC  * 11/83 DBC
*        BLDL TABLE ENTRIES IN DESCENDING ORDER BY HITS     * 11/83 DBC
*        COUNT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
*        SORTLRU -- THIS COMPARISON ROUTINE SORTS DYNAMIC   * 11/83 DBC
*        BLDL TABLE ENTRIES IN L.R.U. ORDER - MOST TO LEAST * 11/83 DBC
*        RECENTLY USED.                                     * 11/83 DBC
*                                                           * 11/83 DBC
*        SORTNAME -- THIS COMPARISON ROUTINE SORTS DYNAMIC  * 11/83 DBC
*        BLDL TABLE ENTRIES IN ASCENDING ORDER BY MEMBER    * 11/83 DBC
*        NAME.                                              * 11/83 DBC
*                                                           * 11/83 DBC
*        INPUTS:                                            * 11/83 DBC
*              - R6 POINTS TO A SEQUENTIALLY PRIOR TABLE    * 11/83 DBC
*                ENTRY.                                     * 11/83 DBC
*              - R7 POINTS TO A SEQUENTIALLY FOLLOWING      * 11/83 DBC
*                TABLE ENTRY.                               * 11/83 DBC
*              - R14 POINTS TO THE RETURN ADDRESS IN THE    * 11/83 DBC
*                SORT ROUTINE.                              * 11/83 DBC
*                                                           * 11/83 DBC
*        RETURN 0(,R14):                                    * 11/83 DBC
*              - THE TWO ENTRIES ARE SUITABLY COMPARED AND  * 11/83 DBC
*                THE CONDITION CODE IS SET AS FOLLOWS:      * 11/83 DBC
*                - CC=2 (I.E. IMPLIES "HIGH") INDICATES     * 11/83 DBC
*                  THAT THE SORT ROUTINE MUST EXCHANGE THE  * 11/83 DBC
*                  TWO TABLE ENTRIES.                       * 11/83 DBC
*                - CC=0 OR 1 (I.E. IMPLIES "EQUAL" OR       * 11/83 DBC
*                  "LOW") INDICATES THAT THE SORT ROUTINE   * 11/83 DBC
*                  MUST NOT EXCHANGE THE TWO TABLE ENTRIES. * 11/83 DBC
*              - ALL REGISTERS REMAIN UNCHANGED.            * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 3                                              11/83 DBC
SORTHITS CLC   DYNLHITS-DYNL(,R7),DYNLHITS-DYNL(R6)           11/83 DBC
         BNER  R14                                            11/83 DBC
         CLC   DYNLLRU#-DYNL(,R7),DYNLLRU#-DYNL(R6)           11/83 DBC
         BR    R14                                            11/83 DBC
         SPACE 3                                              11/83 DBC
SORTLRU  CLC   DYNLLRU#-DYNL(,R7),DYNLLRU#-DYNL(R6)           11/83 DBC
         BR    R14                                            11/83 DBC
         SPACE 3                                              11/83 DBC
SORTNAME CLC   DENTNAME-DYNL(,R6),DENTNAME-DYNL(R7)           11/83 DBC
         BR    R14                                            11/83 DBC
         TITLE 'VERIFY -- CODE MATCH VERIFICATION ROUTINE'    11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        VERIFY -- THIS ROUTINE CHECKS A SECTION OF IGC018  * 11/83 DBC
*        TO SEE IF ITS CONTENTS ARE AS EXPECTED.            * 11/83 DBC
*                                                           * 11/83 DBC
*        INPUTS:                                            * 11/83 DBC
*              - R1 POINTS TO A PLIST MAPPED BY THE         * 11/83 DBC
*                "ORIGINAL" DSECT. THIS IDENTIFIES A        * 11/83 DBC
*                LOCATION OF IGC018 AND ITS EXPECTED        * 11/83 DBC
*                CONTENTS.                                  * 11/83 DBC
*              - BLDLBASE POINTS TO IGC018.                 * 11/83 DBC
*              - R14 POINTS TO A RETURN ADDRESS.            * 11/83 DBC
*                                                           * 11/83 DBC
*        RETURN 0(,R14):                                    * 11/83 DBC
*              - ERROR: THE CONTENTS OF IGC018 ARE NOT AS   * 11/83 DBC
*                EXPECTED.                                  * 11/83 DBC
*              - R14: THE HI-BITS MAY BE CHANGED.           * 11/83 DBC
*              - ALL OTHER REGISTERS ARE UNCHANGED.         * 11/83 DBC
*                                                           * 11/83 DBC
*        RETURN 4(,R14):                                    * 11/83 DBC
*              - THE CONTENTS OF IGC018 ARE AS EXPECTED.    * 11/83 DBC
*              - R14 IS INCRIMENTED BY 4.                   * 11/83 DBC
*              - ALL OTHER REGISTERS ARE UNCHANGED.         * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         USING ORIGINAL,R1         DCL PLIST BASE             11/83 DBC
VERIFY   STM   R14,R15,SAVEVERI    SAVE REGISTERS             11/83 DBC
         LH    R15,ORIGLOC         GET OFFSET INTO IGC018     11/83 DBC
         LA    R15,IGC018(R15)     GET LOCATION INTO IGC018   11/83 DBC
         LH    R14,ORIGLEN         GET LENGTH TO CHECK        11/83 DBC
         BCTR  R14,0               ADJ FOR "EX-CLC"           11/83 DBC
         CLC   0(*-*,R15),ORIGCODE (EXECUTED)                 11/83 DBC
         EX    R14,*-6             IS IGC018 AS EXPECTED?     11/83 DBC
         BNE   VERIRET0            NO, RETURN +0              11/83 DBC
*                                  YES, RETURN +4             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RETURN TO CALLER                                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         BAL   R15,VERIRET         +4 IGC018 IS AS EXPECTED   11/83 DBC
VERIRET0 BAL   R15,VERIRET         +0 IGC018 IS NOT CORRECT   11/83 DBC
VERIRET  LA    R14,VERIRET         LOAD VECTOR BASE           11/83 DBC
         SR    R14,R15             GET RETURN OFFSET          11/83 DBC
         A     R14,SAVEVERI        GET RETURN ADDRESS         11/83 DBC
         L     R15,SAVEVERI+4      RESTORE REGISTER           11/83 DBC
         BR    R14                 RETURN TO CALLER           11/83 DBC
         DROP  R1                  RELEASE PLIST BASE         11/83 DBC
         TITLE 'ZONEIT -- BINARY TO EBCDIC CONVERSION'        11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        ZONEIT -- THIS ROUTINE CONVERTS A BINARY NUMBER TO * 11/83 DBC
*        A CHARACTER STRING THAT IS SUFFICIENTLY PADDED ON  * 11/83 DBC
*        BOTH THE LEFT AND RIGHT WITH BLANKS. IF THE NUMBER * 11/83 DBC
*        IS NEGATIVE, THEN THE STRING IS PREFIXED WITH A    * 11/83 DBC
*        MINUS SIGN (-).                                    * 11/83 DBC
*                                                           * 11/83 DBC
*        INPUTS:                                            * 11/83 DBC
*              - R1 CONTAINS THE NUMBER TO BE CONVERTED.    * 11/83 DBC
*              - R14 POINTS TO THE RETURN ADDRESS.          * 11/83 DBC
*                                                           * 11/83 DBC
*        RETURN 0(,R14):                                    * 11/83 DBC
*              - THE NUMBER HAS BEEN CONVERTED AS DESCRIBED * 11/83 DBC
*                ABOVE.                                     * 11/83 DBC
*              - ZONEBUF CONTAINS THE CHARACTER STRING      * 11/83 DBC
*                RIGHT JUSTIFIED AND LEFT PADDED WITH       * 11/83 DBC
*                BLANKS. ALSO, ZONEBUF IS TRAILED BLANKS.   * 11/83 DBC
*              - R1 POINTS TO THE START OF THE CHARACTER    * 11/83 DBC
*                STRING.                                    * 11/83 DBC
*              - R15 CONTAINS THE LENGTH-1 OF THE CHARACTER * 11/83 DBC
*                STRING.                                    * 11/83 DBC
*              - ALL OTHER REGISTERS ARE UNCHANGED.         * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
ZONEIT   CVD   R1,DWORK            CNVRT TO DECIMAL           11/83 DBC
         MVI   ZONEBUF-1,C' '      LOAD LEFT PADDING BYTE     11/83 DBC
         MVI   ZONEBUF,X'20'       LOAD EDIT CONTROL BYTE     11/83 DBC
         MVC   ZONEBUF+1(L'ZONEBUF-1),ZONEBUF PROPAGATE IT    11/83 DBC
         EDMK  ZONEBUF-1(L'ZONEBUF+1),DWORK CNVRT TO EBCDIC   11/83 DBC
         BNZ   ZNOTZERO            JUMP IF VALUE WAS NOT 0    11/83 DBC
         MVI   ZONEBUF+L'ZONEBUF-1,C'0' (WAS 0; STICK IT IN)  11/83 DBC
         LA    R1,ZONEBUF+L'ZONEBUF-1 (SET STRING PTR)        11/83 DBC
ZNOTZERO BNM   ZNOTNEG             WASN'T NEGATIVE, SKIP      11/83 DBC
         BCTR  R1,0                WAS NEG; BACK UP           11/83 DBC
         MVI   0(R1),C'-'          INSERT SIGN                11/83 DBC
ZNOTNEG  DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R15,ZONEBUF+L'ZONEBUF-1 --> TO LAST CHARACTER  11/83 DBC
         SR    R15,R1              GET L'STRING-1             11/83 DBC
         SPACE 1                                              11/83 DBC
         BR    R14                 RETURN TO CALLER           11/83 DBC
         TITLE 'DATA'                                         11/83 DBC
         DROP  ,                   RELEASE ALL BASES          11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        VERSIONS VECTOR                                    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
VERSIONS DC    A(VERSN#01)                                    11/83 DBC
         DC    A(VERSN#02)                                    11/83 DBC
         DC    A(VERSN#03)                                    11/83 DBC
         DC    A(VERSN#04)                                    11/83 DBC
         DC    A(VERSN#05)                                    04/84 JLC
         DC    A(VERSN#06)                                    05/84 DBC
         DC    A(VERSN#07)                                    08/84 DBC
         DC    A(VERSN#08)                                    06/84 WRH
         DC    A(VERSN#09)                                    09/84 DBC
         DC    A(VERSN#10)                                    01/85 DBC
         DC    A(VERSN#11)                                    10/85 DBC
         DC    A(VERSN#12)                                    10/85 DBC
         DC    A(VERSN#13)                                    01/88 SBG
         DC    A(0)                                           11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        LOCAL SOUBROUTINE SAVE AREAS                       * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SAVEPUTS DC    5A(0)               PUTSYSP                    11/83 DBC
SAVEPUTW DC    4A(0)               PUTWTO                     11/83 DBC
SAVESORT DC    16A(0)              SORT                       11/83 DBC
SAVEVERI DC    2A(0)               VERIFY                     11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        PARM FIELD ANALYSIS CONTROL DATA                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PARMS    DS    0X                  START OF TABLE (SORTED)    11/83 DBC
         DC    AL4(START),AL2(0)                              11/83 DBC
         DC    AL4(STOP),AL2(1),C'P'                          11/83 DBC
         DC    AL4(REPORT),AL2(1),C'R'                        11/83 DBC
         DC    AL4(START),AL2(1),C'S'                         11/83 DBC
         DC    AL4(STOP),AL2(4),C'STOP'                       11/83 DBC
         DC    AL4(START),AL2(5),C'START'                     11/83 DBC
         DC    AL4(REPORT),AL2(6),C'REPORT'                   11/83 DBC
         DC    AL4(INVALID),X'FF'                             11/83 DBC
         SPACE 1                                              11/83 DBC
PRMHNDLR EQU   0,4                 A(HANDLER ROUTINE)         11/83 DBC
PRMLEN   EQU   PRMHNDLR+L'PRMHNDLR,2 L'TEXT                   11/83 DBC
PRMTEXT  EQU   PRMLEN+L'PRMLEN     TEXT                       11/83 DBC
PRMROOTL EQU   PRMTEXT             ENTRY'S ROOT LENGTH        11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SERIALIZATION ENQ CONTROL DATA                     * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SERIALIZ ENQ   (QNAME,RNAME,E,L'RNAME,SYSTEM),RET=NONE,MF=L   11/83 DBC
QNAME    DC    CL8'DYNABLDL'                                  11/83 DBC
RNAME    DC    C'SERIALIZE'                                   11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        WTO MESSAGE BUFFER AND CONTROLS                    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
WTOFLDS  WTO   ' ',ROUTCDE=(2,11),DESC=4,MF=L SKELETON        11/83 DBC
WTOHEAD  EQU   WTOFLDS,4           HEADER FIELDS              11/83 DBC
WTOTAIL  EQU   WTOHEAD+L'WTOHEAD+1,*-(WTOHEAD+L'WTOHEAD+1)    11/83 DBC
*                                  TRAILER FIELDS             11/83 DBC
WTOMAXL  EQU   124                 MAX WTO TEXT LENGTH        11/83 DBC
         SPACE 1                                              11/83 DBC
         DS    0F                  ALIGNMENT                  11/83 DBC
WTOBUF   DC    XL(L'WTOHEAD+WTOMAXL+L'WTOTAIL)'00' BUFFER     11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SYSPRINT CONTROL DATA                              * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         PRINT NOGEN                                          11/83 DBC
SYSPRINT DCB   DDNAME=SYSPRINT,                               11/83 DBC*
               DSORG=PS,                                      11/83 DBC*
               MACRF=PL,                                      11/83 DBC*
               OPTCD=C,                                       11/83 DBC*
               BUFNO=5,                                       11/83 DBC*
               EXLST=PRTXLIST                                 11/83 DBC
         PRINT GEN                                            11/83 DBC
         SPACE 1                                              11/83 DBC
PRTXLIST DS    0F                  DCB EXIT LIST              11/83 DBC
         DC    X'85',AL3(PRTEXIT)  DCB OPEN EXIT              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        HOOK SKELETONS                                     * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         CNOP  0,4                 ALIGNMENT                  11/83 DBC
SRCHPOHH BALR  R15,0               LOAD TEMP BASE             11/83 DBC
         L     R15,SRCHPOAA-*(,R15) --> HOOK ROUTINE          11/83 DBC
         BR    R15                 JUMP TO HOOK ROUTINE       11/83 DBC
SRCHPOAA DC    AL4(SRCHPDS-SRCHPDS) --> HOOK ROUTINE          11/83 DBC
SRCHPOHL EQU   *-SRCHPOHH          L'HOOK                     11/83 DBC
         SPACE 3                                              11/83 DBC
         CNOP  0,4                 ALIGNMENT                  11/83 DBC
DFOUNDHH BALR  R15,0               LOAD TEMP BASE             11/83 DBC
         L     R15,DFOUNDAA-*(,R15) --> HOOK ROUTINE          11/83 DBC
         BR    R15                 JUMP TO HOOK ROUTINE       11/83 DBC
         DC    CL8'DAVECOLE'       HOOK RECOGNITION STRING    11/83 DBC
DFOUNDAA DC    AL4(DFOUND-DFOUND)  --> HOOK ROUTINE           11/83 DBC
DFOUNDHL EQU   *-DFOUNDHH          L'HOOK                     11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        HOOK RETURN CONTROL DATA                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SRCHPOXX DS    S                   BASE/DISPLACEMENT FOR      11/83 DBC
*                                  RETURN FROM SRCHPDS HOOK   11/83 DBC
DFOUNDXX DS    S                   BASE/DISPLACEMENT FOR      11/83 DBC
*                                  RETURN FROM DFOUND HOOK    11/83 DBC
         SPACE 1                                              11/83 DBC
SRCHPOBC B     SRCHPOXX-SRCHPOXX   RETURN TO IGC018 FROM      11/83 DBC
         @ZAP  (SRCHPOXX,-2)       SRCHPDS HOOK               11/83 DBC
         SPACE 1                                              11/83 DBC
DFOUNDBC B     DFOUNDXX-DFOUNDXX   RETURN TO IGC018 FROM      11/83 DBC
         @ZAP  (DFOUNDXX,-2)       DFOUND HOOK                11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        MISC DATA                                          * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DWORK    DS    D                   DWORD WORK AREA            11/83 DBC
CLOCK    DS    2F                  STCK BUFFER                11/83 DBC
         SPACE 1                                              11/83 DBC
RTBLSIZE DC    A(0)              | REPORTS TABLE SIZE         11/83 DBC
RTBLPTR  DC    A(0)              V REPORTS TABLE ADDRESS      11/83 DBC
         SPACE 1                                              11/83 DBC
COUNTER  DC    H'0'                REPORT LINES COUNTER       11/83 DBC
RCD      DC    H'0'                PROGRAM COMPLETION CODE    11/83 DBC
         SPACE 1                                              11/83 DBC
         DC    C' '                LEFT-PADDING BLANK         11/83 DBC
ZONEBUF  DS    CL(8*2-1)           EDMK SINK                  11/83 DBC
         DC    CL(L'ZONEBUF-1)' '  RIGHT-PADDING BLANKS       11/83 DBC
         SPACE 1                                              11/83 DBC
PSWKEY   DS    X                   SAVE AREA                  11/83 DBC
         SPACE 1                                              11/83 DBC
FLAG     DC    B'00000000'         AUDIT FLAG                 11/83 DBC
SUPER    EQU   B'10000000'         IN SUPERVISOR STATE        11/83 DBC
KEY0     EQU   B'01000000'         IN KEY ZERO                11/83 DBC
ENQED    EQU   B'00100000'         SERIALIZED                 11/83 DBC
SRCHPO00 EQU   B'00010000'         THE SRCHPDS HOOK HAS NOT   11/83 DBC
*                                  NOT NOT BEEN SET           11/83 DBC
DFOUND00 EQU   B'00001000'         THE DFOUND HOOK HAS NOT    11/83 DBC
*                                  NOT NOT BEEN SET           11/83 DBC
         SPACE 1                                              11/83 DBC
         LTORG ,                                              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        MESSAGES                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 3                                              11/83 DBC
         DC    AL1(L'NULL)                                    11/83 DBC
NULL     DC    C' '                                           11/83 DBC
         SPACE 3                                              11/83 DBC
         DC    AL1(L'DYNATIT)                                 11/83 DBC
DYNATIT  DC    C'DYNAMIC BLDL ACTIVITY REPORT'                11/83 DBC
         SPACE 3                                              11/83 DBC
         DS    AL1                                            11/83 DBC
STATBUF  DS    CL(LEN3270)                                    11/83 DBC
         SPACE 3                                              11/83 DBC
         DC    AL1(0)                                         11/83 DBC
STATBUF2 DS    CL(LEN3270)                                    11/83 DBC
         SPACE 3                                              11/83 DBC
         DC    AL1(0)                                         11/83 DBC
STATBUF3 DS    CL(LEN3270)                                    11/83 DBC
         SPACE 3                                              11/83 DBC
         DC    AL1(L'INFOBUF)                                 11/83 DBC
INFOBUF  DC    CL(INFOLEN)' '                                 11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   NAMEBAR-INFO+INFOBUF                           11/83 DBC
         DC    C'|'                                           11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   HITSBAR-INFO+INFOBUF                           11/83 DBC
         DC    C'|'                                           11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   LRUBAR-INFO+INFOBUF                            11/83 DBC
         DC    C'|'                                           11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   ,                                              11/83 DBC
         SPACE 3                                              11/83 DBC
         DC    AL1(L'SORTTIT)                                 11/83 DBC
SORTTIT  DC    CL(INFOLEN)' '                                 11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   NAMEBAR-INFO+SORTTIT                           11/83 DBC
         DC    C'|'                                           11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   NAMENAME-INFO+SORTTIT                          11/83 DBC
         DC    C'SORTED BY NAME'                              11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   HITSBAR-INFO+SORTTIT                           11/83 DBC
         DC    C'|'                                           11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   HITSHITS-INFO+SORTTIT                          11/83 DBC
         DC    C'SORTED BY HITS'                              11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   LRUBAR-INFO+SORTTIT                            11/83 DBC
         DC    C'|'                                           11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   LRUIDLE-INFO+SORTTIT                           11/83 DBC
         DC    C'SORTED BY L.R.U.'                            11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   ,                                              11/83 DBC
         SPACE 3                                              08/84 DBC
         DC    AL1(L'SORTTIT0)                                08/84 DBC
SORTTIT0 DC    CL(INFOLEN)' '                                 08/84 DBC
         SPACE 1                                              08/84 DBC
         ORG   NAMEBAR-INFO+SORTTIT0                          08/84 DBC
         DC    C'|'                                           08/84 DBC
         SPACE 1                                              08/84 DBC
         ORG   HITSBAR-INFO+SORTTIT0                          08/84 DBC
         DC    C'|'                                           08/84 DBC
         SPACE 1                                              08/84 DBC
         ORG   HITSHITS-INFO+SORTTIT0                         08/84 DBC
         DC    C'(* MEANS REENTRANT)'                         08/84 DBC
         SPACE 1                                              08/84 DBC
         ORG   LRUBAR-INFO+SORTTIT0                           08/84 DBC
         DC    C'|'                                           08/84 DBC
         SPACE 1                                              08/84 DBC
         ORG   ,                                              08/84 DBC
         SPACE 3                                              11/83 DBC
         DC    AL1(L'SORTSUBT)                                11/83 DBC
SORTSUBT DC    CL(INFOLEN)' '                                 11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   COUNT-INFO+SORTSUBT                            11/83 DBC
         DC    C'CNT'                                         11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   NAMEBAR-INFO+SORTSUBT                          11/83 DBC
         DC    C'|'                                           11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   NAMENAME-INFO+SORTSUBT                         11/83 DBC
         DC    C'NAME'                                        11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   NAMELIB#-1-INFO+SORTSUBT                       11/83 DBC
         DC    C'LIB#'                                        11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   NAMEHITS+L'NAMEHITS-4-INFO+SORTSUBT            11/83 DBC
         DC    C'HITS'                                        11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   HITSBAR-INFO+SORTSUBT                          11/83 DBC
         DC    C'|'                                           11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   HITSHITS+L'HITSHITS-4-INFO+SORTSUBT            11/83 DBC
         DC    C'HITS'                                        11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   HITSIDLE+L'HITSIDLE-4-INFO+SORTSUBT            11/83 DBC
         DC    C'IDLE'                                        11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   HITSAGE+L'HITSAGE-3-INFO+SORTSUBT              11/83 DBC
         DC    C'AGE'                                         11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   HITSNAME-INFO+SORTSUBT                         11/83 DBC
         DC    C'NAME'                                        11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   LRUBAR-INFO+SORTSUBT                           11/83 DBC
         DC    C'|'                                           11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   LRUIDLE+L'LRUIDLE-4-INFO+SORTSUBT              11/83 DBC
         DC    C'IDLE'                                        11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   LRUHITS+L'LRUHITS-4-INFO+SORTSUBT              11/83 DBC
         DC    C'HITS'                                        11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   LRUNAME-INFO+SORTSUBT                          11/83 DBC
         DC    C'NAME'                                        11/83 DBC
         SPACE 1                                              11/83 DBC
         ORG   ,                                              11/83 DBC
         TITLE 'SRCHPDS -- IGC018 HOOK ROUTINE'               11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        SRCHPDS -- THIS ROUTINE RECEIVES CONTROL VIA A     * 11/83 DBC
*        HOOK PLACED AT LABEL "SRCHPDS" IN IGC018. (IGC018  * 11/83 DBC
*        BRANCHES TO "SRCHPDS" AFTER IT HAS SEARCHED THE    * 11/83 DBC
*        RESIDENT BLDL TABLE AND WHEN IT IS READY TO READ   * 11/83 DBC
*        THE PDS DIRECTORIES ON DISK). THIS INTERCEPT       * 11/83 DBC
*        ROUTINE DETERMINES IF THE PDS DIRECTORIES ABOUT TO * 11/83 DBC
*        BE SEARCHED ARE FOR THE LINKLIST LIBRARIES. IF SO, * 11/83 DBC
*        THEN IT SCANS THE USER'S BLDL PLIST AGAINST ITS    * 11/83 DBC
*        OWN DYNA-TABLE AND FILLS IN ALL USER REQUESTS FOR  * 11/83 DBC
*        NAMES THAT ARE FOUND IN THE DYNA-TABLE. THUS DISK  * 11/83 DBC
*        DIRECTORY SEARCHES FOR THOSE NAMES ARE BYPASSED.   * 11/83 DBC
*                                                           * 11/83 DBC
*        DURING DYNABLDL START PROCESSING, THE FOLLOWING IS * 11/83 DBC
*        DONE.                                              * 11/83 DBC
*                                                           * 11/83 DBC
*              - THIS ROUTINE IS COPIED TO GLOBAL, FIXED,   * 11/83 DBC
*                KEY0, FETCH ACCESSABLE MEMORY (SP245).     * 11/83 DBC
*                                                           * 11/83 DBC
*              - ALL ADCONS CONTAINED IN IT ARE RELOCATED.  * 11/83 DBC
*                                                           * 11/83 DBC
*              - ALL REFERENCES TO IBM PRIVATE DATA FIELDS  * 11/83 DBC
*                ARE ADJUSTED TO CORRESPOND TO THE CURRENT  * 11/83 DBC
*                VERSION OF IGC018.                         * 11/83 DBC
*                                                           * 11/83 DBC
*              - THIS ROUTINE IS APPENDED WITH AN EXACT     * 11/83 DBC
*                COPY OF THE INSTRUCTIONS IN IGC018 (AT     * 11/83 DBC
*                LABEL "SRCHPDS") THAT WERE OVERLAID BY THE * 11/83 DBC
*                BRANCH TO THIS ROUTINE.                    * 11/83 DBC
*                                                           * 11/83 DBC
*              - THOSE INSTRUCTIONS ARE APPENDED BY A       * 11/83 DBC
*                BRANCH BACK TO IGC018 FOLLOWING THE        * 11/83 DBC
*                OVERLAID INSTRUCTIONS.                     * 11/83 DBC
*                                                           * 11/83 DBC
*        STATIC INPUTS:                                     * 11/83 DBC
*              - R15 POINTS TO THIS HOOK'S ENTRY ADDRESS.   * 11/83 DBC
*              - R0 AND R1 ARE VOLITILE; THEY NEED NOT BE   * 11/83 DBC
*                RESTORED.                                  * 11/83 DBC
*              - ALL OTHER REGISTERS (INCLUDING R14), IF    * 11/83 DBC
*                ALTERED, MUST BE RESTORED.                 * 11/83 DBC
*              - THE "RDAREA" FIELD IN IGC018'S WORK AREA,  * 11/83 DBC
*                SINCE IT IS ABOUT TO BE READ INTO BY EXCP, * 11/83 DBC
*                IS AVAILABLE FOR LOCAL USE AT THIS TIME.   * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         USING SRCHPDS,R15         DCL LOCAL BASE             11/83 DBC
SRCHPDS  DS    0F                  ALIGNMENT                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DETERMINE WHETHER OR NOT THE CURRENT SEARCH IS OF  * 11/83 DBC
*        THE LINKLIST LIBRARIES.                            * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,CVTPTR           --> CVT                    11/83 DBC
         LA    R0,0(,RDCB-RDCB)    GET CRNT DCB PTR           11/83 DBC
         @ZAP  (RDCB,-2)                                      11/83 DBC
         CL    R0,CVTLINK-CVTMAP(,R1) SEARCHING LINKLIST?     11/83 DBC
         BNE   SRCHPOZZ            NO, IGNORE THIS CALL       11/83 DBC
         SPACE 1                                              11/83 DBC
         CLI   CONCAT#-CONCAT#,0   YES, 1ST PASS FOR THIS     11/83 DBC
         @ZAP  (CONCAT#,-2)        PLIST?                     11/83 DBC
         BNE   SRCHPOZZ            NO, DYNA-TABLE SEARCH      11/83 DBC
*                                  ALREADY MADE; IGNORE THIS  11/83 DBC
*                                  CALL                       11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SAVE IGC018'S ENVIRONMENT AND SET UP A LOCAL ONE.  * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         STM   R2,R14,REGSAVE-DYNAWA+RDAREA-RDAREA SAVE       11/83 DBC
         @ZAP  (RDAREA,-2)         IGC018'S REGISTERS         11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   USERKEY-DYNAWA+RDAREA-RDAREA,EXSKEY-EXSKEY     11/83 DBC
         @ZAP  (RDAREA,-4),        SAVE IGC018'S USER'S KEY   11/83 DBC*
               (EXSKEY,-2)                                    11/83 DBC
         SPACE 1                                              09/84 DBC
         MVC   BLDLFLG-DYNAWA+RDAREA-RDAREA,EXSFLG-EXSFLG     09/84 DBC
         @ZAP  (RDAREA,-4),        SAVE IGC018'S CONTROL      09/84 DBC*
               (EXSFLG,-2)         FLAGS                      09/84 DBC
         SPACE 1                                              11/83 DBC
         LA    R1,0(,RLIST-RLIST)  COPY USER'S PLIST PTR TO A 11/83 DBC
         @ZAP  (RLIST,-2)          SAFE REGISTER              11/83 DBC
         USING BLDLIST,R1          DCL USER'S PLIST BASE      11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R13,RDAREA-RDAREA   --> LOCAL WORK AREA        11/83 DBC
         @ZAP  (RDAREA,-2)                                    11/83 DBC
*                                  NOTE, DIRECT USE OF        11/83 DBC
*                                  IGC018'S REGISTERS IS NOW  11/83 DBC
*                                  NO LONGER SAFE.            11/83 DBC
         USING DYNAWA,R13          DCL WORK AREA BASE         11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SAVE IGC018'S CURRENT KEY AND LOAD KEY-0.          * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         IPK   ,                   DETERMINE CURRENT KEY      11/83 DBC
         STC   R2,KEYSAVE          SAVE IT                    11/83 DBC
         SPKA  0                   SET KEY-0                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        GET BITS 10-41 OF THE CURRENT TOD CLOCK VALUE      * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         STCK  CLOKSAVE            GET THE TOD CLOCK          11/83 DBC
         LM    R2,R3,CLOKSAVE      LOAD IT                    11/83 DBC
         SLDL  R2,CLOKSHFT         ISSOLATE BITS 10-41        11/83 DBC
         ST    R2,CLOKSAVE         STORE BACK                 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        PREPARE TO SCAN THE USER'S PLIST                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R2,BLDENT           --> 1ST PLIST ENTRY        11/83 DBC
         USING PDS2,R2             DCL A BASE FOR IT          11/83 DBC
         LH    R0,BLDENTS          GET ENTRY COUNT            11/83 DBC
         LTR   R0,R0               NULL?                      11/83 DBC
         BNP   SRCHRET             YES, EXIT BACK TO IGC018   11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R8,SRCHPODH         NO, --> CONTROL TABLE      11/83 DBC
         USING DYNAHEAD,R8         DCL A BASE FOR IT          11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SEARCH THE DYNA-TABLE FOR EACH USER REQUESTED NAME * 11/83 DBC
*        THAT HAS NOT ALREADY BEEN FOUND.                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
NAMELOOP CLI   PDS2TTRP+2,0        HAS THIS NAME BEEN FOUND?  11/83 DBC
         BNE   NAMENEXT            YES, SKIP IT               11/83 DBC
         TM    PDS2NAME+DYNLLOCK,UNLOCKED NO, BUT WILL THE    11/83 DBC
*                                  NAME CONFUSE ME?           11/83 DBC
         BZ    NAMEMISS            YES, IGNORE IT             11/83 DBC
         LM    R3,R5,DYNAFIRS      NO, LOAD DYNA-TABLE DESCRI 11/83 DBC
         USING DYNL,R3             DCL TABLE ENTRY BASE       11/83 DBC
         SPACE 1                                              11/83 DBC
DYNLSCAN CLC   PDS2NAME,DENTNAME   NAME FOUND IN TABLE?       11/83 DBC
         BE    NAMEHIT             YES, GO PROCESS            11/83 DBC
         BXLE  R3,R4,DYNLSCAN      NO, KEEP SEARCHING         11/83 DBC
         DROP  R3                  NO, RELEASE TABLE ENTRY BA 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        A USER REQUESTED NAME WAS NOT FOUND IN THE         * 11/83 DBC
*        DYNA-TABLE. COUNT THE MISS AND LOOP TO THE NEXT    * 11/83 DBC
*        ENTRY IN THE USER'S PLIST.                         * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
NAMEMISS LA    R4,1                LOAD INCRIMENT             11/83 DBC
         AL    R4,DYNAMISS         COUNT THE MISS             11/83 DBC
         ST    R4,DYNAMISS         STORE BACK. NOTE, I DO NOT 11/83 DBC
*                                  BOTHER WITH A 'CS' BECAUSE 11/83 DBC
*                                  ABSOLUTE ACCURACY HERE IS  11/83 DBC
*                                  NOT REALLY THAT IMPORTANT. 11/83 DBC
         SPACE 1                                              11/83 DBC
         B     NAMENEXT            GO ADVANCE TO NEXT NAME    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        A USER REQUESTED NAME HAS BEEN FOUND IN THE        * 11/83 DBC
*        DYNA-TABLE. ATTEMPT TO LOCK OWNERSHIP OF THE       * 11/83 DBC
*        DYNA-TABLE SLOT.                                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         USING DYNL,R3             RESTORE SLOT BASE          11/83 DBC
NAMEHIT  LM    R4,R5,PDS2NAME      GET THE GIVEN NAME         11/83 DBC
         LR    R6,R4               COPY                       11/83 DBC
         LR    R7,R5               COPY                       11/83 DBC
         X     R6,=A(UNLOCKED)     SET LOCK SIGNAL            11/83 DBC
         #TEST SIZE=(DYNLLOCK,EQ,3) THE LOCK SIGNAL MUST BE   11/83 DBC*
                                   BYTE #3 OF THE NAME        11/83 DBC
         CDS   R4,R6,DENTNAME      ATTEMPT TO LOCK THIS SLOT. 11/83 DBC
*                                  GOT IT?                    11/83 DBC
         BNE   NAMEMISS            NO, GIVE UP ON THIS NAME   11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        I NOW OWN THE SLOT. NOW COPY THE DIRECTORY DATA TO * 11/83 DBC
*        THE USER'S PLIST.                                  * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         LH    R4,BLDELEN          GET L'USER'S PLIST ENTRY   11/83 DBC
         CH    R4,DYNLELEN         COMPARE WITH L'D-ENTRY     11/83 DBC
         BNH   GOTBDLEN            LOW; USE USER'S LENGTH     11/83 DBC
         LH    R4,DYNLELEN         HIGH; USE L'D-ENTRY        11/83 DBC
GOTBDLEN SH    R4,=Y(PDS2TTRP-PDS2+1) DECRIMENT BY L'ROOT     11/83 DBC
*                                  SECTION. ALSO DECRIMENT    11/83 DBC
*                                  FOR "EX-MVC". IS USER'S    11/83 DBC
*                                  SLOT LONG ENOUGH?          11/83 DBC
         BNM   BLDLMOVE            YES, PROCEED               11/83 DBC
         OI    DENTNAME+DYNLLOCK,UNLOCKED NO, RELEASE THE     11/83 DBC
*                                  SLOT                       11/83 DBC
         B     NAMEMISS            IGNORE THIS NAME           11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SET THE USER'S KEY AND THEN COPY THE BLDL ENTRY TO * 11/83 DBC
*        HIS PLIST. NOTE, THE DESIRED USER KEY WILL BE      * 09/84 DBC
*        EITHER HIS EXECUTION KEY OF THE KEY FROM THE DEB   * 10/85 DBC
*        FOR THE PDS BEING SEARCHED. IF THE DESIRED KEY IS  * 09/84 DBC
*        THE DEB KEY, THEN IGC018'S EXECUTION KEY MATCHES   * 09/84 DBC
*        THE DEB KEY.                                       * 09/84 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
BLDLMOVE IC    R5,USERKEY          GET USER'S EXECUTION KEY   09/84 DBC
         TM    BLDLFLG,EXSBLDL-EXSBLDL DOING A BLDL?          09/84 DBC
         @ZAP  (EXSBLDL,-3)                                   09/84 DBC
         BNZ   SINKKEY             YES, PROCEED               09/84 DBC
         IC    R5,KEYSAVE          NO, DOING A FIND. GET      09/84 DBC
*                                  IGC018'S EXECUTION KEY     09/84 DBC
*                                  (WHICH WILL MATCH THE      09/84 DBC
*                                  USER'D DEB KEY).           09/84 DBC
SINKKEY  SPKA  0(R5)               SET USER'S KEY             09/84 DBC
         SPACE 1                                              09/84 DBC
         MVC   PDS2TTRP(*-*),DENTTTRP (EXECUTED)              11/83 DBC
         EX    R4,*-6              COPY STUFF TO USER'S PLIST 11/83 DBC
         SPKA  0                   RESUME KEY-0               11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        UPDATE THE SLOT'S LRU FIELD (MAKING IT M.R.U.),    * 11/83 DBC
*        COUNT THE HIT, AND UNLOCK THE DYNA-SLOT.           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   DYNLLRU#,CLOKSAVE   MAKE SLOT M.R.U.         * 11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R4,1                LOAD INCRIMENT             11/83 DBC
         AL    R4,DYNLHITS         COUNT THE SLOT'S HITS      11/83 DBC
         ST    R4,DYNLHITS         STORE BACK                 11/83 DBC
         SPACE 1                                              11/83 DBC
         OI    DENTNAME+DYNLLOCK,UNLOCKED RELEASE THE SLOT    11/83 DBC
         DROP  R3                  RELEASE SLOT BASE          11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R4,1                LOAD INCRIMENT             11/83 DBC
         AL    R4,DYNAHITS         COUNT TOTAL HITS           11/83 DBC
         ST    R4,DYNAHITS         STORE BACK                 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        ADVANCE TO THE NEXT NAME IN THE USER'S PLIST.      * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
NAMENEXT AH    R2,BLDELEN          --> NEXT PLIST ENTRY       11/83 DBC
         BCT   R0,NAMELOOP         LOOP IF THERE ARE MORE     11/83 DBC
         SPACE 1                                              11/83 DBC
         DROP  R2                  NO MORE, REL PLIST ENTRY B 11/83 DBC
         DROP  R8                  REL DYNA-CONTROL TBL BASE  11/83 DBC
         DROP  R1                  RELEASE PLIST BASE         11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RETURN TO IGC018                                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SRCHRET  IC    R2,KEYSAVE          GET IGC018'S KEY           11/83 DBC
         SPKA  0(R2)               RESTORE IT                 11/83 DBC
         SPACE 1                                              11/83 DBC
         LM    R2,R14,REGSAVE      RESTORE IGC018'S REGS      11/83 DBC
         DROP  R13                 RELEASE LCL WORK AREA BASE 11/83 DBC
         SPACE 1                                              11/83 DBC
         B     SRCHPOZZ            GO BACK TO IGC018          11/83 DBC
         DROP  ,                   RELEASE ALL BASES          11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        STATIC DATA                                        * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SRCHPODH DC    A(DYNAHEAD-DYNAHEAD) --> CONTROL TABLE         11/83 DBC
         SPACE 1                                              11/83 DBC
         LTORG ,                                              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RETURN TO IGC018                                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SRCHPOZZ DS    0H                                             11/83 DBC
SRCHPOLL EQU   SRCHPOZZ-SRCHPDS                               11/83 DBC
         SPACE 1                                              11/83 DBC
************************************************************* 11/83 DBC
*        THE ORIGINAL SRCHPDS CODE FROM IGC018 GETS COPIED  * 11/83 DBC
*        FOLLOWING HERE.                                    * 11/83 DBC
************************************************************* 11/83 DBC
         TITLE 'DFOUND -- IGC018 HOOK ROUTINE'                11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        DFOUND -- THIS ROUTINE RECEIVES CONTROL VIA A HOOK * 11/83 DBC
*        PLACED AT LABEL "DFOUND" IN IGC018. (IGC018        * 11/83 DBC
*        BRANCHES TO "DFOUND" WHEN IT HAS SUCCESSFULLY READ * 11/83 DBC
*        A PDS DIRECTORY BLOCK AND LOCATED THE DESIRED      * 11/83 DBC
*        ENTRY WITHIN IT). IF THE MEMBER IS FROM A LINKLIST * 11/83 DBC
*        LIBRARY BUT HAD NOT BEEN PREVIOUSLY COPIED TO THE  * 11/83 DBC
*        DYNA-TABLE, THEN THIS INTERCEPT DOES THAT.         * 11/83 DBC
*                                                           * 11/83 DBC
*        DURING DYNABLDL START PROCESSING, THE FOLLOWING IS * 11/83 DBC
*        DONE.                                              * 11/83 DBC
*                                                           * 11/83 DBC
*              - THIS ROUTINE IS COPIED TO GLOBAL, FIXED,   * 11/83 DBC
*                KEY0, FETCH ACCESSABLE MEMORY (SP245).     * 11/83 DBC
*                                                           * 11/83 DBC
*              - ALL ADCONS CONTAINED IN IT ARE RELOCATED.  * 11/83 DBC
*                                                           * 11/83 DBC
*              - ALL REFERENCES TO IBM PRIVATE DATA FIELDS  * 11/83 DBC
*                ARE ADJUSTED TO CORRESPOND TO THE CURRENT  * 11/83 DBC
*                VERSION OF IGC018.                         * 11/83 DBC
*                                                           * 11/83 DBC
*              - THIS ROUTINE IS APPENDED WITH AN EXACT     * 11/83 DBC
*                COPY OF THE INSTRUCTIONS IN IGC018 (AT     * 11/83 DBC
*                LABEL "DFOUND") THAT WERE OVERLAID BY THE  * 11/83 DBC
*                BRANCH TO THIS ROUTINE.                    * 11/83 DBC
*                                                           * 11/83 DBC
*              - THOSE INSTRUCTIONS ARE APPENDED BY A       * 11/83 DBC
*                BRANCH BACK TO IGC018 FOLLOWING THE        * 11/83 DBC
*                OVERLAID INSTRUCTIONS.                     * 11/83 DBC
*                                                           * 11/83 DBC
*        STATIC INPUTS:                                     * 11/83 DBC
*              - R15 POINTS TO THIS HOOK'S ENTRY ADDRESS.   * 11/83 DBC
*              - R0 AND R1 ARE VOLITILE; THEY NEED NOT BE   * 11/83 DBC
*                RESTORED.                                  * 11/83 DBC
*              - ALL OTHER REGISTERS (INCLUDING R14), IF    * 11/83 DBC
*                ALTERED, MUST BE RESTORED.                 * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         USING DFOUND,R15          DCL LOCAL BASE             11/83 DBC
DFOUND   DS    0F                  ALIGNMENT                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        DETERMINE WHETHER OR NOT THE CURRENT MEMBER NAME   * 11/83 DBC
*        IS FROM THE LINKLIST LIBRARIES.                    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R1,CVTPTR           --> CVT                    11/83 DBC
         LA    R0,0(,RDCB-RDCB)    COPY PDS DCB PTR           11/83 DBC
         @ZAP  (RDCB,-2)                                      11/83 DBC
         CL    R0,CVTLINK-CVTMAP(,R1) SEARCHING LINKLIST?     11/83 DBC
         BNE   DFOUNDZZ            NO, IGNORE THIS CALL       11/83 DBC
         SPACE 1                                              11/83 DBC
         TM    PDS1NAME+DYNLLOCK-PDS1(RPDS1-RPDS1),UNLOCKED   11/83 DBC
         @ZAP  (RPDS1,-2)          YES, BUT WILL THIS NAME    11/83 DBC*
                                   CONFUSE ME?                11/83 DBC
         BZ    DFOUNDZZ            YES, IGNORE THIS CALL      11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        AQUIRE A LOCAL DYNAMIC WORK AREA                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R0,=AL1(229,0,0,DYNAWAL) SP/LEN                11/83 DBC
         GETMAIN R,LV=(0)          GET AN AREA                11/83 DBC
         DROP  R15                 LOCAL BASE CLOBBERED       11/83 DBC
         USING DYNAWA,R1           DCL WORK AREA BASE         11/83 DBC
         BALR  R15,0               RELOAD A LOCAL BASE        11/83 DBC
         USING *,R15               DECLARE IT                 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SAVE IGC018'S ENVIRONMENT AND SET UP MY OWN.       * 11/83 DBC
*   SEE NEWSWEEK CODE IN HERE.  SAM GOLOB - NEWSWEEK.         11/86 SBG
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         STM   R2,R14,REGSAVE      SAVE IGC018'S REGISTERS    11/83 DBC
         MVC   CCIDSAVE,CONCAT#-CONCAT# SAVE CONCAT INDEX     11/83 DBC
         @ZAP  (CONCAT#,-2)                                   11/83 DBC
         LA    R0,0(,RPDS1-RPDS1)  --> FOUND D-ENTRY          11/83 DBC
         @ZAP  (RPDS1,-2)                                     11/83 DBC
EXCLLIBS DS    0H         NEWSWEEK CODE TO GIVE LIBRARY       11/86 SBG
*                         EXCLUSION OPTION BY CONDITIONAL     11/86 SBG
*                         ASSEMBLY.  TO TURN ON THE OPTION,   11/86 SBG
*                         SETC &LIBEX TO 'YES', AND SET       11/86 SBG
*                         AS MANY LIBRARY EXCLUDE VARIABLES   11/86 SBG
*                         AS YOUR INSTALLATION REQUIRES.      11/86 SBG
*                         A SETTING OF 15 NULLIFIES AN ENTRY. 11/86 SBG
************************************************************* 11/86 SBG
*   WE INTRODUCE LOCAL VARIABLES FOR THE PURPOSE OF         * 11/86 SBG
*     EXCLUDING LINKLIST LIBRARIES WHICH WE DON'T WANT      * 11/86 SBG
*     DYNABLDL TO HIT, FOR WHATEVER PURPOSE.  OUR INSTAL-   * 11/86 SBG
*     LATION HAS APPLICATION PROGRAMMER LIBRARIES IN THE    * 11/86 SBG
*     LINKLIST, BECAUSE WE DON'T WANT THEM TO CODE STEPLIB  * 11/86 SBG
*     IN PRODUCTION JCL.  WE THEREFORE DON'T WANT DYNABLDL  * 11/86 SBG
*     TO HIT THEIR MODULES.  WE ARE PROVIDING THE OPTION    * 11/86 SBG
*     TO EXCLUDE UP TO SIX LINKLIST LIBRARIES.              * 11/86 SBG
*   CODING 15 FOR A &LN WILL NULLIFY IT IN EFFECT.          * 11/86 SBG
************************************************************* 11/86 SBG
         LCLA  &L1,&L2,&L3,&L4,&L5,&L6                        11/86 SBG
         LCLC  &LIBEX                                         11/86 SBG
&L1      SETA  5         , FIFTH LIBRARY AFTER SYS1.LINKLIB   11/86 SBG
&L2      SETA  6         , SIXTH LIBRARY AFTER SYS1.LINKLIB   11/86 SBG
&L3      SETA  15        , NULLIFY PARAMETER                  11/86 SBG
&L4      SETA  15        , NULLIFY PARAMETER                  11/86 SBG
&L5      SETA  15        , NULLIFY PARAMETER                  11/86 SBG
&L6      SETA  15        , NULLIFY PARAMETER                  11/86 SBG
&LIBEX   SETC  'NO'      , 'YES' TO EXCLUDE, 'NO ' NOT TO.    11/86 SBG
************************************************************* 11/86 SBG
         AIF   ('&LIBEX' NE 'YES').SKIPEX                     11/86 SBG
************************************************************* 11/86 SBG
*  INSERT CODE TO EXCLUDE CERTAIN LINKLIST LIBRARIES FROM   * 11/86 SBG
*   THE SEARCH.  THIS IS A FIX SO THAT DYNABLDL DOES NOT    * 11/86 SBG
*   HIT LIBRARIES IN THE LINKLIST THAT YOU DON'T WANT IT    * 11/86 SBG
*   TO HIT.                                                 * 11/86 SBG
************************************************************* 11/86 SBG
         CLI   CCIDSAVE,&L1        SKIP THIS LIBRARY ?        11/86 SBG
         BE    DFOUNDZZ            YES - SKIP IT.             11/86 SBG
         CLI   CCIDSAVE,&L2        SKIP THIS LIBRARY ?        11/86 SBG
         BE    DFOUNDZZ            YES - SKIP IT.             11/86 SBG
         CLI   CCIDSAVE,&L3        SKIP THIS LIBRARY ?        11/86 SBG
         BE    DFOUNDZZ            YES - SKIP IT.             11/86 SBG
         CLI   CCIDSAVE,&L4        SKIP THIS LIBRARY ?        11/86 SBG
         BE    DFOUNDZZ            YES - SKIP IT.             11/86 SBG
         CLI   CCIDSAVE,&L5        SKIP THIS LIBRARY ?        11/86 SBG
         BE    DFOUNDZZ            YES - SKIP IT.             11/86 SBG
         CLI   CCIDSAVE,&L6        SKIP THIS LIBRARY ?        11/86 SBG
         BE    DFOUNDZZ            YES - SKIP IT.             11/86 SBG
         DS    0H                  ENSURE  ALIGNMENT          11/86 SBG
.SKIPEX  ANOP                                                 11/86 SBG
************************************************************* 11/86 SBG
         LR    R13,R1              COPY LCL DYNAWA PTR.       11/83 DBC
*                                  NOTE, DIRECT USE OF        11/83 DBC
*                                  IGC018'S REGISTERS IS NOW  11/83 DBC
*                                  NO LONGER SAFE.            11/83 DBC
         DROP  R1                  RELEASE TEMP DYNAWA BASE   11/83 DBC
         USING DYNAWA,R13          DCL NEW ONE                11/83 DBC
         SPACE 1                                              11/83 DBC
         LR    R1,R0               COPY D-ENTRY POINTER       11/83 DBC
         USING PDS1,R1             DCL A BASE FOR IT          11/83 DBC
         SPACE 1                                              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SAVE IGC018'S KEY AND LOAD KEY-0                     11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         IPK   ,                   GET IGC018'S KEY           11/83 DBC
         STC   R2,KEYSAVE          SAVE IT                    11/83 DBC
         SPKA  0                   LOAD KEY-0                 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        GET BITS 10-41 OF THE CURRENT TOD CLOCK VALUE      * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         STCK  CLOKSAVE            GET THE TOD CLOCK          11/83 DBC
         LM    R2,R3,CLOKSAVE      LOAD IT                    11/83 DBC
         SLDL  R2,CLOKSHFT         ISSOLATE BITS 10-41        11/83 DBC
         ST    R2,CLOKSAVE         STORE BACK                 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        SCAN THE DYNA-TABLE IN SEARCH OF A STEALABLE SLOT. * 11/83 DBC
*        NOTE, THE NAME MIGHT ALREADY EXIST IN THE TABLE,   * 11/83 DBC
*        SO CHECK THAT TOO.                                 * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R8,DFOUNDDH         --> CONTROL TABLE          11/83 DBC
         USING DYNAHEAD,R8         DCL CONTROL TABLE BASE     11/83 DBC
RESCAN   LM    R3,R5,DYNAFIRS      --> DYNA-TABLE             11/83 DBC
         USING DYNL,R3             DCL SLOT BASE              11/83 DBC
         SPACE 1                                              11/83 DBC
         SR    R0,R0               LOAD LOGICAL HIGH -        11/83 DBC
         BCTR  R0,0                 VALUE (4X'FF')            11/83 DBC
         SPACE 1                                              11/83 DBC
SCANLOOP CL    R0,DYNLLRU#         LESS RECENTLY USED SLOT?   11/83 DBC
         BL    SCANNAME            NO, SKIP                   11/83 DBC
         LR    R2,R3               YES, SAVE ITS POINTER      11/83 DBC
         ICM   R0,15,DYNLLRU#      GET LRU#; UNUSED SLOT?     11/83 DBC
         BZ    SCANGRAB            YES, GO USE IT.            11/83 DBC
SCANNAME CLC   DENTNAME,PDS1NAME   NO, IS THE NAME ACTUALLY   11/83 DBC
*                                  ALREADY IN THE DYNA-TABLE? 11/83 DBC
         BE    SCANRET             YES, NOTHING TO DO HERE    11/83 DBC
         BXLE  R3,R4,SCANLOOP      NO, CONTINUE SEARCHING     11/83 DBC
         DROP  R3                  RELEASE SLOT BASE          11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        A STEALABLE (OR UNUSED) SLOT HAS BEEN FOUND.       * 11/83 DBC
*        ATTEMPT TO LOCK CONTROL OF IT.                     * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         USING DYNL,R2             DCL SLOT BASE              11/83 DBC
SCANGRAB CLC   DYNLLRU#,CLOKSAVE   IF THE DYNA-TABLE IS VERY  11/83 DBC
*                                  SMALL (SUCH AS 1 OR 2      11/83 DBC
*                                  ENTRIES), THEN THE GRAB    11/83 DBC
*                                  ATTEMPT COULD CONCEIVABLY  11/83 DBC
*                                  FAIL ON EVERY SLOT AND     11/83 DBC
*                                  THAT WOULD LEAD TO AN      11/83 DBC
*                                  UNCONTROLLED LOOP. THIS    11/83 DBC
*                                  TEST GUARDS AGAINST THAT.  11/83 DBC
*                                  HAVE I ALREADY TRIED AND   11/83 DBC
*                                  FAILED TO GRAB THIS SLOT?  11/83 DBC
         BE    SCANRET             YES, GIVE UP.              11/83 DBC
         MVC   DYNLLRU#,CLOKSAVE   NO, RESET THIS SLOT'S LRU# 11/83 DBC
*                                  REGUARDLESS OF WHETHER OR  11/83 DBC
*                                  I CAN LOCK IT.             11/83 DBC
         SPACE 1                                              11/83 DBC
         LM    R4,R5,DENTNAME      GET THE SLOT'S NAME        11/83 DBC
         O     R4,=A(UNLOCKED)     SET UNLOCKED IN CASE       11/83 DBC
*                                  ALREADY LOCKED JUST NOW BY 11/83 DBC
*                                  SOMEONE ELSE               11/83 DBC
         #TEST SIZE=(DYNLLOCK,EQ,3) THE LOCK BIT MUST BE IN   11/83 DBC*
                                   THE NAME'S 4TH BYTE        11/83 DBC
         LR    R6,R4               COPY THE -                 11/83 DBC
         LR    R7,R5                NAME                      11/83 DBC
         X     R6,=A(UNLOCKED)     SET "LOCKED" SIGNAL        11/83 DBC
         #TEST SIZE=(DYNLLOCK,EQ,3)                           11/83 DBC
         CDS   R4,R6,DENTNAME      ATTEMPT TO LOCK THIS SLOT. 11/83 DBC
*                                  GOT IT?                    11/83 DBC
         BNE   RESCAN              NO, TRY TO GET ANOTHER     11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        I'VE NOW GOT A STEALABLE SLOT. COUNT IT AND STEAL  * 11/83 DBC
*        IT.                                                * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         XC    DYNL(DYNLLEN),DYNL CLEAR THE SLOT              11/83 DBC
         MVC   DYNLLRU#,CLOKSAVE   MAKE M.R.U.                11/83 DBC
         MVC   DYNLCLOK,CLOKSAVE   SET BIRTHDATE              11/83 DBC
         MVC   DENTCNCT,CCIDSAVE   SAVE LIB CONCAT INDEX      11/83 DBC
         MVI   DENTLIBF,LINKSVC    SET "FROM LINKLIST" SIGNAL 11/83 DBC
         SPACE 1                                              11/83 DBC
         IC    R4,PDS1INDC         GET L'UDAT/2               11/83 DBC
         N     R4,=A(PDS1LUSR)     ISSOLATE IT                11/83 DBC
         AR    R4,R4               CNVRT TO TRUE VALUE        11/83 DBC
         LA    R5,DENTUSRD-DENT(,R4) CNVRT TO SLOT ENTRY LEN  11/83 DBC
         STH   R5,DYNLELEN         SAVE                       11/83 DBC
         MVC   DENTINDC(*-*),PDS1INDC (EXECUTED)              11/83 DBC
         EX    R4,*-6              COPY FLAGS, LENGTH, AND    11/83 DBC
*                                  USER DATA TO THE SLOT      11/83 DBC
         SPACE 1                                              11/83 DBC
         MVC   DENTNAME(L'DENTNAME+L'DENTTTRP),PDS1NAME COPY  11/83 DBC
*                                  REST OF INFO TO SLOT. ALSO 11/83 DBC
*                                  UNLOCK THE SLOT.           11/83 DBC
         DROP  R2                  RELEASE SLOT BASE          11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R4,1                LOAD INCRIMENT             11/83 DBC
         AL    R4,DYNADDED         INCR STEAL COUNTER         11/83 DBC
         ST    R4,DYNADDED         STORE BACK                 11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RETURN TO IGC018                                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SCANRET  IC    R2,KEYSAVE          GET IGC018'S KEY           11/83 DBC
         SPKA  0(R2)               RESTORE IT                 11/83 DBC
         SPACE 1                                              11/83 DBC
         LA    R1,DYNAWA           SAVE WORK AREA PTR         11/83 DBC
         DROP  R1                  RELEASE D-ENTRY BASE       11/83 DBC
         LM    R2,R14,REGSAVE      RESTORE IGC018'S REGISTERS 11/83 DBC
         DROP  R8                  RELEASE CONTROL TABLE BASE 11/83 DBC
         DROP  R13                 RELEASE WORK AREA BASE     11/83 DBC
         SPACE 1                                              11/83 DBC
         L     R0,=AL1(229,0,0,DYNAWAL) GET SP/LEN            11/83 DBC
         FREEMAIN R,LV=(0),A=(1)   RELEASE THE WORK AREA      11/83 DBC
         DROP  R15                 LOCAL BASE CLOBBERED       11/83 DBC
         BALR  R15,0               LOAD NEW LOCAL BASE        11/83 DBC
         B     DFOUNDZZ-*(,R15)    GO EXIT TO IGC018          11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        LOCAL DATA                                         * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         DROP  ,                   RELEASE ALL BASES          11/83 DBC
         SPACE 1                                              11/83 DBC
DFOUNDDH DC    A(DYNAHEAD-DYNAHEAD) HEADER TABLE PTR          11/83 DBC
         SPACE 1                                              11/83 DBC
         LTORG ,                                              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RETURN TO IGC018                                   * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DFOUNDZZ DS    0H                                             11/83 DBC
DFOUNDLL EQU   DFOUNDZZ-DFOUND                                11/83 DBC
         SPACE 1                                              11/83 DBC
************************************************************* 11/83 DBC
*        THE ORIGINAL DFOUND CODE FROM IGC018 GETS COPIED   * 11/83 DBC
*        FOLLOWING HERE.                                    * 11/83 DBC
************************************************************* 11/83 DBC
         TITLE '@ZAP -- IBM PRIVATE FIELDS REFERENCE ADJUSTMENTS' 3 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        @ZAP -- THIS ROUTINE ADJUSTS ALL FLAGGED           * 11/83 DBC
*        REFERENCES TO IBM PRIVATE FIELDS TO CORRESPOND TO  * 11/83 DBC
*        THE CURRENT VERSION OF IGC018.                     * 11/83 DBC
*                                                           * 11/83 DBC
*        INPUTS:                                            * 11/83 DBC
*              - R1 POINTS TO A TABLE OF FIELD DESCRIPTORS. * 11/83 DBC
*              - THE PROGRAM BASE REGISTERS ARE AS          * 11/83 DBC
*                ESTABLISHED BY THE #ENTER MACRO AT         * 11/83 DBC
*                DYNABLDL'S ENTRY POINT.                    * 11/83 DBC
*              - R14 POINTS TO A RETURN ADDRESS.            * 11/83 DBC
*              - R0 MAY BE DESTROYED.                       * 11/83 DBC
*              - NOTE, A LOCAL BASE IS NOT NEEDED HERE.     * 11/83 DBC
*                                                           * 11/83 DBC
*        RETURN 0(,R14):                                    * 11/83 DBC
*              - THE REQUIRED ADJUSTMENTS HAVE BEEN MADE.   * 11/83 DBC
*              - R0 IS DESTROYED.                           * 11/83 DBC
*              - ALL OTHER REGISTERS ARE RESTORED.          * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         #USING ,                  RESTORE ADDRESSABILITY     11/83 DBC
         USING FIELDS,R1           DCL FIELDS BASE            11/83 DBC
@ZAP     @ZAP  ,                                              11/83 DBC
         SPACE 1                                              11/83 DBC
         BR    R14                 RETURN TO CALLER           11/83 DBC
         DROP  ,                   RELEASE ALL BASES          11/83 DBC
         SPACE 1                                              11/83 DBC
         LTORG ,                                              11/83 DBC
         TITLE 'PRTEXIT -- SYSPRINT DCB OPEN EXIT'            11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        PRTEXIT -- THIS IS A DCB OPEN EXIT ROUTINE FOR THE * 11/83 DBC
*        SYSPRINT FILE. IT EXAMINES THE RECFM, LRECL, AND   * 11/83 DBC
*        BLKSIZE DCB FIELDS TO ENFORCE VALID COMBINATIONS   * 11/83 DBC
*        AND TO SET THE FOLLOWING DEFAULTS AS APPROPRIATE.  * 11/83 DBC
*                                                           * 11/83 DBC
*        IF NEITHER RECFM=F, =V, OR =U IS GIVEN, THEN       * 11/83 DBC
*        RECFM=V IS SET.                                    * 11/83 DBC
*                                                           * 11/83 DBC
*        IF RECFM=A OR =M IS GIVEN, THEN THAT IS CLEARED.   * 11/83 DBC
*        (CARRIAGE CONTROL IS NOT SUPPORTED BY DYNABLDL).   * 11/83 DBC
*                                                           * 11/83 DBC
*        FOR RECFM=U, LRECL IS FORCED TO ZERO.              * 11/83 DBC
*                                                           * 11/83 DBC
*        IF BLKSIZE=0 IS GIVEN, THEN A TENTATIVE DEFAULT    * 11/83 DBC
*        BLKSIZE IS CHOSEN AS FOLLOWS:                      * 11/83 DBC
*        - IF RECFM=F, THEN BLKSIZE=3120.                   * 11/83 DBC
*        - IF RECFM=V, THEN BLKSIZE=4096.                   * 11/83 DBC
*        - IF RECFM=U, THEN BLKSIZE=79.                     * 11/83 DBC
*                                                           * 11/83 DBC
*        IF LRECL=0 IS GIVEN, THEN A DEFAULT LRECL IS       * 11/83 DBC
*        CHOSEN AS FOLLOWS:                                 * 11/83 DBC
*        - IF RECFM=F, THEN LRECL=80.                       * 11/83 DBC
*        - IF RECFM=V, THEN LRECL=83.                       * 11/83 DBC
*                                                           * 11/83 DBC
*        FOR RECFM=F, IF BLKSIZE IS NOT A MULTIPLE OF       * 11/83 DBC
*        LRECL, THEN IT IS ROUNDED DOWN TO A LRECL          * 11/83 DBC
*        MULTIPLE.                                          * 11/83 DBC
*                                                           * 11/83 DBC
*        IF, AT THIS POINT, BLKSIZE IS NOT LARGE ENOUGH     * 11/83 DBC
*        WHEN COMPARED TO LRECL, THEN A NEW BLKSIZE IS SET  * 11/83 DBC
*        AS FOLLOWS:                                        * 11/83 DBC
*        - IF RECFM=F, THEN BLKSIZE=LRECL.                  * 11/83 DBC
*        - IF RECFM=V, THEN BLKSIZE=LRECL+4.                * 11/83 DBC
*                                                           * 11/83 DBC
*        INPUTS:                                            * 11/83 DBC
*              - R1 POINTS TO THE SYSPRINT DCB.             * 11/83 DBC
*              - R14 POINTS TO A RETURN ADDRESS (SVC 3).    * 11/83 DBC
*              - R15 POINTS TO THIS ROUTINE'S ENTRY         * 11/83 DBC
*                ADDRESS.                                   * 11/83 DBC
*                                                           * 11/83 DBC
*        RETURN 0(,R14):                                    * 11/83 DBC
*              - THE ABOVE DESCRIBED PROCESSING HAS BEEN    * 11/83 DBC
*                COMPLETED.                                 * 11/83 DBC
*              - R14 REMAINS UNCHANGED.                     * 11/83 DBC
*              - OTHER REGISTERS MAY BE ALTERED.            * 11/83 DBC
*                (RESTORATION IS NOT NECESSARY).            * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
         USING IHADCB,R1           DCL DCB BASE               11/83 DBC
         USING PRTEXIT,R15         DCL LOCAL BASE             11/83 DBC
PRTEXIT  LH    R4,DCBLRECL         GET LRECL                  11/83 DBC
         LH    R3,DCBBLKSI         SET BLKSIZE                11/83 DBC
         SPACE 1                                              11/83 DBC
         OI    DCBRECFM,DCBRECBR   ASSUME BLOCKED RECORDS     11/83 DBC
         SPACE 1                                              11/83 DBC
         NI    DCBRECFM,255-DCBRECCC CLEAR CARRIAGE CONTROL   11/83 DBC
         SPACE 1                                              11/83 DBC
         TM    DCBRECFM,DCBRECU    RECFM DEFINED?             11/83 DBC
         BO    PRTRECU             YES, RECFM=U               11/83 DBC
         BNZ   PRTRECFV            YES, RECFM=F OR =V         11/83 DBC
         OI    DCBRECFM,DCBRECV    NO, SET RECFM=V            11/83 DBC
PRTRECFV TM    DCBRECFM,DCBRECF    RECFM=F?                   11/83 DBC
         BO    PRTRECF             YES, GO HANDLE             11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RECFM=V HANDLER                                    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PRTRECV  LTR   R3,R3               BLKSIZE=0?                 11/83 DBC
         BNZ   PRTRVCK2            NO, SKIP                   11/83 DBC
         LH    R3,=Y(4096)         YES, SET DEFAULT           11/83 DBC
         SPACE 1                                              11/83 DBC
PRTRVCK2 CH    R4,=Y(LEN3270+4)    LRECL LARGE ENOUGH?        11/83 DBC
         BNL   PRTRVCK3            YES, SKIP                  11/83 DBC
         LA    R4,LEN3270+4        NO, RESET                  11/83 DBC
         SPACE 1                                              11/83 DBC
PRTRVCK3 LA    R0,4(,R4)           GET LRECL+4                11/83 DBC
         CR    R0,R3               BLKSIZE LARGE ENOUGH?      11/83 DBC
         BH    PRTLBOK             YES, DONE HERE             11/83 DBC
         NI    DCBRECFM,255-DCBRECBR NO, SIGNAL UNBLOCKED     11/83 DBC
         LR    R3,R0               RESET THE BLKSIZE          11/83 DBC
         B     PRTLBOK             DONE HERE                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RECFM=F HANDLER                                    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PRTRECF  LTR   R3,R3               BLKSIZE=0?                 11/83 DBC
         BNZ   PRTRFCK2            NO, SKIP                   11/83 DBC
         LA    R3,3120             YES, SET DEFAULT           11/83 DBC
         SPACE 1                                              11/83 DBC
PRTRFCK2 CH    R4,=Y(LEN3270)      LRECL LARGE ENOUGH?        11/83 DBC
         BNL   PRTRFCK3            YES, SKIP                  11/83 DBC
         LA    R4,80               NO, SET DEFAULT            11/83 DBC
         SPACE 1                                              11/83 DBC
PRTRFCK3 SR    R2,R2               CLEAR FOR DIVIDE           11/83 DBC
         DR    R2,R4               ROUND BLKSIZE DOWN -       11/83 DBC
         MR    R2,R4                TO A LRECL MULTIPLE       11/83 DBC
         SPACE 1                                              11/83 DBC
         CR    R3,R4               IS BLKSIZE LARGE ENOUGH?   11/83 DBC
*                                  (MIGHT BE ZEROED BY THE    11/83 DBC
*                                  ABOVE DIVIDE)              11/83 DBC
         BH    PRTLBOK             YES, DONE HERE             11/83 DBC
         NI    DCBRECFM,255-DCBRECBR NO, SIGNAL UNBLOCKED     11/83 DBC
         LR    R3,R4               RESET BLKSIZE              11/83 DBC
         B     PRTLBOK             DONE HERE                  11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RECFM=U HANDLER                                    * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PRTRECU  NI    DCBRECFM,255-DCBRECBR SIGNAL UNBLOCKED         11/83 DBC
         SR    R4,R4               SET LRECL=0                11/83 DBC
         SPACE 1                                              11/83 DBC
         CH    R3,=Y(LEN3270)      IS BLKSIZE LARGE ENOUGH?   11/83 DBC
         BNL   PRTLBOK             YES, DONE HERE             11/83 DBC
         LA    R3,LEN3270          NO, RESET THE BLKSIZE      11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*        RETURN TO CALLER (OPEN VIA SVC 3)                  * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
PRTLBOK  STH   R3,DCBBLKSI         STORE NEW BLKSIZE          11/83 DBC
         STH   R4,DCBLRECL         STORE NEW LRECL            11/83 DBC
         BR    R14                 RETURN TO CALLER           11/83 DBC
         DROP  ,                   RELEASE ALL BASES          11/83 DBC
         SPACE 1                                              11/83 DBC
         LTORG ,                                              11/83 DBC
         TITLE 'VERSION TABLES'                               11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        MODULE: IGC018                                     * 11/83 DBC
*        PRODUCT: DF/DS (5740-AM7)                          * 11/83 DBC
*        LEVEL: 8206                                        * 11/83 DBC
*        PTF: UZ56064                                       * 11/83 DBC
*        APAR: AZ60132                                      * 11/83 DBC
*                                                           * 11/83 DBC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 11/83 DBC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 11/83 DBC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
VERSN#01 CSECT ,                                              11/83 DBC
         DC    A(ID#01)            --> VERSION VERIFIER       11/83 DBC
         DC    A(SRCH#01)          --> ORIGINAL "SRCHPDS" COD 11/83 DBC
         DC    A(DFND#01)          --> ORIGINAL "DFOUND" CODE 11/83 DBC
         DC    A(DOFF#01)          --> IBM DATA FIELDS DESCRIPTORS  DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
ID#01    DS    0H                                             11/83 DBC
         DC    Y(X'6')             VERIFY LOCATION            11/83 DBC
         DC    Y(ID#01VLN)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#01V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'@ZA60132'         00000E          DC    C'@ZA60132'
*                                                  DC    C'&SYSDATE'
         DC    C'03/26/82'         000016+         DC    C'03/26/82'
         DC    C'5740-AM7'         00001E          DC    C'5740-AM7 ---
*                                  ************************************
         SPACE 1                                              11/83 DBC
ID#01VLN EQU   *-ID#01V            VERIFY LENGTH              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SRCH#01  DS    0H                                             11/83 DBC
         DC    Y(X'572')           VERIFY LOCATION            11/83 DBC
         DC    Y(SRCH#01L)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#01V DS    0H                  000572 SRCHPDS  EQU   *
         BAL   R14,X'4FA'(,R12)    000572          BAL   RSUBR,FIRSTMTY
         TM    X'61'(R6),X'80'     000576          TM    EXSFLG,EXSSYDC
         BO    X'580'(,R12)        00057A          BO    SRCHKYOK
*                                  ************************************
         SPACE 1                                              11/83 DBC
SRCH#01L EQU   *-SRCH#01V          VERIFY LENGTH              11/83 DBC
         #TEST SIZE=(SRCH#01L,GE,SRCHPOHL)                    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DFND#01  DS    0H                                             11/83 DBC
         DC    Y(X'7C4')           VERIFY LOCATION            11/83 DBC
         DC    Y(DFND#01L)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
DFND#01V MVC   X'8'(3,R7),X'8'(R8) 0007C4 DFOUND   MVC   PDS2TTRP,PDS1T
         IC    R4,X'B'(,R8)        0007CA          IC    RX,PDS1INDC
         NR    R4,R14              0007CE          NR    RX,RZ
         LA    R5,X'E'             0007D0          LA    RY,PDS2USRD-PD
         LCR   R5,R5               0007D4          LCR   RY,RY
         AH    R5,X'2'(,R10)       0007D6          AH    RY,BLDELEN
*                                  ************************************
         SPACE 1                                              11/83 DBC
DFND#01L EQU   *-DFND#01V          VERIFY LENGTH              11/83 DBC
         #TEST SIZE=(DFND#01L,GE,DFOUNDHL)                    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DOFF#01  DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              11/83 DBC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              11/83 DBC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'141'(R13))      000141 CONCAT#  DS    FL1
         SPACE 1                                              11/83 DBC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              11/83 DBC
         #TEST SIZE=(*-DOFF#01,EQ,FIELDSLN)                   11/83 DBC
         EJECT ,                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        MODULE: IGC018                                     * 11/83 DBC
*        PRODUCT: DF/DS (5740-AM7)                          * 11/83 DBC
*        LEVEL: 8107                                        * 09/84 DBC
*        PTF: UZ37480                                       * 09/84 DBC
*        APAR: AZ49924                                      * 11/83 DBC
*                                                           * 11/83 DBC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 11/83 DBC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 11/83 DBC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
VERSN#02 CSECT ,                                              11/83 DBC
         DC    A(ID#02)            --> VERSION VERIFIER       11/83 DBC
         DC    A(SRCH#02)          --> ORIGINAL "SRCHPDS" COD 11/83 DBC
         DC    A(DFND#02)          --> ORIGINAL "DFOUND" CODE 11/83 DBC
         DC    A(DOFF#02)          --> IBM DATA FIELDS DESCRIPTORS  DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
ID#02    DS    0H                                             11/83 DBC
         DC    Y(X'6')             VERIFY LOCATION            11/83 DBC
         DC    Y(ID#02VLN)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#02V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'@ZA49924'         00000E          DC    C'@ZA49924'
*                                                  DC    C'&SYSDATE'
         DC    C'05/28/81'         000016+         DC    C'05/28/81'
         DC    C'5740-AM7'         00001E          DC    C'5740-AM7 ---
*                                  ************************************
         SPACE 1                                              11/83 DBC
ID#02VLN EQU   *-ID#02V            VERIFY LENGTH              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SRCH#02  DS    0H                                             11/83 DBC
         DC    Y(X'566')           VERIFY LOCATION            11/83 DBC
         DC    Y(SRCH#02L)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#02V DS    0H                  000566 SRCHPDS  EQU   *
         BAL   R14,X'4EE'(,R12)    000566          BAL   RSUBR,FIRSTMTY
         TM    X'61'(R6),X'80'     00056A          TM    EXSFLG,EXSSYDC
         BO    X'574'(,R12)        00056E          BO    SRCHKYOK
*                                  ************************************
         SPACE 1                                              11/83 DBC
SRCH#02L EQU   *-SRCH#02V          VERIFY LENGTH              11/83 DBC
         #TEST SIZE=(SRCH#02L,GE,SRCHPOHL)                    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DFND#02  DS    0H                                             11/83 DBC
         DC    Y(X'7B8')           VERIFY LOCATION            11/83 DBC
         DC    Y(DFND#02L)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
DFND#02V MVC   X'8'(3,R7),X'8'(R8) 0007B8 DFOUND   MVC   PDS2TTRP,PDS1T
         IC    R4,X'B'(,R8)        0007BE          IC    RX,PDS1INDC
         NR    R4,R14              0007C2          NR    RX,RZ
         LA    R5,X'E'             0007C4          LA    RY,PDS2USRD-PD
         LCR   R5,R5               0007C8          LCR   RY,RY
         AH    R5,X'2'(,R10)       0007CA          AH    RY,BLDELEN
*                                  ************************************
         SPACE 1                                              11/83 DBC
DFND#02L EQU   *-DFND#02V          VERIFY LENGTH              11/83 DBC
         #TEST SIZE=(DFND#02L,GE,DFOUNDHL)                    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DOFF#02  DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              11/83 DBC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              11/83 DBC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'141'(R13))      000141 CONCAT#  DS    FL1
         SPACE 1                                              11/83 DBC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              11/83 DBC
         #TEST SIZE=(*-DOFF#02,EQ,FIELDSLN)                   11/83 DBC
         EJECT ,                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        MODULE: IGC018                                     * 11/83 DBC
*        PRODUCT: MVS SCP 3.8 (5752-MVS)                    * 11/83 DBC
*        LEVEL: 8009                                        * 11/83 DBC
*        PTF: UZ32516                                       * 11/83 DBC
*        APAR: AZ47610                                      * 11/83 DBC
*                                                           * 11/83 DBC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 11/83 DBC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 11/83 DBC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
VERSN#03 CSECT ,                                              11/83 DBC
         DC    A(ID#03)            --> VERSION VERIFIER       11/83 DBC
         DC    A(SRCH#03)          --> ORIGINAL "SRCHPDS" COD 11/83 DBC
         DC    A(DFND#03)          --> ORIGINAL "DFOUND" CODE 11/83 DBC
         DC    A(DOFF#03)          --> IBM DATA FIELDS DESCRIPTORS  DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
ID#03    DS    0H                                             11/83 DBC
         DC    Y(X'6')             VERIFY LOCATION            11/83 DBC
         DC    Y(ID#03VLN)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#03V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'@ZZ47610'         00000E          DC    C'@ZZ47610'
*                                                  DC    C'&SYSDATE'
         DC    C'07/09/80'         000016+         DC    C'07/09/80'
*                                  ************************************
         SPACE 1                                              11/83 DBC
ID#03VLN EQU   *-ID#03V            VERIFY LENGTH              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SRCH#03  DS    0H                                             11/83 DBC
         DC    Y(X'4B2')           VERIFY LOCATION            11/83 DBC
         DC    Y(SRCH#03L)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#03V DS    0H                  0004B2 SRCHPDS  EQU   *
         BAL   R14,X'43A'(,R12)    0004B2          BAL   RSUBR,FIRSTMTY
         SR    R0,R0               0004B6          SR    R0,R0
         IC    R0,X'141'(,R13)     0004B8 SRCHTTR  IC    R0,CONCAT#
*                                        ******************************
*                                        * NOTE, "SRCHTTR" IS NOT     *
*                                        * REFERENCED IN IGC018, SO   *
*                                        * NO PROBLEM EXISTS HERE.    *
*                                        ******************************
         TM    X'61'(R6),X'80'     0004BC          TM    EXSFLG,EXSSYDC
*                                  ************************************
         SPACE 1                                              11/83 DBC
SRCH#03L EQU   *-SRCH#03V          VERIFY LENGTH              11/83 DBC
         #TEST SIZE=(SRCH#03L,GE,SRCHPOHL)                    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DFND#03  DS    0H                                             11/83 DBC
         DC    Y(X'6A0')           VERIFY LOCATION            11/83 DBC
         DC    Y(DFND#03L)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
DFND#03V MVC   X'8'(3,R7),X'8'(R8) 0006A0 DFOUND   MVC   PDS2TTRP,PDS1T
         IC    R4,X'B'(,R8)        0006A6          IC    RX,PDS1INDC
         NR    R4,R14              0006AA          NR    RX,RZ
         LA    R5,X'E'             0006AC          LA    RY,PDS2USRD-PD
         LCR   R5,R5               0006B0          LCR   RY,RY
         AH    R5,X'2'(,R10)       0006B2          AH    RY,BLDELEN
*                                  ************************************
         SPACE 1                                              11/83 DBC
DFND#03L EQU   *-DFND#03V          VERIFY LENGTH              11/83 DBC
         #TEST SIZE=(DFND#03L,GE,DFOUNDHL)                    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DOFF#03  DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              11/83 DBC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              11/83 DBC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'141'(R13))      000141 CONCAT#  DS    FL1
         SPACE 1                                              11/83 DBC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              11/83 DBC
         #TEST SIZE=(*-DOFF#03,EQ,FIELDSLN)                   11/83 DBC
         EJECT ,                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        MODULE: IGC018                                     * 11/83 DBC
*        PRODUCT: DF/DS (5740-AM7)                          * 11/83 DBC
*        LEVEL: 8303                                        * 11/83 DBC
*        PTF: UZ61168 (VARIATION "@HZA")                    * 05/84 DBC
*                                                           * 11/83 DBC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 11/83 DBC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 11/83 DBC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
VERSN#04 CSECT ,                                              11/83 DBC
         DC    A(ID#04)            --> VERSION VERIFIER       11/83 DBC
         DC    A(SRCH#04)          --> ORIGINAL "SRCHPDS" COD 11/83 DBC
         DC    A(DFND#04)          --> ORIGINAL "DFOUND" CODE 11/83 DBC
         DC    A(DOFF#04)          --> IBM DATA FIELDS DESCRIPTORS  DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
ID#04    DS    0H                                             11/83 DBC
         DC    Y(X'6')             VERIFY LOCATION            11/83 DBC
         DC    Y(ID#04VLN)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#04V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'    @HZA'         00000E          DC    C'    @HZA'
*                                                  DC    C'&SYSDATE'
         DC    C'11/19/82'         000016+         DC    C'11/19/82'
         DC    C'5740-AM7'         00001E          DC    C'5740-AM7 ---
*                                  ************************************
         SPACE 1                                              11/83 DBC
ID#04VLN EQU   *-ID#04V            VERIFY LENGTH              11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
SRCH#04  DS    0H                                             11/83 DBC
         DC    Y(X'58C')           VERIFY LOCATION            11/83 DBC
         DC    Y(SRCH#04L)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#04V DS    0H                  00058C SRCHPDS  EQU   *
         BAL   R14,X'514'(,R12)    00058C          BAL   RSUBR,FIRSTMTY
         SR    R0,R0               000590          SR    R0,R0
         IC    R0,X'159'(,R13)     000592 SRCHTTR  IC    R0,CONCAT#
*                                        ******************************
*                                        * NOTE, "SRCHTTR" IS NOT     *
*                                        * REFERENCED IN IGC018, SO   *
*                                        * NO PROBLEM EXISTS HERE.    *
*                                        ******************************
         TM    X'61'(R6),X'80'     000596          TM    EXSFLG,EXSSYDC
*                                  ************************************
         SPACE 1                                              11/83 DBC
SRCH#04L EQU   *-SRCH#04V          VERIFY LENGTH              11/83 DBC
         #TEST SIZE=(SRCH#04L,GE,SRCHPOHL)                    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DFND#04  DS    0H                                             11/83 DBC
         DC    Y(X'808')           VERIFY LOCATION            11/83 DBC
         DC    Y(DFND#04L)         VERIFY LENGTH              11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
DFND#04V MVC   X'8'(3,R7),X'8'(R8) 000808 DFOUND   MVC   PDS2TTRP,PDS1T
         IC    R4,X'B'(,R8)        00080E          IC    RX,PDS1INDC
         NR    R4,R14              000812          NR    RX,RZ
         LA    R5,X'E'             000814          LA    RY,PDS2USRD-PD
         LCR   R5,R5               000818          LCR   RY,RY
         AH    R5,X'2'(,R10)       00081A          AH    RY,BLDELEN
*                                  ************************************
         SPACE 1                                              11/83 DBC
DFND#04L EQU   *-DFND#04V          VERIFY LENGTH              11/83 DBC
         #TEST SIZE=(DFND#04L,GE,DFOUNDHL)                    11/83 DBC
         SPACE 3                                              11/83 DBC
************************************************************* 11/83 DBC
*                                                           * 11/83 DBC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 11/83 DBC
*        DSECT.                                             * 11/83 DBC
*                                                           * 11/83 DBC
************************************************************* 11/83 DBC
         SPACE 1                                              11/83 DBC
DOFF#04  DS    0H                                             11/83 DBC
         SPACE 1                                              11/83 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              11/83 DBC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              11/83 DBC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'159'(R13))      000159 CONCAT#  DS    FL1
         SPACE 1                                              11/83 DBC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              11/83 DBC
         #TEST SIZE=(*-DOFF#04,EQ,FIELDSLN)                   11/83 DBC
         EJECT ,                                              04/84 JLC
************************************************************* 04/84 JLC
*                                                           * 04/84 JLC
*        MODULE: IGC018                                     * 04/84 JLC
*        PRODUCT: DF/DS (5740-AM7)                          * 04/84 JLC
*        LEVEL: 8303                                        * 04/84 JLC
*        PTF: UZ61167                                       * 04/84 JLC
*                                                           * 04/84 JLC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 04/84 JLC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 04/84 JLC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 04/84 JLC
*        DSECT.                                             * 04/84 JLC
*                                                           * 04/84 JLC
*        PREPARED 04/20/84 BY J.CALLEN AT U OF C            * 04/84 JLC
*                                                           * 04/84 JLC
************************************************************* 04/84 JLC
         SPACE 1                                              04/84 JLC
VERSN#05 CSECT ,                                              04/84 JLC
         DC    A(ID#05)            --> VERSION VERIFIER       04/84 JLC
         DC    A(SRCH#05)          --> ORIGINAL "SRCHPDS" COD 04/84 JLC
         DC    A(DFND#05)          --> ORIGINAL "DFOUND" CODE 04/84 JLC
         DC    A(DOFF#05)          --> IBM DATA FIELDS DESCRIPTORS  JLC
         SPACE 3                                              04/84 JLC
************************************************************* 04/84 JLC
*                                                           * 04/84 JLC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 04/84 JLC
*        DSECT.                                             * 04/84 JLC
*                                                           * 04/84 JLC
************************************************************* 04/84 JLC
         SPACE 1                                              04/84 JLC
ID#05    DS    0H                                             04/84 JLC
         DC    Y(X'6')             VERIFY LOCATION            04/84 JLC
         DC    Y(ID#05VLN)         VERIFY LENGTH              04/84 JLC
         SPACE 1                                              04/84 JLC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#05V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'@ZA66915'         00000E          DC    C'ZA66915A'
*                                                  DC    C'&SYSDATE'
         DC    C'11/19/82'         000016+         DC    C'11/19/82'
         DC    C'5740-AM7'         00001E          DC    C'5740-AM7 ---
*                                  ************************************
         SPACE 1                                              04/84 JLC
ID#05VLN EQU   *-ID#05V            VERIFY LENGTH              04/84 JLC
         SPACE 3                                              04/84 JLC
************************************************************* 04/84 JLC
*                                                           * 04/84 JLC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 04/84 JLC
*                                                           * 04/84 JLC
************************************************************* 04/84 JLC
         SPACE 1                                              04/84 JLC
SRCH#05  DS    0H                                             04/84 JLC
         DC    Y(X'57A')           VERIFY LOCATION            04/84 JLC
         DC    Y(SRCH#05L)         VERIFY LENGTH              04/84 JLC
         SPACE 1                                              04/84 JLC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#05V DS    0H                  00057A SRCHPDS  EQU   *
         BAL   R14,X'502'(,R12)    00057A          BAL   RSUBR,FIRSTMTY
         TM    X'61'(R6),X'80'     00057E          TM    EXSFLG,EXSSYDC
         BO    X'588'(,R12)        000582          BO    SRCHKYOK
*                                  ************************************
         SPACE 1                                              04/84 JLC
SRCH#05L EQU   *-SRCH#05V          VERIFY LENGTH              04/84 JLC
         #TEST SIZE=(SRCH#05L,GE,SRCHPOHL)                    04/84 JLC
         SPACE 3                                              04/84 JLC
************************************************************* 04/84 JLC
*                                                           * 04/84 JLC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 04/84 JLC
*                                                           * 04/84 JLC
************************************************************* 04/84 JLC
         SPACE 1                                              04/84 JLC
DFND#05  DS    0H                                             04/84 JLC
         DC    Y(X'7CC')           VERIFY LOCATION            04/84 JLC
         DC    Y(DFND#05L)         VERIFY LENGTH              04/84 JLC
         SPACE 1                                              04/84 JLC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
DFND#05V MVC   X'8'(3,R7),X'8'(R8) 0007CC DFOUND   MVC   PDS2TTRP,PDS1T
         IC    R4,X'B'(,R8)        0007D2          IC    RX,PDS1INDC
         NR    R4,R14              0007D6          NR    RX,RZ
         LA    R5,X'E'             0007D8          LA    RY,PDS2USRD-PD
         LCR   R5,R5               0007DC          LCR   RY,RY
         AH    R5,X'2'(,R10)       0007DE          AH    RY,BLDELEN
*                                  ************************************
         SPACE 1                                              04/84 JLC
DFND#05L EQU   *-DFND#05V          VERIFY LENGTH              04/84 JLC
         #TEST SIZE=(DFND#05L,GE,DFOUNDHL)                    04/84 JLC
         SPACE 3                                              04/84 JLC
************************************************************* 04/84 JLC
*                                                           * 04/84 JLC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 04/84 JLC
*        DSECT.                                             * 04/84 JLC
*                                                           * 04/84 JLC
************************************************************* 04/84 JLC
         SPACE 1                                              04/84 JLC
DOFF#05  DS    0H                                             04/84 JLC
         SPACE 1                                              04/84 JLC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              04/84 JLC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              04/84 JLC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'141'(R13))      000141 CONCAT#  DS    FL1
         SPACE 1                                              04/84 JLC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              04/84 JLC
         #TEST SIZE=(*-DOFF#05,EQ,FIELDSLN)                   04/84 JLC
         EJECT ,                                              05/84 DBC
************************************************************* 05/84 DBC
*                                                           * 05/84 DBC
*        MODULE: IGC018                                     * 05/84 DBC
*        PRODUCT: DF/DS (5740-AM7)                          * 05/84 DBC
*        LEVEL: 8303                                        * 05/84 DBC
*        PTF: UZ61168 (VARIATION "@H2A")                    * 05/84 DBC
*                                                           * 05/84 DBC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 05/84 DBC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 05/84 DBC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 05/84 DBC
*        DSECT.                                             * 05/84 DBC
*                                                           * 05/84 DBC
************************************************************* 05/84 DBC
         SPACE 1                                              05/84 DBC
VERSN#06 CSECT ,                                              05/84 DBC
         DC    A(ID#06)            --> VERSION VERIFIER       05/84 DBC
         DC    A(SRCH#06)          --> ORIGINAL "SRCHPDS" COD 05/84 DBC
         DC    A(DFND#06)          --> ORIGINAL "DFOUND" CODE 05/84 DBC
         DC    A(DOFF#06)          --> IBM DATA FIELDS DESCRIPTORS  DBC
         SPACE 3                                              05/84 DBC
************************************************************* 05/84 DBC
*                                                           * 05/84 DBC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 05/84 DBC
*        DSECT.                                             * 05/84 DBC
*                                                           * 05/84 DBC
************************************************************* 05/84 DBC
         SPACE 1                                              05/84 DBC
ID#06    DS    0H                                             05/84 DBC
         DC    Y(X'6')             VERIFY LOCATION            05/84 DBC
         DC    Y(ID#06VLN)         VERIFY LENGTH              05/84 DBC
         SPACE 1                                              05/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#06V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'    @H2A'         00000E          DC    C'    @H2A'
*                                                  DC    C'&SYSDATE'
         DC    C'11/19/82'         000016+         DC    C'11/19/82'
         DC    C'5740-AM7'         00001E          DC    C'5740-AM7 ---
*                                  ************************************
         SPACE 1                                              05/84 DBC
ID#06VLN EQU   *-ID#06V            VERIFY LENGTH              05/84 DBC
         SPACE 3                                              05/84 DBC
************************************************************* 05/84 DBC
*                                                           * 05/84 DBC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 05/84 DBC
*                                                           * 05/84 DBC
************************************************************* 05/84 DBC
         SPACE 1                                              05/84 DBC
SRCH#06  DS    0H                                             05/84 DBC
         DC    Y(X'58C')           VERIFY LOCATION            05/84 DBC
         DC    Y(SRCH#06L)         VERIFY LENGTH              05/84 DBC
         SPACE 1                                              05/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#06V DS    0H                  00058C SRCHPDS  EQU   *
         BAL   R14,X'514'(,R12)    00058C          BAL   RSUBR,FIRSTMTY
         SR    R0,R0               000590          SR    R0,R0
         IC    R0,X'159'(,R13)     000592 SRCHTTR  IC    R0,CONCAT#
*                                        ******************************
*                                        * NOTE, "SRCHTTR" IS NOT     *
*                                        * REFERENCED IN IGC018, SO   *
*                                        * NO PROBLEM EXISTS HERE.    *
*                                        ******************************
         TM    X'61'(R6),X'80'     000596          TM    EXSFLG,EXSSYDC
*                                  ************************************
         SPACE 1                                              05/84 DBC
SRCH#06L EQU   *-SRCH#06V          VERIFY LENGTH              05/84 DBC
         #TEST SIZE=(SRCH#06L,GE,SRCHPOHL)                    05/84 DBC
         SPACE 3                                              05/84 DBC
************************************************************* 05/84 DBC
*                                                           * 05/84 DBC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 05/84 DBC
*                                                           * 05/84 DBC
************************************************************* 05/84 DBC
         SPACE 1                                              05/84 DBC
DFND#06  DS    0H                                             05/84 DBC
         DC    Y(X'808')           VERIFY LOCATION            05/84 DBC
         DC    Y(DFND#06L)         VERIFY LENGTH              05/84 DBC
         SPACE 1                                              05/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
DFND#06V MVC   X'8'(3,R7),X'8'(R8) 000808 DFOUND   MVC   PDS2TTRP,PDS1T
         IC    R4,X'B'(,R8)        00080E          IC    RX,PDS1INDC
         NR    R4,R14              000812          NR    RX,RZ
         LA    R5,X'E'             000814          LA    RY,PDS2USRD-PD
         LCR   R5,R5               000818          LCR   RY,RY
         AH    R5,X'2'(,R10)       00081A          AH    RY,BLDELEN
*                                  ************************************
         SPACE 1                                              05/84 DBC
DFND#06L EQU   *-DFND#06V          VERIFY LENGTH              05/84 DBC
         #TEST SIZE=(DFND#06L,GE,DFOUNDHL)                    05/84 DBC
         SPACE 3                                              05/84 DBC
************************************************************* 05/84 DBC
*                                                           * 05/84 DBC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 05/84 DBC
*        DSECT.                                             * 05/84 DBC
*                                                           * 05/84 DBC
************************************************************* 05/84 DBC
         SPACE 1                                              05/84 DBC
DOFF#06  DS    0H                                             05/84 DBC
         SPACE 1                                              05/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              05/84 DBC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              05/84 DBC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'159'(R13))      000159 CONCAT#  DS    FL1
         SPACE 1                                              05/84 DBC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              05/84 DBC
         #TEST SIZE=(*-DOFF#06,EQ,FIELDSLN)                   05/84 DBC
         EJECT ,                                              08/84 DBC
************************************************************* 08/84 DBC
*                                                           * 08/84 DBC
*        MODULE: IGC018                                     * 08/84 DBC
*        PRODUCT: DFP (5665-295/A)                          * 08/84 DBC
*                                                           * 08/84 DBC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 08/84 DBC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 08/84 DBC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 08/84 DBC
*        DSECT.                                             * 08/84 DBC
*                                                           * 08/84 DBC
************************************************************* 08/84 DBC
         SPACE 1                                              08/84 DBC
VERSN#07 CSECT ,                                              08/84 DBC
         DC    A(ID#07)            --> VERSION VERIFIER       08/84 DBC
         DC    A(SRCH#07)          --> ORIGINAL "SRCHPDS" COD 08/84 DBC
         DC    A(FINDK#07)         --> ORIGINAL "FINDKEY" COD 08/84 DBC
         DC    A(DOFF#07)          --> IBM DATA FIELDS DESCRIPTORS  DBC
         SPACE 3                                              08/84 DBC
************************************************************* 08/84 DBC
*                                                           * 08/84 DBC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 08/84 DBC
*        DSECT.                                             * 08/84 DBC
*                                                           * 08/84 DBC
************************************************************* 08/84 DBC
         SPACE 1                                              08/84 DBC
ID#07    DS    0H                                             08/84 DBC
         DC    Y(X'6')             VERIFY LOCATION            08/84 DBC
         DC    Y(ID#07VLN)         VERIFY LENGTH              08/84 DBC
         SPACE 1                                              08/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#07V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'JDQ1110 '         00000E          DC    C'JDQ1110 '
*                                                  DC    C'&SYSDATE'
         DC    C'10/19/83'         000016+         DC    C'10/19/83'
         DC    C'5665-295'         00001E          DC    C'5665-295 ---
*                                  ************************************
         SPACE 1                                              08/84 DBC
ID#07VLN EQU   *-ID#07V            VERIFY LENGTH              08/84 DBC
         SPACE 3                                              08/84 DBC
************************************************************* 08/84 DBC
*                                                           * 08/84 DBC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 08/84 DBC
*                                                           * 08/84 DBC
************************************************************* 08/84 DBC
         SPACE 1                                              08/84 DBC
SRCH#07  DS    0H                                             08/84 DBC
         DC    Y(X'52C')           VERIFY LOCATION            08/84 DBC
         DC    Y(SRCH#07L)         VERIFY LENGTH              08/84 DBC
         SPACE 1                                              08/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#07V DS    0H                  00052C SRCHPDS  EQU   *
         MVI   X'158'(R13),0       00052C          MVI   ERCODE,0
         LH    R2,X'0'(,R10)       000530          LH    RSULEFT,BLDENT
         LA    R7,X'4'(,R10)       000534          LA    RPDS2,BLDENT
*                                  ************************************
         SPACE 1                                              08/84 DBC
SRCH#07L EQU   *-SRCH#07V          VERIFY LENGTH              08/84 DBC
         #TEST SIZE=(SRCH#07L,GE,SRCHPOHL)                    08/84 DBC
         SPACE 3                                              08/84 DBC
************************************************************* 08/84 DBC
*                                                           * 08/84 DBC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 08/84 DBC
*        NOTE, IN THIS VERSION OF IGC018, THE TRAP IS       * 08/84 DBC
*        LOCATED AT LABEL "FINDKEY" WHICH IS NOW JUST PAST  * 08/84 DBC
*        LABEL "DFOUND".                                    * 08/84 DBC
*                                                           * 08/84 DBC
************************************************************* 08/84 DBC
         SPACE 1                                              08/84 DBC
FINDK#07 DS    0H                                             08/84 DBC
         DC    Y(X'7BC')           VERIFY LOCATION            08/84 DBC
         DC    Y(FIND#07L)         VERIFY LENGTH              08/84 DBC
         SPACE 1                                              08/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  0007BC FINDKEY  EQU   *
FIND#07V MVC   X'8'(3,R7),X'8'(R8) 0007BC          MVC   PDS2TTRP,PDS1T
         IC    R4,X'B'(,R8)        0007C2          IC    RX,PDS1INDC
         NR    R4,R14              0007C6          NR    RX,RZ
         LA    R5,X'E'             0007C8          LA    RY,PDS2USRD-PD
         LCR   R5,R5               0007CC          LCR   RY,RY
         AH    R5,X'2'(,R10)       0007CE          AH    RY,BLDELEN
*                                  ************************************
         SPACE 1                                              08/84 DBC
FIND#07L EQU   *-FIND#07V          VERIFY LENGTH              08/84 DBC
         #TEST SIZE=(FIND#07L,GE,DFOUNDHL)                    08/84 DBC
         SPACE 3                                              08/84 DBC
************************************************************* 08/84 DBC
*                                                           * 08/84 DBC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 08/84 DBC
*        DSECT.                                             * 08/84 DBC
*                                                           * 08/84 DBC
************************************************************* 08/84 DBC
         SPACE 1                                              08/84 DBC
DOFF#07  DS    0H                                             08/84 DBC
         SPACE 1                                              08/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              08/84 DBC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              08/84 DBC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'159'(R13))      000159 CONCAT#  DS    FL1
         SPACE 1                                              08/84 DBC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              08/84 DBC
         #TEST SIZE=(*-DOFF#07,EQ,FIELDSLN)                   08/84 DBC
         EJECT ,                                              06/84 WRH
************************************************************* 06/84 WRH
*                                                           * 06/84 WRH
*        MODULE: IGC018                                     * 06/84 WRH
*        PRODUCT: DF/DS (5740-AM7)                          * 06/84 WRH
*        LEVEL: 8402                                        * 06/84 WRH
*        PTF: UZ69197                                       * 06/84 WRH
*        APAR: AZ66915                                      * 06/84 WRH
*                                                           * 06/84 WRH
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 06/84 WRH
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 06/84 WRH
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 06/84 WRH
*        DSECT.                                             * 06/84 WRH
*                                                           * 06/84 WRH
************************************************************* 06/84 WRH
         SPACE 1                                              06/84 WRH
VERSN#08 CSECT ,                                              06/84 WRH
         DC    A(ID#08)            --> VERSION VERIFIER       06/84 WRH
         DC    A(SRCH#08)          --> ORIGINAL "SRCHPDS" COD 06/84 WRH
         DC    A(DFND#08)          --> ORIGINAL "DFOUND" CODE 06/84 WRH
         DC    A(DOFF#08)          --> IBM DATA FIELDS DESCRIPTORS  WRH
         SPACE 3                                              06/84 WRH
************************************************************* 06/84 WRH
*                                                           * 06/84 WRH
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 06/84 WRH
*        DSECT.                                             * 06/84 WRH
*                                                           * 06/84 WRH
************************************************************* 06/84 WRH
         SPACE 1                                              06/84 WRH
ID#08    DS    0H                                             06/84 WRH
         DC    Y(X'6')             VERIFY LOCATION            06/84 WRH
         DC    Y(ID#08VLN)         VERIFY LENGTH              06/84 WRH
         SPACE 1                                              06/84 WRH
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#08V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'@ZA66915'         00000E          DC    C'@ZA66915'
*                                                  DC    C'&SYSDATE'
         DC    C'11/22/83'         000016+         DC    C'11/22/83'
         DC    C'5740-AM7'         00001E          DC    C'5740-AM7 ---
*                                  ************************************
         SPACE 1                                              06/84 WRH
ID#08VLN EQU   *-ID#08V            VERIFY LENGTH              06/84 WRH
         SPACE 3                                              06/84 WRH
************************************************************* 06/84 WRH
*                                                           * 06/84 WRH
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 06/84 WRH
*                                                           * 06/84 WRH
************************************************************* 06/84 WRH
         SPACE 1                                              06/84 WRH
SRCH#08  DS    0H                                             06/84 WRH
         DC    Y(X'57A')           VERIFY LOCATION            06/84 WRH
         DC    Y(SRCH#08L)         VERIFY LENGTH              06/84 WRH
         SPACE 1                                              06/84 WRH
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#08V DS    0H                  00057A SRCHPDS  EQU   *
         BAL   R14,X'502'(,R12)    00057A          BAL   RSUBR,FIRSTMTY
         TM    X'61'(R6),X'80'     00057E          TM    EXSFLG,EXSSYCD
         BO    X'588'(,R12)        000582          BO    SRCHKYOK
*                                  ************************************
         SPACE 1                                              06/84 WRH
SRCH#08L EQU   *-SRCH#08V          VERIFY LENGTH              06/84 WRH
         #TEST SIZE=(SRCH#08L,GE,SRCHPOHL)                    06/84 WRH
         SPACE 3                                              06/84 WRH
************************************************************* 06/84 WRH
*                                                           * 06/84 WRH
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 06/84 WRH
*                                                           * 06/84 WRH
************************************************************* 06/84 WRH
         SPACE 1                                              06/84 WRH
DFND#08  DS    0H                                             06/84 WRH
         DC    Y(X'7CC')           VERIFY LOCATION            06/84 WRH
         DC    Y(DFND#08L)         VERIFY LENGTH              06/84 WRH
         SPACE 1                                              06/84 WRH
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
DFND#08V MVC   X'8'(3,R7),X'8'(R8) 0007CC DFOUND   MVC   PDS2TTRP,PDS1T
         IC    R4,X'B'(,R8)        0007D2          IC    RX,PDS1INDC
         NR    R4,R14              0007D6          NR    RX,RZ
         LA    R5,X'E'             0007D8          LA    RY,PDS2USRD-PD
         LCR   R5,R5               0007DC          LCR   RY,RY
         AH    R5,X'2'(,R10)       0007DE          AH    RY,BLDELEN
*                                  ************************************
         SPACE 1                                              06/84 WRH
DFND#08L EQU   *-DFND#08V          VERIFY LENGTH              06/84 WRH
         #TEST SIZE=(DFND#08L,GE,DFOUNDHL)                    06/84 WRH
         SPACE 3                                              06/84 WRH
************************************************************* 06/84 WRH
*                                                           * 06/84 WRH
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 06/84 WRH
*        DSECT.                                             * 06/84 WRH
*                                                           * 06/84 WRH
************************************************************* 06/84 WRH
         SPACE 1                                              06/84 WRH
DOFF#08  DS    0H                                             06/84 WRH
         SPACE 1                                              06/84 WRH
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              06/84 WRH
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              06/84 WRH
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'141'(R13))      000141 CONCAT#  DS    FL1
         SPACE 1                                              06/84 WRH
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              06/84 WRH
         #TEST SIZE=(*-DOFF#08,EQ,FIELDSLN)                   06/84 WRH
         EJECT ,                                              09/84 DBC
************************************************************* 09/84 DBC
*                                                           * 09/84 DBC
*        MODULE: IGC018                                     * 09/84 DBC
*        PRODUCT: DFP (5665-295/A)                          * 09/84 DBC
*                                                           * 09/84 DBC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 09/84 DBC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 09/84 DBC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 09/84 DBC
*        DSECT.                                             * 09/84 DBC
*                                                           * 09/84 DBC
************************************************************* 09/84 DBC
         SPACE 1                                              09/84 DBC
VERSN#09 CSECT ,                                              09/84 DBC
         DC    A(ID#09)            --> VERSION VERIFIER       09/84 DBC
         DC    A(SRCH#09)          --> ORIGINAL "SRCHPDS" COD 09/84 DBC
         DC    A(FINDK#09)         --> ORIGINAL "FINDKEY" COD 09/84 DBC
         DC    A(DOFF#09)          --> IBM DATA FIELDS DESCRIPTORS  DBC
         SPACE 3                                              09/84 DBC
************************************************************* 09/84 DBC
*                                                           * 09/84 DBC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 09/84 DBC
*        DSECT.                                             * 09/84 DBC
*                                                           * 09/84 DBC
************************************************************* 09/84 DBC
         SPACE 1                                              09/84 DBC
ID#09    DS    0H                                             09/84 DBC
         DC    Y(X'6')             VERIFY LOCATION            09/84 DBC
         DC    Y(ID#09VLN)         VERIFY LENGTH              09/84 DBC
         SPACE 1                                              09/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#09V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'ZA76850 '         00000E          DC    C'ZA76850 '
*                                                  DC    C'&SYSDATE'
         DC    C'03/28/84'         000016+         DC    C'03/28/84'
         DC    C'5665-295'         00001E          DC    C'5665-295 ---
*                                  ************************************
         SPACE 1                                              09/84 DBC
ID#09VLN EQU   *-ID#09V            VERIFY LENGTH              09/84 DBC
         SPACE 3                                              09/84 DBC
************************************************************* 09/84 DBC
*                                                           * 09/84 DBC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 09/84 DBC
*                                                           * 09/84 DBC
************************************************************* 09/84 DBC
         SPACE 1                                              09/84 DBC
SRCH#09  DS    0H                                             09/84 DBC
         DC    Y(X'52C')           VERIFY LOCATION            09/84 DBC
         DC    Y(SRCH#09L)         VERIFY LENGTH              09/84 DBC
         SPACE 1                                              09/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#09V DS    0H                  00052C SRCHPDS  EQU   *
         MVI   X'158'(R13),0       00052C          MVI   ERCODE,0
         LH    R2,X'0'(,R10)       000530          LH    RSULEFT,BLDENT
         LA    R7,X'4'(,R10)       000534          LA    RPDS2,BLDENT
*                                  ************************************
         SPACE 1                                              09/84 DBC
SRCH#09L EQU   *-SRCH#09V          VERIFY LENGTH              09/84 DBC
         #TEST SIZE=(SRCH#09L,GE,SRCHPOHL)                    09/84 DBC
         SPACE 3                                              09/84 DBC
************************************************************* 09/84 DBC
*                                                           * 09/84 DBC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 09/84 DBC
*        NOTE, IN THIS VERSION OF IGC018, THE TRAP IS       * 09/84 DBC
*        LOCATED AT LABEL "FINDKEY" WHICH IS NOW JUST PAST  * 09/84 DBC
*        LABEL "DFOUND".                                    * 09/84 DBC
*                                                           * 09/84 DBC
************************************************************* 09/84 DBC
         SPACE 1                                              09/84 DBC
FINDK#09 DS    0H                                             09/84 DBC
         DC    Y(X'7BC')           VERIFY LOCATION            09/84 DBC
         DC    Y(FIND#09L)         VERIFY LENGTH              09/84 DBC
         SPACE 1                                              09/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  0007BC FINDKEY  EQU   *
FIND#09V MVC   X'8'(3,R7),X'8'(R8) 0007BC          MVC   PDS2TTRP,PDS1T
         IC    R4,X'B'(,R8)        0007C2          IC    RX,PDS1INDC
         NR    R4,R14              0007C6          NR    RX,RZ
         LA    R5,X'E'             0007C8          LA    RY,PDS2USRD-PD
         LCR   R5,R5               0007CC          LCR   RY,RY
         AH    R5,X'2'(,R10)       0007CE          AH    RY,BLDELEN
*                                  ************************************
         SPACE 1                                              09/84 DBC
FIND#09L EQU   *-FIND#09V          VERIFY LENGTH              09/84 DBC
         #TEST SIZE=(FIND#09L,GE,DFOUNDHL)                    09/84 DBC
         SPACE 3                                              09/84 DBC
************************************************************* 09/84 DBC
*                                                           * 09/84 DBC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 09/84 DBC
*        DSECT.                                             * 09/84 DBC
*                                                           * 09/84 DBC
************************************************************* 09/84 DBC
         SPACE 1                                              09/84 DBC
DOFF#09  DS    0H                                             09/84 DBC
         SPACE 1                                              09/84 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              09/84 DBC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              09/84 DBC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'159'(R13))      000159 CONCAT#  DS    FL1
         SPACE 1                                              09/84 DBC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              09/84 DBC
         #TEST SIZE=(*-DOFF#09,EQ,FIELDSLN)                   09/84 DBC
         EJECT ,                                              01/85 DBC
************************************************************* 01/85 DBC
*                                                           * 01/85 DBC
*        MODULE: IGC018                                     * 01/85 DBC
*        PRODUCT: DF/DS (5740-AM7)                          * 01/85 DBC
*        LEVEL: 8406                                        * 01/85 DBC
*        PTF: UZ70857                                       * 01/85 DBC
*                                                           * 01/85 DBC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 01/85 DBC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 01/85 DBC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 01/85 DBC
*        DSECT.                                             * 01/85 DBC
*                                                           * 01/85 DBC
************************************************************* 01/85 DBC
         SPACE 1                                              01/85 DBC
VERSN#10 CSECT ,                                              01/85 DBC
         DC    A(ID#10)            --> VERSION VERIFIER       01/85 DBC
         DC    A(SRCH#10)          --> ORIGINAL "SRCHPDS" COD 01/85 DBC
         DC    A(DFND#10)          --> ORIGINAL "DFOUND" CODE 01/85 DBC
         DC    A(DOFF#10)          --> IBM DATA FIELDS DESCRIPTORS  DBC
         SPACE 3                                              01/85 DBC
************************************************************* 01/85 DBC
*                                                           * 01/85 DBC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 01/85 DBC
*        DSECT.                                             * 01/85 DBC
*                                                           * 01/85 DBC
************************************************************* 01/85 DBC
         SPACE 1                                              01/85 DBC
ID#10    DS    0H                                             01/85 DBC
         DC    Y(X'6')             VERIFY LOCATION            01/85 DBC
         DC    Y(ID#10VLN)         VERIFY LENGTH              01/85 DBC
         SPACE 1                                              01/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#10V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'@ZA74904'         00000E          DC    C'@ZA74904'
*                                                  DC    C'&SYSDATE'
         DC    C'03/27/84'         000016+         DC    C'03/27/84'
         DC    C'5740-AM7'         00001E          DC    C'5740-AM7 ---
*                                  ************************************
         SPACE 1                                              01/85 DBC
ID#10VLN EQU   *-ID#10V            VERIFY LENGTH              01/85 DBC
         SPACE 3                                              01/85 DBC
************************************************************* 01/85 DBC
*                                                           * 01/85 DBC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 01/85 DBC
*                                                           * 01/85 DBC
************************************************************* 01/85 DBC
         SPACE 1                                              01/85 DBC
SRCH#10  DS    0H                                             01/85 DBC
         DC    Y(X'58C')           VERIFY LOCATION            01/85 DBC
         DC    Y(SRCH#10L)         VERIFY LENGTH              01/85 DBC
         SPACE 1                                              01/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#10V DS    0H                  00058C SRCHPDS  EQU   *
         BAL   R14,X'514'(,R12)    00058C          BAL   RSUBR,FIRSTMTY
         SR    R0,R0               000590          SR    R0,R001/85 DBC
         IC    R0,X'159'(,R13)     000592 SRCHTTR  IC    R0,CONCAT#
*                                        ******************************
*                                        * NOTE, "SRCHTTR" IS NOT     *
*                                        * REFERENCED IN IGC018, SO   *
*                                        * NO PROBLEM EXISTS HERE.    *
*                                        ******************************
         TM    X'61'(R6),X'80'     000596          TM    EXSFLG,EXSSYDC
*                                  ************************************
         SPACE 1                                              01/85 DBC
SRCH#10L EQU   *-SRCH#10V          VERIFY LENGTH              01/85 DBC
         #TEST SIZE=(SRCH#10L,GE,SRCHPOHL)                    01/85 DBC
         SPACE 3                                              01/85 DBC
************************************************************* 01/85 DBC
*                                                           * 01/85 DBC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 01/85 DBC
*                                                           * 01/85 DBC
************************************************************* 01/85 DBC
         SPACE 1                                              01/85 DBC
DFND#10  DS    0H                                             01/85 DBC
         DC    Y(X'808')           VERIFY LOCATION            01/85 DBC
         DC    Y(DFND#10L)         VERIFY LENGTH              01/85 DBC
         SPACE 1                                              01/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
DFND#10V MVC   X'8'(3,R7),X'8'(R8) 000808 DFOUND   MVC   PDS2TTRP,PDS1T
         IC    R4,X'B'(,R8)        00080E          IC    RX,PDS1INDC
         NR    R4,R14              000812          NR    RX,RZ01/85 DBC
         LA    R5,X'E'             000814          LA    RY,PDS2USRD-PD
         LCR   R5,R5               000818          LCR   RY,RY01/85 DBC
         AH    R5,X'2'(,R10)       00081A          AH    RY,BLDELEN
*                                  ************************************
         SPACE 1                                              01/85 DBC
DFND#10L EQU   *-DFND#10V          VERIFY LENGTH              01/85 DBC
         #TEST SIZE=(DFND#10L,GE,DFOUNDHL)                    01/85 DBC
         SPACE 3                                              01/85 DBC
************************************************************* 01/85 DBC
*                                                           * 01/85 DBC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 01/85 DBC
*        DSECT.                                             * 01/85 DBC
*                                                           * 01/85 DBC
************************************************************* 01/85 DBC
         SPACE 1                                              01/85 DBC
DOFF#10  DS    0H                                             01/85 DBC
         SPACE 1                                              01/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              01/85 DBC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              01/85 DBC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL25601/85 DBC
         DC    S(X'159'(R13))      000159 CONCAT#  DS    FL1
         SPACE 1                                              01/85 DBC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              01/85 DBC
         #TEST SIZE=(*-DOFF#10,EQ,FIELDSLN)                   01/85 DBC
         EJECT ,                                              10/85 DBC
************************************************************* 10/85 DBC
*                                                           * 10/85 DBC
*        MODULE: IGC018                                     * 10/85 DBC
*        PRODUCT: DFP (5665-295/A)                          * 10/85 DBC
*        PTF: UZ38298                                       * 10/85 DBC
*        PUT: 8505                                          * 10/85 DBC
*                                                           * 10/85 DBC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 10/85 DBC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 10/85 DBC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 10/85 DBC
*        DSECT.                                             * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         SPACE 1                                              10/85 DBC
VERSN#11 CSECT ,                                              10/85 DBC
         DC    A(ID#11)            --> VERSION VERIFIER       10/85 DBC
         DC    A(SRCH#11)          --> ORIGINAL "SRCHPDS" COD 10/85 DBC
         DC    A(FINDK#11)         --> ORIGINAL "FINDKEY" COD 10/85 DBC
         DC    A(DOFF#11)          --> IBM DATA FIELDS DESCRIPTORS  DBC
         SPACE 3                                              10/85 DBC
************************************************************* 10/85 DBC
*                                                           * 10/85 DBC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 10/85 DBC
*        DSECT.                                             * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         SPACE 1                                              10/85 DBC
ID#11    DS    0H                                             10/85 DBC
         DC    Y(X'6')             VERIFY LOCATION            10/85 DBC
         DC    Y(ID#11VLN)         VERIFY LENGTH              10/85 DBC
         SPACE 1                                              10/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#11V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'ZA83145 '         00000E          DC    C'ZA83145 '
*                                                  DC    C'&SYSDATE'
         DC    C'03/19/85'         000016+         DC    C'03/19/85'
         DC    C'5665-295'         00001E          DC    C'5665-295 ---
*                                  ************************************
         SPACE 1                                              10/85 DBC
ID#11VLN EQU   *-ID#11V            VERIFY LENGTH              10/85 DBC
         SPACE 3                                              10/85 DBC
************************************************************* 10/85 DBC
*                                                           * 10/85 DBC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         SPACE 1                                              10/85 DBC
SRCH#11  DS    0H                                             10/85 DBC
         DC    Y(X'52C')           VERIFY LOCATION            10/85 DBC
         DC    Y(SRCH#11L)         VERIFY LENGTH              10/85 DBC
         SPACE 1                                              10/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#11V DS    0H                  00052C SRCHPDS  EQU   *
         MVI   X'160'(R13),0       00052C          MVI   ERCODE,0
*                                  000530          MODESET KEYADDR=EXSK
         IC    R3,X'60'(,R6)       000530+         IC    3,EXSKEY
         SPKA  0(R3)               000534+         SPKA  0(3)
*                                  ************************************
         SPACE 1                                              10/85 DBC
SRCH#11L EQU   *-SRCH#11V          VERIFY LENGTH              10/85 DBC
         #TEST SIZE=(SRCH#11L,GE,SRCHPOHL)                    10/85 DBC
         SPACE 3                                              10/85 DBC
************************************************************* 10/85 DBC
*                                                           * 10/85 DBC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 10/85 DBC
*        NOTE, IN THIS VERSION OF IGC018, THE TRAP IS       * 10/85 DBC
*        LOCATED AT LABEL "FINDKEY" WHICH IS NOW JUST PAST  * 10/85 DBC
*        LABEL "DFOUND".                                    * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         SPACE 1                                              10/85 DBC
FINDK#11 DS    0H                                             10/85 DBC
         DC    Y(X'7F2')           VERIFY LOCATION            10/85 DBC
         DC    Y(FIND#11L)         VERIFY LENGTH              10/85 DBC
         SPACE 1                                              10/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  0007F2 FINDKEY  EQU   *
FIND#11V STCM  R5,7,X'8'(R7)       0007F2          STCM  RY,ADDR3,PDS2T
         LA    R5,X'E'             0007F6          LA    RY,PDS2USRD-PD
         LCR   R5,R5               0007FA          LCR   RY,RY
         AH    R5,X'2'(,R10)       0007FC          AH    RY,BLDELEN
         BM    X'82C'(,R12)        000800          BM    NOMOVE
         BXLE  R4,R4,X'808'(R12)   000804          BXLE  RX,RX,EXEC
*                                  ************************************
         SPACE 1                                              10/85 DBC
FIND#11L EQU   *-FIND#11V          VERIFY LENGTH              10/85 DBC
         #TEST SIZE=(FIND#11L,GE,DFOUNDHL)                    10/85 DBC
         SPACE 3                                              10/85 DBC
************************************************************* 10/85 DBC
*                                                           * 10/85 DBC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 10/85 DBC
*        DSECT.                                             * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         SPACE 1                                              10/85 DBC
DOFF#11  DS    0H                                             10/85 DBC
         SPACE 1                                              10/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              10/85 DBC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              10/85 DBC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'161'(R13))      000161 CONCAT#  DS    FL1
         SPACE 1                                              10/85 DBC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              10/85 DBC
         #TEST SIZE=(*-DOFF#11,EQ,FIELDSLN)                   10/85 DBC
         EJECT ,                                              10/85 DBC
************************************************************* 10/85 DBC
*                                                           * 10/85 DBC
*        MODULE: IGC018                                     * 10/85 DBC
*        PRODUCT: DFP (5665-295/A)                          * 10/85 DBC
*        PTF: UZ77946                                       * 10/85 DBC
*        PUT: 8503                                          * 10/85 DBC
*                                                           * 10/85 DBC
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 10/85 DBC
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 10/85 DBC
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 10/85 DBC
*        DSECT.                                             * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         SPACE 1                                              10/85 DBC
VERSN#12 CSECT ,                                              10/85 DBC
         DC    A(ID#12)            --> VERSION VERIFIER       10/85 DBC
         DC    A(SRCH#12)          --> ORIGINAL "SRCHPDS" COD 10/85 DBC
         DC    A(FINDK#12)         --> ORIGINAL "FINDKEY" COD 10/85 DBC
         DC    A(DOFF#12)          --> IBM DATA FIELDS DESCRIPTORS  DBC
         SPACE 3                                              10/85 DBC
************************************************************* 10/85 DBC
*                                                           * 10/85 DBC
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 10/85 DBC
*        DSECT.                                             * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         SPACE 1                                              10/85 DBC
ID#12    DS    0H                                             10/85 DBC
         DC    Y(X'6')             VERIFY LOCATION            10/85 DBC
         DC    Y(ID#12VLN)         VERIFY LENGTH              10/85 DBC
         SPACE 1                                              10/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#12V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'ZA83696 '         00000E          DC    C'ZA83696 '
*                                  000016          DC    C'&SYSDATE'
         DC    C'01/06/85'         000016+         DC    C'01/06/85'
         DC    C'5665-295'         00001E          DC    C'5665-295 ---
*                                  ************************************
         SPACE 1                                              10/85 DBC
ID#12VLN EQU   *-ID#12V            VERIFY LENGTH              10/85 DBC
         SPACE 3                                              10/85 DBC
************************************************************* 10/85 DBC
*                                                           * 10/85 DBC
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         SPACE 1                                              10/85 DBC
SRCH#12  DS    0H                                             10/85 DBC
         DC    Y(X'52C')           VERIFY LOCATION            10/85 DBC
         DC    Y(SRCH#12L)         VERIFY LENGTH              10/85 DBC
         SPACE 1                                              10/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#12V DS    0H                  00052C SRCHPDS  EQU   *
         MVI   X'160'(R13),0       00052C          MVI   ERCODE,0
*                                  000530          MODESET KEYADDR=EXSK
         IC    R3,X'60'(,R6)       000530+         IC    3,EXSKEY
         SPKA  0(R3)               000534+         SPKA  0(3)
*                                  ************************************
         SPACE 1                                              10/85 DBC
SRCH#12L EQU   *-SRCH#12V          VERIFY LENGTH              10/85 DBC
         #TEST SIZE=(SRCH#12L,GE,SRCHPOHL)                    10/85 DBC
         SPACE 3                                              10/85 DBC
************************************************************* 10/85 DBC
*                                                           * 10/85 DBC
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 10/85 DBC
*        NOTE, IN THIS VERSION OF IGC018, THE TRAP IS       * 10/85 DBC
*        LOCATED AT LABEL "FINDKEY" WHICH IS NOW JUST PAST  * 10/85 DBC
*        LABEL "DFOUND".                                    * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         SPACE 1                                              10/85 DBC
FINDK#12 DS    0H                                             10/85 DBC
         DC    Y(X'7E0')           VERIFY LOCATION            10/85 DBC
         DC    Y(FIND#12L)         VERIFY LENGTH              10/85 DBC
         SPACE 1                                              10/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  0007E0 FINDKEY  EQU   *
FIND#12V STCM  R5,7,X'8'(R7)       0007E0          STCM  RY,ADDR3,PDS2T
         LA    R5,X'E'             0007E4          LA    RY,PDS2USRD-PD
         LCR   R5,R5               0007E8          LCR   RY,RY
         AH    R5,X'2'(,R10)       0007EA          AH    RY,BLDELEN
         BM    X'81A'(,R12)        0007EE          BM    NOMOVE
         BXLE  R4,R4,X'7F6'(R12)   0007F2          BXLE  RX,RX,EXEC
*                                  ************************************
         SPACE 1                                              10/85 DBC
FIND#12L EQU   *-FIND#12V          VERIFY LENGTH              10/85 DBC
         #TEST SIZE=(FIND#12L,GE,DFOUNDHL)                    10/85 DBC
         SPACE 3                                              10/85 DBC
************************************************************* 10/85 DBC
*                                                           * 10/85 DBC
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 10/85 DBC
*        DSECT.                                             * 10/85 DBC
*                                                           * 10/85 DBC
************************************************************* 10/85 DBC
         SPACE 1                                              10/85 DBC
DOFF#12  DS    0H                                             10/85 DBC
         SPACE 1                                              10/85 DBC
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              10/85 DBC
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              10/85 DBC
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'161'(R13))      000161 CONCAT#  DS    FL1
         SPACE 1                                              10/85 DBC
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              10/85 DBC
         #TEST SIZE=(*-DOFF#12,EQ,FIELDSLN)                   10/85 DBC
         EJECT ,                                              01/88 SBG
************************************************************* 01/88 SBG
*                                                           * 01/88 SBG
*        MODULE: IGC018                                     * 01/88 SBG
*        PRODUCT: DFP (5665-295/B)  VERSION 1.2             * 01/88 SBG
*        PTF: JDQ1111                                       * 01/88 SBG
*        PUT: 8705                                          * 01/88 SBG
*                                                           * 01/88 SBG
*        THE FOLLOWING VECTOR POINTS TO VARIOUS DATA AREAS  * 01/88 SBG
*        USED TO BOTH IDENTIFY AND MATCH THIS PARTICULAR    * 01/88 SBG
*        VERSION OF IGC018. IT IS MAPPED BY THE "VERSION"   * 01/88 SBG
*        DSECT.                                             * 01/88 SBG
*                                                           * 01/88 SBG
************************************************************* 01/88 SBG
         SPACE 1                                              01/88 SBG
VERSN#13 CSECT ,                                              01/88 SBG
         DC    A(ID#13)            --> VERSION VERIFIER       01/88 SBG
         DC    A(SRCH#13)          --> ORIGINAL "SRCHPDS" COD 01/88 SBG
         DC    A(FINDK#13)         --> ORIGINAL "FINDKEY" COD 01/88 SBG
         DC    A(DOFF#13)          --> IBM DATA FIELDS DESCRIPTORS  SBG
         SPACE 3                                              01/88 SBG
************************************************************* 01/88 SBG
*                                                           * 01/88 SBG
*        MODULE IDENTIFIER CODE. MAPPED BY THE "ORIGINAL"   * 01/88 SBG
*        DSECT.                                             * 01/88 SBG
*                                                           * 01/88 SBG
************************************************************* 01/88 SBG
         SPACE 1                                              01/88 SBG
ID#13    DS    0H                                             01/88 SBG
         DC    Y(X'6')             VERIFY LOCATION            01/88 SBG
         DC    Y(ID#13VLN)         VERIFY LENGTH              01/88 SBG
         SPACE 1                                              01/88 SBG
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
ID#13V   DC    C'IGC018  '         000006          DC    C'IGC018  '
         DC    C'08/03/87'         00000E+         DC    C'&SYSDATE'
*                                  00000E          DC    C'08/03/87'
         DC    C',JDQ1111'         000016          DC    C',JDQ1111'
         DC    C',NOMAINT'         00001E          DC    C',NOMAINT'
         DC    C'5665-295'         000026          DC    C'5665-295 COP
*                                  ************************************
         SPACE 1                                              01/88 SBG
ID#13VLN EQU   *-ID#13V            VERIFY LENGTH              01/88 SBG
         SPACE 3                                              01/88 SBG
************************************************************* 01/88 SBG
*                                                           * 01/88 SBG
*        "SRCHPDS" TRAP. MAPPED BY THE "ORIGINAL" DSECT.    * 01/88 SBG
*                                                           * 01/88 SBG
************************************************************* 01/88 SBG
         SPACE 1                                              01/88 SBG
SRCH#13  DS    0H                                             01/88 SBG
         DC    Y(X'538')           VERIFY LOCATION            01/88 SBG
         DC    Y(SRCH#13L)         VERIFY LENGTH              01/88 SBG
         SPACE 1                                              01/88 SBG
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
SRCH#13V DS    0H                  000538 SRCHPDS  EQU   *
         MVI   X'160'(R13),0       000538          MVI   ERCODE,0
*                                  00053C          MODESET KEYADDR=EXSK
         IC    R3,X'60'(,R6)       00053C+         IC    3,EXSKEY
         SPKA  0(R3)               000540+         SPKA  0(3)
*                                  ************************************
         SPACE 1                                              01/88 SBG
SRCH#13L EQU   *-SRCH#13V          VERIFY LENGTH              01/88 SBG
         #TEST SIZE=(SRCH#13L,GE,SRCHPOHL)                    01/88 SBG
         SPACE 3                                              01/88 SBG
************************************************************* 01/88 SBG
*                                                           * 01/88 SBG
*        "DFOUND" TRAP. MAPPED BY THE "ORIGINAL" DSECT.     * 01/88 SBG
*        NOTE, IN THIS VERSION OF IGC018, THE TRAP IS       * 01/88 SBG
*        LOCATED AT LABEL "FINDKEY" WHICH IS NOW JUST PAST  * 01/88 SBG
*        LABEL "DFOUND".                                    * 01/88 SBG
*                                                           * 01/88 SBG
************************************************************* 01/88 SBG
         SPACE 1                                              01/88 SBG
FINDK#13 DS    0H                                             01/88 SBG
         DC    Y(X'7FE')           VERIFY LOCATION            01/88 SBG
         DC    Y(FIND#13L)         VERIFY LENGTH              01/88 SBG
         SPACE 1                                              01/88 SBG
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  0007FE FINDKEY  EQU   *
FIND#13V STCM  R5,7,X'8'(R7)       0007FE          STCM  RY,ADDR3,PDS2T
         LA    R5,X'E'             000802          LA    RY,PDS2USRD-PD
         LCR   R5,R5               000806          LCR   RY,RY
         AH    R5,X'2'(,R10)       000808          AH    RY,BLDELEN
         BM    X'838'(,R12)        00080C          BM    NOMOVE
         BXLE  R4,R4,X'814'(R12)   000810          BXLE  RX,RX,EXEC
*                                  ************************************
         SPACE 1                                              01/88 SBG
FIND#13L EQU   *-FIND#13V          VERIFY LENGTH              01/88 SBG
         #TEST SIZE=(FIND#13L,GE,DFOUNDHL)                    01/88 SBG
         SPACE 3                                              01/88 SBG
************************************************************* 01/88 SBG
*                                                           * 01/88 SBG
*        IBM DATA FIELD DESCRIPTORS. MAPPED BY THE "FIELDS" * 01/88 SBG
*        DSECT.                                             * 01/88 SBG
*                                                           * 01/88 SBG
************************************************************* 01/88 SBG
         SPACE 1                                              01/88 SBG
DOFF#13  DS    0H                                             01/88 SBG
         SPACE 1                                              01/88 SBG
*                                  ************************************
*                                  *          IGC018 CODE             *
*                                  ************************************
*                                  000000 IGC018   CSECT ,
*                                  000000          BALR  RBASE,0
         DC    S(X'2'(R12))        000002          USING *,RBASE
         SPACE 1                                              01/88 SBG
         DC    S(0(R8))            000008 RPDS1    EQU   8
         DC    S(0(R10))           00000A RLIST    EQU   10
         DC    S(0(R11))           00000B RDCB     EQU   11
         SPACE 1                                              01/88 SBG
*                                  000000 WORKAREA DSECT ,
         DC    S(0(R13))           000000 RDAREA   DS    CL256
         DC    S(X'161'(R13))      000161 CONCAT#  DS    FL1
         SPACE 1                                              01/88 SBG
*                                 -000040 RBPRFX   DSECT ,
*                                  000000 RBBASIC  DS    0F
         DC    S(X'60'(R6))        000060 EXSKEY   DS    X
         DC    S(X'61'(R6))        000061 EXSFLG   DS    B
         DC    B'00100000'                EXSBLDL  EQU   B'00100000'
*                                  ************************************
         SPACE 1                                              01/88 SBG
         #TEST SIZE=(*-DOFF#13,EQ,FIELDSLN)                   01/88 SBG
         END   ,                                              11/83 DBC
