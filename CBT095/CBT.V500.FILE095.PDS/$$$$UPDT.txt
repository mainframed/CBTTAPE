/**********************************************************************
/*                                                                    *
/*                W   W  AAA  RRRR  N   N  III  N   N  GGGG           *
/*                W   W A   A R   R NN  N   I   NN  N G               *
/*                W W W AAAAA RRRR  N N N   I   N N N G  GG           *
/*                WW WW A   A R  R  N  NN   I   N  NN G   G           *
/*                W   W A   A R   R N   N  III  N   N  GGGG           *
/*                                                                    *
/*     THIS MACRO WILL UPDATE DIRECTORY INFORMATION FOR THIS PDS.     *
/*     IT SHOULD BE USED AND THEN DELETED.                            *
/**********************************************************************
 ISREDIT MACRO (FROM,TO)
 ISREDIT (WORKDSN) = DATASET
 SET &Z9 = Z9999999
 IF &FROM = ? THEN DO
 ISPEXEC DISPLAY PANEL(MEMLIST)
 EXIT
 END
 IF &FROM ¬= THEN SET &RT = &STR(RANGE &FROM TO &TO)
 IF &TO = THEN SET &TO = &Z9
 SET &TARGET1 = &FROM
 SET T1 = &LENGTH(&TARGET1)
 IF &FROM =  THEN SET &T1 = 8
 SET &TARGET2 = &TO
 SET T2 = &LENGTH(&TARGET2)
SET  PDSDSN = &WORKDSN


  SET &Y = &SUBSTR(7:8,&STR(&SYSDATE)
  SET &M = &SUBSTR(1:2,&STR(&SYSDATE)
  SET &D = &SUBSTR(4:5,&STR(&SYSDATE)
  IF &LENGTH(&STR(&M)) = 1 THEN SET &M = &STR(&STR(0)&M)
  IF &LENGTH(&STR(&D)) = 1 THEN SET &M = &STR(&STR(0)&D)
/* INITIALIZE DATASET */
ISPEXEC  LMINIT DATAID(PDSID) DATASET('&PDSDSN') +
                ENQ(SHRW)                        +
                ORG(PDSORG)
SET LMRC = &LASTCC
IF &LMRC ¬= 0 THEN +
   DO
      WRITE LMINIT FAILED - RETURN CODE &LMRC
      WRITE DATA SET IS NOT ALLOCATED OR NOT PARTITIONED
      EXIT CODE(8)
   END

WRITE STATS FOR  '&WORKDSN' BEING UPDATED
/* OPEN DATA SET */
ISPEXEC LMOPEN DATAID(&PDSID) OPTION(INPUT)
SET LMRC = &LASTCC

/* CALL EDIT WITH EACH MEMBER OF THE DATA SET AND SPECIFY THE */
/* INITIAL EDIT MACRO.                                        */
DO WHILE (&LMRC = 0)
  /* BUILD MEMBER LIST AND RETURN NEXT MEMBER */
  ISPEXEC LMMLIST DATAID(&PDSID) -
        OPTION(LIST) MEMBER(MEMBER) -
        STATS(YES)
SET &LMRC = &LASTCC
SET &NUM = &NUM +1
 SET &ZLMNORC  = &ZLINORC
 IF &SUBSTR(1:1,&MEMBER) ¬= &STR(#) THEN SET &ID = EDITMAC
 IF &SUBSTR(1:1,&MEMBER) = &STR($) THEN SET &ID = README
 IF &SUBSTR(1:3,&MEMBER) = &STR(COB) THEN SET &ID = COBLSRC
 IF &SUBSTR(1:1,&STR(&MEMBER)) = &STR(#) THEN SET &ID = PANEL
 IF &STR(&MEMBER) = CLONE THEN SET &ID = CLIST
 IF &STR(&MEMBER) = EDITPDS THEN SET &ID = CLIST
 IF &STR(&MEMBER) = WHEREMEM THEN SET &ID = CLIST
 IF &STR(&MEMBER) = ADDCMDS THEN SET &ID = CLIST
 IF &STR(&MEMBER) = PARADOC THEN SET &ID = HELP
 IF &STR(&MEMBER) = $$$$LIST THEN SET &ID = MEMLIST
 IF &STR(&MEMBER) = $$$$UPDT THEN SET &ID = SPCLIST
  ISPEXEC  LMMSTATS DATAID(&PDSID)   MEMBER(&MEMBER) VERSION(5) +
                    CURSIZE(&ZLMNORC) INITSIZE(&ZLMNORC) +
                    CREATED(&Y/&M/&D) MODDATE(&Y/&M/&D) +
                    MODTIME(23:00) MODLEVEL(0)  MODRECS(0) USER(&ID)
  IF &LMRC = 0 THEN /* NOT END OF MEMBER LIST */ +
     DO
     IF &SUBSTR(1:&T1,&MEMBER) GE &TARGET1 AND +
      &SUBSTR(1:&T2,&MEMBER) LE &TARGET2  THEN DO
       END
     END
 END
 WRITE
 WRITE
 WRITE
 WRITE
WRITE  &NUM MEMBER STATS CHANGED
/* FREE MEMBER LIST */
ISPEXEC LMMLIST DATAID(&PDSID) OPTION(FREE)
/* CLOSE DATA SET */
ISPEXEC LMCLOSE DATAID(&PDSID)
/* FREE DATA ID */
ISPEXEC LMFREE  DATAID(&PDSID)

ISREDIT END
EXIT CODE(0)
