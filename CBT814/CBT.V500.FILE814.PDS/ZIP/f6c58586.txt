CPU utilization analysis during an RMF interval

(Application Workload Service Units/Total Application Workload Service Units) * Overhead Performance Group Service Units.

* RMFANAL - BREAKS DOWN CPU UTILIZATION;
OPTIONS NODATE;
DATA RMF (KEEP = PCTCPUBY DATE);
SET
    PDB.RMFINT05
    PDB.RMFINT04
    PDB.RMFINT03
    PDB.RMFINT02
    PDB.RMFINT01
    ;
* SET DATE OF REQUIRED INTERVAL ;
;
D1= "08FEB95"D;
;
* SET TIME TO THE START TIME OF THE REQUIRED INTERVAL ;
;
T1 = "10:00:00"T;
;
* THE RPP NEEDS TO BE MANUALLY SET;
;
RPP = 147 ;
;
* RMF RECORDING INTERVAL IS SET TO 10 MINUTES ;
* THEREFORE SET THE TO TIME FOR INTERVAL PERIOD OF 10 MINUTES;
;
T2 = T1 + 600;
;
* ALLOW FOR 30 SECONDS EITHER WAY;
;
T3 = T1 - 30;
T4 = T1 + 30;
DATE = DATEPART(STARTIME);
IF DATE ^= D1 THEN DELETE;
TIME = TIMEPART(STARTIME);
IF TIME < T3 THEN DELETE;
IF TIME > T4 THEN DELETE;
CALL SYMPUT ('D1', PUT(D1,DATE7.));
CALL SYMPUT ('T1', PUT(T1,TIME5.));
CALL SYMPUT ('T2', PUT(T2,TIME5.));
CALL SYMPUT ('T3', PUT(T3,TIME8.));
CALL SYMPUT ('T4', PUT(T4,TIME8.));
URPP = RPP * (PCTCPUBY / 100);
RATIO = CAPTURAT / 100;
FORMAT RATIO 8.7 ;
MINUTES = MINUTE(DURATM);
SECONDS = SECOND(DURATM);
SECONDS = ROUND (SECONDS);
SECS = (MINUTES * 60) + SECONDS ;
CALL SYMPUT ('CRATIO', RATIO);
CALL SYMPUT ('NRCPUS', NRCPUS);
CALL SYMPUT ('RPP', RPP);
CALL SYMPUT ('URPPX', URPP);
CALL SYMPUT ('SECS', SECS);
CALL SYMPUT ('CPUX', PCTCPUBY);
RUN;
;
DATA CRATIO ;
SET
    PDB.TYPE7205
    PDB.TYPE7204
    PDB.TYPE7203
    PDB.TYPE7202
    PDB.TYPE7201
    ;
DATE = DATEPART(STARTIME);
IF DATE ^= "&D1"D THEN DELETE;
TIME = TIMEPART(STARTIME);
IF TIME < "&T3"T THEN DELETE;
IF TIME > "&T4"T THEN DELETE;
;
* DELETE ALL RPGNS;
* IN OUR CASE ANY PG OVER 99 IS A RPGN ;
;
IF PERFGRP > 99 THEN DELETE;
CALL SYMPUT ('COEFF', SRBCOEFF);
CALL SYMPUT ('SUSEC', SU_SEC);
TOTUNITS = CPUUNITS + SRBUNITS;
KEEP DATE PERFGRP SRBCOEFF SU_SEC TOTUNITS ;
RUN;
;
PROC SORT;
BY PERFGRP ;
RUN;
;
PROC SUMMARY NWAY;
CLASS PERFGRP ;
ID DATE SRBCOEFF SU_SEC ;
VAR TOTUNITS ;
OUTPUT OUT=CRATMM (DROP =  _TYPE_  _FREQ_)
SUM (TOTUNITS) = ;
RUN;
;
PROC SORT;
BY PERFGRP;
RUN;
;
DATA CRATMX;
SET CRATMM;
CRATIO = &CRATIO;
NRCPUS = &NRCPUS ;
;
*  CALCULATE A CONSTANT VALUE TO BE INCLUDED IN ALL CALCULATIONS ;
;
KONSTANT  =  SRBCOEFF * SU_SEC * CRATIO * NRCPUS;
PERF = PERFGRP ;
;
*  ACCUMULATED ALL MINOR OVERHEADS INTO ONE OVERHEAD PERFORMANCE GROUP;
;
IF PERF = 09 OR PERF = 12 OR PERF = 13 OR PERF = 14 OR PERF = 15
OR PERF = 16 OR PERF = 17 OR PERF = 18 OR PERF = 20 OR PERF =28
OR PERF = 29 OR PERF = 60 OR PERF = 99
   THEN PERF = 06;
RUN;
;
PROC SUMMARY NWAY;
CLASS PERF;
ID KONSTANT ;
VAR TOTUNITS ;
OUTPUT OUT=CRATSUM (DROP = _TYPE_ _FREQ_)
SUM (TOTUNITS) = ;
RUN;
;
* SPLIT PGS INTO APPLICATIONS AND OVERHEADS ;
* THIS REQUIRES THE OVERHEAD PERFORMANCE GROUPS TO BE MANUALLY CODED ;
* HERE;
;
DATA APPL OHEAD;
SET CRATSUM;
IF PERF = 06 OR PERF = 04 OR PERF = 05 OR PERF = 08 OR PERF = 11
             OR PERF = 00 THEN DO;
             OUTPUT OHEAD;
             DELETE;
END;
OUTPUT APPL ;
RUN;
;
* PROCESS APPLICATION PGS ;
;
DATA APPL2 ;
SET APPL ;
SECS = &SECS;
RPP = &RPP ;
CPUSEC = TOTUNITS / KONSTANT;
PERCENT = (CPUSEC / SECS) * 100 ;
URPP = (PERCENT * RPP) / 100;
RUN;
;
* CALCULATE THE TOTAL URPP USED BY APPLICATION PGS FOR USE LATER ;
* WHEN APPORTIONING THE OVERHEAD PGS ;
;
PROC SUMMARY NWAY;
VAR URPP ;
OUTPUT OUT=GAPPL (DROP = _TYPE_ _FREQ_)
SUM (URPP) = ;
RUN;
;
DATA GAPPL2;
SET GAPPL;
CALL SYMPUT ('CAPPL', URPP);
RUN;
;
*  PROCESS OVERHEAD PGS ;
;
DATA OHEAD2;
SET OHEAD;
SECS = &SECS;
RPP = &RPP ;
CPUSEC = TOTUNITS / KONSTANT;
PERCENT = (CPUSEC / SECS) * 100;
URPP = (PERCENT * RPP) / 100;
IF PERF = 06 THEN DO;
    CALL SYMPUT ('PG06CPU',CPUSEC);
    CALL SYMPUT ('PG06PC',PERCENT);
    CALL SYMPUT ('PG06URPP',URPP);
END;
IF PERF = 04 THEN DO;
    CALL SYMPUT ('PG04CPU',CPUSEC);
    CALL SYMPUT ('PG04PC',PERCENT);
    CALL SYMPUT ('PG04URPP',URPP);
END;
IF PERF = 05 THEN DO;
    CALL SYMPUT ('PG05CPU',CPUSEC);
    CALL SYMPUT ('PG05PC',PERCENT);
    CALL SYMPUT ('PG05URPP',URPP);
END;
IF PERF = 08 THEN DO;
    CALL SYMPUT ('PG08CPU',CPUSEC);
    CALL SYMPUT ('PG08PC',PERCENT);
    CALL SYMPUT ('PG08URPP',URPP);
END;
IF PERF = 11 THEN DO;
    CALL SYMPUT ('PG11CPU',CPUSEC);
    CALL SYMPUT ('PG11PC',PERCENT);
    CALL SYMPUT ('PG11URPP',URPP);
END;
IF PERF = 00 THEN DO;
    CALL SYMPUT ('PG00CPU',CPUSEC);
    CALL SYMPUT ('PG00PC',PERCENT);
    CALL SYMPUT ('PG00URPP',URPP);
END;
RUN;
;
DATA APPL3;
SET APPL2;
PG06CPU = &PG06CPU ;
PG06PC = &PG06PC ;
PG06URPP = &PG06URPP ;
PG04CPU = &PG04CPU ;
PG04PC = &PG04PC ;
PG04URPP = &PG04URPP ;
PG05CPU = &PG05CPU ;
PG05PC = &PG05PC ;
PG05URPP = &PG05URPP ;
PG08CPU = &PG08CPU ;
PG08PC = &PG08PC ;
PG08URPP = &PG08URPP ;
PG11CPU = &PG11CPU ;
PG11PC = &PG11PC ;
PG11URPP = &PG11URPP ;
PG00CPU = &PG00CPU ;
PG00PC = &PG00PC ;
PG00URPP = &PG00URPP ;
GURPP = &GAPPL;
;
* APPORTION THE OVERHEAD PGS BETWEEN THE APPLICATION PGS;
;
PG0  = URPP / GURPP * RG00URPP;
PG06 = URPP / GURPP * PG06URPP;
PG04 = URPP / GURPP * PG04URPP;
PG05 = URPP / GURPP * PG05URPP;
PG08 = URPP / GURPP * PG08URPP;
PG11 = URPP / GURPP * PG11URPP;
TOTURPP = URPP + PG0 + PG06 + PG04 + PG05 + PG08 + PG11 ;
TOTPCENT = TOTURPP / RPP * 100;
TOTSEC = TOTPCENT * SECS / 100;
;
* DEFINE THE APPLICATION WORKLOADS ;
;
IF PERF = 01 OR PERF = 21 OR PERF = 03
   THEN SYSTEM = "BATCH";
IF PERF = 02 OR PERF = 22 OR PERF = 32 OR PERF = 33 OR PERF = 10
   THEN SYSTEM = "TSO";
IF PERF > 35 AND PERF < 51
   THEN SYSTEM = "CICS";
IF PERF > 50 AND PERF < 57
   THEN SYSTEM = "DB2";
;
* IDENTIFY FURTHER THE APPLICATION WORKLOADS ;
;
IF PERF = 01 THEN APPLID = "PROD     ";
IF PERF = 02 THEN APPLID = "PROD     ";
IF PERF = 03 THEN APPLID = "HOT      ";
IF PERF = 21 THEN APPLID = "DEV      ";
IF PERF = 22 THEN APPLID = "DEV      ";
IF PERF = 32 THEN APPLID = "SYSPROG  ";
IF PERF = 33 THEN APPLID = "QMF      ";
IF PERF = 10 THEN APPLID = "TCAS     ";
IF PERF = 36 THEN APPLID = "P TERM   ";
IF PERF = 37 THEN APPLID = "P BRANCH ";
IF PERF = 38 THEN APPLID = "P DATA M ";
IF PERF = 39 THEN APPLID = "P ORDERS ";
IF PERF = 40 THEN APPLID = "P ORDERSX";
IF PERF = 41 THEN APPLID = "P STOCK  ";
IF PERF = 42 THEN APPLID = "PRJ PROTO";
IF PERF = 43 THEN APPLID = "PRJ DEV  ";
IF PERF = 44 THEN APPLID = "QA FUNCT ";
IF PERF = 45 THEN APPLID = "TEST BED ";
IF PERF = 46 THEN APPLID = "QA VOL   ";
IF PERF = 47 THEN APPLID = "DEV      ";
IF PERF = 48 THEN APPLID = "MVS SUPP ";
IF PERF = 51 THEN APPLID = "PROD     ";
IF PERF = 52 THEN APPLID = "QA       ";
IF PERF = 53 THEN APPLID = "DEV      ";
IF PERF = 54 THEN APPLID = "PRJ DEV  ";
IF PERF = 55 THEN APPLID = "MVS SUPP ";
IF PERF = 56 THEN APPLID = "TEST BED ";
RUN;
;
PROC SORT;
BY SYSTEM PERF;
RUN;
;
PROC PRINT SPLIT= "*" UNIFORM NOOBS;
BY SYSTEM;
TITLE1 "CPU ANALYSIS FOR &D1 FROM &T1 TO &T2";
TITLE2 "CAPTURE RATIO = &CRATIO,  URPP = &URPPX,  CPU% = &CPUX";
LABEL PERF     = "PG*NO";
LABEL CPUSEC   = "CPU*SU/SEC";
LABEL PERCENT  = "CPU%";
LABEL URPP     = "URPP";
LABEL PG0      = "MVS*O/HEAD";
LABEL PG04     = "VTAM*O/HEAD";
LABEL PG05     = "JES2*O/HEAD";
LABEL PG08     = "NETVIEW*O/HEAD";
LABEL PG11     = "DFHSM*O/HEAD";
LABEL PG06     = "OTHER*O/HEAD";
LABEL TOTURPP  = "TOTAL*URPP";
LABEL TOTPCENT = "TOTAL*CPU%";
LABEL TOTSEC   = "TOTAL CPU*SU/SECS";
VAR PERF APPLID CPUSEC PERCENT URPP PG0 PG04 PG05 PG08 PG11
    PG06 TOTURPP TOTPCENT TOTSEC;;
SUM CPUSEC PERCENT URPP PG0 PG04 PG05 PG08 PG11
    PG06 TOTURPP TOTPCENT TOTSEC;
RUN;


John Larry
Performance Analyst (UK)                                                 c Xephon 1995

