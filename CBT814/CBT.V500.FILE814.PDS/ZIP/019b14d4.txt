A dynamic allocation parameter list (cont)
This month, we conclude this article by publishing the remainder of the source
code for the dynamic allocation macro and by showing an example of its use.
.SYSPERR MNOTE 8,'SPGNM=&SPGNM IS GREATER THAN 8 BYTES'
.FORMCHK AIF   (T'&FORM EQ 'O').OUTLCHK
         AIF   (K'&FORM GT 4).FORMERR
TS&X&A1  DC    XL2'A1',AL2(1,4)    SYSOUT FORM KEY, NUM, PARMLEN
FMNO&X   DC    CL4'&FORM'          SYSOUT FORM NUMBER FIELD
&A1      SETA  &A1+1
         AGO   .OUTLCHK
.FORMERR MNOTE 8,'FORM=&FORM IS GREATER THAN 4 BYTES'
.OUTLCHK AIF   (T'&OUTLIM EQ 'O').FREECHK
TS&X&A1  DC    XL2'1B',AL2(1,3)    OUTLIM KEY, NUM, PARMLEN
OUTLM&X  DC    AL3(&OUTLIM)        OUTLIM PGM FIELD
&A1      SETA  &A1+1
.FREECHK AIF   (T'&FREE EQ 'O').COPYCHK
         AIF   ('&FREE' NE 'CLOSE').FREERR
TS&X&A1  DC    XL2'1C',AL2(0)      FREE=CLOSE KEY, NUM
&A1      SETA  &A1+1               ALL ELSE WILL GENERATE MNOTE
         AGO   .COPYCHK
.FREERR  MNOTE 8,'FREE=&FREE INVALID'
.COPYCHK AIF   (T'&COPIES EQ 'O').LABLCHK
&A3      SETA  &COPIES
         AIF   (&A3 GT 255).COPYERR
TS&X&A1  DC    XL2'1D',AL2(1,1)    SYSOUT COPIES KEY, NUM, PARMLEN
COPYS&X  DC    AL1(&COPIES)        SYSOUT COPIES FIELD
&A1      SETA  &A1+1
         AGO   .LABLCHK
.COPYERR MNOTE 8,'COPIES=&COPIES GREATER THAN 255'
.LABLCHK AIF   (T'&LABEL EQ 'O').DSSQCHK
TS&X&A1  DC    XL2'1E',AL2(1,1)    LABEL TYPE KEY, NUM, PARMLEN
&A1      SETA  &A1+1
         AIF   ('&LABEL' NE 'NL').LAB1CHK NL  = X'01'
LABEL&X  DC    XL1'01'             LABEL = NL
         AGO   .DSSQCHK
.LAB1CHK AIF   ('&LABEL' NE 'SL').LAB2CHK SL  = X'02'
LABEL&X  DC    XL1'2'              LABEL = SL
         AGO   .DSSQCHK
.LAB2CHK AIF   ('&LABEL' NE 'NSL').LAB3CHK NSL = X'04'
LABEL&X  DC    XL1'04'             LABEL = NSL
         AGO   .DSSQCHK
.LAB3CHK AIF   ('&LABEL' NE 'SUL').LAB4CHK SUL = X'0A'
LABEL&X  DC    XL1'0A'             LABEL = SUL
         AGO   .DSSQCHK
.LAB4CHK AIF   ('&LABEL' NE 'BLP').LAB5CHK BLP = X'10'
LABEL&X  DC    XL1'10'             LABEL = BLP
         AGO   .DSSQCHK
.LAB5CHK AIF   ('&LABEL' NE 'LTM').LAB6CHK LTM = X'21'
LABEL&X  DC    XL1'21'             LABEL = LTM
         AGO   .DSSQCHK
.LAB6CHK AIF   ('&LABEL' NE 'AL').LAB7CHK AL  = X'40'
LABEL&X  DC    XL1'40'             LABEL = AL
         AGO   .DSSQCHK
.LAB7CHK AIF   ('&LABEL' NE 'AUL').LABERR  AUL = X'48'
LABEL&X  DC    XL1'48'             LABEL = AUL
         AGO   .DSSQCHK
.LABERR  MNOTE 8,'LABEL=&LABEL INVALID'
.DSSQCHK AIF   (T'&DSSEQ EQ 'O').PASSCHK
         AIF   (T'&DSSEQ NE 'N').DSSQERR
         AIF   (&DSSEQ GT 9999).DSSQERR
TS&X&A1  DC    XL2'1F',AL2(1,2)    DSN SEQUENCE KEY, NUM, PARMLEN
DSSEQ&X  DC    AL2(&DSSEQ)         DSN SEQUENCE FIELD
&A1      SETA  &A1+1
         AGO   .PASSCHK
.DSSQERR MNOTE 8,'DSSEQ=&DSSEQ INVALID OR OUT OF RANGE'
.PASSCHK AIF   (T'&PASPR EQ 'O').EXPDCHK
         AIF   ('&PASPR' NE 'R' AND 'PASPR' NE 'W').PASPERR
TS&X&A1  DC    XL2'20',AL2(1,1)    PASSWORD PROTECT KEY, NUM, PARMLEN
         AIF   ('&PASPR' EQ 'R').PASSRD
PASPR&X  DC    X'30'               WRITE PROTECTION
&A1      SETA  &A1+1
         AGO   .EXPDCHK
.PASSRD  ANOP
PASPR&X  DC    X'10'               READ/WRITE PROTECTION
&A1      SETA  &A1+1
         AGO   .EXPDCHK
.PASPERR MNOTE 8,'PASPR=&PASPR INVALID-SHOULD BE "R" OR "W"'
.EXPDCHK AIF   (T'&EXPDT EQ 'O').RETPCHK
         AIF   (K'&EXPDT GT 5).EXPDERR
TS&X&A1  DC    XL2'22',AL2(1,5)    EXPIRATION DATE KEY, NUM, PARMLEN
EXPDT&X  DC    CL5'&EXPDT'         EXPIRATION DATE FIELD
&A1      SETA  &A1+1
         AGO   .RETPCHK
.EXPDERR MNOTE 8,'EXPDT=&EXPDT GREATER THAN 5 BYTES'
.RETPCHK AIF   (T'&RETPD EQ 'O').DUMMCHK
         AIF   (T'&RETPD NE 'N').RETPERR
&A3      SETA  &RETPD
         AIF   (&RETPD GT 9999).RETPERR
TS&X&A1  DC    XL2'23',AL2(1,2)    RETENTION PERIOD KEY, NUM, PARMLEN
RETPD&X  DC    AL2(&RETPD)         RETENTION PERIOD FIELD
&A1      SETA  &A1+1
         AGO   .DUMMCHK
.RETPERR MNOTE 8,'RETPD=&RETPD NOT NUMERIC OR GREATER THAN 9999'
.DUMMCHK AIF   (T'&DUMMY EQ 'O').DCBSCHK
TS&X&A1  DC    XL2'24',AL2(0)      DUMMY DATASET KEY, NUM
&A1      SETA  &A1+1
.DCBSCHK AIF   (T'&DCBDS EQ 'O').DCBDCHK
         AIF   (K'&DCBDS GT 44).DCBSERR
TS&X&A1  DC    XL2'2C',AL2(1,44)   DCB REFERENCE DSN KEY, NUM, PARMLEN
DCBDS&X  DC    CL44'&DCBDS'        DCB REFERENCE DSNAME FIELD
&A1      SETA  &A1+1
         AGO   .DCBDCHK
.DCBSERR MNOTE 8,'DCBDS=&DCBDS GREATER THAN 44 BYTES'
.DCBDCHK AIF   (T'&DCBDD EQ 'O').BLKSCHK
         AIF   (K'&DCBDS GT 8).DCBDERR
TS&X&A1  DC    XL2'2D',AL2(1,8)    DCB REFERENCE DDN KEY, NUM, PARMLEN
DCBDS&X  DC    CL8'&DCBDD'         DCB REFERENCE DDNAME FIELD
&A1      SETA  &A1+1
         AGO   .BLKSCHK
.DCBDERR MNOTE 8,'DCBDD=&DCBDD GREATER THAN 8 BYTES'
.BLKSCHK AIF   (T'&BLKSIZE EQ 'O').DENSCHK
         AIF   (T'&BLKSIZE NE 'N').BLKSERR
&A3      SETA  &BLKSIZE
         AIF   (&A3 GT 32768).BLKSERR
TS&X&A1  DC    XL2'30',AL2(1,2)    BLOCKSIZE KEY, NUM, PARMLEN
BLKSZ&X  DC    AL2(&BLKSIZE)       BLOCKSIZE FIELD
&A1      SETA  &A1+1
         AGO   .DENSCHK
.BLKSERR MNOTE 8,'BLKSIZE=&BLKSIZE INVALID OR GREATER THAN 32768'
.DENSCHK AIF   (T'&DEN EQ 'O').DSORCHK
TS&X&A1  DC    XL2'3B',AL2(1,1)    DENSITY KEY, NUM, PARMLEN
&A1      SETA  &A1+1
         AIF   ('&DEN' NE '4').DEN1CHK DEN4 = X'D3'
DEN&X    DC    XL1'D3'             DEN = 4
         AGO   .DSORCHK
.DEN1CHK AIF   ('&DEN' NE '3').DEN2CHK DEN3 = X'C3'
DEN&X    DC    XL1'C3'             DEN = 3
         AGO   .DSORCHK
.DEN2CHK AIF   ('&DEN' NE '2').DEN3CHK DEN2 = X'83'
DEN&X    DC    XL1'83'             DEN = 2
         AGO   .DSORCHK
.DEN3CHK AIF   ('&DEN' NE '1').DENERR  DEN1 = X'43'
DEN&X    DC    XL1'43'             DEN = 1
         AGO   .DSORCHK
.DENERR  MNOTE 8,'DEN=&DEN INVALID'
.DSORCHK AIF   (T'&DSORG EQ 'O').EROPCHK
TS&X&A1  DC    XL2'3C',AL2(1,2)    DSORG KEY, NUM, PARMLEN
&A1      SETA  &A1+1
         AIF   ('&DSORG' NE 'PO').DSO1CHK DSORG PO = X'0200'
DSORG&X  DC    XL2'0200'           DSORG = PO
         AGO   .EROPCHK
.DSO1CHK AIF   ('&DSORG' NE 'PS').DSO2CHK DSORG PS = X'4000'
DSORG&X  DC    XL2'4000'           DSORG = PS
         AGO   .EROPCHK
.DSO2CHK AIF   ('&DSORG' NE 'DA').DSO3CHK DSORG DA = X'2000'
DSORG&X  DC    XL2'2000'           DSORG = DA
         AGO   .EROPCHK
.DSO3CHK AIF   ('&DSORG' NE 'VS').DSO4CHK DSORG VS = X'0008'
DSORG&X  DC    XL2'0008'           DSORG = VS
         AGO   .EROPCHK
.DSO4CHK AIF   ('&DSORG' NE 'POU').DSO5CHK DSORG POU = X'0300'
DSORG&X  DC    XL2'0300'           DSORG = POU
         AGO   .EROPCHK
.DSO5CHK AIF   ('&DSORG' NE 'PSU').DSO6CHK DSORG PSU = X'4100'
DSORG&X  DC    XL2'4100'           DSORG = PSU
         AGO   .EROPCHK
.DSO6CHK AIF   ('&DSORG' NE 'DAU').DSOERR  DSORG DAU = X'2100'
DSORG&X  DC    XL2'2100'           DSORG = DAU
         AGO   .EROPCHK
.DSOERR  MNOTE 8,'DSORG=&DSORG INVALID'
.EROPCHK AIF   (T'&EROPT EQ 'O').KEYLCHK
TS&X&A1  DC    XL2'3D',AL2(1,1)    EROPT KEY, NUM, PARMLEN
&A1      SETA  &A1+1
         AIF   ('&EROPT' NE 'ABE').ERO1CHK EROPT ABE = X'20'
EROPT&X  DC    XL1'20'             EROPT = ABE
         AGO   .KEYLCHK
.ERO1CHK AIF   ('&EROPT' NE 'SKP').ERO2CHK EROPT SKP = X'40'
EROPT&X  DC    XL1'40'             EROPT = SKP
         AGO   .KEYLCHK
.ERO2CHK AIF   ('&EROPT' NE 'ACC').EROERR  EROPT ACC = X'80'
EROPT&X  DC    XL1'80'             EROPT = ACC
         AGO   .KEYLCHK
.EROERR  MNOTE 8,'EROPT=&EROPT INVALID'
.KEYLCHK AIF   (T'&KEYLEN EQ 'O').LRECCHK
TS&X&A1  DC    XL2'40',AL2(1,1)    KEYLEN KEY,NUM, PARMLEN
KYLEN&X  DC    AL1(&KEYLEN)        KEYLEN FIELD
&A1      SETA  &A1+1
.LRECCHK AIF   (T'&LRECL EQ 'O').OPTCCHK
TS&X&A1  DC    XL2'42',AL2(1,2)    LRECL KEY, NUM, PARMLEN
LRECL&X  DC    AL2(&LRECL)         LRECL FIELD
&A1      SETA  &A1+1
.OPTCCHK AIF   (T'&OPTCD EQ 'O').RECFCHK
TS&X&A1  DC    XL2'45',AL2(1,1)    OPTCD KEY, NUM, PARMLEN
&A1      SETA  &A1+1
         AIF   ('&OPTCD' NE 'B').OPT1CHK OPTCD B = X'40'
OPTCD&X  DC    XL1'40'             OPTCD = B
         AGO   .RECFCHK
.OPT1CHK AIF   ('&OPTCD' NE 'W').OPT2CHK OPTCD W = X'80'
OPTCD&X  DC    XL1'80'             OPTCD = W
         AGO   .RECFCHK
.OPT2CHK AIF   ('&OPTCD' NE 'C').OPT3CHK OPTCD C = X'20'
OPTCD&X  DC    XL1'20'
         AGO   .RECFCHK
.OPT3CHK AIF   ('&OPTCD' NE 'Z').OPTERR  OPTCD Z = X'04'
OPTCD&X  DC    XL1'04'             OPTCD = Z
         AGO   .RECFCHK
.OPTERR  MNOTE 8,'OPTCD=&OPTCD INVALID'
.RECFCHK AIF   (T'&RECFM EQ 'O').PASWCHK
TS&X&A1  DC    XL2'49',AL2(1,1)    RECFM KEY, NUM, PARMLEN
&A1      SETA  &A1+1
         AIF   ('&RECFM' NE 'FBA').REC1CHK RECFM FBA = X'94'
RECFM&X  DC    XL1'94'             RECFM = FBA
         AGO   .PASWCHK
.REC1CHK AIF   ('&RECFM' NE 'VBA').REC2CHK RECFM VBA = X'54'
RECFM&X  DC    XL1'54'             RECFM = VBA
         AGO   .PASWCHK
.REC2CHK AIF   ('&RECFM' NE 'FB').REC3CHK RECFM FB = X'90'
RECFM&X  DC    XL1'90'             RECFM = FB
         AGO   .PASWCHK
.REC3CHK AIF   ('&RECFM' NE 'VB').REC4CHK RECFM VB = X'50'
RECFM&X  DC    XL1'50'             RECFM = VB
         AGO   .PASWCHK
.REC4CHK AIF   ('&RECFM' NE 'F').REC5CHK RECFM F = X'80'
RECFM&X  DC    XL1'80'             RECFM = F
         AGO   .PASWCHK
.REC5CHK AIF   ('&RECFM' NE 'V').REC6CHK RECFM V = X'40'
RECFM&X  DC    XL1'40'             RECFM = V
         AGO   .PASWCHK
.REC6CHK AIF   ('&RECFM' NE 'FBS').REC7CHK RECFM FBS = X'98'
RECFM&X  DC    XL1'98'             RECFM = FBS
         AGO   .PASWCHK
.REC7CHK AIF   ('&RECFM' NE 'VBS').REC8CHK RECFM VBS = X'58'
RECFM&X  DC    XL1'58'             RECFM = VBS
         AGO   .PASWCHK
.REC8CHK AIF   ('&RECFM' NE 'FA').REC9CHK RECFM FA = X'84'
RECFM&X  DC    XL1'84'             RECFM = FA
         AGO   .PASWCHK
.REC9CHK AIF   ('&RECFM' NE 'VA').RECACHK RECFM VA = X'44'
RECFM&X  DC    XL1'44'             RECFM = VA
         AGO   .PASWCHK
.RECACHK AIF   ('&RECFM' NE 'FBM').RECBCHK RECFM FBM = X'92'
RECFM&X  DC    XL1'92'             RECFM = FBM
         AGO   .PASWCHK
.RECBCHK AIF   ('&RECFM' NE 'VBM').RECCCHK RECFM VBM = X'52'
RECFM&X  DC    XL1'52'             RECFM = VBM
         AGO   .PASWCHK
.RECCCHK AIF   ('&RECFM' NE 'FBSA').RECDCHK RECFM FBSA = X'9C'
RECFM&X  DC    XL1'9C'             RECFM = FBSA
         AGO   .PASWCHK
.RECDCHK AIF   ('&RECFM' NE 'U').RECFERR RECFM U = X'C0'
RECFM&X  DC    XL1'C0'             RECFM = U
         AGO   .PASWCHK
.RECFERR MNOTE 8,'RECFM=&RECFM INVALID'
.PASWCHK AIF   (T'&PASSWRD EQ 'O').PERMCHK
         AIF   (K'&PASSWRD GT 8).PASWERR
TS&X&A1  DC    XL2'50',AL2(1,8)    PASSWORD KEY, NUM, PARMLEN
PASSW&X  DC    CL8'&PASSWRD'       PASSWORD
&A1      SETA  &A1+1
         AGO   .PERMCHK
.PASWERR MNOTE 8,'PASSWRD=&PASSWRD GREATER THAN 8 BYTES'
.PERMCHK AIF   (T'&PERM EQ 'O').RTDDCHK
TS&X&A1  DC    XL2'52',AL2(0)      PERM ALLOC KEY, NUM
&A1      SETA  &A1+1
.RTDDCHK AIF   (T'&RETDD EQ 'O').RTDSCHK
TS&X&A1  DC    XL2'55',AL2(1,8)    RETURN DDNAME, NUM, PARMLEN
RTDDN&X  DC    CL8' '              RETURNED DDNAME
&A1      SETA  &A1+1
.RTDSCHK AIF   (T'&RETDS EQ 'O').FUNCCHK
TS&X&A1  DC    XL2'56',AL2(1,44)   RETURN DSNAME, NUM, PARMLEN
RTDSN&X  DC    CL44' '             RETURNED DSNAME
&A1      SETA  &A1+1
.FUNCCHK AIF   (T'&FUNC EQ 'O').RTVLCHK
         AIF   ('&FUNC' NE 'I').FUNCERR
TS&X&A1  DC    XL2'5A',AL2(1,1)    FUNCTION KEY, NUM, PARMLEN
FUNC&X   DC    XL1'80'             INTERPRET FUNCTION FIELD
&A1      SETA  &A1+1
         AGO   .RTVLCHK
.FUNCERR MNOTE 8,'FUNC=&FUNC NOT SUPPORTED BY MACRO'
.RTVLCHK AIF   (T'&RETVOL EQ 'O').MSVGCHK
TS&X&A1  DC    XL2'5D',AL2(1,6)    RETURN VOLSER, NUM, PARMLEN
RTVOL&X  DC    CL6' '              RETURNED VOLSER
&A1      SETA  &A1+1
.MSVGCHK AIF   (T'&MSVGP EQ 'O').TUPLGEN
TS&X&A1  DC    XL2'5E',AL2(1,8)    MSVGP KEY, NUM, PARMLEN
MSVGP&X  DC    CL8'&MSVGP'         MSVGP FIELD
&A1      SETA  &A1+1
.TUPLGEN ANOP
&A2      SETA  1
&A1      SETA  &A1-1
&NM      SETC  'TXTPP&X'
.TULOOP  AIF   (&A2 EQ &A1).EOFGEN
&NM      DC    A(TS&X&A2)          TEXT UNIT POINTER
&NM      SETC  ' '
&A2      SETA  &A2+1
         AGO   .TULOOP
.EOFGEN  DC    A(TS&X&A2+X'80000000') LAST TEXT UNIT POINTER
         MEND

Bruce Bordonaro
System Software Manager
EDS (USA) © EDS 1988







































