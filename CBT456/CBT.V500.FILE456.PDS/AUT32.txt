AU32     TITLE '-- TSO-CP AUT30 - ROUTINE AUT32 --'
AUT32    START 0
         SPACE 1
**********************************************************************
*        THIS SUBROUTINE IS CALLED BY PROGRAM 'AUT30'.               *
*        I ACCESS THE FILE BY PROGRAMMER NUMBER.                     *
*                                             M.SACRE  01 OCTOBRE 84 *
*                                          P.A.MOINIL  13 OCTOBRE 89 *
**********************************************************************
*        CALL AUT32                                                  *
*        FUNCTION : SUBROUTINE TO CREATE OR UPDATE A PROGRAMMER.     *
*        AT ENTRY : NONE                                             *
*         AT EXIT : R15 = 0 - NORMAL COMPLETION                      *
*                         WITH R1 = 0 TO SAY NO MESSAGE, OR          *
*                              R1 = ADDRESS OF TERMINATION MESSAGE   *
*                              TEXT, WHICH POINTS AS BELOW :         *
*                                         DC  AL1(L'TEXT)            *
*                              ---> TEXT  DC  C'...MESSAGE...'       *
*                         4 - END REQUESTED                          *
*                         8 - SEVERE ERROR.                          *
*--------------------------------------------------------------------*
         SPACE 1
         PRINT NOGEN
        $DEFREG
        $XENT  BASE=(R10,R11,R12)
         SPACE 1
         MVI   ECRINM,C' '
         MVC   ECRINM+1(L'ECRINM-1),ECRINM
ASKPGM   LA    R1,PECRIN               ASK PGM NUMBER
         L     R15,=V(AUT99)
         BALR  R14,R15
         LTR   R15,R15                 NORMAL COMPLETION ?
         BNZ   LEAVE                   NO, END CP (ONLY 4)
         L     R15,=V(AUT99R)          GET RESPONSE
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BNZ   PRCESS                  IF NOT, SEE WHAT
QUIT     XR    R15,R15                 IF YES, ESCAPE
         L     R2,4(R13)
         XC    24(4,R2),24(R2)         SET R1 = 0
         B     LEAVE
PRCESS   LTR   R1,R1                   NO TEXT ?
         BZ    QUIT                    YES, ESCAPE
         MVC   WCL4(4),=CL40' '
         BCT   R1,*+L'*+6
         MVC   WCL4(*-*),3(R15)
         EX    R1,*-6
         CLC   WCL4(4),=CL40' '        IS RESPONSE = BLANK ?
         BE    QUIT                    YES, ESCAPE
         MVI   ECRINM,C' '
         MVC   ECRINM+1(L'ECRINM-1),ECRINM
         LA    R0,L'WCL4
         LA    R1,WCL4+L'WCL4
         BCTR  R1,0
         CLI   0(R1),C'0'              TEST IF NUMERIC
         BL    WRPGMN
         CLI   0(R1),C'9'
         BH    WRPGMN
         BCT   R0,*-18
*------- ICI, ON SAIT QUE L'ENTREE EST NUMERIQUE.
*        RECHERCHE DU NUMERO DE PROGRAMMEUR DANS LE FICHIER
*        D'ACCOUNTING.
         MVC   PGMCHAR,WCL4
         PACK  DSD,WCL4                PACK PROGR. NBR
         CVB   R1,DSD
         AH    R1,=Y(NAUTNO+1)         ADD NO. OF AUT. AT KEY
         STH   R1,ARGUMPRG             STORE IN ARGUMENT
        CALL   ZREAD,(RETCD,ARGUMPRG,AREAP),VL  READ RECORD
         LTR   R15,R15                 TEST RETURN CODE
         BZ    FNDRC                   IF ZERO, PROGR. FOUND
         CH    R15,=H'15'              IF 15 = ARGUMENT NOT FOUND
         BE    ASKCREA                 IF EQUAL, ASK TO CREATE IT
         LM    R2,R3,NZRD              IF NOT, SAY ZREAD ERROR
         B     ERRZR                   GO DISPLAY Z... MESSAGE
WRPGMN   MVC   ECRINM(L'MSGPN1),MSGPN1 PROGRAMMER NUMBER NOT NUMERIC
         B     ASKPGM                  BRANCH TO ASK PRG. NO.
         EJECT
*--------------------------------------------------------------------*
*        PROGR. NOT FOUND, ASK IF HE WANTS TO CREATE IT              *
*--------------------------------------------------------------------*
         SPACE 1
ASKCREA  LA    R1,PECRAW               ASK IF CREATING PROGR. NBR.
         L     R15,=V(AUT99)
         BALR  R14,R15
         LTR   R15,R15                 NORMAL COMPLETION ?
         BNZ   LEAVE                   NO, END CP (ONLY 4)
         MVI   ECRAWM,C' '
         MVC   ECRAWM+1(L'ECRAWM-1),ECRAWM
         L     R15,=V(AUT99R)          GET RESPONSE
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    ASKPGM                  IF YES, ESCAPE
         LTR   R1,R1                   NO TEXT ?
         BZ    ASKPGM                  YES, ESCAPE
         MVC   RESPONSE(1),3(R15)
         OI    RESPONSE,C' '           TRANSLATE LOWER CASE IN UPPER
         CLI   RESPONSE,C'Y'           IS RESPONSE = Y ?
         BE    EXCREA                  IF YES, CREATE NEW PROGR.
         CLI   RESPONSE,C' '           IS RESPONSE BLANK ?
         BE    ASKPGM                  IF YES, ESCAPE
         MVC   ECRAWM(L'MSGRSP),MSGRSP IF NOT, RE-ASK
         MVC   ECRAWM+L'MSGRSP-5(1),RESPONSE
         B     ASKCREA
         EJECT
*--------------------------------------------------------------------*
*        NOUS ALLONS CREER UN NOUVEAU PROGRAMMEUR.                   *
*--------------------------------------------------------------------*
         SPACE 1
EXCREA   OI    SWCRT+1,X'F0'           SET SWITCH TO NO CREATE
         MVC   SCRPGM,PGMCHAR          INIT PGM NUMBER
         MVC   SCRNOM,=CL40' '         CLEAR PGM NAME
         MVC   SCRMAT(L'SCRMAT),=CL40' '  CLEAR MATRICULE
         MVC   SCRBOX,=CL3'000'        INIT BOX NUMBER
         MVC   SCRBLD(L'SCRBLD),=CL40' '  CLEAR BUILDING
         MVC   SCRTEL(L'SCRTEL),=CL40' '  INIT PHONE NUMBER
         MVC   SCRSERV(L'SCRSERV),=CL40' '  CLEAR SERVICE
         MVI   ECRANM,C' '
         MVC   ECRANM+1(L'ECRANM-1),ECRANM
         SPACE 1
*--------------------------------------------------------------------*
*        DISPLAY SCREEN ET LECTURE DES INFORMATIONS                  *
*--------------------------------------------------------------------*
*        DESCRIPTION DU BUFFER D'INPUT :
*        -------------------------------
*        LES CHAMPS SONT DANS L'INPUT AREA ET SONT DANS L'ORDRE
*        SUIVANT S'ILS SONT TOUS PRESENTS (MODIFIES) :
*         1 = NOM DU PROGRAMMEUR (CL40)
*         2 = NUMERO DE MATRICULE (CL6)
*         3 = BOX NUMBER (CL3)
*         4 = BUILDING NUMBER (CL6)
*         5 = PHONE NUMBER (CL9)
*         6 = SERVICE NUMBER (CL8)
         SPACE 1
DSPLAY   OI    SWCTL+1,X'F0'           SET SWITCH TO DO CONTROL
         LA    R1,PECRAN               DISPLAY SCREEN
         L     R15,=V(AUT99)
         BALR  R14,R15
         LTR   R15,R15                 NORMAL COMPLETION ?
         BNZ   LEAVE                   NO, END CP (ONLY 4)
         MVI   ECRANM,C' '
         MVC   ECRANM+1(L'ECRANM-1),ECRANM
         L     R15,=V(AUT99R)          GET RESPONSE(S)
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BNZ   *+L'*+12                IF NOT, GO PROCESS
SWCRT    B     CRNONE                  ESCAPE IF NONE FIRST TIME
         NI    SWCTL+1,X'0F'           SET SWITCH TO ALLOW WRITE
         B     STCTRL                  GO DO A FINAL CONTROL
         NI    SWCRT+1,X'0F'           SET SWITCH TO CREATE
         EJECT
*------- STORE AND TRANSLATE ALL INPUT FROM DISPLAY IN UPPER CASE
         CLC   0(3,R15),ASBANM
         BNE   NOTNME
         LTR   R1,R1
         BZ    NMEOK                   IGNORE IF CLEAR
         MVC   SCRNOM,=CL40' '
         LA    R0,L'SCRNOM
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         BCT   R1,*+L'*+6
         OC    SCRNOM(*-*),3(R15)      TRANSLATE LOWER TO UPPER
         EX    R1,*-6
         CLC   SCRNOM+1(L'SCRNOM-1),=CL40' '
         BNE   NMEOK
         CLI   SCRNOM,C'X'             ESCAPE REQUESTED ?
         BNE   NMEOK                   NO
         LA    R1,WCRTE                YES
         B     EXREQ
NMEOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    STCTRL                  IF YES, ALL CHANGE RECEIVED
NOTNME   CLC   0(3,R15),ASBAMT
         BNE   NOTMAT
         MVC   SCRMAT(L'SCRMAT),=CL40' '
         LTR   R1,R1
         BZ    MATOK
         LA    R0,L'SCRMAT
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         LA    R14,SCRMAT+L'SCRMAT
         SLR   R14,R1
         BCT   R1,*+L'*+6
         OC    0(*-*,R14),3(R15)       TRANSLATE LOWER TO UPPER
         EX    R1,*-6
MATOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    STCTRL                  IF YES, ALL CHANGE RECEIVED
NOTMAT   CLC   0(3,R15),ASBABX
         BNE   NOTBOX
         MVC   SCRBOX,=CL3'000'
         LTR   R1,R1
         BZ    BOXOK
         LA    R0,L'SCRBOX
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         BCT   R1,*+L'*+6
         OC    SCRBOX(*-*),3(R15)      TRANSLATE LOWER TO UPPER
         EX    R1,*-6
BOXOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    STCTRL                  IF YES, ALL CHANGE RECEIVED
NOTBOX   CLC   0(3,R15),ASBABN
         BNE   NOTBLD
         MVC   SCRBLD(L'SCRBLD),=CL40' '
         LTR   R1,R1
         BZ    BLDOK
         LA    R0,L'SCRBLD
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         BCT   R1,*+L'*+6
         OC    SCRBLD(*-*),3(R15)      TRANSLATE LOWER TO UPPER
         EX    R1,*-6
BLDOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    STCTRL                  IF YES, ALL CHANGE RECEIVED
NOTBLD   CLC   0(3,R15),ASBATL
         BNE   NOTTEL
         MVC   SCRTEL(L'SCRTEL),=CL40' '
         LTR   R1,R1
         BZ    TELOK
         LA    R0,L'SCRTEL
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         BCT   R1,*+L'*+6
         OC    SCRTEL(*-*),3(R15)      TRANSLATE LOWER TO UPPER
         EX    R1,*-6
TELOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    STCTRL                  IF YES, ALL CHANGE RECEIVED
NOTTEL   CLC   0(3,R15),ASBASV
         BNE   NOTSERV
         MVC   SCRSERV(L'SCRSERV),=CL40' '
         LTR   R1,R1
         BZ    SERVOK
         LA    R0,L'SCRSERV
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         BCT   R1,*+L'*+6
         OC    SCRSERV(*-*),3(R15)     TRANSLATE LOWER TO UPPER
         EX    R1,*-6
SERVOK   L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    STCTRL                  IF YES, ALL CHANGE RECEIVED
NOTSERV  MVC   ECRANM(L'ERROR0),ERROR0 SET ERROR MESSAGE
         B     DSPLAY
         EJECT
*------- CONTROLE ET VALIDATION DES DONNEES LUES SUR LE DISPLAY
STCTRL   CLC   SCRNOM,=CL40' '         NOM DU PROGRAMMEUR ?
         BNE   CHKMAT                  OK, NOT BLANK
         MVC   ECRANM(L'ERROR1),ERROR1 SET ERROR MESSAGE
         B     DSPLAY
WRMAT    MVC   ECRANM(L'ERROR2),ERROR2 SET ERROR MESSAGE
         B     DSPLAY
WRBOX    MVC   ECRANM(L'ERROR3),ERROR3 SET ERROR MESSAGE
         B     DSPLAY
CHKMAT   CLC   SCRMAT(L'SCRMAT),=CL40' '  MATRICULE NUMBER
         BE    CHKBOX
         CLI   SCRMAT,C'E'
         BE    CHKBOX
         LA    R0,L'SCRMAT
         LA    R1,SCRMAT+L'SCRMAT
NXTMAT   BCTR  R1,0
         CLI   0(R1),C' '              TEST IF BLANK AHEAD
         BE    *+L'*+16
         CLI   0(R1),C'0'              TEST IF NUMERIC
         BL    WRMAT
         CLI   0(R1),C'9'
         BH    WRMAT
         BCT   R0,NXTMAT
CHKBOX   LA    R0,L'SCRBOX             BOX NUMBER
         LA    R1,SCRBOX+L'SCRBOX
         BCTR  R1,0
         CLI   0(R1),C'0'              TEST IF NUMERIC
         BL    WRBOX
         CLI   0(R1),C'9'
         BH    WRBOX
         BCT   R0,*-18
SWCTL    B     DSPLAY
         EJECT
*--------------------------------------------------------------------*
*        CREATION DU NOUVEAU PROGRAMMEUR. WRITE DU RECORD.           *
*--------------------------------------------------------------------*
         XC    AREAP(PRGLGTH),AREAP    CLEAR RECORD AREA
         LA    R3,AREAP                SET ADRESSABILITY OF DSECT
         USING PRGDSECT,R3
         PACK  DSD,PGMCHAR
         CVB   R1,DSD
         STH   R1,PRGPNO               SET PROGR. NUMBER
         MVC   PRGMNO,SCRMAT           MATRICULE
         MVC   PRGBXNO,SCRBOX          BOX
         MVC   PRGPNME,SCRNOM          NAME
         MVC   PRGBDNO,SCRBLD          BUILDING
         MVC   PRGPHNO,SCRTEL          PHONE
         MVC   PRGSVNO,SCRSERV         SERVICE
         DROP  R3
        CALL   ZWRITE,(RETCD,ARGUMPRG,AREAP),VL  WRITE RECORD
         LTR   R15,R15                 TEST RETURN CODE
         BNZ   ZWERR
         LA    R1,RQHCPY1              HARDCOPY OF OPERATION
         L     R15,=V(AUT96)
         BALR  R14,R15
         LTR   R15,R15                 TEST RETURN CODE
         BNZ   *+L'*+8
         LA    R1,WCRTE
         B     EXSUCC
         XR    R2,R2                   PASS HARDCOPY ERROR
         LR    R3,R0
         B     SCRAMBLE
ZWERR    LM    R2,R3,NZWR              SAY ZWRITE ERROR
*------- ERREUR AU MOMENT DE LA LECTURE OU DE L'ECRITURE DU RECORD.
ERRZR    LR    R0,R15
         XR    R1,R1
SCRAMBLE L     R15,=V(AUT97)
         BALR  R14,R15
         LA    R15,8                   SAY SEVERE ERROR
LEAVE   $XRET  CC=(R15)                RETURN
UPNONE   LA    R1,WUPTE
         B     EXNONE
CRNONE   LA    R1,WCRTE
EXNONE   MVC   ECRINM(L'MSGSKIP),MSGSKIP
         MVC   ECRINM+L'MSGSKIP-5(4),PGMCHAR
         B     EXBACK
EXREQ    MVC   ECRINM(L'MSGBYPS),MSGBYPS
         MVC   ECRINM+L'MSGBYPS-5(4),PGMCHAR
         B     EXBACK
EXSUCC   MVC   ECRINM(L'MSGDONE),MSGDONE
         MVC   ECRINM+L'MSGDONE-5(4),PGMCHAR
EXBACK   MVC   ECRINM(6),0(R1)
         B     ASKPGM
         EJECT
*--------------------------------------------------------------------*
*        TROUVE LE PROGRAMMEUR DANS LE FICHIER.                      *
*--------------------------------------------------------------------*
         SPACE 1
FNDRC    MVC   AREAPO(PRGLGTH),AREAP   SET FOR HARDCOPY
         OI    SWUPD+1,X'F0'           SET SWITCH TO NO UPDATE
         LA    R3,AREAP                SET ADRESSABILITY OF DSECT
         USING PRGDSECT,R3
         LH    R1,PRGPNO               PGM NUMBER
         LTR   R1,R1
         BNP   *+L'*+8
         MVI   SCRFSI,C' '
         B     *+L'*+4
         MVI   SCRFSI,C'I'             SAY INVALIDATED
         MVC   SCRFPG,PGMCHAR          INIT PGM NUMBER
         MVC   SCRFNM,PRGPNME          SET PGM NAME
         MVC   SCRFMT,PRGMNO           SET MATRICULE
         MVC   SCRFBX,PRGBXNO          SET BOX NUMBER
         MVC   SCRFBN,PRGBDNO          SET BUILDING
         MVC   SCRFTL,PRGPHNO          SET PHONE NUMBER
         MVC   SCRFSV,PRGSVNO          SET SERVICE
         MVI   MSG1,C' '               CLEAR MESSAGE FIELDS
         MVC   MSG1+1(L'MSG1-1),MSG1
         MVC   MSG2,MSG1
         MVI   ECRFNM,C' '
         MVC   ECRFNM+1(L'ECRFNM-1),ECRFNM
*------- RETAIN ALL INITIAL VALUES.
         MVC   INSI,SCRFSI
         MVC   INNM,SCRFNM
         MVC   INMT,SCRFMT
         MVC   INBX,SCRFBX
         MVC   INBN,SCRFBN
         MVC   INTL,SCRFTL
         MVC   INSV,SCRFSV
         EJECT
*--------------------------------------------------------------------*
*        DISPLAY SCREEN ET LECTURE DES INFORMATIONS                  *
*--------------------------------------------------------------------*
*        DESCRIPTION DU BUFFER D'INPUT :
*        -------------------------------
*        LES CHAMPS SONT DANS L'INPUT AREA ET SONT DANS L'ORDRE
*        SUIVANT S'ILS SONT TOUS PRESENTS (MODIFIES) :
*         1 = FLAG DE SUPPRESSION, INVALIDATION DU PROGRAMMEUR :
*                  D OU I (CL1)
*         2 = NOM DU PROGRAMMEUR (CL40)
*         3 = NUMERO DE MATRICULE (CL6)
*         4 = BOX NUMBER (CL3)
*         5 = BUILDING NUMBER (CL6)
*         6 = PHONE NUMBER (CL9)
*         7 = SERVICE NUMBER (CL8)
         SPACE 1
DPLAY    OI    SWUCT+1,X'F0'           SET SWITCH TO DO CONTROL
         LA    R1,PECRFN               DISPLAY SCREEN
         L     R15,=V(AUT99)
         BALR  R14,R15
         LTR   R15,R15                 NORMAL COMPLETION ?
         BNZ   LEAVE                   NO, END CP (ONLY 4)
         MVI   MSG1,C' '               CLEAR MESSAGE FIELDS
         MVC   MSG1+1(L'MSG1-1),MSG1
         MVC   MSG2,MSG1
         MVI   ECRFNM,C' '
         MVC   ECRFNM+1(L'ECRFNM-1),ECRFNM
         L     R15,=V(AUT99R)          GET RESPONSE(S)
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BNZ   *+L'*+12                IF NOT, GO PROCESS
SWUPD    B     UPNONE                  ESCAPE IF NONE FIRST TIME
         NI    SWUCT+1,X'0F'           SET SWITCH TO ALLOW WRITE
         B     UPCTRL                  GO DO A FINAL CONTROL
         NI    SWUPD+1,X'0F'           SET SWITCH TO UPDATE
         EJECT
*------- STORE AND TRANSLATE ALL INPUT FROM DISPLAY IN UPPER CASE
         CLC   0(3,R15),ASBFSI
         BNE   NOTFSI
         MVI   SCRFSI,C' '
         LTR   R1,R1
         BZ    *+L'*+6                 CLEAR OK
         OC    SCRFSI(1),3(R15)        TRANSLATE LOWER CASE TO UPPER
         CLI   SCRFSI,C'D'             IS IT 'D' ?
         BE    WDELET                  IF YES, GO TO DELETE RECORD
         CLI   SCRFSI,C'X'             IS IT 'X' ?
         BNE   *+L'*+8                 IF NOT, CONTINUE
         LA    R1,WUPTE                YES, ESCAPE
         B     EXREQ
         L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    UPCTRL                  IF YES, ALL CHANGE RECEIVED
NOTFSI   CLC   0(3,R15),ASBFNM
         BNE   NOTFNM
         LTR   R1,R1
         BZ    FNMOK                   IGNORE IF CLEAR
         MVC   SCRFNM,=CL40' '
         LA    R0,L'SCRFNM
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         BCT   R1,*+L'*+6
         OC    SCRFNM(*-*),3(R15)      TRANSLATE LOWER TO UPPER
         EX    R1,*-6
FNMOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    UPCTRL                  IF YES, ALL CHANGE RECEIVED
NOTFNM   CLC   0(3,R15),ASBFMT
         BNE   NOTFMT
         MVC   SCRFMT(L'SCRFMT),=CL40' '
         LTR   R1,R1
         BZ    FMTOK
         LA    R0,L'SCRFMT
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         LA    R14,SCRFMT+L'SCRFMT
         SLR   R14,R1
         BCT   R1,*+L'*+6
         OC    0(*-*,R14),3(R15)       TRANSLATE LOWER TO UPPER
         EX    R1,*-6
FMTOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    UPCTRL                  IF YES, ALL CHANGE RECEIVED
NOTFMT   CLC   0(3,R15),ASBFBX
         BNE   NOTFBX
         MVC   SCRFBX,=CL3'000'
         LTR   R1,R1
         BZ    FBXOK
         LA    R0,L'SCRFBX
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         BCT   R1,*+L'*+6
         OC    SCRFBX(*-*),3(R15)      TRANSLATE LOWER TO UPPER
         EX    R1,*-6
FBXOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    UPCTRL                  IF YES, ALL CHANGE RECEIVED
NOTFBX   CLC   0(3,R15),ASBFBN
         BNE   NOTFBN
         MVC   SCRFBN(L'SCRFBN),=CL40' '
         LTR   R1,R1
         BZ    FBNOK
         LA    R0,L'SCRFBN
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         BCT   R1,*+L'*+6
         OC    SCRFBN(*-*),3(R15)      TRANSLATE LOWER TO UPPER
         EX    R1,*-6
FBNOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    UPCTRL                  IF YES, ALL CHANGE RECEIVED
NOTFBN   CLC   0(3,R15),ASBFTL
         BNE   NOTFTL
         MVC   SCRFTL(L'SCRFTL),=CL40' '
         LTR   R1,R1
         BZ    FTLOK
         LA    R0,L'SCRFTL
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         BCT   R1,*+L'*+6
         OC    SCRFTL(*-*),3(R15)      TRANSLATE LOWER TO UPPER
         EX    R1,*-6
FTLOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    UPCTRL                  IF YES, ALL CHANGE RECEIVED
NOTFTL   CLC   0(3,R15),ASBFSV
         BNE   NOTFSV
         MVC   SCRFSV(L'SCRFSV),=CL40' '
         LTR   R1,R1
         BZ    FSVOK
         LA    R0,L'SCRFSV
         CLR   R1,R0
         BNH   *+L'*+2
         LR    R1,R0
         BCT   R1,*+L'*+6
         OC    SCRFSV(*-*),3(R15)      TRANSLATE LOWER TO UPPER
         EX    R1,*-6
FSVOK    L     R15,=V(AUT99R)          GET NEXT FIELD
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    UPCTRL                  IF YES, ALL CHANGE RECEIVED
NOTFSV   MVC   ECRFNM(L'ERROR0),ERROR0 SET ERROR MESSAGE
         B     DPLAY
         EJECT
*------- CONTROLE ET VALIDATION DES DONNEES LUES SUR LE DISPLAY
UPCTRL   CLI   SCRFSI,C' '             IS IT BLANK ?
         BE    VALSI                   IF YES, IT IS VALID
         CLI   SCRFSI,C'I'             IF NO, IS IT 'I' ?
         BE    VALSI                   IF YES, IT IS VALID
         MVC   ECRFNM(L'ERROR4),ERROR4 SET ERROR MESSAGE
         B     DPLAY
VALSI    CLC   SCRFNM,=CL40' '         NOM DU PROGRAMMEUR ?
         BNE   CHKFMT                  OK, NOT BLANK
         MVC   ECRFNM(L'ERROR1),ERROR1 SET ERROR MESSAGE
         B     DPLAY
WRFMT    MVC   ECRFNM(L'ERROR2),ERROR2 SET ERROR MESSAGE
         B     DPLAY
WRFBX    MVC   ECRFNM(L'ERROR3),ERROR3 SET ERROR MESSAGE
         B     DPLAY
CHKFMT   CLC   SCRFMT(L'SCRFMT),=CL40' '  MATRICULE NUMBER
         BE    CHKFBX
         CLI   SCRFMT,C'E'
         BE    CHKFBX
         LA    R0,L'SCRFMT
         LA    R1,SCRFMT+L'SCRFMT
NXTFMT   BCTR  R1,0
         CLI   0(R1),C' '              TEST IF BLANK AHEAD
         BE    NXSFMT
         CLI   0(R1),C'0'              TEST IF NUMERIC
         BL    WRFMT
         CLI   0(R1),C'9'
         BH    WRFMT
NXSFMT   BCT   R0,NXTFMT
CHKFBX   LA    R0,L'SCRFBX             BOX NUMBER
         LA    R1,SCRFBX+L'SCRFBX
CHKLBX   BCTR  R1,0
         CLI   0(R1),C'0'              TEST IF NUMERIC
         BL    WRFBX
         CLI   0(R1),C'9'
         BH    WRFBX
         BCT   R0,CHKLBX
SWUCT    B     DPLAY
         EJECT
*------- SEE IF SOME INITIAL VALUES CHANGED.
         NI    CMSWW+1,X'0F'
         CLC   INSI,SCRFSI
         BE    CMBXN
         CLI   INSI,C' '
         BNE   CMSET
         L     R15,=A(EXTCTL)          * * * EXTENDED CONTROL * * *
         BALR  R14,R15                 * * * EXTENDED CONTROL * * *
         DC    Y(CHKINP-EXTCTL)        * * * EXTENDED CONTROL * * *
CMSET    OI    CMSWW+1,X'F0'
CMBXN    CLC   INBX,SCRFBX
         BE    CMSWW
         CLC   INBX(L'INBX),=CL40' '
         BE    CMBXS
         L     R15,=A(EXTCTL)          * * * EXTENDED CONTROL * * *
         BALR  R14,R15                 * * * EXTENDED CONTROL * * *
         DC    Y(CHKPBX-EXTCTL)        * * * EXTENDED CONTROL * * *
CMBXS    OI    CMSWW+1,X'F0'
CMSWW    NOP   EXWRT
         CLC   INNM,SCRFNM
         BNE   EXWRT
         CLC   INMT,SCRFMT
         BNE   EXWRT
         CLC   INBN,SCRFBN
         BNE   EXWRT
         CLC   INTL,SCRFTL
         BNE   EXWRT
         CLC   INSV,SCRFSV
         BNE   EXWRT
         MVC   ECRINM(L'MSGUPDN),MSGUPDN
         MVC   ECRINM+L'MSGUPDN-5(4),PGMCHAR
         B     ASKPGM
         EJECT
*--------------------------------------------------------------------*
*        UPDATE PROGRAMMER IN FILE.                                  *
*--------------------------------------------------------------------*
         SPACE 1
*------- TEST IF PROGRAMMER CAN BE INVALIDATED IF REQUESTED.
EXWRT    CLI   SCRFSI,C'I'             INVALIDATE REQUESTED ?
         BNE   TSTUPD                  NO
         BAL   R9,SEARCH               YES, COLLECT ALL AUT. NO.S
         L     R1,=A(VECTI)            ADDRESS OF VECTOR
SCUPD    OC    0(L'VECTI,R1),0(R1)     END OF VECTOR ?
         BZ    OKUPD                   YES
         TM    0(R1),FLRESP            IS IT A RESP. PROGR. ?
         BO    *+L'*+8                 YES, CANNOT DELETE
         LA    R1,L'VECTI(R1)          JUMP TO NEXT VECTOR ELEMENT
         B     SCUPD
         MVC   MSGREJ(6),WUPTE
         MVC   MSGREJ+L'MSGREJ-5(4),PGMCHAR
EXREJ    LA    R1,MSGREJ
         L     R2,4(R13)
         ST    R1,24(R2)               PASS ADDRESS OF MESSAGE
         XR    R15,R15
         B     LEAVE
*------- TEST IF PROGRAMMER MUST BE REACTIVATED SOMEWHERE.
TSTUPD   CLI   INSI,C'I'               WAS PROGR. PREVIOUSLY INVALID ?
         BNE   BLDUPD                  NO
         BAL   R9,SEARCH               YES, COLLECT ALL AUT. NO.S
         L     R1,=A(VECTI)            ADDRESS OF VECTOR
UPDSC    OC    0(L'VECTI,R1),0(R1)     END OF VECTOR ?
         BZ    BLDUPD                  YES, NONE FOUND
         TM    0(R1),FLINVP            IS IT IN PROGR. INVALID ?
         BO    OKUPD                   YES, GO REACTIVE
         LA    R1,L'VECTI(R1)          JUMP TO NEXT VECTOR ELEMENT
         B     UPDSC
OKUPD    BAL   R9,CORRECT              GO CORRECT ALL AUT.
*------- BUILD PROGRAMMER UPDATE RECORD.
BLDUPD   XC    AREAP(PRGLGTH),AREAP    CLEAR RECORD AREA
         PACK  DSD,PGMCHAR
         CVB   R1,DSD
         CLI   SCRFSI,C'I'             INVALIDATE REQUESTED ?
         BNE   *+L'*+2                 NO
         LNR   R1,R1                   YES, SET NEGATIVE
         STH   R1,PRGPNO               SET PROGR. NUMBER
         MVC   PRGMNO,SCRFMT           MATRICULE
         MVC   PRGBXNO,SCRFBX          BOX
         MVC   PRGPNME,SCRFNM          NAME
         MVC   PRGBDNO,SCRFBN          BUILDING
         MVC   PRGPHNO,SCRFTL          PHONE
         MVC   PRGSVNO,SCRFSV          SERVICE
         DROP  R3
        CALL   ZWRITE,(RETCD,ARGUMPRG,AREAP),VL  WRITE RECORD
         LTR   R15,R15                 TEST RETURN CODE
         BNZ   ZWERR                   SAY ZWRITE ERROR
         LA    R1,RQHCPY2              HARDCOPY OF OPERATION
         L     R15,=V(AUT96)
         BALR  R14,R15
         LTR   R15,R15                 TEST RETURN CODE
         BNZ   *+L'*+8
         LA    R1,WUPTE
         B     EXSUCC
         XR    R2,R2                   PASS HARDCOPY ERROR
         LR    R3,R0
         B     SCRAMBLE
         EJECT
*--------------------------------------------------------------------*
*        DELETE PROGRAMMER FROM FILE.                                *
*--------------------------------------------------------------------*
         SPACE 1
*------- TEST IF PROGRAMMER CAN BE DELETED.
WDELET   CLI   INSI,C'I'               INVALID PRG.?
         BE    DLPOK                   YES
         L     R15,=A(EXTCTL)          * * * EXTENDED CONTROL * * *
         BALR  R14,R15                 * * * EXTENDED CONTROL * * *
         DC    Y(CHKDLP-EXTCTL)        * * * EXTENDED CONTROL * * *
DLPOK    BAL   R9,SEARCH               COLLECT ALL AUT. NO.S
         L     R1,=A(VECTI)            ADDRESS OF VECTOR
SCDLT    OC    0(L'VECTI,R1),0(R1)     END OF VECTOR ?
         BZ    OKDLT                   YES
         TM    0(R1),FLRESP            IS IT A RESP. PROGR. ?
         BO    *+L'*+8                 YES, CANNOT DELETE
         LA    R1,L'VECTI(R1)          JUMP TO NEXT VECTOR ELEMENT
         B     SCDLT
         MVC   MSGREJ(6),WDLTE
         MVC   MSGREJ+L'MSGREJ-5(4),PGMCHAR
         B     EXREJ
*------- PROGRAMMER CAN BE DELETED, ASK CONFIRM.
OKDLT    MVC   ECRADA,PGMCHAR          SET PRG. NR. IN DISPLAY
         LA    R1,PECRAD               DISPLAY SCREEN TO CONFIRM
         L     R15,=V(AUT99)
         BALR  R14,R15
         LTR   R15,R15                 NORMAL COMPLETION ?
         BNZ   LEAVE                   NO, END CP (ONLY 4)
         MVI   ECRADM,C' '
         MVC   ECRADM+1(L'ECRADM-1),ECRADM
         L     R15,=V(AUT99R)          GET RESPONSE(S)
         BALR  R14,R15
         LTR   R15,R15                 ONLY END OF TEXT ?
         BZ    DPLAY                   IF YES, ESCAPE
         LTR   R1,R1                   NO TEXT ?
         BZ    DPLAY                   YES, ESCAPE
         MVC   RESPONSE(1),3(R15)
         OI    RESPONSE,C' '           TRANSLATE LOWER CASE IN UPPER
         CLI   RESPONSE,C'Y'           IS RESPONSE = Y ?
         BE    XDELET                  IF YES, GO TO DELETE
         CLI   RESPONSE,C'N'           IS RESPONSE = N ?
         BE    DPLAY                   IF YES, ESCAPE
         CLI   RESPONSE,C' '           IS RESPONSE = BLANK ?
         BE    DPLAY                   IF YES, ESCAPE
         MVC   ECRADM(L'MSGRSP),MSGRSP
         MVC   ECRADM+L'MSGRSP-5(1),RESPONSE
         B     OKDLT+L'OKDLT           BACK TO CONFIRM AGAIN
XDELET   BAL   R9,CORRECT              GO CORRECT ALL AUT.
        CALL   ZDELET,(RETCD,ARGUMPRG),VL
         LTR   R15,R15
         BNZ   ZDERR
         LA    R1,RQHCPY3              HARDCOPY OF OPERATION
         L     R15,=V(AUT96)
         BALR  R14,R15
         LTR   R15,R15                 TEST RETURN CODE
         BNZ   *+L'*+8
         LA    R1,WDLTE
         B     EXSUCC
         XR    R2,R2                   PASS HARDCOPY ERROR
         LR    R3,R0
         B     SCRAMBLE
ZDERR    LM    R2,R3,NZDL              SAY ZDELET ERROR
         B     ERRZR
         EJECT
*--------------------------------------------------------------------*
*        BOUCLE DE RECHERCHE DU PROGRAMMEUR DANS TOUTES LES          *
*        AUTORISATIONS (ROUTINE) - LINK = R9                         *
*--------------------------------------------------------------------*
         SPACE 1
SEARCH   L     R6,=A(VECTI)            ADDRESS OF VECTOR
         LA    R7,NVECT+1              NUMBER OF ELEMENTS
         PACK  DSD,PGMCHAR             PACK PROGR. NBR
         CVB   R1,DSD
         STH   R1,POSIPGM              STORE IN POSITIVE PROGRAMMER
         LNR   R1,R1                   CONVERT IN NEGATIVE
         STH   R1,NEGAPGM              STORE IN NEGATIVE PROGRAMMER
         LA    R2,AREAR                SET ADDRESSABILITY OF AUTH DSECT
         USING AUTDSECT,R2
         XC    ARGUMAUT,ARGUMAUT       RESET ARGUMENT
LOOPAUT  BCT   R7,*+L'*+12             LOOP UNTIL PLACE IN VECTOR
         LA    R1,MSGVOV               VECTOR OVERFLOW
         XR    R2,R2
         LR    R3,R2
         B     SCRAMBLE
         XC    0(L'VECTI,R6),0(R6)     RESET VECTOR ELEMENT
SRCHNXT CALL   ZSEQR,(RETCD,AREAR,ARGUMAUT),VL  READ FILE
         LTR   R15,R15                 TEST RETURN CODE
         BMR   R9                      IF NEGATIVE, END-OF-DATA
         BZ    *+L'*+8                 IF ZERO, OK
         LM    R2,R3,NZSQ              SAY ZSEQR ERROR
         B     ERRZR
         CLC   ARGUMAUT,=Y(NAUTNO)     IS THE LAST AUTH. PROCESSED ?
         BHR   R9                      IF YES, BACK TO CALLER
*------- EXPLOITATION DU VECTEUR.
         OI    SWSTI+1,X'F0'           CLOSE SWITCH OF STORE AUT. NO.
         CLC   AUTPMNO,POSIPGM         IS IT THE AUTH. RESPONSIBLE ?
         BNE   *+L'*+8                 BRANCH IF NOT
         OI    0(R6),FLRESP            YES, SAY RESPONSIBLE
         NI    SWSTI+1,X'0F'           OPEN SWITCH TO STORE AUT. NO.
         LA    R5,AUTPNO               ADDR VECTOR OF PGM NBR IN AUT
         LA    R4,AUTNPNF              MAX NBR IN VECTOR
LOOPNBR  OC    0(L'AUTPNO,R5),0(R5)    IS THERE A PROGR. ?
         BZ    SKPPGM                  IF NOT, GO TO NEXT
         CLC   0(L'AUTPNO,R5),POSIPGM  IS PROGR. IN AUTHORIZATION ?
         BE    POSPGM                  IF YES, GO TO PRESENT POSITIVE
         CLC   0(L'AUTPNO,R5),NEGAPGM  IS PROG IN AUT IN NEGATIVE ?
         BNE   SKPPGM                  IF NOT, GO TO NEXT
         OI    0(R6),FLINVP            YES, SAY INVALIDATED
POSPGM   NI    SWSTI+1,X'0F'           OPEN SWITCH TO STORE AUT. NO.
SKPPGM   LA    R5,L'AUTPNO(R5)         JUMP TO NEXT PGM NBR IN VECTOR
         BCT   R4,LOOPNBR              LOOP TO EXPLOITATION VECTEUR
SWSTI    B     SRCHNXT
         MVC   1(2,R6),ARGUMAUT        SET AUT. NO.
         LA    R6,L'VECTI(R6)          JUMP TO NEXT VECTOR ELEMENT
         B     LOOPAUT
         DROP  R2
         EJECT
*--------------------------------------------------------------------*
*        BOUCLE DE CORRECTION DU PROGRAMMEUR DANS TOUTES LES         *
*        AUTORISATIONS (ROUTINE) - LINK = R9                         *
*--------------------------------------------------------------------*
         SPACE 1
CORRECT  MVC   MSGAUPN,PGMCHAR         SET PGM NO.
         LA    R1,MSGAUP
         STCM  R1,B'1111',RQHCPY0+L'RQHCPY0
         LA    R1,RQHCPY0              SET MESSAGE TO HARDCOPY
         L     R15,=V(AUT96)
         BALR  R14,R15
         LA    R2,AREAR                SET ADDRESSABILITY OF AUT. DSECT
         USING AUTDSECT,R2
         MVC   ECRUNP,PGMCHAR          SET PGM NO.
         MVI   ECRUNW,C' '
         MVC   ECRUNW+1(L'ECRUNW-1),ECRUNW
         CLI   SCRFSI,C'D'             DELETION REQ'D ?
         BNE   TTITT                   NO, INVALIDATE OR REACTIVE
         MVC   ECRUNT,WDLTE
         MVC   ECRUNW(8),=CL8'deleted '
         LA    R1,ECRUNW+8
         B     TTITS
TTITT    MVC   ECRUNT,WUPTE
         CLI   SCRFSI,C'I'             INVALIDATION REQ'D ?
         BNE   *+L'*+10                NO, REACTIVE
         MVC   ECRUNW(12),=CL12'invalidated '
         B     *+L'*+6
         MVC   ECRUNW(12),=CL12'reactivated '
         LA    R1,ECRUNW+12
TTITS    MVC   0(35,R1),=CL35'in the following Authorization(s) :'
         BAL   R14,ITSCR               INIT SCREEN
         L     R6,=A(VECTI)            ADDRESS OF VECTOR
LOOPVI   OC    0(L'VECTI,R6),0(R6)     END OF VECTOR ?
         BZ    ALLCORR                 YES
         CLI   SCRFSI,C' '             IF NO, REACTIVATION REQ'D ?
         BNE   *+L'*+8                 NO, INVALIDATION OR DELETION
         TM    0(R6),FLINVP            YES, IS IT IN PGM INVALID ?
         BZ    NXTVI                   NO, DON'T CHANGE
         OI    SWCHG+1,X'F0'           SET NO CHANGES
         MVC   ARGUMAUT(2),1(R6)       SET AUTH. AS ARGUM.
        CALL   ZREAD,(RETCD,ARGUMAUT,AREAR),VL  READ FILE
         LTR   R15,R15                 TEST RETURN CODE
         BZ    *+L'*+8                 IF ZERO, OK
         LM    R2,R3,NZRD              IF NOT, SAY ZREAD ERROR
         B     ERRZR                   GO DISPLAY Z... MESSAGE
         MVC   AREARO(AUTLGTH),AREAR   SET FOR HARDCOPY
         LA    R5,AUTPNO               ADDR VECTOR OF PGM NBR IN AUT
         LA    R4,AUTNPNF              MAX NBR IN VECTOR
LOOPCRR  CLC   0(L'AUTPNO,R5),POSIPGM  IS PROGR. IN AUTHORIZATION ?
         BE    *+L'*+10                IF YES, GO TO PRESENT POSITIVE
         CLC   0(L'AUTPNO,R5),NEGAPGM  IS PROG IN AUT IN NEGATIVE ?
         BNE   LOOPNXT                 IF NOT, GO TO NEXT
         CLI   SCRFSI,C'D'             IF YES, NEGATIVE, DELETE REQ'D ?
         BNE   LOOKINV                 NO, LOOK FURTHER
         XC    0(L'AUTPNO,R5),0(R5)    YES, CLEAR IT
         B     SETCHGS
LOOKINV  CLI   SCRFSI,C'I'             IS IT INVALIDATION REQ'D ?
         BE    PRCINV                  YES, GO PROCESS INVALID
         LH    R1,0(R5)                GET PGM NO.
         LTR   R1,R1                   ALREADY ACTIVE ?
         BNM   LOOPNXT                 YES
         LPR   R1,R1                   NO, REACTIVE IT
         STH   R1,0(R5)                AND STORE IT BACK
         B     SETCHGS
PRCINV   LH    R1,0(R5)                GET PGM NO.
         LTR   R1,R1                   ALREADY INVALID ?
         BM    LOOPNXT                 YES
         LNR   R1,R1                   NO, INVALID IT
         STH   R1,0(R5)                AND STORE IT BACK
SETCHGS  NI    SWCHG+1,X'0F'           SET CHANGES OCCUR'D
LOOPNXT  LA    R5,L'AUTPNO(R5)         JUMP TO NEXT PGM NBR IN VECTOR
         BCT   R4,LOOPCRR              LOOP TO EXPLOITATION VECTEUR
SWCHG    B     NXTVI
*------- REORGANIZE THE AUTHORIZATION RECORD.
         LA    R5,AUTPNO               ADDR VECTOR OF PGM NBR IN AUT
         LA    R4,AUTNPNF              NUMBER OF PROGR. IN LIST
         LA    R15,VWORK
SREORG   MVC   0(L'VWORK,R15),=CL40' '
         LH    R0,0(R5)                GET PROGR. NUMBER
         LTR   R0,R0                   TEST SIGN-VALUE
         BZ    NREORG                  IF ZERO, JUMP IT
         BP    *+L'*+6
         LPR   R0,R0                   IF NEGATIVE SET IT POSITIVE
         MVI   4(R15),C'I'             SAY INVALID
         CVD   R0,DSD                  CONVERT IN PACKED
         UNPK  0(4,R15),DSD+5(3)       CONVERT IN EBCDIC
         OI    3(R15),C'0'             SET LAST ZONING AFTER UNPK
NREORG   LA    R15,L'VWORK(R15)        BUMP POINTERS
         LA    R5,L'AUTPNO(R5)
         BCT   R4,SREORG               LOOP MAX N... TIMES
        $SORT  VWORK,AUTNPNF,L'VWORK,0,L'VWORK-1
         LA    R5,AUTPNO               ADDR VECTOR OF PGM NBR IN AUT
         LA    R4,AUTNPNF              NUMBER OF PROGR. IN LIST
         LA    R15,VWORK
         LR    R14,R4
LREORG   CLC   0(L'VWORK,R15),=CL40' ' EMPTY ELEMENT ?
         BE    TREORG                  YES, GO TO NEXT
         PACK  DSD,0(4,R15)            PACK PROGR. NUMBER
         CVB   R0,DSD                  CONVERT IT TO BINARY
         CLI   4(R15),C'I'             IS IT INVALID ?
         BNE   *+L'*+2                 NO
         LNR   R0,R0                   YES, SET IT NEGATIVE
         STH   R0,0(R5)                STORE IT
         LA    R5,L'AUTPNO(R5)         BUMP RECORD POINTER
         BCTR  R4,0                    MINUS ONE TO COUNT
TREORG   LA    R15,L'VWORK(R15)        BUMP POINTERS
         BCT   R14,LREORG              LOOP MAX N... TIMES
         LTR   R4,R4                   IS RECORD LIST FILLED ?
         BNP   *+L'*+14                YES
         XR    R0,R0                   NO, RESET THE REST OF RECORD
         STH   R0,0(R5)                NULLIFY THIS
         LA    R5,L'AUTPNO(R5)         BUMP RECORD POINTER
         BCT   R4,*-8                  LOOP MAX N... TIMES
*------- WRITE BACK AUTHORIZATION IN FILE.
        CALL   ZWRITE,(RETCD,ARGUMAUT,AREAR),VL  WRITE FILE
         LTR   R15,R15
         BZ    *+L'*+8                 IF ZERO, OK
         LM    R2,R3,NZWR              IF NOT, SAY ZWRITE ERROR
         B     ERRZR                   GO DISPLAY Z... MESSAGE
         LA    R1,RQHCPY4              HARDCOPY OF OPERATION
         L     R15,=V(AUT96)
         BALR  R14,R15
         LTR   R15,R15                 TEST RETURN CODE
         BZ    *+L'*+8
         XR    R2,R2                   PASS HARDCOPY ERROR
         LR    R3,R0
         B     SCRAMBLE
         BCT   R8,SETVI
         MVC   ECRUNC,=CL6'*MORE*'
         LA    R1,PECRUN               DISPLAY THIS SCREEN
         L     R15,=V(AUT99)
         BALR  R14,R15
         LTR   R15,R15                 NORMAL COMPLETION ?
         BNZ   LEAVE                   NO, END CP (ONLY 4)
         BAL   R14,ITSCR               INIT SCREEN
         BCTR  R8,0
SETVI    LA    R7,DX(R7)
         LH    R1,ARGUMAUT             INFORM ABOUT THIS AUT. NO.
         CVD   R1,DSD
         UNPK  DSD(5),DSD+5(3)
         OI    DSD+4,C'0'
         MVC   0(L'AUT1,R7),DSD+1
NXTVI    LA    R6,L'VECTI(R6)          JUMP TO NEXT VECTOR ELEMENT
         B     LOOPVI
         DROP  R2
ALLCORR  CLC   AUT1(L'AUT1),=CL40' '   ANYTHING TO DISPLAY ?
         BE    RSMSG                   NO
         LA    R1,PECRUN               YES, DISPLAY SCREEN
         L     R15,=V(AUT99)
         BALR  R14,R15
         LTR   R15,R15                 NORMAL COMPLETION ?
         BNZ   LEAVE                   NO, END CP (ONLY 4)
RSMSG    XC    RQHCPY0+L'RQHCPY0(4),RQHCPY0+L'RQHCPY0
         LA    R1,RQHCPY0              RESET MESSAGE TO HARDCOPY
         L     R15,=V(AUT96)
         LR    R14,R9
         BR    R15                     GO AND BACK TO CALLER
*------- INITIALIZE SCREEN FIELDS ROUTINE (LINK = R14).
ITSCR    LA    R1,AUT1                 CLEAR SCREEN
         LA    R0,NDL
         MVC   0(L'AUT1,R1),=CL40' '
         LA    R1,DX(R1)
         BCT   R0,*-10
         LA    R7,AUT1-DX              SCREEN ADDRESS OF AUT. NO.S
         LA    R8,NDL+1                NUMBER AUT. NO.S IN SCREEN
         MVC   ECRUNC(L'ECRUNC),=CL40' '
         BR    R14                     RETURN
         EJECT
*--------------------------------------------------------------------*
*        VARIABLES DE TRAVAIL.                                       *
*--------------------------------------------------------------------*
         SPACE 1
DSD      DC    D'0'
PECRIN   DC    A(LECRIN,ECRIN)
PECRAW   DC    A(LECRAW,ECRAW)
PECRAN   DC    A(LECRAN,ECRAN)
PECRFN   DC    A(LECRFN,ECRFN)
PECRAD   DC    A(LECRAD,ECRAD)
PECRUN   DC    A(LECRUN,ECRUN)
RETCD    DC    F'0'                    RETURN CODE
NZRD     DC    0F'0',CL8'ZREAD'
NZWR     DC    0F'0',CL8'ZWRITE'
NZDL     DC    0F'0',CL8'ZDELET'
NZSQ     DC    0F'0',CL8'ZSEQR'
AREAR    DC    (AUTLGTH)X'0'           RECORD AUTHORIZATION
AREARO   DC    (AUTLGTH)X'0'           RECORD AUTHORIZATION
AREAP    DC    (PRGLGTH)X'0'           RECORD PROGRAMMER
AREAPO   DC    (PRGLGTH)X'0'           RECORD PROGRAMMER
ARGUMPRG DC    H'0'                    PROGR. NBR TO POINT IN FILE
ARGUMAUT DC    H'0'                    AUTH. NBR TO POINT IN FILE
POSIPGM  DC    H'0'                    PROGR. NBR IN POSITIVE
NEGAPGM  DC    H'0'                    PROGR. NBR IN NEGATIVE
PGMCHAR  DC    CL4' '                  PROGR. NBR IN EBCDIC
WCL4     DC    CL4' '
RESPONSE DC    C' '
WCRTE    DC    CL6'CREATE'
WUPTE    DC    CL6'UPDATE'
WDLTE    DC    CL6'DELETE'
         SPACE 1
*--------------------------------------------------------------------*
*        UPDATE INITIAL VALUES.                                      *
*--------------------------------------------------------------------*
         SPACE 1
INSI     DC    CL1' '
INNM     DC    CL40' '
INMT     DC    CL6' '
INBX     DC    CL3' '
INBN     DC    CL6' '
INTL     DC    CL9' '
INSV     DC    CL8' '
         EJECT
*--------------------------------------------------------------------*
*        REORGANIZATION WORKING VECTOR.                              *
*--------------------------------------------------------------------*
         SPACE 1
VWORK    DS    0CL5          WORKING VECTOR
*                            +0 = PGM NBR IN EBCDIC
*                            +4 = 'I' IF PGM NBR < 0
         DC    (AUTNPNF)CL5' '
         SPACE 1
*--------------------------------------------------------------------*
*        MESSAGES D'ERREURS ET DEMANDES.                             *
*--------------------------------------------------------------------*
         SPACE 1
         DC    AL1(MSGAUPL)
MSGAUP   DC    C'0===> Authorization(s) modified because '
         DC    C'change status of Programmer : '
MSGAUPN  DC    CL4' ',C' <==='
MSGAUPL  EQU   *-MSGAUP
         DC    AL1(L'MSGREJ)
MSGREJ   DC    C'       rejected - Programmer is Responsible :     .'
         DC    AL1(L'MSGVOV)
MSGVOV   DC    C' Authorizations Numbers VECTOR overflow |||'
MSGPN1   DC    C'Programmer Number NOT Numeric or NOT 4 digits'
MSGRSP   DC    C'Unknown response received :   ???'
ERROR0   DC    C'Input scan SBA order not found ???'
ERROR1   DC    C'Please, enter the Programmer''s Name |'
ERROR2   DC    C'Matricule Number NOT Numeric or Not 6 digits (unless E1
               ... = External or null)'
ERROR3   DC    C'Box Number NOT Numeric or Not 3 digits'
ERROR4   DC    C'Programmer state/action error (set I, D or null)'
MSGDONE  DC    C'       is successfully done - Programmer :     .'
MSGSKIP  DC    C'       bypassed - None set - Programmer :     .'
MSGBYPS  DC    C'       bypassed - Escape... - Programmer :     .'
MSGUPDN  DC    C'UPDATE bypassed - No change - Programmer :     .'
         SPACE 1
*--------------------------------------------------------------------*
*        HARDCOPY REQUESTS.                                          *
*--------------------------------------------------------------------*
         SPACE 1
RQHCPY0  DC    AL1(0),AL4(MSGAUP)   SET MESSAGE.
RQHCPY1  DC    AL1(2),AL4(ARGUMPRG,AREAP)   CREATE PROGRAMMER.
RQHCPY2  DC    AL1(4),AL4(ARGUMPRG,AREAPO,AREAP)   UPDATE PROGRAMMER.
RQHCPY3  DC    AL1(6),AL4(ARGUMPRG,AREAPO)   DELETE PROGRAMMER.
RQHCPY4  DC    AL1(3),AL4(ARGUMAUT,AREARO,AREAR)   UPDATE AUTH.
         EJECT
*--------------------------------------------------------------------*
*        ECRANS D'OUTPUT.                                            *
*--------------------------------------------------------------------*
         SPACE 1
ECRIN   $FS    CC=W,WCC=(KBR,RMDT),SBA=(24,80),MF=L
        $FS    SBA=(1,1),RA=(1,1,00),MF=L        SET BUFFER/CLEAR.
        $FS    SBA=(1,1),SF=(PROT),MF=L
        $FS    SBA=(1,25),SF=(PROT,INT),MF=L
        $FS    TEXT='P R O G R A M M E R    NUMBER',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(2,25),SF=(PROT,INT),MF=L
        $FS    TEXT='=============================',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(5,10),SF=(PROT),MF=L
        $FS    TEXT='Enter Programmer Number (4 numerics)',MF=L
        $FS    SF=(PROT,INT),TEXT='===>',MF=L
        $FS    SF=(INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(6,10),SF=(PROT),TEXT='or you may Hit',MF=L
        $FS    SF=(PROT,INT),TEXT='ENTER',MF=L
        $FS    SF=(PROT),TEXT='to escape or',MF=L
        $FS    SF=(PROT,INT),TEXT='PF-3',MF=L
        $FS    SF=(PROT),TEXT='to exit (emergency)',MF=L
        $FS    SBA=(17,1),SF=(PROT,INT),TEXT='Mandatory :',MF=L
        $FS    SF=(PROT),TEXT='a Programmer Number cannot ',MF=L
        $FS    TEXT='be Invalidated or Deleted until',MF=L
        $FS    SBA=(18,14),TEXT='it is indicated as Responsible ',MF=L
        $FS    TEXT='Programmer in one or more',MF=L
        $FS    SBA=(19,14),TEXT='Authorizations.',MF=L
        $FS    SBA=(23,1),SF=(PROT,INT),MF=L
ECRINM  $FS    TEXT=(' ',78),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(1,1),SF=(PT,IC),MF=L
LECRIN   EQU   *-ECRIN
         SPACE 1
ECRAW   $FS    CC=W,WCC=(KBR,RMDT),SBA=(24,80),MF=L
        $FS    SBA=(1,1),RA=(1,1,00),MF=L        SET BUFFER/CLEAR.
        $FS    SBA=(1,1),SF=(PROT),MF=L
        $FS    SBA=(1,25),SF=(PROT,INT),MF=L
        $FS    TEXT='P R O G R A M M E R    NUMBER',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(2,25),SF=(PROT,INT),MF=L
        $FS    TEXT='=============================',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(5,10),SF=(PROT),MF=L
        $FS    TEXT='Programmer Number NOT FOUND in file.',MF=L
        $FS    SBA=(6,10),SF=(PROT),TEXT='Enter',MF=L
        $FS    SF=(PROT,INT),TEXT='Y',MF=L
        $FS    SF=(PROT),TEXT='if you are creating a new one',MF=L
        $FS    SF=(PROT,INT),TEXT='===>',MF=L
        $FS    SF=(INT),TEXT=' ',MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(7,10),SF=(PROT),TEXT='or you may Hit',MF=L
        $FS    SF=(PROT,INT),TEXT='ENTER',MF=L
        $FS    SF=(PROT),TEXT='to escape or',MF=L
        $FS    SF=(PROT,INT),TEXT='PF-3',MF=L
        $FS    SF=(PROT),TEXT='to exit (emergency)',MF=L
        $FS    SBA=(23,1),SF=(PROT,INT),MF=L
ECRAWM  $FS    TEXT=(' ',78),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(1,1),SF=(PT,IC),MF=L
LECRAW   EQU   *-ECRAW
         SPACE 1
ECRAN   $FS    CC=W,WCC=(KBR,RMDT),SBA=(24,80),MF=L
        $FS    SBA=(1,1),RA=(1,1,00),MF=L        SET BUFFER/CLEAR.
        $FS    SBA=(1,1),SF=(PROT),MF=L
        $FS    SBA=(1,25),SF=(PROT,INT),MF=L
        $FS    TEXT='P R O G R A M M E R    CREATE',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(2,25),SF=(PROT,INT),MF=L
        $FS    TEXT='=============================',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(5,9),SF=(PROT),TEXT='Programmer Number :',MF=L
        $FS    SF=(PROT,INT),MF=L
SCRPGM  $FS    TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(6,11),SF=(PROT),TEXT='Programmer Name :',MF=L
        $FS    SF=(INT),MF=L
ASBANM  $FS    SBA=(6,30),MF=L
SCRNOM  $FS    TEXT=(' ',40),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(7,29),SF=(PROT),TEXT='(or enter',MF=L
        $FS    SF=(PROT,INT),TEXT='X',MF=L
        $FS    SF=(PROT),TEXT='to escape)',MF=L
        $FS    SBA=(9,17),SF=(PROT),TEXT='Matricola :',MF=L
        $FS    SF=(INT),MF=L
ASBAMT  $FS    SBA=(9,30),MF=L
SCRMAT  $FS    TEXT=(' ',6),MF=L
        $FS    SF=(PROT),TEXT='< (1-6 digits or E..... ',MF=L
        $FS    TEXT='for an External) ',MF=L
        $FS    SBA=(11,8),SF=(PROT),TEXT='Listing Box Number :',MF=L
        $FS    SF=(INT),MF=L
ASBABX  $FS    SBA=(11,30),MF=L
SCRBOX  $FS    TEXT=(' ',3),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(13,11),SF=(PROT),TEXT='Building Number :',MF=L
        $FS    SF=(INT),MF=L
ASBABN  $FS    SBA=(13,30),MF=L
SCRBLD  $FS    TEXT=(' ',6),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(15,14),SF=(PROT),TEXT='Phone Number :',MF=L
        $FS    SF=(INT),MF=L
ASBATL  $FS    SBA=(15,30),MF=L
SCRTEL  $FS    TEXT=(' ',9),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(17,19),SF=(PROT),TEXT='Service :',MF=L
        $FS    SF=(INT),MF=L
ASBASV  $FS    SBA=(17,30),MF=L
SCRSERV $FS    TEXT=(' ',8),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(20,1),SF=(PROT,INT),MF=L
ECRANM  $FS    TEXT=(' ',78),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(22,1),SF=(PROT),MF=L
        $FS    TEXT='Type in needed data and hit',MF=L
        $FS    SF=(PROT,INT),TEXT='ENTER',MF=L
        $FS    SF=(PROT),TEXT='until they are correct, ',MF=L
        $FS    TEXT='then hit only',MF=L
        $FS    SF=(PROT,INT),TEXT='ENTER',MF=L
        $FS    SBA=(21,1),SF=(PROT),MF=L
        $FS    TEXT='to create the Programmer, ',MF=L
        $FS    TEXT='or use at any time',MF=L
        $FS    SF=(PROT,INT),TEXT='PF-3',MF=L
        $FS    SF=(PROT),TEXT='to exit (emergency)',MF=L
        $FS    SBA=(1,1),SF=(PT,IC),MF=L
LECRAN   EQU   *-ECRAN
         SPACE 1
ECRFN   $FS    CC=W,WCC=(KBR,RMDT),SBA=(24,80),MF=L
        $FS    SBA=(1,1),RA=(1,1,00),MF=L        SET BUFFER/CLEAR.
        $FS    SBA=(1,1),SF=(PROT),MF=L
        $FS    SBA=(1,25),SF=(PROT,INT),MF=L
        $FS    TEXT='P R O G R A M M E R    UPDATE',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(2,25),SF=(PROT,INT),MF=L
        $FS    TEXT='=============================',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(4,1),SF=(PROT),MF=L
        $FS    TEXT='Programmer state/action :',MF=L
        $FS    SF=(PROT,INT),TEXT='I',MF=L
        $FS    SF=(PROT),TEXT='= invalidate,',MF=L
        $FS    SF=(PROT,INT),TEXT='D',MF=L
        $FS    SF=(PROT),TEXT='= delete or',MF=L
        $FS    SF=(PROT,INT),TEXT='X',MF=L
        $FS    SF=(PROT),TEXT='to escape',MF=L
        $FS    SF=(PROT,INT),TEXT='===>',MF=L
        $FS    SF=(INT),MF=L
ASBFSI  $FS    SBA=(4,75),MF=L
SCRFSI  $FS    TEXT=' ',MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(6,9),SF=(PROT),TEXT='Programmer Number :',MF=L
        $FS    SF=(PROT,INT),MF=L
SCRFPG  $FS    TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(7,11),SF=(PROT),TEXT='Programmer Name :',MF=L
        $FS    SF=(INT),MF=L
ASBFNM  $FS    SBA=(7,30),MF=L
SCRFNM  $FS    TEXT=(' ',40),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(9,17),SF=(PROT),TEXT='Matricola :',MF=L
        $FS    SF=(INT),MF=L
ASBFMT  $FS    SBA=(9,30),MF=L
SCRFMT  $FS    TEXT=(' ',6),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(11,8),SF=(PROT),TEXT='Listing Box Number :',MF=L
        $FS    SF=(INT),MF=L
ASBFBX  $FS    SBA=(11,30),MF=L
SCRFBX  $FS    TEXT=(' ',3),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(13,11),SF=(PROT),TEXT='Building Number :',MF=L
        $FS    SF=(INT),MF=L
ASBFBN  $FS    SBA=(13,30),MF=L
SCRFBN  $FS    TEXT=(' ',6),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(15,14),SF=(PROT),TEXT='Phone Number :',MF=L
        $FS    SF=(INT),MF=L
ASBFTL  $FS    SBA=(15,30),MF=L
SCRFTL  $FS    TEXT=(' ',9),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(17,19),SF=(PROT),TEXT='Service :',MF=L
        $FS    SF=(INT),MF=L
ASBFSV  $FS    SBA=(17,30),MF=L
SCRFSV  $FS    TEXT=(' ',8),MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(19,1),SF=(PROT,INT),MF=L
MSG1    $FS    TEXT=(' ',37),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(19,41),SF=(PROT,INT),MF=L
MSG2    $FS    TEXT=(' ',37),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(20,1),SF=(PROT,INT),MF=L
ECRFNM  $FS    TEXT=(' ',78),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(22,1),SF=(PROT),MF=L
        $FS    TEXT='Type in needed data and hit',MF=L
        $FS    SF=(PROT,INT),TEXT='ENTER',MF=L
        $FS    SF=(PROT),TEXT='until they are correct, ',MF=L
        $FS    TEXT='then hit only',MF=L
        $FS    SF=(PROT,INT),TEXT='ENTER',MF=L
        $FS    SBA=(23,1),SF=(PROT),MF=L
        $FS    TEXT='to update the Programmer, ',MF=L
        $FS    TEXT='or use at any time',MF=L
        $FS    SF=(PROT,INT),TEXT='PF-3',MF=L
        $FS    SF=(PROT),TEXT='to exit (emergency)',MF=L
        $FS    SBA=(1,1),SF=(PT,IC),MF=L
LECRFN   EQU   *-ECRFN
         SPACE 1
ECRAD   $FS    CC=W,WCC=(KBR),SBA=(24,80),MF=L
        $FS    SBA=(1,1),RA=(1,1,00),MF=L        SET BUFFER/CLEAR.
        $FS    SBA=(1,1),SF=(PROT),MF=L
        $FS    SBA=(1,25),SF=(PROT,INT),MF=L
        $FS    TEXT='P R O G R A M M E R    DELETE',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(2,25),SF=(PROT,INT),MF=L
        $FS    TEXT='=============================',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(10,10),SF=(PROT),TEXT='Confirm',MF=L
        $FS    SF=(PROT,INT),TEXT='DELETE',MF=L
        $FS    SF=(PROT),TEXT='action on Programmer number :',MF=L
        $FS    SF=(PROT,INT),,MF=L
ECRADA  $FS    TEXT=(' ',4),MF=L
        $FS    SBA=(15,10),SF=(PROT),TEXT='Enter',MF=L
        $FS    SF=(PROT,INT),TEXT='Y',MF=L
        $FS    SF=(PROT),TEXT='or',MF=L
        $FS    SF=(PROT,INT),TEXT='N ===>',MF=L
        $FS    SF=(INT),TEXT=' ',MF=L
        $FS    SF=(PROT),TEXT='<',MF=L
        $FS    SBA=(16,10),SF=(PROT),TEXT='or you may Hit',MF=L
        $FS    SF=(PROT,INT),TEXT='ENTER',MF=L
        $FS    SF=(PROT),TEXT='to escape or',MF=L
        $FS    SF=(PROT,INT),TEXT='PF-3',MF=L
        $FS    SF=(PROT),TEXT='to exit (emergency)',MF=L
        $FS    SBA=(23,1),SF=(PROT,INT),MF=L
ECRADM  $FS    TEXT=(' ',78),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(1,1),SF=(PT,IC),MF=L
LECRAD   EQU   *-ECRAD
         SPACE 1
ECRUN   $FS    CC=W,WCC=(KBR,RMDT),SBA=(24,80),MF=L
        $FS    SBA=(1,1),RA=(1,1,00),MF=L        SET BUFFER/CLEAR.
        $FS    SBA=(1,1),SF=(PROT),MF=L
        $FS    SBA=(1,25),SF=(PROT,INT),MF=L
        $FS    TEXT='P R O G R A M M E R    ',MF=L
ECRUNT  $FS    TEXT=(' ',6),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(2,25),SF=(PROT,INT),MF=L
        $FS    TEXT='=============================',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(4,5),SF=(PROT),TEXT='Programmer number :',MF=L
        $FS    SF=(PROT,INT),MF=L
ECRUNP  $FS    TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(4,70),SF=(PROT,INT),MF=L
ECRUNC  $FS    TEXT=(' ',6),MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(7,5),SF=(PROT),TEXT='Programmer is now ',MF=L
ECRUNW  $FS    TEXT=(' ',50),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 01 -*
SX       EQU   *
        $FS    SBA=(9,5),SF=(PROT,INT),MF=L
AUT1    $FS    TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
DX       EQU   *-SX
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 02 -*
        $FS    SBA=(9,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 03 -*
        $FS    SBA=(9,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 04 -*
        $FS    SBA=(9,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 05 -*
        $FS    SBA=(10,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 06 -*
        $FS    SBA=(10,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 07 -*
        $FS    SBA=(10,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 08 -*
        $FS    SBA=(10,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 09 -*
        $FS    SBA=(11,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 10 -*
        $FS    SBA=(11,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 11 -*
        $FS    SBA=(11,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 12 -*
        $FS    SBA=(11,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 13 -*
        $FS    SBA=(12,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 14 -*
        $FS    SBA=(12,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 15 -*
        $FS    SBA=(12,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 16 -*
        $FS    SBA=(12,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 17 -*
        $FS    SBA=(13,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 18 -*
        $FS    SBA=(13,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 19 -*
        $FS    SBA=(13,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 20 -*
        $FS    SBA=(13,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 21 -*
        $FS    SBA=(14,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 22 -*
        $FS    SBA=(14,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 23 -*
        $FS    SBA=(14,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 24 -*
        $FS    SBA=(14,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 25 -*
        $FS    SBA=(15,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 26 -*
        $FS    SBA=(15,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 27 -*
        $FS    SBA=(15,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 28 -*
        $FS    SBA=(15,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 29 -*
        $FS    SBA=(16,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 30 -*
        $FS    SBA=(16,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 31 -*
        $FS    SBA=(16,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 32 -*
        $FS    SBA=(16,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 33 -*
        $FS    SBA=(17,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 34 -*
        $FS    SBA=(17,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 35 -*
        $FS    SBA=(17,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 36 -*
        $FS    SBA=(17,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 37 -*
        $FS    SBA=(18,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 38 -*
        $FS    SBA=(18,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 39 -*
        $FS    SBA=(18,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 40 -*
        $FS    SBA=(18,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 41 -*
        $FS    SBA=(19,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 42 -*
        $FS    SBA=(19,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 43 -*
        $FS    SBA=(19,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 44 -*
        $FS    SBA=(19,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 45 -*
        $FS    SBA=(20,5),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 46 -*
        $FS    SBA=(20,25),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 47 -*
        $FS    SBA=(20,45),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
*- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 48 -*
        $FS    SBA=(20,65),SF=(PROT,INT),TEXT=(' ',4),MF=L
        $FS    SF=(PROT),MF=L
NDL      EQU   (*-SX)/DX               NO. OF AUT. ON SCREEN DISPLAY
        $FS    SBA=(23,1),SF=(PROT),TEXT='Hit',MF=L
        $FS    SF=(PROT,INT),TEXT='ENTER',MF=L
        $FS    SF=(PROT),TEXT='to continue or',MF=L
        $FS    SF=(PROT,INT),TEXT='PF-3',MF=L
        $FS    SF=(PROT),TEXT='to exit (emergency)',MF=L
        $FS    SF=(INT),TEXT=' ',MF=L
        $FS    SF=(PROT),MF=L
        $FS    SBA=(1,1),SF=(PT,IC),MF=L
LECRUN   EQU   *-ECRUN
         EJECT
*--------------------------------------------------------------------*
*        LITERAL POOL                                                *
*--------------------------------------------------------------------*
         SPACE 1
        LTORG
         SPACE 1
*--------------------------------------------------------------------*
*        AUTHORIZATIONS NUMBERS VECTOR.                              *
*--------------------------------------------------------------------*
         SPACE 1
VECTI    DC    100XL3'0'
NVECT    EQU   (*-VECTI)/L'VECTI
         DC    XL3'0'                  END VECTOR MARKER
*------- BYTE 1 = FLAGS AS BELOW :
FLRESP   EQU   X'80'                   RESPONSIBLE PROGRAMMER
FLINVP   EQU   X'40'                   PROGRAMMER INVALIDATED
         EJECT
*--------------------------------------------------------------------*
*        UJVTABLE (IEFUJV) EXTENDED CONTROLS                         *
*--------------------------------------------------------------------*
         SPACE 1
         CNOP  0,8
         USING *,R15
EXTCTL   STM   R8,R9,SVEXT
         LR    R9,R15
         DROP  R15
         USING EXTCTL,R9
         LA    R8,2(R14)
         XR    R1,R1
         ICM   R1,B'0011',0(R14)
         B     0(R1,R9)
CHKINP   PACK  DSD,PGMCHAR
         CVB   R0,DSD
         XC    DSD,DSD
         STH   R0,DSD
        CALL   AUT33,(DSD+2,DSD,DSD+2),VL
         LTR   R15,R15
         BNZ   *+L'*+8
         LR    R14,R8                  ACCEPTED
         LM    R8,R9,SVEXT
         BR    R14
         CH    R15,=H'8'
         BE    CHKERR
         MVC   ECRFNM(33),=CL33'Programmer INVALIDATION rejected.'
         MVC   SCRFSI,INSI
         B     CHKMSG
CHKPBX   PACK  DSD,PGMCHAR
         CVB   R0,DSD
         PACK  DSD,INBX
         CVB   R1,DSD
         XC    DSD,DSD
         STH   R0,DSD
         STH   R1,DSD+2
        CALL   AUT33,(DSD+4,DSD,DSD+2),VL
         LTR   R15,R15
         BNZ   *+L'*+8
         LR    R14,R8                  ACCEPTED
         LM    R8,R9,SVEXT
         BR    R14
         CH    R15,=H'8'
         BE    CHKERR
         MVC   ECRFNM(27),=CL27'Box number CHANGE rejected.'
         MVC   SCRFBX,INBX
         B     CHKMSG
CHKDLP   PACK  DSD,PGMCHAR
         CVB   R0,DSD
         XC    DSD,DSD
         STH   R0,DSD
        CALL   AUT33,(DSD+2,DSD,DSD+2),VL
         LTR   R15,R15
         BNZ   *+L'*+8
         LR    R14,R8                  ACCEPTED
         LM    R8,R9,SVEXT
         BR    R14
         CH    R15,=H'8'
         BE    CHKERR
         MVC   ECRFNM(29),=CL29'Programmer DELETION rejected.'
         MVC   SCRFSI,INSI
CHKMSG   MVC   MSG1(34),=CL34'UJVTABLE (IEFUJV) control detected'
         MVC   MSG2(33),=CL33'* * * System HIGH-SENSITIVE * * *'
         B     DPLAY
CHKERR   LM    R2,R3,NCALL             SEVERE ERROR
         B     SCRAMBLE
         DROP  R9
         SPACE 1
*--------------------------------------------------------------------*
*        CONSTANTS AND WORK-AREAS                                    *
*--------------------------------------------------------------------*
         SPACE 1
SVEXT    DC    2F'0'
NCALL    DC    0F'0',CL8'AUT32'
         SPACE 1
*--------------------------------------------------------------------*
*        LITERAL POOL                                                *
*--------------------------------------------------------------------*
         SPACE 1
        LTORG
         EJECT
*--------------------------------------------------------------------*
*        DUMMY SECTIONS                                              *
*--------------------------------------------------------------------*
         SPACE 1
         PRINT GEN
        $AIRD  SEC=YES,R=NO
         SPACE 2
         END
