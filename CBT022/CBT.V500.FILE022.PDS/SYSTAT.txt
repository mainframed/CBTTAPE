SYSTAT TITLE 'SYSTEM STATUS - DISPLAY MVS/XA CONTROL BLOCK INFORMATION'
         MACRO
&NAME    MODE   &AMODE=31
.*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
.*                                                                   *
.*  SET ADDRESSING MODE.  EITHER 'MODE AMODE=31' OR 'MODE AMODE=24'  *
.*                                                                   *
.* NOTES: EXAMPLE - '    MODE AMODE=31  SET ADDRESSING MODE TO 31    *
.*                  ' -MORE CODE -                                   *
.*                  '    MODE AMODE=24  SET ADDRESSING MODE TO 24    *
.*                                                                   *
.*                                                                   *
.*                                                                   *
.*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
.*
         LCLC   &I
         GBLA   &B
&I       SETC   '&SYSNDX'
         AIF    (&AMODE EQ 31).MOD31
&NAME    LA     15,RMOD&I
         BSM    0,15
RMOD&I   DS     0H
         AGO    .MEND
.MOD31   ANOP
&NAME    L      15,AMOD&I
         BSM    0,15
AMOD&I   DC     A(CON&I+X'80000000')
CON&I    DS     0H
.MEND    MEND
         SPACE 3
         MACRO
         TESTOPEN &DCB
.*---------------------------------------------------------------*
.*  FUNCTION: SEE IF DCB WAS OPENED
.*    RETURN: RC IN R15  (RC=4 NO GOOD)
.*---------------------------------------------------------------*
         AIF ('&DCB' EQ '').ERR1
         LCLC  &I
&I       SETC  '&SYSNDX'
         TM    &DCB+48,B'00010000'
         BO    GOOD&I
         LA    15,4
         B     GOOD&I+4
GOOD&I   LA    15,0
         MEND
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
*             MODULE NAME = SYSTAT                                    *
*                                                                     *
*             DESCRIPTIVE NAME =  SYSTEM STATUS INFORMATION DISPLAY   *
*                ROUTINE TO EXAMINE AND DISPLAY SYSTEM CONTROL BLOCK  *
*                INFORMATION.                                         *
*                                                                     *
*             OPERATING ENVIRONMENT = MVS/XA 2.1 AND ABOVE            *
*                                                                     *
*             FUNCTION =                                              *
*                DISPLAY ADDRESSES AND AVAILABLE PRIVATE REGION       *
*                                                                     *
*             NOTES =  SOME                                           *
*                                                                     *
*              REGISTER USAGE:                                        *
*                                                                     *
*                          R1 ..... PASSING PARMS                     *
*                          R2 ..... ADDRESSING OF CVT PREFIX          *
*                          R3 ..... ADDRESSING OF CVT OS/VS2 EXTENSION*
*                          R4 ..... ADDRESSING OF CVT OS/VS1 AND      *
*                                   OS/VS2 EXTENSION                  *
*                    WORK5,R5 ..... WORK REG: VARIABLE                *
*                    WORK6,R6 ..... WORK REG: VARIABLE                *
*                    WORK7,R7 ..... WORK REG: VARIABLE                *
*                    WORK8,R8 ..... WORK REG: VARIABLE                *
*     BASE4                R9 ..... BASE+4096+4096+4096            MTW*
*     BASE3               R10 ..... BASE+4096+4096                 MTW*
*     BASE2               R11 ..... BASE+4096 REG                     *
*     BASE1               R12 ..... BASE REG                          *
*                         R13 ..... SAVE AREA AND BASE REG         MTW*
*                  BALREG,R14 ..... FOR BRANCHING                     *
*                         R15 ..... USUAL                             *
*                                                                     *
*             MACROS = IBM: CAMLST, DCB, LOCATE, OPEN, PUT, RDJFCB,MTW*
*                           STFSMODE, STLINENO, STTMPMD,  11/30/87 MTW*
*                           TGET, TPUT, VSMREGN           11/30/87 MTW*
*                    OTHER: MODE - SET AMODE              11/30/87 MTW*
*                           TESTOPEN - CHECK FOR OPEN DCB (SET RC)    *
*                                                                     *
*        SUBROUTINES = PRC: JULSUB BY BILL GODFREY FROM CBT TAPE      *
*                                                         11/30/87 MTW*
*             DSECTS = IBM: CVT, IEESMCA, IEFUCBOB                    *
*                                                                     *
*                    OTHER: CDS, EXITTAB, IEEMBACT,       11/30/87 MTW*
*                           IHAGDA, IRARMCT, RDS, SST, STGDSECT    MTW*
*                                                                     *
*             MODULE TYPE = PROCEDURE                                 *
*                                                                     *
*                PROCESSOR = ASMH                                     *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
  EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
*             ENTRY POINTS = SYSTAT   (ONLY ENTRY POINT)              *
*                                                                     *
*             INPUT = NONE                                            *
*                                                                     *
*             OUTPUT = EITHER TO DDNAME SYSOUT OR TPUT'S UNDER TMP    *
*                      (NOTE: SYSOUT IS OPENED AS A DSORG=PS FILE)    *
*                                                                     *
*             EXIT - NORMAL = AT PROGRAM END VIA BRANCH REGISTER 14   *
*                                                                     *
*             EXIT - ERROR = NONE                                     *
*                                                                     *
*             EXTERNAL REFERENCES = NONE                              *
*                                                                     *
*             TABLES = MANY ...                                       *
*                                                                     *
*             AUTHOR = MARK V. HEDGES                                 *
*                      ADRIA LABORATORIES  (new)                      *
*                      7001 POST ROAD                                 *
*                      DUBLIN OH. 43017                               *
*                      (614) 764-8175                                 *
*                                                                     *
*             MESSAGES = NONE                                         *
*                                                                     *
*             ABEND CODES = NONE - WE HOPE                            *
*                                                                     *
*                                                                     *
* NOTE1: EACH SUB-SECTION STORES THE 'BALREG' AS ITS FIRST INSTR.     *
*       AND AS ITS LAST IT LOADS IT. SO THE INTEGRITY OF THAT         *
*       REGISTER IS NEVER IN QUESTION.                                *
*                                                                     *
* NOTE2: ALL MODE-SETTING NECCESSARY TO ADDRESS EXTENDED STORAGE      *
*        IS PERFORMED IN THE SUB-SECTION.                             *
*                                                                     *
* -----------------------  CHANGE SECTION  ---------------------------*
*                                                                     *
* 11/30/87 MICHAEL WILCOX SUBSTITUTE THE JULSUB SUBROUTINE FOR $STCK. *
*          ADD DISPLAY OF IPL DAY-OF-WEEK AND ELAPSED TIME SINCE IPL. *
*          ADD DISPLAY OF NUMBER OF CPUS ONLINE.                      *
*          ADD DISPLAY OF SMFPRMnn DATA.                              *
*          ADD DISPLAY OF LINK LIST DATA SET NAMES.                   *
*          FIX SEVERAL BUGS IN APF DATA SET NAMES DISPLAY PROMPTING.  *
*          S0C4 IN CPU SERIAL NUMBER LOGIC.  ACCOMMODATE 8 PROCESSORS.*
*          CHANGE SYSRES UCB TESTS FROM "CLI" TO "TM" INSTRUCTIONS.   *
*          BIT TO TEST FOR A SHARED SYSRES IS "UCBRR", NOT "UCBRPS".  *
*          MAKE TPUT/TGET LOGIC CONFORM TO FULL SCREEN PROTOCOLS.     *
*          ENTIRELY REPLACE DISPLAY OF SYSTEM STORAGE AREA ADDRESSES. *
*                                                                     *
*          - MY THANKS TO MICHAEL                                 MVH *
*                                                                     *
* 01/28/88 SUBCHANNEL NUMBER FOR SYSRES CAUSES ABEND 0C7 WHEN         *
*          IT'S NOT NUMERIC, MAKES SENSE !!                       MVH*
*                                                                     *
* -----------------------  Things to do  -----------------------------*
*          Any abitious individuals who would like to rewite this     *
*              to make it re-enterent ??                              *
*          How about each routine as its own called subroutine ?      *
*                                                                     *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         EJECT  ,                                          11/30/87 MTW
SYSTAT   CSECT
         SAVE  (14,12),,SYSTAT_&SYSDATE._&SYSTIME._V2.0    11/30/87 MTW
         LR     R12,R15               * LOAD 1ST 4K        11/30/87 MTW
         USING  SYSTAT,R12,R11,R10,R9 * R12, R11, R10, AND R9 BASE REGS
         L      R11,BASE2             * LOAD 2ND 4K
         L      R10,BASE3             * LOAD 3RD 4K
         L      R9,BASE4              * LOAD 4TH 4K        11/30/87 MTW
         L      R15,BASE5             * POINT TO SAVE AREA 11/30/87 MTW
         ST     R15,8(,R13)           * FORWARD CHAIN      11/30/87 MTW
         ST     R13,4(,R15)           * BACKWARD CHAIN     11/30/87 MTW
         LR     R13,R15               * POINT TO SYSTAT SAVE AREA   MTW
         USING  SAVE,R13              * R13 GIVES 5TH 4K   11/30/87 MTW
         B      *+4+4+4+4+4           * SKIP EXT-ADDR.     11/30/87 MTW
BASE2    DC     A(SYSTAT+4096)
BASE3    DC     A(SYSTAT+4096+4096)
BASE4    DC     A(SYSTAT+4096+4096+4096)
BASE5    DC     A(SAVE)                                    11/30/87 MTW
         SPACE
BALREG   EQU    14                    * BAL RETURN REG
WORK5    EQU    5                     * WORK REG
WORK6    EQU    6                     * WORK REG EVEN
WORK7    EQU    7                     * WORK REG ODD
WORK8    EQU    8                     * WORK REG WHAT EVER
         SPACE
         SPLEVEL SET=2
         SPACE
         ST     R1,SAVE1              * SAVE PARM IF ANY
         BAL    BALREG,$GETDCB        * CHECK FOR ALLOCATIONS
         BAL    BALREG,$GETDATE       * RETREIVE DATE AND TIME INFO
         BAL    BALREG,$GETCVT        * ADDRESS ALL CVT AREAS
         BAL    BALREG,$GETSMF        * RETREIVE SMF INFO (IPL RELATED)
         BAL    BALREG,$GETRES        * INFO OF SYSRES VOLSER
         BAL    BALREG,$CVTINFO       * GET CVT CONTROL BLOCK INFO
         BAL    BALREG,$PCCAVT        * GET CPU SERIAL NUMBER
         BAL    BALREG,$VIRTADR       * OBTAIN PRIVATE STORAGE INFO
         BAL    BALREG,$SRMPARM       * SRM PARMS: OPT, ICS, IPS
         BAL    BALREG,$STORAGE       * GET STORAGE ADDRESSES
         BAL    BALREG,$CONADR        * CONVERT STORAGE ADDR TO EBCDIC
         BAL    BALREG,$STORMAP       * CREATE STORAGE MAP
         BAL    BALREG,$TERMPUT       * TERMINAL 'TPUTS'
         BAL    BALREG,$PUTSMF        * WRITE THE SMF SMCA TABLE    MTW
         BAL    BALREG,$GETLLT        * EXAMINE LINK LIST TABLE, LOAD
         BAL    BALREG,$PUTLLT        * AND WRITE THE DSN TABLE     MTW
         BAL    BALREG,$GETAPF        * EXAMINE THE APF TABLE, LOAD MTW
         BAL    BALREG,$PUTAPF        * AND WRITE THE DSN TABLE     MTW
         B      $FINISH               * THAT'S ALL FOLKS
         SPACE  3                                          11/30/87 MTW
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* READ JFCB FOR SYSOUT DATASET IF ALLOCATED                           *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$GETDCB  DS     0H
         ST     BALREG,SAVBAL         * SAVE BAL REG
         RDJFCB SYSOUT               * DDNAME ALLOCATED ?
         LTR    R15,R15              * TEST RESULTS
         BNZ    ENDDCB               * NOPE, DO TPUTS
         OPEN   (SYSOUT,OUTPUT)      * OPEN SYSOUT FILE
         TESTOPEN SYSOUT             * IS DDNAME THERE
         LTR    R15,R15              * TEST OPEN
         BNZ    ENDDCB               * NOPE, DO TPUTS
         MVI    OPENFLG,X'FF'        * GOOD OPEN, SET FLAG
ENDDCB   L      BALREG,SAVBAL        * LOAD BAL REG
         BR     BALREG               * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* GET CURRENT DATE AND TIME INFO. AND STORE IT.                       *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$GETDATE DS     0H
         ST     BALREG,SAVBAL         * SAVE BAL REG
         LA     R1,1                                       11/30/87 MTW
         ST     R1,JULPARM2           * INPUT FORMAT CODE  11/30/87 MTW
         XC     JULPARM1,JULPARM1     * INPUT DATE OF ZERO 11/30/87 MTW
         LA     R1,1+16+128+512                            11/30/87 MTW
         ST     R1,JULPARM4           * OUTPUT FORMAT CODE 11/30/87 MTW
         LA     R1,JULPTRS                                 11/30/87 MTW
         L      R15,=V(JULSUB)                             11/30/87 MTW
         BALR   R14,R15                                    11/30/87 MTW
         L      R1,JULPARM3           * LOAD JULIAN DATE   11/30/87 MTW
         CVD    R1,DWORD              * CONVERT IT AND ... 11/30/87 MTW
         ED     CURDATE,DWORD+5       *         EDIT IT    11/30/87 MTW
         MVC    CURTIME,JULPARM3+36   * CURRENT TIME OF DAY11/30/87 MTW
         MVC    CURWKDAY(9),JULPARM3+24         DAY OF WEEK11/30/87 MTW
         MVC    CURMDY,JULPARM3+4     *      MONTH DAY YEAR11/30/87 MTW
         L      BALREG,SAVBAL         * RELOAD BAL REG
         BR     BALREG                * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* SET ADDRESSABLITIY FOR ALL CVT DSECTS: OS/VS2 AND OS/VS1/VS2 EXTEN. *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$GETCVT  DS     0H
         ST     BALREG,SAVBAL         * SAVE BAL REG
         L      R2,CVTPTR             * GET CVT POINTER
         S      R2,=F'256'            * TO CVT PREFIX
         USING  CVTFIX,R2             * ADDRESS CVT PREFIX
         L      R3,CVTSMEXT           * LOAD STORAGE EXTENSION
         USING  CVTVSTGX,R3           * ADDRESS PATCH AREA
         L      R4,CVTEXT2            * CVT EXTENSION OS/VS1-OS/VS2
         USING  CVTXTNT2,R4           * ADDRESS IT
         L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* GET SMF IPL DATE+TIME, CREATE A TABLE OF SMCA DATA      11/30/87 MTW*
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$GETSMF  DS     0H
         ST     BALREG,SAVBAL         * SAVE BAL REG
         L      WORK5,CVTSMCA         * POINT TO SMF: 0 IF NOT THERE
         C      WORK5,=F'0'           * ANY ADDRESS?
         BE     NOSMF                 * NOPE, SMF NOT ACTIVE !
         USING  SMCABASE,WORK5        * SMF DSECT
         MVC    SYSID(4),SMCASID      * SYSTEM ID  +(16)
         MVC    MTIME(4),SMCAITME     * IPL TIME +(336) BINARY
         MVC    PDATE(4),SMCAIDTE     * IPL DATE +(340) 00YYDDDF
* SMF BUFFER INFO
         XR     WORK7,WORK7           * CLEAR WORK
         LH     WORK7,SMCAMNBF        * SMF MIN BUFFERS
         CVD    WORK7,DWORD           * CONVERT IT AND ...
         ED     SMFMBUF(6),DWORD+5    *         EDIT IT
         XR     WORK7,WORK7           * CLEAR WORK
         LH     WORK7,SMCAMXBF        * SMF MAX BUFFERS
         CVD    WORK7,DWORD           * CONVERT IT AND ...
         ED     SMFXBUF(6),DWORD+5    *         EDIT IT
         L      WORK7,SMCABFLS        * # RECORDS LOST DUE TO BUFF.LOW
         CVD    WORK7,DWORD           * CONVERT IT AND ...
         ED     SMFLOST(10),DWORD+3   *         EDIT IT
         L      WORK7,SMCABFWT        * # RECORDS WRITEN TO BUFFERS
         CVD    WORK7,DWORD           * CONVERT IT AND ...
         ED     SMFBUFD(10),DWORD+3   *         EDIT IT
* EDIT IPL DATE                                            11/30/87 MTW
         ED     IPLDATE(7),PDATE+1    * EDIT IPL DATE      11/30/87 MTW
         LA     R1,3                                       11/30/87 MTW
         ST     R1,JULPARM2           * INPUT FORMAT CODE  11/30/87 MTW
         MVC    JULPARM1,PDATE        * PACKED INPUT DATE  11/30/87 MTW
         LA     R1,16+128                                  11/30/87 MTW
         ST     R1,JULPARM4           * OUTPUT FORMAT CODE 11/30/87 MTW
         LA     R1,JULPTRS                                 11/30/87 MTW
         L      R15,=V(JULSUB)                             11/30/87 MTW
         BALR   R14,R15                                    11/30/87 MTW
         MVC    IPLWKDAY(9),JULPARM3+20   IPL DAY OF WEEK  11/30/87 MTW
         MVC    IPLMDY,JULPARM3       * IPL MONTH DAY YEAR 11/30/87 MTW
* EDIT IPL TIME
         L      WORK7,MTIME           * LOAD TIME
         XR     WORK6,WORK6           * CLEAR REG
         D      WORK6,=F'360000'      * DIVIDE
         CVD    WORK7,DWORD           * CONVERT
         OI     DWORD+7,X'0F'         * OR
         UNPK   IPLTIME(2),DWORD+6(2) * UNPACK             11/30/87 MTW
         LR     WORK7,WORK6           * AND AGAIN ...
         XR     WORK6,WORK6           *
         D      WORK6,=F'6000'        *
         CVD    WORK7,DWORD           *
         OI     DWORD+7,X'0F'         *
         UNPK   IPLTIME+3(2),DWORD+6(2)                    11/30/87 MTW
         LR     WORK7,WORK6           * AND AGAIN ...      11/30/87 MTW
         XR     WORK6,WORK6           *                    11/30/87 MTW
         D      WORK6,=F'100'         *                    11/30/87 MTW
         CVD    WORK7,DWORD           *                    11/30/87 MTW
         OI     DWORD+7,X'0F'         *                    11/30/87 MTW
         UNPK   IPLTIME+6(2),DWORD+6(2)                    11/30/87 MTW
* SMFPRM MEMBER NAME SUFFIX                                11/30/87 MTW
         L      WORK6,SMCAACTP        * POINT TO ACT
         USING  IEEMBACT,WORK6
         MVC    SMFPRM,ACTMEMID
         DROP   WORK6
* GETMAIN DYNAMIC STORAGE FOR THE TABLE OF SMCA DATA       11/30/87 MTW
SMFGMAIN LA     R0,100                * ROOM FOR 100 SMCA TABLE ENTRIES
         MH     R0,=H'60'             *     OF LENGTH 60
         ST     R0,GETSIZE            * SAVE SMCA TABLE SIZE
         GETMAIN R,LV=(0),RELATED=(SMFFMAIN)
         ST     R1,GETREG             * SAVE SMCA TABLE ADDRESS
* SID, JWT, MAXDORM AND STATUS                             11/30/87 MTW
         MVC    WKSMFSID,=C'SID(XXXX)'
         MVC    WKSID,SMCASID
         MVC    WKJWT,=C'JWT(HHMM)'
         MVC    WKJWT#,SMCASJWT
         MVC    WKMAXDRM,=C'MAXDORM(MMSS)'
         MVC    WKMAXDM#,SMCASMDM
         MVC    WKSTATUS,=C'STATUS(HHMMSS)'
         MVC    WKSTTUS#,SMCASSTS
         BAL    BALREG,SAVESMCA       * SAVE SMF WORK BUFFER IN TABLE
* SELECTIVITY TABLES                                       11/30/87 MTW
         L     WORK6,SMCASSTP           A(SELECTIVITY TABLES)
         USING SST,WORK6
         LH    WORK7,SMCANSST           NUMBER OF SELECTIVITY TABLES
SSTLOOP  DS    0H
         TM    SSTFLAGS,SSTACTIV        Q. THIS SST IN USE
         BZ    NEXTSST                  NO.
         MVC   WKNAME,SSTNAME           SYS/SUBSYS
         LA    WORK8,WKNAME+3
         CLI   0(WORK8),C' '
         BNE   *+4+2
         BCTR  WORK8,0
         MVI   1(WORK8),C':'
         LA    WORK8,3(,WORK8)
         TM    SSTFLAGS,SSTDETAL        Q. DETAILED ACCTNG
         BNZ   *+4+6+4                  YES.
         MVC   0(2,WORK8),=C'NO'        NO.
         LA    WORK8,2(,WORK8)
         MVC   0(6,WORK8),=C'DETAIL'
         LA    WORK8,7(,WORK8)
         MVC   0(10,WORK8),=C'NOINTERVAL'
         CLC   SSTINTVL+1(7),SSTINTVL   Q. ANY INTERVAL
         BE    NOINTVL                  NO.
         MVC   0(16,WORK8),=C'INTERVAL(HHMMSS)'
         LM    R0,R1,SSTINTVL
         SRDL  R0,12
         D     R0,=F'1E6'               R1=SECONDS
         SR    R0,R0
         D     R0,=A(60*60)             R1=HOURS
         CVD   R1,DWORD
         UNPK  9(2,WORK8),DWORD
         SRDL  R0,32
         D     R0,=A(60)                R1=MINUTES
         CVD   R1,DWORD
         UNPK  11(2,WORK8),DWORD
         CVD   R0,DWORD                 R0=SECONDS
         UNPK  13(2,WORK8),DWORD
         MVZ   10(5,WORK8),9(WORK8)
NOINTVL  DS    0H
         BAL   BALREG,SAVESMCA
         L     R15,SSTEXTAB             A(EXIT TABLES)
         USING EXITTAB,R15
         L     R14,EXITNMBR             NUM EXITS
         LTR   R14,R14                  Q. ANY EXITS
         BZ    NOEXITS                  NO.
         MVC   WKEXITS,=C'EXITS'        PRINT EXITS (SANS "IEF")
         LA    R15,EXITNTRY
         USING EXITNTRY,R15
         LA    R1,WKEXIT#               A(FIRST POS)
EXITLOOP DS    0H
         MVI   0(R1),C','
         MVC   1(5,R1),EXITNAME+3
         LA    R1,1(,R1)
         CLI   0(R1),C' '
         BNE   *-4-4
         LA    R15,16(,R15)
         BCT   R14,EXITLOOP
         MVI   WKEXIT#,C'('             ENCLOSE EXIT NAMES
         MVI   0(R1),C')'               "       "    "
         BAL   BALREG,SAVESMCA
NOEXITS  DS    0H
NEXTSST  DS    0H
         AH    WORK6,SMCALSST           A(NEXT SEL. TABLE)
         BCT   WORK7,SSTLOOP            NO.
         DROP  WORK6,R15
* SMF VSAM CLUSTER NAMES
         L     WORK6,SMCAFRDS           A(FIRST RECORDING D/S BLOCK)
         USING RDS,WORK6
         MVI   WKPRIM,C'P'              FIRST ONE IS PRIMARY
RDSLOOP  DS    0H
         MVC   WKSMFDSN,=C'-DSN(SYS1.MANX)'
         MVC   WKDSN,RDSNAME            SMF DSNAME
         MVC   WKSMFVOL,=C'VOL(XXXXXX)'
         MVC   WKVOL,RDSVOLID           SMF VOLSER
         MVC   WKBLOCKS,=C'BLKS(XXXXXXX)'
         L     R0,RDSCAPTY              CAPACITY (4096-BYTE BLKS)
         CVD   R0,DWORD
         OI    DWORD+7,X'0F'
         UNPK  WKBLKS,DWORD
         MVC   WKFULL,=C'FULL'
         L     R15,RDSNXTBL             NEXT BLOCK
         CR    R15,R0                   Q. FULL
         BZ    QACTVRDS                 YES.
         MVC   WKEMPTY,=C'EMPTY'
         S     R15,=F'1'                Q. EMPTY
         BZ    QACTVRDS
         LTR   R0,R0                    Q. CAPACITY IN RDS
         BZ    QACTVRDS                 NO. AVOID 0C9
         MVC   WKPERCNT,=X'4021204B206C'
         M     R14,=F'1E3'              SHIFT
         DR    R14,R0
         CVD   R15,DWORD
         ED    WKPERCNT(5),DWORD+6
QACTVRDS DS    0H
         C     WORK6,SMCASRBR           Q. ACTIVE D/S
         BNE   *+4+6                    NO.
         MVC   WKACTDSN,=C'ACTIVE'      YES.
         TM    RDSFLAG,RDSDUMP          Q. DUMP REQ'D
         BZ    *+4+6                    NO.
         MVC   WKDUMP,=C'DUMP REQ''D'   YES.
         BAL   BALREG,SAVESMCA
         L     WORK6,RDSNEXT            A(NEXT D/S BLOCK)
         TM    RDSFLAG2,RDSLOST         Q. LOST DATA RDS
         BNZ   ENDRDS                   YES. THAT'S ALL
         MVI   WKSECND,C'S'             NO. INDIC SECONDARY D/S
         B     RDSLOOP                  LOOP
         DROP   WORK5,WORK6                                11/30/87 MTW
ENDRDS   DS     0H                                         11/30/87 MTW
NOSMF    DS     0H                                         11/30/87 MTW
         L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN             11/30/87 MTW
         SPACE  1                                          11/30/87 MTW
* SUBROUTINE TO SAVE SMF WORK BUFFER IN AN SMCA TABLE ENTRY11/30/87 MTW
SAVESMCA DS     0H
         LH     R15,SMFCOUNT          * CURRENT SMCA TABLE ENTRY COUNT
         MH     R15,=H'60'            * POINT TO
         A      R15,GETREG            *     NEXT SMCA TABLE ENTRY
         MVC    0(60,R15),WORKBUF     * WORK BUFFER INTO SMCA TABLE
         LH     R15,SMFCOUNT          * BUMP SMCA TABLE
         LA     R15,1(,R15)           *     ENTRY COUNT
         STH    R15,SMFCOUNT          *         BY ONE
         MVC    WORKBUF,WORKBUF-1     * CLEAR WORK BUFFER
         C      R15,=F'100'           * END OF SMCA TABLE?
         BNL    NOSMF                 * YES, STOP COLLECTING SMCA DATA
         BR     BALREG                * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* GET INFORMATION FROM THE SYSRES VOLUME                              *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$GETRES  DS     0H
         ST     BALREG,SAVBAL         * STOR BAL REG
         L      WORK6,CVTSYSAD        * UCB ADDR FOR SYSRES
         LA     WORK7,UCBPRFX         * PREFIX UCB AREA
         SR     WORK6,WORK7           * MOVE BACK TO ADDRESS IT
         USING  UCB,WORK6             * ADDRESS UCB DSECT
         SPACE
* CHECK FOR UCB: ONLINE, DEVICE ALLOCATED, MOUNTED PERM, AND SYSRES
         SPACE
         TM     UCBSTAT,UCBONLI+UCBALOC+UCBPRES+UCBSYSR    11/30/87 MTW
         BO     *+12                                       11/30/87 MTW
         TM     UCBSTAT,UCBONLI+UCBPRES+UCBSYSR            11/30/87 MTW
         BNO    NSYSRES                                    11/30/87 MTW
         MVC    SYSRES(6),UCBVOLI     * VOLSER OF SYSRES
         MVC    UNITADR(3),UCBNAME    * UNIT ADDR
*        LA     WORK7,X'F0'           * SET SIGN NIBBLE    11/30/87 MTW
*        ICM    WORK7,B'0110',UCBSCHNO  LOAD SUBCHANNEL NUMBER      MTW
*        SRL    WORK7,4               * NOW WORK7='000N NNNF' PACKED!
*        ST     WORK7,#SUBCHAN        * STORE IT           11/30/87 MTW
*        ED     SUBCHAN,#SUBCHAN+1    * EDIT RESULTS       11/30/87 MTW
         LH     WORK7,UCBSCHNO        * LOAD SUBCHANNEL #  01/28/88 MVH
         CVD    WORK7,DWORD           * DECIMAL            01/28/88 MVH
         ED     SUBCHAN(6),DWORD+5    * EDIT IT            01/28/88 MVH
         MVC    PATHS(8),UCBCHPID     * PATHS
         LA     WORK7,X'F0'           * SET SIGN NIBBLE    11/30/87 MTW
         ICM    WORK7,B'0110',UCBCHAN * LOAD DEVICE NUMBER 11/30/87 MTW
         SRL    WORK7,4               * NOW WORK7='000N NNNF' PACKED!
         ST     WORK7,#DEVNO          * STORE IT           11/30/87 MTW
         ED     DEVNO,#DEVNO+1        * EDIT RESULTS       11/30/87 MTW
         TM     UCBMIHTI,UCBPGDEV     * PAGING DEVICE ??   11/30/87 MTW
         BNO    *+10                  * PAGING FLAG        11/30/87 MTW
         MVC    PAGEDEV(3),=C'YES'    * NOTIFY - THIS DEVICE: PAGING
         TM     UCBTBYT2,UCBRR        * SHARABLE ?         11/30/87 MTW
         BNO    *+10                  * PAGING FLAG        11/30/87 MTW
         MVC    SHARE(3),=C'YES'      * SHARABLE ?
         LA     R1,UCBVTOC            * TTR0 OF VTOC       11/30/87 MTW
         BAL    BALREG,HEXOUT         * CONVERT TTR0 TO EBCDIC      MTW
         MVC    TTR0(8),HEXWORK       * SAVE TTR0 IN EBCDIC11/30/87 MTW
         LH     WORK7,UCBUSER         * NUMBER OF USERS
         DROP   WORK6                 * DON'T NEED IT ANY MORE
         CVD    WORK7,DWORD           * CONVERT IT
         ED     USERS(6),DWORD+5      * EDIT RESULTS
* PATH DETERMINATION
         LA     WORK7,PATHS-1         * LOAD ADDRESS OF PATHS
         LA     WORK6,8               * MAX CHANNEL PATHS
         LA     WORK5,CHPIDS-4        * CHPID TABLE ADDR
PATHLOOP LA     WORK7,1(,WORK7)       * LOAD NEXT ADDR
         CLI    0(WORK7),X'FF'        * EMPTY CHPID ?
         BE     PATHDONE              * YEP, ALL DONE
         LA     WORK8,X'F0'           * SET SIGN NIBBLE    11/30/87 MTW
         ICM    WORK8,B'0010',0(WORK7)  LOAD CHANNEL PATH IDENTIFIERMTW
         SRL    WORK8,4               * NOW WORK8='0000 0NNF' PACKED!
         STH    WORK8,PPATHS          * STORE IT
         A      WORK5,=F'4'           * NEXT ADDR IN TABLE
         MVC    0(4,WORK5),EDITPATH   * MOVE EDIT
         ED     0(4,WORK5),PPATHS     * EDIT RESULTS
         BCT    WORK6,PATHLOOP        * LOOP UPTO 8 TIMES
PATHDONE DS     0H
*
         L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
*                                                          11/30/87 MTW
NSYSRES  MVC    SYSRES(6),=6C'?'      * STRANGE OCCURANCE
         MVC    UNITADR(3),=3C'?'     * NOTE IT
         L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* FROM 'CVT' - GET OS/PRODUCT INFORMATION - CVT PREFIX                *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$CVTINFO DS     0H
         ST     BALREG,SAVBAL         * STOR BAL REG
         SPACE
* PROCESS CVT PREFIX FOR STATUS INFO
         SPACE
         MVC    PRODLVL(16),CVTPROD   * PRODUCT LEVEL
         MVC    PRODNAM(8),CVTPRODN   * PRODUCT NAME
         MVC    PRODFMID(8),CVTPRODI  * FMID OF IPLED SYSTEM
         MVC    CPUMDL(2),CVTMDL      * MODEL NUMBER OF CPU IN
*                                     * NON-PACKED HEX: X'0145' SO ...
*                                     *  CPUMDL ID A DC CL2' ',X'F0'
*                                     *  - APPENDED A X'F0' MAKE SIGNED
         ED     CPUMODL(5),CPUMDL     * EDIT RESULTS
         MVC    #NUCID(1),CVTNUCLS    * NUC ID FOR IEANUC__
         MVC    RELNUM(4),CVTRELNO    * OS/VS RELEASE NUMBER
         SPACE
* CPU PHYSICAL ID
         SPACE
         LH     WORK6,CVTICPID        * CVT IPL'ED PHYSICAL ID SIGNED
         LTR    WORK6,WORK6
         BZ     NOPID
         ED     CPUPID(5),CVTICPID    * EDIT RESULTS
         B      *+10
NOPID    MVC    CPUPID(5),=C'UNKN '      * UNKNOWN
         SPACE
* CPU MAX PHYSICAL ADDRESS
         SPACE
         LH     WORK6,CVTMAXMP        * CVT MAX CPU PHYSICAL ADDR SGND
         LTR    WORK6,WORK6
         BZ     NOMAXMP
         ED     MAXMP(5),CVTMAXMP     * EDIT RESULTS
         B      *+10
NOMAXMP  MVC    MAXMP(5),=C'UNKN '    * UNKNOWN
         SPACE  1                                          11/30/87 MTW
* NUMBER OF CPUS ONLINE                                    11/30/87 MTW
         SPACE  1                                          11/30/87 MTW
         L      WORK7,CVTCSD          * POINT TO CSD       11/30/87 MTW
         USING  CSD,WORK7                                  11/30/87 MTW
         LH     WORK6,CSDCPUOL        * NUM OF CPUS ONLINE 11/30/87 MTW
         LTR    WORK6,WORK6                                11/30/87 MTW
         BZ     NOCPUOL                                    11/30/87 MTW
         ED     CPUONLIN(5),CSDCPUOL  * EDIT RESULTS       11/30/87 MTW
         B      *+10                                       11/30/87 MTW
NOCPUOL  MVC    CPUONLIN(5),=C'UNKN ' * UNKNOWN            11/30/87 MTW
         DROP   WORK7                                      11/30/87 MTW
         SPACE
* CHECK FOR CLPA
         SPACE
         CLI    CVTDIRST,CVTDICOM     * TEST FOR CLPA
         BNE    *+8                   * NOPE, CONTINUE
         MVI    CLPA,C'Y'             * SET CLPA FLAG
         L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN             11/30/87 MTW
         SPACE  3                                          11/30/87 MTW
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* FROM 'PCCAVT' - GET THE CPU ID NUMBER                               *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$PCCAVT  DS     0H
         ST     BALREG,SAVBAL         * STOR BAL REG
         L      WORK5,CVTPCCAT        * PCCAVT (+2FC)      11/30/87 MTW
         ICM    WORK6,15,0(WORK5)     * UNIPROCESSOR ONLY!!11/30/87 MTW
         BNZ    MCPUINFO              * MOVE CPU INFO
         ICM    WORK6,15,4(WORK5)     * TRY CPU 1          11/30/87 MTW
         BNZ    MCPUINFO              * MOVE CPU INFO
         ICM    WORK6,15,8(WORK5)     * TRY CPU 2          11/30/87 MTW
         BNZ    MCPUINFO              * MOVE CPU INFO
         ICM    WORK6,15,12(WORK5)    * TRY CPU 3 (3084)   11/30/87 MTW
         BNZ    MCPUINFO              * MOVE CPU INFO
         ICM    WORK6,15,16(WORK5)    * TRY CPU 4 (3090)   11/30/87 MTW
         BNZ    MCPUINFO              * MOVE CPU INFO      11/30/87 MTW
         ICM    WORK6,15,20(WORK5)    * TRY CPU 5 (3090)   11/30/87 MTW
         BNZ    MCPUINFO              * MOVE CPU INFO      11/30/87 MTW
         ICM    WORK6,15,24(WORK5)    * TRY CPU 6 (FUTURE) 11/30/87 MTW
         BNZ    MCPUINFO              * MOVE CPU INFO      11/30/87 MTW
         ICM    WORK6,15,28(WORK5)    * TRY CPU 7 (FUTURE) 11/30/87 MTW
         BNZ    MCPUINFO              * MOVE CPU INFO      11/30/87 MTW
         B      *+10                  * SKIP IT
MCPUINFO MVC    SERIAL(6),6(WORK6)    * PCCACPID SERIAL # (6)
         L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
*
         EJECT
$VIRTADR DS     0H
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                   *
*       DETERMINE VIRTUAL AND REAL STORAGE AMOUNTS      11/30/87 MTW*
*                                                                   *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
         ST     BALREG,SAVBAL         * STOR BAL REG
         MODE   AMODE=31
         VSMREGN WKAREA=REGN      OBTAIN PRIVATE REGION INFORMATION
         MODE   AMODE=24
*                                                          11/30/87 MTW
         MVC    #DAPVT,ADDRBL     THE GDA IS MISSING THIS ADDRESS   MTW
*                                                          11/30/87 MTW
*                                 FORMAT THE INFORMATION INTO DECIMAL
*                                                          11/30/87 MTW
         LA    R1,PARMLST1        PARAMETER LIST FOR CONVERT ROUTINE
         BAL   WORK6,CONVCVD      CONVERT SIZE OF PRIVATE AREA IN BYTES
*                                    BELOW 16M AND PLACE IN OUTPUT AREA
         LA    R1,PARMLST2        PARAMETER LIST FOR CONVERT ROUTINE
         BAL   WORK6,CONVCVD      CONVERT SIZE OF PRIVATE AREA IN BYTES
*                                    ABOVE 16M AND PLACE IN OUTPUT AREA
         L     WORK7,LENBL        LOAD SIZE OF PRIVATE AREA BELOW 16M
         SRL   WORK7,10           DIVIDE BY 1024 = 1K      11/30/87 MTW
         ST    WORK7,KREG24       SAVE PRIVATE AREA SIZE IN K BELOW 16M
         LA    R1,PARMLST3        PARAMETER LIST FOR CONVERT ROUTINE
         BAL   WORK6,CONVCVD      CONVERT SIZE OF PRIVATE AREA IN K
*                                    BELOW 16M AND PLACE IN OUTPUT AREA
         L     WORK7,KREG24       LOAD SIZE OF PRIVATE AREA IN K BELOW
         SRL   WORK7,10           DIVIDE BY 1024 = 1MEG    11/30/87 MTW
         ST    WORK7,MREG24       SAVE PRIVATE AREA SIZE IN MEGS BELOW
         LA    R1,PARMLST4        PARAMETER LIST FOR CONVERT ROUTINE
         BAL   WORK6,CONVCVD      CONVERT SIZE OF PRIVATE AREA IN MEGS
*                                    BELOW 16M AND PLACE IN OUTPUT AREA
         L     WORK7,LENAB        LOAD SIZE OF PRIVATE AREA ABOVE 16M
         SRL   WORK7,10           DIVIDE BY 1024 = 1K      11/30/87 MTW
         ST    WORK7,KREG31       SAVE PRIVATE AREA SIZE IN K ABOVE 16M
         LA    R1,PARMLST5        PARAMETER LIST FOR CONVERT ROUTINE
         BAL   WORK6,CONVCVD      CONVERT SIZE OF PRIVATE AREA IN K
*                                    ABOVE 16M AND PLACE IN OUTPUT AREA
         L     WORK7,KREG31       LOAD SIZE OF PRIVATE AREA IN K ABOVE
         SRL   WORK7,10           DIVIDE BY 1024 = 1MEG    11/30/87 MTW
         ST    WORK7,MREG31       SAVE PRIVATE AREA SIZE IN MEGS ABOVE
         LA    R1,PARMLST6        PARAMETER LIST FOR CONVERT ROUTINE
         BAL   WORK6,CONVCVD      CONVERT SIZE OF PRIVATE AREA IN MEGS
*                                    ABOVE 16M AND PLACE IN OUTPUT AREA
         L     WORK7,CVTRLSTG     REAL STORAGE SIZE IN K   11/30/87 MTW
         SLL   WORK7,10           MULTIPLY BY 1024 = BYTES 11/30/87 MTW
         ST    WORK7,#VTRLSTB     SAVE REAL STORAGE SIZE IN BYTES   MTW
         LA    R1,PARMLST7        PARAMETER LIST FOR CONVERT ROUTINEMTW
         BAL   WORK6,CONVCVD      CONVERT SIZE OF REAL STORAGE IN BYTES
*                                                          11/30/87 MTW
         L     WORK7,CVTRLSTG     REAL STORAGE SIZE IN K   11/30/87 MTW
         ST    WORK7,#VTRLSTK     SAVE REAL STORAGE SIZE IN K       MTW
         LA    R1,PARMLST8        PARAMETER LIST FOR CONVERT ROUTINEMTW
         BAL   WORK6,CONVCVD      CONVERT SIZE OF REAL STORAGE IN K MTW
*                                                          11/30/87 MTW
         L     WORK7,CVTRLSTG     REAL STORAGE SIZE IN K   11/30/87 MTW
         SRL   WORK7,10           DIVIDE BY 1024 = 1MEG    11/30/87 MTW
         ST    WORK7,#VTRLSTM     SAVE REAL STORAGE SIZE IN MEGS    MTW
         LA    R1,PARMLST9        PARAMETER LIST FOR CONVERT ROUTINEMTW
         BAL   WORK6,CONVCVD      CONVERT SIZE OF REAL STORAGE IN MEGS
*                                                          11/30/87 MTW
         L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* FROM 'RMCT' - GET THE IPS, OPT, AND ICS MEMBER NAME SUFFIXES 11/30/87
*             - CALCULATE ELAPSED TIME SINCE LAST IPL OR SET IPS    MTW
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$SRMPARM DS     0H
         ST     BALREG,SAVBAL         * STOR BAL REG
         MODE   AMODE=31              * GO INTO EXTENDED MODE
GETINFO  L      WORK7,CVTOPCTP        * POINT TO RMCT      11/30/87 MTW
         USING  RMCT,WORK7                                 11/30/87 MTW
         L      WORK6,RMCTICST        * INSTALL. CONTROL SPEC. TABLE
         MVC    ICSMSG(2),0(WORK6)    * MOVE IEAICS SUFFIX
         L      WORK6,RMCTWMST        * WLM SPECIFICATION TABLE
         MVC    IPSMSG(2),WMSTID(WORK6) MOVE IEAIPS SUFFIX
         L      WORK6,RMCTRMPT        * SRM PARAMETER TABLE
         MVC    OPTMSG(2),RMPTOPTN(WORK6) * MOVE IEAOPT SUFFIX
* CALC TIME FROM IPL  (OR SET IPS)                         11/30/87 MTW
         L      R14,CVTASVT           * ASVT
         USING  ASVT,R14
         L      R15,ASVTFRST+4        * MASTER SCHEDULER ASCB (I HOPE)
         USING  ASCB,R15
         L      R1,ASCBOUCB           * MASTER SCHEDULER OUCB
         USING  OUCB,R1
         L      R0,RMCTTOD            * CURRENT TOD
         S      R0,OUCBTMO            * GET DELTA = (TIME SINCE IPL)
         DROP   WORK7,R14,R15,R1
         SRDL   R0,32                 * CONVERT TO
         D      R0,=F'1024'           *            SECONDS.
         SR     R0,R0                 * IGNORE REMAINDER.
         A      R1,=F'1800'           * ROUND
         D      R0,=F'3600'           * DIVIDE TO GET HOURS.
         CVD    R1,DWORD              * CONVERT HOURS -
         ED     ELAPSED,DWORD+6       * CONVERT TO PRINTABLE EBCDIC.
         MODE   AMODE=24              * GO BACK
         L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* FROM 'CVT' AND 'GDA' - OBTAIN SYSTEM STORAGE AREA DATA  11/30/87 MTW*
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$STORAGE DS     0H
         ST     BALREG,SAVBAL           * STOR BAL REG
         MODE AMODE=31                  * GO INTO EXTENDED MODE
*
*              EXTRACT ADDRESSES FROM THE CVT WITH SPECIAL SIGNIFICANCE
*
         L     WORK7,CVTASVT
         ST    WORK7,#ASVT
         L     WORK7,CVTJESCT
         ST    WORK7,#JESCT
*        L     WORK7,CVTLLTRM                              11/30/87 MTW
*        ST    WORK7,#LLA                                  11/30/87 MTW
         L     WORK7,CVTUSER
         ST    WORK7,#USR
         L     WORK7,CVTRSV40
         SLL   WORK7,8                * KILL RESERVED BITS
         SRL   WORK7,8                * KEEP ADDRESS
         ST    WORK7,#APF
         L     WORK7,CVTVPSA
         ST    WORK7,#PSA
         L     WORK7,CVTRMFPT
         ST    WORK7,#RMF
*        L     WORK7,CVTAUTHL                              11/30/87 MTW
*        ST    WORK7,#APF1                                 11/30/87 MTW
         L     WORK7,CVTAPFT
         ST    WORK7,#APF2
         L     WORK7,CVTRAC
         ST    WORK7,#RAC
         L     WORK7,CVTHSM
         ST    WORK7,#HSM
         L     WORK7,CVTVFCB
         ST    WORK7,#VIRT
         L     WORK7,CVTGVT
         ST    WORK7,#GRS
         L     WORK7,CVTATCVT
         L     WORK7,0(R7)         INDIRECT ADDRESS        11/30/87 MTW
         ST    WORK7,#ATCVT
         L     WORK7,CVTDOFFS                              11/30/87 MTW
         ST    WORK7,#VTDOFFS                              11/30/87 MTW
*
*              EXTRACT STORAGE AREA DATA FROM THE CVT AND GDA
*
         LA    WORK5,STGLINE       POINT TO OUTPUT LINE
         L     WORK6,CVTGDA        POINT TO GDA.
         USING GDA,WORK6           TELL ASSEMBLER.
         LA    WORK7,STGTABLE      POINT TO STORAGE TABLE ENTRY.
         USING STGDSECT,WORK7      TELL ASSEMBLER.
STGLOOP  DS    0H
         L     R15,STGRES          POINT TO DATA RESOLUTION ROUTINE.
         BALR  BALREG,R15          FILL-IN TABLE ENTRY.
         LA    R1,STGSTART         POINT TO AREA START ADDRESS.
         TM    0(R1),X'80'         BUT IS AREA MISSING?
         BO    STGNEXT             B IF AREA IS INDEED MISSING.
         BAL   BALREG,HEXOUT       CONVERT TO CHARACTER HEX.
         MVC   17(8,WORK5),HEXWORK MOVE START ADDRESS IN CHARACTER HEX.
         LA    R1,STGEND           POINT TO AREA END ADDRESS.
         BAL   BALREG,HEXOUT       CONVERT TO CHARACTER HEX.
         MVC   27(8,WORK5),HEXWORK MOVE END ADDRESS IN CHARACTER HEX.
         L     R1,STGSIZE          LOAD AREA SIZE FROM TABLE.
         SRL   R1,10               "DIVIDE" BY 1K = 1024 BYTES
         CVD   R1,DWORD            DECIMALIZE IT.
         MVC   37(10,WORK5),=X'40206B2020206B202120'  MOVE EDIT PATTERN
         ED    37(10,WORK5),DWORD+4  EDIT LENGTH.
         ICM   R1,15,STGFULL       LOAD AREA BYTES USED.
         BZ    STGNEXT             B IF ZERO.
         MH    R1,=H'100'          MULTIPLY BYTES BY 100.
         L     R15,STGSIZE         LOAD DIVISOR.
         SR    R0,R0               ZERO HIGH ORDER DIVIDEND.
         DR    R0,R15              GENERATE PERCENT USED.
         SRL   R15,1               "DIVIDE" DIVISOR BY 2.
         CR    R0,R15              SHALL I ROUND?
         BL    STGPCT              B IF NOT.
         LA    R1,1(,R1)           ROUND PERCENTAGE.
STGPCT   CVD   R1,DWORD            DECIMALIZE PERCENT.
         UNPK  DWORD(3),DWORD+6(2) UNPACK PERCENT.
         MVC   49(2,WORK5),DWORD+1 MOVE PERCENT.
         OI    50(WORK5),X'F0'     FIX SIGN.
         MVI   51(WORK5),C'%'      INSERT PERCENT SIGN
STGNEXT  DS    0H
         LA    WORK7,STGLEN(,WORK7)    NEXT STORAGE TABLE ENTRY.
         CLI   STGDSECT,X'FF'      END OF TABLE?
         BE    STGEXIT             B IF YES.
STGBUMP  DS    0H
         LA    WORK5,$TPUTLEN(,WORK5)  NEXT OUTPUT LINE.
         CLI   0(WORK5),C' '       TOP-OF-PAGE OR HEADER LINE?
         BE    STGBUMP             YES, DO NOT USE IT FOR OUTPUT
         B     STGLOOP             LOOP.
         SPACE 3                                           11/30/87 MTW
STGEXIT  DS    0H                                          11/30/87 MTW
         MODE AMODE=24
         L     BALREG,SAVBAL         * LOAD BAL REG
         BR    BALREG                * RETURN
         EJECT ,                                           11/30/87 MTW
*
*              DATA RESOLUTION ROUTINES
*
NOPRES   BR    BALREG              NOOP RESOLUTION ROUTINE.
PRES     L     R1,GDAPVTSZ         LOAD PRIVATE SIZE.
         BCTR  R1,*-*              GENERATE TRUE END ADDRESS.
         ST    R1,STGEND           SAVE IN TABLE.
         S     R1,STGSTART         GENERATE ...
         LA    R1,1(,R1)           ... TRUE LENGTH.
         ST    R1,STGSIZE          SAVE IN TABLE.
         BR    BALREG              RETURN.
EPRES    L     R1,GDAEPVT          LOAD START OF E-PRIVATE.
         ST    R1,STGSTART         SAVE IN TABLE.
         L     R0,GDAEPVTS         LOAD LENGTH OF E-PRIVATE
         ST    R0,STGSIZE          SAVE IN TABLE.
         AR    R1,R0               GENERATE ...
         BCTR  R1,*-*              ... E-PRIVATE END ADDRESS.
         ST    R1,STGEND           SAVE END ADDRESS IN TABLE.
         BR    BALREG              RETURN.
CRES     L     R1,GDACSA           LOAD START OF CSA.
         ST    R1,STGSTART         SAVE IN TABLE.
         L     R0,GDACSASZ         LOAD LENGTH OF CSA.
         ST    R0,STGSIZE          SAVE IN TABLE.
         AR    R1,R0               GENERATE ...
         BCTR  R1,*-*              ... CSA END ADDRESS.
         ST    R1,STGEND           SAVE IN TABLE.
         S     R0,GDACSARE         GENERATE BYTES USED.
         ST    R0,STGFULL          SAVE IN TABLE.
         BR    BALREG              RETURN.
ECRES    L     R1,GDAECSA          LOAD START OF E-CSA.
         ST    R1,STGSTART         SAVE IN TABLE.
         L     R0,GDAECSAS         LOAD LENGTH OF E-CSA.
         ST    R0,STGSIZE          SAVE IN TABLE.
         AR    R1,R0               GENERATE ...
         BCTR  R1,*-*              ... E-CSA END ADDRESS.
         ST    R1,STGEND           SAVE IN TABLE.
         BR    BALREG              RETURN.
SRES     L     R1,GDASQA           LOAD START OF SQA.
         ST    R1,STGSTART         SAVE IN TABLE.
         L     R0,GDASQASZ         LOAD LENGTH OF SQA.
         ST    R0,STGSIZE          SAVE IN TABLE.
         AR    R1,R0               GENERATE ...
         BCTR  R1,*-*              ... SQA END ADDRESS.
         ST    R1,STGEND           SAVE IN TABLE.
         BR    BALREG              RETURN.
ESRES    L     R1,GDAESQA          LOAD START OF E-SQA.
         ST    R1,STGSTART         SAVE IN TABLE.
         L     R0,GDAESQAS         LOAD LENGTH OF E-SQA.
         ST    R0,STGSIZE          SAVE IN TABLE.
         AR    R1,R0               GENERATE ...
         BCTR  R1,*-*              ... E-SQA END ADDRESS.
         ST    R1,STGEND           SAVE IN TABLE.
         BR    BALREG              RETURN.
NRORES   L     R0,CVTRONS          LOAD START OF NUC R/O AREA.
         ST    R0,STGSTART         SAVE IN TABLE.
         L     R1,STGEND           LOAD X'00FFFFFF'.
         SR    R1,R0               GENERATE ...
         LA    R1,1(,R1)           ... LENGTH.
         ST    R1,STGSIZE          SAVE IT IN TABLE.
         BR    BALREG              RETURN.
ENRORES  L     R0,STGSTART         LOAD X'01000000'.
         L     R1,CVTRONE          LOAD END OF NUC R/O AREA.
         O     R1,=A(X'00000FFF')  FORCE ALIGNMENT TO END OF PAGE.
         ST    R1,STGEND           SAVE IN TABLE.
         SR    R1,R0               GENERATE ...
         LA    R1,1(,R1)           ... LENGTH.
         ST    R1,STGSIZE          SAVE IN TABLE.
         BR    BALREG              RETURN.
VRRES    L     R1,GDAVR            LOAD START OF V=R AREA.
         ST    R1,STGSTART         SAVE IN TABLE.
         L     R0,GDAVRSZ          LOAD LENGTH OF V=R AREA.
         ST    R0,STGSIZE          SAVE LENGTH IN TABLE.
         AR    R1,R0               GENERATE ...
         BCTR  R1,*-*              ... V=R END ADDRESS.
         ST    R1,STGEND           SAVE IN TABLE.
         BR    BALREG              RETURN.
         SPACE 1
***********************************************************************
*                                                                     *
*    THE FOLLOWING IS A GENERAL DATA RESOLUTION ROUTINE FOR           *
*        STARTING-ENDING ADDRESS PAIRS IN THE MVS/XA VIRTUAL STORAGE  *
*        MAP EXTENSION.  THE TABLE CONTAINS THE ABSOLUTE DISPLACEMENT *
*        IN THE CVT EXTENSION TO THE STARTING ADDRESS RATHER THAN     *
*        THE STARTING ADDRESS ITSELF; THE ENDING ADDRESS IS           *
*        PRESUMED TO FOLLOW IN THE CVT EXTENSION.                     *
*                                                                     *
***********************************************************************
         SPACE 1
CXRES    L     R1,CVTSMEXT         POINT TO CVT STORAGE MAP EXTENSION.
         A     R1,STGSTART         POINT TO THE STARTING ADDRESS.
         ICM   R0,15,4(R1)         LOAD ENDING ADDRESS.
         BNP   CXNA                B IF THIS AREA IS STGMISS.
         L     R1,0(,R1)           LOAD STARTING ADDRESS.
         ST    R1,STGSTART         SAVE IT IN TABLE.
         O     R0,=A(X'00000FFF')  FORCE END OF PAGE ALIGNMENT TO ...
*                                  ... ACCOUNT FOR WASTE AT CHANGE ...
*                                  ... OF PROTECTION BOUNDARIES.
         ST    R0,STGEND           SAVE ENDING ADDRESS IN TABLE.
         SR    R0,R1               GENERATE ...
         LR    R1,R0
         LA    R1,1(,R1)           LENGTH.
         ST    R1,STGSIZE          SAVE IN TABLE.
         BR    BALREG              RETURN.
CXNA     LNR   R1,R1               MAKE R1 NEGATIVE.
         ST    R1,STGSTART         SAVE IN TABLE START POSITION.
         BR    BALREG              RETURN.
*
         DROP  WORK6,WORK7
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* ------------ CONVERT ALL ADDRESSES TO EBCDIC                        *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$CONADR  DS    0H
         ST    BALREG,SAVBAL         * STOR BAL REG
         LA    WORK6,PARM-8          * LOAD 1ST PARMETER LIST
         LA    WORK7,PARMLEN         * LENGTH OF PARM LIST
PARMLOOP LA    WORK6,8(,WORK6)       * LOAD NEXT PARM INTO WORK6
         LR    R1,WORK6              * PUT IT IN R1
         BAL   WORK8,CONVADR         * CONVERT IT
         BCT   WORK7,PARMLOOP        * CONTINUE UNTIL TRU
         L     BALREG,SAVBAL         * LOAD BAL REG
         BR    BALREG                * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* CREATE STORAGE MAP USING 'CVT' OFFSETS                              *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$STORMAP DS    0H
         ST    BALREG,SAVBAL         * LOAD BAL REG
         MVC    MEPRIV(8),ADDR31
         MVC    MPRIV(8),ADDR24
         MVC    MLEN24(12),KREG24A+7
         MVI    MLEN24+13,C'K'
         MVC    MLEN31(12),KREG31A+7
         MVI    MLEN31+13,C'K'
         L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
*  WRITE SCREENS                                                      *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$TERMPUT DS     0H
         ST     BALREG,SAVBAL
         CLI    OPENFLG,X'FF'        * DDNAME ALLOCATED ?
         BNE    TPUTS                * NOPE, DO TPUTS
         LA     WORK6,ENDTPUT           * LENGTH OF TPUT AREAS
         LA     WORK7,OUTSTOR-$TPUTLEN  * START OF TPUT LINES
PUTLOOP  LA     WORK7,$TPUTLEN(,WORK7)  * POINT TO NEXT LINE
         MVI    OUTREC-1,C' '        * TOP OF PAGE
         CLC    0($TPUTLEN,WORK7),=80C' '
         BNE    *+8
         MVI    OUTREC-1,C'1'        * TOP OF PAGE
         MVC    OUTREC($TPUTLEN),0(R7)
         PUT    SYSOUT,OUTREC-1      * PUT RECORD
         BCT    WORK6,PUTLOOP        * DO FOR 'ENDTPUT' TIMES
         L      BALREG,SAVBAL
         BR     BALREG               * FINE ....
         SPACE
TPUTS    LA     WORK6,ENDTPUT        * LENGTH OF TPUT AREAS
         LA     WORK7,OUTSTOR-$TPUTLEN * START OF TPUT LINES
         XR     WORK8,WORK8          * LINES PER PAGE
         STTMPMD  ON                 * TAKE OVER SCREEN CONTROL     MTW
         STFSMODE ON,INITIAL=YES     * START FULLSCR MODE  11/30/87 MTW
         LTR    R15,R15              * TCAM?               11/30/87 MTW
         BZ     TPUTVTAM             * NOPE, GOT TO BE VTAM11/30/87 MTW
         TPUT   CLEAR,CLEARLEN,FULLSCR,WAIT,HOLD * CLEAR THE SCREEN MTW
TPUTVTAM STLINENO LINE=1,MODE=OFF    * SET POINTER TO LINE ONE      MTW
TPUTLOOP LA     WORK7,$TPUTLEN(,WORK7)     * POINT TO NEXT
         CLC    0($TPUTLEN,WORK7),=80C' '
         BE     PUTENTER             * YEP, CLEAR AND RESET
         A      WORK8,=F'1'          * ADD ONE TO LINE COUNT
         C      WORK8,=F'22'         * IS LINE COUNT > 26
         BL     PUTIT                * NOPE, CONTINUE
*                                    * ISSUE 'HIT ENTER MESSAGE'
PUTENTER MVI    HENTER,C' '          * DUMMY LINE
         TPUT   HENTER,1             * DUMMY LINE
         TPUT   HITENTER,L'HITENTER,ASIS
         TGET   HENTER,1             * GET 1 CHAR
         CLI    HENTER,X'40'         * GREATER THAN ' '
         BNE    GOHOME
         STFSMODE ON                 * RESUME FULLSCR MODE 11/30/87 MTW
         LTR    R15,R15              * TCAM?               11/30/87 MTW
         BZ     PUTVTAM              * NOPE, GOT TO BE VTAM11/30/87 MTW
         TPUT   CLEAR,CLEARLEN,FULLSCR,WAIT,HOLD * CLEAR THE SCREEN MTW
PUTVTAM  STLINENO LINE=1,MODE=OFF    * SET POINTER TO LINE ONE      MTW
         XR     WORK8,WORK8          * REINIT LINE COUNTER
         A      WORK8,=F'1'          * ADD ONE
PUTIT    TPUT   (7),$TPUTLEN         * WRITE TO TERMINAL
         BCT    WORK6,TPUTLOOP
GOHOME   L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* PUT SMFPRMnn PARMLIB INFORMATION FROM THE SMCA TABLE    11/30/87 MTW*
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$PUTSMF  DS     0H
         ST     BALREG,SAVBAL         * LOAD BAL REG
         CLI    OPENFLG,X'FF'         * DDNAME ALLOCATED ?
         BNE    SMFTPUTS              * NOPE, DO TPUTS
         LH     WORK6,SMFCOUNT        * NUMBER OF ENTRIES IN SMCA TABLE
         L      WORK7,GETREG          * ADDRESS OF SMCA TABLE
         S      WORK7,=F'60'          * START OF DATA AREA
         MVI    OUTREC-1,C'1'
         MVC    OUTREC($TPUTLEN),=80C' '
         PUT    SYSOUT,OUTREC-1
         MVI    OUTREC-1,C' '
         MVC    OUTREC($TPUTLEN),SMFMSG0
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),SMFMSG1
         PUT    SYSOUT,OUTREC-1
PUTSMFL  LA     WORK7,60(,WORK7)     * POINT TO NEXT LINE
         MVC    OUTREC(60),0(WORK7)
         PUT    SYSOUT,OUTREC-1      * PUT RECORD
         BCT    WORK6,PUTSMFL        * DO FOR 'SMFCOUNT' TIMES
         B      SMFFMAIN             * ALL DONE
*
SMFTPUTS DS     0H
*
* "HENTER" IS FROM THE PREVIOUS SECTION
*           IF IT IS NON-BLANK SKIP EVERYTHING
*
         CLI    HENTER,X'40'          * GREATER THAN ' '
         BNE    SMFFMAIN              * YES, FREE THE SMCA TABLE
         L      WORK7,GETREG          * ADDR OF SMCA TABLE
         LH     WORK6,SMFCOUNT        * NUMBER OF ENTRIES IN SMCA TABLE
         S      WORK7,=F'60'          * NEXT ENTRY
$SMFHDR  DS     0H
         STFSMODE ON                 * RESUME FULLSCR MODE 11/30/87 MTW
         LTR    R15,R15              * TCAM?               11/30/87 MTW
         BZ     SMFVTAM              * NOPE, GOT TO BE VTAM11/30/87 MTW
         TPUT   CLEAR,CLEARLEN,FULLSCR,WAIT,HOLD * CLEAR THE SCREEN MTW
SMFVTAM  STLINENO LINE=1,MODE=OFF    * SET POINTER TO LINE ONE      MTW
         TPUT   SMFMSG0,$TPUTLEN      * SMF HEADER
         TPUT   SMFMSG1,$TPUTLEN      * SMF HEADER
         LA     WORK5,2               * TWO HEADER LINES
TPUTSMFL A      WORK7,=F'60'          * NEXT ENTRY
         TPUT   (7),60                *
         C      WORK6,=F'1'           * LAST SMCA TABLE ENTRY?
         BNH    SMFENTER              * YES, PROMPT FOR AN ENTER
         A      WORK5,=F'1'           *
         C      WORK5,=F'19'          * LINES PER PAGE
         BNH    NOSMFHDR              *
SMFENTER DS     0H
         MVI    HENTER,C' '
         TPUT   HENTER,1              * DUMMY LINE
         TPUT   HITENTER,L'HITENTER,ASIS
         TGET   HENTER,1              * GET 1 CHAR
         CLI    HENTER,X'40'          * GREATER THAN ' '
         BNE    SMFFMAIN
         BCT    WORK6,$SMFHDR         * DO FOR 'SMFCOUNT' TIMES
         B      SMFFMAIN
         SPACE  1
NOSMFHDR DS     0H
         BCT    WORK6,TPUTSMFL        * DO FOR 'SMFCOUNT' TIMES
SMFFMAIN L      R0,GETSIZE
         FREEMAIN R,LV=(0),A=GETREG,RELATED=(SMFGMAIN)
$ENDSMFP L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* LOAD "CVTLLTA" ADDRESS AND CREATE A LINK LIST DATA SET NAMES TABLE  *
*                                                         11/30/87 MTW*
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$GETLLT  DS     0H
         ST     BALREG,SAVBAL         * LOAD BAL REG
         CLI    OPENFLG,X'FF'         * DDNAME ALLOCATED ?
         BE     LLTGMAIN              * YES, NO ENTER CHECK
*
* "HENTER" IS FROM THE PREVIOUS SECTION
*           IF IT IS NON-BLANK SKIP EVERYTHING
*
         CLI    HENTER,X'40'          * GREATER THAN ' '
         BNE    $ENDLLT
LLTGMAIN DS     0H
         L      WORK6,CVTLLTA         * POINT TO LINK LIST TABLE
         L      WORK7,4(,WORK6)       * NUM. OF LINK LIST TABLE ENTRIES
         STH    WORK7,DSNCOUNT        * SAVE AS # DSN TABLE ENTRIES
         LR     R0,WORK7              * COMPUTE SIZE OF THE
         MH     R0,=H'60'             * ENTIRE DSN TABLE
         ST     R0,GETSIZE            * SAVE DSN TABLE SIZE
         GETMAIN R,LV=(0),RELATED=(LLTFMAIN)
         ST     R1,GETREG             * SAVE DSN TABLE ADDRESS
         A      WORK6,=F'8'           * POINT TO 1ST LLT TABLE ENTRY
         LR     WORK5,R1              * POINT TO 1ST DSN TABLE ENTRY
         S      WORK5,=F'60'          * BACK UP ONE DSN TABLE ENTRY
LLTLOOP1 A      WORK5,=F'60'          * NEXT DSN TABLE ENTRY
         XC     0(60,WORK5),0(WORK5)  * CLEAR TO ZEROS
         XR     WORK8,WORK8           * CLEAR WORK
         IC     WORK8,0(,R6)          * LENGTH OF LLT ENTRY UNSIG/UNPCK
         A      WORK6,=F'1'           * BUMP PAST LENGTH BYTE
         S      WORK8,=F'1'           * FOR EXEC INSTR.
         MVC    0(*-*,WORK5),0(WORK6) * MOVE DATA SET NAME
         EX     WORK8,*-6             * DO IT...
         MVC    DSNAME(44),=44C' '    * CLEAR DSNAME
         MVC    DSNAME(*-*),0(WORK5)  * SAVE DSNAME
         EX     WORK8,*-6             * DO IT...
         TR     0(47,WORK5),TRANSL    * TRANSLATE '.' FOR X'00'
         MVI    TRANSL,C' '           * NOW @ X'00' C' '
         TR     47(13,WORK5),TRANSL
         MVI    TRANSL,C'.'           * NOW @ X'00' C'.'
         A      WORK8,=F'1'           * RELOAD GOOD LENGTH
         A      WORK6,=F'44'          * NEXT LLT TABLE ENTRY
         SPACE  1
         LOCATE FINDSN                * IS IT CATALOGED
         LTR    R15,R15               * TEST IT
         BNZ    LLTNOCAT              * NOPE, SAY SO
         MVI    51(WORK5),C'Y'        * YEP, SAY SO
         MVC    53(6,WORK5),DSNVOL    * SAVE VOL CATALOGED ON
         B      *+8                   *
LLTNOCAT MVI    51(WORK5),C'N'        *
         BCT    WORK7,LLTLOOP1        * DO IT
         SPACE  1
         LH     WORK7,DSNCOUNT        * NUMBER OF ENTRIES IN DSN TABLE
         L      WORK5,GETREG          * ADDRESS OF DSN TABLE
         S      WORK5,=F'60'          * BACK UP ONE DSN TABLE ENTRY
LLTLOOP2 A      WORK5,=F'60'          * NEXT DSN TABLE ENTRY
         TM     0(R6),X'80'           * IS THE LLT ENTRY APF AUTHORIZED
         BZ     LLTNOAPF              * NOPE, SAY SO
         MVI    48(WORK5),C'Y'        * YEP, SAY SO
         B      *+8                   *
LLTNOAPF MVI    48(WORK5),C'N'        *
         A      WORK6,=F'1'           * NEXT LLT APF ENTRY
         BCT    WORK7,LLTLOOP2        * DO IT
         SPACE  1
$ENDLLT  L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
         SPACE  3
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* PUT INFORMATION FROM THE LINK LIST DATA SET NAMES TABLE 11/30/87 MTW*
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$PUTLLT  DS     0H
         ST     BALREG,SAVBAL         * LOAD BAL REG
         CLI    OPENFLG,X'FF'         * DDNAME ALLOCATED ?
         BNE    LLTTPUTS              * NOPE, DO TPUTS
         LH     WORK6,DSNCOUNT        * NUMBER OF ENTRIES IN DSN TABLE
         L      WORK7,GETREG          * ADDRESS OF DSN TABLE
         S      WORK7,=F'60'          * START OF DATA AREA
         MVI    OUTREC-1,C'1'
         MVC    OUTREC($TPUTLEN),=80C' '
         PUT    SYSOUT,OUTREC-1
         MVI    OUTREC-1,C' '
         MVC    OUTREC($TPUTLEN),LLTMSG0
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),LLTMSG2
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),LLTMSG4
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),LLTMSG5
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),LLTMSG6
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),LLTMSG7
         PUT    SYSOUT,OUTREC-1
PUTLLTL  LA     WORK7,60(,WORK7)  * POINT TO NEXT LINE
         MVC    OUTREC(60),0(WORK7)
         PUT    SYSOUT,OUTREC-1      * PUT RECORD
         BCT    WORK6,PUTLLTL        * DO FOR 'DSNCOUNT' TIMES
         B      LLTFMAIN             * ALL DONE
*
LLTTPUTS DS     0H
*
* "HENTER" IS FROM THE PREVIOUS SECTION
*           IF IT IS NON-BLANK SKIP EVERYTHING
*
         CLI    HENTER,X'40'          * GREATER THAN ' '
         BNE    $ENDLLTP
         L      WORK7,GETREG          * ADDR OF DSN TABLE
         LH     WORK6,DSNCOUNT        * NUMBER OF ENTRIES IN DSN TABLE
         CVD    WORK6,DWORD           * CONVERT TO DECIMAL
         ED     LLTENTS(4),DWORD+6    * EDIT RESULTS
         S      WORK7,=F'60'          * NEXT ENTRY
$LLTHDR  DS     0H
         STFSMODE ON                 * RESUME FULLSCR MODE 11/30/87 MTW
         LTR    R15,R15              * TCAM?               11/30/87 MTW
         BZ     LLTVTAM              * NOPE, GOT TO BE VTAM11/30/87 MTW
         TPUT   CLEAR,CLEARLEN,FULLSCR,WAIT,HOLD * CLEAR THE SCREEN MTW
LLTVTAM  STLINENO LINE=1,MODE=OFF    * SET POINTER TO LINE ONE      MTW
         TPUT   LLTMSG0,$TPUTLEN      * LLT HEADER
         TPUT   LLTMSG1,$TPUTLEN      * LLT HEADER
         LA     WORK5,6               * SIX HEADER LINES
         CH     WORK6,DSNCOUNT        * FIRST TIME THROUGH?
         BL     $LLTSKIP              * NO, SKIP MSG2
         LA     WORK5,7               * SEVEN HEADER LINES
         TPUT   LLTMSG2,$TPUTLEN      * LLT HEADER
$LLTSKIP DS     0H
         TPUT   LLTMSG4,$TPUTLEN      * LLT HEADER
         TPUT   LLTMSG5,$TPUTLEN      * LLT HEADER
         TPUT   LLTMSG6,$TPUTLEN      * LLT HEADER
         TPUT   LLTMSG7,$TPUTLEN      * LLT HEADER
TPUTLLTL A      WORK7,=F'60'          * NEXT ENTRY
         TPUT   (7),60                *
         C      WORK6,=F'1'           * LAST DSN TABLE ENTRY?
         BNH    LLTENTER              * YES, PROMPT FOR AN ENTER
         A      WORK5,=F'1'           *
         C      WORK5,=F'19'          * LINES PER PAGE
         BNH    NOLLTHDR              *
LLTENTER DS     0H
         MVI    HENTER,C' '
         TPUT   HENTER,1              * DUMMY LINE
         TPUT   HITENTER,L'HITENTER,ASIS
         TGET   HENTER,1              * GET 1 CHAR
         CLI    HENTER,X'40'          * GREATER THAN ' '
         BNE    LLTFMAIN
         BCT    WORK6,$LLTHDR         * DO FOR 'DSNCOUNT' TIMES
         B      LLTFMAIN
         SPACE  1
NOLLTHDR DS     0H
         BCT    WORK6,TPUTLLTL        * DO FOR 'DSNCOUNT' TIMES
LLTFMAIN L      R0,GETSIZE
         FREEMAIN R,LV=(0),A=GETREG,RELATED=(LLTGMAIN)
$ENDLLTP L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
         EJECT
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* LOAD "CVTAUTHL" ADDRESS AND CREATE A TABLE OF ALL APF DATA SET NAMES*
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$GETAPF  DS     0H
         ST     BALREG,SAVBAL         * LOAD BAL REG       11/30/87 MTW
         CLI    OPENFLG,X'FF'         * DDNAME ALLOCATED ? 11/30/87 MTW
         BE     APFGMAIN              * YES, NO ENTER CHECK11/30/87 MTW
*
* "HENTER" IS FROM THE PREVIOUS SECTION
*           IF IT IS NON-BLANK SKIP EVERYTHING
*
         CLI    HENTER,X'40'          * GREATER THAN ' '
         BNE    $ENDAPF
APFGMAIN DS     0H                                         11/30/87 MTW
         L      WORK6,CVTAUTHL        * POINT TO APF TABLE 11/30/87 MTW
         LH     WORK7,0(,WORK6)       * # APF TABLE ENTRIES11/30/87 MTW
         STH    WORK7,DSNCOUNT        * SAVE AS # DSN TABLE ENTRIES MTW
         LR     R0,WORK7              * COMPUTE SIZE OF    11/30/87 MTW
         MH     R0,=H'60'             * ENTIRE DSN TABLE   11/30/87 MTW
         ST     R0,GETSIZE            * SAVE DSN TABLE SIZE11/30/87 MTW
         GETMAIN R,LV=(0),RELATED=(APFFMAIN)               11/30/87 MTW
         ST     R1,GETREG             * SAVE DSN TABLE ADDR11/30/87 MTW
         A      WORK6,=F'2'           * POINT TO 1ST APF TABLE ENTRYMTW
         LR     WORK5,R1              * POINT TO 1ST DSN TABLE ENTRYMTW
         S      WORK5,=F'60'          * BACK UP ONE DSN TABLE ENTRY MTW
APFLOOP  A      WORK5,=F'60'          * NEXT DSN TABLE ENTRY        MTW
         XC     0(60,WORK5),0(WORK5)  * CLEAR TO ZEROS     11/30/87 MTW
         XR     WORK8,WORK8           * CLEAR WORK         11/30/87 MTW
         IC     WORK8,0(,R6)          * LENGTH OF APF ENTRY UNSIG/UNPCK
         A      WORK6,=F'1'           * BUMP PAST LENGTH BYTE       MTW
         S      WORK8,=F'7'           * FOR EXEC INSTR.
         MVC    0(*-*,WORK5),6(WORK6) * MOVE DSN: 6 PAST VOLSER
         EX     WORK8,*-6             * DO IT...
         MVC    DSNAME(44),=44C' '    * CLEAR DSNAME
         MVC    DSNAME(*-*),0(WORK5)  * SAVE DSNAME
         EX     WORK8,*-6             * DO IT...
         TR     0(45,WORK5),TRANSL    * TRANSLATE '.' FOR X'00'     MTW
         MVI    TRANSL,C' '          * NOW @ X'00' C' '
         TR     45(15,WORK5),TRANSL
         MVI    TRANSL,C'.'          * NOW @ X'00' C'.'
         A      WORK8,=F'7'           * RELOAD GOOD LENGTH
         MVC    44(6,WORK5),0(WORK6)  * LOAD VOLSER
         AR     WORK6,WORK8           * NEXT APF TABLE ENTRY
         SPACE  1                                          11/30/87 MTW
         LOCATE FINDSN                * IS IT CATALOGED
         LTR    R15,R15               * TEST IT
         BNZ    APFNOCAT              * NOPE, SAY SO       11/30/87 MTW
         MVI    51(WORK5),C'Y'        * YEP, SAY SO
         MVC    53(6,WORK5),DSNVOL    * SAVE VOL CATALOGED ON
         B      *+8                   *
APFNOCAT MVI    51(WORK5),C'N'                             11/30/87 MTW
         BCT    WORK7,APFLOOP         * DO IT
         SPACE  1                                          11/30/87 MTW
$ENDAPF  L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
         SPACE  3                                          11/30/87 MTW
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* PUT INFORMATION FROM THE APF TABLE                                  *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$PUTAPF  DS     0H
         ST     BALREG,SAVBAL         * LOAD BAL REG
         CLI    OPENFLG,X'FF'        * DDNAME ALLOCATED ?
         BNE    APFTPUTS              * NOPE, DO TPUTS
         LH     WORK6,DSNCOUNT        * NUMBER OF ENTRIES IN DSN TABLE
         L      WORK7,GETREG          * ADDRESS OF DSN TABLE
         S      WORK7,=F'60'          * START OF DATA AREA
         MVI    OUTREC-1,C'1'
         MVC    OUTREC($TPUTLEN),=80C' '
         PUT    SYSOUT,OUTREC-1
         MVI    OUTREC-1,C' '
         MVC    OUTREC($TPUTLEN),APFMSG0
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),APFMSG2
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),APFMSG3
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),APFMSG4
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),APFMSG5
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),APFMSG6
         PUT    SYSOUT,OUTREC-1
         MVC    OUTREC($TPUTLEN),APFMSG7
         PUT    SYSOUT,OUTREC-1
PUTAPFL  LA     WORK7,60(,WORK7)  * POINT TO NEXT LINE
         MVC    OUTREC(60),0(WORK7)
         PUT    SYSOUT,OUTREC-1      * PUT RECORD
         BCT    WORK6,PUTAPFL        * DO FOR 'DSNCOUNT' TIMES
         B      APFFMAIN             * ALL DONE            11/30/87 MTW
*
APFTPUTS DS     0H                                         11/30/87 MTW
*                                                          11/30/87 MTW
* "HENTER" IS FROM THE PREVIOUS SECTION                    11/30/87 MTW
*           IF IT IS NON-BLANK SKIP EVERYTHING             11/30/87 MTW
*                                                          11/30/87 MTW
         CLI    HENTER,X'40'          * GREATER THAN ' '   11/30/87 MTW
         BNE    $ENDAPFP                                   11/30/87 MTW
         L      WORK7,GETREG          * ADDR DSN TABLE     11/30/87 MTW
         LH     WORK6,DSNCOUNT        * NUMBER OF ENTRIES IN DSN TABLE
         CVD    WORK6,DWORD           * CONVERT TO DECIMAL
         ED     APFENTS(4),DWORD+6    * EDIT RESULTS       11/30/87 MTW
         S      WORK7,=F'60'          * NEXT ENTRY
$APFHDR  DS     0H                                         11/30/87 MTW
         STFSMODE ON                 * RESUME FULLSCR MODE 11/30/87 MTW
         LTR    R15,R15              * TCAM?               11/30/87 MTW
         BZ     APFVTAM              * NOPE, GOT TO BE VTAM11/30/87 MTW
         TPUT   CLEAR,CLEARLEN,FULLSCR,WAIT,HOLD * CLEAR THE SCREEN MTW
APFVTAM  STLINENO LINE=1,MODE=OFF    * SET POINTER TO LINE ONE      MTW
         TPUT   APFMSG0,$TPUTLEN      * APF HEADER
         TPUT   APFMSG1,$TPUTLEN      * APF HEADER
         LA     WORK5,6               * SIX HEADER LINES   11/30/87 MTW
         CH     WORK6,DSNCOUNT        * FIRST TIME THROUGH?11/30/87 MTW
         BL     $APFSKIP              * NO, SKIP MSG2 & 3  11/30/87 MTW
         LA     WORK5,8               * EIGHT HEADER LINES 11/30/87 MTW
         TPUT   APFMSG2,$TPUTLEN      * APF HEADER
         TPUT   APFMSG3,$TPUTLEN      * APF HEADER
$APFSKIP DS     0H                                         11/30/87 MTW
         TPUT   APFMSG4,$TPUTLEN      * APF HEADER
         TPUT   APFMSG5,$TPUTLEN      * APF HEADER
         TPUT   APFMSG6,$TPUTLEN      * APF HEADER
         TPUT   APFMSG7,$TPUTLEN      * APF HEADER
TPUTAPFL A      WORK7,=F'60'          * NEXT ENTRY         11/30/87 MTW
         TPUT   (7),60                *
         C      WORK6,=F'1'           * LAST DSN TABLE ENTRY?       MTW
         BNH    APFENTER              * YES, PROMPT FOR AN ENTER    MTW
         A      WORK5,=F'1'           *
         C      WORK5,=F'19'          * LINES PER PAGE
         BNH    NOAPFHDR              *                    11/30/87 MTW
APFENTER DS     0H                                         11/30/87 MTW
         MVI    HENTER,C' '                                11/30/87 MTW
         TPUT   HENTER,1              * DUMMY LINE         11/30/87 MTW
         TPUT   HITENTER,L'HITENTER,ASIS                   11/30/87 MTW
         TGET   HENTER,1              * GET 1 CHAR         11/30/87 MTW
         CLI    HENTER,X'40'          * GREATER THAN ' '   11/30/87 MTW
         BNE    APFFMAIN                                   11/30/87 MTW
         BCT    WORK6,$APFHDR         * DO FOR 'DSNCOUNT' TIMES     MTW
         B      APFFMAIN                                   11/30/87 MTW
         SPACE  1                                          11/30/87 MTW
NOAPFHDR DS     0H                                         11/30/87 MTW
         BCT    WORK6,TPUTAPFL        * DO FOR 'DSNCOUNT' TIMES     MTW
APFFMAIN L      R0,GETSIZE                                 11/30/87 MTW
         FREEMAIN R,LV=(0),A=GETREG,RELATED=(APFGMAIN)     11/30/87 MTW
$ENDAPFP L      BALREG,SAVBAL         * LOAD BAL REG
         BR     BALREG                * RETURN
         SPACE  3                                          11/30/87 MTW
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*                                                                     *
* THAT'S ALL FOLKS                                                    *
*                                                                     *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$FINISH  CLI    OPENFLG,X'FF'        * DDNAME ALLOCATED ?
         BNE    NOCLOSE              * NOPE, CONTINUE      11/30/87 MTW
         CLOSE  (SYSOUT)             * YEP, CLOSE FILE
         B      CLEAR15                                    11/30/87 MTW
NOCLOSE  DS     0H                                         11/30/87 MTW
         STFSMODE ON                 * RESUME FULLSCR MODE 11/30/87 MTW
         LTR    R15,R15              * TCAM?               11/30/87 MTW
         BZ     FINIVTAM             * NOPE, GOT TO BE VTAM11/30/87 MTW
         TPUT   CLEAR,CLEARLEN,FULLSCR,WAIT,HOLD * CLEAR THE SCREEN MTW
FINIVTAM STLINENO LINE=1,MODE=OFF    * SET POINTER TO LINE ONE      MTW
         STFSMODE OFF                * EXIT FULLSCR MODE   11/30/87 MTW
         STTMPMD  OFF                * RELEASE SCREEN CONTROL       MTW
CLEAR15  DS     0H                                         11/30/87 MTW
         SR     R15,R15              *  ZERO RETURN REGISTER
         DROP   R2,R3,R4
         L      R13,SAVE+4           * RESTORE OLD SAVE AREA ADDR.
         L      R14,12(R13)          * RETURN ADDRESS
         LM     R0,R12,20(R13)       * REST OF THE REGS
         BR     R14                  * RETURN
 TITLE '--> CONVADR: CONVERT  XL8  TO  CL8 - EBCDIC'
*------------------- CONVERT ADDRESS TO EBCDIC ----------------------*
CONVADR  DS     0H                                                   *
*                                                                    *
*   SUBROUTINE TO CONVERT A HEXIDECIMAL NUMBER TO CHARACTER FORMAT   *
*   AND PLACE RESULT IN THE AREA SPECIFIED BY THE SECOND PARAMETER.  *
*                                                                    *
*          EXAMPLE  LA    1,PARMLIST                                 *
*                   BAL   R8,CONVADR                                 *
*                   .....                                            *
*          PARMLIST DC    A(VALUE)                                   *
*                   DC    A(RETRUN)                                  *
*          VALUE    DC    F'0'                                       *
*          RETURN   DC   CL8' '                                      *
*                                                                    *
*--------------------------------------------------------------------*
         SPACE 1                                           11/30/87 MTW
         LR    R0,R1               * SAVE PARMLIST ADDRESS
         L     R1,0(,R1)           * ADDRESS OF VALUE TO BE CONVERTED
         BAL   BALREG,HEXOUT       * CALL CONVERSION ROUTINE
         LR    R1,R0               * RESTORE PARMLIST ADDRESS
         L     R1,4(,R1)           * ADDRESS WHERE OUTPUT
         MVC   0(8,R1),HEXWORK             IS TO BE PLACED
         LR    R1,R0               * RESTORE PARMLIST ADDRESS
*
         BR    WORK8              RETURN TO CALLER
*-------------------- END OF CONVADR ROUTINE ------------------------*
         SPACE 3                                           11/30/87 MTW
*----------------- CONVERT HEXIDECIMAL TO EBCDIC --------------------*
HEXOUT   DS    0H                                                    *
*                                                                    *
*        SUBROUTINE TO GENERATE CHARACTER CODED HEXADECIMAL          *
*        FOR OUTPUT.  R1 POINTS TO THE FULLWORD TO BE TRANSLATED.    *
*        FIND OUTPUT CHARACTER RESULT IN DOUBLEWORD "HEXWORK."       *
*                                                                    *
*--------------------------------------------------------------------*
         SPACE 1
         MVC   HEXWORK(4),0(R1)    MAKE A WORK COPY OF THE INPUT VALUE
         UNPK  HEXWORK(9),HEXWORK(5)   TRANSLATE
         TR    HEXWORK,HEXTRTBL-X'F0'      TO EBCDIC
         BR    BALREG              RETURN TO CALLER.
         SPACE 1
HEXWORK  DS    D                   HEXOUT RESULT
         DS    X                   HEXOUT WORK AREA
HEXTRTBL DC    C'0123456789ABCDEF' TRANSLATE TO PRINTABLE HEX.
*-------------------- END OF HEXOUT ROUTINE -------------------------*
 TITLE '--> CONVCVD: CONVERT  DECIMAL  TO  CL19  EBCDIC NUMERIC '
*---------------------------------------------------------------------*
CONVCVD  DS    0H                                                     *
*                                                                     *
*        SUBROUTINE TO CONVERT A HEXIDECIMAL NUMBER TO DECIMAL        *
*        AND PLACE THE RESULT IN THE AREA SPECIFIED BY THE            *
*        SECOND PARAMETER.                                            *
*                                                                     *
*---------------------------------------------------------------------*
         STM   R14,R12,12(R13)    * SAVE CALLERS REGISTERS
         L     R2,0(,R1)          * ADDRESS OF VALUE TO BE CONVERTED
         L     R2,0(,R2)          * VALUE TO BE CONVERTED
         L     R3,4(,R1)          * ADDRESS WHERE OUTPUT IS TO BE
         CVD   R2,DWORD           * CONVERT TO DECIMAL
         MVC   TEMPAREA,EDITMASK  * MOVE MASK TO TEMPORARY AREA
         ED    TEMPAREA,DWORD     * EDIT TO INSERT COMMAS AND REMOVE
*                                 * LEADING ZEROS
         MVC   0(L'TEMPAREA,R3),TEMPAREA  * MOVE TO OUTPUT AREA
         LM    R14,R12,12(R13)    * RESTORE CALLERS REGISTERS
         BR    WORK6              * RETURN TO CALLER
EDITMASK DC    X'402020202020206B2020206B2020206B202020' EDIT MASK
TEMPAREA DC    CL19' '            TEMPORARY AREA FOR EDIT OF VALUE
*------- END OF CONVCVD ----------------------------------------------*
 TITLE '--> SYSTEM STORAGE DISPLAY DATA AREAS'             11/30/87 MTW
*                                                          11/30/87 MTW
*              ADDRESS CONVERSION ROUTINE PARAMETER LISTS  11/30/87 MTW
*                                                          11/30/87 MTW
*                 SEND       RECEIVE
*                ADDRESS     ADDRESS
PARM     EQU   *
         DC    A(ADDRAB),A(ADDR31)                         11/30/87 MTW
         DC    A(#DAECSA),A(MECSA)                         11/30/87 MTW
         DC    A(#VTEMLPS),A(MEMLPA)                       11/30/87 MTW
         DC    A(#VTEFLPS),A(MEFLPA)                       11/30/87 MTW
         DC    A(#VTEPLPS),A(MEPLPA)                       11/30/87 MTW
         DC    A(#DAESQA),A(MESQA)                         11/30/87 MTW
         DC    A(#VTERWNS),A(MERWNUC)                      11/30/87 MTW
         DC    A(#VTERONS),A(MERONUC)                      11/30/87 MTW
         DC    A(#VTRONS),A(MRONUC)                        11/30/87 MTW
         DC    A(#VTRWNS),A(MRWNUC)                        11/30/87 MTW
         DC    A(#DASQA),A(MSQA)                           11/30/87 MTW
         DC    A(#VTPLPAS),A(MPLPA)                        11/30/87 MTW
         DC    A(#VTFLPAS),A(MFLPA)                        11/30/87 MTW
         DC    A(#VTMLPAS),A(MMLPA)                        11/30/87 MTW
         DC    A(#VTSHRVM),A(MCSA)                         11/30/87 MTW
         DC    A(ADDRBL),A(ADDR24)                         11/30/87 MTW
         DC    A(#ASVT),A(#ASVTADR)
         DC    A(#JESCT),A(#JES2ADR)
*        DC    A(#LLA),A(#LLADDR)                          11/30/87 MTW
         DC    A(#USR),A(#CVTUSER)
         DC    A(#APF),A(#APFTBL)
         DC    A(#PSA),A(#PSADDR)
         DC    A(#RMF),A(#RMFCOL)
*        DC    A(#APF1),A(#APFTBL1)                        11/30/87 MTW
         DC    A(#APF2),A(#APFTBL2)
         DC    A(#RAC),A(#RACF)
         DC    A(#HSM),A(#DFHSM)
         DC    A(#VIRT),A(#VIRTFET)
         DC    A(#GRS),A(#GRSADDR)
         DC    A(#ATCVT),A(#VTAMADR)                       11/30/87 MTW
         DC    A(#VTDOFFS),A(#DATOFF)                      11/30/87 MTW
PARMLEN  EQU   (*-PARM)/8
         SPACE 3                                           11/30/87 MTW
*                                                          11/30/87 MTW
* REAL AND PRIVATE AREA SIZE CONVERSION ROUTINE PARAMETER LISTS     MTW
*                                                          11/30/87 MTW
*                SEND     RECEIVE
*               ADDRESS   ADDRESS
PARMLST1 DC    A(LENBL),A(REGLGBL)
PARMLST2 DC    A(LENAB),A(REGLGAB)
PARMLST3 DC    A(KREG24),A(KREG24A)
PARMLST4 DC    A(MREG24),A(MREG24A)
PARMLST5 DC    A(KREG31),A(KREG31A)
PARMLST6 DC    A(MREG31),A(MREG31A)
PARMLST7 DC    A(#VTRLSTB),A(BREAL)                        11/30/87 MTW
PARMLST8 DC    A(#VTRLSTK),A(KREAL)                        11/30/87 MTW
PARMLST9 DC    A(#VTRLSTM),A(MREAL)                        11/30/87 MTW
         SPACE 3                                           11/30/87 MTW
*                                                          11/30/87 MTW
*        STORAGE FOR RESULTS OF "VSMREGN" MACRO            11/30/87 MTW
*                                                          11/30/87 MTW
REGN     DS    0F                 WORKAREA FOR VSREGN MACRO
ADDRBL   DC    F'0'               ADDRESS OF REGION BELOW 16M
LENBL    DC    F'0'               LENGTH OF REGION BELOW 16M
ADDRAB   DC    F'0'               ADDRESS OF REGION ABOVE 16M
LENAB    DC    F'0'               LENGTH OF REGION ABOVE 16M
KREG24   DC    F'0'
MREG24   DC    F'0'
KREG31   DC    F'0'
MREG31   DC    F'0'
         SPACE 3                                           11/30/87 MTW
*                                                          11/30/87 MTW
*        STORAGE FOR RESULTS OF LOADING CVT ADDRESSES      11/30/87 MTW
*                                                          11/30/87 MTW
#VTRLSTB DC    F'0'               REAL STORAGE SIZE IN BYTES        MTW
#VTRLSTK DC    F'0'               REAL STORAGE SIZE IN K (1024 BYTES)
#VTRLSTM DC    F'0'               REAL STORAGE SIZE IN MEGS (1024K) MTW
#ASVT    DC    F'0'
#JESCT   DC    F'0'
*#LLA    DC    F'0'                                        11/30/87 MTW
#USR     DC    F'0'
#APF     DC    F'0'
#PSA     DC    F'0'
#RMF     DC    F'0'
*#APF1   DC    F'0'                                        11/30/87 MTW
#APF2    DC    F'0'
#RAC     DC    F'0'
#HSM     DC    F'0'
#VIRT    DC    F'0'
#GRS     DC    F'0'
#ATCVT   DC    F'0'               VTAM CVT                 11/30/87 MTW
#VTDOFFS DC    F'0'               DAT-OFF NUCLEUS (REAL ADDRESS)    MTW
         EJECT ,                                           11/30/87 MTW
***********************************************************11/30/87 MTW
*                                                                     *
*    THE FOLLOWING IS A TABLE OF STORAGE AREAS TO MAP.  THE INITIAL   *
*        TWELVE BYTES OF EACH ENTRY DOES NOT ASSEMBLE, BUT DOCUMENTS  *
*        THE TITLE OF THE AREA.  THE FIRST WORD IS THE START ADDRESS, *
*        THE SECOND IS AREA SIZE, THE THIRD IS THE END ADDRESS,       *
*        THE FOURTH IS THE NUMBER OF BYTES ACTUALLY USED WITHIN       *
*        THE AREA (ZERO FOR EVERYTHING BUT BELOW THE LINE CSA),       *
*        AND THE LAST WORD IS THE DATA RESOLUTION ROUTINE ADDRESS.    *
*        IN THE SPECIAL CASE OF THE CXRES ROUTINE, THE START ADDRESS  *
*        IS REPLACED BY THE ABSOLUTE DISPLACEMENT TO THE AREA START   *
*        ADDRESS POINTER CONTAINED IN THE MVS/XA VIRTUAL STORAGE      *
*        MAP EXTENSION TO THE CVT.                                    *
*                                                                     *
***********************************************************************
         SPACE 1
STGDSECT DSECT                     TABLE ENTRY MAPPING DSECT.
STGTITLE DS    0CL12               TABLE ENTRY TITLE.
STGSTART DS    A                   START ADDRESS OF ENTRY'S AREA.
STGSIZE  DS    A                   SIZE OF ENTRY'S AREA.
STGEND   DS    A                   END ADDRESS OF ENTRY'S AREA.
STGFULL  DS    A                   NUMBER OF BYTES USED.
STGRES   DS    A                   ADDRESS OF RESOLUTION ROUTINE.
STGLEN   EQU   *-STGDSECT          LENGTH OF TABLE ENTRY.
         SPACE 1
SYSTAT   CSECT ,                   RESUME SYSTAT DSECT
         SPACE 1
STGTABLE DS    0A                  START OF TABLE OF AREAS.
#DAEPVT  DC    0CL12'E-PRIVATE',A(0),A(0),A(0),A(0),A(EPRES)
#DAECSA  DC    0CL12'E-CSA',A(0),A(0),A(0),A(0),A(ECRES)
#VTEMLPS DC    0CL12'E-MLPA'
         DC    A(CVTEMLPS-CVTVSTGX),A(0),A(0),A(0),A(CXRES)
#VTEFLPS DC    0CL12'E-FLPA'
         DC    A(CVTEFLPS-CVTVSTGX),A(0),A(0),A(0),A(CXRES)
#VTEPLPS DC    0CL12'E-PLPA'
         DC    A(CVTEPLPS-CVTVSTGX),A(0),A(0),A(0),A(CXRES)
#DAESQA  DC    0CL12'E-SQA',A(0),A(0),A(0),A(0),A(ESRES)
#VTERWNS DC    0CL12'E-NUC (R/W)'
         DC    A(CVTERWNS-CVTVSTGX),A(0),A(0),A(0),A(CXRES)
#VTERONS DC    0CL12'E-NUC (R/O)',X'01000000',A(0),A(0),A(0),A(ENRORES)
#VTRONS  DC    0CL12'NUC (R/O)',A(0),A(0),X'00FFFFFF',A(0),A(NRORES)
#VTRWNS  DC    0CL12'NUC (R/W)'
         DC    A(CVTRWNS-CVTVSTGX),A(0),A(0),A(0),A(CXRES)
#DASQA   DC    0CL12'SQA',A(0),A(0),A(0),A(0),A(SRES)
#VTPLPAS DC    0CL12'PLPA',A(CVTPLPAS-CVTVSTGX),A(0),A(0),A(0),A(CXRES)
#VTFLPAS DC    0CL12'FLPA',A(CVTFLPAS-CVTVSTGX),A(0),A(0),A(0),A(CXRES)
#VTMLPAS DC    0CL12'MLPA',A(CVTMLPAS-CVTVSTGX),A(0),A(0),A(0),A(CXRES)
#VTSHRVM DC    0CL12'CSA',A(0),A(0),A(0),A(0),A(CRES)
#DAPVT   DC    0CL12'PRIVATE',A(0),A(0),A(0),A(0),A(PRES)
#VTREAL  DC    0CL12'V=R (IF ANY)',A(0),A(0),A(0),A(0),A(VRRES)
         DC    0CL12'PSA',A(0),A(4096),A(4095),A(0),A(NOPRES)
         DC    0CL12'END OF TABLE',X'FF'
 TITLE '--> STORAGE FOR ALL TPUTS: USING ORG STATEMENTS'
         SPACE
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
*  NOTE: LENGTH OF ALL 'TPUTS' ARE DETERMINED BY THE FOLLOWING      *
*        EQUATE ...                                                 *
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
         SPACE
$TPUTLEN EQU   60                           * LENGTH OF TPUT'S
CENTERA  EQU   $TPUTLEN/4                   * STRT
CENTERL  EQU   ($TPUTLEN-($TPUTLEN/4))      * MAX LENGTH OF CENTERED
         SPACE
  TITLE '--> I P L   ADDRESS CONSTANTS'
OUTSTOR  DS    0H
         DC    CL($TPUTLEN)' '
      ORG   *-$TPUTLEN+CENTERA
         DC    CL(CENTERL)'- - - IPL INFORMATION - - -'
      ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'SYSTEM ID = '
SYSID    DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'-'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C' SYSRES UNIT SUBCH DEV# VTOC_TTR PAGE SHARE  USERS CHPX
               IDS '                                       11/30/87 MTW
         ORG
*                         1         2         3         4         5
*                12345678901234567890123456789012345678901234567890
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C' '
SYSRES   DC    CL7' '          2-8
UNITADR  DC    CL3' '             9-11
SUBCHAN  DC    XL6'402020212020'      12-17                11/30/87 MTW
DEVNO    DC    XL6'402020212020'           18-23           11/30/87 MTW
         DC    C' '                             24         11/30/87 MTW
TTR0     DC    CL10' '                            25-34
PAGEDEV  DC    CL5'NO'                                 35-39
SHARE    DC    CL4'NO'                                      40-43
USERS    DC    XL6'402020202021'                                 44-49
CHPIDS   DC    2CL4' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'-'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'CLPA      = '
CLPA     DC    C'N'
         ORG
*
         DC    CL($TPUTLEN)' '
     ORG   *-$TPUTLEN
         DC    C'NUC ID    = '
         DC    C'IEANUC0'
#NUCID   DC    C' '
     ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'ICS       = IEAICS'
ICSMSG   DC    C'  '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'IPS       = IEAIPS'
IPSMSG   DC    C'  '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'OPT       = IEAOPT'
OPTMSG   DC    C'  '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'-'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'IPL DATE  ='
***              1 2 3 4 5 6 7
***                Y Y . D D D
IPLDATE  DC    X'4021204B202020'                           11/30/87 MTW
         DC    C'    TIME = '                              11/30/87 MTW
IPLTIME  DC    CL8'  .  .  '                               11/30/87 MTW
         ORG
*
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG   *-$TPUTLEN                                  11/30/87 MTW
         DC    CL12' '                                     11/30/87 MTW
IPLWKDAY DC    CL10' '                                     11/30/87 MTW
IPLMDY   DC    CL20' '                                     11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG   *-$TPUTLEN                                  11/30/87 MTW
         DC    C'TODAY     ='                              11/30/87 MTW
***              1 2 3 4 5 6 7                             11/30/87 MTW
***                Y Y . D D D                             11/30/87 MTW
CURDATE  DC    X'4021204B202020'                           11/30/87 MTW
         DC    C'    TIME = '                              11/30/87 MTW
CURTIME  DC    CL8' '                                      11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG   *-$TPUTLEN                                  11/30/87 MTW
         DC    CL12' '                                     11/30/87 MTW
CURWKDAY DC    CL10' '                                     11/30/87 MTW
CURMDY   DC    CL20' '                                     11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG   *-$TPUTLEN                                  11/30/87 MTW
ELAPSED  DC    X'40202120'                                 11/30/87 MTW
         DC    C' HOURS SINCE LAST IPL OR SET IPS'         11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN              TOP-OF-PAGE
         DC    C' '
         ORG
  TITLE '--> PRODUCTION INFORMATION CONSTANTS'
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN+CENTERA
         DC    CL(CENTERL)'- - PRODUCT INFORMATION - -'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'LEVEL     = '
PRODLVL  DC    CL16' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'NAME      = '
PRODNAM  DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'FMID      = '
PRODFMID DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'REL NUM.  = '
RELNUM   DC    CL8' '
         ORG
*
  TITLE '--> C P U   ADDRESS CONSTANTS'
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN+CENTERA
         DC    CL(CENTERL)'- - - CPU INFORMATION - - -'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'MODEL #   ='
CPUMODL  DC    X'4021202020'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'SERIAL #  = '
SERIAL   DC    CL6'UNKN'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'IPL CPUID =  '                            11/30/87 MTW
CPUPID   DC    X'4020202020'
         ORG
*
         DC    CL($TPUTLEN)' '
           ORG *-$TPUTLEN
         DC    C'MAX CPUID =  '                            11/30/87 MTW
MAXMP    DC    X'4020202020'
         ORG
*
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C' # ONLINE =  '                            11/30/87 MTW
CPUONLIN DC    X'4020202020'                               11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
  TITLE '--> S M F   ADDRESS CONSTANTS'
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN+CENTERA-4                          11/30/87 MTW
         DC    CL(CENTERL)'- - SMF BUFFER AREA INFORMATION - -'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'MIN BUFF  = '
SMFMBUF  DC    X'402020202021'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'MAX BUFF. = '
SMFXBUF  DC    X'402020202021'
         ORG
*
         DC    CL($TPUTLEN)' '
          ORG *-$TPUTLEN
         DC    C'DATALOST? ='
SMFLOST  DC    X'40202020202020202020'
          ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'BUFF. OUT ='
SMFBUFD  DC    X'40202020202020202021'
         ORG
*
  TITLE '--> SYSTEM REGION ADDRESS CONSTANTS'
         DC    CL($TPUTLEN)' '
          ORG *-$TPUTLEN
         DC    C' '      TOP-OF-PAGE    FILLER L(50)
          ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN+CENTERA
         DC    CL(CENTERL)'- -  SYSTEM STORAGE VALUES - -'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'-'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'PRIVATE AREA ADDR BELOW 16M  = '
ADDR24   DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'              SIZE IN BYTES  ='
REGLGBL  DC    CL19' '
         DC    C' B'              PRIVATE AREA SIZE BELOW 16M IN BYTES
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'      SIZE IN K (1024 BYTES) ='
KREG24A  DC    CL19' '            PRIVATE AREA SIZE BELOW 16M IN K
         DC    C' K'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'  SIZE IN MEGS (1024K BYTES) ='
MREG24A  DC    CL19' '            PRIVATE AREA SIZE BELOW 16M IN MEGS
         DC    C' MEG'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG   *-$TPUTLEN
         DC    C'-'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'PRIVATE AREA ADDR ABOVE 16M  = '
ADDR31   DC    CL8' '             PRIVATE AREA ADDRESS ABOVE 16M
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'              SIZE IN BYTES  ='
REGLGAB  DC    CL19' '            PRIVATE AREA SIZE ABOVE 16M IN BYTES
         DC    C' B'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'      SIZE IN K (1024 BYTES) ='
KREG31A  DC    CL19' '            PRIVATE AREA SIZE ABOVE 16M IN K
         DC    C' K'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'  SIZE IN MEGS (1024K BYTES) ='
MREG31A  DC    CL19' '            PRIVATE AREA SIZE ABOVE 16M IN MEGS
         DC    C' MEG'            FILLER
         ORG
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG   *-$TPUTLEN                                  11/30/87 MTW
         DC    C'-'                                        11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C' REAL STORAGE SIZE IN BYTES  ='           11/30/87 MTW
BREAL    DC    CL19' '                  CVTRLSTG*1024      11/30/87 MTW
         DC    C' B'                                       11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'      SIZE IN K (1024 BYTES) ='           11/30/87 MTW
KREAL    DC    CL19' '                  CVTRLSTG           11/30/87 MTW
         DC    C' K'                                       11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'  SIZE IN MEGS (1024K BYTES) ='           11/30/87 MTW
MREAL    DC    CL19' '                  CVTRLSTG/1024      11/30/87 MTW
         DC    C' MEG'                                     11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*
  TITLE '--> SYSTEM STORGE ADDRESS CONSTANTS'
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C' '      TOP-OF-PAGE    FILLER L(50)
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN+CENTERA
         DC    CL(CENTERL)'- - SYSTEM STORAGE AREAS - -'
         ORG
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C' '      HEADER LINE INDICATOR             11/30/87 MTW
         DC    C'ABOVE THE LINE  '                         11/30/87 MTW
         DC    C'  START   '                               11/30/87 MTW
         DC    C'  END     '                               11/30/87 MTW
         DC    C'LENGTH (K)'                               11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C' '      HEADER LINE INDICATOR             11/30/87 MTW
         DC    C'--------------  '                         11/30/87 MTW
         DC    C'--------  '                               11/30/87 MTW
         DC    C'--------  '                               11/30/87 MTW
         DC    C'----------'                               11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
STGLINE  DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'E-PRIVATE'                                11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'E-CSA'                                    11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'E-MLPA'                                   11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'E-FLPA'                                   11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'E-PLPA'                                   11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'E-SQA'                                    11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'E-NUC (R/W)'                              11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'E-NUC (R/O)'                              11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C' '      TOP-OF-PAGE                       11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN+CENTERA                            11/30/87 MTW
         DC    CL(CENTERL)'- - SYSTEM STORAGE AREAS - -'   11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C' '      HEADER LINE INDICATOR             11/30/87 MTW
         DC    C'BELOW THE LINE  '                         11/30/87 MTW
         DC    C'  START   '                               11/30/87 MTW
         DC    C'  END     '                               11/30/87 MTW
         DC    C'LENGTH (K)'                               11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C' '      HEADER LINE INDICATOR             11/30/87 MTW
         DC    C'--------------  '                         11/30/87 MTW
         DC    C'--------  '                               11/30/87 MTW
         DC    C'--------  '                               11/30/87 MTW
         DC    C'----------'                               11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'NUC (R/O)'                                11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'NUC (R/W)'                                11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'SQA'                                      11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'PLPA'                                     11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'FLPA'                                     11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'MLPA'                                     11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'CSA'                                      11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'PRIVATE'                                  11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'V=R (IF ANY)'                             11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*                                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'PSA'        '                             11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*
  TITLE '--> SYSTEM TASKS ADDRESSES '
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C' '                    TOP-OF-PAGE
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN+CENTERA
         DC    CL(CENTERL)'- - SYSTEM STORAGE AREAS - -'
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'ADDRESS SPACE VECTOR TABLE        = '
#ASVTADR DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'JES SYSTEM CONTROL TABLE          = '
#JES2ADR DC    CL8' '
         ORG
*                                                          11/30/87 MTW
*        DC    CL($TPUTLEN)' '                             11/30/87 MTW
*        ORG *-$TPUTLEN                                    11/30/87 MTW
*        DC    C'LINK LIST MEMORY TERMINATION ADDR = '     11/30/87 MTW
*#LLADDR DC    CL8' '                                      11/30/87 MTW
*        ORG                                               11/30/87 MTW
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'CVT USER                          = '
#CVTUSER DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'APF: CVTAPFA                      = '
#APFTBL  DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'SYSGEN''ED PSA ADDRESS             = '    11/30/87 MTW
#PSADDR  DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'RMF COLLECTION ROUTINE            = '
#RMFCOL  DC    CL8' '
         ORG
*                                                          11/30/87 MTW
*        DC    CL($TPUTLEN)' '                             11/30/87 MTW
*        ORG *-$TPUTLEN                                    11/30/87 MTW
*        DC    C'APF: CVTAUTHL                     = '     11/30/87 MTW
*#APFTBL1 DC   CL8' '                                      11/30/87 MTW
*        ORG                                               11/30/87 MTW
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'APF: CVTAPFT                      = '
#APFTBL2 DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'RACF CVT                          = '
#RACF    DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'DFHSM QUEUE CONTROL TABLE         = '
#DFHSM   DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'VIRT FETCH                        = '
#VIRTFET DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'GRS ADDRESS                       = '
#GRSADDR DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C'VTAM ATCVT                        = '     11/30/87 MTW
#VTAMADR DC    CL8' '
         ORG
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C'DAT-OFF NUCLEUS (REAL ADDRESS)    = '     11/30/87 MTW
#DATOFF  DC    CL8' '                                      11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C' '                    TOP OF PAGE
         ORG
  TITLE '--> STORAGE MAP CONSTANTS'
*                             1         2         3         4
*                    1234567890123456789012345678901234567890
*
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'STORAGE MAP:'
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          ._______________________.'    L(35)
         ORG
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC     C'          |                       |'    L(35)     MTW
         ORG    ,                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          //  E-LSQA/SWA/229/230 //'    L(35)     MTW
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' ---------|-----------------------|'    L(35)     MTW
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' USABLE   |      MAXIMUM          |'    L(35)     MTW
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' EXTENDED //     E-PRIVATE       //'    L(35)     MTW
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' PRIVATE  |                       |'    L(35)     MTW
             ORG *-21
MLEN31   DC     CL19' '
         DC     C' |'
         DC     C' '
MEPRIV   DC     CL9' '
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' _________|_______________________|'    L(35)
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          |        E-CSA          |'    L(35)
         DC     C' '                                       11/30/87 MTW
MECSA    DC     CL8' '                                     11/30/87 MTW
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' COMMON   |        E-MLPA         |'    L(35)
         DC     C' '
MEMLPA   DC     CL8' '
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          |        E-FLPA         |'    L(35)
         DC     C' '
MEFLPA   DC     CL8' '
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' EXTENDED |        E-PLPA         |'    L(35)
         DC     C' '
MEPLPA   DC     CL8' '
         ORG
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC     C'          |        E-SQA          |'    L(35)     MTW
         DC     C' '                                       11/30/87 MTW
MESQA    DC     CL8' '                                     11/30/87 MTW
         ORG    ,                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC     C'          |    E-READ-WRITE-NUC   |'    L(35)     MTW
         DC     C' '                                       11/30/87 MTW
MERWNUC  DC     CL8' '                                     11/30/87 MTW
         ORG    ,                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC     C'          |    E-READ-ONLY-NUC    |'    L(35)     MTW
         DC     C' '
MERONUC  DC     CL8' '
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' 16M LINE |-----------------------|'    L(35)     MTW
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC    C' '                    TOP OF PAGE
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'STORAGE MAP:'
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' 16M LINE |-----------------------|'    L(35)     MTW
         DC     C' 00FFFFFF'
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          |     READ-ONLY-NUC     |'    L(35)
         DC     C' '
MRONUC   DC     CL8' '
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          |     READ-WRITE-NUC    |'    L(35)
         DC     C' '
MRWNUC   DC     CL8' '
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          |         SQA           |'    L(35)
         DC     C' '                                       11/30/87 MTW
MSQA     DC     CL8' '                                     11/30/87 MTW
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' COMMON   |         PLPA          |'    L(35)
         DC     C' '
MPLPA    DC     CL8' '
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          |         FLPA          |'    L(35)
         DC     C' '
MFLPA    DC     CL8' '
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          |         MLPA          |'    L(35)
         DC     C' '
MMLPA    DC     CL8' '
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          |         CSA           |'    L(35)
         DC     C' '
MCSA     DC     CL8' '
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'MEG-BNDY--|-----------------------|'     11/30/87 MTW
         ORG
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC     C'          //   LSQA/SWA/229/230  //'    L(35)     MTW
         ORG    ,                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' ---------|-----------------------|'    L(35)     MTW
         ORG
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC     C' USABLE   |        MAXIMUM        |'    L(35)     MTW
         ORG    ,                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C' PRIVATE  //       PRIVATE       //'    L(35)     MTW
         ORG    ,                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC     C' AREA     |                       |'     11/30/87 MTW
         ORG    *-23                                       11/30/87 MTW
MLEN24   DC     CL19' '                                    11/30/87 MTW
         DC     C'   |'                                    11/30/87 MTW
         DC     C' '                                       11/30/87 MTW
MPRIV    DC     CL8' '                                     11/30/87 MTW
         ORG    ,                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC     C' ---------|-----------------------|'    L(35)     MTW
         ORG    ,                                          11/30/87 MTW
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          |    SYSTEM REGION      |'
         DC     C' 20K'
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          |         PSA           |'
         DC     C' 4K'
         ORG
         DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'          !_______________________!'     11/30/87 MTW
         ORG
         DC    CL($TPUTLEN)' '                             11/30/87 MTW
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC    C' '                    TOP OF PAGE         11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
ENDTPUT  EQU   (*-OUTSTOR)/$TPUTLEN
 TITLE '--> DATA AREAS'
SAVE     DS    18F
SAVE1    DS    F                   * PARM IF ANY ...
SAVBAL   DS    F                   * SAVE AREA FOR 'BALREG'
OPENFLG  DC    X'00'               * SYSOUT - DCB OPEN/CLOSE FLAG
* SOME TPUT/TGET VARIABLES
CLEAR    DS    0X                                          11/30/87 MTW
         DC    X'C3'          WCC - WCC RESET/KEYBRD RESTORE/RESET MDT
         DC    X'115D7E'      SBA - SPF "EXIT FULL SCREEN" SIGNAL
         DC    X'114040'      SBA - FIRST POSITION OF SCREEN
         DC    X'3C404000'    RA  - FILL ENTIRE SCREEN WITH NULLS
         DC    X'114040'      SBA - FIRST POSITION OF SCREEN
         DC    X'13'          IC  - MOVE CURSOR TO FIRST POSITION
CLEARLEN EQU   *-CLEAR                                     11/30/87 MTW
HITENTER DC    CL23'HIT ENTER TO CONTINUE >'
HENTER   DC    C' '
*
PDATE    DS    F
MTIME    DS    F
         SPACE
DWORD    DS    D
CPUMDL   DS    CL2
         DC    X'F000'
#SUBCHAN DC    PL4'0'                                      11/30/87 MTW
#DEVNO   DC    PL4'0'                                      11/30/87 MTW
PATHS    DC    CL8' '
EDITPATH DC    X'40202120'
         DS    0F
PPATHS   DS    H
GETREG   DS     F
         SPACE 3                                           11/30/87 MTW
         DS    0D                                          11/30/87 MTW
JULPTRS  DC    A(JULPARM1)                                 11/30/87 MTW
         DC    A(JULPARM2)                                 11/30/87 MTW
         DC    A(JULPARM3)                                 11/30/87 MTW
         DC    A(JULPARM4)                                 11/30/87 MTW
         DC    X'80'                                       11/30/87 MTW
         DC    AL3(JULPARM5)                               11/30/87 MTW
JULPARM1 DS    F                      * THE INPUT DATE     11/30/87 MTW
JULPARM2 DS    F                      * INPUT FORMAT CODE  11/30/87 MTW
JULPARM4 DS    F                      * OUTPUT FORMAT CODE 11/30/87 MTW
JULPARM3 DS    CL44                   * OUTPUT FIELD       11/30/87 MTW
JULPARM5 DS    32D                    * 256 BYTE WORKAREA  11/30/87 MTW
 TITLE '-->  APF TABLE  TPUT SECTION '
APFMSG0  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'------------  IEAAPFnn  TABLE  ------------'
         ORG
APFMSG1  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'TOTAL ENTRIES   ='
APFENTS  DC     X'40202020'
         ORG
APFMSG2  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'NOTE: 1ST 2 ENTRIES ARE SYSTEM DEFAULTS'
         ORG
APFMSG3  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'      SYS1.LINKLIB  AND SYS1.SVCLIB'
         ORG
APFMSG4  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN+$TPUTLEN-9
         DC     C'C'
         ORG
APFMSG5  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN+$TPUTLEN-9
         DC     C'A'
         ORG
APFMSG6  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN                                    11/30/87 MTW
         DC     C'                                           PARMLIB'
         DC     C' T CATALOG'                              11/30/87 MTW
         ORG
APFMSG7  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'______ DSNAME _____                         VOLSER'
         DC     C' ? VOLSER'
         ORG
 TITLE '-->  LINK LIST TABLE  TPUT SECTION '               11/30/87 MTW
LLTMSG0  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'------------  LNKLSTnn  TABLE  ------------'
         ORG
LLTMSG1  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'TOTAL ENTRIES   ='
LLTENTS  DC     X'40202020'
         ORG
LLTMSG2  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'NOTE: 1ST ENTRY, SYS1.LINKLIB, IS A SYSTEM DEFAULT'
         ORG
LLTMSG4  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN+$TPUTLEN-12
         DC     C'A  C'
         ORG
LLTMSG5  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN+$TPUTLEN-12
         DC     C'P  A'
         ORG
LLTMSG6  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN+$TPUTLEN-12
         DC     C'F  T CATALOG'
         ORG
LLTMSG7  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'______ DSNAME _____                             '
         DC     C'?  ? VOLSER'
         ORG
         SPACE  3
*       -->  SMCA TABLE  TPUT SECTION                      11/30/87 MTW
SMFMSG0  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'------------  SMFPRM'
SMFPRM   DC     C'nn'
         DC     C'  DATA  -------------'
         ORG
SMFMSG1  DC    CL($TPUTLEN)' '
         ORG *-$TPUTLEN
         DC     C'-'
         ORG
 TITLE  '--> DATA SET NAME TABLE PROCESSING STORAGE'
DSNCOUNT DS     H                                          11/30/87 MTW
GETSIZE  DC     A(0)                                       11/30/87 MTW
*
FINDSN   CAMLST NAME,DSNAME,,DSNAREA
DSNAME   DC     CL44' '
DSNAREA  DS     0D
         DS     265C
DSNVOL   EQU    DSNAREA+6
 TITLE  '--> OPTIONAL DCB DEFINITION IF DDNAME(SYSOUT) WAS ALLOCATED'
         SPACE
CARCNTL  DC    CL1' '
OUTREC   DC    CL79' '
SYSOUT   DCB   DDNAME=SYSOUT,LRECL=80,RECFM=FBA,DSORG=PS,EXLST=EXL,    X
               MACRF=PM
EXL      DC    X'87',AL3(JFCB)
JFCB     DS    176C
TRANSL   EQU   *
         DC    C'.'
         DC    63C' '
         DC    X'40404040404040404040' ****        ASCII
         DC    X'4A'                   **** CENT OR (J)
         DC    C'.<(+|'                ****
         DC    X'50'                   AMPERSAND
         DC    X'404040404040404040'
         DC    X'5A'                   EXCLAMATION POINT
         DC    C'$*);-/'
         DC    X'4040404040404040'     ****       ASCII-LOWERCASE
         DC    X'6A'                   VERTICLE LINE (NOT |)
         DC    C',%_>?'
         DC    X'404040404040404040'
         DC    X'79'                   GRAVE ACCENT
         DC    C':#@'
         DC    X'7D'                   SINGLE QUOTE
         DC    C'="'                   **** END OF ASCII
         DC    X'80'
         DC    X'818283848586878889'   SMALL LETTERS
         DC    X'40404040404040'
         DC    X'919293949596979899'   SMALL LETTERS
         DC    X'40404040404040'
         DC    X'40'                   TILDE
         DC    X'A2A3A4A5A6A7A8A9'     SMALL LETTERS
         DC    X'404040404040'
         DC    X'40404040404040404040'
         DC    X'404040404040'
         DC    X'C0'                   LEFT BRACE
         DC    C'ABCDEFGHI'            CAPITAL LETTERS
         DC    X'4040'
         DC    X'40'                   HOOK
         DC    X'40'
         DC    X'40'                   FORK
         DC    X'40'
         DC    X'D0'                   RIGHT BRACE
         DC    C'JKLMNOPQR'            CAPITAL LETTERS
         DC    X'DADBDCDDDEDF'
         DC    X'E0'                   REVERSE SLANT
         DC    X'40'
         DC    C'STUVWXYZ'             CAPITAL LETTERS
         DC    X'4040'
         DC    X'40'                   CHAIR
         DC    X'404040'
         DC    C'0123456789'           NUMERICS
         DC    X'FA'                   LONG VERTICLE LINE (NOT
         DC    X'4040404040'
 TITLE  '--> SMFPRMnn DATA WORKING STORAGE'                11/30/87 MTW
SMFCOUNT DC    H'0'                    COUNT OF SMF SMCA BUFFERS BUILT
         DC    C' '                    USED TO CLEAR WORKBUF        MTW
WORKBUF  DC    CL71' '                 WORKING AREA BUFFER 11/30/87 MTW
         SPACE 1                                           11/30/87 MTW
         ORG   WORKBUF                                     11/30/87 MTW
WKSMFSID DS    0C'SID(XXXX)',C'SID('                       11/30/87 MTW
WKSID    DS    C'XXXX',C') '                               11/30/87 MTW
WKJWT    DS    0C'JWT(HHMM)',C'JWT('                       11/30/87 MTW
WKJWT#   DS    C'MMSS',C') '                               11/30/87 MTW
WKMAXDRM DS    0C'MAXDORM(MMSS)',C'MAXDORM('               11/30/87 MTW
WKMAXDM# DS    C'HHMM',C') '                               11/30/87 MTW
WKSTATUS DS    0C'STATUS(HHMMSS)',C'STATUS('               11/30/87 MTW
WKSTTUS# DS    C'HHMMSS',C')'                              11/30/87 MTW
         ORG   WORKBUF                                     11/30/87 MTW
WKNAME   DS    C'XXXX',C': DETAIL INTERVAL(HHMMSS)'        11/30/87 MTW
         ORG   WORKBUF+2                                   11/30/87 MTW
WKEXITS  DS    C'EXITS'                                    11/30/87 MTW
WKEXIT#  DS    C                                           11/30/87 MTW
         ORG   WORKBUF                                     11/30/87 MTW
WKPRIM   DS    0C'P'                                       11/30/87 MTW
WKSECND  DS    C'S'                                        11/30/87 MTW
WKSMFDSN DS    0C'-DSN(SYS1.MANX)',C'-DSN('                11/30/87 MTW
WKDSN    DS    C'SYS1.MANX',C') '                          11/30/87 MTW
WKSMFVOL DS    0C'VOL(XXXXXX)',C'VOL('                     11/30/87 MTW
WKVOL    DS    C'VOLSER',C') '                             11/30/87 MTW
WKBLOCKS DS    0C'BLKS(XXXXXXX)',C'BLKS('                  11/30/87 MTW
WKBLKS   DS    C'XXXXXXX',C')'                             11/30/87 MTW
WKPERCNT DS    0CL6,C                                      11/30/87 MTW
WKFULL   DS    0C'FULL'                                    11/30/87 MTW
WKEMPTY  DS    C'EMPTY',C                                  11/30/87 MTW
WKACTDSN DS    0C'ACTIVE'                                  11/30/87 MTW
WKDUMP   DS    C'DUMP REQ''D'                              11/30/87 MTW
         ORG   ,                                           11/30/87 MTW
 TITLE  '--> LITERALS'                                     11/30/87 MTW
         LTORG
         TITLE '--> CVT - DSECT'
         CVT   DSECT=YES,PREFIX=YES
         TITLE '--> UCB - DSECT'
         IEFUCBOB PREFIX=YES
         PRINT NOGEN
         TITLE '--> ASVT - DSECT'                          11/30/87 MTW
         IHAASVT
         TITLE '--> ASCB - DSECT'                          11/30/87 MTW
         IHAASCB
         TITLE '--> OUCB - DSECT'                          11/30/87 MTW
         IRAOUCB
         TITLE '--> RMCT - DSECT'                          11/30/87 MTW
*        IRARMCT                                           11/30/87 MTW
RMCT     DSECT                                             11/30/87 MTW
         ORG   RMCT+X'10'                                  11/30/87 MTW
RMCTRMPT DS    A                      * SRM PARAMETER TABLE11/30/87 MTW
         ORG   RMCT+X'18'                                  11/30/87 MTW
RMCTWMST DS    A                      * WLM SPECIFCTN TABLE11/30/87 MTW
         ORG   RMCT+X'7C'                                  11/30/87 MTW
RMCTTOD  DS    F                      * CURRENT TIME OF DAY11/30/87 MTW
         ORG   RMCT+X'DC'                                  11/30/87 MTW
RMCTICST DS    A                      * ICSC TABLE ADDRESS 11/30/87 MTW
         SPACE 1                                           11/30/87 MTW
RMPTOPTN EQU   83                     * SUFFIX OF IEAOPT   11/30/87 MTW
         SPACE 1                                           11/30/87 MTW
WMSTID   EQU   4                      * SUFFIX OF IEAIPS   11/30/87 MTW
         TITLE '--> RMCT - DESCT'                          11/30/87 MTW
*        IRARMCT                                           11/30/87 MTW
CSD      DSECT                                             11/30/87 MTW
         ORG   CSD+X'0A'                                   11/30/87 MTW
CSDCPUOL DC    H'0'        NUMBER OF CPU'S CURRENTLY ALIVE 11/30/87 MTW
         TITLE '--> SMF - DSECTS'                          11/30/87 MTW
         IEESMCA
         EJECT ,                                           11/30/87 MTW
RDS      DSECT
RDSID    DS    C'RDS '
RDSNEXT  DS    A
RDSPREV  DS    A
RDSFLAG  DS    X
RDSFREE  EQU   X'10'                    NEED TO FREE DATASET AND RDS
RDSDUMP  EQU   X'08'                    DATASET REQUIRES DUMP
RDSREADY EQU   X'04'                    DATASET OPEN AND READY TO USE
RDSCLOSE EQU   X'02'                    DATASET NEEDS TO BE CLOSED
RDSNDOP  EQU   X'01'                    DATASET NEEDS TO BE OPENED
RDSFLAG2 DS    X
RDSLOST  EQU   X'80'                    DUMMY RDS FOR LOST DATA
RDSPHYER EQU   X'80'                    PHYSICAL I/O ERROR
RDSLOGER EQU   X'80'                    LOGICAL I/O ERROR
         DS    XL2
RDSNAME  DS    CL10                     DATASET NAME
RDSVOLID DS    CL6                      VOLUME SERIAL
RDSDDN   DS    CL8                      DDNAME
RDSCAPTY DS    XL4                      DATASET CAPACITY (BLOCKS)
RDSNXTBL DS    XL4                      NUM OF NEXT AVAIL BLOCK
RDSBQE   DS    A                        A(BUFFER QUEUE ELEMENT)
RDSAVSPC DS    F                        AVAILABLE SPACE
RDSENRBA DS    XL4                      ENDRBA
RDSCINV  DS    F                        CONTROL INTERVAL SIZE
RDSDOMID DS    F                        MSG NUMBER OF DUMP MSG
RDSRPL   DS    CL76                     VSAM RPL
RDSACB   DS    CL76                     VSAM ACB
         EJECT ,                                           11/30/87 MTW
IEEMBACT DSECT
ACTID    DS    C'ACT '                  EYE CATCHER
ACTSRCP  DS    A                        A(PARSE INPUT)
ACTMSDCB DS    A                        A(MSG DCB)
ACTPLDCB DS    A                        A(PARMLIB DCB)
ACTOCB   DS    A                        A(FIRST OCB)
ACTDSNAM DS    A                        A(DSNAME OCBS)
ACTOCBPL DS    A                        A(OCB BUFFER POOL)
ACTCONID DS    C                        CONSOLE ID
ACTCAREA DS    C                        CONSOLE AREA
ACTALTCN DS    C                        ALTERNATE CONSOLE ID
ACTALTAR DS    C                        ALTERNATE CONSOLE AREA
ACTOPTAB DS    A
ACTFLGS  DS    0XL2                     FLAG BYTES
ACTFLAG1 DS    X                        FLAG BYTE
ACTDMP   EQU   X'80'                    DUMP PROCESSING
ACTSMF   EQU   X'40'                    SMF PROCESSING
ACTMEMBF EQU   X'20'                    PARM FROM PARMLIB MEMBER
ACTREPLF EQU   X'10'                    PARM FROM OPERATOR REPLY
ACTDFTSF EQU   X'80'                    PARM DEFAULTED
ACTSYSNF EQU   X'40'                    PARM FROM SYSIN
ACTMSGF  EQU   X'20'                    WRITE/SUPPRESS ERROR MSGS
ACTNOXF  EQU   X'10'                    "NO" XXX
ACTFLAG2 DS    X                        FLAG BYTE
ACTERRF  EQU   X'80'
ACTRANGF EQU   X'40'                    COLON FOUND IN TEXT STRING
ACTOPPRF EQU   X'20'
ACTPRMTL EQU   X'10'                    PROMPT(LIST)
ACTPRMTI EQU   X'08'                    PROMPT(IPLR)
ACTMEMID DS    CL2                      SMFPRM.. MEMBER ID
ACTCHARP DS    A                        A(CURRENT BUFFER)
ACTENDP  DS    A                        E(END OF BUFFER)
ACTOPTNE DS    A                        A(OPTION TABLE ENTRY)
ACTBUFP  DS    A                        A(START OF STRING)
ACTBUFL  DS    H                        L'BUFFER
ACTBUFL1 DS    H
ACTBSU   DS    X
ACTSTATE DS    X                        CURRENT PARSE STATE
ACTNXTST DS    X                        NEXT PARSE STATE
         DS    X
ACTSVOCB DS    A                        SAVE SYSTEM OCB
         EJECT ,                                           11/30/87 MTW
SST      DSECT                          SMF SELECTIVITY TABLE
SSTNAME  DS    CL4
SSTFLAGS DS    X
SSTDETAL EQU   X'80'                    DETAILED ACCT'NG
SSTACTIV EQU   X'40'                    SUBSYSTEM ACTIVE
SSTRESET EQU   X'20'
         DS    XL3
SSTINTVL DS    XL8                      INTERVAL LENGTH
SSTRCDON DS    32X                      ONE BIT PER RECORD SELECTED
SSTEXTAB DS    A                        A(EXIT TABLE)
         SPACE 3                                           11/30/87 MTW
EXITTAB  DSECT
EXITSPL  DS    XL4                      SUBPOOL ID AND LENGTH
EXITNMBR DS    F                        NUMBER OF EXITS
EXITNTRY EQU   *
EXITNAME DS    CL8                      EXIT NAME
         DS    A                        A(0)
EXITADDR DS    A                        A(EXIT)
EXITINAC EQU   X'80'                    EXIT ACTIVE
         TITLE '--> GDA - DESCT'                           11/30/87 MTW
         IHAGDA ,                                          11/30/87 MTW
         TITLE '   J U L S U B   '
************************************************************
*                                                          *
*        'JULSUB'                                          *
*                                                          *
************************************************************
         SPACE
*        WRITTEN BY. BILL GODFREY,  PLANNING RESEARCH CORPORATION.
*        INSTALLATION. PRC COMPUTER CENTER, MCLEAN VA.
*        DATE WRITTEN. JUNE 4 1976.
*        DATE UPDATED. APRIL 23 1980.
*        ATTRIBUTES. RE-ENTRANT.
*        REMARKS.
*            THIS SUBPROGRAM CONVERTS A DATE FROM ONE FORMAT
*            TO ANOTHER. THE DIFFERENT FORMATS ARE:
*
*            INPUT
*               1   JULIAN       BINARY    F'YYYYDDD'
*               2   STANDARD     BINARY    F'YYYYMMDD'
*               3   JULIAN       PACKED    PL4'YYYYDDDF'
*
*            OUTPUT
*               1   JULIAN       BINARY    F'YYYYDDD'
*               2   STANDARD     BINARY    F'YYYYMMDD'
*               4   STANDARD     8-CHAR    CL8'MM/DD/YY'
*               8   ALPHA        8-CHAR    CL8'03JUN76 '
*              16   PROSE        20-CHAR   CL20'JUNE 3 1976'
*              32   FRSTLAST     BINARY    F'0' 1 - FIRST OF MONTH
*                                               2 - LAST OF MONTH
*              64   WEEKDAYCODE  BINARY    F'0' (SATURDAY)
*             128   WEEKDAY      12-CHAR   CL12'SATURDAY'
*             256   TIME         BINARY    F'100THS SEC SINCE MIDNITE'
*             512   TIME         8-CHAR    CL8'HH:MM:SS'
*
*            INPUT MUST BE EITHER JULIAN OR STANDARD.
*
*            PASS THE FOLLOWING PARAMETERS VIA A LIST OF ADDRESSES
*            POINTED TO BY REGISTER 1
*               1   THE INPUT DATE
*               2   A FULLWORD CONTAINING THE NUMERIC CODE
*                   WHICH DEFINES THE INPUT FORMAT
*               3   THE RECEIVING FIELD FOR OUTPUT
*               4   A FULLWORD CONTAINING THE NUMERIC CODE
*                   WHICH DEFINES THE OUTPUT FORMAT
*               5   A 256 BYTE WORKAREA (ON DOUBLEWORD BOUNDARY)
*            NOTES.
*               1) MAKE OUTPUT 00YY IF INPUT IS 00YY.
*               2) FOR CURRENT DATE, USE TYPE 1 DATE ZERO.
         SPACE
         MACRO
         STAMP
         LCLC  &ASMTIME
&ASMTIME SETC  '&SYSTIME'(1,5)
         DC    CL16' &SYSDATE &ASMTIME '
         MEND
         SPACE
JULSUB CSECT
         USING *,R12
         B     @PROLOG-*(,15)
         DC    AL1(11),CL11'JULSUB   '
         STAMP
@PROLOG  STM   14,12,12(13)
         LR    R12,15
         LR    R2,R1
*        GETMAIN R,LV=@DATAL       GET SAVEAREA ADDRESS
         L     R1,16(,R1)          GET SAVEAREA ADDRESS
         ST    13,4(,1)
         ST    1,8(,13)
         LR    13,1
         LR    R1,R2
         USING @DATA,13
         SPACE
         LM    R2,R3,0(R1)         GET INPUT AND DESCRIPTOR
         LM    R4,R5,8(R1)         GET OUTPUT AND DESCRIPTOR
         MVC   INPUT(4),0(R2)      COPY INPUT
         XC    DOUBLE,DOUBLE
         SLR   R14,R14             ZERO R14
         ST    R14,FRSTLAST
         ST    R14,TIMEB
         CLI   3(R3),INP003        INPUT JULIAN PACKED?
         BNE   INP01               NO - BRANCH
         SPACE
*              INPUT IS JULIAN PACKED
         SPACE
         MVC   DOUBLE+4(4),INPUT   MOVE INPUT
         CVB   R1,DOUBLE
         ST    R1,JB
JULCOMM  L     R14,DOUBLE+4        SAVE 00YYDDDF
         LH    R1,DOUBLE+4         GET 00YY
         SLL   R1,16               GET 00YY0000
         SRL   R1,12               GET 00000YY0
         ST    R1,DOUBLE+4         STORE BACK 00000YY0
         OI    DOUBLE+7,X'0F'      SET SIGN
         CVB   R1,DOUBLE
         ST    R1,YYYYB
         CH    R1,=H'99'
         BH    *+8
         AH    R1,=H'1900'
         ST    R1,CENTB
         UNPK  YYYYC,DOUBLE+5(3)     SAVE YYYY CHAR
         MVC   YYC,YYYYC+2
*
         ST    R14,DOUBLE+4        RESTORE 00YYDDDF
         XC    DOUBLE(6),DOUBLE      00YYDDDF TO 0000DDDF
         OI    DOUBLE+7,X'0F'      SET SIGN
         UNPK  DDDC,DOUBLE+4(4)    SAVE DDD CHAR
         CVB   R1,DOUBLE           CONVERT DDD TO BINARY
         ST    R1,DDDB             SAVE DDD BINARY
         SPACE
         BAL   R9,TODD
         BAL   R9,TOSB
         BAL   R9,TOMON
         BAL   R9,TOPROSE
         BAL   R9,TOWEEK
         BAL   R9,TOTIME
         BAL   R9,OUTPUT
         B     EXIT0
         SPACE
INP01    CLI   3(R3),INP001        INPUT JULIAN BINARY?
         BNE   INP02               NO - BRANCH
         L     R1,INPUT            GET BINARY YYYYDDD
         LTR   R1,R1               ZERO?
         BNZ   INP01A              NO - BRANCH
         TIME  BIN
         ST    R0,TIMEB            SAVE TIME
         SLR   R0,R0
         STM   R0,R1,DOUBLE
         CVB   R1,DOUBLE
         B     INP01B
INP01A   CVD   R1,DOUBLE           TO DECIMAL
INP01B   ST    R1,JB
         B     JULCOMM             PROCEED AS IF INP003
         SPACE
*              CONVERT JULIAN DATE TO MONTH-DAY-YEAR
*
*                 INPUT  - YYYYB AND DDDB   (ALSO YYC)
*
*                 OUTPUT - MMB AND DDB, MMC AND DDC, FRSTLAST
         SPACE
TODD     MVC   DPM(26),DAYSPMON
         TM    YYYYB+3,B'00000011' IS YEAR A MULTIPLE OF 4?
         BNZ   DPM365              NO - BRANCH
         CLC   YYC,=C'00'          DIVISIBLE BY 100?
         BNE   DPM366              NO - BRANCH
         L     R15,CENTB
         SLR   R14,R14
         D     R14,=F'400'
         LTR   R14,R14             EVENLY DIVISIBLE BY 400?
         BNZ   DPM365              NO - NOT A LEAP YEAR
DPM366   MVI   DPM+3,29            CHANGE FEB TO 29 DAYS
DPM365   EQU   *
         LA    R14,2               INDEX FOR DPM
         LR    R0,R14              INDEX INCREMENT
         L     R1,DDDB             DAY OF YEAR
DPMLOOP  CH    R1,DPM-2(R14)       DAY LESS THAN OR EQ ENTRY?
         BE    DPMEND              EQUAL - BRANCH
         BL    DPMWIN              LESS - BRANCH
         SH    R1,DPM-2(R14)       NO, SUBTRACT ENTRY FROM DAY
         ALR   R14,R0              ADD 2 TO INDEX
         B     DPMLOOP             LOOP
DPMEND   MVI   FRSTLAST+3,2        LAST DAY OF MONTH
         B     DPMCOMM
DPMWIN   CH    R1,=H'1'            FIRST OF MONTH?
         BNE   DPMCOMM             NO - BRANCH
         MVI   FRSTLAST+3,1        FIRST DAY OF MONTH
DPMCOMM  SRL   R14,1               HALVE INDEX TO GET MM
         ST    R1,DDB              SAVE DD BINARY
         CVD   R1,DOUBLE           CONVERT TO PACKED
         OI    DOUBLE+7,X'0F'      SET SIGN
         UNPK  DDC,DOUBLE+6(2)     SAVE DD CHAR
         ST    R14,MMB             SAVE MM BINARY
         CVD   R14,DOUBLE          CONVERT TO PACKED
         OI    DOUBLE+7,X'0F'      SET SIGN
         UNPK  MMC,DOUBLE+6(2)     SAVE MM CHAR
         MVI   SLASH1,C'/'
         MVI   SLASH2,C'/'
         BR    R9
         SPACE
*              CONVERT MONTH NUMBER TO MONTH NAME
*
*                 INPUT  - MMB     (ALSO DDC AND YYC FOR MOVE)
*
*                 OUTPUT - MONTH AND ALPHA
         SPACE
TOMON    L     R15,MMB
         MH    R15,=H'9'           MULT BY 9
         LA    R15,ALPHAMON-9(R15) ADDRESS OF ENTRY
         MVC   MONTH,0(R15)        SAVE PROSE MONTH
         MVC   ALPHA+2(3),0(R15)   SAVE ALPHA MONTH
         MVC   ALPHA(2),DDC
         MVC   ALPHA+5(2),YYC
         MVI   ALPHA+7,C' '
         BR    R9
         SPACE
*              BUILD PROSE DATE
*
*                 INPUT  - MONTH, DDC, YYYYC
         SPACE
TOPROSE  TM    3(R5),OUT016
         BZR   R9
         MVI   PROSE,C' '
         MVC   PROSE+1(L'PROSE-1),PROSE
         MVC   PROSE(9),MONTH
         LA    R1,PROSE+9
PROSE01  CLI   0(R1),C' '          BLANK?
         BNE   PROSE02             NO - FOUND LAST LETTER
         BCT   R1,PROSE01          BACK UP AND BRANCH
PROSE02  MVC   2(2,R1),DDC
         CLI   2(R1),C'0'          LEADING ZERO?
         BNE   PROSE03             NO - BRANCH
         MVC   2(1,R1),3(R1)       YES - SHIFT
         MVI   3(R1),C' '
         BCTR  R1,0
PROSE03  EQU   *
*        MVI   4(R1),C','          COMMA AFTER DAY
*        LA    R1,1(,R1)           ADD 1 FOR COMMA
         MVC   5(4,R1),YYYYC
         CLC   5(2,R1),=C'00'
         BNE   *+10
         MVC   5(2,R1),=C'19'
         BR    R9
         SPACE
*              INPUT IS YYYY/MM/DD BINARY
         SPACE
INP02    L     R1,INPUT
         CVD   R1,DOUBLE           GET 0000000Y YYYMMDDF
         LM    R14,R15,DOUBLE
         NC    DOUBLE,=X'0000000000000FFF' ISOLATE 00000DDF
         CVB   R1,DOUBLE
         ST    R1,DDB
         OI    DOUBLE+7,X'0F'
         UNPK  DDC,DOUBLE+6(2)
*
         STM   R14,R15,DOUBLE
         NC    DOUBLE,=X'00000000000FF00F' ISOLATE 000MM00F
         L     R1,DOUBLE+4
         SRL   R1,8
         ST    R1,DOUBLE+4
         OI    DOUBLE+7,X'0F'
         CVB   R1,DOUBLE
         CH    R1,=H'12'
         BNH   *+8
         LA    R1,13               SET ALL BAD MONTHS TO 13
         ST    R1,MMB
         UNPK  MMC,DOUBLE+6(2)
*
         SRDL  R14,4               GET YYYYMMDD
         SLR   R14,R14             GET 00000000 IN R14
         SRL   R15,12              GET 000YYYYM IN R15
         STM   R14,R15,DOUBLE
         OI    DOUBLE+7,X'0F'
         CVB   R1,DOUBLE
         ST    R1,YYYYB
         CH    R1,=H'99'
         BH    *+8
         AH    R1,=H'1900'
         ST    R1,CENTB
         UNPK  YYYYC,DOUBLE+5(3)
         MVC   YYC,YYYYC+2
         MVI   SLASH1,C'/'
         MVI   SLASH2,C'/'
*
         BAL   R9,TOSB
         BAL   R9,TOJUL
         BAL   R9,TOMON
         BAL   R9,TOPROSE
         BAL   R9,TOWEEK
         BAL   R9,TOTIME
         BAL   R9,OUTPUT
         B     EXIT0
         SPACE
*              CONVERT M/D/Y TO JULIAN
*
*                 INPUT  - MMB, DDB, YYYYB
*
*                 OUTPUT - DDDB, DDDC, JB
         SPACE
TOJUL    MVC   DPM(26),DAYSPMON
         TM    YYYYB+3,B'00000011' IS YEAR A MULTIPLE OF 4?
         BNZ   JUL365              NO - BRANCH
         CLC   YYC,=C'00'          DIVISIBLE BY 100?
         BNE   JUL366              NO - BRANCH
         L     R15,CENTB
         SLR   R14,R14
         D     R14,=F'400'
         LTR   R14,R14             EVENLY DIVISIBLE BY 400?
         BNZ   JUL365              NO - NOT A LEAP YEAR
JUL366   MVI   DPM+3,29             CHANGE FEB TO 29 DAYS
JUL365   EQU   *
         L     R15,DDB              GET DAYS IN CURRENT MONTH
         LR    R0,R15               SAVE IT TO COMPARE FOR LAST DAY
         L     R14,MMB              GET CURRENT MONTH
         BCTR  R14,0                GET NO. OF COMPLETED MONTHS
         LA    R1,DPM
         LTR   R14,R14              JANUARY?
         BNP   JULEND               YES - BRANCH
         B     *+8
JULOOP   LA    R1,2(,R1)            POINT TO NEXT MONTH
         AH    R15,0(,R1)           ADD DAYS IN MONTH TO TOTAL
         BCT   R14,JULOOP
JULEND   CH    R0,0(,R1)            LAST DAY OF MONTH?
         BNE   *+8                  NO
         MVI   FRSTLAST+3,2         YES
         CH    R0,=H'1'             FIRST DAY OF MONTH?
         BNE   *+8                  NO
         MVI   FRSTLAST+3,1         YES
         ST    R15,DDDB             SAVE DDD
         CVD   R15,DOUBLE
         OI    DOUBLE+7,X'0F'       SET SIGN
         UNPK  DDDC,DOUBLE+4(4)     SAVE DDD CHAR
         MVC   JC(2),YYC
         PACK  DOUBLE,JC
         CVB   R1,DOUBLE
         ST    R1,JB
         BR    R9
         SPACE
*
*
*
         SPACE
TOSB     MVC   WORK(4),YYYYC
         MVC   WORK+4(2),MMC
         MVC   WORK+6(2),DDC
         PACK  DOUBLE,WORK(8)
         CVB   R1,DOUBLE
         ST    R1,SB
         BR    R9
         SPACE
*              GET DAY OF WEEK
*
*                 INPUT  - MMB, DDB, YYYYB
*
*                 OUTPUT - WEEKB, WEEKC
*
*              N = D + 2M + 3(M+1)/5 + Y + Y/4 - Y/100 + Y/400 + 2
*
*                 WHERE M = 3-14 (JAN,FEB ARE 13,14 OF Y-1)
*
*                 N/7 LEAVES REMAINDER 0-6, 0 INDICATING SATURDAY
*
TOWEEK   TM    3(R5),OUT064+OUT128
         BZR   R9
         L     R1,DDB              SET N = D
         L     R15,CENTB
         L     R14,MMB
         CH    R14,=H'2'           JAN OR FEB?
         BH    WEEKMMOK
         BE    WEEKFEB
         LA    R14,13              SET M=13
         B     WEEKYMIN
WEEKFEB  LA    R14,14              SET M=14
WEEKYMIN BCTR  R15,0               SET Y = Y-1
WEEKMMOK LR    R0,R14              COPY M
         ALR   R0,R0               GET 2M
         ALR   R1,R0               SET N = N + 2M
         LR    R0,R15              SAVE REDEFINED Y
         SPACE
         LA    R14,1(,R14)         GET M+1
         MH    R14,=H'3'           GET 3(M+1)
         SRDL  R14,32              SHIFT INTO R15, ZERO R14
         D     R14,=F'5'           GET 3(M+1)/5 IN R15
         ALR   R1,R15              SET N = N + 3(M+1)/5
         SPACE
         LR    R15,R0              GET Y
         ALR   R1,R15              SET N = N + Y
         SLR   R14,R14             ZERO R14
         D     R14,=F'4'           GET Y/4
         ALR   R1,R15              SET N = N + Y/4
         SPACE
         LR    R15,R0              GET Y
         SLR   R14,R14             ZERO R14
         D     R14,=F'100'         GET Y/100
         SLR   R1,R15              SET N = N - Y/100
         SPACE
         LR    R15,R0              GET Y
         SLR   R14,R14             ZERO R14
         D     R14,=F'400'         GET Y/400
         ALR   R1,R15              SET N = N + Y/400
         LA    R15,2               GET 2
         ALR   R1,R15              SET N = N + 2
         SLR   R0,R0               ZERO R0
         D     R0,=F'7'            SET N = N/7
         ST    R0,WEEKB            SAVE REMAINDER
         LR    R1,R0
         MH    R1,=H'9'
         LA    R14,WEEKDAYS(R1)    POINT TO NAME
         MVC   WEEKC(9),0(R14)     MOVE NAME
         MVC   WEEKC+9(3),WEEKBLNK PLUS 3 BLANKS
         BR    R9
         SPACE
*
*              CONVERT TIMEB TO TIMEC
*
*                 DIVIDE BY 10,10,10,6,10,6,10,6
*
TOTIME   TM    2(R5),OUT512
         BNOR  R9
         L     R15,TIMEB
         LA    R6,10               INITIAL DIVISOR
         LA    R7,12               SET DIVISOR MASK
         LA    R8,32               SHIFT COUNT
DECLOOP  SR    R14,R14
         DR    R14,R6
         LR    R0,R14              SAVE REMAINDER
         SRDL  R0,4                SHIFT INTO R1
         SH    R8,=H'4'            DECREMENT SHIFT COUNT
         LTR   R15,R15             QUOTIENT ZERO?
         BZ    TOTIMX              YES - BRANCH
         CL    R8,=F'24'           IF COUNT LT 24
         BNL   DECLOOP             NO - BRANCH
         XR    R6,R7               10 TO 6 TO 10 ETC
         B     DECLOOP
TOTIMX   SRL   R1,0(R8)            SHIFT REMAINING BITS
         SRL   R1,4                GET 0HHMMSST
         ST    R1,DOUBLE
         OI    DOUBLE+3,X'0F'
         MVC   DOUBLE+6(10),=X'402120204B20204B2020'
         ED    DOUBLE+6(10),DOUBLE
         MVC   TIMEC,DOUBLE+8
         BR    R9
         SPACE
OUTPUT   LR    R1,R4
         TM    3(R5),OUT001
         BZ    *+14
         MVC   0(4,R1),JB
         LA    R1,4(,R1)
         TM    3(R5),OUT002
         BZ    *+14
         MVC   0(4,R1),SB
         LA    R1,4(,R1)
         TM    3(R5),OUT004
         BZ    *+14
         MVC   0(8,R1),SC
         LA    R1,8(,R1)
         TM    3(R5),OUT008
         BZ    *+14
         MVC   0(8,R1),ALPHA
         LA    R1,8(,R1)
         TM    3(R5),OUT016
         BZ    *+14
         MVC   0(L'PROSE,R1),PROSE
         LA    R1,L'PROSE(,R1)
         TM    3(R5),OUT032
         BZ    *+14
         MVC   0(4,R1),FRSTLAST
         LA    R1,4(,R1)
         TM    3(R5),OUT064
         BZ    *+14
         MVC   0(4,R1),WEEKB
         LA    R1,4(,R1)
         TM    3(R5),OUT128
         BZ    *+14
         MVC   0(12,R1),WEEKC
         LA    R1,12(,R1)
         TM    2(R5),OUT256
         BZ    *+14
         MVC   0(4,R1),TIMEB
         LA    R1,4(,R1)
         TM    2(R5),OUT512
         BZ    *+14
         MVC   0(8,R1),TIMEC
         LA    R1,8(,R1)
         BR    R9
         SPACE
EXIT0    SR    15,15
EXIT     LR    1,13
         L     13,4(,13)
         ST    15,16(,13)
*        FREEMAIN R,A=(1),LV=@DATAL  (COMMENT)
         LM    14,12,12(13)
         BR    14
         SPACE
************************************************************
*                                                          *
*        CONSTANTS                                         *
*                                                          *
************************************************************
         SPACE
DAYSPMON DC    H'31,28,31,30,31,30,31,31,30,31,30,31,999'
ALPHAMON DC    CL36'JANUARY  FEBRUARY MARCH    APRIL    '
         DC    CL36'MAY      JUNE     JULY     AUGUST   '
         DC    CL36'SEPTEMBEROCTOBER  NOVEMBER DECEMBER '
         DC    CL09'UNKNOWN  '
WEEKDAYS DC    CL36'SATURDAY SUNDAY   MONDAY   TUESDAY  '
         DC    CL27'WEDNESDAYTHURSDAY FRIDAY   '
WEEKBLNK EQU   WEEKDAYS+15         3 BLANKS
         LTORG
         SPACE
************************************************************
*                                                          *
*        DSECTS                                            *
*                                                          *
************************************************************
         SPACE
@DATA    DSECT
         DS    18F
INPUT    DS    CL8
DOUBLE   DS    D
WORK     DS    8C
SC       DS    0CL8
MMC      DS    CL2
SLASH1   DS    C
DDC      DS    CL2
SLASH2   DS    C
YYC      DS    CL2
YYYYC    DS    CL4
DDB      DS    F
MMB      DS    F
YYYYB    DS    F
CENTB    DS    F
DDDB     DS    F
JB       DS    F
SB       DS    F
WEEKB    DS    F
FRSTLAST DS    F
TIMEB    DS    F
TIMEC    DS    CL8
JC       DS    0CL5
         DS    CL2
DDDC     DS    CL3
MONTH    DS    CL9
ALPHA    DS    0CL8
         DS    CL2
MON      DS    CL3
         DS    CL2
         DS    CL1                 BLANK FILLER LAST BYTE OF ALPHA
WEEKC    DS    CL12
PROSE    DS    CL20
DPM      DS    13H
@DATAL   EQU   *-@DATA
         SPACE
INP001   EQU   1
INP002   EQU   2
INP003   EQU   3
OUT001   EQU   1
OUT002   EQU   2
OUT004   EQU   4
OUT008   EQU   8
OUT016   EQU   16
OUT032   EQU   32
OUT064   EQU   64
OUT128   EQU   128
OUT256   EQU   1
OUT512   EQU   2
         SPACE
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         SPACE 3
         END
