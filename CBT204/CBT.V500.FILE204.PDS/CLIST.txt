./ ADD NAME=BATCH    0103-91149-91151-1453-00026-00024-00000-DMV0016
PROC 1 CMD PARMA() PARMB() PARMC() PARMD() PARME()
/*********************************************************************/
/*                                                                   */
/* LIB: CLIST(BATCH)                                                 */
/* GDE: INSTALLATION/MIGRATION/CONVERSION TEAM.                      */
/* DOC: THIS CLIST INVOKES ISPF IN BATCHMODE.                        */
/*                                                                   */
/*********************************************************************/
    CONTROL NOFLUSH MSG MAIN END(ENDO)
    WRITE
    WRITE LIB: CLIST(ISPBATCH)
    WRITE GDE: INSTALLATION/MIGRATION/CONVERSION TEAM
    WRITE DOC: THIS CLIST INVOKES ISPF IN BATCH MODE.
    WRITE
    GETSYSID
    WRITE SYSTEM&STR(:)&SYSID
    WRITE CMD=&NRSTR(&CMD)
    WRITE PARMA=&NRSTR(&PARMA)
    WRITE PARMB=&NRSTR(&PARMB)
    WRITE PARMC=&NRSTR(&PARMC)
    WRITE PARMD=&NRSTR(&PARMD)
    WRITE PARME=&NRSTR(&PARME)
    WRITE
    ISPSTART CMD(&CMD &PARMA &PARMB &PARMC &PARMD &PARME)
    WRITE EXITING WITH CC=&MAXCC
    EXIT CODE(&MAXCC)
./ ADD NAME=BCKSYSC1 0108-91143-92170-1536-00080-00078-00000-SXSCSC
PROC 0                             /* SUBMIT GLOBAL AND DLIB JOB   */
/*                                                                 */
/* LIB: CLIST(BCKSYSC1)                                            */
/* GDE: K. TOMIAK                                                  */
/* DOC: THIS CLIST TAILORS THE JOB TO BACKUP THE SMPGL1 AND        */
/*      SMPDL1 VOLUMES.                                            */
/*                                                                 */
/* SETUP ERROR HANDLING PROCESSING                                 */
/*                                                                 */
    CONTROL NOCONLIST NOLIST NOFLUSH END(ENDO) MAIN CAPS
    ISPEXEC CONTROL ERRORS RETURN
    ISPEXEC VGET (EDITIT DLV GLV JNM RN)
/*                                                                 */
/* GET SYSTEM ID USING REXX EXEC                                   */
/*                                                                 */
    %GETSYSID
    ISPEXEC VGET (SYSID)
/*                                                                 */
/* REMOVE LEADING ZEROES ON LEVEL                                  */
/*                                                                 */
    SET &DLV = &DLV
    SET &GLV = &GLV
    SET &LV  = &DLV
    ISPEXEC VPUT (DLV GLV LV)
/*                                                                 */
/* CHECK FOR EXISTING BACKUP BASED ON LEVEL                        */
/*                                                                 */
    CONTROL MSG
    SET &SYSOUTTRAP = 500
    LISTCAT ENTRIES('SMPE.BACKUP.LVL&LV..SMPDL1') NONVSAM
    SET &MYCC = &LASTCC
    SET &SYSOUTTRAP = 0
    CONTROL NOMSG
    IF (&MYCC = 0) THEN +
      SET &BACKUP = N                                                       0010
    ELSE +
      DO
        SET &BACKUP = Y                                                     0010
        SET &OLDLV = &LV - 5                                                0010
      ENDO
/*                                                                 */
/* TAILOR THE JCL                                                  */
/*                                                                 */
    ISPEXEC VPUT (BACKUP) SHARED
    ISPEXEC FTOPEN TEMP
    SET &MYCC = &LASTCC
    ISPEXEC FTINCL BCKSYSS1
    SET &MYCC = &LASTCC.&MYCC
    ISPEXEC FTCLOSE
    SET &MYCC = &LASTCC.&MYCC
    IF (&MYCC NE 0) THEN +
      DO
        SET &ZERRHM   = &STR(*)                                             0010
        SET &ZERRALRM = &STR(NO)                                            0010
        SET &ZERRSM   = &STR(TAILORING FAILED)                              0010
        SET &ZERRLM   = &STR(FILE TAILORING FAILED WITH                     0010
        SET &ZERRLM   = &STR(&ZERRLM RC=&MYCC)                              0010
        ISPEXEC VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED                 0010
        ISPEXEC SETMSG MSG(ISRZ002)                                         0010
        EXIT CODE(0)
      ENDO
    ISPEXEC VGET ZTEMPF
/*                                                                 */
/* EDIT ????????????????????????????????????????                   */
/*                                                                 */
    IF (&EDITIT = Y) THEN +
      DO
        ISPEXEC EDIT DATASET('&ZTEMPF')
      ENDO
/*                                                                 */
/* SUBMIT JCL                                                      */
/*                                                                 */
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
/*                                                                 */
/* WRAP IT UP                                                      */
/*                                                                 */
    EXIT CODE(0)
./ ADD NAME=BCKSYSC2 0103-91144-91149-1119-00085-00078-00000-DMV0016
PROC 0                             /* SUBMIT GLOBAL JOB            */
/*                                                                 */
/* LIB: CLIST(BCKSYSC2)                                            */
/* GDE: K. TOMIAK                                                  */
/* DOC: THIS CLIST TAILORS THE JOB TO BACKUP THE SMPGL1 VOLUME.    */
/*                                                                 */
/* SETUP ERROR HANDLING PROCESSING                                 */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) MAIN CAPS
    ISPEXEC CONTROL ERRORS RETURN
    ISPEXEC VGET (EDITIT LV)
/*                                                                 */
/* GET SYSTEM ID USING REXX EXEC                                   */
/*                                                                 */
    %GETSYSID
    ISPEXEC VGET (SYSID)
/*                                                                 */
/* REMOVE LEADING ZEROES ON LEVEL                                  */
/*                                                                 */
    SET &LV = &LV
    ISPEXEC VPUT (LV)
/*                                                                 */
/* CHECK FOR EXISTING BACKUP BASED ON LEVEL                        */
/*                                                                 */
    CONTROL MSG
    SET &SYSOUTTRAP = 500
    LISTCAT ENTRIES('SMPE.BACKUP.LVL&LV..SMPGL1') NONVSAM
    SET &MYCC = &LASTCC
    SET &SYSOUTTRAP = 0
    CONTROL NOMSG
    IF (&MYCC = 0) THEN +
      DO
        SET &ZERRHM = &STR(*)                                               0002
        SET &ZERRALRM = &STR(NO)                                            0003
        SET &ZERRSM = &STR(NOT ALLOWED)                                     0004
        SET &ZERRLM = &STR(LEVEL &LV HAS ALREADY BEEN BACKED UP)            0005
        ISPEXEC VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED                 0007
        ISPEXEC SETMSG MSG(ISRZ002)                                         0008
        EXIT CODE(4)                                                        0010
      ENDO
    ELSE +
      DO
        SET &BACKUP = Y                                                     0010
        SET &OLDLV = &LV - 5                                                0010
      ENDO
/*                                                                 */
/* TAILOR THE JCL                                                  */
/*                                                                 */
    ISPEXEC VPUT (BACKUP) SHARED
    ISPEXEC FTOPEN TEMP
    SET &MYCC = &LASTCC
    ISPEXEC FTINCL BCKSYSS2
    SET &MYCC = &LASTCC.&MYCC
    ISPEXEC FTCLOSE
    SET &MYCC = &LASTCC.&MYCC
    IF (&MYCC NE 0) THEN +
      DO
        SET &ZERRHM = &STR(*)                                               0010
        SET &ZERRALRM = &STR(NO)                                            0010
        SET &ZERRSM = &STR(TAILORING FAILED)                                0010
        SET &ZERRLM = &STR(FILE TAILORING FAILED WITH                       0010
        SET &ZERRLM = &STR(&ZERRLM RC=&MYCC)                                0010
        ISPEXEC VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED                 0010
        ISPEXEC SETMSG MSG(ISRZ002)                                         0010
        EXIT CODE(0)
      ENDO
    ISPEXEC VGET ZTEMPF
/*                                                                 */
/* EDIT ????????????????????????????????????????                   */
/*                                                                 */
    IF (&EDITIT = Y) THEN +
      DO
        ISPEXEC EDIT DATASET('&ZTEMPF')
      ENDO
/*                                                                 */
/* SUBMIT JCL                                                      */
/*                                                                 */
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
/*                                                                 */
/* WRAP IT UP                                                      */
/*                                                                 */
    EXIT CODE(0)
./ ADD NAME=BCKSYSC3 0100-91149-91149-1342-00061-00061-00000-DMV0016
PROC 0                             /* SUBMIT TARGET LOG JOB        */
/*                                                                 */
/* LIB: CLIST(BCKSYSC3)                                            */
/* GDE: K. TOMIAK                                                  */
/* DOC: THIS CLIST TAILORS THE JOB TO BACKUP THE TARGETS LOGS.     */
/*                                                                 */
/* SETUP ERROR HANDLING PROCESSING                                 */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) MAIN CAPS
    ISPEXEC CONTROL ERRORS RETURN
    ISPEXEC VGET (EDITIT LV TGTVOL)
/*                                                                 */
/* GET SYSTEM ID USING REXX EXEC                                   */
/*                                                                 */
    %GETSYSID
    ISPEXEC VGET (SYSID)
/*                                                                 */
/* REMOVE LEADING ZEROES ON LEVEL                                  */
/*                                                                 */
    SET &LV = &LV
    ISPEXEC VPUT (LV)
/*                                                                 */
/* TAILOR THE JCL                                                  */
/*                                                                 */
    ISPEXEC VPUT (BACKUP) SHARED
    ISPEXEC FTOPEN TEMP
    SET &MYCC = &LASTCC
    ISPEXEC FTINCL BCKSYSS3
    SET &MYCC = &LASTCC.&MYCC
    ISPEXEC FTCLOSE
    SET &MYCC = &LASTCC.&MYCC
    IF (&MYCC NE 0) THEN +
      DO
        SET &ZERRHM = &STR(*)                                               0010
        SET &ZERRALRM = &STR(NO)                                            0010
        SET &ZERRSM = &STR(TAILORING FAILED)                                0010
        SET &ZERRLM = &STR(FILE TAILORING FAILED WITH                       0010
        SET &ZERRLM = &STR(&ZERRLM RC=&MYCC)                                0010
        ISPEXEC VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED                 0010
        ISPEXEC SETMSG MSG(ISRZ002)                                         0010
        EXIT CODE(0)
      ENDO
    ISPEXEC VGET ZTEMPF
/*                                                                 */
/* EDIT ????????????????????????????????????????                   */
/*                                                                 */
    IF (&EDITIT = Y) THEN +
      DO
        ISPEXEC EDIT DATASET('&ZTEMPF')
      ENDO
/*                                                                 */
/* SUBMIT JCL                                                      */
/*                                                                 */
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
/*                                                                 */
/* WRAP IT UP                                                      */
/*                                                                 */
    EXIT CODE(0)
./ ADD NAME=BR       0100-91247-91247-1506-00022-00022-00000-DMV0016
PROC 1 DATASET
/*                                                                 */
/* LIB: TECHSERV.SYSPROC(BR)                                       */
/* GDE: IBM CONVERSION/MIGRATION/IMPLEMENTATION TEAM.              */
/* DOC: THIS CLIST INVOKES THE ISPF BROWSE.                        */
/*                                                                 */
    CONTROL NOLIST FLUSH END(ENDO)
    ISPEXEC CONTROL ERRORS RETURN
AGAIN: +
    SET &APOST = &SUBSTR(1:1,&DATASET)
    IF (&APOST = &STR(')) THEN +
      DO
        SET &DATASETL = &LENGTH(&DATASET)
        SET &DATASETL = &DATASETL - 1
        SET &DATASETE = &SUBSTR(2:&DATASETL,&DATASET)
      ENDO
    ELSE +
      DO
        SET &DATASETE = &DATASET
      ENDO
    ISPEXEC BROWSE DATASET('&DATASETE')
    EXIT CODE(&MAXCC)
./ ADD NAME=COPYDSN  0102-91221-91221-0858-00116-00113-00006-DMV0016
/*****************COPYDSN - REXX EXEC*********************************/
/*                                                                  */
/* LIB: CLIST(COPYDSN)                                              */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC USES THE TSO LISTDSI COMMAND.                     */
/*                                                                  */
/*****************COPYDSN - REXX EXEC*********************************/
/**********************************************************/
/* CHECK USER AUTHORIZATION FIRST                         */
/**********************************************************/
    CALL CHECK
    MYCC = RC
    IF (MYCC = DISALLOW) THEN
      DO
        SAY 'AUTHORIZATION CHECKING FAILED FOR 'MYUID'/'MYGRP'.'
        EXIT 4
      END
    IF (MYCC = WARNING) THEN
      DO
        SAY 'OKAY THIS TIME, BUT YOU SHOULD CONTACT ME.'
        PULL RESPONSE
      END
    "ISPEXEC LIBDEF ISPPLIB DATASET('XSYS.MVSESA.PANELS')"

/**********************************************************/
/* ALLOW USER TO CONTINUE                                 */
/**********************************************************/
    SAVERC = 0
    DO WHILE SAVERC = 0
      "ISPEXEC DISPLAY PANEL(COPYDSN)"
      SAVERC = RC
      IF (SAVERC = 0) THEN CALL CHCKVOL
    END

    EXIT 0

/**********************************************************/
/**********************************************************/
/* INTERNAL SUBROUTINES                                   */
/**********************************************************/
/**********************************************************/

/**********************************************************/
/* CHECK: CHECKS FOR MVS SYSTEMS PROGRAMMERS BY GROUP OR  */
/*        SPECIFIC USERID                                 */
/**********************************************************/

CHECK:
/**********************************************************/
/* COLLECT TSO USERID AND RACF GROUP                      */
/**********************************************************/
    MYUID = SYSVAR(SYSUID)
    X = OUTTRAP(SYSOUTLINE,12)
    "LISTGRP"
    X = OUTTRAP(OFF)
    MYLEN = LENGTH(SYSOUTLINE1)
    MYBEGIN = MYLEN - 8
    MYBEGIN = INDEX(SYSOUTLINE1,' ',MYBEGIN)
    MYGRP = SUBSTR(SYSOUTLINE1,MYBEGIN,8)
/**********************************************************/
/* USER CHECKING                                          */
/**********************************************************/
    IF (MYUID = JOEF) THEN
       RETURN 'ALLOW'
    IF (MYUID = DMV0016) THEN
       RETURN 'WARNING'
/**********************************************************/
/* GROUP CHECKING                                         */
/**********************************************************/
    IF (MYGRP = DMV00) THEN
       RETURN 'ALLOW'
    IF (MYGRP = CSCMVS) THEN
       RETURN 'ALLOW'
/**********************************************************/
/* UNKNOWN OR NOT ALLOWED                                 */
/**********************************************************/
    RETURN 'DISALLOW'

/**********************************************************/
/* CHCKVOL: DO TSO LISTDSI TO GET CATALOGED VOLSER        */
/**********************************************************/

CHCKVOL:
    X = LISTDSI("'"COPYDSN"'" DIRECTORY)
    DEVSER   = SYSVOLUME
    DEVTYPE  = SYSUNIT
    DSORG    = SYSDSORG
    RECFM    = SYSRECFM
    LRECL    = SYSLRECL
    BLK      = SYSBLKSIZE
    KEYLEN   = SYSKEYLEN
    ALLOC    = SYSALLOC
    USED     = SYSUSED
    DEVPRI   = SYSPRIMARY
    DEVSEC   = SYSSECONDS
    DEVALC   = SYSUNITS
    IF (SYSUNITS = 'TRACK') THEN DEVALC = 'TRK'
    IF (SYSUNITS = 'CYLINDER') THEN DEVALC = 'CYL'
    EXTENTS  = SYSEXTENTS
    CREATE   = SYSCREATE
    REFDATE  = SYSREFDATE
    EXDATE   = SYSEXDATE
    PASSWORD = SYSPASSWORD
    RACFA    = SYSRACFA
    UPDATED  = SYSUPDATED
    TRKSCYL  = SYSTRKSCYL
    BLKSTRK  = SYSBLKSTRK
    DEVDIR   = SYSADIRBLK
    UDIRBLK  = SYSUDIRBLK
    MEMBERS  = SYSMEMBERS
    REASON   = SYSREASON
    MSGLVL1  = SYSMSGLVL1
    MSGLVL2  = SYSMSGLVL2
    "ISPEXEC VPUT(DEVSER DEVTYPE DEVALC DEVPRI DEVSEC DEVDIR) SHARED"
    "ISPEXEC VPUT(DSORG RECFM BLK LRECL) SHARED"
    RETURN 0
./ ADD NAME=COPYNEW  0109-91182-91193-1020-00075-00012-00000-DMV0016
PROC 3 NEWNAME OLDNAME VOLSER
 /*                                                      */
 /* LIB: XSYS.MVSESA.CLIST(COPYNEW)                      */
 /* GDE: KENNETH E. TOMIAK                               */
 /* DOC: ALLOCATE NEW DATASET WITH OLD ATTRIBUTES.       */
 /*                                                      */
BEGIN: +
    CONTROL NOLIST NOMSG END(ENDO) NOFLUSH
    DELETE  '&NEWNAME'
    LISTDSI '&OLDNAME' DIRECTORY
    SET &ORG = &SYSDSORG
    SET &FM  = &SYSRECFM
    SET &BLK = &SYSBLKSIZE
    SET &REC = &SYSLRECL
    SET &PRI = &SYSPRIMARY
    SET &SEC = &SYSSECONDS
    SET &DIR = &SYSADIRBLK
    SET &VOL = &SYSVOLUME
    SET &UNT = &SYSBLKSIZE
    SET &LSTORG = &SYSDSORG
    SET &LSTFM  = &SYSRECFM
    SET &LSTBLK = &SYSBLKSIZE
    SET &LSTREC = &SYSLRECL
    SET &LSTPRI = &SYSPRIMARY
    SET &LSTSEC = &SYSSECONDS
    SET &LSTDIR = &SYSADIRBLK
    SET &LSTUDIR = &SYSUDIRBLK
    SET &LSTVOL = &SYSVOLUME
    SET &LSTUNT = &SYSUNITS
    SET &LSTUSED = &SYSUSED
    SET &LSTEXT = &SYSEXTENTS
    SET &LSTMEM = &SYSMEMBERS
    IF (&SYSUNITS = CYLINDER) THEN SET &UNT = &SYSUNITS
    IF (&SYSUNITS = TRACK) THEN SET &UNT = &SYSUNITS
    SET &ORG = &STR(DSORG=&ORG)&STR(,)
    SET &FM  = &STR(RECFM=&FM)&STR(,)
    SET &BLK = &STR(BLKSIZE=&BLK)&STR(,)
    SET &REC = &STR(LRECL=&REC)
    SET &PRI = &SYSPRIMARY
    SET &SEC = &SYSSECONDS
    SET &DIR = &SYSADIRBLK
    SET &USED = &SYSUSED
    IF (&SYSUNITS = BLOCK) THEN +
      DO
        SET &UNT = TRACK
        SET &USED = 55840 / &SYSBLKSIZE
      ENDO
    SET &MYRECFM =
    IF (&LENGTH(&SYSRECFM) GT 0) THEN +
      DO
        SET &MYRECFM = &SUBSTR(1:1,&SYSRECFM)
      ENDO
    IF (&LENGTH(&SYSRECFM) GT 1) THEN +
      DO
        SET &MYRECFM = &SUBSTR(1:1,&SYSRECFM)
        SET &MYRECFM = &STR(&MYRECFM &SUBSTR(2:2,&SYSRECFM))
      ENDO
    SET &ASA = OFF
    IF (&LENGTH(&SYSRECFM) GT 2) THEN +
      DO
        SET &ASA = ON
        SET &MYRECFM = &SUBSTR(1:1,&SYSRECFM)
        SET &MYRECFM = &STR(&MYRECFM &SUBSTR(2:2,&SYSRECFM))
        SET &MYRECFM = &STR(&MYRECFM &SUBSTR(3:3,&SYSRECFM))
      ENDO
    CONTROL LIST MSG
    ALLOC FILE(TEMPDD) +
        BLKSIZE(&SYSBLKSIZE) +
        LRECL(&SYSLRECL) +
        DATASET('&NEWNAME') NEW CATALOG +
        RECFM(&MYRECFM) +
        SPACE(&USED &SEC) &UNT      +
        DIR(&SYSADIRBLK) +
        UNIT(3390) VOLUME(&VOLSER)
    EXIT CODE(0)
./ ADD NAME=DOCBKP   0103-91149-91150-1349-00023-00023-00002-DMV0016
PROC 5 SRCVOL REALVOL MEMBER LV GLV
/*                                                                 */
/* LIB: XSYS.MVSESA.CLIST(DOCBKP)                                  */
/* GDE: IBM INSTALLATION/CONVERSION/MIGRATION TEAM                 */
/* DOC: THIS CLIST DOCUMENTS A BACKUP SCENARIO.                    */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) NOMSG MAIN ASIS
/*  CONTROL LIST SYMLIST CONLIST MSG
    ISPEXEC CONTROL ERRORS RETURN
    %GETSYSID
    SET &PDSMBR = &STR(&MEMBER)
    SET &DSN = XSYS.MVSESA.CHANGES
    ISPEXEC VPUT (SRCVOL REALVOL LV GLV) SHARED
    SET &MAXCC = 0
    ISPEXEC EDIT DATASET('&DSN(&PDSMBR)') +
      MACRO(DOCBKPM)
    SET &MYCC = &MAXCC
    IF (&MYCC > 4) THEN +
      DO
        SET &PDSDSN = &NRSTR(&DSN(&PDSMBR))&STR(, RC=&MYCC)
        WRITE &NRSTR(&PDSDSN)
      ENDO
    EXIT CODE(&MAXCC)
./ ADD NAME=DOCBKPM  0115-91149-92020-1459-00077-00072-00000-DMV0016
ISREDIT MACRO
/*********************************************************************/
/*                                                                   */
/* LIB: XSYS.MVSESA.CLIST(DOCBKPM)                                   */
/* GDE: INSTALLATION/MIGRATION/CONVERSION TEAM                       */
/* DOC: THIS EDIT MACRO UPDATES THE CHANGES MEMBER FOR BACKUPS.      */
/*                                                                   */
/*********************************************************************/
    CONTROL NOFLUSH NOMSG END(ENDO) NOLIST
/*  CONTROL LIST CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    ISPEXEC VGET (SRCVOL REALVOL LV GLV)
    SET &MM = &SUBSTR(1:2,&SYSDATE)
    SET &DD = &SUBSTR(4:5,&SYSDATE)
    SET &YY = &SUBSTR(7:8,&SYSDATE)
    SET &IPLTIM = &SUBSTR(1:5,&SYSTIME)
    SET &NEWDASH = &STR(-------- ------- -------- -----)
    SET &NEWDASH = &STR(&NEWDASH -----------------------------------)
    SET &NEWDASH = &STR(&NEWDASH.-----)
    WRITE &NRSTR(&NEWDASH)
    ISREDIT F '----- --' FIRST
    SET &MYCC = &LASTCC
    ISREDIT (ROW,COL) = CURSOR
    SET &ROW = &ROW
    SET &WHAT = &STR(SMPE.BACKUP.LVL&LV..&SRCVOL)
    IF (&STR(&SRCVOL) = GLOBAL) THEN +
      SET &WHAT = &STR(SMPE.BACKUP.LVL&LV..SMPGL1.GLV&GLV)
    CONTROL MSG
    SET &SYSOUTTRAP = 50
    LISTCAT ENTRY('&WHAT') ALL
    SET &MYCC = &LASTCC
    SET &SYSOUTTRAP = 0
    CONTROL NOMSG
    SET &LNCTR = &SYSOUTLINE - 1
    DO WHILE &LNCTR > 6
      SET &NEWLINE = &&SYSOUTLINE&LNCTR
      SET &NEWLINE = &SUBSTR(1:35,&NEWLINE)
      SET &NEWLINE = &STR(                              &NEWLINE)
      WRITE &NEWLINE
      ISREDIT LINE_BEFORE &ROW = DATALINE '&NEWLINE'
      SET &MYCC = &LASTCC
      SET &LNCTR = &LNCTR - 1
    ENDO
    SET &NEWLINE = &SUBSTR(1:8,&SYSUID        )
    SET &NEWLINE = &STR(&NEWLINE &NEWLINE)
    SET &NEWLINE = &STR(&NEWLINE.&MM./&DD./&YY )
    SET &NEWLINE = &STR(&NEWLINE.&IPLTIM)
    SET &NEWLINE = &STR(&NEWLINE BACKUP OF &REALVOL AT LEVEL &LV)
    ISREDIT LINE_BEFORE &ROW = DATALINE '&NEWLINE'
    SET &MYCC = &LASTCC
    WRITE &NRSTR(&NEWLINE)
    ISREDIT LINE_BEFORE &ROW = DATALINE '&NEWDASH'
    SET &MYCC = &LASTCC
    WRITE &NRSTR(&NEWDASH)
    ISREDIT SAVE
    SET &MYCC = &LASTCC
    ISPEXEC  CONTROL SUBTASK CLEAR
    IF (&MYCC ¬= 0) THEN +
      DO
        ISREDIT (DATASET) = DATASET
        %Z &DATASET
        SET &MYCC = &LASTCC
        IF (&MYCC ¬= 0) THEN +
          DO
            WRITE COMPRESS FAILED, ABORT IPL DOCUMENTOR
            ISREDIT CANCEL                                                  0060
            EXIT CODE(20)
          ENDO
        ISREDIT SAVE
        SET &MYCC = &LASTCC
      ENDO
    IF (&MYCC ¬= 0) THEN +
      DO
        ISREDIT CANCEL
      ENDO
    ISREDIT END
    EXIT CODE(&MAXCC)
./ ADD NAME=DOCTGT   0101-91149-91149-1401-00023-00023-00001-DMV0016
PROC 3 INRES OTRES LV
/*                                                                 */
/* LIB: XSYS.MVSESA.CLIST(DOCTGT)                                  */
/* GDE: IBM INSTALLATION/CONVERSION/MIGRATION TEAM                 */
/* DOC: THIS CLIST DOCUMENTS A CLONE PROCESS.                      */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) NOMSG MAIN ASIS
/*  CONTROL LIST SYMLIST CONLIST MSG
    ISPEXEC CONTROL ERRORS RETURN
    %GETSYSID
    SET &PDSMBR = &STR(CLONES)
    SET &DSN = XSYS.MVSESA.CHANGES
    ISPEXEC VPUT (INRES OTRES LV) SHARED
    SET &MAXCC = 0
    ISPEXEC EDIT DATASET('&DSN(&PDSMBR)') +
      MACRO(DOCTGTM)
    SET &MYCC = &MAXCC
    IF (&MYCC > 4) THEN +
      DO
        SET &PDSDSN = &NRSTR(&DSN(&PDSMBR))&STR(, RC=&MYCC)
        WRITE &NRSTR(&PDSDSN)
      ENDO
    EXIT CODE(&MAXCC)
./ ADD NAME=DOCTGTM  0102-91149-92020-1459-00058-00073-00000-DMV0016
ISREDIT MACRO
/*********************************************************************/
/*                                                                   */
/* LIB: XSYS.MVSESA.CLIST(DOCTGTM)                                   */
/* GDE: INSTALLATION/MIGRATION/CONVERSION TEAM                       */
/* DOC: THIS EDIT MACRO UPDATES THE CHANGES MEMBER FOR CLONES.       */
/*                                                                   */
/*********************************************************************/
    CONTROL NOFLUSH NOMSG END(ENDO) NOLIST
/*  CONTROL LIST CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    ISPEXEC VGET (INRES OTRES LV)
    SET &MM = &SUBSTR(1:2,&SYSDATE)
    SET &DD = &SUBSTR(4:5,&SYSDATE)
    SET &YY = &SUBSTR(7:8,&SYSDATE)
    SET &IPLTIM = &SUBSTR(1:5,&SYSTIME)
    SET &NEWDASH = &STR(-------- ------- -------- -----)
    SET &NEWDASH = &STR(&NEWDASH -----------------------------------)
    SET &NEWDASH = &STR(&NEWDASH.-----)
    ISREDIT F '&NEWDASH' FIRST
    SET &MYCC = &LASTCC
    ISREDIT (ROW,COL) = CURSOR
    SET &ROW = &ROW
    SET &NEWLINE = &SUBSTR(1:8,&SYSUID        )
    SET &NEWLINE = &STR(&NEWLINE &NEWLINE)
    SET &NEWLINE = &STR(&NEWLINE.&MM./&DD./&YY )
    SET &NEWLINE = &STR(&NEWLINE.&IPLTIM)
    SET &NEWLINE = &STR(&NEWLINE CLONE &OTRES FROM &INRES LEVEL &LV)
    ISREDIT LINE_BEFORE &ROW = DATALINE '&NEWLINE'
    SET &MYCC = &LASTCC
    ISREDIT LINE_BEFORE &ROW = DATALINE '&NEWDASH'
    SET &MYCC = &LASTCC
    WRITE &NRSTR(&NEWDASH)
    WRITE &NRSTR(&NEWLINE)
    WRITE &NRSTR(&NEWDASH)
    ISREDIT SAVE
    SET &MYCC = &LASTCC
    ISPEXEC  CONTROL SUBTASK CLEAR
    IF (&MYCC ¬= 0) THEN +
      DO
        ISREDIT (DATASET) = DATASET
        %Z &DATASET
        SET &MYCC = &LASTCC
        IF (&MYCC ¬= 0) THEN +
          DO
            WRITE COMPRESS FAILED, ABORT IPL DOCUMENTOR
            ISREDIT CANCEL                                                  0060
            EXIT CODE(20)
          ENDO
        ISREDIT SAVE
        SET &MYCC = &LASTCC
      ENDO
    IF (&MYCC ¬= 0) THEN +
      DO
        ISREDIT CANCEL
      ENDO
    ISREDIT END
    EXIT CODE(&MAXCC)
./ ADD NAME=DUPES    0100-91273-91273-1124-00051-00051-00000-DMV0016
ISREDIT MACRO
/*                                                                 */
/* LIB: CLIST(DUPES)                                               */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS MACRO EXCLUDES DUPLICATE LINES.                       */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) NOMSG
/*  CONTROL LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    ISREDIT (TOPLINE,COL) = CURSOR
    ISREDIT CURSOR = .ZLAST &COL
    ISREDIT (LASTLINE,COL) = CURSOR
    SET &DUP = 0
    SET &CTR = 1
    DO WHILE &CTR < &LASTLINE
      ISREDIT (LINEA) = LINE &CTR
      SET &COMPA = &SUBSTR(1:72,&STR(&LINEA))
      SET &CTR = &CTR + 1
      IF (&CTR > 9) THEN +
        CONTROL NOLIST NOMSG NOCONLIST NOSYMLIST
      ISREDIT (LINEB) = LINE &CTR
      SET &COMPB = &SUBSTR(1:72,&STR(&LINEB))
      IF (&NRSTR(&COMPA) = &NRSTR(&COMPB)) THEN +
        DO
          SET &DUP = &DUP + 1
          ISREDIT X "&COMPB" FIRST
          SET &MYCC = &LASTCC
        ENDO
    ENDO
/*                                                                 */
    IF (&DUP = 0) THEN +
      DO
        SET &ZERRHM = &STR(*)                                               0002
        SET &ZERRALRM = &STR(NO)                                            0003
        SET &ZERRSM = &STR(NO DUPES)                                        0004
        SET &ZERRLM = &STR(OKAY, YOU ARE THE DUPE)                          0005
        ISPEXEC VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED                 0007
        ISPEXEC SETMSG MSG(ISRZ002)                                         0008
      ENDO
    ELSE +
      DO
        SET &ZERRHM = &STR(*)                                               0002
        SET &ZERRALRM = &STR(YES)                                           0003
        SET &ZERRSM = &STR(&DUP DUPES)                                      0004
        SET &ZERRLM = &STR(THERE ARE &DUP DUPES)                            0005
        ISPEXEC VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED                 0007
        ISPEXEC SETMSG MSG(ISRZ002)                                         0008
      ENDO
/*                                                                 */
    ISREDIT CURSOR = &TOPLINE 1
    EXIT CODE(1)
./ ADD NAME=ED       0100-91148-91148-1156-00024-00024-00000-DMV0016
PROC 1 DATASET MAC()
/*                                                                 */
/* LIB: TECHSERV.SYSPROC(ED)                                       */
/* GDE: IBM CONVERSION/MIGRATION/IMPLEMENTATION TEAM.              */
/* DOC: THIS CLIST INVOKES THE ISPF EDITOR.                        */
/*                                                                 */
    CONTROL NOLIST FLUSH END(ENDO)
    ISPEXEC CONTROL ERRORS RETURN
AGAIN: +
    SET &APOST = &SUBSTR(1:1,&DATASET)
    IF (&APOST = &STR(')) THEN +
      DO
        SET &DATASETL = &LENGTH(&DATASET)
        SET &DATASETL = &DATASETL - 1
        SET &DATASETE = &SUBSTR(2:&DATASETL,&DATASET)
      ENDO
    ELSE +
      DO
        SET &DATASETE = &DATASET
      ENDO
    SET &MACRO = &STR()
    IF (&NRSTR(&MAC) NE ) THEN SET &MACRO = &NRSTR(MACRO(&MAC))
    ISPEXEC EDIT DATASET('&DATASETE') &MACRO
    EXIT CODE(&MAXCC)
./ ADD NAME=FONTCOMP 0104-91233-91234-1244-00237-00090-00162-DMV0016
/* REXX                                                               */
/* ****************************************************************** */
/*                                                                    */
/* LIB: REXX(FONTCOMP)                                                */
/* GDE: KENNETH E. TOMIAK                                             */
/* DOC: Compare font libraries to find missing fonts.                 */
/*                                                                    */
/* ****************************************************************** */
/*  TRACE Result                                                      */
CLEAR
/* ****************************************************************** */
/* Setup ISPF services.                                               */
/* ****************************************************************** */
"ISPEXEC CONTROL ERRORS RETURN";
/* ****************************************************************** */
/* Allocate libraries.                                                */
/* ****************************************************************** */
"ISPEXEC LMINIT DATAID(RESLIB),
                DATASET('SYS1.FONTLIBB'),
                ENQ(SHRW)"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    SAY 'LMINIT RESLIB RC=' RCSAVE;
    exit(4)
  end
"ISPEXEC LMINIT DATAID(FLIB1),
                DATASET('SYS1.FONTLIB'),
                VOLUME(MRS001),
                ENQ(SHRW)"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    "ISPEXEC LMFREE DATAID(&RESLIB)"
    SAY 'LMINIT FLIB1  RC=' RCSAVE;
    exit(4)
  end
"ISPEXEC LMINIT DATAID(FLIB2),
                DATASET('SYS1.FONTLIBB'),
                VOLUME(MRS001),
                ENQ(SHRW)"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    "ISPEXEC LMFREE DATAID(&RESLIB)"
    "ISPEXEC LMFREE DATAID(&FLIB1)"
    SAY 'LMINIT FLIB2  RC=' RCSAVE;
    exit(4)
  end
"ISPEXEC LMINIT DATAID(FLIB3),
                DATASET('CSC.FONTLIB'),
                ENQ(SHRW)"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    "ISPEXEC LMFREE DATAID(&RESLIB)"
    "ISPEXEC LMFREE DATAID(&FLIB1)"
    "ISPEXEC LMFREE DATAID(&FLIB2)"
    SAY 'LMINIT FLIB3  RC=' RCSAVE;
    exit(4)
  end
"ISPEXEC LMINIT DATAID(FLIB4),
                DATASET('CSC.FONTLIBB'),
                ENQ(SHRW)"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    "ISPEXEC LMFREE DATAID(&RESLIB)"
    "ISPEXEC LMFREE DATAID(&FLIB1)"
    "ISPEXEC LMFREE DATAID(&FLIB2)"
    "ISPEXEC LMFREE DATAID(&FLIB3)"
    SAY 'LMINIT FLIB2  RC=' RCSAVE;
    exit(4)
  end
/* ****************************************************************** */
/* Open the RESLIB.                                                   */
/* ****************************************************************** */
"ISPEXEC LMOPEN DATAID(&RESLIB) OPTION(INPUT)"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    "ISPEXEC LMFREE DATAID(&RESLIB)"
    "ISPEXEC LMFREE DATAID(&FLIB1)"
    SAY 'LMOPEN RESLIB RC=' RCSAVE;
    exit(4)
  end
/* ****************************************************************** */
/* Open the FLIB1.                                                    */
/* ****************************************************************** */
"ISPEXEC LMOPEN DATAID(&FLIB1) OPTION(INPUT)"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    "ISPEXEC LMFREE DATAID(&RESLIB)"
    "ISPEXEC LMFREE DATAID(&FLIB1)"
    "ISPEXEC LMFREE DATAID(&FLIB2)"
    "ISPEXEC LMFREE DATAID(&FLIB3)"
    "ISPEXEC LMFREE DATAID(&FLIB4)"
    SAY 'LMOPEN FLIB1  RC=' RCSAVE;
    exit(4)
  end
/* ****************************************************************** */
/* Open the FLIB2.                                                    */
/* ****************************************************************** */
"ISPEXEC LMOPEN DATAID(&FLIB2) OPTION(INPUT)"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    "ISPEXEC LMFREE DATAID(&RESLIB)"
    "ISPEXEC LMFREE DATAID(&FLIB1)"
    "ISPEXEC LMFREE DATAID(&FLIB2)"
    "ISPEXEC LMFREE DATAID(&FLIB3)"
    "ISPEXEC LMFREE DATAID(&FLIB4)"
    SAY 'LMOPEN FLIB2  RC=' RCSAVE;
    exit(4)
  end
/* ****************************************************************** */
/* Open the FLIB3.                                                    */
/* ****************************************************************** */
"ISPEXEC LMOPEN DATAID(&FLIB3) OPTION(INPUT)"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    "ISPEXEC LMFREE DATAID(&RESLIB)"
    "ISPEXEC LMFREE DATAID(&FLIB1)"
    "ISPEXEC LMFREE DATAID(&FLIB2)"
    "ISPEXEC LMFREE DATAID(&FLIB3)"
    "ISPEXEC LMFREE DATAID(&FLIB4)"
    SAY 'LMOPEN FLIB3  RC=' RCSAVE;
    exit(4)
  end
/* ****************************************************************** */
/* Open the FLIB4.                                                    */
/* ****************************************************************** */
"ISPEXEC LMOPEN DATAID(&FLIB4) OPTION(INPUT)"
RCSAVE = RC
IF (RCSAVE \= 0) THEN
  do
    "ISPEXEC LMFREE DATAID(&RESLIB)"
    "ISPEXEC LMFREE DATAID(&FLIB1)"
    "ISPEXEC LMFREE DATAID(&FLIB2)"
    "ISPEXEC LMFREE DATAID(&FLIB3)"
    "ISPEXEC LMFREE DATAID(&FLIB4)"
    SAY 'LMOPEN FLIB4  RC=' RCSAVE;
    exit(4)
  end
/**********************************************************/
/* ALLOCATE OUTPUT                                        */
/**********************************************************/
    "ALLOC FILE(OUTDD) DSNAME(SDSF) OLD REUSE"
    MYCC = RC
    IF (MYCC \= 0) THEN
      DO
        SAY 'ALLOC OF OUTDD FAILED RC='MYCC
        EXIT 4
      END
    ELSE
     NOP
    PUSH '  COPY INDD=((SYSUTA,R)),OUTDD=SYSUTC              '
    PUSH '//SYSIN    DD  * '
    PUSH '//SYSUT4   DD  UNIT=SYSALLDA,SPACE=(TRK,(1,5))     '
    PUSH '//SYSUT3   DD  UNIT=SYSALLDA,SPACE=(TRK,(1,5))     '
    PUSH '//SYSUTC   DD  DISP=SHR,DSN=CSC.USER.FONTLIB       '
    PUSH '//SYSUTB   DD  DISP=SHR,DSN=SYS1.FONTLIBB          '
    PUSH '//SYSUTA   DD  DISP=SHR,DSN=SYS1.FONTLIB           '
    PUSH '//SYSPRINT DD  SYSOUT=* '
    PUSH '//S01#01  EXEC PGM=IEBCOPY,REGION=2048K,TIME=1200'
    PUSH '//*'
    PUSH '//* DOC: RECATALOG SINGLE IMAGE SYSRES DATASETS.'
    PUSH '//* GDE: XXXX-XXXX ACCESS METHOD SERVICES '
    PUSH '//* LIB: GENERATED BY REXX.EXEC(RESIN) '
    PUSH '//*'
    PUSH '//             NOTIFY=DMV0016'
    PUSH '//             MSGCLASS=V,CLASS=V,     '
    PUSH '//DMV0016$ JOB (A006,SYTM),''ROOM28: K.TOMIAK'', '
    "EXECIO 17 DISKW OUTDD"
/* ****************************************************************** */
/* Obtain the member list one entry at a time.                        */
/* ****************************************************************** */
SPACE  = ' '
PDSMBR = ''
rclist = 0
DO while RCLIST = 0
  "ISPEXEC LMMLIST DATAID(&RESLIB) OPTION(LIST),
                 MEMBER(PDSMBR) STATS(NO)"
  RCLIST = RC
  IF (RCLIST \= 0) THEN
    do
      "ISPEXEC LMMLIST DATAID(&RESLIB) OPTION(FREE)"
    end
  else
    do
      PDSMBR = STRIP(PDSMBR,T,SPACE)
      "ISPEXEC LMMFIND DATAID(&FLIB1),
                     MEMBER("PDSMBR") STATS(NO)"
      RCSAVE = RC
      IF (RCSAVE \= 0) THEN
        do
          "ISPEXEC LMMFIND DATAID(&FLIB2),
                         MEMBER("PDSMBR") STATS(NO)"
          RCSAVE = RC
          IF (RCSAVE \= 0) THEN
            do
              "ISPEXEC LMMFIND DATAID(&FLIB3),
                             MEMBER("PDSMBR") STATS(NO)"
              RCSAVE = RC
              IF (RCSAVE \= 0) THEN
                do
                  "ISPEXEC LMMFIND DATAID(&FLIB4),
                                 MEMBER("PDSMBR") STATS(NO)"
                  RCSAVE = RC
                  IF (RCSAVE \= 0) THEN
                    do
                      SAY PDSMBR 'will be copied.'
                      PUSH '        SELECT MEMBER=(('PDSMBR',,R))'
                      "EXECIO 1 DISKW OUTDD"
                    End
                End
            End
        End
    end
end
PUSH '/* '
"EXECIO 1 DISKW OUTDD (FINIS"
"FREE FILE(OUTDD)"
"ISPEXEC EDIT DATASET('DMV0016.SDSF')"
"ISPEXEC LMCLOSE DATAID(&RESLIB)"
"ISPEXEC LMFREE DATAID(&RESLIB)"
"ISPEXEC LMCLOSE DATAID(&FLIB1)"
"ISPEXEC LMFREE DATAID(&FLIB1)"
"ISPEXEC LMCLOSE DATAID(&FLIB2)"
"ISPEXEC LMFREE DATAID(&FLIB2)"
"ISPEXEC LMCLOSE DATAID(&FLIB3)"
"ISPEXEC LMFREE DATAID(&FLIB3)"
"ISPEXEC LMCLOSE DATAID(&FLIB4)"
"ISPEXEC LMFREE DATAID(&FLIB4)"
EXIT
./ ADD NAME=GETSYSID 0100-91226-91226-1436-00113-00113-00000-DMV0016
PROC 0
/*********************************************************************/
/*                                                                   */
/* LIB: TECHSERV.SYSPROC(GETSYSID)                                   */
/* GDE: INSTALLATION/MIGRATION/CONVERSION TEAM                       */
/* DOC: THIS CLIST GETS THE SYSTEM ID, IPL VOLUME, DATE AND TIME.    */
/*                                                                   */
/*********************************************************************/
    CONTROL NOFLUSH NOMSG MAIN END(ENDO)
    GETSYSID
    SET &TSOPROC = &SYSPROC
    ISPEXEC VPUT (TSOPROC) PROFILE
    ISPEXEC VPUT (SYSID)
    SET &SYSOUTTRAP = 25
    LISTUSER &SYSUID
    SET &SYSOUTTRAP = 0
    SET &B = 9
    SET &E = 29
    SET &LEN = &LENGTH(&NRSTR(&SYSOUTLINE1))
    IF (&LEN < 8) THEN +
      DO
        SET &PGMR = &STR(NOT A RACF USER)
        GOTO NOPGMR
      ENDO
    SET &EQUAL = &SUBSTR(8:8,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 9
        SET &E = 29
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(9:9,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 10
        SET &E = 30
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(10:10,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 11
        SET &E = 31
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(11:11,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 12
        SET &E = 32
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(12:12,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 13
        SET &E = 33
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(13:13,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 14
        SET &E = 34
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(14:14,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 15
        SET &E = 35
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(15:15,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 16
        SET &E = 36
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(16:16,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 17
        SET &E = 37
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(17:17,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 18
        SET &E = 38
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(18:18,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 19
        SET &E = 39
        GOTO SETPGMR
      ENDO
    SET &EQUAL = &SUBSTR(19:19,&NRSTR(&SYSOUTLINE1))
    IF (&STR(&EQUAL) EQ &STR(=)) THEN +
      DO
        SET &B = 20
        SET &E = 40
        GOTO SETPGMR
      ENDO
SETPGMR: +
    SET &PGMR = &SUBSTR(&B:&E,&NRSTR(&SYSOUTLINE1))
NOPGMR: +
    ISPEXEC VPUT (PGMR)
    EXIT CODE(0)
./ ADD NAME=GTSYSID  0100-91225-91225-1530-00009-00009-00000-DMV0016
/*  REXX : GETSYSID                                                  */
/*  DESCRIPTION:  RETRIEVES THE SYSID FOR THE SYSTEM ENVIRONMENT     */
/*                FOR ISPEXEC DISPLAY                                */
/*-------------------------------------------------------------------*/
ADDRESS ISPEXEC
CVT = STORAGE(10,4)
SMCA = STORAGE(D2X(C2D(CVT)+197),3)
SYSID = STORAGE(D2X(C2D(SMCA)+16),4)
'VPUT (SYSID) SHARED'
./ ADD NAME=HECTOR   0101-91318-91318-1014-00040-00037-00004-DMV0016
ISREDIT MACRO
    CONTROL NOLIST NOMSG END(ENDO) FLUSH ASIS
/*  CONTROL LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
/*
    ISREDIT X 'CLASS=AXB' ALL
    ISREDIT C 'AXB' 'AX' X ALL
/*
    SET &MYCC = &MAXCC
    IF (&MYCC = 0) THEN +
      DO
        SET &CHGIT = &NRSTR(MACRO: MACRO3 COMPLETE)
        ISPEXEC CONTROL DISPLAY LOCK
        ISPEXEC DISPLAY PANEL(PDSMACRO)
        ISPEXEC  CONTROL SUBTASK PROTECT
        ISREDIT SAVE
        SET &MYCC = &LASTCC
        ISPEXEC  CONTROL SUBTASK CLEAR
        IF (&MYCC ¬= 0) THEN +
          DO
            ISREDIT (DATASET) = DATASET
            SET &CHGIT = &NRSTR(COMPRESSING ONCE)
            ISPEXEC CONTROL DISPLAY LOCK
            ISPEXEC DISPLAY PANEL(PDSMACRO)
            %CP &DATASET
            IF (&MYCC ¬= 0) THEN +
              DO
                SET &CHGIT = &NRSTR(COMPRESS FAILED)
                ISPEXEC DISPLAY PANEL(PDSMACRO)
              ENDO
            ISREDIT SAVE
          ENDO
        ISPEXEC VPUT (PDSMBR CHGROWS CHGLINES) SHARED
        ISREDIT END
      ENDO
    IF (&MYCC ¬= 0) THEN +
      DO
        ISREDIT CANCEL
      ENDO
    EXIT CODE(&MAXCC)
./ ADD NAME=IPL      0101-91203-91203-0952-00029-00029-00000-DMV0016
PROC 0
/*********************************************************************/
/*                                                                   */
/* LIB: TECHSERV.SYSPROC(IPL)                                        */
/* GDE: INSTALLATION/MIGRATION/CONVERSION TEAM                       */
/* DOC: THIS CLIST POPS UP AND DISPLAY IPL VOLUME AND DATE.          */
/*                                                                   */
/*********************************************************************/
    CONTROL NOFLUSH NOMSG MAIN
    ISPEXEC CONTROL ERRORS RETURN
    ISPEXEC CONTROL DISPLAY LOCK
    ISPEXEC DISPLAY PANEL(IPL)
    SET &IPLDAY = &STR( )
    CALL 'XSYS.MVSESA.ISPLLIB(LASTIPL)'
    SET &IPLSYS = &SUBSTR(7:10,&NRSTR(&IPLTXT))
    SET &IPLGDT = &SUBSTR(21:40,&NRSTR(&IPLTXT))
    SET &IPLDAY = &SUBSTR(46:57,&NRSTR(&IPLTXT))
    SET &IPLJDT = &SUBSTR(68:73,&NRSTR(&IPLTXT))
    SET &IPLTIM = &SUBSTR(80:84,&NRSTR(&IPLTXT))
    SET &IPLCUA = &SUBSTR(91:93,&NRSTR(&IPLTXT))
    SET &IPLNAME = &SUBSTR(102:107,&NRSTR(&IPLTXT))
    SET &IPLFMID = &SUBSTR(114:122,&NRSTR(&IPLTXT))
    SET &IPLLVL  = &SUBSTR(129:136,&NRSTR(&IPLTXT))
    SET &IPLRLSE = &SUBSTR(146:149,&NRSTR(&IPLTXT))
    SET &IPLIO   = &SUBSTR(161:162,&NRSTR(&IPLTXT))
    SET &IPLNUC  = &SUBSTR(172:172,&NRSTR(&IPLTXT))
    SET &IPLCPU  = &SUBSTR(178:182,&NRSTR(&IPLTXT))
    ISPEXEC DISPLAY PANEL(IPL)
    EXIT CODE(0)
./ ADD NAME=IPLDOC   0103-91225-92363-1108-00073-00065-00009-DMV0016
PROC 0
/*                                                                 */
/* LIB: CLIST(IPLDOC)                                              */
/* GDE: IBM INSTALLATION/CONVERSION/MIGRATION TEAM                 */
/* DOC: THIS CLIST DOCUMENTS AN IPL FOR THE CURRENT SYSTEM.        */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) NOMSG MAIN ASIS
/*  CONTROL LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    GETSYSID
    SET &PDSMBR = &STR($UNKNOWN)
    IF (&SYSID = MVSP) THEN +
      DO
        SET &DSN = CSC.CHANGE.CNTL
        SET &PDSMBR = &STR(MVSP)
      ENDO
    ELSE +
    IF (&SYSID = MVSW) THEN +
      DO
        SET &DSN = CSC.CHANGE.CNTL
        SET &PDSMBR = &STR(MVSW)
      ENDO
    ELSE +
    IF (&SYSID = MVSE) THEN +
      DO
        SET &DSN = CSC.CHANGE.CNTL
        SET &PDSMBR = &STR(MVSE)
      ENDO
    ELSE +
    IF (&SYSID = DOFX) THEN +
      DO
        SET &DSN = DOFX.SYSTEM.CHANGES
        SET &PDSMBR = &STR($DOFX)
      ENDO
    ELSE +
    IF (&SYSID = MVSX) THEN +
      DO
        SET &DSN = MVSX.SYSTEM.CHANGES
        SET &PDSMBR = &STR($MVSX)
      ENDO
    ELSE +
    IF (&SYSID = MVST) THEN +
      DO
        SET &DSN = TECHSERV.BETA.CHANGES
        SET &PDSMBR = &STR($MVST)
      ENDO
    ELSE +
    IF (&SYSID = DOFD) THEN +
      DO
        SET &DSN = SYS2.CDCSA.CHANGES
        SET &PDSMBR = &STR($DOFD)
      ENDO
    ELSE +
    IF (&SYSID = DOFP) THEN +
      DO
        SET &DSN = SYS2.CDCSA.CHANGES
        SET &PDSMBR = &STR($DOFP)
      ENDO
    ELSE +
      DO
        WRITE &STR(***** UNSUPPORTED SYSID=&SYSID *****)
        SET &DSN = CSC.CHANGE.CNTL
        SET &PDSMBR = &STR(&SYSID)
      ENDO
    ISPEXEC EDIT DATASET('&DSN(&PDSMBR)') +
      MACRO(IPLM)
    SET &MYCC = &MAXCC
    IF (&MYCC > 4) THEN +
      DO
        SET &PDSDSN = &NRSTR(&DSN(&PDSMBR))&STR(, RC=&MYCC)
        WRITE &NRSTR(&PDSDSN)
      ENDO
    EXIT CODE(0)
./ ADD NAME=IPLM     0100-91225-91225-1444-00088-00088-00000-DMV0016
ISREDIT MACRO
/*********************************************************************/
/*                                                                   */
/* LIB: TECHSERV.SYSPROC(IPLM)                                       */
/* GDE: INSTALLATION/MIGRATION/CONVERSION TEAM                       */
/* DOC: THIS EDIT MACRO UPDATES THE CHANGES MEMBER FOR IPLS.         */
/*                                                                   */
/*********************************************************************/
    CONTROL NOFLUSH NOMSG END(ENDO) NOLIST
/*  CONTROL LIST CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    LASTIPL
    SET &IPLSYS = &SUBSTR(7:10,&NRSTR(&IPLTXT))
    SET &IPLGDT = &SUBSTR(21:40,&NRSTR(&IPLTXT))
    SET &SYSDVAL = &STR(&IPLGDT)
    READDVAL MONTH DD YY
    IF (&DD < 10) THEN SET DD = &STR(0&DD)
    IF (&MONTH = JANUARY) THEN SET MM = &STR(01)
    IF (&MONTH = FEBRUARY) THEN SET MM = &STR(02)
    IF (&MONTH = MARCH) THEN SET MM = &STR(03)
    IF (&MONTH = APRIL) THEN SET MM = &STR(04)
    IF (&MONTH = MAY) THEN SET MM = &STR(05)
    IF (&MONTH = JUNE) THEN SET MM = &STR(06)
    IF (&MONTH = JULY) THEN SET MM = &STR(07)
    IF (&MONTH = AUGUST) THEN SET MM = &STR(08)
    IF (&MONTH = SEPTEMBER) THEN SET MM = &STR(09)
    IF (&MONTH = OCTOBER) THEN SET MM = &STR(10)
    IF (&MONTH = NOVEMBER) THEN SET MM = &STR(11)
    IF (&MONTH = DECEMBER) THEN SET MM = &STR(12)
    SET &YY = &YY - 1900
    SET &IPLDAY = &SUBSTR(46:57,&NRSTR(&IPLTXT))
    SET &IPLJDT = &SUBSTR(68:73,&NRSTR(&IPLTXT))
    SET &IPLTIM = &SUBSTR(80:84,&NRSTR(&IPLTXT))
    SET &IPLCUA = &SUBSTR(91:93,&NRSTR(&IPLTXT))
    SET &IPLNAME = &SUBSTR(102:107,&NRSTR(&IPLTXT))
    SET &IPLFMID = &SUBSTR(114:122,&NRSTR(&IPLTXT))
    SET &IPLLVL  = &SUBSTR(129:136,&NRSTR(&IPLTXT))
    SET &IPLRLSE = &SUBSTR(146:149,&NRSTR(&IPLTXT))
    SET &IPLIO   = &SUBSTR(161:162,&NRSTR(&IPLTXT))
    SET &IPLNUC  = &SUBSTR(172:172,&NRSTR(&IPLTXT))
    SET &IPLCPU  = &SUBSTR(178:182,&NRSTR(&IPLTXT))
    SET &NEWDASH = &STR(-------- ------- -------- -----)
    SET &NEWDASH = &STR(&NEWDASH -----------------------------------)
    SET &NEWDASH = &STR(&NEWDASH.-----)
    ISREDIT F '&NEWDASH' FIRST
    SET &MYCC = &LASTCC
    ISREDIT (ROW,COL) = CURSOR
    SET &ROW = &ROW
    SET &CHGLINE = &STR(                 )
    SET &CHGLINE = &STR(&CHGLINE.         )
    SET &CHGLINE = &STR(&CHGLINE.     )
    SET &CHGLINE = &STR(&CHGLINE IPL LEVEL ?? ( &IPLNAME - &IPLCUA ) )
    ISREDIT LINE_BEFORE &ROW = DATALINE '&CHGLINE'
    SET &NEWLINE = &STR(OPS      OPS     )
    SET &NEWLINE = &STR(&NEWLINE.&MM./&DD./&YY )
    SET &NEWLINE = &STR(&NEWLINE.&IPLTIM)
    SET &NEWLINE = &STR(&NEWLINE CHG# ----- )
    ISREDIT LINE_BEFORE &ROW = DATALINE '&NEWLINE'
    SET &MYCC = &LASTCC
    ISREDIT LINE_BEFORE &ROW = DATALINE '&NEWDASH'
    SET &MYCC = &LASTCC
    WRITE &NRSTR(&NEWDASH)
    WRITE &NRSTR(&NEWLINE)
    WRITE &NRSTR(&CHGLINE)
    WRITE &NRSTR(&NEWDASH)
    ISREDIT SAVE
    SET &MYCC = &LASTCC
    ISPEXEC  CONTROL SUBTASK CLEAR
    IF (&MYCC ¬= 0) THEN +
      DO
        ISREDIT (DATASET) = DATASET
        %Z &DATASET
        SET &MYCC = &LASTCC
        IF (&MYCC ¬= 0) THEN +
          DO
            WRITE COMPRESS FAILED, ABORT IPL DOCUMENTOR
            ISREDIT CANCEL                                                  0060
            EXIT CODE(20)
          ENDO
        ISREDIT SAVE
        SET &MYCC = &LASTCC
      ENDO
    IF (&MYCC ¬= 0) THEN +
      DO
        ISREDIT CANCEL
      ENDO
    ISREDIT END
    EXIT CODE(&MAXCC)
./ ADD NAME=ISPBATCH 0102-91225-91225-1656-00025-00024-00000-DMV0016
PROC 1 CMD PARMA() PARMB() PARMC()
/*********************************************************************/
/*                                                                   */
/* LIB: CLIST(ISPBATCH)                                              */
/* GDE: INSTALLATION/MIGRATION/CONVERSION TEAM.                      */
/* DOC: THIS CLIST INVOKES ISPF IN BATCHMODE.                        */
/*                                                                   */
/*********************************************************************/
    CONTROL NOFLUSH MSG MAIN END(ENDO)
/*  CONTROL LIST MSG CONLIST SYMLIST
    WRITE
    WRITE LIB: CLIST(ISPBATCH)
    WRITE GDE: INSTALLATION/MIGRATION/CONVERSION TEAM
    WRITE DOC: THIS CLIST INVOKES ISPF IN BATCH MODE.
    WRITE
    GETSYSID
    WRITE SYSTEM&STR(:)&SYSID
    WRITE CMD=&NRSTR(&CMD)
    WRITE PARMA=&NRSTR(&PARMA)
    WRITE PARMB=&NRSTR(&PARMB)
    WRITE PARMC=&NRSTR(&PARMC)
    WRITE
    ISPSTART CMD(&CMD &PARMA &PARMB &PARMC)
    WRITE EXITING WITH CC=&MAXCC
    EXIT CODE(&MAXCC)
./ ADD NAME=LISTCJCL 0100-91158-91158-1059-00099-00099-00000-IBM1
PROC 0
/*                                                                 */
/* LIB: DMV0016.CLIST(UNCATJCL)                                    */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS CLIST READS A PDS MEMBER AND FORMATS IDCAMS           */
/*      DELETE NOSCRATCH CONTROL CARDS.                            */
/*                                                                 */
    CONTROL NOLIST MAIN NOFLUSH END(ENDO)
/*  CONTROL LIST CONLIST SYMLIST
BEGIN: +
    CONTROL NOMSG
    DELETE UNCATJCL
    FREE FILE(UNCATJCL)
    CONTROL MSG
    ALLOC FILE(UNCATJCL) NEW CATALOG +
      DATASET(UNCATJCL) +
      RECFM(F B) BLKSIZE(8000) LRECL(80) +
      SPACE(5 5) TRACKS DSORG(PS) UNIT(SYSALLDA)
    OPENFILE UNCATJCL OUTPUT
    SET &UNCATJCL = &STR(//&SYSUID.A JOB (A006,SYTM,999,9999),        )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//         'ROOM 28 - IBM       ',           )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//         CLASS=V,MSGCLASS=V,REGION=6M,     )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//         NOTIFY=&SYSUID                    )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//* )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//*        JOB GENERATED: &SYSDATE &SYSTIME )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//* )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//IDCAMS01 EXEC  PGM=IDCAMS                 )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//SYSPRINT DD  SYSOUT=* )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//SYSIN    DD  *        )
    PUTFILE UNCATJCL
    SET &SPACES = &STR(                                            )
ALCVTOC: +
    ALLOC FILE(VTOCSIZE) DATASET('XSYS.MVSESA.CNTL(VTOCLST3)') +
          SHR REUSE
OPENVTOC: +
    OPENFILE VTOCSIZE INPUT
    SET &MYCAT =
GETVTOC: +
    ERROR GOTO CLOSVTOC
    GETFILE VTOCSIZE
    ERROR OFF
    SET &MYLEN = &LENGTH(&STR(&VTOCSIZE))
    IF (&MYLEN < 43) THEN GOTO GETVTOC
    SET &MYDSN = &SUBSTR(2:30,&STR(&VTOCSIZE))
    SET &MYCHK = &SUBSTR(1:1,&STR(&MYDSN))
    IF (&STR(&MYCHK) EQ &STR(-)) THEN GOTO GETVTOC
    IF (&STR(&MYCHK) EQ &STR( )) THEN +
      DO
        SET &TMPCAT = &SUBSTR(44:&MYLEN,&STR(&VTOCSIZE))
        SET &TMPCAT = &TMPCAT
        IF (&STR(&TMPCAT) NE ) THEN SET &MYCAT = &TMPCAT
        GOTO GETVTOC
      ENDO
    SET &MYDSN = &MYDSN
    SET &NEWLEN = &LENGTH(&MYDSN)
    SET &MYMSG = &SUBSTR(31:&MYLEN,&STR(&VTOCSIZE))
    SET &MYEND = &SUBSTR(&NEWLEN,&MYDSN)
    IF (&STR(&MYEND) = &STR(.)) THEN +
      DO
        GETFILE VTOCSIZE
        SET &SUBLEN  = &LENGTH(&STR(&VTOCSIZE))
        SET &MOREDSN = &SUBSTR(4:&SUBLEN,&STR(&VTOCSIZE))
        SET &MOREDSN = &MOREDSN
        SET &MYDSN = &STR(&MYDSN.&MOREDSN)
      ENDO
    SET &UNCATJCL = &STR(    )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(  /* ) &STR(     &MYMSG) &STR(       */ )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(  DEL      &MYDSN - )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(           NSCR - )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(           CAT(&MYCAT) )
    PUTFILE UNCATJCL
    GOTO GETVTOC
CLOSVTOC: +
    ERROR OFF
    SET &MAXCC = 0
    CLOSFILE VTOCSIZE
    SET &UNCATJCL = &STR(/* )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(// )
    PUTFILE UNCATJCL
CLOSRPT: +
    CLOSFILE UNCATJCL
    FREE FILE(UNCATJCL)
    ISPEXEC EDIT DATASET(UNCATJCL)
ISMFEXIT: +
    EXIT CODE(0)
./ ADD NAME=LPALOOK  0101-91218-91218-1454-00076-00076-00001-DMV0016
/* REXX :     LPALOOK                                                */
/* FUNCTION:  FINDS ALL OCCURRENCES OF THE SPECIFIED MODULE IN THE   */
/*            LINKLST CONCATENATION                                  */
/*-------------------------------------------------------------------*/
CLEAR
SAY "LPALST SEARCH ROUTINE"
SAY "-----------------------"
ARG LPALST MODULE .
DO FOREVER
  SELECT
    WHEN LPALST = '' THEN
      SAY 'ENTER THE SUFFIX FOR LPALST'
    WHEN LPALST = 'QUIT' THEN QUIT
    WHEN LENGTH(LPALST) > 2 THEN
      SAY 'SUFFIX MAY NOT BE GREATER THAN 2 CHARACTERS, RE-ENTER'
    ISITOK = SYSDSN("'"SYS1.PARMLIB"(LPALST"LPALST")'")
    WHEN ISITOK \= OK THEN
      SAY 'SYS1.PARMLIB(LPALST'LPALST') NOT FOUND, RE-ENTER'
    OTHERWISE LEAVE
  END
  PULL LPALST
END
DSNMBR = 'SYS1.PARMLIB(LPALST'LPALST')'
  "ALLOC FILE(INPUTDD) DATASET('"DSNMBR"') SHR REUSE"
  MYCC = RC
  IF (MYCC \= 0) THEN
    DO
      SAY 'ALLOC OF MYINPUT FAILED RC='MYCC
      EXIT 4
    END
  ELSE
   NOP
DONE = NO
COMMA = ','
DSN.1 = 'SYS1.LPALIB'
DSN.2 = 'SYS1.SVCLIB'
N = 2
DO WHILE DONE = NO

  /**********************************************************/
  /* PROCESS INPUT                                          */
  /**********************************************************/
    "EXECIO 1 DISKR INPUTDD"
    RCSAVE = RC
    IF (RCSAVE \= 0) THEN
        DO
          DONE = 'YES'
          "EXECIO 0 DISKW INPUTDD (FINIS"
        END
      ELSE
        DO
          PULL RECORD
          N = N + 1
          DSN.N = STRIP(WORD(RECORD,1),T,COMMA)
          IF DSN.N = '/*' THEN N = N - 1
        END
END
DO FOREVER
  SELECT
    WHEN MODULE = '' THEN
      SAY 'ENTER THE NAME OF THE MODULE TO SEARCH FOR'
    WHEN MODULE = 'QUIT' THEN QUIT
    WHEN LENGTH(MODULE) > 8 THEN
      SAY 'MODULE MAY NOT BE GREATER THAN 8 CHARACTERS, RE-ENTER'
    OTHERWISE LEAVE
  END
  PULL MODULE
END
CTR = 0
DO WHILE CTR < N
  CTR = CTR + 1
  Y = SYSDSN("'"DSN.CTR"("MODULE")'")
  X = LEFT(DSN.CTR,44)
  SAY X Y
END
EXIT
./ ADD NAME=MIGSYSCZ 0101-93305-93305-1522-00102-00102-00000-JOEF
PROC 0                             /* SUBMIT SYSRES MIGRATION JOB  */
/*                                                                 */
/* LIB: CLIST(MIGSYSC1)                                            */
/* GDE: J. PERLMAN AND K. TOMIAK                                   */
/* DOC: THIS CLIST TAILORS THE JOB TO CLONE THE SYSRES VOLUME.     */
/*                                                                 */
/* SETUP ERROR HANDLING PROCESSING                                 */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) MAIN CAPS
    ISPEXEC CONTROL ERRORS RETURN
    ISPEXEC VGET (EDITIT LV TRGTVOL TGTSYS)
/*                                                                 */
/* GET SYSTEM ID USING REXX EXEC                                   */
/*                                                                 */
    %GETSYSID
    ISPEXEC VGET (SYSID)
    IF (&STR(&SYSID) NE &STR(&TGTSYS)) THEN +
      DO
        ISPEXEC DISPLAY PANEL(PASSWORD)
        SET &MYCC = &LASTCC
        IF (&MYCC NE 0) THEN +
          EXIT CODE(0)
        IF (&EDITIT NE Y) THEN +
          SET &EDITIT = Y
      ENDO
/*                                                                 */
/* REMOVE LEADING ZEROES ON LEVEL                                  */
/*                                                                 */
    SET &LV = &LV
    ISPEXEC VPUT (LV)
/*                                                                 */
/* CHECK FOR EXISTING BACKUP BASED ON LEVEL                        */
/*                                                                 */
    CONTROL MSG
    SET &SYSOUTTRAP = 500
    LISTCAT ENTRIES('SMPEZ.BACKUP.LVL&LV..SYSRES') NONVSAM
    SET &MYCC = &LASTCC
    SET &SYSOUTTRAP = 0
    CONTROL NOMSG
    IF (&MYCC = 0) THEN +
      SET &BACKUP = N                                                       0010
    ELSE +
      DO
        SET &BACKUP = Y                                                     0010
        SET &OLDLV = &LV - 5                                                0010
      ENDO
/*                                                                 */
/* CHECK FOR OLD ZONE (PRE SINGLE SYSTEM IMAGE)                    */
/*                                                                 */
    SET &OK = &SYSDSN('SMPEZ.T&TRGTVOL..CSI')
    IF (&STR(&OK) = OK) THEN +
      SET &OLDRES = Y                                                       0010
    ELSE +
      SET &OLDRES = N                                                       0010
/*                                                                 */
/* CHECK FOR NEW ZONE                                              */
/*                                                                 */
    SET &OK = &SYSDSN('SMPEZ.&TRGTVOL..CSI')
    IF (&STR(&OK) = OK) THEN +
      SET &NEWRES = N                                                       0010
    ELSE +
      SET &NEWRES = Y                                                       0010
/*                                                                 */
/* TAILOR THE JCL                                                  */
/*                                                                 */
    ISPEXEC VPUT (BACKUP NEWRES) SHARED
    ISPEXEC FTOPEN TEMP
    SET &MYCC = &LASTCC
    ISPEXEC FTINCL MIGSYSSZ
    SET &MYCC = &LASTCC.&MYCC
    ISPEXEC FTCLOSE
    SET &MYCC = &LASTCC.&MYCC
    IF (&MYCC NE 0) THEN +
      DO
        SET &ZERRHM = &STR(*)                                               0010
        SET &ZERRALRM = &STR(NO)                                            0010
        SET &ZERRSM = &STR(TAILORING FAILED)                                0010
        SET &ZERRLM = &STR(FILE TAILORING FAILED WITH                       0010
        SET &ZERRLM = &STR(&ZERRLM RC=&MYCC)                                0010
        ISPEXEC VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED                 0010
        ISPEXEC SETMSG MSG(ISRZ002)                                         0010
        EXIT CODE(0)
      ENDO
    ISPEXEC VGET ZTEMPF
/*                                                                 */
/* EDIT ????????????????????????????????????????                   */
/*                                                                 */
    IF (&EDITIT = Y) THEN +
      DO
        ISPEXEC EDIT DATASET('&ZTEMPF')
      ENDO
/*                                                                 */
/* SUBMIT JCL                                                      */
/*                                                                 */
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
/*                                                                 */
/* WRAP IT UP                                                      */
/*                                                                 */
    EXIT CODE(0)
./ ADD NAME=MIGSYSC1 0117-86213-91247-1256-00102-00008-00000-DMV0016
PROC 0                             /* SUBMIT SYSRES MIGRATION JOB  */
/*                                                                 */
/* LIB: CLIST(MIGSYSC1)                                            */
/* GDE: J. PERLMAN AND K. TOMIAK                                   */
/* DOC: THIS CLIST TAILORS THE JOB TO CLONE THE SYSRES VOLUME.     */
/*                                                                 */
/* SETUP ERROR HANDLING PROCESSING                                 */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) MAIN CAPS
    ISPEXEC CONTROL ERRORS RETURN
    ISPEXEC VGET (EDITIT LV TRGTVOL TGTSYS)
/*                                                                 */
/* GET SYSTEM ID USING REXX EXEC                                   */
/*                                                                 */
    %GETSYSID
    ISPEXEC VGET (SYSID)
    IF (&STR(&SYSID) NE &STR(&TGTSYS)) THEN +
      DO
        ISPEXEC DISPLAY PANEL(PASSWORD)
        SET &MYCC = &LASTCC
        IF (&MYCC NE 0) THEN +
          EXIT CODE(0)
        IF (&EDITIT NE Y) THEN +
          SET &EDITIT = Y
      ENDO
/*                                                                 */
/* REMOVE LEADING ZEROES ON LEVEL                                  */
/*                                                                 */
    SET &LV = &LV
    ISPEXEC VPUT (LV)
/*                                                                 */
/* CHECK FOR EXISTING BACKUP BASED ON LEVEL                        */
/*                                                                 */
    CONTROL MSG
    SET &SYSOUTTRAP = 500
    LISTCAT ENTRIES('SMPE.BACKUP.LVL&LV..SYSRES') NONVSAM
    SET &MYCC = &LASTCC
    SET &SYSOUTTRAP = 0
    CONTROL NOMSG
    IF (&MYCC = 0) THEN +
      SET &BACKUP = N                                                       0010
    ELSE +
      DO
        SET &BACKUP = Y                                                     0010
        SET &OLDLV = &LV - 5                                                0010
      ENDO
/*                                                                 */
/* CHECK FOR OLD ZONE (PRE SINGLE SYSTEM IMAGE)                    */
/*                                                                 */
    SET &OK = &SYSDSN('SMPE.T&TRGTVOL..CSI')
    IF (&STR(&OK) = OK) THEN +
      SET &OLDRES = Y                                                       0010
    ELSE +
      SET &OLDRES = N                                                       0010
/*                                                                 */
/* CHECK FOR NEW ZONE                                              */
/*                                                                 */
    SET &OK = &SYSDSN('SMPE.&TRGTVOL..CSI')
    IF (&STR(&OK) = OK) THEN +
      SET &NEWRES = N                                                       0010
    ELSE +
      SET &NEWRES = Y                                                       0010
/*                                                                 */
/* TAILOR THE JCL                                                  */
/*                                                                 */
    ISPEXEC VPUT (BACKUP NEWRES) SHARED
    ISPEXEC FTOPEN TEMP
    SET &MYCC = &LASTCC
    ISPEXEC FTINCL MIGSYSS1
    SET &MYCC = &LASTCC.&MYCC
    ISPEXEC FTCLOSE
    SET &MYCC = &LASTCC.&MYCC
    IF (&MYCC NE 0) THEN +
      DO
        SET &ZERRHM = &STR(*)                                               0010
        SET &ZERRALRM = &STR(NO)                                            0010
        SET &ZERRSM = &STR(TAILORING FAILED)                                0010
        SET &ZERRLM = &STR(FILE TAILORING FAILED WITH                       0010
        SET &ZERRLM = &STR(&ZERRLM RC=&MYCC)                                0010
        ISPEXEC VPUT (ZERRSM ZERRLM ZERRHM ZERRALRM) SHARED                 0010
        ISPEXEC SETMSG MSG(ISRZ002)                                         0010
        EXIT CODE(0)
      ENDO
    ISPEXEC VGET ZTEMPF
/*                                                                 */
/* EDIT ????????????????????????????????????????                   */
/*                                                                 */
    IF (&EDITIT = Y) THEN +
      DO
        ISPEXEC EDIT DATASET('&ZTEMPF')
      ENDO
/*                                                                 */
/* SUBMIT JCL                                                      */
/*                                                                 */
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
/*                                                                 */
/* WRAP IT UP                                                      */
/*                                                                 */
    EXIT CODE(0)
./ ADD NAME=PDSCHG   0100-91318-91318-1021-00128-00128-00000-DMV0016
PROC 1 DATASET
/*                                                                 */
/* LIB: DMV0016.CLIST(PDSCHG)                                      */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS CLIST RUNS THRU A PDS AND MAKES GLOBAL CHANGES.       */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) NOMSG MAIN ASIS
    ISPEXEC CONTROL ERRORS RETURN
AGAIN: +
    SET &APOST = &SUBSTR(1:1,&DATASET)
    IF (&APOST = &STR(')) THEN +
      DO
        SET &DSNR = &LENGTH(&DATASET)
        SET &DSNR = &DSNR - 1
        SET &DATASETE = &SUBSTR(2:&DSNR,&DATASET)
      ENDO
    ELSE +
      DO
        SET &DATASETE = &DATASET
      ENDO
    SET &DSNL = 1
    SET &DSNR = &LENGTH(&DATASETE)
    SET &RIGHTP = &SUBSTR(&DSNR:&DSNR,&DATASETE)
    IF &RIGHTP = ) THEN +
      DO
        SET &MEML = &DSNR
        SET &LEFTP = N
        DO WHILE &LEFTP ¬= (
          SET &MEML = &MEML - 1
          SET &LEFTP = &SUBSTR(&MEML:&MEML,&DATASETE)
        ENDO
        SET &MEML = &MEML + 1
        SET &MEMR = &DSNR - 1
        SET &DSNR = &MEML - 2
        SET &MEM = &SUBSTR(&MEML:&MEMR,&DATASETE )
      ENDO
    SET &DSN = &SUBSTR(&DSNL:&DSNR,&DATASETE)
    LISTDSI '&DSN'
    IF (&NRSTR(&SYSDSORG) ¬= PO) THEN +
      DO
        SET &ZERRSM = &STR(ERROR BUILDING TABLE)
        SET &ZERRLM = &STR(THE TEMPORARY USER-ENTITY TABLE)
        SET &ZERRLM = &STR(&ZERRLM.WAS NOT CREATED)
        ISPEXEC SETMSG MSG(ISRZ002)
        EXIT CODE(12)
      ENDO
    SET &PDSDSN = &DSN
    ISPEXEC LMINIT DATAID(PDSID) +
      DATASET('&PDSDSN') ENQ(SHR)
    IF (&LASTCC ¬= 0) THEN +
      DO
        SET &ZERRSM = &STR(FILE IN USE)
        SET &ZERRLM = &STR(THE FILE &PDSDSN IS IN USE)
        ISPEXEC SETMSG MSG(ISRZ002)
        GOTO ABNEXIT
      ENDO
    ISPEXEC LMOPEN DATAID(&PDSID) +
      OPTION(INPUT)
    SET &MYCC = &LASTCC
    IF (&MYCC ¬= 0) THEN +
      DO
        SET &ZERRSM = &STR(FILE FAILED TO OPEN)
        SET &ZERRLM = &STR(THE FILE &PDSDSN FAILED TO)
        SET &ZERRLM = &STR(&ZERRLM.OPEN RC=&MYCC)
        ISPEXEC SETMSG MSG(ISRZ002)
        GOTO ABNEXIT
      ENDO
    SET &CHGIT = &STR( )
    ISPEXEC DISPLAY PANEL(PDSCHG)
    IF (&LASTCC ¬= 0) THEN +
      DO
        SET &ZERRSM = &STR(REQUEST CANCELLED)
        SET &ZERRLM = &STR(YOU CANCELLED THE REQUEST TO)
        SET &ZERRLM = &STR(&ZERRLM.MAKE CHANGES)
        ISPEXEC SETMSG MSG(ISRZ002)
        GOTO ABNEXIT
      ENDO
    SET &PDSMBR = &MEMB
PDSREAD: +
    ISPEXEC LMMLIST DATAID(&PDSID) +
      OPTION(LIST) MEMBER(PDSMBR) STATS(YES)
    SET &MYCC = &LASTCC
    IF (&MYCC ¬= 0) THEN +
      DO
        GOTO NORMEXIT
      ENDO
    SET &PDSMBR = &PDSMBR
    IF (&MEME NE ) THEN +
      DO
        IF (&PDSMBR > &MEME) THEN +
          DO
            GOTO NORMEXIT
          ENDO
      ENDO
    IF (&MEMB NE ) THEN +
      DO
        IF (&PDSMBR < &MEMB) THEN +
          DO
            GOTO PDSREAD
          ENDO
      ENDO
    GOTO EDITIT
EDITIT: +
    SET &PDSDSN = &NRSTR(&DSN(&PDSMBR))
    ISPEXEC VPUT (PDSDSN) SHARED
    ISPEXEC CONTROL DISPLAY LOCK
    ISPEXEC DISPLAY PANEL(PDSCHG)
    SET &MAXCC = 0
    ISPEXEC EDIT DATASET('&DSN(&PDSMBR)') +
      MACRO(PDSCHGIT)
    SET &MYCC = &MAXCC
    IF (&MYCC > 4) THEN +
      DO
        SET &PDSDSN = &NRSTR(&DSN(&PDSMBR))&STR(, RC=&MYCC)
        ISPEXEC CONTROL DISPLAY LOCK
        ISPEXEC DISPLAY PANEL(PDSCHG)
      ENDO
    GOTO PDSREAD
ABNEXIT: +
    ISPEXEC LMMLIST DATAID(&PDSID) OPTION(FREE)
    ISPEXEC LMCLOSE DATAID(&PDSID)
    ISPEXEC LMFREE  DATAID(&PDSID)
    EXIT CODE(4)
NORMEXIT: +
    ISPEXEC LMMLIST DATAID(&PDSID) OPTION(FREE)
    ISPEXEC LMCLOSE DATAID(&PDSID)
    ISPEXEC LMFREE      DATAID(&PDSID)
    EXIT CODE(0)
./ ADD NAME=PDSCHGIT 0100-91318-91318-1022-00070-00070-00000-DMV0016
ISREDIT MACRO
    CONTROL NOLIST NOMSG END(ENDO) FLUSH ASIS
    ISPEXEC CONTROL ERRORS RETURN
    ISREDIT CAPS OFF
    ISPEXEC VGET (OLDTXT, NEWTXT, DSN, PDSMBR, PDSDSN, COLB, COLE) ASIS
    SET &PDSDSN = &PDSDSN
    SET &APOST = &SUBSTR(1:1,&NRSTR(&OLDTXT))
    IF (&NRSTR(&APOST) EQ &STR(')) THEN +
      DO
        SET &APOST = &SUBSTR(1:1,&NRSTR(&NEWTXT))
        IF (&NRSTR(&APOST) EQ &STR(')) THEN +
          DO
            ISREDIT C &OLDTXT &NEWTXT &COLB &COLE ALL
            SET &MYCC = &LASTCC
          ENDO
        ELSE +
          DO
            ISREDIT C &OLDTXT '&NEWTXT' &COLB &COLE ALL
            SET &MYCC = &LASTCC
          ENDO
      ENDO
    ELSE +
      DO
        SET &APOST = &SUBSTR(1:1,&NRSTR(&NEWTXT))
        IF (&NRSTR(&APOST) EQ &STR(')) THEN +
          DO
            ISREDIT C '&OLDTXT' &NEWTXT &COLB &COLE ALL
            SET &MYCC = &LASTCC
          ENDO
        ELSE +
          DO
            ISREDIT C '&OLDTXT' '&NEWTXT' &COLB &COLE ALL
            SET &MYCC = &LASTCC
          ENDO
      ENDO
    IF (&MYCC = 0) THEN +
      DO
        ISREDIT (CHGROW,CHGLINE) = CHANGE_COUNTS
        SET &CHGROW = &CHGROW
        SET &CHGLINE = &CHGLINE
        IF (&CHGLINE = 0) THEN SET &CHGLINE = &CHGROW
        SET &CHGIT = &NRSTR(STRINGS: &CHGROW, IN &CHGLINE LINES)
        ISPEXEC CONTROL DISPLAY LOCK
        ISPEXEC DISPLAY PANEL(PDSCHG)
        ISPEXEC  CONTROL SUBTASK PROTECT
        ISREDIT SAVE
        SET &MYCC = &LASTCC
        ISPEXEC  CONTROL SUBTASK CLEAR
        IF (&MYCC ¬= 0) THEN +
          DO
            ISREDIT (DATASET) = DATASET
            SET &CHGIT = &NRSTR(COMPRESSING ONCE)
            ISPEXEC CONTROL DISPLAY LOCK
            ISPEXEC DISPLAY PANEL(PDSCHG)
            %CP &DATASET
            IF (&MYCC ¬= 0) THEN +
              DO
                SET &CHGIT = &NRSTR(COMPRESS FAILED)
                ISPEXEC DISPLAY PANEL(PDSCHG)
              ENDO
            ISREDIT SAVE
          ENDO
        ISPEXEC VPUT (PDSMBR CHGROWS CHGLINES) SHARED
        ISREDIT END
      ENDO
    IF (&MYCC ¬= 0) THEN +
      DO
        ISREDIT CANCEL
      ENDO
    EXIT CODE(&MAXCC)
./ ADD NAME=PDSMACRO 0100-91318-91318-1000-00128-00128-00000-DMV0016
PROC 1 DATASET
/*                                                                 */
/* LIB: DMV0016.CLIST(PDSCHG)                                      */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS CLIST RUNS THRU A PDS AND MAKES GLOBAL CHANGES.       */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) NOMSG MAIN ASIS
    ISPEXEC CONTROL ERRORS RETURN
AGAIN: +
    SET &APOST = &SUBSTR(1:1,&DATASET)
    IF (&APOST = &STR(')) THEN +
      DO
        SET &DSNR = &LENGTH(&DATASET)
        SET &DSNR = &DSNR - 1
        SET &DATASETE = &SUBSTR(2:&DSNR,&DATASET)
      ENDO
    ELSE +
      DO
        SET &DATASETE = &DATASET
      ENDO
    SET &DSNL = 1
    SET &DSNR = &LENGTH(&DATASETE)
    SET &RIGHTP = &SUBSTR(&DSNR:&DSNR,&DATASETE)
    IF &RIGHTP = ) THEN +
      DO
        SET &MEML = &DSNR
        SET &LEFTP = N
        DO WHILE &LEFTP ¬= (
          SET &MEML = &MEML - 1
          SET &LEFTP = &SUBSTR(&MEML:&MEML,&DATASETE)
        ENDO
        SET &MEML = &MEML + 1
        SET &MEMR = &DSNR - 1
        SET &DSNR = &MEML - 2
        SET &MEM = &SUBSTR(&MEML:&MEMR,&DATASETE )
      ENDO
    SET &DSN = &SUBSTR(&DSNL:&DSNR,&DATASETE)
    LISTDSI '&DSN'
    IF (&NRSTR(&SYSDSORG) ¬= PO) THEN +
      DO
        SET &ZERRSM = &STR(ERROR BUILDING TABLE)
        SET &ZERRLM = &STR(THE TEMPORARY USER-ENTITY TABLE)
        SET &ZERRLM = &STR(&ZERRLM.WAS NOT CREATED)
        ISPEXEC SETMSG MSG(ISRZ002)
        EXIT CODE(12)
      ENDO
    SET &PDSDSN = &DSN
    ISPEXEC LMINIT DATAID(PDSID) +
      DATASET('&PDSDSN') ENQ(SHR)
    IF (&LASTCC ¬= 0) THEN +
      DO
        SET &ZERRSM = &STR(FILE IN USE)
        SET &ZERRLM = &STR(THE FILE &PDSDSN IS IN USE)
        ISPEXEC SETMSG MSG(ISRZ002)
        GOTO ABNEXIT
      ENDO
    ISPEXEC LMOPEN DATAID(&PDSID) +
      OPTION(INPUT)
    SET &MYCC = &LASTCC
    IF (&MYCC ¬= 0) THEN +
      DO
        SET &ZERRSM = &STR(FILE FAILED TO OPEN)
        SET &ZERRLM = &STR(THE FILE &PDSDSN FAILED TO)
        SET &ZERRLM = &STR(&ZERRLM.OPEN RC=&MYCC)
        ISPEXEC SETMSG MSG(ISRZ002)
        GOTO ABNEXIT
      ENDO
    SET &CHGIT = &STR( )
    ISPEXEC DISPLAY PANEL(PDSMACRO)
    IF (&LASTCC ¬= 0) THEN +
      DO
        SET &ZERRSM = &STR(REQUEST CANCELLED)
        SET &ZERRLM = &STR(YOU CANCELLED THE REQUEST TO)
        SET &ZERRLM = &STR(&ZERRLM.MAKE CHANGES)
        ISPEXEC SETMSG MSG(ISRZ002)
        GOTO ABNEXIT
      ENDO
    SET &PDSMBR = &MEMB
PDSREAD: +
    ISPEXEC LMMLIST DATAID(&PDSID) +
      OPTION(LIST) MEMBER(PDSMBR) STATS(YES)
    SET &MYCC = &LASTCC
    IF (&MYCC ¬= 0) THEN +
      DO
        GOTO NORMEXIT
      ENDO
    SET &PDSMBR = &PDSMBR
    IF (&MEME NE ) THEN +
      DO
        IF (&PDSMBR > &MEME) THEN +
          DO
            GOTO NORMEXIT
          ENDO
      ENDO
    IF (&MEMB NE ) THEN +
      DO
        IF (&PDSMBR < &MEMB) THEN +
          DO
            GOTO PDSREAD
          ENDO
      ENDO
    GOTO EDITIT
EDITIT: +
    SET &PDSDSN = &NRSTR(&DSN(&PDSMBR))
    ISPEXEC VPUT (PDSDSN) SHARED
    ISPEXEC CONTROL DISPLAY LOCK
    ISPEXEC DISPLAY PANEL(PDSMACRO)
    SET &MAXCC = 0
    ISPEXEC EDIT DATASET('&DSN(&PDSMBR)') +
      MACRO(&MACRO)
    SET &MYCC = &MAXCC
    IF (&MYCC > 4) THEN +
      DO
        SET &PDSDSN = &NRSTR(&DSN(&PDSMBR))&STR(, RC=&MYCC)
        ISPEXEC CONTROL DISPLAY LOCK
        ISPEXEC DISPLAY PANEL(PDSMACRO)
      ENDO
    GOTO PDSREAD
ABNEXIT: +
    ISPEXEC LMMLIST DATAID(&PDSID) OPTION(FREE)
    ISPEXEC LMCLOSE DATAID(&PDSID)
    ISPEXEC LMFREE  DATAID(&PDSID)
    EXIT CODE(4)
NORMEXIT: +
    ISPEXEC LMMLIST DATAID(&PDSID) OPTION(FREE)
    ISPEXEC LMCLOSE DATAID(&PDSID)
    ISPEXEC LMFREE      DATAID(&PDSID)
    EXIT CODE(0)
./ ADD NAME=PSM      0101-91194-91194-2108-00033-00062-00000-DMV0016
PROC 0
/* ****************************************************************** */
/*                                                                    */
/* LIB: CLIST(PSM)                                                    */
/* GDE: SC34-4139-0 ISPF and ISPF/PDF PRIMER                          */
/*      Kenneth E. Tomiak frontend with PSMDD allocated.              */
/* DOC: A Personal Schedule Manager using ISPF services.              */
/*                                                                    */
/* ****************************************************************** */
    CONTROL NOLIST NOFLUSH MAIN NOMSG END(ENDO)
    ISPEXEC CONTROL ERRORS RETURN
/* ****************************************************************** */
/* Allocate profile for individual PSM calendars.                     */
/* ****************************************************************** */
    ALLOC FILE(PSMDD) DATASET(ISPF.ISPPROF) SHR REUSE
/* ****************************************************************** */
 /* DOC: THIS section retrieves the racf user name.                  */
/* ****************************************************************** */
    CONTROL MSG
    SET &SYSOUTTRAP = 25
    LISTUSER &SYSUID
    SET &SYSOUTTRAP = 0
    SET &B = &SYSINDEX(NAME=,&STR(&SYSOUTLINE1))
    SET &B = &B + 5
    SET &E = &B + 20
    SET &PGMR = &SUBSTR(&B:&E,&NRSTR(&SYSOUTLINE1))
    SET &PGMR = &PGMR
    ISPEXEC VPUT (PGMR) PROFILE
/* ****************************************************************** */
/* Select PSM panel so user can make choices.                         */
/* ****************************************************************** */
    ISPEXEC SELECT PANEL(PSM)
    EXIT CODE(0)
./ ADD NAME=PSMXDEL  0101-90186-91194-2051-00065-00061-00000-DMV0016
PROC 0
/* ****************************************************************** */
/*                                                                    */
/* LIB: CLIST(PSMXDEL)                                                */
/* GDE: SC34-4139-0 ISPF and ISPF/PDF PRIMER                          */
/* DOC: A Personal Schedule Manager using ISPF services.              */
/*                                                                    */
/* ****************************************************************** */
    CONTROL NOLIST NOFLUSH MAIN NOMSG END(ENDO)
/*  CONTROL LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
/* ****************************************************************** */
/* Initialization.                                                    */
/* ****************************************************************** */
    SET &MESSAGE = &STR()
    SET &DELETE = &STR()
/* ****************************************************************** */
/* Open the table and exit if it does not exist yet.                  */
/* ****************************************************************** */
    ISPEXEC TBOPEN PSMTABLE LIBRARY(PSMDD)
    SET OPENRC = &LASTCC
    IF (&OPENRC = 8) THEN +
        SET &MESSAGE = PSM006
    ELSE IF (&OPENRC = 0) THEN +
      DO
        SET &MT = &SUBSTR(1:2,&SYSDATE)
        SET &DY = &SUBSTR(4:5,&SYSDATE)
        SET &YR = &SUBSTR(7:8,&SYSDATE)
        ISPEXEC DISPLAY PANEL(PSMDEL)
        IF (&LASTCC = 0) THEN +
          DO
            IF (&STR(&HR) NE &STR()) THEN +
              SET &DELETE = ONE
            IF (&STR(&MN) EQ &STR()) THEN +
              SET &MN = &STR(00)
            SET &FINDRC = 0
            DO WHILE &FINDRC = 0
              IF (&DELETE = ONE) THEN +
               DO
                ISPEXEC TBSCAN PSMTABLE ARGLIST(YR MT DY HR MN)
                SET &FINDRC = &LASTCC
               ENDO
              ELSE +
               DO
                ISPEXEC TBSCAN PSMTABLE ARGLIST(YR MT DY)
                SET &FINDRC = &LASTCC
               ENDO
              IF (&FINDRC = 0) THEN +
                DO
                  ISPEXEC TBDELETE PSMTABLE
                  IF (&LASTCC = 0) THEN +
                    SET &MESSAGE = PSM007
                ENDO
              ELSE IF (&FINDRC = 8) THEN +
                IF (&STR(&MESSAGE) = &STR()) THEN +
                  SET &MESSAGE = PSM009
            ENDO
        ENDO
        ISPEXEC TBCLOSE PSMTABLE LIBRARY(PSMDD)
      ENDO
    IF (&STR(&MESSAGE) NE &STR()) THEN +
      DO
        ISPEXEC SETMSG MSG(&MESSAGE)
      ENDO
    EXIT CODE(0)
./ ADD NAME=PSMXDISP 0101-90186-91194-2053-00048-00048-00000-DMV0016
PROC 0
/* ****************************************************************** */
/*                                                                    */
/* LIB: CLIST(PSMXDISP)                                               */
/* GDE: SC34-4139-0 ISPF and ISPF/PDF PRIMER                          */
/* DOC: A Personal Schedule Manager using ISPF services.              */
/*                                                                    */
/* ****************************************************************** */
    CONTROL NOLIST NOFLUSH MAIN NOMSG END(ENDO)
    ISPEXEC CONTROL ERRORS RETURN
/* ****************************************************************** */
/* Initialization.                                                    */
/* ****************************************************************** */
    SET &MESSAGE = &STR()
/* ****************************************************************** */
/* Open the table and exit if it does not exist yet.                  */
/* ****************************************************************** */
    ISPEXEC TBOPEN PSMTABLE LIBRARY(PSMDD)
    IF (&LASTCC = 8) THEN +
      DO
        SET &MESSAGE = PSM006
      ENDO
    ELSE IF (&LASTCC = 0) THEN +
      DO
        SET &MO = &SUBSTR(1:2,&SYSDATE)
        SET &DA = &SUBSTR(4:5,&SYSDATE)
        SET &YE = &SUBSTR(7:8,&SYSDATE)
        ISPEXEC DISPLAY PANEL(PSMSET)
        IF (&LASTCC NE 0) THEN +
          SET &MESSAGE = PSM008
      ENDO
    IF (&STR(&MESSAGE) = &STR()) THEN +
      DO
        ISPEXEC TBVCLEAR PSMTABLE
        SET &YR = &YE
        SET &MT = &MO
        SET &DY = &DA
        ISPEXEC TBSARG PSMTABLE NAMECOND(YR,EQ,MT,EQ,DY,EQ)
REDOIT: +
        ISPEXEC TBDISPL PSMTABLE PANEL(PSMDAY)
        IF (&LASTCC = 0) THEN GOTO REDOIT
      ENDO
    IF (&STR(&MESSAGE) NE &STR()) THEN +
      DO
        ISPEXEC SETMSG MSG(&MESSAGE)
      ENDO
    ISPEXEC TBCLOSE PSMTABLE LIBRARY(PSMDD)
    EXIT CODE(0)
./ ADD NAME=PSMXENT  0102-90186-91194-2102-00068-00068-00000-DMV0016
PROC 0
/* ****************************************************************** */
/*                                                                    */
/* LIB: CLIST(PSMXENT)                                                */
/* GDE: SC34-4139-0 ISPF and ISPF/PDF PRIMER                          */
/* DOC: A Personal Schedule Manager using ISPF services.              */
/*                                                                    */
/* ****************************************************************** */
    CONTROL NOLIST NOFLUSH MAIN NOMSG END(ENDO)
/*  CONTROL   LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
/* ****************************************************************** */
/* Initialization.                                                    */
/* ****************************************************************** */
    SET &MESSAGE = &STR()
    SET &MT = &SUBSTR(1:2,&SYSDATE)
    SET &DY = &SUBSTR(4:5,&SYSDATE)
    SET &YR = &SUBSTR(7:8,&SYSDATE)
/* ****************************************************************** */
/* Open the table and create one if this is the first usage.          */
/* ****************************************************************** */
    ISPEXEC TBOPEN PSMTABLE LIBRARY(PSMDD)
    IF (&LASTCC = 8) THEN +
      DO
        ISPEXEC TBCREATE PSMTABLE +
          KEYS(YR MT DY HR MN) NAMES(DESC NOTES) +
          LIBRARY(PSMDD)
        ISPEXEC TBSORT PSMTABLE +
          FIELDS(YR,N,A,MT,N,A,DY,N,A,HR,N,A,MN,N,A)
      ENDO
/* ****************************************************************** */
/* Loop until user finishes adding entries.                           */
/* ****************************************************************** */
    SET &DISPRC = 0
    DO WHILE &DISPRC = 0
      ISPEXEC DISPLAY PANEL(PSMDISP)
      SET &DISPRC = &LASTCC
      IF (&DISPRC = 0) THEN +
        DO
          ISPEXEC TBTOP PSMTABLE
          ISPEXEC TBSCAN PSMTABLE ARGLIST(YR,MT,DY,HR,MN)
          IF (&LASTCC = 8) THEN +
            DO
              SET &DESC = &STR()
              SET &NOTES = &STR()
            ENDO
          SET &ENTRC = 0
          DO WHILE &ENTRC = 0
            ISPEXEC DISPLAY PANEL(PSMENT)
            SET &ENTRC = &LASTCC
            IF (&COMMAND = CANCEL) THEN +
              SET &ENTRC = 10
            ELSE IF (&ENTRC = 8) THEN +
              DO
                IF (&MN = ) THEN SET &MN = &STR(00)
                ISPEXEC TBMOD PSMTABLE ORDER
                SET &MODRC = &LASTCC
                IF (&MODRC = 0) OR   +
                   (&MODRC = 8) THEN +
                     SET &MESSAGE = PSM005
              ENDO
          ENDO
        ENDO
      IF (&STR(&MESSAGE) NE &STR()) THEN +
        ISPEXEC SETMSG MSG(&MESSAGE)
    ENDO
    ISPEXEC TBCLOSE PSMTABLE LIBRARY(PSMDD)
    EXIT CODE(0)
./ ADD NAME=PSMXPRT  0101-90186-91194-2055-00058-00058-00000-DMV0016
PROC 0
/* ****************************************************************** */
/*                                                                    */
/* LIB: CLIST(PSMXPRT)                                                */
/* GDE: SC34-4139-0 ISPF and ISPF/PDF PRIMER                          */
/* DOC: A Personal Schedule Manager using ISPF services.              */
/*                                                                    */
/* ****************************************************************** */
    CONTROL NOLIST NOFLUSH MAIN NOMSG END(ENDO)
/*  CONTROL LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
/* ****************************************************************** */
/* To print the activity report.                                      */
/* ****************************************************************** */
    SET &MESSAGE = &STR()
    ISPEXEC TBOPEN PSMTABLE LIBRARY(PSMDD)
    SET &OPENRC = &LASTCC
    IF (&OPENRC = 0) THEN +
      DO
        SET &MO = &SUBSTR(1:2,&SYSDATE)
        SET &DA = &SUBSTR(4:5,&SYSDATE)
        SET &YE = &SUBSTR(7:8,&SYSDATE)
        ISPEXEC DISPLAY PANEL(PSMSET)
        IF (&LASTCC = 0) THEN +
          DO
            SET &MT = &MO
            SET &DY = &DA
            SET &YR = &YE
            ISPEXEC TBSCAN PSMTABLE ARGLIST(YR MT DY) NOREAD
            IF (&LASTCC NE 0) THEN +
              SET &MESSAGE = PSM009
          ENDO
        ELSE +
          SET &MESSAGE = PSM008
        ISPEXEC TBCLOSE PSMTABLE LIBRARY(PSMDD)
      ENDO
    ELSE IF (&OPENRC = 8) THEN +
      SET &MESSAGE = PSM006
    IF (&STR(&MESSAGE) = &STR()) THEN +
      DO
        ISPEXEC FTOPEN TEMP
        ISPEXEC FTINCL PSMXPRT
        ISPEXEC FTCLOSE
        IF (&LASTCC = 0) THEN +
          DO
            SET &MESSAGE = PSM007
            ISPEXEC VGET (ZTEMPN) SHARED
            ISPEXEC LMINIT DATAID(DATAOUT) DDNAME(&ZTEMPN)
            ISPEXEC BROWSE DATAID(&DATAOUT)
            ISPEXEC LMOPEN DATAID(&DATAOUT)
            ISPEXEC LMPRINT DATAID(&DATAOUT) FORMAT(NO)
            ISPEXEC LMCLOSE DATAID(&DATAOUT)
            ISPEXEC LMFREE DATAID(&DATAOUT)
          ENDO
      ENDO
    IF (&STR(&MESSAGE) NE &STR())) THEN +
      ISPEXEC SETMSG MSG(&MESSAGE)
    EXIT CODE(0)
./ ADD NAME=PTD      0113-90191-91211-1211-00238-00243-00000-DMV0016
/* REXX                                                               */
/* ****************************************************************** */
/*                                                                    */
/* LIB: REXX(PTD)                                                     */
/* GDE: SC34-4256-0 ISPF and ISPF/PDF PRIMER                          */
/* DOC: A TelePhone Directory using COMMON USER ACCESS (CUA) or       */
/*      sometimes known as Graphical User Interface (GUI).            */
/*                                                                    */
/* ****************************************************************** */
/* TRACE Result                                                       */

/* ****************************************************************** */
/* Setup ISPF services.                                               */
/* ****************************************************************** */
address ISPEXEC
/* ****************************************************************** */
/* Initialization.  (So the dialog can be started from ISPSTART.)     */
/* ****************************************************************** */
'CONTROL ERRORS RETURN';
'CONTROL NONDISPL ENTER';
'DISPLAY PANEL(ISP@PRIM)';

/* ****************************************************************** */
/* Open the table and clear all table service variables.  Close       */
/* the table.                                                         */
/* ****************************************************************** */
'TBOPEN PTDTABLE LIBRARY(PTDDD)';
IF RC = 0 THEN
  DO
  'TBVCLEAR PTDTABLE';
  'TBCLOSE PTDTABLE LIBRARY(PTDDD)';
  END;

/* ****************************************************************** */
/* Issue an Addpop to display the next panel in  a pop-up window.     */
/* Initialize the return code.                                        */
/* ****************************************************************** */
'ADDPOP ROW(1) COLUMN(1)'
RCODE = 0;

/* ****************************************************************** */
/* Loop until EXIT is entered on the panel display or a user          */
/* requested exit is performed.  Display the entry panel.  Save the   */
/* return code and zverb variables.                                   */
/* ****************************************************************** */
DO WHILE (RCODE < 8),
  & (HLTVAR1 ¬= 'EXIT') & (HLTVAR1 ¬= 'CANCEL')
  HLTVAR1 = ''
  HLTVAR2 = ''
  HLTVAR3 = ''
  HLTVAR4 = ''
  'DISPLAY PANEL(PTDLOGO)';
  RCODE = RC;
  'VGET (ZVERB) SHARED';
  HLTVAR1 = ZVERB;

/* ****************************************************************** */
/* If EXIT or CANCEL was not entered on the panel display or a        */
/* user requested was not performed, continue.                        */
/* ****************************************************************** */
  IF (HLTVAR1 ¬= 'CANCEL') & (HLTVAR1 ¬= 'EXIT') & (RCODE < 8) THEN
    DO
/* ****************************************************************** */
/* Process the action bar choices.                                    */
/* ****************************************************************** */
    IF ZCMD = 'DISENT' THEN
      DO
/* ****************************************************************** */
/* Action bar choice --- DISPLAY.                                     */
/* ****************************************************************** */
      'TBOPEN PTDTABLE LIBRARY(PTDDD)';
      IF RC = 8 THEN
        DO
        'SETMSG MSG(PTDA005) MSGLOC(XOFFICE)';
        ZCMD = 'UPDENT';
        PLLDNCH = 'ADD'
        END;
      ELSE
        'TBCLOSE PTDTABLE LIBRARY(PTDDD)';
      IF ZCMD = 'DISENT' THEN
        DO
        SELECT
          WHEN PLLDNCH = 'ALL' THEN
            DO
            'TBOPEN PTDTABLE LIBRARY(PTDDD)';
            'ADDPOP';
            'TBDISPL PTDTABLE PANEL(PTDLIST)';
            'VGET (ZVERB) SHARED';
            HLTVAR2 = ZVERB;
            'TBCLOSE PTDTABLE LIBRARY(PTDDD)';
            'REMPOP';
            END;
          WHEN PLLDNCH = 'SEL' THEN
            DO WHILE (HLTVAR2 ¬= 'EXIT') & (HLTVAR2 ¬= 'CANCEL'),
                   & (HLTVAR3 ¬= 'EXIT'),
                   & (HLTVAR4 ¬= 'EXIT')
            HLTVAR2 = '';
            HLTVAR3 = '';
            HLTVAR4 = '';
            SELFLD1 = '';
            'ADDPOP';
            'DISPLAY PANEL(PTDMENU)';
            RCODE = RC;
            'VGET (ZVERB) SHARED';
            HLTVAR2 = ZVERB;
            'VPUT (SELFLD1) SHARED';
            IF (SELFDL1 = '') & (HLTVAR2 ¬= 'CANCEL'),
              & (HLTVAR2 ¬= 'EXIT') THEN
              'SETMSG MSG(PTDA000)'
            IF (HLTVAR2 ¬= 'CANCEL') & (HLTVAR2 ¬= 'EXIT'),
              & (SELFLD1 ¬= ' ') THEN
              DO
              XLNAME = '';
              XFNAME = '';
              XMID = '';
              XPHONE = '';
              XDEPT = '';
              XOFFICE = '';
              'VPUT (XLNAME XFNAME XMID XPHONE XDEPT XOFFICE) SHARED';
              'VPUT (SELFLD1) SHARED';
              SELECT
                WHEN SELFLD1 = 'name' THEN
                  SRHVAR = 'PTDNAME';
                WHEN SELFLD1 = 'phnum' THEN
                  SRHVAR = 'PTDPHONE';
                WHEN SELFLD1 = 'dept' THEN
                  SRHVAR = 'PTDDEPT';
                WHEN SELFLD1 = 'offnum' THEN
                  SRHVAR = 'PTDOFFIC';
                OTHERWISE
                  NOP;
                END;
              DO WHILE (RCODE < 8),
                     & (HLTVAR3 ¬= 'EXIT') & (HLTVAR3 ¬= 'CANCEL'),
                     & (HLTVAR4 ¬= 'EXIT')
                HLTVAR3 = '';
                HLTVAR4 = '';
                'ADDPOP';
                'DISPLAY PANEL('SRHVAR')';
                RCODE = RC;
                'VPUT (XLNAME XFNAME XMID XPHONE XDEPT XOFFICE) SHARED';
                'REMPOP';
                'VGET (ZVERB) SHARED';
                HLTVAR3 = ZVERB;
                IF (HLTVAR3 ¬= 'CANCEL') & (HLTVAR3 ¬= 'EXIT') THEN
                  DO
                  'SELECT CMD(PTDDISP) MODE(FSCR)';
                  'VGET (HLTVAR4) SHARED';
                  END;
                ELSE
                  RCODE = 0;
                END;
              END;
            ELSE
              RCODE = 0;
            'REMPOP';
            END;
          OTHERWISE
            NOP;
          END;
        END;
      END;
    END;
    IF ZCMD = 'UPDENT' THEN
      DO
/* ****************************************************************** */
/* Action bar choice --- UPDATE.                                      */
/* ****************************************************************** */
      XLNAME = '';
      XFNAME = '';
      XMID = '';
      XPHONE = '';
      XDEPT = '';
      XOFFICE = '';
      'VPUT (XLNAME XFNAME XMID XPHONE XDEPT XOFFICE) SHARED';
      SELECT
        WHEN PLLDNCH = 'ADD' THEN
          DO
          'ADDPOP';
          'DISPLAY PANEL(PTDADD)';
          RCODE = RC;
          'VGET (ZVERB) SHARED';
          HLTVAR2 = ZVERB;
          'REMPOP';
          'VPUT (XLNAME XFNAME XMID XPHONE XDEPT XOFFICE) SHARED';
          'VPUT (PLLDNCH) SHARED';
          IF RCODE < 8 THEN
            'SELECT CMD(PTDUPD) MODE(FSCR)';
          ELSE
            RCODE = 0;
          END;
        WHEN (PLLDNCH = 'MOD') | (PLLDNCH = 'DEL') THEN
          DO
          DO WHILE (HLTVAR2 ¬= 'EXIT') & (HLTVAR2 ¬= 'CANCEL'),
                 & (HLTVAR3 ¬= 'EXIT')
            HLTVAR2 = '';
            HLTVAR3 = '';
            'ADDPOP'
            IF PLLDNCH = 'MOD' THEN
              SUBVAR = 'Modify';
            ELSE
              SUBVAR = 'Delete';
            'DISPLAY PANEL(PTDINFO)';
            RCODE = RC;
            'VGET (ZVERB) SHARED';
            HLTVAR2 = ZVERB;
            'VPUT (XLNAME XFNAME XMID XPHONE XDEPT XOFFICE) SHARED';
            'VPUT (PLLDNCH) SHARED';
            IF RCODE < 8 THEN
              DO
              'SELECT CMD(PTDUPD) MODE(FSCR)';
              'VGET (HLTVAR3) SHARED';
              'REMPOP';
              END;
            ELSE
              RCODE = 0;
            END;
          END;
        When (PLLDNCH = 'EXIT') THEN
          HLTVAR1 = 'EXIT';
        OTHERWISE
          NOP;
        END;
      END;
    END;

/* ****************************************************************** */
/* Erase all variables from the shared pool.                          */
/* ****************************************************************** */
'VERASE (RCODE) SHARED';
'VERASE (HLTVAR) SHARED';
'VERASE (XFNAME) SHARED';
'VERASE (XLNAME) SHARED';
'VERASE (XMID) SHARED';
'VERASE (XDEPT) SHARED';
'VERASE (XPHONE) SHARED';
'VERASE (XOFFICE) SHARED';
EXIT;
./ ADD NAME=PTDALC   0106-91195-91213-1241-00041-00121-00041-DMV0016
PROC 0 GROUP
/************************************************************/
/*                                                          */
/* LIB: CLIST(XSYSALC)                                      */
/* GDE: TSO/E REFERENCE                                     */
/* DOC: APPEND LIBRARIES TO TSO/ISPF ENVIRONMENT.           */
/*                                                          */
/************************************************************/
/* GIVE TSO  ERRORS TO CLIST     */
    CONTROL NOMSG NOLIST NOFLUSH MAIN END(ENDO)

/**********************************************************/
/* RETURN ISPF ERRORS TO CLIST
/**********************************************************/
ITSOKAY: +
    ISPEXEC CONTROL ERRORS RETURN
    SET &MYCC = &LASTCC
    IF &MYCC ¬= 0 THEN +
      DO
        WRITE ISPEXEC CONTROL FAILED RC=&MYCC
        EXIT CODE(&MYCC)
      ENDO

/**********************************************************/
/* ALLOCATE LIBRARY FOR DIRECTORY                         */
/**********************************************************/
    IF (&GROUP = GROUP) THEN +
      ALLOC FILE(PTDDD) DATASET('XSYS.MVSESA.TABLES') SHR REUSE
    ELSE +
      ALLOC FILE(PTDDD) DATASET(ISPF.ISPPROF) SHR REUSE


/**********************************************************/
/* SPIN OFF TO APPLICATION                                */
/**********************************************************/
    ISPEXEC SELECT CMD(PTD) NEWAPPL(PTD) PASSLIB
    SET &RCSAVE = &LASTCC

    FREE FILE(PTDDD)

    EXIT CODE(&RCSAVE)
./ ADD NAME=PTDALCO  0100-91213-91213-1240-00112-00112-00000-DMV0016
PROC 0 GROUP
/************************************************************/
/*                                                          */
/* LIB: CLIST(XSYSALC)                                      */
/* GDE: TSO/E REFERENCE                                     */
/* DOC: APPEND LIBRARIES TO TSO/ISPF ENVIRONMENT.           */
/*                                                          */
/************************************************************/
/* GIVE TSO  ERRORS TO CLIST     */
    CONTROL NOMSG NOLIST NOFLUSH MAIN END(ENDO)

/**********************************************************/
/* RETURN ISPF ERRORS TO CLIST
/**********************************************************/
ITSOKAY: +
    ISPEXEC CONTROL ERRORS RETURN
    SET &MYCC = &LASTCC
    IF &MYCC ¬= 0 THEN +
      DO
        WRITE ISPEXEC CONTROL FAILED RC=&MYCC
        EXIT CODE(&MYCC)
      ENDO

/**********************************************************/
/* ALLOCATE LIBRARY FOR DIRECTORY                         */
/**********************************************************/
    IF (&GROUP = GROUP) THEN +
      ALLOC FILE(PTDDD) DATASET('XSYS.MVSESA.TABLES') SHR REUSE
    ELSE +
      ALLOC FILE(PTDDD) DATASET(ISPF.ISPPROF) SHR REUSE

/**********************************************************/
/* APPEND DIALOG CLIST LIBRARY                            */
/**********************************************************/
    ALTLIB DEACTIVATE APPLICATION(CLIST)
    FREE FILE(XSYSCLST)
    ALLOC FILE(XSYSCLST) +
      DATASET('XSYS.MVSESA.CLIST') SHR REUSE
    ALTLIB ACTIVATE APPLICATION(CLIST) FILE(XSYSCLST) UNCOND
    SET &MYCC = &LASTCC
    IF &MYCC ¬= 0 THEN +
      DO
        WRITE ALTLIB FAILED RC=&MYCC
        EXIT CODE(&MYCC)
      ENDO

    ISPEXEC LIBDEF ISPMLIB DATASET          -
       ID('XSYS.MVSESA.MSGS')
    SET &MYCC = &LASTCC
    IF &MYCC ¬= 0 THEN +
      DO
        WRITE ISPMLIB FAILED RC=&MYCC
        EXIT CODE(&MYCC)
      ENDO

    ISPEXEC LIBDEF ISPPLIB DATASET          -
       ID('XSYS.MVSESA.PANELS')
    SET &MYCC = &LASTCC
    IF &MYCC ¬= 0 THEN +
      DO
        WRITE ISPPLIB FAILED RC=&MYCC
        EXIT CODE(&MYCC)
      ENDO

    ISPEXEC LIBDEF ISPSLIB DATASET          -
       ID('XSYS.MVSESA.SKELS')
    SET &MYCC = &LASTCC
    IF &MYCC ¬= 0 THEN +
      DO
        WRITE ISPSLIB FAILED RC=&MYCC
        EXIT CODE(&MYCC)
      ENDO

    ISPEXEC LIBDEF ISPTABL DATASET          -
       ID(ISPF.ISPPROF)
    SET &MYCC = &LASTCC
    IF &MYCC ¬= 0 THEN +
      DO
        WRITE ISPTABL FAILED RC=&MYCC
        EXIT CODE(&MYCC)
      ENDO

    ISPEXEC LIBDEF ISPTLIB DATASET          -
       ID(ISPF.ISPPROF 'XSYS.MVSESA.TABLES') UNCOND
    SET &MYCC = &LASTCC
    IF &MYCC ¬= 0 THEN +
      DO
        WRITE ISPTLIB FAILED RC=&MYCC
        EXIT CODE(&MYCC)
      ENDO

/**********************************************************/
/* SPIN OFF TO APPLICATION                                */
/**********************************************************/
    ISPEXEC SELECT CMD(PTD) NEWAPPL(PTD) PASSLIB
    SET &RCSAVE = &LASTCC

/**********************************************************/
/* DIALOG IS FINISHED.  RESTORE ALL DDNAMES THE WAY THEY  */
/* WERE ON ENTRY.                                         */
/**********************************************************/
    ISPEXEC LIBDEF ISPMLIB
    ISPEXEC LIBDEF ISPPLIB
    ISPEXEC LIBDEF ISPSLIB
    ISPEXEC LIBDEF ISPTABL
    ISPEXEC LIBDEF ISPTLIB

    ALTLIB DEACTIVATE APPLICATION(CLIST)

    FREE FILE(PTDDD)

    EXIT CODE(&RCSAVE)
./ ADD NAME=PTDDISP  0100-91204-91204-0806-00127-00127-00000-DMV0016
/* REXX                                                               */
/* ****************************************************************** */
/*                                                                    */
/* LIB: REXX(PTDDISP)                                                 */
/* GDE: SC34-4139-0 ISPF and ISPF/PDF PRIMER                          */
/* DOC: A TelePhone Directory using COMMON USER ACCESS (CUA) or       */
/*      sometimes known as Graphical User Interface (GUI).            */
/*                                                                    */
/* ****************************************************************** */
address ISPEXEC
'CONTROL ERRORS RETURN';
/* ****************************************************************** */
/* Get the pull-down choice variable that was selected.               */
/* ****************************************************************** */
'VGET (SELFDL1) SHARED';
/* ****************************************************************** */
/* Open the table.  If it does not exist, create it.                  */
/* ****************************************************************** */
'TBOPEN PTDTABLE LIBRARY(PTDDD)';
IF RC = 8 THEN
  'SETMSG MSG(PTDA005) MSGLOC(ZCMD)';

/* ****************************************************************** */
/* Process the pull down choices.                                     */
/* ****************************************************************** */
SELECT
  WHEN SELFLD1 = 'name' THEN
    DO
/* ****************************************************************** */
/* Selection choice -- Last, first, middle names.                     */
/*   Assign the variables for the VGET, TBSARG, and SETMSG.           */
/* ****************************************************************** */
    XVARS = 'XLNAME XFNAME XMID';
    XVARS2 = 'XLNAME,EQ,XFNAME,EQ,XMID';
    MVARS = '1';
    END;
  WHEN SELFLD1 = 'phnum' THEN
    DO
/* ****************************************************************** */
/* Selection choice -- Phone number.                                  */
/*   Assign the variables for the VGET, TBSARG, and SETMSG.           */
/* ****************************************************************** */
    XVARS = 'XPHONE';
    MVARS = '2';
    END;
  WHEN SELFLD1 = 'dept' THEN
    DO
/* ****************************************************************** */
/* Selection choice -- Department.                                    */
/*   Assign the variables for the VGET, TBSARG, and SETMSG.           */
/* ****************************************************************** */
    XVARS = 'XDEPT';
    MVARS = '3';
    END;
  WHEN SELFLD1 = 'offnum' THEN
    DO
/* ****************************************************************** */
/* Selection choice -- Office Number.                                 */
/*   Assign the variables for the VGET, TBSARG, and SETMSG.           */
/* ****************************************************************** */
    XVARS = 'XOFFICE';
    MVARS = '4';
    END;
  OTHERWISE;
  END;

/* ****************************************************************** */
/* Get the fields that the user has selected for the search.  Go to   */
/* the top of the table, search for all entries that are of the same  */
/* values.  Sort these entries and save the return code from          */
/* the scan.  Go back to the top of the table.                        */
/* The entries that are found are saved in a temporary table.         */
/* ****************************************************************** */
'TBCREATE TEMPTAB NAMES(XLNAME XFNAME XMID XPHONE XDEPT XOFFICE)';
IF XPHONE ¬= '' THEN
  'TBVCLEAR TEMPTAB';
'VGET ('XVARS') SHARED';
'TBTOP PTDTABLE';
'TBTOP TEMPTAB';
IF SELFLD1 = 'name' THEN
  'TBSARG PTDTABLE NAMECOND('XVARS2',EQ)';
ELSE
  'TBSARG PTDTABLE NAMECOND('XVARS',EQ)';
RCODE = 0;
DO WHILE RCODE = 0
  'TBSCAN PTDTABLE';
  RCODE = RC;
  IF RCODE = 0 THEN
    'TBADD TEMPTAB';
  END;

/* ****************************************************************** */
/* Close and open the temporary table.  Check the number of rows in   */
/* the temporary table.  If entries exist, do an ADDPOP and           */
/* display the table.  Save the return code and remove the pop up.    */
/* ****************************************************************** */
'TBCLOSE TEMPTAB';
'TBOPEN TEMPTAB';
RCODE = RC;
'TBQUERY TEMPTAB ROWNUM(NUMROWS)';
IF (RCODE = 0) & (NUMROWS ¬= 0) THEN
  DO
  'TBTOP TEMPTAB';
  'TBSORT TEMPTAB FIELDS(XLNAME,C,A,XFNAME,C,A)';
  'TBTOP TEMPTAB';
  'ADDPOP ROW(6) COLUMN(25)';
  'TBDISPL TEMPTAB PANEL(PTDLIST)';
  RCODE = RC;
  'VPUT (RCODE) SHARED';
  'VGET (ZVERB) SHARED';
  HLTVAR4 = ZVERB;
  'VPUT (HLTVAR4) SHARED';
  'REMPOP';
  END;
/* ****************************************************************** */
/*   If the scan did not find entries, display a message to inform    */
/*   the user that no entries were found.                             */
/* ****************************************************************** */
ELSE
  'SETMSG MSG(PTDA00'||MVARS') MSGLOC(ZCMD)';
/* ****************************************************************** */
/* Close the tables, and erase the temporary table.                   */
/* ****************************************************************** */
'TBCLOSE PTDTABLE LIBRARY(PTDDD)';
'TBCLOSE TEMPTAB';
'TBERASE TEMPTAB';
EXIT
./ ADD NAME=PTDUPD   0103-91204-91213-0850-00137-00132-00000-DMV0016
/* REXX                                                               */
/* ****************************************************************** */
/*                                                                    */
/* LIB: REXX(PTDUPD)                                                  */
/* GDE: SC34-4139-0 ISPF and ISPF/PDF PRIMER                          */
/* DOC: A TelePhone Directory using COMMON USER ACCESS (CUA) or       */
/*      sometimes known as Graphical User Interface (GUI).            */
/*                                                                    */
/* ****************************************************************** */
/*  TRACE Result                                                      */
/* ****************************************************************** */
/* Setup ISPF services.                                               */
/* ****************************************************************** */
address ISPEXEC
'CONTROL ERRORS RETURN';
/* ****************************************************************** */
/* Get the pull-down choice variable that was selected.               */
/* ****************************************************************** */
'VGET (PLLDNCH) SHARED';
/* ****************************************************************** */
/* Open the table.  If it does not exist, create it.                  */
/* ****************************************************************** */
'TBOPEN PTDTABLE LIBRARY(PTDDD)';
IF RC = 8 THEN
  'TBCREATE PTDTABLE,
    NAMES(xlname XFNAME XMID XPHONE XDEPT XOFFICE),
    LIBRARY(PTDDD)';

/* ****************************************************************** */
/* Get the fields that were entered in the previous panels.  Go to    */
/* the top of the table, search for all entries that are of the same  */
/* last, first, middle names and phone numbers.  Sort these entries   */
/* and save the return code from the scan.                            */
/* ****************************************************************** */
'VGET (XLNAME XFNAME XMID XPHONE XDEPT XOFFICE) SHARED';
'TBTOP PTDTABLE';
'TBSARG PTDTABLE NAMECOND(XLNAME,EQ,XFNAME,EQ,XMID,EQ,XPHONE,EQ)';
'TBSORT PTDTABLE FIELDS(XLNAME,C,A,XFNAME,C,A,XMID,C,A)';
'TBSCAN PTDTABLE';
RCODE = RC;

/* ****************************************************************** */
/* Process the pull down choices.                                     */
/* ****************************************************************** */
SELECT
  WHEN PLLDNCH = 'ADD' THEN
/* ****************************************************************** */
/* Pull down choice -- Add                                            */
/*   If the scan did not find the entry, add it.                      */
/* ****************************************************************** */
    IF RCODE = 8 THEN
      DO
        SUBTYPE = 'Added';
        'TBADD PTDTABLE';
        RCODE = RC;
        IF RCODE = 0 THEN
          'SETMSG MSG(PTDA001A) MSGLOC(ZCMD)';
/* ****************************************************************** */
/*   If the scan found the entry, display a message to inform         */
/*   the user that the information already existed in the list.       */
/* ****************************************************************** */
        ELSE
          'SETMSG MSG(PTDA006) MSGLOC(ZCMD)';
      END;
    ELSE
      'SETMSG MSG(PTDA006) MSGLOC(ZCMD)';
  WHEN PLLDNCH = 'MOD' THEN
/* ****************************************************************** */
/* Pull down choice -- Mod                                            */
/*   If the scan found the entry, get the entry, display it, and      */
/*   then modify it.                                                  */
/* ****************************************************************** */
    IF RCODE = 0 THEN
      DO
      'ADDPOP';
      'TBGET PTDTABLE';
      'DISPLAY PANEL(PTDMOD)';
      RCODE = RC;
      'VGET (ZVERB) SHARED';
      HLTVAR3 = ZVERB;
      'VPUT (HLTVAR3) SHARED';
      SUBTYPE = 'Modified';
      IF RCODE = 0 THEN
        DO
        'SETMSG MSG(PTDA001A) MSGLOC(ZCMD)';
        'TBMOD PTDTABLE';
        END;
      ELSE IF (RCODE ¬= 0) & (HLTVAR3 = 'EXIT') THEN
        'SETMSG MSG(PTDA009) MSGLOC(ZCMD)';
      END;
/* ****************************************************************** */
/*   If the scan did not find entries, display a message to inform    */
/*   the user that no entries were modified.                          */
/* ****************************************************************** */
    ELSE
      'SETMSG MSG(PTDA008) MSGLOC(ZCMD)';
  WHEN PLLDNCH = 'DEL' THEN
/* ****************************************************************** */
/* Pull down choice -- Delete                                         */
/*   If the scan found the entry, get the entry, and display it.      */
/*   If the user confirms the delete, delete it.  Otherwise inform    */
/*   the user that the information was not deleted.                   */
/* ****************************************************************** */
    IF RCODE = 0 THEN
      DO
      'ADDPOP';
      'TBGET PTDTABLE';
      'DISPLAY PANEL(PTDSHOW)';
      RCODE = RC;
      'VGET (ZVERB) SHARED';
      HLTVAR3 = ZVERB;
      'VPUT (HLTVAR3) SHARED';
      SUBTYPE = 'Deleted';
      IF (RCODE = 0) & ((RESP = 'Y') | (RESP = 'y')) THEN
        DO
        'SETMSG MSG(PTDA001A) MSGLOC(ZCMD)';
        'TBDELETE PTDTABLE';
        END;
      ELSE IF (RCODE ¬= 0) & (HLTVAR3 = 'EXIT') THEN
        'SETMSG MSG(PTDA009) MSGLOC(ZCMD)';
      ELSE IF ((RESP = 'N') | (RESP = 'n')) THEN
        'SETMSG MSG(PTDA009) MSGLOC(ZCMD)';
      END;
/* ****************************************************************** */
/*   If the scan did not find entries, display a message to inform    */
/*   the user that no entries were deleted.                           */
/* ****************************************************************** */
    ELSE
      'SETMSG MSG(PTDA007) MSGLOC(ZCMD)';
  OTHERWISE;
    NOP;
  END;
/* ****************************************************************** */
/* Close the table.                                                   */
/* ****************************************************************** */
'TBCLOSE PTDTABLE LIBRARY(PTDDD)';
EXIT
./ ADD NAME=PTFAPCK  0101-91240-91240-1440-00024-00024-00000-DMV0016
PROC 0
/*                                                                 */
/* LIB: CLIST(PTFAPCK)                                             */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: SMP/E APPLY CHECK OF A PTF.                                */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) ASIS
/*  CONTROL   LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    %GETSYSID
    ISPEXEC VGET (SYSID)
BEGIN: +
    ISPEXEC DISPLAY PANEL(PTFAPCK)
    IF (&LASTCC ¬= 0) THEN EXIT CODE(0)
    ISPEXEC VGET (ZONE SYSMOD) ASIS
    ISPEXEC FTOPEN TEMP
    ISPEXEC FTINCL PTFAPCK
    ISPEXEC FTCLOSE
    ISPEXEC VGET (ZTEMPF)
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
    GOTO BEGIN
./ ADD NAME=PTFF1    0106-91074-92100-0948-00042-00040-00000-DMV0016
PROC 0
/*                                                                 */
/* LIB: CLIST(PTFF1)                                               */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: FRONT END THE IESERV SLEHDR CLIST.                         */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) ASIS
/*  CONTROL   LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    %GETSYSID
    ISPEXEC VGET (SYSID)
    SET &NODE = CSCBATCH
    ISPEXEC VGET (USRCLS TYPE DSN USER)
    ISPEXEC VGET (WA WB WC WD WE)
    ISPEXEC VGET (CSCSUSER)
BEGIN: +
    ISPEXEC DISPLAY PANEL(PTFF1)
    IF (&LASTCC ¬= 0) THEN EXIT CODE(0)
    ISPEXEC VGET (USRCLS TYPE DSN USER PW)
    ISPEXEC VGET (WA WB WC WD WE)
    ISPEXEC VGET (CSCSUSER CSCSPSWD)
    SET &ACCT = &SUBSTR(1:4,&STR(&USER.1234)
    SET &RECA = &SUBSTR(1:8,&STR(&ACCT           )
    SET &RECA = &STR(&RECA.&SUBSTR(1:8,&STR(&USER           ))
    SET &RECA = &STR(&RECA.&SUBSTR(1:8,&STR(&PW            ))
    SET &RECA = &STR(&RECA.&STR(        W0400))
    SET &RECB = &STR(                     MLST)
    SET &RECB = &STR(&RECB.&SUBSTR(1:4,&STR(&USRCLS)          ))
    SET &RECB = &STR(&RECB.                G)
    SET &RECC = &STR(                     MPTF)
    SET &RECC = &STR(&RECC.&SUBSTR(1:4,&STR(&USRCLS)          ))
    SET &RECC = &STR(&RECC.                G)
    ISPEXEC VPUT (RECA RECB RECC) SHARED
    ISPEXEC FTOPEN TEMP
    ISPEXEC FTINCL PTFF1
    ISPEXEC FTCLOSE
    ISPEXEC VGET (ZTEMPF)
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
    GOTO BEGIN
./ ADD NAME=PTFF2    0107-91098-92100-0948-00039-00037-00000-DMV0016
PROC 0
/*                                                                 */
/* LIB: CLIST(PTFF2)                                               */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: FRONT END THE IESERV SLEHDR CLIST.                         */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) ASIS
/*  CONTROL   LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    %GETSYSID
    ISPEXEC VGET (SYSID)
    SET &NODE = CSCBATCH
    ISPEXEC VGET (USRCLS TYPE DSN USER)
    ISPEXEC VGET (WA WB WC WD WE)
    ISPEXEC VGET (CSCSUSER)
BEGIN: +
    ISPEXEC DISPLAY PANEL(PTFF2)
    IF (&LASTCC ¬= 0) THEN EXIT CODE(0)
    ISPEXEC VGET (USRCLS TYPE DSN USER PW)
    ISPEXEC VGET (WA WB WC WD WE)
    ISPEXEC VGET (CSCSUSER CSCSPSWD)
    SET &ACCT = &SUBSTR(1:4,&STR(&USER.1234)
    SET &RECA = &SUBSTR(1:8,&STR(&ACCT           )
    SET &RECA = &STR(&RECA.&SUBSTR(1:8,&STR(&USER           ))
    SET &RECA = &STR(&RECA.&SUBSTR(1:8,&STR(&PW            ))
    SET &RECA = &STR(&RECA.&STR(        W0400))
    SET &RECB = &STR(                     )
    SET &RECB = &STR(&RECB.&SUBSTR(1:7,&STR(&USRCLS)          ))
    SET &RECB = &STR(&RECB.                G)
    ISPEXEC VPUT (RECA RECB RECC) SHARED
    ISPEXEC FTOPEN TEMP
    ISPEXEC FTINCL PTFF2
    ISPEXEC FTCLOSE
    ISPEXEC VGET (ZTEMPF)
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
    GOTO BEGIN
./ ADD NAME=PTFF3    0102-91178-92100-0948-00042-00042-00000-DMV0016
PROC 0
/*                                                                 */
/* LIB: CLIST(PTFF3)                                               */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: FRONT END THE IESERV SLEHDR CLIST.                         */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) ASIS
/*  CONTROL   LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    %GETSYSID
    ISPEXEC VGET (SYSID)
    SET &NODE = CSCBATCH
    ISPEXEC VGET (USRCLS TYPE DSN USER)
    ISPEXEC VGET (WA WB WC WD WE)
    ISPEXEC VGET (CSCSUSER)
BEGIN: +
    ISPEXEC DISPLAY PANEL(PTFF1)
    IF (&LASTCC ¬= 0) THEN EXIT CODE(0)
    ISPEXEC VGET (USRCLS TYPE DSN USER PW)
    ISPEXEC VGET (WA WB WC WD WE)
    ISPEXEC VGET (CSCSUSER CSCSPSWD)
    SET &ACCT = &SUBSTR(1:4,&STR(&USER.1234)
    SET &RECA = &SUBSTR(1:8,&STR(&ACCT           )
    SET &RECA = &STR(&RECA.&SUBSTR(1:8,&STR(&USER           ))
    SET &RECA = &STR(&RECA.&SUBSTR(1:8,&STR(&PW            ))
    SET &RECA = &STR(&RECA.&STR(        W0400))
    SET &RECB = &STR(                     ELST)
    SET &RECB = &STR(&RECB.&SUBSTR(1:4,&STR(&USRCLS)          ))
    SET &RECB = &STR(&RECB.                G)
    SET &RECC = &STR(                     EPTF)
    SET &RECC = &STR(&RECC.&SUBSTR(1:4,&STR(&USRCLS)          ))
    SET &RECC = &STR(&RECC.                G)
    ISPEXEC VPUT (RECA RECB RECC) SHARED
    ISPEXEC FTOPEN TEMP
    ISPEXEC FTINCL PTFF3
    ISPEXEC FTCLOSE
    ISPEXEC VGET (ZTEMPF)
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
    GOTO BEGIN
./ ADD NAME=PTFR1    0103-91074-91148-1326-00029-00027-00000-DMV0016
PROC 0
/*                                                                 */
/* LIB: CLIST(PTFR1)                                               */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: SMP/E RECEIVE OF PTF.                                      */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) ASIS
/*  CONTROL   LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    %GETSYSID
    ISPEXEC VGET (SYSID)
    ISPEXEC VGET (CSCDSN DOFDSN)
    ISPEXEC VGET (CSCSUSER CSCSPSWD)
    ISPEXEC VGET (USRCLS)
BEGIN: +
    ISPEXEC DISPLAY PANEL(PTFR1)
    IF (&LASTCC ¬= 0) THEN EXIT CODE(0)
    ISPEXEC VGET (CSCDSN DOFDSN)
    ISPEXEC VGET (CSCSUSER CSCSPSWD)
    ISPEXEC VGET (USRCLS)
    ISPEXEC FTOPEN TEMP
    ISPEXEC FTINCL PTFR1
    ISPEXEC FTCLOSE
    ISPEXEC VGET (ZTEMPF)
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
    GOTO BEGIN
./ ADD NAME=PTFR2    0101-91115-91148-1326-00029-00027-00000-DMV0016
PROC 0
/*                                                                 */
/* LIB: CLIST(PTFR2)                                               */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: SMP/E RECEIVE OF PTF.                                      */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) ASIS
/*  CONTROL   LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
    %GETSYSID
    ISPEXEC VGET (SYSID)
    ISPEXEC VGET (CSCDSN DOFDSN)
    ISPEXEC VGET (CSCSUSER CSCSPSWD)
    ISPEXEC VGET (USRCLS)
BEGIN: +
    ISPEXEC DISPLAY PANEL(PTFR2)
    IF (&LASTCC ¬= 0) THEN EXIT CODE(0)
    ISPEXEC VGET (CSCDSN DOFDSN)
    ISPEXEC VGET (CSCSUSER CSCSPSWD)
    ISPEXEC VGET (USRCLS)
    ISPEXEC FTOPEN TEMP
    ISPEXEC FTINCL PTFR2
    ISPEXEC FTCLOSE
    ISPEXEC VGET (ZTEMPF)
    ISPEXEC CONTROL DISPLAY SM START(13)
    CONTROL MSG
    SUBMIT '&ZTEMPF' NOHOLD
    CONTROL NOMSG
    GOTO BEGIN
./ ADD NAME=RESCHK   0108-91203-91213-1140-00259-00294-00036-DMV0016
/***************** RESCHK - REXX EXEC ********************************/
/*                                                                  */
/* LIB: CLIST(RESCHK)                                               */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC CHECKS THE CATALOGS FOR SYSRES DATASETS.          */
/*                                                                  */
/***************** RESCHK - REXX EXEC ********************************/
/**********************************************************/
/* CHECK USER AUTHORIZATION FIRST                         */
/**********************************************************/
    MYCC = CHECK()
    IF (MYCC = 'DISALLOW') THEN
      DO
        SAY 'AUTHORIZATION CHECKING FAILED FOR 'MYUID'/'MYGRP'.'
        EXIT 4
      END
    IF (MYCC = 'WARNING') THEN
      DO
        SAY 'OKAY THIS TIME, BUT YOU SHOULD CONTACT ME.'
      END

/**********************************************************/
/* ALLOW USER TO CONTINUE                                 */
/**********************************************************/
    MSGSTAT = MSG(OFF)
    DONE = 'NO'

/**********************************************************/
/* ALLOCATE INPUT                                         */
/**********************************************************/
    "ALLOC FILE(MYINPUT) DSNAME(BETA.CNTL(MVSPRES)) SHR REUSE"
    MYCC = RC
    IF (MYCC \= 0) THEN
      DO
        SAY 'ALLOC OF MYINPUT FAILED RC='MYCC
        EXIT 4
      END
    ELSE
     NOP

/**********************************************************/
/* ALLOCATE OUTPUT                                        */
/**********************************************************/
    "ALLOC FILE(OUTDD) DSNAME(BETA.CNTL(MVSPCHK)) SHR REUSE"
    MYCC = RC
    IF (MYCC \= 0) THEN
      DO
        SAY 'ALLOC OF OUTDD FAILED RC='MYCC
        EXIT 4
      END
    ELSE
     NOP

/**********************************************************/
/* PROCESS INPUT                                          */
/**********************************************************/
    DO WHILE DONE = 'NO'
      "EXECIO 1 DISKR MYINPUT"
      RCSAVE = RC
      IF (RCSAVE \= 0) THEN
          DO
            DONE = 'YES'
            "EXECIO 0 DISKW OUTDD (FINIS"
            "EXECIO 0 DISKR MYINPUT (FINIS"
          END
        ELSE
         DO
           PULL RECORD
           DSNAME = WORD(RECORD,1)
           NEWVOL = WORD(RECORD,2)
           IF (NEWVOL = 'DLIB') THEN
             DO
               PUSH ' /*                                   */ '
               PUSH ' /*     DLIBS                         */ '
               PUSH ' /*                                   */ '
               "EXECIO 3 DISKW OUTDD"
             END
           IF (NEWVOL = 'TGT') THEN
             DO
               PUSH ' /*                                   */ '
               PUSH ' /*     TARGETS                       */ '
               PUSH ' /*                                   */ '
               "EXECIO 3 DISKW OUTDD"
             END
           IF (NEWVOL = 'SMPDL1') THEN CALL DLIB
           IF (NEWVOL = 'XRS002') THEN CALL TGT
         END
    END

/**********************************************************/
/* DIALOG IS FINISHED.  RESTORE ALL DDNAMES THE WAY THEY  */
/* WERE ON ENTRY.                                         */
/**********************************************************/

    "FREE FILE(MYINPUT)"
    "FREE FILE(OUTDD)"
    "ISPEXEC EDIT DATASET(BETA.CNTL(MVSPCHK))"

    EXIT RCSAVE

/**********************************************************/
/**********************************************************/
/* INTERNAL SUBROUTINES                                   */
/**********************************************************/
/**********************************************************/

/**********************************************************/
/* CHECK: CHECKS FOR MVS SYSTEMS PROGRAMMERS BY GROUP OR  */
/*        SPECIFIC USERID                                 */
/**********************************************************/

CHECK:
/**********************************************************/
/* COLLECT TSO USERID AND RACF GROUP                      */
/**********************************************************/
    MYUID = SYSVAR(SYSUID)
    X = OUTTRAP(SYSOUTLINE,12)
    "LISTGRP"
    X = OUTTRAP(OFF)
    MYLEN = LENGTH(SYSOUTLINE1)
    MYBEGIN = MYLEN - 8
    MYBEGIN = INDEX(SYSOUTLINE1,' ',MYBEGIN)
    MYGRP = SUBSTR(SYSOUTLINE1,MYBEGIN,8)
/**********************************************************/
/* USER CHECKING                                          */
/**********************************************************/
    IF (MYUID = JOEF) THEN
       RETURN 'WARNING'
    IF (MYUID = DMV0016) THEN
       RETURN 'ALLOW'
/**********************************************************/
/* GROUP CHECKING                                         */
/**********************************************************/
    IF (MYGRP = DMV00) THEN
       RETURN 'ALLOW'
    IF (MYGRP = CSCMVS) THEN
       RETURN 'ALLOW'
/**********************************************************/
/* UNKNOWN OR NOT ALLOWED                                 */
/**********************************************************/
    RETURN 'DISALLOW'

/**********************************************************/
/* DLIB: DLIBS SHOULD BE CATALOGED ON SMPDL1 NOT SYSRES   */
/**********************************************************/

DLIB:
    CALL CHCKVOL
    IF (SYSVOLUME = 'VSAM') THEN
      NOP
    ELSE
    IF (SYSVOLUME = ' ') THEN
      DO
        PUSH DSNAME NEWVOL '__SMPDL1__'
        "EXECIO 1 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = '******') THEN
      DO
        PUSH DSNAME NEWVOL '******'
        "EXECIO 1 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = 'SYSRES?') THEN
      DO
        PUSH DSNAME NEWVOL '__SMPDL1__'
        "EXECIO 1 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = 'SMPDL1') THEN
      NOP
    ELSE
    IF (SYSVOLUME = 'ESARES') THEN
      DO
        PUSH DSNAME NEWVOL '__SMPDL1__'
        "EXECIO 1 DISKW OUTDD"
      END
    ELSE
      DO
        PUSH DSNAME NEWVOL SYSVOLUME
        "EXECIO 1 DISKW OUTDD"
      END
    RETURN 0

/**********************************************************/
/* TGT: TARGETS ARE ALMOST ALWAYS ON SYSRES, BUT CHECK    */
/**********************************************************/

TGT:
    CALL CHCKVOL
    IF (SYSVOLUME = 'LISTCAT') THEN
      CALL LISTC
    IF (SYSVOLUME = 'VSAM') THEN
      NOP
    ELSE
    IF (SYSVOLUME = '******') THEN
      DO
        PUSH DSNAME NEWVOL '******'
        "EXECIO 1 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = 'ESACAP') THEN
      DO
        PUSH DSNAME NEWVOL '__MCAT__'
        "EXECIO 1 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = ' ') THEN
      DO
        PUSH DSNAME NEWVOL '******'
        "EXECIO 1 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME \= 'ESARES') THEN
      DO
        PUSH DSNAME NEWVOL SYSVOLUME
        "EXECIO 1 DISKW OUTDD"
      END
    ELSE
      DO
        PUSH DSNAME NEWVOL 'ESARES'
        "EXECIO 1 DISKW OUTDD"
      END
    RETURN 0

/**********************************************************/
/* CHCKVOL: USE LISTDSI TO FIND VOLSER                    */
/**********************************************************/

CHCKVOL:
    X = LISTDSI("'"DSNAME"'")
    IF (SYSREASON \=  0) THEN SYSVOLUME = ' '
    IF (SYSREASON  =  5) THEN SYSVOLUME = 'SYSRES?'
    IF (SYSREASON  = 12) THEN SYSVOLUME = 'VSAM'
    IF (SYSREASON  = 22) THEN SYSVOLUME = 'LISTCAT'
    IF (SYSREASON  = 24) THEN SYSVOLUME = 'LISTCAT'
    RETURN 0

/**********************************************************/
/* LISTC: LISTCAT ENTRY TO FIND VOLSER                    */
/**********************************************************/

LISTC:
    MSGSTAT = MSG(ON)
    X = OUTTRAP(SYSOUTLINE,12)
    "LISTCAT ENTRY('"DSNAME"') ALL"
    X = OUTTRAP(OFF)
    X = MSG(MSGSTAT)
    MAXLINES = SYSOUTLINE0
    IF (MAXLINES \> 4) THEN
      DO
        SYSVOLUME = 'LISTCAT ERROR'
        RETURN 4
      END
    VOLLINE  = SYSOUTLINE7
    VOLDATA  = WORD(VOLLINE,1)
    VOLSER   = SUBSTR(VOLDATA,19,6)
    SYSVOLUME = VOLSER
    RETURN 0
./ ADD NAME=RESIN    0103-91213-91213-1215-00297-00295-00023-DMV0016
/***************** RESIN - REXX EXEC ********************************/
/*                                                                  */
/* LIB: CLIST(RESIN)                                                */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC CREATES CATALOG STATEMENTS FOR THE NEW SYSRES.    */
/*                                                                  */
/***************** RESIN - REXX EXEC ********************************/
/**********************************************************/
/* CHECK USER AUTHORIZATION FIRST                         */
/**********************************************************/
    MYCC = CHECK()
    IF (MYCC = 'DISALLOW') THEN
      DO
        SAY 'AUTHORIZATION CHECKING FAILED FOR 'MYUID'/'MYGRP'.'
        EXIT 4
      END
    IF (MYCC = 'WARNING') THEN
      DO
        SAY 'OKAY THIS TIME, BUT YOU SHOULD CONTACT ME.'
      END

/**********************************************************/
/* ALLOW USER TO CONTINUE                                 */
/**********************************************************/
    MSGSTAT = MSG(OFF)
    DONE = 'NO'

/**********************************************************/
/* ALLOCATE INPUT                                         */
/**********************************************************/
    "ALLOC FILE(MYINPUT) DSNAME(BETA.CNTL(MVSPCHK)) SHR REUSE"
    MYCC = RC
    IF (MYCC \= 0) THEN
      DO
        SAY 'ALLOC OF MYINPUT FAILED RC='MYCC
        EXIT 4
      END
    ELSE
     NOP

/**********************************************************/
/* ALLOCATE OUTPUT                                        */
/**********************************************************/
    "ALLOC FILE(OUTDD) DSNAME(BETA.CNTL(MVSPIN)) SHR REUSE"
    MYCC = RC
    IF (MYCC \= 0) THEN
      DO
        SAY 'ALLOC OF OUTDD FAILED RC='MYCC
        EXIT 4
      END
    ELSE
     NOP
    PUSH '//SYSIN    DD  * '
    PUSH '//SYSPRINT DD  SYSOUT=* '
    PUSH '//S01#01  EXEC PGM=IDCAMS '
    PUSH '//*'
    PUSH '//*'
    PUSH '//* DOC: RECATALOG SINGLE IMAGE SYSRES DATASETS.'
    PUSH '//* GDE: XXXX-XXXX ACCESS METHOD SERVICES '
    PUSH '//* LIB: GENERATED BY REXX.EXEC(RESIN) '
    PUSH '//*'
    PUSH '//             NOTIFY=DMV0016'
    PUSH '//             MSGCLASS=X,CLASS=L,     '
    PUSH '//DMV0016$ JOB (A006,SYTM),''ROOM28: K.TOMIAK'', '
    "EXECIO 12 DISKW OUTDD"

/**********************************************************/
/* PROCESS INPUT                                          */
/**********************************************************/
    DO WHILE DONE = 'NO'
      "EXECIO 1 DISKR MYINPUT"
      RCSAVE = RC
      IF (RCSAVE \= 0) THEN
          DO
            DONE = 'YES'
            "EXECIO 0 DISKW OUTDD (FINIS"
            "EXECIO 0 DISKR MYINPUT (FINIS"
          END
        ELSE
         DO
           PULL RECORD
           DSNAME = WORD(RECORD,1)
           NEWVOL = WORD(RECORD,2)
           IF (NEWVOL = 'DLIB') THEN
             DO
               PUSH ' /*                                   */ '
               PUSH ' /*     DLIBS                         */ '
               PUSH ' /*                                   */ '
               "EXECIO 3 DISKW OUTDD"
               SAY '********************* DLIBS *****************'
             END
           IF (NEWVOL = 'TGT') THEN
             DO
               PUSH ' /*                                   */ '
               PUSH ' /*     TARGETS                       */ '
               PUSH ' /*                                   */ '
               "EXECIO 3 DISKW OUTDD"
               SAY '********************* TGTS ******************'
             END
           IF (NEWVOL = 'SMPDL1') THEN CALL DLIB
           IF (NEWVOL = 'XRS002') THEN CALL TGT
         END
    END

/**********************************************************/
/* DIALOG IS FINISHED.  RESTORE ALL DDNAMES THE WAY THEY  */
/* WERE ON ENTRY.                                         */
/**********************************************************/

    "FREE FILE(MYINPUT)"

    "ISPEXEC EDIT DATASET(BETA.CNTL(MVSPIN))"

    EXIT RCSAVE

/**********************************************************/
/**********************************************************/
/* INTERNAL SUBROUTINES                                   */
/**********************************************************/
/**********************************************************/

/**********************************************************/
/* CHECK: CHECKS FOR MVS SYSTEMS PROGRAMMERS BY GROUP OR  */
/*        SPECIFIC USERID                                 */
/**********************************************************/

CHECK:
/**********************************************************/
/* COLLECT TSO USERID AND RACF GROUP                      */
/**********************************************************/
    MYUID = SYSVAR(SYSUID)
    X = OUTTRAP(SYSOUTLINE,12)
    "LISTGRP"
    X = OUTTRAP(OFF)
    MYLEN = LENGTH(SYSOUTLINE1)
    MYBEGIN = MYLEN - 8
    MYBEGIN = INDEX(SYSOUTLINE1,' ',MYBEGIN)
    MYGRP = SUBSTR(SYSOUTLINE1,MYBEGIN,8)
/**********************************************************/
/* USER CHECKING                                          */
/**********************************************************/
    IF (MYUID = JOEF) THEN
       RETURN 'WARNING'
    IF (MYUID = DMV0016) THEN
       RETURN 'ALLOW'
/**********************************************************/
/* GROUP CHECKING                                         */
/**********************************************************/
    IF (MYGRP = DMV00) THEN
       RETURN 'ALLOW'
    IF (MYGRP = CSCMVS) THEN
       RETURN 'ALLOW'
/**********************************************************/
/* UNKNOWN OR NOT ALLOWED                                 */
/**********************************************************/
    RETURN 'DISALLOW'

/**********************************************************/
/* DLIB: DLIBS SHOULD BE CATALOGED ON SMPDL1 NOT SYSRES   */
/**********************************************************/

DLIB:
    CALL CHCKVOL
    IF (SYSVOLUME = 'VSAM') THEN
      NOP
    ELSE
    IF (SYSVOLUME = ' ') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(SMPDL1))   '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        "EXECIO 3 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = '******') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(SMPDL1)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    NONVSAM NOSCRATCH                + '
        PUSH ' DELETE 'DSNAME'  + '
        PUSH ' /* ****** */ '
        "EXECIO 7 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = 'SYSRES?') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(SMPDL1)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    NONVSAM NOSCRATCH                + '
        PUSH ' DELETE 'DSNAME'  + '
        PUSH ' /* SYSRES? */ '
        "EXECIO 7 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = 'SMPDL1') THEN
      NOP
    ELSE
    IF (SYSVOLUME = 'XRS002') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(SMPDL1)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    NONVSAM NOSCRATCH                + '
        PUSH ' DELETE 'DSNAME'  + '
        PUSH ' /* PRS001 */ '
        "EXECIO 7 DISKW OUTDD"
      END
    ELSE
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(SMPDL1)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    NONVSAM NOSCRATCH                + '
        PUSH ' DELETE 'DSNAME'  + '
        PUSH ' /* 'SYSVOLUME' */ '
        "EXECIO 7 DISKW OUTDD"
      END
    RETURN 0

/**********************************************************/
/* TGT: TARGETS ARE ALMOST ALWAYS ON SYSRES, BUT CHECK    */
/**********************************************************/

TGT:
    CALL CHCKVOL
    IF (SYSVOLUME = 'LISTCAT') THEN
      CALL LISTC
    IF (SYSVOLUME = 'VSAM') THEN
      NOP
    ELSE
    IF (SYSVOLUME = '******') THEN
      NOP
    ELSE
    IF (SYSVOLUME = 'ESACAP') THEN
      NOP
    ELSE
    IF (SYSVOLUME = ' ') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(******)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        "EXECIO 3 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME \= 'XRS002') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(******)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    NONVSAM NOSCRATCH                + '
        PUSH ' DELETE 'DSNAME'  + '
        PUSH ' /* 'SYSVOLUME' */ '
        "EXECIO 7 DISKW OUTDD"
      END
    RETURN 0

/**********************************************************/
/* CHCKVOL: USE LISTDSI TO FIND VOLSER                    */
/**********************************************************/

CHCKVOL:
    X = LISTDSI("'"DSNAME"'")
    IF (SYSREASON \=  0) THEN SYSVOLUME = ' '
    IF (SYSREASON  =  5) THEN SYSVOLUME = 'SYSRES?'
    IF (SYSREASON  = 12) THEN SYSVOLUME = 'VSAM'
    IF (SYSREASON  = 22) THEN SYSVOLUME = 'LISTCAT'
    IF (SYSREASON  = 24) THEN SYSVOLUME = 'LISTCAT'
    RETURN 0

/**********************************************************/
/* LISTC: LISTCAT ENTRY TO FIND VOLSER                    */
/**********************************************************/

LISTC:
    MSGSTAT = MSG(ON)
    X = OUTTRAP(SYSOUTLINE,12)
    "LISTCAT ENTRY('"DSNAME"') ALL"
    X = OUTTRAP(OFF)
    X = MSG(MSGSTAT)
    MAXLINES = SYSOUTLINE0
    IF (MAXLINES \> 4) THEN
      DO
        SYSVOLUME = 'LISTCAT ERROR'
        RETURN 4
      END
    VOLLINE  = SYSOUTLINE7
    VOLDATA  = WORD(VOLLINE,1)
    VOLSER   = SUBSTR(VOLDATA,19,6)
    SYSVOLUME = VOLSER
    RETURN 0
./ ADD NAME=RESNEW   0106-91212-91214-1206-00153-00137-00019-DMV0016
/***************** RESNEW - REXX EXEC ********************************/
/*                                                                  */
/* LIB: CLIST(RESNEW)                                               */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC CONVERTS A LIST OF DSNAME TO DEFINE CONTROL CARDS.*/
/*                                                                  */
/***************** RESNEW - REXX EXEC ********************************/
/**********************************************************/
/* CHECK USER AUTHORIZATION FIRST                         */
/**********************************************************/
    MYCC = CHECK()
    IF (MYCC = 'DISALLOW') THEN
      DO
        SAY 'AUTHORIZATION CHECKING FAILED FOR 'MYUID'/'MYGRP'.'
        EXIT 4
      END
    IF (MYCC = 'WARNING') THEN
      DO
        SAY 'OKAY THIS TIME, BUT YOU SHOULD CONTACT ME.'
      END

/**********************************************************/
/* ALLOW USER TO CONTINUE                                 */
/**********************************************************/
    MSGSTAT = MSG(OFF)
    DONE = 'NO'

/**********************************************************/
/* ALLOCATE INPUT                                         */
/**********************************************************/
    "ALLOC FILE(MYINPUT) DSNAME(BETA.CNTL(MVSPCHK)) SHR REUSE"
    MYCC = RC
    IF (MYCC \= 0) THEN
      DO
        SAY 'ALLOC OF MYINPUT FAILED RC='MYCC
        EXIT 4
      END
    ELSE
     NOP

/**********************************************************/
/* ALLOCATE OUTPUT                                        */
/**********************************************************/
    "ALLOC FILE(OUTDD) DSNAME(BETA.CNTL(MVSPNEWC)) SHR REUSE"
    MYCC = RC
    IF (MYCC \= 0) THEN
      DO
        SAY 'ALLOC OF OUTDD FAILED RC='MYCC
        EXIT 4
      END
    ELSE
     NOP
    PUSH '//SYSIN    DD  * '
    PUSH '//SYSPRINT DD  SYSOUT=* '
    PUSH '//S01#01  EXEC PGM=IDCAMS,REGION=2048K,TIME=1200 '
    PUSH '//*                                                       '
    PUSH '//* DOC: THIS JOB DEFINES NEW DATA SETS.                  '
    PUSH '//* GDE: XXXX-XXXX ACCESS METHOD SERVICES                 '
    PUSH '//* LIB: XSYS.MVSESA.CLIST(RESNEW)                        '
    PUSH '//*                                                       '
    PUSH '//            NOTIFY=DMV0016                              '
    PUSH '//            MSGCLASS=V,CLASS=V,                         '
    PUSH "//DMV0016 JOB (A006,SYTM),'ROOM28: K. TOMIAK',            "
    "EXECIO 11 DISKW OUTDD"

/**********************************************************/
/* PROCESS INPUT                                          */
/**********************************************************/
    DO WHILE DONE = 'NO'
      "EXECIO 1 DISKR MYINPUT"
      RCSAVE = RC
      IF (RCSAVE \= 0) THEN
          DO
            DONE = 'YES'
            "EXECIO 0 DISKW OUTDD (FINIS"
            "EXECIO 0 DISKR MYINPUT (FINIS"
          END
        ELSE
         DO
           PULL RECORD
           DSNAME = WORD(RECORD,1)
           IF (DSNAME = '/*') THEN
             DO
               PUSH RECORD
               "EXECIO 1 DISKW OUTDD"
             END
           ELSE
             DO
               PUSH '       CATALOG(CATALOG.PROD.MASTER/JES2SHOP) '
               PUSH '       ) + '
               PUSH '        DEVICETYPE(3390)       + '
               PUSH '        VOLUME(******)         + '
               PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
               PUSH '       CATALOG(CATALOG.PROD.MASTER/JES2SHOP) '
               PUSH ' DELETE 'DSNAME' NONVSAM NOSCRATCH + '
               PUSH ' /*                                   */ '
               "EXECIO 8 DISKW OUTDD"
             END
         END
    END

/**********************************************************/
/* DIALOG IS FINISHED.  RESTORE ALL DDNAMES THE WAY THEY  */
/* WERE ON ENTRY.                                         */
/**********************************************************/

    "FREE FILE(MYINPUT)"
    "FREE FILE(OUTDD)"
    "ISPEXEC EDIT DATASET(BETA.CNTL(MVSPNEWC))"

    EXIT RCSAVE

/**********************************************************/
/**********************************************************/
/* INTERNAL SUBROUTINES                                   */
/**********************************************************/
/**********************************************************/

/**********************************************************/
/* CHECK: CHECKS FOR MVS SYSTEMS PROGRAMMERS BY GROUP OR  */
/*        SPECIFIC USERID                                 */
/**********************************************************/

CHECK:
/**********************************************************/
/* COLLECT TSO USERID AND RACF GROUP                      */
/**********************************************************/
    MYUID = SYSVAR(SYSUID)
    X = OUTTRAP(SYSOUTLINE,12)
    "LISTGRP"
    X = OUTTRAP(OFF)
    MYLEN = LENGTH(SYSOUTLINE1)
    MYBEGIN = MYLEN - 8
    MYBEGIN = INDEX(SYSOUTLINE1,' ',MYBEGIN)
    MYGRP = SUBSTR(SYSOUTLINE1,MYBEGIN,8)
/**********************************************************/
/* USER CHECKING                                          */
/**********************************************************/
    IF (MYUID = JOEF) THEN
       RETURN 'WARNING'
    IF (MYUID = DMV0016) THEN
       RETURN 'ALLOW'
/**********************************************************/
/* GROUP CHECKING                                         */
/**********************************************************/
    IF (MYGRP = DMV00) THEN
       RETURN 'ALLOW'
    IF (MYGRP = CSCMVS) THEN
       RETURN 'ALLOW'
/**********************************************************/
/* UNKNOWN OR NOT ALLOWED                                 */
/**********************************************************/
    RETURN 'DISALLOW'
./ ADD NAME=RESOUT   0102-91213-91213-1220-00297-00295-00022-DMV0016
/***************** RESOUT - REXX EXEC *******************************/
/*                                                                  */
/* LIB: CLIST(RESOUT)                                               */
/* GDE: KENNETH E. TOMIAK                                           */
/* DOC: THIS EXEC CREATES CATALOG STATEMENTS FOR THE OLD SYSRES.    */
/*                                                                  */
/***************** RESOUT - REXX EXEC *******************************/
/**********************************************************/
/* CHECK USER AUTHORIZATION FIRST                         */
/**********************************************************/
    MYCC = CHECK()
    IF (MYCC = 'DISALLOW') THEN
      DO
        SAY 'AUTHORIZATION CHECKING FAILED FOR 'MYUID'/'MYGRP'.'
        EXIT 4
      END
    IF (MYCC = 'WARNING') THEN
      DO
        SAY 'OKAY THIS TIME, BUT YOU SHOULD CONTACT ME.'
      END

/**********************************************************/
/* ALLOW USER TO CONTINUE                                 */
/**********************************************************/
    MSGSTAT = MSG(OFF)
    DONE = 'NO'

/**********************************************************/
/* ALLOCATE INPUT                                         */
/**********************************************************/
    "ALLOC FILE(MYINPUT) DSNAME(BETA.CNTL(MVSPCHK)) SHR REUSE"
    MYCC = RC
    IF (MYCC \= 0) THEN
      DO
        SAY 'ALLOC OF MYINPUT FAILED RC='MYCC
        EXIT 4
      END
    ELSE
     NOP

/**********************************************************/
/* ALLOCATE OUTPUT                                        */
/**********************************************************/
    "ALLOC FILE(OUTDD) DSNAME(BETA.CNTL(MVSPOUT)) SHR REUSE"
    MYCC = RC
    IF (MYCC \= 0) THEN
      DO
        SAY 'ALLOC OF OUTDD FAILED RC='MYCC
        EXIT 4
      END
    ELSE
     NOP
    PUSH '//SYSIN    DD  * '
    PUSH '//SYSPRINT DD  SYSOUT=* '
    PUSH '//S01#01  EXEC PGM=IDCAMS '
    PUSH '//*'
    PUSH '//*'
    PUSH '//* DOC: RECATALOG OLD IMAGE SYSRES DATASETS.'
    PUSH '//* GDE: XXXX-XXXX ACCESS METHOD SERVICES '
    PUSH '//* LIB: GENERATED BY REXX.EXEC(RESOUT) '
    PUSH '//*'
    PUSH '//             NOTIFY=DMV0016'
    PUSH '//             MSGCLASS=V,CLASS=V,     '
    PUSH '//DMV0016$ JOB (A006,SYTM),''ROOM28: K.TOMIAK'', '
    "EXECIO 12 DISKW OUTDD"

/**********************************************************/
/* PROCESS INPUT                                          */
/**********************************************************/
    DO WHILE DONE = 'NO'
      "EXECIO 1 DISKR MYINPUT"
      RCSAVE = RC
      IF (RCSAVE \= 0) THEN
          DO
            DONE = 'YES'
            "EXECIO 0 DISKW OUTDD (FINIS"
            "EXECIO 0 DISKR MYINPUT (FINIS"
          END
        ELSE
         DO
           PULL RECORD
           DSNAME = WORD(RECORD,1)
           NEWVOL = WORD(RECORD,2)
           IF (NEWVOL = 'DLIB') THEN
             DO
               PUSH ' /*                                   */ '
               PUSH ' /*     DLIBS                         */ '
               PUSH ' /*                                   */ '
               "EXECIO 3 DISKW OUTDD"
               SAY '********************* DLIBS *****************'
             END
           IF (NEWVOL = 'TGT') THEN
             DO
               PUSH ' /*                                   */ '
               PUSH ' /*     TARGETS                       */ '
               PUSH ' /*                                   */ '
               "EXECIO 3 DISKW OUTDD"
               SAY '********************* TGTS ******************'
             END
           IF (NEWVOL = 'SMPDL1') THEN CALL DLIB
           IF (NEWVOL = 'XRS002') THEN CALL TGT
         END
    END

/**********************************************************/
/* DIALOG IS FINISHED.  RESTORE ALL DDNAMES THE WAY THEY  */
/* WERE ON ENTRY.                                         */
/**********************************************************/

    "FREE FILE(MYINPUT)"

    "ISPEXEC EDIT DATASET(BETA.CNTL(MVSPOUT))"

    EXIT RCSAVE

/**********************************************************/
/**********************************************************/
/* INTERNAL SUBROUTINES                                   */
/**********************************************************/
/**********************************************************/

/**********************************************************/
/* CHECK: CHECKS FOR MVS SYSTEMS PROGRAMMERS BY GROUP OR  */
/*        SPECIFIC USERID                                 */
/**********************************************************/

CHECK:
/**********************************************************/
/* COLLECT TSO USERID AND RACF GROUP                      */
/**********************************************************/
    MYUID = SYSVAR(SYSUID)
    X = OUTTRAP(SYSOUTLINE,12)
    "LISTGRP"
    X = OUTTRAP(OFF)
    MYLEN = LENGTH(SYSOUTLINE1)
    MYBEGIN = MYLEN - 8
    MYBEGIN = INDEX(SYSOUTLINE1,' ',MYBEGIN)
    MYGRP = SUBSTR(SYSOUTLINE1,MYBEGIN,8)
/**********************************************************/
/* USER CHECKING                                          */
/**********************************************************/
    IF (MYUID = JOEF) THEN
       RETURN 'WARNING'
    IF (MYUID = DMV0016) THEN
       RETURN 'ALLOW'
/**********************************************************/
/* GROUP CHECKING                                         */
/**********************************************************/
    IF (MYGRP = DMV00) THEN
       RETURN 'ALLOW'
    IF (MYGRP = CSCMVS) THEN
       RETURN 'ALLOW'
/**********************************************************/
/* UNKNOWN OR NOT ALLOWED                                 */
/**********************************************************/
    RETURN 'DISALLOW'

/**********************************************************/
/* DLIB: DLIBS SHOULD BE CATALOGED ON SMPDL1 NOT SYSRES   */
/**********************************************************/

DLIB:
    CALL CHCKVOL
    IF (SYSVOLUME = 'VSAM') THEN
      NOP
    ELSE
    IF (SYSVOLUME = ' ') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(SMPDL1)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        "EXECIO 3 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = '******') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(******)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    NONVSAM NOSCRATCH                + '
        PUSH ' DELETE 'DSNAME'  + '
        PUSH ' /* ****** */ '
        "EXECIO 7 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = 'SYSRES?') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(******)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    NONVSAM NOSCRATCH                + '
        PUSH ' DELETE 'DSNAME'  + '
        PUSH ' /* SYSRES? */ '
        "EXECIO 7 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME = 'SMPDL1') THEN
      NOP
    ELSE
    IF (SYSVOLUME = 'ESARES') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(******)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    NONVSAM NOSCRATCH                + '
        PUSH ' DELETE 'DSNAME'  + '
        PUSH ' /* PRS001 */ '
        "EXECIO 7 DISKW OUTDD"
      END
    ELSE
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME('SYSVOLUME')) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    NONVSAM NOSCRATCH                + '
        PUSH ' DELETE 'DSNAME'  + '
        PUSH ' /* 'SYSVOLUME' */ '
        "EXECIO 7 DISKW OUTDD"
      END
    RETURN 0

/**********************************************************/
/* TGT: TARGETS ARE ALMOST ALWAYS ON SYSRES, BUT CHECK    */
/**********************************************************/

TGT:
    CALL CHCKVOL
    IF (SYSVOLUME = 'LISTCAT') THEN
      CALL LISTC
    IF (SYSVOLUME = 'VSAM') THEN
      NOP
    ELSE
    IF (SYSVOLUME = '******') THEN
      NOP
    ELSE
    IF (SYSVOLUME = 'ESACAP') THEN
      NOP
    ELSE
    IF (SYSVOLUME = ' ') | (SYSVOLUME = 'SYSRES?') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME(******)) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        "EXECIO 3 DISKW OUTDD"
      END
    ELSE
    IF (SYSVOLUME \= 'ESARES') THEN
      DO
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    DEVICETYPE(3390) VOLUME('SYSVOLUME')) + '
        PUSH ' DEFINE NONVSAM(NAME('DSNAME') + '
        PUSH '      CATALOG(MASTER.MVSPMCAT) '
        PUSH '    NONVSAM NOSCRATCH                + '
        PUSH ' DELETE 'DSNAME'  + '
        PUSH ' /* 'SYSVOLUME' */ '
        "EXECIO 7 DISKW OUTDD"
      END
    RETURN 0

/**********************************************************/
/* CHCKVOL: USE LISTDSI TO FIND VOLSER                    */
/**********************************************************/

CHCKVOL:
    X = LISTDSI("'"DSNAME"'")
    IF (SYSREASON \=  0) THEN SYSVOLUME = ' '
    IF (SYSREASON  =  5) THEN SYSVOLUME = 'SYSRES?'
    IF (SYSREASON  = 12) THEN SYSVOLUME = 'VSAM'
    IF (SYSREASON  = 22) THEN SYSVOLUME = 'LISTCAT'
    IF (SYSREASON  = 24) THEN SYSVOLUME = 'LISTCAT'
    RETURN 0

/**********************************************************/
/* LISTC: LISTCAT ENTRY TO FIND VOLSER                    */
/**********************************************************/

LISTC:
    MSGSTAT = MSG(ON)
    X = OUTTRAP(SYSOUTLINE,12)
    "LISTCAT ENTRY('"DSNAME"') ALL"
    X = OUTTRAP(OFF)
    X = MSG(MSGSTAT)
    MAXLINES = SYSOUTLINE0
    IF (MAXLINES \> 4) THEN
      DO
        SYSVOLUME = 'LISTCAT ERROR'
        RETURN 4
      END
    VOLLINE  = SYSOUTLINE7
    VOLDATA  = WORD(VOLLINE,1)
    VOLSER   = SUBSTR(VOLDATA,19,6)
    SYSVOLUME = VOLSER
    RETURN 0
./ ADD NAME=REXXID   0100-91203-91203-1032-00019-00019-00000-DMV0016
/*-- REXX --- REXXID   - RETRIEVE SYSTEM ID -------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(REXXID)                                            */
/* GDE: XXXX-XXXX REXX REFERENCE                                     */
/* DOC: RETRIEVES THE SYSID FOR THE SYSTEM ENVIRONMENT               */
/*      FOR ISPEXEC DISPLAY                                          */
/*                                                                   */
/*-------------------------------------------------------------------*/
PTR2CVT = STORAGE(10,4)
PTR2SMF = STORAGE(D2X(C2D(PTR2CVT)+197),3)
SYSID = STORAGE(D2X(C2D(PTR2SMF)+16),4)
ADDRESS ISPEXEC
'VPUT (SYSID) SHARED'
UCBPTR  = STORAGE(D2X(C2D(PTR2CVT)+48),4)
UCBVAL  = C2X(UCBPTR)
PTR2UCB = STORAGE(D2X(C2D(PTR2CVT)+48),4)
IPLCUA = C2X(STORAGE(D2X(C2D(PTR2UCB)+4),2))
'VPUT (IPLCUA) SHARED'
'DISPLAY PANEL(IPL)'
./ ADD NAME=REXXIPL  0101-91213-91213-0858-00017-00022-00000-DMV0016
/*-- REXX --- REXXID   - RETRIEVE SYSTEM ID -------------------------*/
/*                                                                   */
/* LIB: REXX.EXEC(REXXID)                                            */
/* GDE: XXXX-XXXX REXX REFERENCE                                     */
/* DOC: RETRIEVES THE SYSID FOR THE SYSTEM ENVIRONMENT               */
/*      FOR ISPEXEC DISPLAY                                          */
/*                                                                   */
/*-------------------------------------------------------------------*/
PTR2CVT = STORAGE(10,4)
PTR2SMF = STORAGE(D2X(C2D(PTR2CVT)+197),3)
SYSID = STORAGE(D2X(C2D(PTR2SMF)+16),4)
UCBPTR  = STORAGE(D2X(C2D(PTR2CVT)+48),4)
UCBVAL  = C2X(UCBPTR)
PTR2UCB = STORAGE(D2X(C2D(PTR2CVT)+48),4)
IPLCUA = C2X(STORAGE(D2X(C2D(PTR2UCB)+4),2))
SAY SYSID 'IPLED FROM CUA=' IPLCUA
EXIT 0
./ ADD NAME=SMPELOGR 0115-91149-91149-1307-00116-00058-00000-DMV0016
PROC 2 LEVEL DDNAME
/*                                                                 */
/* LIB: XSYS.MVSESA.CLIST(SMPELOGR)                                */
/* GDE: IBM CONVERSION/MIGRATION/IMPLEMENTATION TEAM.              */
/* DOC: THIS CLIST READS THE OUTPUT FROM AN SMP/E LIST LOG         */
/*      AND CAPTURES THE HIGHLIGHTS.                               */
/*                                                                 */
    CONTROL NOLIST FLUSH END(ENDO)
    ISPEXEC CONTROL ERRORS RETURN
OPNA: +
    OPENFILE SMPLIST INPUT
    SET &MYCC = &LASTCC
    IF (&MYCC NE 0) THEN +
      DO
        WRITE &STR(OPEN OF SMPLIST FAILED RC=&MYCC)
        GOTO UNOPNA
      ENDO
OPNB: +
    OPENFILE HIGHLITE OUTPUT
    SET &MYCC = &LASTCC
    IF (&MYCC NE 0) THEN +
      DO
        WRITE &STR(OPEN OF HIGHLITE FAILED RC=&MYCC)
        GOTO UNOPNB
      ENDO
    SET &HIGHLITE = &STR(-------- -------- ----)
    SET &HIGHLITE = &STR(&HIGHLITE -----------------------------------)
    SET &HIGHLITE = &STR(&HIGHLITE.-----------------------------------)
    SET &HIGHLITE = &STR(&HIGHLITE.--)
    PUTFILE HIGHLITE
    SET &HIGHLITE = &STR(  DATE     TIME   SEQ# CONTROL CARDS AS USED)
    PUTFILE HIGHLITE
    SET &HIGHLITE = &STR(-------- -------- ----)
    SET &HIGHLITE = &STR(&HIGHLITE -----------------------------------)
    SET &HIGHLITE = &STR(&HIGHLITE.-----------------------------------)
    SET &HIGHLITE = &STR(&HIGHLITE.--)
    PUTFILE HIGHLITE
    SET &HIGHLITE = &STR(-------- -------- ----)
    SET &HIGHLITE = &STR(&HIGHLITE ---------- LEVEL &LEVEL. ----------)
    SET &HIGHLITE = &STR(&HIGHLITE.---- DDNAME &DDNAME. --------------)
    SET &HIGHLITE = &STR(&HIGHLITE.-----------------------------------)
    SET &HIGHLITE = &SUBSTR(1:95,&STR(&HIGHLITE))
    PUTFILE HIGHLITE
    PUTFILE HIGHLITE
    PUTFILE HIGHLITE
    SET &HIGHLITE = &STR(-------- -------- ----)
    SET &HIGHLITE = &STR(&HIGHLITE -----------------------------------)
    SET &HIGHLITE = &STR(&HIGHLITE.-----------------------------------)
    SET &HIGHLITE = &STR(&HIGHLITE.--)
    PUTFILE HIGHLITE
SETUP: +
    SET &LOGSEQ = 0
    SET &LASTTIME = 0
GETA: +
    ERROR +
      DO
        ERROR OFF
        GOTO UNGETA
      ENDO
    GETFILE SMPLIST
    ERROR OFF
    SET &MYLEN = &LENGTH(&SMPLIST)
    IF (&MYLEN < 26) THEN +
      DO
        GOTO GETA
      ENDO
    SET &LOGCHK  = &SUBSTR(4:4,&STR(&SMPLIST))
    IF (&STR(&LOGCHK) NE &STR(/)) THEN +
      DO
        GOTO GETA
      ENDO
    SET &LOGCHK  = &SUBSTR(14:14,&STR(&SMPLIST))
    IF (&STR(&LOGCHK) NE &STR(-)) THEN +
      DO
        GOTO GETA
      ENDO
    SET &LOGCHK = &SUBSTR(24:26,&STR(&SMPLIST))
    IF (&STR(&LOGCHK) NE &STR(GIM)) THEN +
      DO
        GOTO SOMEDATA
      ENDO
    SET &LOGCHK = &SUBSTR(27:29,&STR(&SMPLIST))
    IF (&STR(&LOGCHK) EQ &STR(205)) THEN +
      DO
        GOTO SOMEDATA
      ENDO
    GOTO GETA
SOMEDATA: +
    SET &LOGDATE = &SUBSTR(2:9,&STR(&SMPLIST))
    SET &LOGMNTH = &SUBSTR(1:2,&STR(&LOGDATE))
    SET &LOGDAY  = &SUBSTR(4:5,&STR(&LOGDATE))
    SET &LOGYEAR = &SUBSTR(7:8,&STR(&LOGDATE))
    SET &MYDATE  = &STR(&LOGYEAR./&LOGMNTH./&LOGDAY)
    SET &LOGTIME = &SUBSTR(12:19,&STR(&SMPLIST))
    SET &LOGMSG = &SUBSTR(24:32,&STR(&SMPLIST))
    SET &LOGDATA = &SUBSTR(24:&MYLEN,&STR(&SMPLIST))
    IF (&STR(&LOGTIME) NE &STR(&LASTTIME)) THEN +
      DO
        SET &LOGSEQ = 0
        SET &LASTTIME = &STR(&LOGTIME)
      ENDO
    SET &LOGSEQ = &LOGSEQ + 1
    IF (&LOGSEQ > 9999) THEN SET &LOGSEQ = 1
    IF (&LOGSEQ < 10) THEN SET &LOGSEQ = &STR(000&LOGSEQ)
      ELSE IF (&LOGSEQ < 100) THEN SET &LOGSEQ = &STR(00&LOGSEQ)
        ELSE IF (&LOGSEQ < 1000) THEN SET &LOGSEQ = &STR(0&LOGSEQ)
    SET &HIGHLITE = &STR(&MYDATE &LOGTIME &LOGSEQ &LOGDATA)
    PUTFILE HIGHLITE
    GOTO GETA
UNGETA: +
    CLOSFILE HIGHLITE
    SET &MAXCC = 0
UNOPNB: +
    CLOSFILE SMPLIST
UNOPNA: +
    EXIT CODE(&MAXCC)
./ ADD NAME=TAPELOAD 0145-88347-91242-1201-00152-00043-00000-DMV0016
PROC 0
/*                                                                 */
/* LIB: XSYS.MVSESA.CLIST(TAPELOAD)                                */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS CLIST BUILDS IEBCOPY/IEBGENER JCL FOR ALL DATASETS    */
/*      FROM THE PASSED INPUT DATASET LIST OF DATASETS.            */
/*                                                                 */
    CONTROL NOLIST MAIN NOFLUSH END(ENDO)
/*  CONTROL LIST MSG CONLIST SYMLIST
    ISPEXEC CONTROL ERRORS RETURN
BEGIN: +
    SET &TAPEMSG1 = &STR(  STARTING TO BUILD UNLOAD JCL)
    ISPEXEC VPUT (TAPEMSG1) SHARED
    SET &TAPEMSG3 = &STR( )
    ISPEXEC VPUT (TAPEMSG3) SHARED
    ISPEXEC CONTROL DISPLAY LOCK
    ISPEXEC DISPLAY PANEL(TAPEPROG)
    SET &INPUT = &SYSUID..JCL.CNTL(TAPELOAD)
    SET &FILEDD = TAPELOAD
    CONTROL NOMSG
    FREE  FILE(&FILEDD)
    ALLOC FILE(&FILEDD) DATASET('&INPUT') SHR REUSE
    IF (&LASTCC ¬= 0) THEN GOTO EXITIT
USREDIT: +
    FREE  FILE(FILEDD)
    DELETE '&SYSUID..TAPELOAD'
    ALLOC FILE(FILEDD) DATASET('&SYSUID..TAPELOAD') +
        NEW CATALOG SPACE(1 1) TRACKS DIR(1) +
        BLKSIZE(3120) LRECL(80) RECFM (F B ) +
        UNIT(SYSALLDA)
UNLDPHSE: +
    OPENFILE TAPELOAD INPUT
    FREE FILE(ISPFILE)
    ALLOC FILE(ISPFILE) DATASET('&SYSUID..TAPELOAD(TAPEUNLD)') +
        SHR REUSE
    ISPEXEC FTOPEN
    ISPEXEC FTINCL TAPEJOBC
    SET &CTR = 1
    SET &DATASETC = &SYSUID..TAPELOAD(TAPEUNLD)
    SET &DATASETB = TAPE.JCL.TO.UNLOAD
    ISPEXEC FTINCL UNLDSTP1
    SET &FILLER = &STR(                                               )
READFILA: +
    ERROR +
      DO
        ERROR OFF
        GOTO CLOSITA
      ENDO
    GETFILE TAPELOAD
    ERROR OFF
    SET &TAPELEN = &LENGTH(&STR(&TAPELOAD))
    SET &DATASETA = &SUBSTR(1:72,&TAPELOAD)
    SET &DATASETB = &SUBSTR(1:44,TAPE.&DATASETA &FILLER)
    SET &DATASETB = &DATASETB
    SET &DATASETA = &DATASETA
    SET &MYCC = &SYSDSN('&DATASETA')
    IF (&STR(&MYCC) = OK) THEN +
      DO
        SET &PREV = &STR(STEP&CTR)
        SET &CTR = &CTR + 1
        LISTDSI '&DATASETA' DIRECTORY
        ISPEXEC VPUT (DATASETA DATASETB CTR PREV) SHARED
        SET &RC = &SYSRECFM
        SET &BL = &SYSBLKSIZE
        SET &LR = &SYSLRECL
        SET &SPTYP = &SYSBLKSIZE
        IF (&SYSUNITS = TRACK) THEN +
            SET &SPTYP = TRK
        IF (&SYSUNITS = CYLINDER) THEN +
            SET &SPTYP = CYL
        SET &SPPRI = &SYSUSED
        SET &SPSEC = &SYSSECONDS
        SET &SPDIR = &SYSADIRBLK
        ISPEXEC VPUT (RC BL LR SPTYP SPPRI SPSEC SPDIR) SHARED
        SET &TAPEMSG3 = &STR(  &DATASETA)
        ISPEXEC VPUT (TAPEMSG3) SHARED
        ISPEXEC CONTROL DISPLAY LOCK
        ISPEXEC DISPLAY PANEL(TAPEPROG)
        IF (&SYSDSORG = PO) THEN +
          ISPEXEC FTINCL UNLDCOPY
        IF (&SYSDSORG = PS) THEN +
          ISPEXEC FTINCL UNLDGENR
      ENDO
    ELSE +
      DO
        SET &TAPEMSG3 = &STR(  &DATASETA &MYCC)
        ISPEXEC VPUT (TAPEMSG3) SHARED
        ISPEXEC DISPLAY PANEL(TAPEPROG)
      ENDO
    GOTO READFILA
CLOSITA: +
    CLOSFILE TAPELOAD
    ISPEXEC FTCLOSE NAME(TAPEUNLD) LIBRARY(ISPFILE)
    OPENFILE TAPELOAD INPUT
    FREE FILE(ISPFILE)
    ALLOC FILE(ISPFILE) DATASET('&SYSUID..TAPELOAD(TAPELOAD)') +
        SHR REUSE
    ISPEXEC FTOPEN
    ISPEXEC FTINCL TAPEJOBC
    SET &CTR = 1
    SET &DATASETA = &SYSUID..TAPELOAD(TAPEUNLD)
    SET &DATASETB = TAPE.JCL.TO.UNLOAD
    SET &DATASETD = &SYSUID..TAPELOAD
    ISPEXEC FTINCL LOADSTP1
    SET &FILLER = &STR(                                               )
    SET &TAPEMSG1 = &STR(  STARTING TO BUILD LOAD JCL)
    ISPEXEC VPUT (TAPEMSG1) SHARED
    SET &TAPEMSG3 = &STR(           )
    ISPEXEC VPUT (TAPEMSG3) SHARED
    ISPEXEC CONTROL DISPLAY LOCK
    ISPEXEC DISPLAY PANEL(TAPEPROG)
READFILB: +
    ERROR +
      DO
        ERROR OFF
        GOTO CLOSIT
      ENDO
    GETFILE TAPELOAD
    ERROR OFF
    SET &TAPELEN = &LENGTH(&STR(&TAPELOAD))
    SET &DATASETA = &SUBSTR(1:72,&TAPELOAD)
    SET &DATASETB = &SUBSTR(1:44,TAPE.&DATASETA &FILLER)
    SET &DATASETB = &DATASETB
    SET &DATASETA = &DATASETA
    SET &MYCC = &SYSDSN('&DATASETA')
    IF (&STR(&MYCC) = OK) THEN +
      DO
        SET &PREV = &STR(STEP&CTR)
        SET &CTR = &CTR + 1
        LISTDSI '&DATASETA' DIRECTORY
        ISPEXEC VPUT (DATASETA DATASETB CTR PREV) SHARED
        SET &TAPEMSG3 = &STR(  &DATASETA)
        ISPEXEC VPUT (TAPEMSG3) SHARED
        ISPEXEC CONTROL DISPLAY LOCK
        ISPEXEC DISPLAY PANEL(TAPEPROG)
        IF (&SYSDSORG = PO) THEN +
          ISPEXEC FTINCL LOADCOPY
        IF (&SYSDSORG = PS) THEN +
          ISPEXEC FTINCL LOADGENR
      ENDO
    GOTO READFILB
CLOSIT: +
    CLOSFILE TAPELOAD
    ISPEXEC FTCLOSE NAME(TAPELOAD) LIBRARY(ISPFILE)
EXITIT: +
    CONTROL NOMSG
    FREE DATASET('&INPUT')
    FREE FILE(&FILEDD)
    FREE FILE(FILEDD)
    FREE FILE(ISPFILE)
    ISPEXEC EDIT DATASET('&SYSUID..TAPELOAD(TAPELOAD)')
    EXIT CODE(&MAXCC)
./ ADD NAME=THISISIT 0100-91165-91165-0939-00024-00024-00000-DMV0016
PROC 1 DATASET MAC()
/*                                                                 */
/* LIB: TECHSERV.SYSPROC(ED)                                       */
/* GDE: IBM CONVERSION/MIGRATION/IMPLEMENTATION TEAM.              */
/* DOC: THIS CLIST INVOKES THE ISPF EDITOR.                        */
/*                                                                 */
    CONTROL NOLIST FLUSH END(ENDO)
    ISPEXEC CONTROL ERRORS RETURN
AGAIN: +
    SET &APOST = &SUBSTR(1:1,&DATASET)
    IF (&APOST = &STR(')) THEN +
      DO
        SET &DATASETL = &LENGTH(&DATASET)
        SET &DATASETL = &DATASETL - 1
        SET &DATASETE = &SUBSTR(2:&DATASETL,&DATASET)
      ENDO
    ELSE +
      DO
        SET &DATASETE = &DATASET
      ENDO
    SET &MACRO = &STR()
    IF (&NRSTR(&MAC) NE ) THEN SET &MACRO = &NRSTR(MACRO(&MAC))
    ISPEXEC EDIT DATASET('&DATASETE') &MACRO
    EXIT CODE(&MAXCC)
./ ADD NAME=UNCATJCL 0105-91151-91158-1328-00099-00094-00000-DMV0098
PROC 0
/*                                                                 */
/* LIB: DMV0016.CLIST(UNCATJCL)                                    */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS CLIST READS A PDS MEMBER AND FORMATS IDCAMS           */
/*      DELETE NOSCRATCH CONTROL CARDS.                            */
/*                                                                 */
    CONTROL NOLIST MAIN NOFLUSH END(ENDO)
/*  CONTROL LIST CONLIST SYMLIST
BEGIN: +
    CONTROL NOMSG
    DELETE UNCATJCL
    FREE FILE(UNCATJCL)
    CONTROL MSG
    ALLOC FILE(UNCATJCL) NEW CATALOG +
      DATASET(UNCATJCL) +
      RECFM(F B) BLKSIZE(8000) LRECL(80) +
      SPACE(5 5) TRACKS DSORG(PS) UNIT(SYSALLDA)
    OPENFILE UNCATJCL OUTPUT
    SET &UNCATJCL = &STR(//&SYSUID.A JOB (A006,SYTM,999,9999),        )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//         'ROOM 28 - IBM       ',           )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//         CLASS=V,MSGCLASS=V,REGION=6M,     )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//         NOTIFY=&SYSUID                    )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//* )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//*        JOB GENERATED: &SYSDATE &SYSTIME )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//* )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//IDCAMS01 EXEC  PGM=IDCAMS                 )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//SYSPRINT DD  SYSOUT=* )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(//SYSIN    DD  *        )
    PUTFILE UNCATJCL
    SET &SPACES = &STR(                                            )
ALCVTOC: +
    ALLOC FILE(VTOCSIZE) DATASET('XSYS.MVSESA.CNTL(VTOCLST2)') +
          SHR REUSE
OPENVTOC: +
    OPENFILE VTOCSIZE INPUT
    SET &MYCAT =
GETVTOC: +
    ERROR GOTO CLOSVTOC
    GETFILE VTOCSIZE
    ERROR OFF
    SET &MYLEN = &LENGTH(&STR(&VTOCSIZE))
    IF (&MYLEN < 43) THEN GOTO GETVTOC
    SET &MYDSN = &SUBSTR(2:30,&STR(&VTOCSIZE))
    SET &MYCHK = &SUBSTR(1:1,&STR(&MYDSN))
    IF (&STR(&MYCHK) EQ &STR(-)) THEN GOTO GETVTOC
    IF (&STR(&MYCHK) EQ &STR( )) THEN +
      DO
        SET &TMPCAT = &SUBSTR(44:&MYLEN,&STR(&VTOCSIZE))
        SET &TMPCAT = &TMPCAT
        IF (&STR(&TMPCAT) NE ) THEN SET &MYCAT = &TMPCAT
        GOTO GETVTOC
      ENDO
    SET &MYDSN = &MYDSN
    SET &NEWLEN = &LENGTH(&MYDSN)
    SET &MYMSG = &SUBSTR(31:&MYLEN,&STR(&VTOCSIZE))
    SET &MYEND = &SUBSTR(&NEWLEN,&MYDSN)
    IF (&STR(&MYEND) = &STR(.)) THEN +
      DO
        GETFILE VTOCSIZE
        SET &SUBLEN  = &LENGTH(&STR(&VTOCSIZE))
        SET &MOREDSN = &SUBSTR(4:&SUBLEN,&STR(&VTOCSIZE))
        SET &MOREDSN = &MOREDSN
        SET &MYDSN = &STR(&MYDSN.&MOREDSN)
      ENDO
    SET &UNCATJCL = &STR(    )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(  /* ) &STR(     &MYMSG) &STR(       */ )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(  DEL      &MYDSN - )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(           NSCR - )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(           CAT(&MYCAT) )
    PUTFILE UNCATJCL
    GOTO GETVTOC
CLOSVTOC: +
    ERROR OFF
    SET &MAXCC = 0
    CLOSFILE VTOCSIZE
    SET &UNCATJCL = &STR(/* )
    PUTFILE UNCATJCL
    SET &UNCATJCL = &STR(// )
    PUTFILE UNCATJCL
CLOSRPT: +
    CLOSFILE UNCATJCL
    FREE FILE(UNCATJCL)
    ISPEXEC EDIT DATASET(UNCATJCL)
ISMFEXIT: +
    EXIT CODE(0)
./ ADD NAME=VIEWSYS1 0101-91144-91144-1523-00023-00023-00000-DMV0016
PROC 0                             /* VIEW MVS BACKUPS             */
/*                                                                 */
/* LIB: CLIST(VIEWSYS1)                                            */
/* GDE: K. TOMIAK                                                  */
/* DOC: THIS CLIST INVOKES ISPF 3.4 WITH PRE-DETERMINED LEVEL.     */
/*                                                                 */
/* SETUP ERROR HANDLING PROCESSING                                 */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) MAIN CAPS
    ISPEXEC CONTROL ERRORS RETURN
/*                                                                 */
/* GET SYSTEM ID USING REXX EXEC                                   */
/*                                                                 */
    %GETSYSID
    ISPEXEC VGET (SYSID)
/*                                                                 */
/* REMOVE LEADING ZEROES ON LEVEL                                  */
/*                                                                 */
    %XSYS34 SMPE.BACKUP
/*                                                                 */
/* WRAP IT UP                                                      */
/*                                                                 */
    EXIT CODE(0)
./ ADD NAME=XM       0100-91237-91237-0748-00026-00026-00000-DMV0016
PROC 1 DSNAME
/*                                                                 */
/* LIB: SYSPROC(XM)                                                */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS CLIST INVOKES "TRANSMIT" ON A DATASET.                */
/*                                                                 */
BEGIN: +
    CONTROL NOLIST NOFLUSH END(ENDO) PROMPT MSG
/*  CONTROL   LIST CONLIST SYMLIST MSG
    ISPEXEC CONTROL ERRORS RETURN
LOOP: +
    ISPEXEC DISPLAY PANEL(XSYS@XM)
    SET &MYCC = &LASTCC
    IF (&MYCC NE 0) THEN EXIT CODE(0)
    SET &NODE = &NODE
    IF (&NODE NE ) THEN SET &NODE = &NODE&STR(.)
    TRANSMIT &NODE.&USER  DSNAME(&DSNAME) +
      SYSOUT(Z) +
      NOTIFY
    SET &MYCC = &LASTCC
    IF (&MYCC NE 0) THEN +
      DO
        WRITE LAST XMIT WAS &MYCC
        EXIT CODE(&MYCC)
      ENDO
    GOTO LOOP
./ ADD NAME=XSYSMISC 0102-91165-91165-0940-00015-00014-00000-DMV0016
PROC 0
/*                                                                 */
/* LIB: XSYS.MVSESA.CLIST(XSYSMISC)                                */
/* GDE: IBM CONVERSION/MIGRATION/IMPLEMENTATION TEAM.              */
/* DOC: THIS CLIST INVOKES OTHER CLISTS WHILE UNDER THE            */
/*      XSYS UMBRELLA OF LIBDEF/ALTLIB CONCATENATIONS.             */
/*                                                                 */
    CONTROL NOLIST FLUSH END(ENDO) MAIN ASIS
    ISPEXEC CONTROL ERRORS RETURN
PNL: +
    ISPEXEC DISPLAY PANEL(XSYSMISC)
    SET &MYCC = &LASTCC
    IF (&MYCC NE 0) THEN EXIT CODE(0)
    &XSYSCMD
    GOTO PNL
./ ADD NAME=XSYS34   0102-91144-91206-1524-00014-00014-00000-DMV0016
PROC 1 KETPFX
/*                                                                 */
/* LIB: XSYS.MVSESA.CLIST(XSYS34)                                  */
/* GDE: IBM CONVERSION/MIGRATION/IMPLEMENTATION TEAM.              */
/* DOC: THIS CLIST INVOKES 3.4 WITH A PREFIX SET.                  */
/*                                                                 */
    CONTROL NOLIST FLUSH END(ENDO)
/*  CONTROL LIST CONLIST SYMLIST MSG
    ISPEXEC CONTROL ERRORS RETURN
    SET &KETDR = BYPASS
    ISPEXEC VPUT (KETDR KETPFX) SHARED
AGAIN: +
    ISPEXEC SELECT PGM(ISRUDL) PARM(XSYSUDLP)
    EXIT CODE(&LASTCC)
./ ADD NAME=Z        0100-91225-91225-1444-00121-00121-00000-DMV0016
ISREDIT MACRO (TRACE)
/*                                                                 */
/* LIB: CLIST.LIBRARY.NAME(Z)                                      */
/* GDE: KENNETH E. TOMIAK                                          */
/* DOC: THIS CLIST USES LIBRARY SERVICES TO COMPRESS A DATASET.    */
/*                                                                 */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*  SET UP ERROR HANDLING PROCESSING                               */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*                                                                 */
    CONTROL NOLIST NOFLUSH END(ENDO) NOMSG    /*  INITIAL SETTINGS */
    IF (&TRACE = TRACE) THEN +
      CONTROL LIST MSG CONLIST SYMLIST        /*  DEBUGGING HELP   */
    IF (&STR(&SYSISPF) NE ACTIVE) THEN +
      DO                                      /* - - - - - - - - - */
        WRITENR YOU MUST BE IN ISPF/EDIT      /* WRITE MESSAGE     */
        WRITE TO USE THIS EDIT MACRO          /* WRITE MESSAGE     */
        EXIT CODE(16)                         /* TERMINATE         */
      ENDO                                    /* - - - - - - - - - */
    ISPEXEC CONTROL ERRORS RETURN             /*  ISPF ERRORS      */
/*                                                                 */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*  RETRIEVE DATA SET NAME FOR CURRENT EDIT DATASET                */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*                                                                 */
    ISREDIT (DSN) = DATASET                   /*  RETRIEVE DATASET */
    SET &DSN = &STR('&DSN')                   /*  WRAP IN APOST    */
/*                                                                 */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*  INITIALIZE MESSAGE HANDLING ENVIRONMENT                        */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*                                                                 */
    SET &ZERRHM = &STR(NOHELP)                /*  ISPF HELP PANEL  */
    SET &ZERRALRM = &STR(YES)                 /*  ALARM STATUS     */
    SET &ZERRSM = &STR(COMPRESSED!!)          /*  SHORT MESSAGE    */
    SET &ZERRLM = &STR( )                     /*  LONG MESSAGE     */
    SET &ZERRLM = &STR(THE REQUESTED PDS: &DATASET WAS COMPRESSED)
/*                                                                 */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*  USE LIBRARY SERVICES TO SET UP DATASET                         */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*                                                                 */
    ISPEXEC LMINIT DATAID(DSNID) DATASET(&DSN) +
        ENQ(EXCLU)
    SET &MYCC = &LASTCC
    IF (&MYCC NE 0) THEN +
      DO
        SET &ZERRSM = &STR(DATASET IN USE)
        SET &ZERRLM = &STR(DATASET &DSN IS CURRENTLY IN USE)
        SET &ZERRLM = &STR(&ZERRLM BY ANOTHER USER OR TASK)
        IF (&MYCC EQ 8) THEN +
          DO                                  /* - - - - - - - - - */
            SET &ZERRLM = &STR(DATASET NOT ALLOCATED OR DATA SET)
            SET &ZERRLM = &STR(&ZERRLM ORGANIZATION NOT SUPPORTED)
          ENDO                                /* - - - - - - - - - */
        ELSE +
        IF (&MYCC EQ 12) THEN +
          DO                                  /* - - - - - - - - - */
            SET &ZERRLM = &STR(INVALID PARAMETER VALUE)
          ENDO                                /* - - - - - - - - - */
        ELSE +
        IF (&MYCC EQ 16) THEN +
          DO                                  /* - - - - - - - - - */
            SET &ZERRLM = &STR(TRUNCATION OR TRANSLATION ERROR)
            SET &ZERRLM = &STR(&ZERRLM IN ACCESSING DIALOG VARIABLES)
          ENDO                                /* - - - - - - - - - */
        ELSE +
        IF (&MYCC EQ 20) THEN +
          DO                                  /* - - - - - - - - - */
            SET &ZERRLM = &STR(SEVERE ERROR)
          ENDO                                /* - - - - - - - - - */
        GOTO EXITIT
      ENDO
/*                                                                 */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*  USE LIBRARY SERVICES TO COMPRESS CURRENT DATASET               */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*                                                                 */
    ISPEXEC LMCOMP DATAID(&DSNID)             /*  COMPRESS         */
    SET &MYCC = &LASTCC
    IF (&MYCC NE 0) THEN +
      DO
        SET &ZERRSM = &STR(COMPRESS FAILED)
        SET &ZERRLM = &STR(THE DSN: &DSN FAILED TO)
        SET &ZERRLM = &STR(&ZERRLM COMPRESS RC=&MYCC)
/*                                                                 */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*  SET MESSAGE TO TELL USER WHY THE LMCOMP FAILED                 */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*                                                                 */
        IF (&MYCC EQ 10) THEN +
          DO                                  /* - - - - - - - - - */
            SET &ZERRLM = &STR(NO DATA SET ASSOCIATED)
            SET &ZERRLM = &STR(&ZERRLM WITH GIVEN DATA-ID.)
          ENDO                                /* - - - - - - - - - */
        ELSE +
        IF (&MYCC EQ 12) THEN +
          DO                                  /* - - - - - - - - - */
            SET &ZERRLM = &STR(DATA SET NOT PARTITIONED OR)
           SET &ZERRLM = &STR(&ZERRLM DATA SET NOT ALLOCATED OR OPENED.)
          ENDO                                /* - - - - - - - - - */
        ELSE +
        IF (&MYCC EQ 20) THEN +
          DO                                  /* - - - - - - - - - */
            SET &ZERRLM = &STR(SEVERE ERROR, UNABLE TO CONTINUE.)
          ENDO                                /* - - - - - - - - - */
        GOTO FREEIT
      ENDO
/*                                                                 */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*  USE LIBRARY SERVICES TO FREE DATASET                           */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/*                                                                 */
FREEIT: +
    ISPEXEC LMFREE DATAID(&DSNID)             /*  DONE WITH IT     */
EXITIT: +
    ISPEXEC VPUT (ZERRALRM ZERRHM ZERRLM ZERRSM) SHARED
    ISPEXEC SETMSG MSG(ISRZ002)               /* SIGNAL MSGID      */
    IF (&STR(&ZERRLM) NE ) THEN WRITE &ZERRLM
    SET &MYCC = &LASTCC
    EXIT CODE(&MAXCC)
