 /********************* DELMARK  ISPF EDIT MACRO *********************/
 /* DELMARK IS A ISPF EDIT MACRO TO DELETE MEMBERS PREVIOUSLY MARKED */
 /* BY THE MARK MACRO                                                */
 /*                                                                  */
 /* SYNTAX: DELMARK                                                  */
 /*                                                                  */
 /********************************************************************/

ISREDIT MACRO
ISPEXEC VGET (DELLST,DELLAST,DELDSN) PROFILE
IF &DELDSN = THEN DO
           SET ZEDSMSG = &STR(NOTHING TO DO)
             SET ZEDLMSG = &STR(NO MEMBERS MARKED FOR DELETION)
           ISPEXEC SETMSG MSG(ISRZ001)
           EXIT
         END
 ISREDIT (WORKDSN) = DATASET
/* INITIALIZE DATASET */
 SET &PDSDSN = &WORKDSN
ISPEXEC  LMINIT DATAID(PDSID) DATASET('&PDSDSN') +
                ENQ(SHRW)                        +
                ORG(PDSORG)
SET LMRC = &LASTCC
IF &LMRC ¬= 0 THEN +
   DO
           SET ZEDSMSG = &STR(LMINIT FAILED)
             SET ZEDLMSG = &STR(DATA SET IS NOT ALLOCATED OR NOT A +
                               PATRIRIONED DATA SET CODE &LMRC)
           ISPEXEC SETMSG MSG(ISRZ001)
      EXIT
   END

/* OPEN DATA SET */
ISPEXEC LMOPEN DATAID(&PDSID) OPTION(OUTPUT)
SET LMRC = &LASTCC

ISREDIT (THISDSN) = DATASET
 IF &DELDSN ¬= &THISDSN THEN DO
   SET ZEDSMSG = &STR(WRONG DATASET)
   SET ZEDLMSG = &STR(MEMBERS MARKED FOR DELETION ARE FROM &DELDSN +
   NOT &THISDSN )
   ISPEXEC SETMSG MSG(ISRZ001)
   EXIT
 END
SET &DELLSX = &STR(&DELLST&STR( ))
IF &SUBSTR(1:1,&STR(&DELLSX)) = &STR( ) THEN DO
SET &DELLSX = &SUBSTR(2:&LENGTH(&STR(&DELLSX)),&STR(&DELLSX))
END
SET &LX = &LENGTH(&STR(&DELLST))
SET &L2 = 1
SET &L1 = 1
GOTO FINDMEM
START: +
SET &L2 = 2
FINDMEM: +
 IF &L2 > &LENGTH(&STR(&DELLSX)) THEN GOTO FINISH
 IF &SUBSTR(&L2:&L2,&STR(&DELLSX)) ¬= &STR( ) THEN GOTO SEARCH
 IF &SUBSTR(&L2:&L2,&STR(&DELLSX)) = &STR( ) THEN DO
 SET &MEMR = &SUBSTR(1:&EVAL(&L2-1),&STR(&DELLSX))
 IF &MEMR = &DELLAST THEN GOTO FINISH
 SET &DEST = MEMID
 GOTO DELIT
MEMID: +
SET &DELLSX = +
&SUBSTR(&EVAL(&L1):&LENGTH(&STR(&DELLST)),&STR(&DELLST))
SET &DELLSX = &SUBSTR(1:&LENGTH(&STR(&DELLSX)),&STR(&DELLSX))
IF &SUBSTR(1:1,&STR(&DELLSX)) = &STR( ) THEN DO
SET &DELLSX = &SUBSTR(2:&LENGTH(&STR(&DELLSX)),&STR(&DELLSX))
SET &L2 = 1
 SET &L1 = &L1 + 1
GOTO FINDMEM
END
IF &SUBSTR(2:2,&STR(&DELLSX)) = &STR( ) THEN DO
SET &DELLSX = &SUBSTR(3:&LENGTH(&STR(&DELLSX)),&STR(&DELLSX))
SET &L2 = 1
 SET &L1 = &L1 + 1
GOTO FINDMEM
END
IF &SUBSTR(3:3,&STR(&DELLSX)) = &STR( ) THEN DO
SET &DELLSX = &SUBSTR(4:&LENGTH(&STR(&DELLSX)),&STR(&DELLSX))
SET &L2 = 1
 SET &L1 = &L1 + 1
GOTO FINDMEM
END
 GOTO START
 END
 SEARCH: +
 SET &L1 = &L1 + 1
 SET &L2 = &L2 + 1
 GOTO FINDMEM
 FINISH: +
 SET &MEMR = &STR(&DELLSX)
 SET &DEST = FINAL
 DELIT: +
  ISPEXEC  LMMDEL  DATAID(&PDSID) MEMBER(&MEMR)
IF &LMRC = 0 THEN +
   DO
   WRITE &MEMR DELETED
           SET ZEDSMSG = &STR(&MEM DELETED)
             SET ZEDLMSG = &STR('&WORKDSN(&MEMR)' DELETED
           ISPEXEC SETMSG MSG(ISRZ001)
   END
IF &LMRC ¬= 0 THEN +
   DO
          SET ZEDSMSG = &STR(&MEM NOT DELETED)
           SET ZEDLMSG = &STR('&WORKDSN(&MEMR)' NOT DELETED CODE &LMRC)
           ISPEXEC SETMSG MSG(ISRZ001)
   END
 GOTO &DEST
 FINAL: +
ISPEXEC LMMLIST DATAID(&PDSID) OPTION(FREE)
/* CLOSE DATA SET */
ISPEXEC LMCLOSE DATAID(&PDSID)
/* FREE DATA ID */
ISPEXEC LMFREE  DATAID(&PDSID)
SET &DELDSN =
SET &DELLAST =
SET &DELLST =
ISPEXEC VPUT (DELDSN,DELLAST,DELLST) PROFILE
 EXIT
