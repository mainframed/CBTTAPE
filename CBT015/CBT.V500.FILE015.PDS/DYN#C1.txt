PROC 0 DFLTMSG(DYNM001) LIB() LIB2(XASP.DYNA.SAMPLIB)            +
       VDYNPRJ() VDYNLIB() VDYNTYP() VDYNIND() DEBUG

CONTROL NOLIST NOFLUSH NOMSG NOPROMPT
IF &DEBUG NE THEN CONTROL LIST NOFLUSH MSG CONLIST SYMLIST PROMPT

 FREE FI(DYNAPRNT DYNAUDIT DYNALIB DYNALIST SAMPLIB)
 FREE FI(DYNAWORK DYNWHELP DYNAHELP DYNAROUT DYNWROUT)
 FREE FI(CTRANS WEBSTER THESARUS PERSONAL)
 FREE FI(LMODLIB)

SET &PERSONAL = &SYSUID..DYNA.PERSONAL.DYNWLEX
WHATIF DATASET('&PERSONAL') CATALOGED
SET &CC = &LASTCC
 IF &CC ¬= 0 THEN +
   DO
    CONTROL MSG
    ALLOC DA('&PERSONAL') FI(PERSONAL) +
          LIKE('XASP.DYNA.PERSONAL.DYNWLEX') UNIT(TSOTSO)
   END

SET &DYNALIB = &SYSUID..DYNA.DATA
WHATIF DATASET('&DYNALIB') CATALOGED
SET &CC = &LASTCC
  IF &CC ¬= 0 THEN +
    DO
     CONTROL MSG
     ALLOC DA('&DYNALIB') FI(DYNALIB)  LIKE('XASP.DYNA.SAMPLIB') +
           SP(1,1) CYLINDERS DIR(10) UNIT(TSOTSO)
    END

ISPEXEC VGET (VDYNPRJ VDYNLIB VDYNTYP VDYNPRF) PROFILE

ENTER: +
 SET &MSG = &DFLTMSG

 ISPEXEC DISPLAY PANEL(DYN#P1) MSG(&MSG)

 SET &LCC = &LASTCC

 IF &LCC EQ 8 THEN GOTO XIT

 ISPEXEC CONTROL DISPLAY LINE

 IF &STR(&VDYNIND) NE THEN +
        DO
        SET &LIB = &STR(&VDYNIND.)
        END
 IF &STR(&VDYNPRJ.&VDYNLIB.&VDYNTYP) NE THEN +
        DO
        SET &LIB EQ &STR('&VDYNPRJ..&VDYNLIB..&VDYNTYP.')
        END

 ALLOC F(DYNALIB) DA(&LIB.) SHR REUSE

 IF &LASTCC NE 0 THEN +
    DO
    SET &MSG EQ DYNM003
    GOTO REENTER
    END

 ALLOC F(DYNAROUT) DA('XASP.DYNA.ROUTE(DYNAROUT)') SHR REUSE
 ALLOC F(DYNWROUT) DA('XASP.DYNA.ROUTE(DYNWROUT)') SHR REUSE
 ALLOC FI(SAMPLIB) DA('&LIB2.') SHR REUSE
 ALLOC FI(DYNAWORK) SPACE(1 1) TRACK REUSE
 ALLOC FI(DYNWHELP) DA('XASP.DYNA.DYNWHELP') SHR REUSE
 ALLOC FI(DYNAHELP) DA('XASP.DYNA.DYNAHELP') SHR REUSE
 ALLOC FI(CTRANS) DA('XASP.DYNA.SASC.LINKLIB') SHR REUSE
 ALLOC FI(WEBSTER) DA('XASP.DYNA.WEBSTER.DYNWLEX') SHR REUSE
 ALLOC FI(THESARUS) DA('XASP.DYNA.THESARUS.DYNWTHES') SHR REUSE
 ALLOC FI(PERSONAL) DA(DYNA.PERSONAL.DYNWLEX) SHR REUSE
 ALLOC FI(LMODLIB) DA('XASP.DYNA.LOAD') SHR REUSE

 CONTROL NOFLUSH MSG

 IF &VDYNPRF EQ Y THEN +
          DO
   ISPEXEC SELECT PGM(SWTSO) +
                  PARM('DYNASTRT,/EX PROFILE I TIME=0;/EX *')
          END
          ELSE ISPEXEC SELECT PGM(DYNASTRT)

  ISPEXEC LOG MSG(DYNM004)
  ISPEXEC CONTROL DISPLAY REFRESH

  IF &DEBUG = DEBUG THEN CONTROL PROMPT LIST CONLIST SYMLIST MSG
     ELSE CONTROL MAIN MSG

 GOTO ENTER

XIT: +
 ISPEXEC VPUT (VDYNPRJ VDYNLIB VDYNTYP VDYNPRF) PROFILE

 IF &DEBUG NE DEBUG THEN CONTROL MAIN NOMSG

 FREE FI(DYNAPRNT DYNAUDIT DYNALIB DYNALIST SAMPLIB)
 FREE FI(DYNAWORK DYNWHELP DYNAHELP DYNAROUT DYNWROUT)
 FREE FI(CTRANS WEBSTER THESARUS PERSONAL)
 FREE FI(LMODLIB)
 EXIT
