./ ADD NAME=$ASM        01 00 99288 99288 104647 0077 0077 0000 IBMUSER
//IBMUSERZ JOB T,SCHED,CLASS=R,MSGCLASS=T,NOTIFY=IBMUSER,REGION=7M
//JJ$SCHIN EXEC PGM=ASMA90,PARM=(DECK,NOOBJECT)
//SYSIN    DD  DSN=IBMUSER.JSCH.SOURCE(JJ$SCHIN),DISP=SHR
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.MODGEN,DISP=SHR
//         DD  DSN=IBMUSER.JSCH.SOURCE,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,1)
//SYSPUNCH DD  DSN=&&PUNCH,DISP=(NEW,PASS),
//          SPACE=(CYL,1),UNIT=SYSALLDA
//JJ$SCHID EXEC PGM=ASMA90,PARM=(DECK,NOOBJECT)
//SYSIN    DD  DSN=IBMUSER.JSCH.SOURCE(JJ$SCHID),DISP=SHR
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.MODGEN,DISP=SHR
//         DD  DSN=IBMUSER.JSCH.SOURCE,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,1)
//SYSPUNCH DD  DSN=&&PUNCH,DISP=(MOD,PASS),
//          SPACE=(TRK,1),UNIT=SYSALLDA
//JJ$SCHMI EXEC PGM=ASMA90,PARM=(DECK,NOOBJECT)
//SYSIN    DD  DSN=IBMUSER.JSCH.SOURCE(JJ$SCHMI),DISP=SHR
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.MODGEN,DISP=SHR
//         DD  DSN=IBMUSER.JSCH.SOURCE,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,1)
//SYSPUNCH DD  DSN=&&PUNCH,DISP=(MOD,PASS),
//          SPACE=(TRK,1),UNIT=SYSALLDA
//JJ$SCHAC EXEC PGM=ASMA90,PARM=(DECK,NOOBJECT)
//SYSIN    DD  DSN=IBMUSER.JSCH.SOURCE(JJ$SCHAC),DISP=SHR
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.MODGEN,DISP=SHR
//         DD  DSN=IBMUSER.JSCH.SOURCE,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,1)
//SYSPUNCH DD  DSN=&&PUNCH,DISP=(MOD,PASS),
//          SPACE=(TRK,1),UNIT=SYSALLDA
//JJ$SCHAI EXEC PGM=ASMA90,PARM=(DECK,NOOBJECT)
//SYSIN    DD  DSN=IBMUSER.JSCH.SOURCE(JJ$SCHAI),DISP=SHR
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.MODGEN,DISP=SHR
//         DD  DSN=IBMUSER.JSCH.SOURCE,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,1)
//SYSPUNCH DD  DSN=&&PUNCH,DISP=(MOD,PASS),
//          SPACE=(TRK,1),UNIT=SYSALLDA
//JJ$SCHAT EXEC PGM=ASMA90,PARM=(DECK,NOOBJECT)
//SYSIN    DD  DSN=IBMUSER.JSCH.SOURCE(JJ$SCHAT),DISP=SHR
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.MODGEN,DISP=SHR
//         DD  DSN=IBMUSER.JSCH.SOURCE,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,1)
//SYSPUNCH DD  DSN=&&PUNCH,DISP=(MOD,PASS),
//          SPACE=(TRK,1),UNIT=SYSALLDA
//JJ$SCHSE EXEC PGM=ASMA90,PARM=(DECK,NOOBJECT)
//SYSIN    DD  DSN=IBMUSER.JSCH.SOURCE(JJ$SCHSE),DISP=SHR
//SYSPRINT DD  SYSOUT=*
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.MODGEN,DISP=SHR
//         DD  DSN=IBMUSER.JSCH.SOURCE,DISP=SHR
//SYSUT1   DD  SPACE=(CYL,1)
//SYSPUNCH DD  DSN=&&PUNCH,DISP=(MOD,PASS),
//          SPACE=(TRK,1),UNIT=SYSALLDA
//*
//IEWL     EXEC PGM=IEWL,
//          PARM='REFR,AMODE=31,RMODE=ANY,XREF,LIST,MAP'
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  UNIT=SYSDA,SPACE=(CYL,10)
//SYSLIB   DD  DSN=SYS1.CSSLIB,DISP=SHR
//SYSLMOD  DD  DSN=SYS1.LINKLIB,DISP=SHR
//SYSLIN   DD  DSN=&&PUNCH,DISP=(OLD,DELETE)
//         DD  *
 ALIAS JJ$SCHSE
 ALIAS JJ$SCHAI
 ENTRY JJ$SCHIN
 NAME  JJ$SCHIN(R)
./ ADD NAME=$ATBJSCH    01 04 99288 99291 113458 0028 0017 0014 IBMUSER
//IBMUSERZ JOB T,SCHED,CLASS=R,MSGCLASS=T,NOTIFY=IBMUSER,REGION=7M
//TPADD    EXEC PGM=ATBSDFMU
//SYSPRINT DD  SYSOUT=*
//SYSSDLIB DD  DSN=SYSP.APPC.P1.TPPROF.CLUSTER,DISP=SHR
//SYSSDOUT DD  SYSOUT=*
//SYSIN    DD  DATA,DLM=$$
 TPDELETE
   TPNAME(JJINFO)
 TPADD TPSCHED_EXIT(JJ$SCHSE)
   TPNAME(JJINFO)
   SYSTEM
   ACTIVE(YES)
   TPSCHED_DELIMITER(##)
STCJOB,JOBNAME=JJINFO,D=IBMUSER.JSCH.SOURCE,M=JJINFO
##
$$
//SIADD    EXEC PGM=ATBSDFMU
//SYSPRINT DD   SYSOUT=*
//SYSSDLIB DD  DSN=SYSP.APPC.P1.SIDEINFO.CLUSTER,DISP=SHR
//SYSSDOUT DD   SYSOUT=*
//SYSIN    DD   *
     SIADD
          DESTNAME(JJINFO)
          TPNAME(JJINFO)
          MODENAME(#INTER)
          PARTNER_LU(JSCH)
/*
//
./ ADD NAME=CGIBIN      01 00 99350 99350 110245 0259 0259 0000 IBMUSER
/* REXX EXEC TO COMMUNICATE WITH JSCH, MUST RESIDE IN CGIBIN
   DIRECTORY FOR USE WITH THE WEBSEVER */

  parse arg cmdline

  SYM_DEST=JJINFO

  call atbcmrex

  /* Initialise conversation */
  address "CPICOMM" "CMINIT CON_ID SYM_DEST C_RC"
  if C_RC ¬= CM_OK then
    do
      say "CMINIT failed RC =" CM_RETURN_CODE.C_RC
      exit 8
    end

  /* Allocate conversation */
  address "CPICOMM" "CMALLC CON_ID C_RC"
  if C_RC ¬= CM_OK then
    do
      say "CMALLC failed RC =" CM_RETURN_CODE.C_RC
      exit 8
    end

  in_msg = cmdline
  msg_len = length(in_msg)
  address "CPICOMM" "CMSEND CON_ID IN_MSG MSG_LEN REQ_SEND C_RC"
  if C_RC ¬= CM_OK then
    do
      say "CMSEND failed RC =" CM_RETURN_CODE.C_RC
      exit 8
    end

  address "CPICOMM" "CMPTR CON_ID C_RC"
  if C_RC ¬= CM_OK then
    do
      say "CMPTR failed RC =" CM_RETURN_CODE.C_RC
      exit 8
    end

do until C_RC = CM_DEALLOCATED_NORMAL
  rcv_len = 4096
  address "CPICOMM" "CMRCV CON_ID RCV_MSG RCV_LEN",
                    "RCV_RET RCV_RLN RCV_STA REQ_SEND C_RC"
  if C_RC ¬= CM_OK & C_RC ¬= CM_DEALLOCATED_NORMAL then
    do
      say "CMRCV failed RC =" CM_RETURN_CODE.C_RC
      exit 8
    end
  if RCV_RET ¬= CM_NO_DATA_RECEIVED then
    say left(rcv_msg,rcv_rln)
end

exit

atbcmrex:

/*************** SAA CPI Communications Variable Names ****************/
/*                                                                    */
/* The following variables are defined and available on all operating */
/* systems supporting SAA CPI Communications.  All variables for      */
/* SAA CPI Communications start with the letters 'CM'.                */
/*                                                                    */
/* The literals are provided for your convenience.  They may, or may  */
/* not, be defined in other operating system environments.            */
/*                                                                    */
/**********************************************************************/

CM_INITIALIZE_STATE             = 2    /* conversation_state          */
CM_SEND_STATE                   = 3
CM_RECEIVE_STATE                = 4
CM_SEND_PENDING_STATE           = 5
CM_CONFIRM_STATE                = 6
CM_CONFIRM_SEND_STATE           = 7
CM_CONFIRM_DEALLOCATE_STATE     = 8
CM_DEFER_RECEIVE_STATE          = 9
CM_DEFER_DEALLOCATE_STATE       = 10
CM_SYNC_POINT_STATE             = 11
CM_SYNC_POINT_SEND_STATE        = 12
CM_SYNC_POINT_DEALLOCATE_STATE  = 13
CM_CONVERSATION_STATE.2         = 'CM_INITIALIZE_STATE'
CM_CONVERSATION_STATE.3         = 'CM_SEND_STATE'
CM_CONVERSATION_STATE.4         = 'CM_RECEIVE_STATE'
CM_CONVERSATION_STATE.5         = 'CM_SEND_PENDING_STATE'
CM_CONVERSATION_STATE.6         = 'CM_CONFIRM_STATE'
CM_CONVERSATION_STATE.7         = 'CM_CONFIRM_SEND_STATE'
CM_CONVERSATION_STATE.8         = 'CM_CONFIRM_DEALLOCATE_STATE'
CM_CONVERSATION_STATE.9         = 'CM_DEFER_RECEIVE_STATE'
CM_CONVERSATION_STATE.10        = 'CM_DEFER_DEALLOCATE_STATE'
CM_CONVERSATION_STATE.11        = 'CM_SYNC_POINT_STATE'
CM_CONVERSATION_STATE.12        = 'CM_SYNC_POINT_SEND_STATE'
CM_CONVERSATION_STATE.13        = 'CM_SYNC_POINT_DEALLOCATE_STATE'

CM_BASIC_CONVERSATION           = 0    /* conversation_type           */
CM_MAPPED_CONVERSATION          = 1
CM_CONVERSATION_TYPE.0          = 'CM_BASIC_CONVERSATION'
CM_CONVERSATION_TYPE.1          = 'CM_MAPPED_CONVERSATION'

CM_NO_DATA_RECEIVED             = 0    /* data_received               */
CM_DATA_RECEIVED                = 1
CM_COMPLETE_DATA_RECEIVED       = 2
CM_INCOMPLETE_DATA_RECEIVED     = 3
CM_DATA_RECEIVED.0              = 'CM_NO_DATA_RECEIVED'
CM_DATA_RECEIVED.1              = 'CM_DATA_RECEIVED'
CM_DATA_RECEIVED.2              = 'CM_COMPLETE_DATA_RECEIVED'
CM_DATA_RECEIVED.3              = 'CM_INCOMPLETE_DATA_RECEIVED'

CM_DEALLOCATE_SYNC_LEVEL        = 0    /* deallocate_type             */
CM_DEALLOCATE_FLUSH             = 1
CM_DEALLOCATE_CONFIRM           = 2
CM_DEALLOCATE_ABEND             = 3
CM_DEALLOCATE_TYPE.0            = 'CM_DEALLOCATE_SYNC_LEVEL'
CM_DEALLOCATE_TYPE.1            = 'CM_DEALLOCATE_FLUSH'
CM_DEALLOCATE_TYPE.2            = 'CM_DEALLOCATE_CONFIRM'
CM_DEALLOCATE_TYPE.3            = 'CM_DEALLOCATE_ABEND'

CM_RECEIVE_ERROR                = 0    /* error_direction             */
CM_SEND_ERROR                   = 1
CM_ERROR_DIRECTION.0            = 'CM_RECEIVE_ERROR'
CM_ERROR_DIRECTION.1            = 'CM_SEND_ERROR'

CM_FILL_LL                      = 0    /* fill                        */
CM_FILL_BUFFER                  = 1
CM_FILL.0                       = 'CM_FILL_LL'
CM_FILL.1                       = 'CM_FILL_BUFFER'

CM_PREP_TO_RECEIVE_SYNC_LEVEL   = 0    /* prepare_to_receive_type     */
CM_PREP_TO_RECEIVE_FLUSH        = 1
CM_PREP_TO_RECEIVE_CONFIRM      = 2
CM_PREPARE_TO_RECEIVE_TYPE.0    = 'CM_PREP_TO_RECEIVE_SYNC_LEVEL'
CM_PREPARE_TO_RECEIVE_TYPE.1    = 'CM_PREP_TO_RECEIVE_FLUSH'
CM_PREPARE_TO_RECEIVE_TYPE.2    = 'CM_PREP_TO_RECEIVE_CONFIRM'

CM_RECEIVE_AND_WAIT             = 0    /* receive_type                */
CM_RECEIVE_IMMEDIATE            = 1
CM_RECEIVE_TYPE.0               = 'CM_RECEIVE_AND_WAIT'
CM_RECEIVE_TYPE.1               = 'CM_RECEIVE_IMMEDIATE'

CM_REQ_TO_SEND_NOT_RECEIVED     = 0    /* request_to_send_received    */
CM_REQ_TO_SEND_RECEIVED         = 1
CM_REQUEST_TO_SEND_RECEIVED.0   = 'CM_REQ_TO_SEND_NOT_RECEIVED'
CM_REQUEST_TO_SEND_RECEIVED.1   = 'CM_REQ_TO_SEND_RECEIVED'

CM_OK                           = 0    /* return_code                 */
CM_ALLOCATE_FAILURE_NO_RETRY    = 1
CM_ALLOCATE_FAILURE_RETRY       = 2
CM_CONVERSATION_TYPE_MISMATCH   = 3
CM_PIP_NOT_SPECIFIED_CORRECTLY  = 5
CM_SECURITY_NOT_VALID           = 6
CM_SYNC_LVL_NOT_SUPPORTED_LU    = 7
CM_SYNC_LVL_NOT_SUPPORTED_PGM   = 8
CM_TPN_NOT_RECOGNIZED           = 9
CM_TP_NOT_AVAILABLE_NO_RETRY    = 10
CM_TP_NOT_AVAILABLE_RETRY       = 11
CM_DEALLOCATED_ABEND            = 17
CM_DEALLOCATED_NORMAL           = 18
CM_PARAMETER_ERROR              = 19
CM_PRODUCT_SPECIFIC_ERROR       = 20
CM_PROGRAM_ERROR_NO_TRUNC       = 21
CM_PROGRAM_ERROR_PURGING        = 22
CM_PROGRAM_ERROR_TRUNC          = 23
CM_PROGRAM_PARAMETER_CHECK      = 24
CM_PROGRAM_STATE_CHECK          = 25
CM_RESOURCE_FAILURE_NO_RETRY    = 26
CM_RESOURCE_FAILURE_RETRY       = 27
CM_UNSUCCESSFUL                 = 28
CM_DEALLOCATED_ABEND_SVC        = 30
CM_DEALLOCATED_ABEND_TIMER      = 31
CM_SVC_ERROR_NO_TRUNC           = 32
CM_SVC_ERROR_PURGING            = 33
CM_SVC_ERROR_TRUNC              = 34
CM_TAKE_BACKOUT                 = 100
CM_DEALLOCATED_ABEND_BO         = 130
CM_DEALLOCATED_ABEND_SVC_BO     = 131
CM_DEALLOCATED_ABEND_TIMER_BO   = 132
CM_RESOURCE_FAIL_NO_RETRY_BO    = 133
CM_RESOURCE_FAILURE_RETRY_BO    = 134
CM_DEALLOCATED_NORMAL_BO        = 135
CM_RETURN_CODE.0                = 'CM_OK'
CM_RETURN_CODE.1                = 'CM_ALLOCATE_FAILURE_NO_RETRY'
CM_RETURN_CODE.2                = 'CM_ALLOCATE_FAILURE_RETRY'
CM_RETURN_CODE.3                = 'CM_CONVERSATION_TYPE_MISMATCH'
CM_RETURN_CODE.5                = 'CM_PIP_NOT_SPECIFIED_CORRECTLY'
CM_RETURN_CODE.6                = 'CM_SECURITY_NOT_VALID'
CM_RETURN_CODE.7                = 'CM_SYNC_LVL_NOT_SUPPORTED_LU'
CM_RETURN_CODE.8                = 'CM_SYNC_LVL_NOT_SUPPORTED_PGM'
CM_RETURN_CODE.9                = 'CM_TPN_NOT_RECOGNIZED'
CM_RETURN_CODE.10               = 'CM_TP_NOT_AVAILABLE_NO_RETRY'
CM_RETURN_CODE.11               = 'CM_TP_NOT_AVAILABLE_RETRY'
CM_RETURN_CODE.17               = 'CM_DEALLOCATED_ABEND'
CM_RETURN_CODE.18               = 'CM_DEALLOCATED_NORMAL'
CM_RETURN_CODE.19               = 'CM_PARAMETER_ERROR'
CM_RETURN_CODE.20               = 'CM_PRODUCT_SPECIFIC_ERROR'
CM_RETURN_CODE.21               = 'CM_PROGRAM_ERROR_NO_TRUNC'
CM_RETURN_CODE.22               = 'CM_PROGRAM_ERROR_PURGING'
CM_RETURN_CODE.23               = 'CM_PROGRAM_ERROR_TRUNC'
CM_RETURN_CODE.24               = 'CM_PROGRAM_PARAMETER_CHECK'
CM_RETURN_CODE.25               = 'CM_PROGRAM_STATE_CHECK'
CM_RETURN_CODE.26               = 'CM_RESOURCE_FAILURE_NO_RETRY'
CM_RETURN_CODE.27               = 'CM_RESOURCE_FAILURE_RETRY'
CM_RETURN_CODE.28               = 'CM_UNSUCCESSFUL'
CM_RETURN_CODE.30               = 'CM_DEALLOCATED_ABEND_SVC'
CM_RETURN_CODE.31               = 'CM_DEALLOCATED_ABEND_TIMER'
CM_RETURN_CODE.32               = 'CM_SVC_ERROR_NO_TRUNC'
CM_RETURN_CODE.33               = 'CM_SVC_ERROR_PURGING'
CM_RETURN_CODE.34               = 'CM_SVC_ERROR_TRUNC'
CM_RETURN_CODE.100              = 'CM_TAKE_BACKOUT'
CM_RETURN_CODE.130              = 'CM_DEALLOCATED_ABEND_BO'
CM_RETURN_CODE.131              = 'CM_DEALLOCATED_ABEND_SVC_BO'
CM_RETURN_CODE.132              = 'CM_DEALLOCATED_ABEND_TIMER_BO'
CM_RETURN_CODE.133              = 'CM_RESOURCE_FAIL_NO_RETRY_BO'
CM_RETURN_CODE.134              = 'CM_RESOURCE_FAILURE_RETRY_BO'
CM_RETURN_CODE.135              = 'CM_DEALLOCATED_NORMAL_BO'

CM_WHEN_SESSION_ALLOCATED       = 0    /* return_control              */
CM_IMMEDIATE                    = 1
CM_RETURN_CONTROL.0             = 'CM_WHEN_SESSION_ALLOCATED'
CM_RETURN_CONTROL.1             = 'CM_IMMEDIATE'

CM_BUFFER_DATA                  = 0    /* send_type                   */
CM_SEND_AND_FLUSH               = 1
CM_SEND_AND_CONFIRM             = 2
CM_SEND_AND_PREP_TO_RECEIVE     = 3
CM_SEND_AND_DEALLOCATE          = 4
CM_SEND_TYPE.0                  = 'CM_BUFFER_DATA'
CM_SEND_TYPE.1                  = 'CM_SEND_AND_FLUSH'
CM_SEND_TYPE.2                  = 'CM_SEND_AND_CONFIRM'
CM_SEND_TYPE.3                  = 'CM_SEND_AND_PREP_TO_RECEIVE'
CM_SEND_TYPE.4                  = 'CM_SEND_AND_DEALLOCATE'

CM_NO_STATUS_RECEIVED           = 0    /* status_received             */
CM_SEND_RECEIVED                = 1
CM_CONFIRM_RECEIVED             = 2
CM_CONFIRM_SEND_RECEIVED        = 3
CM_CONFIRM_DEALLOC_RECEIVED     = 4
CM_TAKE_COMMIT                  = 5
CM_TAKE_COMMIT_SEND             = 6
CM_TAKE_COMMIT_DEALLOCATE       = 7
CM_STATUS_RECEIVED.0            = 'CM_NO_STATUS_RECEIVED'
CM_STATUS_RECEIVED.1            = 'CM_SEND_RECEIVED'
CM_STATUS_RECEIVED.2            = 'CM_CONFIRM_RECEIVED'
CM_STATUS_RECEIVED.3            = 'CM_CONFIRM_SEND_RECEIVED'
CM_STATUS_RECEIVED.4            = 'CM_CONFIRM_DEALLOC_RECEIVED'
CM_STATUS_RECEIVED.5            = 'CM_TAKE_COMMIT'
CM_STATUS_RECEIVED.6            = 'CM_TAKE_COMMIT_SEND'
CM_STATUS_RECEIVED.7            = 'CM_TAKE_COMMIT_DEALLOCATE'

CM_NONE                         = 0    /* sync_level                  */
CM_CONFIRM                      = 1
CM_SYNC_POINT                   = 2
CM_SYNC_LEVEL.0                 = 'CM_NONE'
CM_SYNC_LEVEL.1                 = 'CM_CONFIRM'
CM_SYNC_LEVEL.2                 = 'CM_SYNC_POINT'

/******************** END OF SAA VARIABLE NAMES ***********************/


return
./ ADD NAME=JJ$SCHAC
JJ$SCHAC CSECT ,
JJ$SCHAC AMODE 31
JJ$SCHAC RMODE ANY
*
* ENTRY PARAMETERS
*   0(R1) PTR SCIB - TRANSACTION SCHEDULER INFORMATION BLOCK
*   4(R1) PTR TXIB - TRANSACTION INSTANCE INFORMATION BLOCK
*
* CALLED BY
*   JJ$SCHMI ON INBOUND ATTACH (IRB)
*
* FUNCTION
*   CREATE ADDRESS SPACE AND ASSOCIATE INCOMING ATTACH WITH NEWLY
*   CREATED ADDRESS SPACE
*
         BAKR  R14,0
         LR    R12,R15
         USING JJ$SCHAC,R12
*
         LM    R10,R11,0(R1)           ESTABLISH ADDRESSABILITY
         USING SCIB,R10
         USING TXIB,R11
         USING XCFMS_INBOUND_FMH5,TXFMH5
*
         CLC   =C'SCIB',SCIBID
         BNE   *-1
         CLC   =C'TXIB',TXIBID
         BNE   *-1
*
         LA    R9,XCFMS_INBOUND_FMH5
         AH    R9,XCFMS_PROFILE_OFFSET
         USING TP_PROFILE,R9
*
         STORAGE OBTAIN,               OBTAIN WORKAREA                 X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               LENGTH=ACWRKL
         LR    R13,R1
         MVC   4(4,R1),=C'F1SA'
         USING ACWRK,R13
*
         LH    R1,XCFMS_PROFILE_LENGTH
         LTR   R1,R1
         BZ    CLEANUP
*
         CLC   TP_PROFILE_TPSCHED_EXIT,TPSEXIT
         BNE   CLEANUP
*
         CLC   NON_ASCH_NUM_OF_RECORDS,=F'1'
         BNZ   CLEANUP
*
         CLC   NON_ASCH_LEN_OF_RECORDS,=F'124'
         BH    CLEANUP
*
         STM   R10,R11,UTOKEN          UTOKEN FOR TERM RTN
         MVC   ACASCRE,LASCRE
         L     R3,=V(JJ$SCHAT)         TERM RTN ADDRESS
         ASCRE STPARM=NON_ASCH_DATA-2, START PARAMETERS                X
               ODA=ASEO,                                               X
               INIT=ACAIRTN,           ADDR SPC INIT ROUTINE           X
               TRMEXIT=(3),            TRM RTN (CURR TCB IRB)          X
               UTOKEN=UTOKEN,          TOKEN FOR TRM EXIT              X
               ASPARM=SCASPARM,        PARM FOR ASEXT                  X
               ATTR=(PERM),                                            X
               MF=(E,ACASCRE)
         LTR   R15,R15
         BNZ   CLEANUP
*
         L     R8,ASEOECB
         USING EAECB,R8
         IPK   ,
         SPKA  0                       RIM WAIT ECB IS IN KEY0
         WAIT  ECB=EAERIMWT
         SPKA  0(R2)
*
         CALL  ATBCONN,                CONNECT                         X
               (ASEOASCB,                NEWLY STARTED AS TO THIS SCH  X
               RC),                                                    X
               VL,MF=(E,LCALL)
         L     R15,RC
         LTR   R15,R15
         BNZ   *-1
*
         CALL  ATBASOC,                ASSOCIATE                       X
               (XCFMS_TP_ID,             INBOUND CALL                  X
               SCASCB,                                                 X
               ASEOASCB,                 WITH NEWLY STARTED AS         X
               UTOKEN,                                                 X
               RC),                                                    X
               VL,MF=(E,LCALL)
         L     R15,RC
         LTR   R15,R15
         BNZ   *-1
*
         TM    SCDEBUG,DEBUGON
         BZ    NWSCHACS
         WTO   'JJ$SCHAC TX START'
NWSCHACS DS    0H
*
         L     R3,ASEOASCB
         POST  EAEASWT,                POST ADDR SPC TO CONTINUE       X
               ASCB=(3),                                               X
               ECBKEY=0,                                               X
               LINKAGE=SYSTEM,                                         X
               ERRET=BR14,                                             X
               MF=(E,LPOST)
         B     ACDONE
*
CLEANUP  DS    0H
         TM    SCDEBUG,DEBUGON
         BZ    NWSCHACC
         WTO   'JJ$SCHAC CLEANUP TP'
NWSCHACC DS    0H
*
         CALL  ATBCTP3,                                                X
               (XCFMS_TP_ID,                                           X
               ATBCMTP_TP_NOT_AVAIL_NO_RETRY,                          X
               ATBCMTP_NOTIFY_TYPE_NONE,                               X
               ATBCSS_FW0,                                             X
               ATBCSS_FW0,                                             X
               RC),                                                    X
               VL,MF=(E,LCALL)
*
ACDONE   DS    0H
         LR    R1,R13
         STORAGE RELEASE,                                              X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               LENGTH=ACWRKL,                                          X
               ADDR=(1)
*
         PR    ,
*
BR14     DS    0H
         BR    R14
*
LASCRE   ASCRE MF=L
LASCREL  EQU   *-LASCRE
*
TPSEXIT  DC    CL8'JJ$SCHSE',V(JJ$SCHSE)
ACAIRTN  DC    CL8'JJ$SCHAI',V(JJ$SCHAI)
*
         ATBCSASM ,
*
         LTORG ,
*
ACWRK    DSECT ,
SAVEAREA DS    18F
ACASCRE  DS    XL(LASCREL)
UTOKEN   DS    2A                      A(SCIB,TXIB)
LPOST    POST  ECBKEY=YES,MF=L
LCALL    DS    6F
RC       DS    F
ACWRKL   EQU   *-ACWRK
*
         SCIB ,
         TXIB ,
*
         ATBXCFMS ,
         ATBDFTP ,
         IXCYMEPL ,
         IEZEAECB ,
         YREGS ,
*
         END   ,
./ ADD NAME=JJ$SCHAI
JJ$SCHAI CSECT ,
JJ$SCHAI AMODE 31
JJ$SCHAI RMODE ANY
*
* ENTRY PARAMETERS
*   0(R1) PTR ASCB  - CURRENT ADDRESS SPACE
*   4(R1) PTR EAECB - SASI COMMUNICATIONS ECBS
*
* CALLED BY
*   ADDRESS SPACE INITIALISATION (RB)
*
* FUNCTION
*   NOTIFY AND WAIT ON SCHEDULER TO PERFORM ALL NESSESARY INITIALISAION
*
         SPKA  X'00'                   CAUSE 0C2 IF CALLED INCORRECTLY
         BAKR  R14,0
         LR    R12,R15
         USING JJ$SCHAI,R12
*
         L     R11,4(,R1)
         USING EAECB,R11
*
         STORAGE OBTAIN,                                               X
               LENGTH=AIWRKL
         MVC   4(4,R1),=C'F1SA'
         LR    R13,R1
         USING AIWRK,R13
*
         ASEXT ASPARM
         L     R10,2(,R1)              SCHEDULER ASCB ADDRESS
         POST  EAERIMWT,               POST SCHEDULER                  X
               ASCB=(10),                                              X
               ECBKEY=0,                                               X
               LINKAGE=SYSTEM,                                         X
               ERRET=BR14,                                             X
               MF=(E,LPOST)
*
         WAIT  ECB=EAEASWT             WAIT FOR SCHEDULER TO COMPLETE
*                                        INITIALISATION FOR THIS AS
         LR    R1,R13
         STORAGE RELEASE,                                              X
               ADDR=(1),                                               X
               LENGTH=AIWRKL
         PR    ,
*
BR14     DS    0H
         BR    R14
*
         LTORG ,
*
AIWRK    DSECT ,
SAVEAREA DS    18F
LPOST    POST  ECBKEY=YES,MF=L
AIWRKL   EQU   *-AIWRK
*
         IEZEAECB ,
*
         YREGS ,
*
         END   ,
./ ADD NAME=JJ$SCHAT
JJ$SCHAT CSECT ,
JJ$SCHAT AMODE 31
JJ$SCHAT RMODE ANY
*
* ENTRY PARAMETERS
*   0(R1) PTR SCIB - TRANSACTION SCHEDULER INFORMATION BLOCK
*   4(R1) PTR TXIB - TRANSACTION INSTANCE INFORMATION BLOCK
*
* CALLED BY
*   ADDRESS SPACE TERMINATION (IRB)
*
* FUNCTION
*   CLEANUP ALL RESOURCES ASSOCIATED WITH THIS TRANSACTION INSTANCE
*
         BAKR  R14,0
         LR    R12,R15
         USING JJ$SCHAT,R12
*
         LM    R10,R11,0(R1)
         USING SCIB,R10
         USING TXIB,R11
*
         CLC   =C'SCIB',SCIBID
         BNE   *-1
         CLC   =C'TXIB',TXIBID
         BNE   *-1
*
         TM    SCDEBUG,DEBUGON
         BZ    NWSCHAT
         WTO   'JJ$SCHAT TX END'
NWSCHAT  DS    0H
*
         L     R3,TXIBLEN
         STORAGE RELEASE,                                              X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               ADDR=(11),                                              X
               LENGTH=(3)
*
         PR    ,
*
         LTORG ,
*
         SCIB ,
         TXIB ,
*
         IXCYMEPL ,
         IEZEAECB ,
         YREGS ,
*
         END   ,
./ ADD NAME=JJ$SCHID
JJ$SCHID CSECT ,
JJ$SCHID AMODE 31
JJ$SCHID RMODE ANY
*
* ENTRY PARAMETERS
*   0(R1) PTR SCIB - TRANSACTION SCHEDULER INFORMATION BLOCK
*   4(R1) PTR TXIB - TRANSACTION INSTANCE INFORMATION BLOCK (OPTIONAL)
*
* CALLED BY
*   JJ$SCHIN DURING INITIALISATION (RB, NO TXIB)
*   JJ$SCHMI UPON APPC ACTIVE NOTIFICATION (IRB, TXIB PRESENT)
*   JJ$SCHMI WHEN LU INACTIVE IS RECEIVED FOR INACTIVE LU
*            (ALTERNATE SCHEDULER TERMINATING)
*
* FUNCTION
*   WILL ISSUE APPC CONNECT TO CONNECT SCHEDULER TO APPC
*   TXIB WILL BE FREED IF PRESENT
*
         BAKR  R14,0
         LR    R12,R15
         USING JJ$SCHID,R12
*
         LR    R9,R1
         LM    R10,R11,0(R1)
         USING SCIB,R10
*
         CLC   =C'SCIB',SCIBID
         BNE   *-1
*
         STORAGE OBTAIN,               OBTAIN WORKAREA                 X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               LENGTH=IDWRKL
         LR    R13,R1
         MVC   4(4,R1),=C'F1SA'
         USING IDWRK,R13
*
         CALL  ATBIDN1,                IDENTIFY                        X
               (SCNAME,                  SCHEDULER NAME                X
               ATBCSS_FW0,               EXTRACT EXIT ADDR             X
               ATBCSS_FW0,               EXTRACT EXIT DATA             X
               SCMEMTK,                  MEMBER TOKEN                  X
               ATBIDEN_PROFILE_REQUIRED, PROFILE PROCESSING            X
               ATBIDEN_LU_INIT_STAT_ACTIVE,   LU STATUS                X
               =CL8' ',                  PROFILE EXIT                  X
               ATBCSS_FW0,               PROFILE EXIT DATA             X
               RC),                      RETURN CODE                   X
               VL,MF=(E,LCALL)           PROFILE PROCESSING
*
         TM    0(R9),X'80'             ONLY SCIB
         BO    NOTXIB
         USING TXIB,R11
         CLC   TXIBID,=C'TXIB'
         BNE   *-1
         L     R3,TXIBLEN
         STORAGE RELEASE,                                              X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               LENGTH=(3),                                             X
               ADDR=(11)
         DROP  R11
NOTXIB   DS    0H
*
         LR    R1,R13
         STORAGE RELEASE,                                              X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               LENGTH=IDWRKL,                                          X
               ADDR=(1)
*
         L     R15,RC
         PR    ,
*
         ATBCSASM ,
*
         LTORG ,
*
IDWRK    DSECT ,
SAVEAREA DS    18F
LCALL    DS    10F
RC       DS    F
IDWRKL   EQU   *-IDWRK
*
         SCIB  ,
         TXIB  ,
*
         IXCYMEPL ,                    REQUIRED BY TXIB
         YREGS ,
*
         END   ,
./ ADD NAME=JJ$SCHIN
JJ$SCHIN CSECT ,
JJ$SCHIN AMODE 31
JJ$SCHIN RMODE ANY
         SPKA  X'70'                   CAUSE 0C2 IF CALLED INCORRECTLY
         BAKR  R14,0
         LR    R12,R15
         USING JJ$SCHIN,R12
         USING PSA,0
*
         STORAGE OBTAIN,                                               X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               LENGTH=SCWRKL
         LR    R13,R1
         MVC   4(4,R1),=C'F1SA'
         USING SCWRK,R13
*
         STORAGE OBTAIN,               OBTAIN STORAGE FOR              X
               SP=229,                   TRANSACTION SCHEDULER         X
               CALLRKY=YES,              INFORMATION BLOCK (SCIB)      X
               LENGTH=SCIBL
         LR    R11,R1
         USING SCIB,R11
         MVC   SCIBID,=C'SCIB'
         MVC   SCIBLEN,=A(SCIBL)
         MVC   SCASPARM,=AL2(L'SCASCB)
         MVC   SCASCB,PSAAOLD
         MVC   SCTCB,PSATOLD
         MVC   SCBLUACT,=A(BLUINACT)   INDICATE BASE LU INACTIVE
         MVI   SCDEBUG,0
*
         LA    R3,COMMFLD
         EXTRACT (3),FIELDS=COMM,MF=(E,EXTRACT)
         L     R10,COMMFLD
         USING COM,R10
         ICM   R9,B'1111',COMCIBPT
         BZ    NOSTACIB
         USING CIB,R9
         CLI   CIBVERB,CIBSTART
         BNE   NOSTACIB
         CLC   =C'DEBUG',CIBDATA
         BNE   NOSTACIB
         OI    SCDEBUG,DEBUGON
NOSTACIB DS    0H
*
         TM    SCDEBUG,DEBUGON
         BZ    NWSCHIN
         WTO   'JJ$SCHIN &SYSTIME &SYSDATE'
NWSCHIN  DS    0H
*
         IAZXJSAB READ,                DEFAULT SCHEDNAME IS JOBNAME    X
               JOBNAME=SCNAME
         EREG  R1,R1
         L     R3,0(,R1)
         ICM   R0,B'0011',0(R3)        DATA LENGTH
         BZ    NONAME
         MVC   SCNAME,=CL8' '
         CH    R0,=H'8'
         BNH   NOTRUNK
         LA    R0,8
NOTRUNK  DS    0H
         BCTR  R0,0
         IPK   ,
         LR    R1,R2                   PARM KEY
         MVCSK SCNAME,2(R3)
NONAME   DS    0H
         TM    SCNAME,255-C' '
         BNZ   OKNAME
         MVC   SCNAME,=CL8'JJ$SCHED'
OKNAME   DS    0H
*
         ST    R11,MIDATA
         CALL  ATBJGP1,                JOIN_SYSAPPC_GROUP              X
               (MSGINRTN,                MESSAGE IN ROUTINE            X
               MIDATA,                   PARM FOR MI ROUTINE           X
               SCMEMTK,                  XCF MEMBER TOKEN              X
               XCFRC,                    XCF RETURN CODE               X
               XCFRS,                    XCF REASON CODE               X
               RC),                      CALL RETURN CODE              X
               VL,MF=(E,LCALL)
         L     R15,RC
         LTR   R15,R15
         BNZ   *-1
*
         CALL  JJ$SCHID,               IDENTIFY                        X
               (SCIB),                                                 X
               VL,MF=(E,LCALL)
*
GETCIB   DS    0H
         ICM   R9,B'1111',COMCIBPT
         BZ    NOCIB
*
         CLI   CIBVERB,CIBSTOP
         BE    STOP
         CLI   CIBVERB,CIBMODFY
         BNE   NEXTCIB
*
         CLC   =C'STOP',CIBDATA
         BE    STOP
         CLC   =C'NODEBUG',CIBDATA
         BNE   NONODBG
         NI    SCDEBUG,DEBUGOFF
         WTO   'JJ$SCHIN DEBUG NOW OFF'
         B     NEXTCIB
NONODBG  DS    0H
         CLC   =C'DEBUG',CIBDATA
         BNE   INVLMDFY
         OI    SCDEBUG,DEBUGON
         WTO   'JJ$SCHIN DEBUG NOW ON'
         B     NEXTCIB
*
INVLMDFY DS    0H
         WTO   'JJ$SCHIN INVALID MODIFY COMMAND'
NEXTCIB  DS    0H
         QEDIT ORIGIN=COMCIBPT,BLOCK=(9)
NOCIB    DS    0H
         QEDIT ORIGIN=COMCIBPT,CIBCTR=3
         L     R1,COMECBPT
         WAIT  ECB=(1),LONG=YES
         B     GETCIB
*
STOP     DS    0H
         CALL  ATBUID1,                UNIDENTIFY                      X
               (ATBUNID_UNIDENT_TYPE_NORMAL,                           X
               RC),                                                    X
               VL,MF=(E,LCALL)
         L     R15,RC
         LTR   R15,R15
         BNZ   NOWAIT
*
         TM    SCBLUACT,X'40'          BYPASS WAIT IF POSTED
         BO    NOWAIT
         WAIT  ECB=SCBLUACT            WAIT FOR BASE LU TO BECOME INACT
NOWAIT   DS    0H
*
         IXCLEAVE MEMTOKEN=SCMEMTK,                                    X
               MF=(E,IXCLEAVE,COMPLETE)
         LTR   R15,R15
         BNZ   *-1
*
         LR    R1,R11
         STORAGE RELEASE,              RELEASE SCIB                    X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               LENGTH=SCIBL,                                           X
               ADDR=(1)
*
         LR    R1,R13
         STORAGE RELEASE,              WORK AREA                       X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               LENGTH=SCWRKL,                                          X
               ADDR=(1)
*
         PR    ,
*
MSGINRTN DC    V(JJ$SCHMI),CL8'JJ$SCHMI'
*
         ATBCSASM ,
*
         LTORG ,
*
SCWRK    DSECT ,
SAVEAREA DS    18F
LCALL    DS    10F
MIDATA   DS    2A
         IXCLEAVE MF=(L,IXCLEAVE,0D)
XCFRC    DS    1F
XCFRS    DS    1F
RC       DS    1F
EXTRACT  EXTRACT MF=L
COMMFLD  DS    1F
SCWRKL   EQU   *-SCWRK
*
         SCIB ,
         TXIB ,
*
         IXCYMEPL ,
         IHAPSA ,
         IKJTCB ,
         IAZJSAB ,                     REQUIRED BY IAZXJSAB
         IHAASCB ,                     REQUIRED BY IAZXJSAB
         IHAASSB ,                     REQUIRED BY IAZXJSAB
         IHASTCB ,                     REQUIRED BY IAZXJSAB
COM      DSECT ,
         IEZCOM ,
CIB      DSECT ,
         IEZCIB ,
         YREGS ,
         END   ,
./ ADD NAME=JJ$SCHMI
JJ$SCHMI CSECT ,
JJ$SCHMI AMODE 31
JJ$SCHMI RMODE ANY
*
* ENTRY PARAMETERS
*   R1 MEPL - XCF
*
* CALLED BY
*   XCF (SRB)
*
* FUNCTION
*   PROCESS INCOMING APPC MESSAGES
*   - INBOUND ATTACH
*   - LU ACTIVE
*   - LU INACTIVE
*   - APPC INITIALISED
*   - APPC ABEND - RESTART WILL BE ATTEMPTED
*   - APPC ABEND - NO RESTART (IE CANCEL)
*
* THE SRB WILL HAVE PTCB/PASID TO OUR JOBSTEP TASK SO WE
*   CAN DO GETMAINS FOR THIS TCB.  (PTCB/PASID ENSURES
*   THAT THE TCB WILL NOT DIE UNLESS THE SRB HAS ENDED, OTHER
*   WISE AN INTEGRITY EXPOSURE WOULD EXIST - SRB GETMAINED
*   STORAGE FREEMAINED BY TCB-EXIT)
*
         BAKR  R14,0
         LR    R12,R15
         USING JJ$SCHMI,R12
         LR    R11,R1
         USING MEPL,R11
         USING XCFMS_SHORT_MESSAGE_HEADER,MEPLCNTL
*
         L     R10,MEPLMDAT
         USING SCIB,R10
*
         CLC   =C'SCIB',SCIBID
         BNE   *-1
*
         L     R3,MEPLMLEN
         AL    R3,=A(TXIBL)
*
         L     R4,SCTCB
         IC    R1,TCBPKF-TCB(,R4)
         IPK   ,
         SPKA  0(R1)
         STORAGE OBTAIN,                                               X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               TCBADDR=(4),                                            X
               LENGTH=(3)
         SPKA  0(R2)
         LR    R9,R1
         USING TXIB,R9
         MVC   TXIBID,=C'TXIB'
         ST    R3,TXIBLEN
*
         MVC   TXMEPL,MEPL
         L     R3,MEPLMLEN
         LTR   R3,R3
         BZ    NOMSG
*
         IXCMSGI MSGTOKEN=MEPLMTOK,                                    X
               MSGBUF=TXFMH5,                                          X
               MF=(E,IXCMSGI,COMPLETE)
         LTR   R15,R15
         BNZ   *-1
NOMSG    DS    0H
*
         LM    R3,R5,=A(TABLE,12,TABEND)
LOOP     DS    0H
         CLC   XCFMS_MESSAGE_TYPE,0(R3)
         BE    DONE
         BXLE  R3,R4,LOOP
DONE     DS    0H
         L     R1,8(,R3)
         TM    SCDEBUG,DEBUGON
         BZ    NWSCHMI
         WTO   MF=(E,(1)),LINKAGE=BRANCH
NWSCHMI  DS    0H
         L     R15,4(,R3)
         BR    R15
*
TABLE    DC    A(XCFMS_INBOUND_ATTACH,MIINAT,MSGIA)
         DC    A(XCFMS_LU_ACTIVE,MILUAC,MSGLA)
         DC    A(XCFMS_LU_NOACTIVE,MINLUA,MSGLNA)
         DC    A(XCFMS_APPC_INIT,MIINIT,MSGAI)
         DC    A(XCFMS_APPC_NORESTART,DEACTLU,MSGANR)
TABEND   DC    A(XCFMS_APPC_RESTART,DEACTLU,MSGAR)
         DC    A(0,FREETXIB,MSGUN)
*
MSGIA    WTO   'JJ$SCHMI INBOUND_ATTACH',                              X
               MCSFLAG=BUSYEXIT,MF=L
MSGLA    WTO   'JJ$SCHMI LU_ACTIVE',                                   X
               MCSFLAG=BUSYEXIT,MF=L
MSGLNA   WTO   'JJ$SCHMI LU_NOACTIVE',                                 X
               MCSFLAG=BUSYEXIT,MF=L
MSGAI    WTO   'JJ$SCHMI APPC_INIT',                                   X
               MCSFLAG=BUSYEXIT,MF=L
MSGAR    WTO   'JJ$SCHMI APPC_RESTART',                                X
               MCSFLAG=BUSYEXIT,MF=L
MSGANR   WTO   'JJ$SCHMI APPC_NORESTART',                              X
               MCSFLAG=BUSYEXIT,MF=L
MSGUN    WTO   'JJ$SCHMI XCFMS_MESSAGE_TYPE=*UNKNOWN*',                X
               MCSFLAG=BUSYEXIT,MF=L
*
FREETXIB DS    0H
         L     R4,SCTCB
         L     R3,TXIBLEN
         IC    R1,TCBPKF-TCB(,R4)
         IPK   ,
         SPKA  0(R1)
         LR    R1,R9
         STORAGE RELEASE,                                              X
               SP=229,                                                 X
               CALLRKY=YES,                                            X
               TCBADDR=(4),                                            X
               LENGTH=(3),                                             X
               ADDR=(1)
         SPKA  0(R2)
         PR    ,
*
MILUAC   DS    0H
         CLC   XCFMS_TRANS_SCHED_NAME,SCNAME
         BNE   FREETXIB
         TM    XCFMS_LU_FLAGS,XCFMS_BASE_LU
         BNO   FREETXIB
         L     R2,=A(BLUINACT)
         L     R3,=A(BLUACT)
         CS    R2,R3,SCBLUACT          INDICATE LU ACTIVE
         B     FREETXIB
*
MINLUA   DS    0H
         CLC   XCFMS_TRANS_SCHED_NAME,SCNAME
         BNE   FREETXIB
         TM    XCFMS_LU_FLAGS,XCFMS_BASE_LU
         BNO   FREETXIB
DEACTLU  DS    0H
         L     R2,=A(BLUACT)
         L     R3,=A(BLUINACT)
         CS    R2,R3,SCBLUACT          INDICATE LU INACTIVE
         BZ    FREETXIB
         LR    R1,R2
         N     R1,=A(BLUWAIT)          IF WAIT BIT ON
         BZ    MIINIT                    THEN ISSUE POST
         POST  SCBLUACT,               ELSE MIINIT;                    X
               LINKAGE=SYSTEM            ALTERNATE SCHEDULER RELEASED
         B     FREETXIB                  THE LU
*
MIINIT   DS    0H
         SETLOCK OBTAIN,                                               X
               TYPE=LOCAL,                                             X
               MODE=UNCOND,                                            X
               REGS=STDSAVE
         LTR   R15,R15
         BNZ   *-1
         LA    R1,TXSCIB
         ST    R1,TXIRBP
         LA    R1,SCIB
         ST    R1,TXSCIB
         LA    R1,TXIB
         ST    R1,TXTXIB
         SCHEDIRB EPPTR=IDRTN,                                         X
               TCBPTR=SCTCB,                                           X
               MODE=SUPR,                                              X
               KEY=PROP,                                               X
               PARAMPTR=TXIRBP,                                        X
               MF=(E,SCHEDIRB,COMPLETE)
         LTR   R15,R15
         BNZ   *-1
         SETLOCK RELEASE,                                              X
               TYPE=LOCAL,                                             X
               REGS=STDSAVE
         LTR   R15,R15
         BNZ   *-1
         PR    ,
*
MIINAT   DS    0H
         SETLOCK OBTAIN,                                               X
               TYPE=LOCAL,                                             X
               MODE=UNCOND,                                            X
               REGS=STDSAVE
         LTR   R15,R15
         BNZ   *-1
         LA    R1,TXSCIB
         ST    R1,TXIRBP
         LA    R1,SCIB
         ST    R1,TXSCIB
         LA    R1,TXIB
         ST    R1,TXTXIB
         SCHEDIRB EPPTR=ACRTN,                                         X
               TCBPTR=SCTCB,                                           X
               MODE=SUPR,                                              X
               KEY=PROP,                                               X
               PARAMPTR=TXIRBP,                                        X
               MF=(E,SCHEDIRB,COMPLETE)
         LTR   R15,R15
         BNZ   *-1
         SETLOCK RELEASE,                                              X
               TYPE=LOCAL,                                             X
               REGS=STDSAVE
         LTR   R15,R15
         BNZ   *-1
         PR    ,
*
IDRTN    DC    V(JJ$SCHID),CL8'JJ$SCHID'
ACRTN    DC    V(JJ$SCHAC),CL8'JJ$SCHAC'
*
         LTORG ,
*
         SCIB ,
         TXIB ,
*
         IXCYMEPL ,
         ATBXCFMS ,
         CVT   DSECT=YES
         IKJTCB ,
         IHAPSA ,
         YREGS ,
*
         END   ,
./ ADD NAME=JJ$SCHSE
JJ$SCHSE CSECT ,
JJ$SCHSE AMODE 31
JJ$SCHSE RMODE ANY
*
* ENTRY PARAMETERS
*   0(R1) NUMBER OF RECORDS
*   4(R1) LRECL
*   8(R1) FIRST RECORD
*  12(R1) MSG ROUTINE ADDRESS
*
* CALLED BY
*   ATBSDFMU WHEN DEFINING A PROFILE WITH TPSCHED_EXIT(JJ$SCHSE)
*
* FUNCTION
*   ENSURE THAT THE PROFILE DATA IS ONLY ONE LINE AND DOES NOT EXCEED
*   THE ASCRE RESTRICTIONS ON STPARM
*
         SPKA  X'10'                   CAUSE 0C2 IF CALLED INCORRECTLY
         BAKR  R14,0
         LR    R12,R15
         USING JJ$SCHSE,R12
*
         LM    R3,R6,0(R1)             PICK UP PARAMETERS
*
         STORAGE OBTAIN,                                               X
               LENGTH=WRKL
         LR    R13,R1
         MVC   4(4,R13),=C'F1SA'
         USING WRK,R13
*
         SLR   R10,R10                 INITIAL RETURN CODE
         CLC   =F'1',0(R3)             CHECK FOR ONE LINE
         BNE   ERROR
         CLC   =F'124',0(R4)           MAXIMUM OF 124 CHARS (ASCRE)
         BH    NOMSG
*
ERROR    DS    0H
         LA    R10,4                   SET RETURNCODE TO 4
         L     R15,0(,R6)
         CALL  (15),                                                   X
               (MSGLEN,                                                X
               MESSAGE),                                               X
               VL,MF=(E,LCALL)
NOMSG    DS    0H
*
         LR    R1,R13
         STORAGE RELEASE,                                              X
               LENGTH=WRKL,                                            X
               ADDR=(1)
*
         LR    R15,R10
         PR    ,
*
MSGLEN   DC    A(L'MESSAGE)
MESSAGE  DC    C'JJ$SCHSE Scheduler data (ASCRE STPARM=) must be one liX
               ne and not exceed 124 characters.'
*
         LTORG ,
*
WRK      DSECT ,
SAVEAREA DS    18F
LCALL    DS    3F
WRKL     EQU   *-WRK
*
         YREGS ,
*
         END   ,
./ ADD NAME=JJINFO      01 00 99291 99291 135540 0005 0005 0000 IBMUSER
//DEFAULT  OUTPUT DEFAULT=YES,JESDS=ALL,CLASS=T
//IEFPROC  EXEC PGM=IKJEFT1A,PARM=SYSINFO
//SYSEXEC  DD DSN=IBMUSER.JSCH.SOURCE,DISP=SHR
//SYSTSPRT DD SYSOUT=T
//SYSTSIN  DD DUMMY
./ ADD NAME=SCHED00     01 00 99293 99293 093908 0006 0006 0000 IBMUSER
PPT PGMNAME(JJ$SCHIN)   /* JSCH                                      */
    NOCANCEL            /* CANNOT BE CANCELLED                       */
    KEY(7)              /* AUTH USER KEY                             */
    NOSWAP              /* NON-SWAPPABLE                             */
    PRIV                /* PROGRAM IS PRIVILIGED                     */
    SYST                /* SYSTEM TASK                               */
./ ADD NAME=SCIB
         MACRO ,
         SCIB ,
SCIB     DSECT ,
SCIBID   DS    C'SCIB'
SCIBLEN  DS    AL4(SCIBL)
SCDEBUG  DS    X
DEBUGON  EQU   X'80'
DEBUGOFF EQU   X'FF'-DEBUGON
         DS    X
SCASPARM DS    AL2(L'SCASCB)
SCASCB   DS    A                       SCHEDULERS ASCB
SCTCB    DS    A                       SCHEDULERS TCB
SCMEMTK  DS    XL8                     XCF MEMBER TOKEN
SCNAME   DS    CL8                     SCHEDULER NAME
SCBLUACT DS    F                       BASE LU ACTIVE / TERM ECB
BLUACT   EQU   X'00000000'             BASE LU ACTIVE FLAG
BLUINACT EQU   X'40000000'             BASE LU INACTIVE FLAG
BLUWAIT  EQU   X'80000000'             WAIT FLAG
SCIBL    EQU   *-SCIB
         MEND  ,
./ ADD NAME=STCJCL      01 01 99288 99288 145624 0006 0005 0001 Z567592
//DEFAULT  OUTPUT DEFAULT=YES,JESDS=ALL,CLASS=T
//IEFPROC  EXEC PGM=IKJEFT1A,PARM=REXXS
//STEPLIB  DD DSN=QDB610.D1.SDSNLOAD,DISP=SHR
//SYSEXEC  DD DSN=IBMUSER.JSCH.SOURCE,DISP=SHR
//SYSTSPRT DD SYSOUT=T
//SYSTSIN  DD DUMMY
./ ADD NAME=STCJOB      01 00 99288 99288 110255 0003 0003 0000 IBMUSER
//STCJOB   JOB ,STCJOB
//         JCLLIB ORDER=(&D.)
//         INCLUDE MEMBER=&M.
./ ADD NAME=SYSINFO     01 08 99291 99323 153221 0373 0311 0122 IBMUSER
/* REXX */

  call atbcmrexx

  /* Initialise conversation */
  address "CPICOMM" "CMACCP CON_ID C_RC"
  if C_RC ¬= CM_OK then
    do
      call wto "CMACCP failed RC =" CM_RETURN_CODE.C_RC
      exit 8
    end

  do until RCV_STA = CM_SEND_RECEIVED
    rcv_len = 4096
    address "CPICOMM" "CMRCV CON_ID RCV_MSG RCV_LEN",
                      "RCV_RET RCV_RLN RCV_STA REQ_SEND C_RC"
    if C_RC ¬= CM_OK then
      do
        call sendmsg "<BR>CMRCV failed RC =" CM_RETURN_CODE.C_RC
        exit 8
      end
    if RCV_RET ¬= CM_NO_DATA_RECEIVED then
      cmdline = left(rcv_msg,rcv_rln)

  address 'TSO' 'CONSPROF UNSOLDISPLAY(NO) SOLDISPLAY(NO)'
  address 'TSO' 'CONSOLE NAME(JJINFO) CART(JJINFO) ACTIVATE'

  call sendmsg 'Content-type: text/html'
  call sendmsg ''
  call sendmsg '<h2>System Information</h2>'

  call sendmsg '<h3>System IPL Volume</h3>'
  address 'CONSOLE' 'DISPLAY U,IPLVOL'
  msg = getmsg('iplvol.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to iplvol.0
    call sendmsg iplvol.i
  end
  call sendmsg '</pre>'

  call sendmsg '<h3>System IPL Info</h3>'
  address 'CONSOLE' 'DISPLAY IPLINFO'
  msg = getmsg('iplinfo.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to iplinfo.0
    call sendmsg iplinfo.i
  end
  call sendmsg '</pre>'

  call sendmsg '<h3>System I/O Configuration</h3>'
  address 'CONSOLE' 'DISPLAY IOS,CONFIG(ALL)'
  msg = getmsg('iosconfig.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to iosconfig.0
    call sendmsg iosconfig.i
  end
  call sendmsg '</pre>'

  call sendmsg '<h3>System CPU Configuration</h3>'
  address 'CONSOLE' 'DISPLAY M=CPU'
  msg = getmsg('cpuconfig.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to cpuconfig.0
    call sendmsg cpuconfig.i
  end
  call sendmsg '</pre>'

  call sendmsg '<h3>System Storage Configuration</h3>'
  address 'CONSOLE' 'DISPLAY M=STOR'
  msg = getmsg('storcfg.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to storcfg.0
    call sendmsg storcfg.i
  end
  call sendmsg ''
  address 'CONSOLE' 'DISPLAY M=ESTOR'
  msg = getmsg('estorcfg.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to estorcfg.0
    call sendmsg estorcfg.i
  end
  call sendmsg '</pre>'

  call sendmsg '<h3>Sysplex Systems</h3>'
  address 'CONSOLE' 'DISPLAY XCF'
  msg = getmsg('xcf.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to xcf.0
    call sendmsg xcf.i
  end
  call sendmsg '</pre>'

  call sendmsg '<h3>Sysplex Coupling Facilities</h3>'
  address 'CONSOLE' 'DISPLAY XCF,CF'
  msg = getmsg('xes.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to xes.0
    call sendmsg xes.i
  end
  call sendmsg ''
  address 'CONSOLE' 'DISPLAY CF'
  msg = getmsg('dcf.','SOL','JJINFO',,3)
  do i = 2 to dcf.0
    call sendmsg dcf.i
  end
  call sendmsg '</pre>'

  call sendmsg '<h3>Sysplex Groups</h3>'
  address 'CONSOLE' 'DISPLAY XCF,GROUP'
  msg = getmsg('xcfg.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to xcfg.0
    call sendmsg xcfg.i
  end
  call sendmsg '</pre>'

  call sendmsg '<h3>Sysplex Coupling Facilities Structure Summary</h3>'
  address 'CONSOLE' 'DISPLAY XCF,STR'
  msg = getmsg('str.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to str.0
    call sendmsg str.i
  end
  call sendmsg '</pre>'

  call sendmsg '<h3>Sysplex Coupling Dataset Status</h3>'
  address 'CONSOLE' 'DISPLAY XCF,COUPLE'
  msg = getmsg('xcfc.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to xcfc.0
    call sendmsg xcfc.i
  end
  call sendmsg '</pre>'

  call sendmsg '<h3>Sysplex Coupling Facilities Structure Detail</h3>'
  address 'CONSOLE' 'DISPLAY XCF,STR,STRNM=ALL'
  msg = getmsg('stra.','SOL','JJINFO',,3)
  call sendmsg '<pre>'
  do i = 2 to stra.0
    call sendmsg stra.i
  end
  call sendmsg '</pre>'

  address 'TSO' 'CONSOLE DEACTIVATE'

  address "CPICOMM" "CMDEAL CON_ID C_RC"
  if C_RC ¬= CM_OK then
    do
      call wto "CMDEAL failed RC =" CM_RETURN_CODE.C_RC
      exit 8
    end

exit

wto:
  arg msg
  address "TSO" "SEND '" || msg || "',OPERATOR(11)"
return

sendmsg:
  parse arg msg
  msg_len = length(msg)
  address "CPICOMM" "CMSEND CON_ID MSG MSG_LEN REQ_SEND C_RC"
  if C_RC ¬= CM_OK then
    do
      call wto "CMSEND failed RC =" CM_RETURN_CODE.C_RC
      exit 8
    end


atbcmrexx:

/*************** SAA CPI Communications Variable Names ****************/
/*                                                                    */
/* The following variables are defined and available on all operating */
/* systems supporting SAA CPI Communications.  All variables for      */
/* SAA CPI Communications start with the letters 'CM'.                */
/*                                                                    */
/* The literals are provided for your convenience.  They may, or may  */
/* not, be defined in other operating system environments.            */
/*                                                                    */
/**********************************************************************/

CM_INITIALIZE_STATE             = 2    /* conversation_state          */
CM_SEND_STATE                   = 3
CM_RECEIVE_STATE                = 4
CM_SEND_PENDING_STATE           = 5
CM_CONFIRM_STATE                = 6
CM_CONFIRM_SEND_STATE           = 7
CM_CONFIRM_DEALLOCATE_STATE     = 8
CM_DEFER_RECEIVE_STATE          = 9
CM_DEFER_DEALLOCATE_STATE       = 10
CM_SYNC_POINT_STATE             = 11
CM_SYNC_POINT_SEND_STATE        = 12
CM_SYNC_POINT_DEALLOCATE_STATE  = 13
CM_CONVERSATION_STATE.2         = 'CM_INITIALIZE_STATE'
CM_CONVERSATION_STATE.3         = 'CM_SEND_STATE'
CM_CONVERSATION_STATE.4         = 'CM_RECEIVE_STATE'
CM_CONVERSATION_STATE.5         = 'CM_SEND_PENDING_STATE'
CM_CONVERSATION_STATE.6         = 'CM_CONFIRM_STATE'
CM_CONVERSATION_STATE.7         = 'CM_CONFIRM_SEND_STATE'
CM_CONVERSATION_STATE.8         = 'CM_CONFIRM_DEALLOCATE_STATE'
CM_CONVERSATION_STATE.9         = 'CM_DEFER_RECEIVE_STATE'
CM_CONVERSATION_STATE.10        = 'CM_DEFER_DEALLOCATE_STATE'
CM_CONVERSATION_STATE.11        = 'CM_SYNC_POINT_STATE'
CM_CONVERSATION_STATE.12        = 'CM_SYNC_POINT_SEND_STATE'
CM_CONVERSATION_STATE.13        = 'CM_SYNC_POINT_DEALLOCATE_STATE'

CM_BASIC_CONVERSATION           = 0    /* conversation_type           */
CM_MAPPED_CONVERSATION          = 1
CM_CONVERSATION_TYPE.0          = 'CM_BASIC_CONVERSATION'
CM_CONVERSATION_TYPE.1          = 'CM_MAPPED_CONVERSATION'

CM_NO_DATA_RECEIVED             = 0    /* data_received               */
CM_DATA_RECEIVED                = 1
CM_COMPLETE_DATA_RECEIVED       = 2
CM_INCOMPLETE_DATA_RECEIVED     = 3
CM_DATA_RECEIVED.0              = 'CM_NO_DATA_RECEIVED'
CM_DATA_RECEIVED.1              = 'CM_DATA_RECEIVED'
CM_DATA_RECEIVED.2              = 'CM_COMPLETE_DATA_RECEIVED'
CM_DATA_RECEIVED.3              = 'CM_INCOMPLETE_DATA_RECEIVED'

CM_DEALLOCATE_SYNC_LEVEL        = 0    /* deallocate_type             */
CM_DEALLOCATE_FLUSH             = 1
CM_DEALLOCATE_CONFIRM           = 2
CM_DEALLOCATE_ABEND             = 3
CM_DEALLOCATE_TYPE.0            = 'CM_DEALLOCATE_SYNC_LEVEL'
CM_DEALLOCATE_TYPE.1            = 'CM_DEALLOCATE_FLUSH'
CM_DEALLOCATE_TYPE.2            = 'CM_DEALLOCATE_CONFIRM'
CM_DEALLOCATE_TYPE.3            = 'CM_DEALLOCATE_ABEND'

CM_RECEIVE_ERROR                = 0    /* error_direction             */
CM_SEND_ERROR                   = 1
CM_ERROR_DIRECTION.0            = 'CM_RECEIVE_ERROR'
CM_ERROR_DIRECTION.1            = 'CM_SEND_ERROR'

CM_FILL_LL                      = 0    /* fill                        */
CM_FILL_BUFFER                  = 1
CM_FILL.0                       = 'CM_FILL_LL'
CM_FILL.1                       = 'CM_FILL_BUFFER'

CM_PREP_TO_RECEIVE_SYNC_LEVEL   = 0    /* prepare_to_receive_type     */
CM_PREP_TO_RECEIVE_FLUSH        = 1
CM_PREP_TO_RECEIVE_CONFIRM      = 2
CM_PREPARE_TO_RECEIVE_TYPE.0    = 'CM_PREP_TO_RECEIVE_SYNC_LEVEL'
CM_PREPARE_TO_RECEIVE_TYPE.1    = 'CM_PREP_TO_RECEIVE_FLUSH'
CM_PREPARE_TO_RECEIVE_TYPE.2    = 'CM_PREP_TO_RECEIVE_CONFIRM'

CM_RECEIVE_AND_WAIT             = 0    /* receive_type                */
CM_RECEIVE_IMMEDIATE            = 1
CM_RECEIVE_TYPE.0               = 'CM_RECEIVE_AND_WAIT'
CM_RECEIVE_TYPE.1               = 'CM_RECEIVE_IMMEDIATE'

CM_REQ_TO_SEND_NOT_RECEIVED     = 0    /* request_to_send_received    */
CM_REQ_TO_SEND_RECEIVED         = 1
CM_REQUEST_TO_SEND_RECEIVED.0   = 'CM_REQ_TO_SEND_NOT_RECEIVED'
CM_REQUEST_TO_SEND_RECEIVED.1   = 'CM_REQ_TO_SEND_RECEIVED'

CM_OK                           = 0    /* return_code                 */
CM_ALLOCATE_FAILURE_NO_RETRY    = 1
CM_ALLOCATE_FAILURE_RETRY       = 2
CM_CONVERSATION_TYPE_MISMATCH   = 3
CM_PIP_NOT_SPECIFIED_CORRECTLY  = 5
CM_SECURITY_NOT_VALID           = 6
CM_SYNC_LVL_NOT_SUPPORTED_LU    = 7
CM_SYNC_LVL_NOT_SUPPORTED_PGM   = 8
CM_TPN_NOT_RECOGNIZED           = 9
CM_TP_NOT_AVAILABLE_NO_RETRY    = 10
CM_TP_NOT_AVAILABLE_RETRY       = 11
CM_DEALLOCATED_ABEND            = 17
CM_DEALLOCATED_NORMAL           = 18
CM_PARAMETER_ERROR              = 19
CM_PRODUCT_SPECIFIC_ERROR       = 20
CM_PROGRAM_ERROR_NO_TRUNC       = 21
CM_PROGRAM_ERROR_PURGING        = 22
CM_PROGRAM_ERROR_TRUNC          = 23
CM_PROGRAM_PARAMETER_CHECK      = 24
CM_PROGRAM_STATE_CHECK          = 25
CM_RESOURCE_FAILURE_NO_RETRY    = 26
CM_RESOURCE_FAILURE_RETRY       = 27
CM_UNSUCCESSFUL                 = 28
CM_DEALLOCATED_ABEND_SVC        = 30
CM_DEALLOCATED_ABEND_TIMER      = 31
CM_SVC_ERROR_NO_TRUNC           = 32
CM_SVC_ERROR_PURGING            = 33
CM_SVC_ERROR_TRUNC              = 34
CM_TAKE_BACKOUT                 = 100
CM_DEALLOCATED_ABEND_BO         = 130
CM_DEALLOCATED_ABEND_SVC_BO     = 131
CM_DEALLOCATED_ABEND_TIMER_BO   = 132
CM_RESOURCE_FAIL_NO_RETRY_BO    = 133
CM_RESOURCE_FAILURE_RETRY_BO    = 134
CM_DEALLOCATED_NORMAL_BO        = 135
CM_RETURN_CODE.0                = 'CM_OK'
CM_RETURN_CODE.1                = 'CM_ALLOCATE_FAILURE_NO_RETRY'
CM_RETURN_CODE.2                = 'CM_ALLOCATE_FAILURE_RETRY'
CM_RETURN_CODE.3                = 'CM_CONVERSATION_TYPE_MISMATCH'
CM_RETURN_CODE.5                = 'CM_PIP_NOT_SPECIFIED_CORRECTLY'
CM_RETURN_CODE.6                = 'CM_SECURITY_NOT_VALID'
CM_RETURN_CODE.7                = 'CM_SYNC_LVL_NOT_SUPPORTED_LU'
CM_RETURN_CODE.8                = 'CM_SYNC_LVL_NOT_SUPPORTED_PGM'
CM_RETURN_CODE.9                = 'CM_TPN_NOT_RECOGNIZED'
CM_RETURN_CODE.10               = 'CM_TP_NOT_AVAILABLE_NO_RETRY'
CM_RETURN_CODE.11               = 'CM_TP_NOT_AVAILABLE_RETRY'
CM_RETURN_CODE.17               = 'CM_DEALLOCATED_ABEND'
CM_RETURN_CODE.18               = 'CM_DEALLOCATED_NORMAL'
CM_RETURN_CODE.19               = 'CM_PARAMETER_ERROR'
CM_RETURN_CODE.20               = 'CM_PRODUCT_SPECIFIC_ERROR'
CM_RETURN_CODE.21               = 'CM_PROGRAM_ERROR_NO_TRUNC'
CM_RETURN_CODE.22               = 'CM_PROGRAM_ERROR_PURGING'
CM_RETURN_CODE.23               = 'CM_PROGRAM_ERROR_TRUNC'
CM_RETURN_CODE.24               = 'CM_PROGRAM_PARAMETER_CHECK'
CM_RETURN_CODE.25               = 'CM_PROGRAM_STATE_CHECK'
CM_RETURN_CODE.26               = 'CM_RESOURCE_FAILURE_NO_RETRY'
CM_RETURN_CODE.27               = 'CM_RESOURCE_FAILURE_RETRY'
CM_RETURN_CODE.28               = 'CM_UNSUCCESSFUL'
CM_RETURN_CODE.30               = 'CM_DEALLOCATED_ABEND_SVC'
CM_RETURN_CODE.31               = 'CM_DEALLOCATED_ABEND_TIMER'
CM_RETURN_CODE.32               = 'CM_SVC_ERROR_NO_TRUNC'
CM_RETURN_CODE.33               = 'CM_SVC_ERROR_PURGING'
CM_RETURN_CODE.34               = 'CM_SVC_ERROR_TRUNC'
CM_RETURN_CODE.100              = 'CM_TAKE_BACKOUT'
CM_RETURN_CODE.130              = 'CM_DEALLOCATED_ABEND_BO'
CM_RETURN_CODE.131              = 'CM_DEALLOCATED_ABEND_SVC_BO'
CM_RETURN_CODE.132              = 'CM_DEALLOCATED_ABEND_TIMER_BO'
CM_RETURN_CODE.133              = 'CM_RESOURCE_FAIL_NO_RETRY_BO'
CM_RETURN_CODE.134              = 'CM_RESOURCE_FAILURE_RETRY_BO'
CM_RETURN_CODE.135              = 'CM_DEALLOCATED_NORMAL_BO'

CM_WHEN_SESSION_ALLOCATED       = 0    /* return_control              */
CM_IMMEDIATE                    = 1
CM_RETURN_CONTROL.0             = 'CM_WHEN_SESSION_ALLOCATED'
CM_RETURN_CONTROL.1             = 'CM_IMMEDIATE'

CM_BUFFER_DATA                  = 0    /* send_type                   */
CM_SEND_AND_FLUSH               = 1
CM_SEND_AND_CONFIRM             = 2
CM_SEND_AND_PREP_TO_RECEIVE     = 3
CM_SEND_AND_DEALLOCATE          = 4
CM_SEND_TYPE.0                  = 'CM_BUFFER_DATA'
CM_SEND_TYPE.1                  = 'CM_SEND_AND_FLUSH'
CM_SEND_TYPE.2                  = 'CM_SEND_AND_CONFIRM'
CM_SEND_TYPE.3                  = 'CM_SEND_AND_PREP_TO_RECEIVE'
CM_SEND_TYPE.4                  = 'CM_SEND_AND_DEALLOCATE'

CM_NO_STATUS_RECEIVED           = 0    /* status_received             */
CM_SEND_RECEIVED                = 1
CM_CONFIRM_RECEIVED             = 2
CM_CONFIRM_SEND_RECEIVED        = 3
CM_CONFIRM_DEALLOC_RECEIVED     = 4
CM_TAKE_COMMIT                  = 5
CM_TAKE_COMMIT_SEND             = 6
CM_TAKE_COMMIT_DEALLOCATE       = 7
CM_STATUS_RECEIVED.0            = 'CM_NO_STATUS_RECEIVED'
CM_STATUS_RECEIVED.1            = 'CM_SEND_RECEIVED'
CM_STATUS_RECEIVED.2            = 'CM_CONFIRM_RECEIVED'
CM_STATUS_RECEIVED.3            = 'CM_CONFIRM_SEND_RECEIVED'
CM_STATUS_RECEIVED.4            = 'CM_CONFIRM_DEALLOC_RECEIVED'
CM_STATUS_RECEIVED.5            = 'CM_TAKE_COMMIT'
CM_STATUS_RECEIVED.6            = 'CM_TAKE_COMMIT_SEND'
CM_STATUS_RECEIVED.7            = 'CM_TAKE_COMMIT_DEALLOCATE'

CM_NONE                         = 0    /* sync_level                  */
CM_CONFIRM                      = 1
CM_SYNC_POINT                   = 2
CM_SYNC_LEVEL.0                 = 'CM_NONE'
CM_SYNC_LEVEL.1                 = 'CM_CONFIRM'
CM_SYNC_LEVEL.2                 = 'CM_SYNC_POINT'

/******************** END OF SAA VARIABLE NAMES ***********************/


return
./ ADD NAME=TXIB
         MACRO ,
         TXIB ,
TXIB     DSECT ,
TXIBID   DS    C'TXIB'
TXIBLEN  DS    AL4(TXIBL)
         IHAASEO DSECT=NO
         IXCMSGI MF=(L,IXCMSGI,0D)
         SCHEDIRB MF=(L,SCHEDIRB,0D)
TXIRBP   DS    A                       PARMLIST FOR SCHEDIRB
TXSCIB   DS    A
TXTXIB   DS    A
         DS    0D
TXMEPL   DS    XL(MEPLLEN)
TXFMH5   DS    0C
TXIBL    EQU   *-TXIB
         MEND  ,
